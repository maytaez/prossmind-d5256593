var MY=Object.defineProperty;var wO=t=>{throw TypeError(t)};var LY=(t,e,n)=>e in t?MY(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var hm=(t,e,n)=>LY(t,typeof e!="symbol"?e+"":e,n),$1=(t,e,n)=>e.has(t)||wO("Cannot "+n);var J=(t,e,n)=>($1(t,e,"read from private field"),n?n.call(t):e.get(t)),nn=(t,e,n)=>e.has(t)?wO("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),At=(t,e,n,r)=>($1(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),vi=(t,e,n)=>($1(t,e,"access private method"),n);var Ty=(t,e,n,r)=>({set _(i){At(t,e,i,n)},get _(){return J(t,e,r)}});import{j as u,A as xB,m as Re,u as bB,a as eg,b as BY}from"./framer-motion-J-ERuB6t.js";import{a as ow,u as dv,d as FY,r as _,R as zY,L as Mr,b as be,v as HY,e as Ns,f as gf,h as Ct,g as aw,c as M1,i as wB,N as gs,B as UY}from"./react-vendor-DtvquEQd.js";import{_ as rt,t as VY,a as lw,c as _B,O as hv,P as vk,C as pv,b as cw,T as fv,D as mv,R as yk,d as EB,u as Mn,e as uw,f as Tl,g as Yt,h as Gc,i as Pt,j as ws,k as as,l as qY,m as SB,n as WY,o as GY,p as CB,q as KY,I as YY,r as Mc,s as vf,S as jB,v as kB,w as XY,x as PB,y as TB,z as NB,A as OB,B as RB,L as AB,E as IB,F as QY,G as ZY,H as xk,J as JY,K as DB,W as eX,M as dw,N as $B,Q as MB,U as tX,V as nX,X as rX,Y as iX,Z as LB,$ as BB,a0 as sX,a1 as FB,a2 as oX,a3 as aX,a4 as lX}from"./ui-vendor-Cs4hX_u_.js";import{l as cX}from"./lottie-wQXyeDve.js";import{B as bk,e as Ce,I as wk,i as ke,a as ie,b as Bt,c as B,d as vt,f as ur,t as Pd,g as li,h as uX,V as gv,j as $,s as Ei,k as ht,l as _k,m as bt,n as vn,q as at,o as Sg,p as Zn,r as Zs,u as En,v as Ek,O as zB,w as an,x as zd,y as Nr,z as oo,C as ye,A as hw,D as xr,E as Tt,F as ci,G as dt,H as xt,J as Fi,K as Lt,L as Yr,M as Me,N as T,P as Cg,Q as yf,R as Kc,S as Cs,T as Di,U as Sk,W as ui,X as Wt,Y as L1,Z as HB,_ as Ma,$ as UB,a0 as Ck,a1 as ee,a2 as IS,a3 as ul,a4 as re,a5 as Ge,a6 as wi,a7 as K,a8 as dX,a9 as un,aa as jk,ab as zo,ac as hX,ad as VB,ae as jg,af as Wn,ag as Hd,ah as DS,ai as pX,aj as pw,ak as cp,al as fw,am as kk,an as _i,ao as vr,ap as Or,aq as yn,ar as Oe,as as mw,at as kg,au as Ap,av as Td,aw as yr,ax as rn,ay as vv,az as Pg,aA as qB,aB as Yc,aC as Vh,aD as yb,aE as Ru,aF as _O,aG as fX,aH as mX,aI as gX,aJ as vX,aK as yX,aL as Pk,aM as Do,aN as $S,aO as WB,aP as Tk,aQ as Nk,aR as xX,aS as Ok,aT as bX,aU as wX,aV as _X,aW as EX,aX as Nd,aY as GB,aZ as SX,a_ as CX,a$ as EO,b0 as KB,b1 as jX,b2 as La,b3 as YB,b4 as xf,b5 as XB,b6 as bf,b7 as kX,b8 as PX,b9 as Tg,ba as TX,bb as wf,bc as tg,bd as Rk,be as NX,bf as OX,bg as RX}from"./bpmn-vendor-CDvMoOav.js";function AX(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var QB,SO=ow;QB=SO.createRoot,SO.hydrateRoot;const IX={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20}},DX={type:"tween",ease:"anticipate",duration:.4},Ja=({children:t})=>{const e=dv();return u.jsx(xB,{mode:"wait",children:u.jsx(Re.div,{initial:"initial",animate:"animate",exit:"exit",variants:IX,transition:DX,children:t},e.pathname)})},$X=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class Ak extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class MX extends Ak{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class CO extends Ak{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class jO extends Ak{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var MS;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(MS||(MS={}));class LX{constructor(e,{headers:n={},customFetch:r,region:i=MS.Any}={}){this.url=e,this.headers=n,this.region=i,this.fetch=$X(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return rt(this,arguments,void 0,function*(n,r={}){var i;let s,o;try{const{headers:a,method:l,body:c,signal:d,timeout:h}=r;let p={},{region:f}=r;f||(f=this.region);const m=new URL(`${this.url}/${n}`);f&&f!=="any"&&(p["x-region"]=f,m.searchParams.set("forceFunctionRegion",f));let g;c&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(p["Content-Type"]="application/octet-stream",g=c):typeof c=="string"?(p["Content-Type"]="text/plain",g=c):typeof FormData<"u"&&c instanceof FormData?g=c:(p["Content-Type"]="application/json",g=JSON.stringify(c)):g=c;let v=d;h&&(o=new AbortController,s=setTimeout(()=>o.abort(),h),d?(v=o.signal,d.addEventListener("abort",()=>o.abort())):v=o.signal);const b=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},p),this.headers),a),body:g,signal:v}).catch(E=>{throw new MX(E)}),x=b.headers.get("x-relay-error");if(x&&x==="true")throw new CO(b);if(!b.ok)throw new jO(b);let y=((i=b.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),w;return y==="application/json"?w=yield b.json():y==="application/octet-stream"||y==="application/pdf"?w=yield b.blob():y==="text/event-stream"?w=b:y==="multipart/form-data"?w=yield b.formData():w=yield b.text(),{data:w,error:null,response:b}}catch(a){return{data:null,error:a,response:a instanceof jO||a instanceof CO?a.context:void 0}}finally{s&&clearTimeout(s)}})}}var Ai={};const _f=FY(VY);var Ny={},Oy={},Ry={},Ay={},Iy={},Dy={},kO;function ZB(){if(kO)return Dy;kO=1,Object.defineProperty(Dy,"__esModule",{value:!0});class t extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}return Dy.default=t,Dy}var PO;function JB(){if(PO)return Iy;PO=1,Object.defineProperty(Iy,"__esModule",{value:!0});const e=_f.__importDefault(ZB());class n{constructor(i){var s,o;this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=new Headers(i.headers),this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=(s=i.shouldThrowOnError)!==null&&s!==void 0?s:!1,this.signal=i.signal,this.isMaybeSingle=(o=i.isMaybeSingle)!==null&&o!==void 0?o:!1,i.fetch?this.fetch=i.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,s){return this.headers=new Headers(this.headers),this.headers.set(i,s),this}then(i,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const o=this.fetch;let a=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var c,d,h,p;let f=null,m=null,g=null,v=l.status,b=l.statusText;if(l.ok){if(this.method!=="HEAD"){const E=await l.text();E===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((c=this.headers.get("Accept"))===null||c===void 0)&&c.includes("application/vnd.pgrst.plan+text"))?m=E:m=JSON.parse(E))}const y=(d=this.headers.get("Prefer"))===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),w=(h=l.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");y&&w&&w.length>1&&(g=parseInt(w[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(m)&&(m.length>1?(f={code:"PGRST116",details:`Results contain ${m.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},m=null,g=null,v=406,b="Not Acceptable"):m.length===1?m=m[0]:m=null)}else{const y=await l.text();try{f=JSON.parse(y),Array.isArray(f)&&l.status===404&&(m=[],f=null,v=200,b="OK")}catch{l.status===404&&y===""?(v=204,b="No Content"):f={message:y}}if(f&&this.isMaybeSingle&&(!((p=f==null?void 0:f.details)===null||p===void 0)&&p.includes("0 rows"))&&(f=null,v=200,b="OK"),f&&this.shouldThrowOnError)throw new e.default(f)}return{error:f,data:m,count:g,status:v,statusText:b}});return this.shouldThrowOnError||(a=a.catch(l=>{var c,d,h;return{error:{message:`${(c=l==null?void 0:l.name)!==null&&c!==void 0?c:"FetchError"}: ${l==null?void 0:l.message}`,details:`${(d=l==null?void 0:l.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(h=l==null?void 0:l.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),a.then(i,s)}returns(){return this}overrideTypes(){return this}}return Iy.default=n,Iy}var TO;function e4(){if(TO)return Ay;TO=1,Object.defineProperty(Ay,"__esModule",{value:!0});const e=_f.__importDefault(JB());class n extends e.default{select(i){let s=!1;const o=(i??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(i,{ascending:s=!0,nullsFirst:o,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",d=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${d?`${d},`:""}${i}.${s?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:s,referencedTable:o=s}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${i}`),this}range(i,s,{foreignTable:o,referencedTable:a=o}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${i}`),this.url.searchParams.set(c,`${s-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:i=!1,verbose:s=!1,settings:o=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var d;const h=[i?"analyze":null,s?"verbose":null,o?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),p=(d=this.headers.get("Accept"))!==null&&d!==void 0?d:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${c}; for="${p}"; options=${h};`),c==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(i){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${i}`),this}}return Ay.default=n,Ay}var NO;function Ik(){if(NO)return Ry;NO=1,Object.defineProperty(Ry,"__esModule",{value:!0});const e=_f.__importDefault(e4()),n=new RegExp("[,()]");class r extends e.default{eq(s,o){return this.url.searchParams.append(s,`eq.${o}`),this}neq(s,o){return this.url.searchParams.append(s,`neq.${o}`),this}gt(s,o){return this.url.searchParams.append(s,`gt.${o}`),this}gte(s,o){return this.url.searchParams.append(s,`gte.${o}`),this}lt(s,o){return this.url.searchParams.append(s,`lt.${o}`),this}lte(s,o){return this.url.searchParams.append(s,`lte.${o}`),this}like(s,o){return this.url.searchParams.append(s,`like.${o}`),this}likeAllOf(s,o){return this.url.searchParams.append(s,`like(all).{${o.join(",")}}`),this}likeAnyOf(s,o){return this.url.searchParams.append(s,`like(any).{${o.join(",")}}`),this}ilike(s,o){return this.url.searchParams.append(s,`ilike.${o}`),this}ilikeAllOf(s,o){return this.url.searchParams.append(s,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(s,o){return this.url.searchParams.append(s,`ilike(any).{${o.join(",")}}`),this}is(s,o){return this.url.searchParams.append(s,`is.${o}`),this}in(s,o){const a=Array.from(new Set(o)).map(l=>typeof l=="string"&&n.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(s,`in.(${a})`),this}contains(s,o){return typeof o=="string"?this.url.searchParams.append(s,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(s,`cs.{${o.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(o)}`),this}containedBy(s,o){return typeof o=="string"?this.url.searchParams.append(s,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(s,`cd.{${o.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(o)}`),this}rangeGt(s,o){return this.url.searchParams.append(s,`sr.${o}`),this}rangeGte(s,o){return this.url.searchParams.append(s,`nxl.${o}`),this}rangeLt(s,o){return this.url.searchParams.append(s,`sl.${o}`),this}rangeLte(s,o){return this.url.searchParams.append(s,`nxr.${o}`),this}rangeAdjacent(s,o){return this.url.searchParams.append(s,`adj.${o}`),this}overlaps(s,o){return typeof o=="string"?this.url.searchParams.append(s,`ov.${o}`):this.url.searchParams.append(s,`ov.{${o.join(",")}}`),this}textSearch(s,o,{config:a,type:l}={}){let c="";l==="plain"?c="pl":l==="phrase"?c="ph":l==="websearch"&&(c="w");const d=a===void 0?"":`(${a})`;return this.url.searchParams.append(s,`${c}fts${d}.${o}`),this}match(s){return Object.entries(s).forEach(([o,a])=>{this.url.searchParams.append(o,`eq.${a}`)}),this}not(s,o,a){return this.url.searchParams.append(s,`not.${o}.${a}`),this}or(s,{foreignTable:o,referencedTable:a=o}={}){const l=a?`${a}.or`:"or";return this.url.searchParams.append(l,`(${s})`),this}filter(s,o,a){return this.url.searchParams.append(s,`${o}.${a}`),this}}return Ry.default=r,Ry}var OO;function t4(){if(OO)return Oy;OO=1,Object.defineProperty(Oy,"__esModule",{value:!0});const e=_f.__importDefault(Ik());class n{constructor(i,{headers:s={},schema:o,fetch:a}){this.url=i,this.headers=new Headers(s),this.schema=o,this.fetch=a}select(i,s){const{head:o=!1,count:a}=s??{},l=o?"HEAD":"GET";let c=!1;const d=(i??"*").split("").map(h=>/\s/.test(h)&&!c?"":(h==='"'&&(c=!c),h)).join("");return this.url.searchParams.set("select",d),a&&this.headers.append("Prefer",`count=${a}`),new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(i,{count:s,defaultToNull:o=!0}={}){var a;const l="POST";if(s&&this.headers.append("Prefer",`count=${s}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const c=i.reduce((d,h)=>d.concat(Object.keys(h)),[]);if(c.length>0){const d=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",d.join(","))}}return new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(i,{onConflict:s,ignoreDuplicates:o=!1,count:a,defaultToNull:l=!0}={}){var c;const d="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),s!==void 0&&this.url.searchParams.set("on_conflict",s),a&&this.headers.append("Prefer",`count=${a}`),l||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const h=i.reduce((p,f)=>p.concat(Object.keys(f)),[]);if(h.length>0){const p=[...new Set(h)].map(f=>`"${f}"`);this.url.searchParams.set("columns",p.join(","))}}return new e.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}update(i,{count:s}={}){var o;const a="PATCH";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:i}={}){var s;const o="DELETE";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}}return Oy.default=n,Oy}var RO;function BX(){if(RO)return Ny;RO=1,Object.defineProperty(Ny,"__esModule",{value:!0});const t=_f,e=t.__importDefault(t4()),n=t.__importDefault(Ik());class r{constructor(s,{headers:o={},schema:a,fetch:l}={}){this.url=s,this.headers=new Headers(o),this.schemaName=a,this.fetch=l}from(s){const o=new URL(`${this.url}/${s}`);return new e.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(s){return new r(this.url,{headers:this.headers,schema:s,fetch:this.fetch})}rpc(s,o={},{head:a=!1,get:l=!1,count:c}={}){var d;let h;const p=new URL(`${this.url}/rpc/${s}`);let f;a||l?(h=a?"HEAD":"GET",Object.entries(o).filter(([g,v])=>v!==void 0).map(([g,v])=>[g,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([g,v])=>{p.searchParams.append(g,v)})):(h="POST",f=o);const m=new Headers(this.headers);return c&&m.set("Prefer",`count=${c}`),new n.default({method:h,url:p,headers:m,schema:this.schemaName,body:f,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}}return Ny.default=r,Ny}Object.defineProperty(Ai,"__esModule",{value:!0});var n4=Ai.PostgrestError=h4=Ai.PostgrestBuilder=u4=Ai.PostgrestTransformBuilder=l4=Ai.PostgrestFilterBuilder=o4=Ai.PostgrestQueryBuilder=i4=Ai.PostgrestClient=void 0;const Ef=_f,r4=Ef.__importDefault(BX());var i4=Ai.PostgrestClient=r4.default;const s4=Ef.__importDefault(t4());var o4=Ai.PostgrestQueryBuilder=s4.default;const a4=Ef.__importDefault(Ik());var l4=Ai.PostgrestFilterBuilder=a4.default;const c4=Ef.__importDefault(e4());var u4=Ai.PostgrestTransformBuilder=c4.default;const d4=Ef.__importDefault(JB());var h4=Ai.PostgrestBuilder=d4.default;const p4=Ef.__importDefault(ZB());n4=Ai.PostgrestError=p4.default;var f4=Ai.default={PostgrestClient:r4.default,PostgrestQueryBuilder:s4.default,PostgrestFilterBuilder:a4.default,PostgrestTransformBuilder:c4.default,PostgrestBuilder:d4.default,PostgrestError:p4.default};const FX=AX({__proto__:null,get PostgrestBuilder(){return h4},get PostgrestClient(){return i4},get PostgrestError(){return n4},get PostgrestFilterBuilder(){return l4},get PostgrestQueryBuilder(){return o4},get PostgrestTransformBuilder(){return u4},default:f4},[Ai]),{PostgrestClient:zX,PostgrestQueryBuilder:nMe,PostgrestFilterBuilder:rMe,PostgrestTransformBuilder:iMe,PostgrestBuilder:sMe,PostgrestError:oMe}=f4||FX;class HX{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const r=n.node,i=parseInt(r.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const UX="2.81.1",VX=`realtime-js/${UX}`,m4="1.0.0",qX="2.0.0",AO=m4,LS=1e4,WX=1e3,GX=100;var Zu;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Zu||(Zu={}));var Rr;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Rr||(Rr={}));var qs;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(qs||(qs={}));var BS;(function(t){t.websocket="websocket"})(BS||(BS={}));var Ju;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Ju||(Ju={}));class KX{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(e,n){if(this._isArrayBuffer(e.payload))return n(this._binaryEncodePush(e));if(e.event===this.BROADCAST&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(r))}_binaryEncodePush(e){const{join_ref:n,ref:r,event:i,topic:s,payload:o}=e,a=this.META_LENGTH+n.length+r.length+s.length+i.length,l=new ArrayBuffer(this.HEADER_LENGTH+a);let c=new DataView(l),d=0;c.setUint8(d++,this.KINDS.push),c.setUint8(d++,n.length),c.setUint8(d++,r.length),c.setUint8(d++,s.length),c.setUint8(d++,i.length),Array.from(n,p=>c.setUint8(d++,p.charCodeAt(0))),Array.from(r,p=>c.setUint8(d++,p.charCodeAt(0))),Array.from(s,p=>c.setUint8(d++,p.charCodeAt(0))),Array.from(i,p=>c.setUint8(d++,p.charCodeAt(0)));var h=new Uint8Array(l.byteLength+o.byteLength);return h.set(new Uint8Array(l),0),h.set(new Uint8Array(o),l.byteLength),h.buffer}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,r;const{join_ref:i,ref:s,topic:o}=e,a=e.payload.event,l=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:new ArrayBuffer(0),c=this.USER_BROADCAST_PUSH_META_LENGTH+i.length+s.length+o.length+a.length,d=new ArrayBuffer(this.HEADER_LENGTH+c);let h=new DataView(d),p=0;h.setUint8(p++,this.KINDS.userBroadcastPush),h.setUint8(p++,i.length),h.setUint8(p++,s.length),h.setUint8(p++,o.length),h.setUint8(p++,a.length),h.setUint8(p++,this.BINARY_ENCODING),Array.from(i,m=>h.setUint8(p++,m.charCodeAt(0))),Array.from(s,m=>h.setUint8(p++,m.charCodeAt(0))),Array.from(o,m=>h.setUint8(p++,m.charCodeAt(0))),Array.from(a,m=>h.setUint8(p++,m.charCodeAt(0)));var f=new Uint8Array(d.byteLength+l.byteLength);return f.set(new Uint8Array(d),0),f.set(new Uint8Array(l),d.byteLength),f.buffer}_encodeJsonUserBroadcastPush(e){var n,r;const{join_ref:i,ref:s,topic:o}=e,a=e.payload.event,l=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:{},d=new TextEncoder().encode(JSON.stringify(l)).buffer,h=this.USER_BROADCAST_PUSH_META_LENGTH+i.length+s.length+o.length+a.length,p=new ArrayBuffer(this.HEADER_LENGTH+h);let f=new DataView(p),m=0;f.setUint8(m++,this.KINDS.userBroadcastPush),f.setUint8(m++,i.length),f.setUint8(m++,s.length),f.setUint8(m++,o.length),f.setUint8(m++,a.length),f.setUint8(m++,this.JSON_ENCODING),Array.from(i,v=>f.setUint8(m++,v.charCodeAt(0))),Array.from(s,v=>f.setUint8(m++,v.charCodeAt(0))),Array.from(o,v=>f.setUint8(m++,v.charCodeAt(0))),Array.from(a,v=>f.setUint8(m++,v.charCodeAt(0)));var g=new Uint8Array(p.byteLength+d.byteLength);return g.set(new Uint8Array(p),0),g.set(new Uint8Array(d),p.byteLength),g.buffer}decode(e,n){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return n(r)}if(typeof e=="string"){const r=JSON.parse(e),[i,s,o,a,l]=r;return n({join_ref:i,ref:s,topic:o,event:a,payload:l})}return n({})}_binaryDecode(e){const n=new DataView(e),r=n.getUint8(0),i=new TextDecoder;switch(r){case this.KINDS.push:return this._decodePush(e,n,i);case this.KINDS.reply:return this._decodeReply(e,n,i);case this.KINDS.broadcast:return this._decodeBroadcast(e,n,i);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,i)}}_decodePush(e,n,r){const i=n.getUint8(1),s=n.getUint8(2),o=n.getUint8(3);let a=this.HEADER_LENGTH+this.META_LENGTH-1;const l=r.decode(e.slice(a,a+i));a=a+i;const c=r.decode(e.slice(a,a+s));a=a+s;const d=r.decode(e.slice(a,a+o));a=a+o;const h=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{join_ref:l,ref:null,topic:c,event:d,payload:h}}_decodeReply(e,n,r){const i=n.getUint8(1),s=n.getUint8(2),o=n.getUint8(3),a=n.getUint8(4);let l=this.HEADER_LENGTH+this.META_LENGTH;const c=r.decode(e.slice(l,l+i));l=l+i;const d=r.decode(e.slice(l,l+s));l=l+s;const h=r.decode(e.slice(l,l+o));l=l+o;const p=r.decode(e.slice(l,l+a));l=l+a;const f=JSON.parse(r.decode(e.slice(l,e.byteLength))),m={status:p,response:f};return{join_ref:c,ref:d,topic:h,event:qs.reply,payload:m}}_decodeBroadcast(e,n,r){const i=n.getUint8(1),s=n.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+i));o=o+i;const l=r.decode(e.slice(o,o+s));o=o+s;const c=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{join_ref:null,ref:null,topic:a,event:l,payload:c}}_decodeUserBroadcast(e,n,r){const i=n.getUint8(1),s=n.getUint8(2),o=n.getUint8(3),a=n.getUint8(4);let l=this.HEADER_LENGTH+4;const c=r.decode(e.slice(l,l+i));l=l+i;const d=r.decode(e.slice(l,l+s));l=l+s;const h=r.decode(e.slice(l,l+o));l=l+o;const p=e.slice(l,e.byteLength),f=a===this.JSON_ENCODING?JSON.parse(r.decode(p)):p,m={type:this.BROADCAST,event:d,payload:f};return o>0&&(m.meta=JSON.parse(h)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST,payload:m}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}}class g4{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Dn;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Dn||(Dn={}));const IO=(t,e,n={})=>{var r;const i=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((s,o)=>(s[o]=YX(o,t,e,i),s),{}):{}},YX=(t,e,n,r)=>{const i=e.find(a=>a.name===t),s=i==null?void 0:i.type,o=n[t];return s&&!r.includes(s)?v4(s,o):FS(o)},v4=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return JX(e,n)}switch(t){case Dn.bool:return XX(e);case Dn.float4:case Dn.float8:case Dn.int2:case Dn.int4:case Dn.int8:case Dn.numeric:case Dn.oid:return QX(e);case Dn.json:case Dn.jsonb:return ZX(e);case Dn.timestamp:return eQ(e);case Dn.abstime:case Dn.date:case Dn.daterange:case Dn.int4range:case Dn.int8range:case Dn.money:case Dn.reltime:case Dn.text:case Dn.time:case Dn.timestamptz:case Dn.timetz:case Dn.tsrange:case Dn.tstzrange:return FS(e);default:return FS(e)}},FS=t=>t,XX=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},QX=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},ZX=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},JX=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let s;const o=t.slice(1,n);try{s=JSON.parse("["+o+"]")}catch{s=o?o.split(","):[]}return s.map(a=>v4(e,a))}return t},eQ=t=>typeof t=="string"?t.replace(" ","T"):t,y4=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class B1{constructor(e,n,r={},i=LS){this.channel=e,this.event=n,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var DO;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(DO||(DO={}));class ng{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},i=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ng.syncState(this.state,i,s,o),this.pendingDiffs.forEach(l=>{this.state=ng.syncDiff(this.state,l,s,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},i=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=ng.syncDiff(this.state,i,s,o),a())}),this.onJoin((i,s,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:s,newPresences:o})}),this.onLeave((i,s,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,i){const s=this.cloneDeep(e),o=this.transformState(n),a={},l={};return this.map(s,(c,d)=>{o[c]||(l[c]=d)}),this.map(o,(c,d)=>{const h=s[c];if(h){const p=d.map(v=>v.presence_ref),f=h.map(v=>v.presence_ref),m=d.filter(v=>f.indexOf(v.presence_ref)<0),g=h.filter(v=>p.indexOf(v.presence_ref)<0);m.length>0&&(a[c]=m),g.length>0&&(l[c]=g)}else a[c]=d}),this.syncDiff(s,{joins:a,leaves:l},r,i)}static syncDiff(e,n,r,i){const{joins:s,leaves:o}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(s,(a,l)=>{var c;const d=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),d.length>0){const h=e[a].map(f=>f.presence_ref),p=d.filter(f=>h.indexOf(f.presence_ref)<0);e[a].unshift(...p)}r(a,d,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const d=l.map(h=>h.presence_ref);c=c.filter(h=>d.indexOf(h.presence_ref)<0),e[a]=c,i(a,c,l),c.length===0&&delete e[a]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const i=e[r];return"metas"in i?n[r]=i.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):n[r]=i,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var $O;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})($O||($O={}));var rg;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(rg||(rg={}));var ol;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(ol||(ol={}));class Dk{constructor(e,n={config:{}},r){var i,s;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=Rr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new B1(this,qs.join,this.params,this.timeout),this.rejoinTimer=new g4(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Rr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Rr.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Rr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Rr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Rr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(qs.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new ng(this),this.broadcastEndpointURL=y4(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((s=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||s===void 0)&&s.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,i,s;if(this.socket.isConnected()||this.socket.connect(),this.state==Rr.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(i=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(f=>f.filter))!==null&&i!==void 0?i:[],d=!!this.bindings[rg.PRESENCE]&&this.bindings[rg.PRESENCE].length>0||((s=this.params.config.presence)===null||s===void 0?void 0:s.enabled)===!0,h={},p={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:d}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(f=>e==null?void 0:e(ol.CHANNEL_ERROR,f)),this._onClose(()=>e==null?void 0:e(ol.CLOSED)),this.updateJoinPayload(Object.assign({config:p},h)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:f})=>{var m;if(this.socket.setAuth(),f===void 0){e==null||e(ol.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,v=(m=g==null?void 0:g.length)!==null&&m!==void 0?m:0,b=[];for(let x=0;x<v;x++){const y=g[x],{filter:{event:w,schema:E,table:S,filter:j}}=y,C=f&&f[x];if(C&&C.event===w&&C.schema===E&&C.table===S&&C.filter===j)b.push(Object.assign(Object.assign({},y),{id:C.id}));else{this.unsubscribe(),this.state=Rr.errored,e==null||e(ol.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=b,e&&e(ol.SUBSCRIBED);return}}).receive("error",f=>{this.state=Rr.errored,e==null||e(ol.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(ol.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===Rr.joined&&e===rg.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var i;const s=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(n==null)return Promise.reject("Payload is required for httpSend()");const o={method:"POST",headers:{Authorization:s,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(i=r.timeout)!==null&&i!==void 0?i:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const c=await a.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(e,n={}){var r,i;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:s,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((i=c.body)===null||i===void 0?void 0:i.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var o,a,l;const c=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Rr.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(qs.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(i=>{r=new B1(this,qs.leave,{},e),r.receive("ok",()=>{n(),i("ok")}).receive("timeout",()=>{n(),i("timed out")}).receive("error",()=>{i("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Rr.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const i=new AbortController,s=setTimeout(()=>i.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:i.signal}));return clearTimeout(s),o}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new B1(this,e,n,r);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>GX){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var i,s;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:d}=qs;if(r&&[a,l,c,d].indexOf(o)>=0&&r!==this._joinRef())return;let p=this._onMessage(o,n,r);if(n&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(f=>{var m,g,v;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((v=(g=f.filter)===null||g===void 0?void 0:g.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===o}).map(f=>f.callback(p,r)):(s=this.bindings[o])===null||s===void 0||s.filter(f=>{var m,g,v,b,x,y;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const w=f.id,E=(m=f.filter)===null||m===void 0?void 0:m.event;return w&&((g=n.ids)===null||g===void 0?void 0:g.includes(w))&&(E==="*"||(E==null?void 0:E.toLocaleLowerCase())===((v=n.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const w=(x=(b=f==null?void 0:f.filter)===null||b===void 0?void 0:b.event)===null||x===void 0?void 0:x.toLocaleLowerCase();return w==="*"||w===((y=n==null?void 0:n.event)===null||y===void 0?void 0:y.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof p=="object"&&"ids"in p){const m=p.data,{schema:g,table:v,commit_timestamp:b,type:x,errors:y}=m;p=Object.assign(Object.assign({},{schema:g,table:v,commit_timestamp:b,eventType:x,new:{},old:{},errors:y}),this._getPayloadRecords(m))}f.callback(p,r)})}_isClosed(){return this.state===Rr.closed}_isJoined(){return this.state===Rr.joined}_isJoining(){return this.state===Rr.joining}_isLeaving(){return this.state===Rr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const i=e.toLocaleLowerCase(),s={type:i,filter:n,callback:r};return this.bindings[i]?this.bindings[i].push(s):this.bindings[i]=[s],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(i=>{var s;return!(((s=i.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===r&&Dk.isEqual(i.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(qs.close,{},e)}_onError(e){this._on(qs.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Rr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=IO(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=IO(e.columns,e.old_record)),n}}const F1=()=>{},$y={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},tQ=[1e3,2e3,5e3,1e4],nQ=1e4,rQ=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class iQ{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=LS,this.transport=null,this.heartbeatIntervalMs=$y.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=F1,this.ref=0,this.reconnectTimer=null,this.vsn=AO,this.logger=F1,this.conn=null,this.sendBuffer=[],this.serializer=new KX,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>i?(...s)=>i(...s):(...s)=>fetch(...s),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${BS.websocket}`,this.httpEndpoint=y4(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=HX.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Zu.connecting:return Ju.Connecting;case Zu.open:return Ju.Open;case Zu.closing:return Ju.Closing;default:return Ju.Closed}}isConnected(){return this.connectionState()===Ju.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,i=this.getChannels().find(s=>s.topic===r);if(i)return i;{const s=new Dk(`realtime:${e}`,n,this);return this.channels.push(s),s}}push(e){const{topic:n,event:r,payload:i,ref:s}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${n} ${r} (${s})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(WX,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},$y.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:i,payload:s,ref:o}=n,a=o?`(${o})`:"",l=s.status||"";this.log("receive",`${l} ${r} ${i} ${a}`.trim(),s),this.channels.filter(c=>c._isMember(r)).forEach(c=>c._trigger(i,s,o)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===Zu.open||this.conn.readyState===Zu.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(qs.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",i=new URLSearchParams(n);return`${e}${r}${i}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([rQ],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n;e?n=e:this.accessToken?n=await this.accessToken():n=this.accessTokenValue,this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const i={access_token:n,version:VX};n&&r.updateJoinPayload(i),r.joinedOnce&&r._isJoined()&&r._push(qs.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(n=>{this.log("error",`error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new g4(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},$y.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,i,s,o,a,l,c,d,h,p,f;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:LS,this.heartbeatIntervalMs=(i=e==null?void 0:e.heartbeatIntervalMs)!==null&&i!==void 0?i:$y.HEARTBEAT_INTERVAL,this.worker=(s=e==null?void 0:e.worker)!==null&&s!==void 0?s:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:F1,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:AO,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:m=>tQ[m-1]||nQ,this.vsn){case m4:this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:(m,g)=>g(JSON.stringify(m)),this.decode=(h=e==null?void 0:e.decode)!==null&&h!==void 0?h:(m,g)=>g(JSON.parse(m));break;case qX:this.encode=(p=e==null?void 0:e.encode)!==null&&p!==void 0?p:this.serializer.encode.bind(this.serializer),this.decode=(f=e==null?void 0:e.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class $k extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function tr(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class sQ extends $k{constructor(e,n,r){super(e),this.name="StorageApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class zS extends $k{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}}const Mk=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),oQ=()=>Response,HS=t=>{if(Array.isArray(t))return t.map(n=>HS(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const i=n.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[i]=HS(r)}),e},aQ=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},z1=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},lQ=(t,e,n)=>rt(void 0,void 0,void 0,function*(){const r=yield oQ();t instanceof r&&!(n!=null&&n.noResolveJson)?t.json().then(i=>{const s=t.status||500,o=(i==null?void 0:i.statusCode)||s+"";e(new sQ(z1(i),s,o))}).catch(i=>{e(new zS(z1(i),i))}):e(new zS(z1(t),t))}),cQ=(t,e,n,r)=>{const i={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?i:(aQ(r)?(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(r)):i.body=r,e!=null&&e.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),n))};function yv(t,e,n,r,i,s){return rt(this,void 0,void 0,function*(){return new Promise((o,a)=>{t(n,cQ(e,r,i,s)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>lQ(l,a,r))})})}function Ng(t,e,n,r){return rt(this,void 0,void 0,function*(){return yv(t,"GET",e,n,r)})}function To(t,e,n,r,i){return rt(this,void 0,void 0,function*(){return yv(t,"POST",e,r,i,n)})}function US(t,e,n,r,i){return rt(this,void 0,void 0,function*(){return yv(t,"PUT",e,r,i,n)})}function uQ(t,e,n,r){return rt(this,void 0,void 0,function*(){return yv(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}function Lk(t,e,n,r,i){return rt(this,void 0,void 0,function*(){return yv(t,"DELETE",e,r,i,n)})}class dQ{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n}then(e,n){return this.execute().then(e,n)}execute(){return rt(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(tr(e))return{data:null,error:e};throw e}})}}var x4;class hQ{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n,this[x4]="BlobDownloadBuilder",this.promise=null}asStream(){return new dQ(this.downloadFn,this.shouldThrowOnError)}then(e,n){return this.getPromise().then(e,n)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return rt(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(tr(e))return{data:null,error:e};throw e}})}}x4=Symbol.toStringTag;const pQ={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},MO={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class fQ{constructor(e,n={},r,i){this.shouldThrowOnError=!1,this.url=e,this.headers=n,this.bucketId=r,this.fetch=Mk(i)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,n,r,i){return rt(this,void 0,void 0,function*(){try{let s;const o=Object.assign(Object.assign({},MO),i);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),l&&s.append("metadata",this.encodeMetadata(l)),s.append("",r)):typeof FormData<"u"&&r instanceof FormData?(s=r,s.has("cacheControl")||s.append("cacheControl",o.cacheControl),l&&!s.has("metadata")&&s.append("metadata",this.encodeMetadata(l))):(s=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l))),(typeof ReadableStream<"u"&&s instanceof ReadableStream||s&&typeof s=="object"&&"pipe"in s&&typeof s.pipe=="function")&&!o.duplex&&(o.duplex="half")),i!=null&&i.headers&&(a=Object.assign(Object.assign({},a),i.headers));const c=this._removeEmptyFolders(n),d=this._getFinalPath(c),h=yield(e=="PUT"?US:To)(this.fetch,`${this.url}/object/${d}`,s,Object.assign({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:c,id:h.Id,fullPath:h.Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(tr(s))return{data:null,error:s};throw s}})}upload(e,n,r){return rt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,r)})}uploadToSignedUrl(e,n,r,i){return rt(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),o=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",n);try{let l;const c=Object.assign({upsert:MO.upsert},i),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,d["cache-control"]=`max-age=${c.cacheControl}`,d["content-type"]=c.contentType);const h=yield US(this.fetch,a.toString(),l,{headers:d});return{data:{path:s,fullPath:h.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(tr(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,n){return rt(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const i=Object.assign({},this.headers);n!=null&&n.upsert&&(i["x-upsert"]="true");const s=yield To(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:i}),o=new URL(this.url+s.url),a=o.searchParams.get("token");if(!a)throw new $k("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(tr(r))return{data:null,error:r};throw r}})}update(e,n,r){return rt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,r)})}move(e,n,r){return rt(this,void 0,void 0,function*(){try{return{data:yield To(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(tr(i))return{data:null,error:i};throw i}})}copy(e,n,r){return rt(this,void 0,void 0,function*(){try{return{data:{path:(yield To(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(tr(i))return{data:null,error:i};throw i}})}createSignedUrl(e,n,r){return rt(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),s=yield To(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:n},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(tr(i))return{data:null,error:i};throw i}})}createSignedUrls(e,n,r){return rt(this,void 0,void 0,function*(){try{const i=yield To(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),s=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:i.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${s}`):null})),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(tr(i))return{data:null,error:i};throw i}})}download(e,n){const i=typeof(n==null?void 0:n.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((n==null?void 0:n.transform)||{}),o=s?`?${s}`:"",a=this._getFinalPath(e),l=()=>Ng(this.fetch,`${this.url}/${i}/${a}${o}`,{headers:this.headers,noResolveJson:!0});return new hQ(l,this.shouldThrowOnError)}info(e){return rt(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{const r=yield Ng(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:HS(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(tr(r))return{data:null,error:r};throw r}})}exists(e){return rt(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{return yield uQ(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(tr(r)&&r instanceof zS){const i=r.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,n){const r=this._getFinalPath(e),i=[],s=n!=null&&n.download?`download=${n.download===!0?"":n.download}`:"";s!==""&&i.push(s);const a=typeof(n==null?void 0:n.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((n==null?void 0:n.transform)||{});l!==""&&i.push(l);let c=i.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return rt(this,void 0,void 0,function*(){try{return{data:yield Lk(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(tr(n))return{data:null,error:n};throw n}})}list(e,n,r){return rt(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},pQ),n),{prefix:e||""});return{data:yield To(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},r),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(tr(i))return{data:null,error:i};throw i}})}listV2(e,n){return rt(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield To(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},n),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(tr(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}}const b4="2.81.1",w4={"X-Client-Info":`storage-js/${b4}`};class mQ{constructor(e,n={},r,i){this.shouldThrowOnError=!1;const s=new URL(e);i!=null&&i.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},w4),n),this.fetch=Mk(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return rt(this,void 0,void 0,function*(){try{const n=this.listBucketOptionsToQueryString(e);return{data:yield Ng(this.fetch,`${this.url}/bucket${n}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(tr(n))return{data:null,error:n};throw n}})}getBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:yield Ng(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(tr(n))return{data:null,error:n};throw n}})}createBucket(e){return rt(this,arguments,void 0,function*(n,r={public:!1}){try{return{data:yield To(this.fetch,`${this.url}/bucket`,{id:n,name:n,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(tr(i))return{data:null,error:i};throw i}})}updateBucket(e,n){return rt(this,void 0,void 0,function*(){try{return{data:yield US(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(tr(r))return{data:null,error:r};throw r}})}emptyBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:yield To(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(tr(n))return{data:null,error:n};throw n}})}deleteBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:yield Lk(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(tr(n))return{data:null,error:n};throw n}})}listBucketOptionsToQueryString(e){const n={};return e&&("limit"in e&&(n.limit=String(e.limit)),"offset"in e&&(n.offset=String(e.offset)),e.search&&(n.search=e.search),e.sortColumn&&(n.sortColumn=e.sortColumn),e.sortOrder&&(n.sortOrder=e.sortOrder)),Object.keys(n).length>0?"?"+new URLSearchParams(n).toString():""}}class gQ{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},w4),n),this.fetch=Mk(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:yield To(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(tr(n))return{data:null,error:n};throw n}})}listBuckets(e){return rt(this,void 0,void 0,function*(){try{const n=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&n.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&n.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&n.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&n.set("sortOrder",e.sortOrder),e!=null&&e.search&&n.set("search",e.search);const r=n.toString(),i=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield Ng(this.fetch,i,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(tr(n))return{data:null,error:n};throw n}})}deleteBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:yield Lk(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(tr(n))return{data:null,error:n};throw n}})}}const Bk={"X-Client-Info":`storage-js/${b4}`,"Content-Type":"application/json"};class _4 extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function _s(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}class H1 extends _4{constructor(e,n,r){super(e),this.name="StorageVectorsApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class vQ extends _4{constructor(e,n){super(e),this.name="StorageVectorsUnknownError",this.originalError=n}}var LO;(function(t){t.InternalError="InternalError",t.S3VectorConflictException="S3VectorConflictException",t.S3VectorNotFoundException="S3VectorNotFoundException",t.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",t.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",t.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(LO||(LO={}));const Fk=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),yQ=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},BO=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),xQ=(t,e,n)=>rt(void 0,void 0,void 0,function*(){if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const i=t.status||500,s=t;if(typeof s.json=="function")s.json().then(o=>{const a=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||i+"";e(new H1(BO(o),i,a))}).catch(()=>{const o=i+"",a=s.statusText||`HTTP ${i} error`;e(new H1(a,i,o))});else{const o=i+"",a=s.statusText||`HTTP ${i} error`;e(new H1(a,i,o))}}else e(new vQ(BO(t),t))}),bQ=(t,e,n,r)=>{const i={method:t,headers:(e==null?void 0:e.headers)||{}};return r?(yQ(r)?(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(r)):i.body=r,Object.assign(Object.assign({},i),n)):i};function wQ(t,e,n,r,i,s){return rt(this,void 0,void 0,function*(){return new Promise((o,a)=>{t(n,bQ(e,r,i,s)).then(l=>{if(!l.ok)throw l;if(r!=null&&r.noResolveJson)return l;const c=l.headers.get("content-type");return!c||!c.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>xQ(l,a,r))})})}function Es(t,e,n,r,i){return rt(this,void 0,void 0,function*(){return wQ(t,"POST",e,r,i,n)})}class _Q{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Bk),n),this.fetch=Fk(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return rt(this,void 0,void 0,function*(){try{return{data:(yield Es(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(_s(n))return{data:null,error:n};throw n}})}getIndex(e,n){return rt(this,void 0,void 0,function*(){try{return{data:yield Es(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(_s(r))return{data:null,error:r};throw r}})}listIndexes(e){return rt(this,void 0,void 0,function*(){try{return{data:yield Es(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(_s(n))return{data:null,error:n};throw n}})}deleteIndex(e,n){return rt(this,void 0,void 0,function*(){try{return{data:(yield Es(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(_s(r))return{data:null,error:r};throw r}})}}class EQ{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Bk),n),this.fetch=Fk(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return rt(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield Es(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(_s(n))return{data:null,error:n};throw n}})}getVectors(e){return rt(this,void 0,void 0,function*(){try{return{data:yield Es(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(_s(n))return{data:null,error:n};throw n}})}listVectors(e){return rt(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield Es(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(_s(n))return{data:null,error:n};throw n}})}queryVectors(e){return rt(this,void 0,void 0,function*(){try{return{data:yield Es(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(_s(n))return{data:null,error:n};throw n}})}deleteVectors(e){return rt(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield Es(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(_s(n))return{data:null,error:n};throw n}})}}class SQ{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Bk),n),this.fetch=Fk(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:(yield Es(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(_s(n))return{data:null,error:n};throw n}})}getBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:yield Es(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(_s(n))return{data:null,error:n};throw n}})}listBuckets(){return rt(this,arguments,void 0,function*(e={}){try{return{data:yield Es(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(_s(n))return{data:null,error:n};throw n}})}deleteBucket(e){return rt(this,void 0,void 0,function*(){try{return{data:(yield Es(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(_s(n))return{data:null,error:n};throw n}})}}class CQ extends SQ{constructor(e,n={}){super(e,n.headers||{},n.fetch)}from(e){return new jQ(this.url,this.headers,e,this.fetch)}}class jQ extends _Q{constructor(e,n,r,i){super(e,n,i),this.vectorBucketName=r}createIndex(e){const n=Object.create(null,{createIndex:{get:()=>super.createIndex}});return rt(this,void 0,void 0,function*(){return n.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return rt(this,arguments,void 0,function*(n={}){return e.listIndexes.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const n=Object.create(null,{getIndex:{get:()=>super.getIndex}});return rt(this,void 0,void 0,function*(){return n.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const n=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return rt(this,void 0,void 0,function*(){return n.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new kQ(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class kQ extends EQ{constructor(e,n,r,i,s){super(e,n,s),this.vectorBucketName=r,this.indexName=i}putVectors(e){const n=Object.create(null,{putVectors:{get:()=>super.putVectors}});return rt(this,void 0,void 0,function*(){return n.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const n=Object.create(null,{getVectors:{get:()=>super.getVectors}});return rt(this,void 0,void 0,function*(){return n.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return rt(this,arguments,void 0,function*(n={}){return e.listVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const n=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return rt(this,void 0,void 0,function*(){return n.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const n=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return rt(this,void 0,void 0,function*(){return n.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class PQ extends mQ{constructor(e,n={},r,i){super(e,n,r,i)}from(e){return new fQ(this.url,this.headers,e,this.fetch)}get vectors(){return new CQ(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new gQ(this.url+"/iceberg",this.headers,this.fetch)}}const TQ="2.81.1";let Um="";typeof Deno<"u"?Um="deno":typeof document<"u"?Um="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Um="react-native":Um="node";const NQ={"X-Client-Info":`supabase-js-${Um}/${TQ}`},OQ={headers:NQ},RQ={schema:"public"},AQ={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},IQ={},DQ=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),$Q=()=>Headers,MQ=(t,e,n)=>{const r=DQ(n),i=$Q();return async(s,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:t;let c=new i(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(s,Object.assign(Object.assign({},o),{headers:c}))}};function LQ(t){return t.endsWith("/")?t:t+"/"}function BQ(t,e){var n,r;const{db:i,auth:s,realtime:o,global:a}=t,{db:l,auth:c,realtime:d,global:h}=e,p={db:Object.assign(Object.assign({},l),i),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},d),o),storage:{},global:Object.assign(Object.assign(Object.assign({},h),a),{headers:Object.assign(Object.assign({},(n=h==null?void 0:h.headers)!==null&&n!==void 0?n:{}),(r=a==null?void 0:a.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?p.accessToken=t.accessToken:delete p.accessToken,p}function FQ(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(LQ(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const E4="2.81.1",qh=30*1e3,VS=3,U1=VS*qh,zQ="http://localhost:9999",HQ="supabase.auth.token",UQ={"X-Client-Info":`gotrue-js/${E4}`},qS="X-Supabase-Api-Version",S4={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},VQ=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,qQ=10*60*1e3;class Og extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function ot(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class WQ extends Og{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function GQ(t){return ot(t)&&t.name==="AuthApiError"}class ed extends Og{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class Xc extends Og{constructor(e,n,r,i){super(e,r,i),this.name=n,this.status=r}}class So extends Xc{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function KQ(t){return ot(t)&&t.name==="AuthSessionMissingError"}class jh extends Xc{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class My extends Xc{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ly extends Xc{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function YQ(t){return ot(t)&&t.name==="AuthImplicitGrantRedirectError"}class FO extends Xc{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class WS extends Xc{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function V1(t){return ot(t)&&t.name==="AuthRetryableFetchError"}class zO extends Xc{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class GS extends Xc{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Yb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),HO=` 	
\r=`.split(""),XQ=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<HO.length;e+=1)t[HO[e].charCodeAt(0)]=-2;for(let e=0;e<Yb.length;e+=1)t[Yb[e].charCodeAt(0)]=e;return t})();function UO(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(Yb[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(Yb[r]),e.queuedBits-=6}}function C4(t,e,n){const r=XQ[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function VO(t){const e=[],n=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},s=o=>{JQ(o,r,n)};for(let o=0;o<t.length;o+=1)C4(t.charCodeAt(o),i,s);return e.join("")}function QQ(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function ZQ(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const i=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|i)+65536,n+=1}QQ(r,e)}}function JQ(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if(!(t>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function up(t){const e=[],n={queue:0,queuedBits:0},r=i=>{e.push(i)};for(let i=0;i<t.length;i+=1)C4(t.charCodeAt(i),n,r);return new Uint8Array(e)}function eZ(t){const e=[];return ZQ(t,n=>e.push(n)),new Uint8Array(e)}function id(t){const e=[],n={queue:0,queuedBits:0},r=i=>{e.push(i)};return t.forEach(i=>UO(i,n,r)),UO(null,n,r),e.join("")}function tZ(t){return Math.round(Date.now()/1e3)+t}function nZ(){return Symbol("auth-callback")}const ri=()=>typeof window<"u"&&typeof document<"u",Au={tested:!1,writable:!1},j4=()=>{if(!ri())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Au.tested)return Au.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Au.tested=!0,Au.writable=!0}catch{Au.tested=!0,Au.writable=!1}return Au.writable};function rZ(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((i,s)=>{e[s]=i})}catch{}return n.searchParams.forEach((r,i)=>{e[i]=r}),e}const k4=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),iZ=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Wh=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},Iu=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},nc=async(t,e)=>{await t.removeItem(e)};class gw{constructor(){this.promise=new gw.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}gw.promiseConstructor=Promise;function q1(t){const e=t.split(".");if(e.length!==3)throw new GS("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!VQ.test(e[r]))throw new GS("JWT not in base64url format");return{header:JSON.parse(VO(e[0])),payload:JSON.parse(VO(e[1])),signature:up(e[2]),raw:{header:e[0],payload:e[1]}}}async function sZ(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function oZ(t,e){return new Promise((r,i)=>{(async()=>{for(let s=0;s<1/0;s++)try{const o=await t(s);if(!e(s,null,o)){r(o);return}}catch(o){if(!e(s,o)){i(o);return}}})()})}function aZ(t){return("0"+t.toString(16)).substr(-2)}function lZ(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let i="";for(let s=0;s<56;s++)i+=n.charAt(Math.floor(Math.random()*r));return i}return crypto.getRandomValues(e),Array.from(e,aZ).join("")}async function cZ(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),i=new Uint8Array(r);return Array.from(i).map(s=>String.fromCharCode(s)).join("")}async function uZ(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await cZ(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function kh(t,e,n=!1){const r=lZ();let i=r;n&&(i+="/PASSWORD_RECOVERY"),await Wh(t,`${e}-code-verifier`,i);const s=await uZ(r);return[s,r===s?"plain":"s256"]}const dZ=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function hZ(t){const e=t.headers.get(qS);if(!e||!e.match(dZ))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function pZ(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function fZ(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const mZ=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ph(t){if(!mZ.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function W1(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function gZ(t,e){return new Proxy(t,{get:(n,r,i)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const s=r.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)"||s==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,i)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,i)}})}function qO(t){return JSON.parse(JSON.stringify(t))}const Wu=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),vZ=[502,503,504];async function WO(t){var e;if(!iZ(t))throw new WS(Wu(t),0);if(vZ.includes(t.status))throw new WS(Wu(t),t.status);let n;try{n=await t.json()}catch(s){throw new ed(Wu(s),s)}let r;const i=hZ(t);if(i&&i.getTime()>=S4["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new zO(Wu(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new So}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((s,o)=>s&&typeof o=="string",!0))throw new zO(Wu(n),t.status,n.weak_password.reasons);throw new WQ(Wu(n),t.status||500,r)}const yZ=(t,e,n,r)=>{const i={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),n))};async function St(t,e,n,r){var i;const s=Object.assign({},r==null?void 0:r.headers);s[qS]||(s[qS]=S4["2024-01-01"].name),r!=null&&r.jwt&&(s.Authorization=`Bearer ${r.jwt}`);const o=(i=r==null?void 0:r.query)!==null&&i!==void 0?i:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await xZ(t,e,n+a,{headers:s,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function xZ(t,e,n,r,i,s){const o=yZ(e,r,i,s);let a;try{a=await t(n,Object.assign({},o))}catch(l){throw console.error(l),new WS(Wu(l),0)}if(a.ok||await WO(a),r!=null&&r.noResolveJson)return a;try{return await a.json()}catch(l){await WO(l)}}function Co(t){var e;let n=null;_Z(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=tZ(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function GO(t){const e=Co(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function _c(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function bZ(t){return{data:t,error:null}}function wZ(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:i,verification_type:s}=t,o=lw(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:n,hashed_token:r,redirect_to:i,verification_type:s},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function KO(t){return t}function _Z(t){return t.access_token&&t.refresh_token&&t.expires_in}const G1=["global","local","others"];class EZ{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=k4(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=G1[0]){if(G1.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${G1.join(", ")}`);try{return await St(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ot(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await St(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:_c})}catch(r){if(ot(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=lw(e,["options"]),i=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(i.new_email=r==null?void 0:r.newEmail,delete i.newEmail),await St(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:wZ,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(ot(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await St(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:_c})}catch(n){if(ot(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,i,s,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},d=await St(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(s=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""},xform:KO});if(d.error)throw d.error;const h=await d.json(),p=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(m=>{const g=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(m.split(";")[1].split("=")[1]);c[`${v}Page`]=g}),c.total=parseInt(p)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(ot(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Ph(e);try{return await St(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:_c})}catch(n){if(ot(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){Ph(e);try{return await St(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:_c})}catch(r){if(ot(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){Ph(e);try{return await St(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:_c})}catch(r){if(ot(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Ph(e.userId);try{const{data:n,error:r}=await St(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:n,error:r}}catch(n){if(ot(n))return{data:null,error:n};throw n}}async _deleteFactor(e){Ph(e.userId),Ph(e.id);try{return{data:await St(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(ot(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,i,s,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},d=await St(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(s=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""},xform:KO});if(d.error)throw d.error;const h=await d.json(),p=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(m=>{const g=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(m.split(";")[1].split("=")[1]);c[`${v}Page`]=g}),c.total=parseInt(p)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(ot(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await St(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(ot(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await St(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(ot(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await St(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ot(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await St(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(ot(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await St(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(ot(n))return{data:null,error:n};throw n}}}function YO(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const Th={debug:!!(globalThis&&j4()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class P4 extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class SZ extends P4{}async function CZ(t,e,n){Th.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Th.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async i=>{if(i){Th.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,i.name);try{return await n()}finally{Th.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,i.name)}}else{if(e===0)throw Th.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new SZ(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Th.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function jZ(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function T4(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function kZ(t){return parseInt(t,16)}function PZ(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function TZ(t){var e;const{chainId:n,domain:r,expirationTime:i,issuedAt:s=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:d,uri:h,version:p}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(p!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${p}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const f=T4(t.address),m=d?`${d}://${r}`:r,g=t.statement?`${t.statement}
`:"",v=`${m} wants you to sign in with your Ethereum account:
${f}

${g}`;let b=`URI: ${h}
Version: ${p}
Chain ID: ${n}${o?`
Nonce: ${o}`:""}
Issued At: ${s.toISOString()}`;if(i&&(b+=`
Expiration Time: ${i.toISOString()}`),a&&(b+=`
Not Before: ${a.toISOString()}`),l&&(b+=`
Request ID: ${l}`),c){let x=`
Resources:`;for(const y of c){if(!y||typeof y!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${y}`);x+=`
- ${y}`}b+=x}return`${v}
${b}`}class Sr extends Error{constructor({message:e,code:n,cause:r,name:i}){var s;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(s=i??(r instanceof Error?r.name:void 0))!==null&&s!==void 0?s:"Unknown Error",this.code=n}}class Xb extends Sr{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function NZ({error:t,options:e}){var n,r,i;const{publicKey:s}=e;if(!s)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Sr({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=s.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new Sr({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=s.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new Sr({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((i=s.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new Sr({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new Sr({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new Sr({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return s.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new Sr({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new Sr({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const o=window.location.hostname;if(N4(o)){if(s.rp.id!==o)return new Sr({message:`The RP ID "${s.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Sr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(s.user.id.byteLength<1||s.user.id.byteLength>64)return new Sr({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new Sr({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Sr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function OZ({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Sr({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new Sr({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(N4(r)){if(n.rpId!==r)return new Sr({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Sr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new Sr({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Sr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class RZ{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const AZ=new RZ;function IZ(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,i=lw(t,["challenge","user","excludeCredentials"]),s=up(e).buffer,o=Object.assign(Object.assign({},n),{id:up(n.id).buffer}),a=Object.assign(Object.assign({},i),{challenge:s,user:o});if(r&&r.length>0){a.excludeCredentials=new Array(r.length);for(let l=0;l<r.length;l++){const c=r[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:up(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function DZ(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=lw(t,["challenge","allowCredentials"]),i=up(e).buffer,s=Object.assign(Object.assign({},r),{challenge:i});if(n&&n.length>0){s.allowCredentials=new Array(n.length);for(let o=0;o<n.length;o++){const a=n[o];s.allowCredentials[o]=Object.assign(Object.assign({},a),{id:up(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return s}function $Z(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:id(new Uint8Array(t.response.attestationObject)),clientDataJSON:id(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function MZ(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),i=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:id(new Uint8Array(i.authenticatorData)),clientDataJSON:id(new Uint8Array(i.clientDataJSON)),signature:id(new Uint8Array(i.signature)),userHandle:i.userHandle?id(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function N4(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function XO(){var t,e;return!!(ri()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function LZ(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Xb("Browser returned unexpected credential type",e)}:{data:null,error:new Xb("Empty credential response",e)}}catch(e){return{data:null,error:NZ({error:e,options:t})}}}async function BZ(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Xb("Browser returned unexpected credential type",e)}:{data:null,error:new Xb("Empty credential response",e)}}catch(e){return{data:null,error:OZ({error:e,options:t})}}}const FZ={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},zZ={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Qb(...t){const e=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),n=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),r={};for(const i of t)if(i)for(const s in i){const o=i[s];if(o!==void 0)if(Array.isArray(o))r[s]=o;else if(n(o))r[s]=o;else if(e(o)){const a=r[s];e(a)?r[s]=Qb(a,o):r[s]=Qb(o)}else r[s]=o}return r}function HZ(t,e){return Qb(FZ,t,e||{})}function UZ(t,e){return Qb(zZ,t,e||{})}class VZ{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:i},s){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!o)return{data:null,error:a};const l=i??AZ.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:c}=o.webauthn.credential_options.publicKey;c.name||(c.name=`${c.id}:${r}`),c.displayName||(c.displayName=c.name)}switch(o.webauthn.type){case"create":{const c=HZ(o.webauthn.credential_options.publicKey,s==null?void 0:s.create),{data:d,error:h}=await LZ({publicKey:c,signal:l});return d?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:h}}case"request":{const c=UZ(o.webauthn.credential_options.publicKey,s==null?void 0:s.request),{data:d,error:h}=await BZ(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:c,signal:l}));return d?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:h}}}}catch(o){return ot(o)?{data:null,error:o}:{data:null,error:new ed("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},s){if(!n)return{data:null,error:new Og("rpId is required for WebAuthn authentication")};try{if(!XO())return{data:null,error:new ed("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:i},{request:s});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:n,rpOrigins:r,credential_response:l.credential_response}})}catch(o){return ot(o)?{data:null,error:o}:{data:null,error:new ed("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},s){if(!n)return{data:null,error:new Og("rpId is required for WebAuthn registration")};try{if(!XO())return{data:null,error:new ed("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(d=>{var h;return(h=d.data)===null||h===void 0?void 0:h.all.find(p=>p.factor_type==="webauthn"&&p.friendly_name===e&&p.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:i},{create:s});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:n,rpOrigins:r,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(o){return ot(o)?{data:null,error:o}:{data:null,error:new ed("Unexpected error in register",o)}}}}jZ();const qZ={url:zQ,storageKey:HQ,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:UQ,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function QO(t,e,n){return await n()}const Nh={};class Rg{get jwks(){var e,n;return(n=(e=Nh[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){Nh[this.storageKey]=Object.assign(Object.assign({},Nh[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=Nh[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Nh[this.storageKey]=Object.assign(Object.assign({},Nh[this.storageKey]),{cachedAt:e})}constructor(e){var n,r,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const s=Object.assign(Object.assign({},qZ),e);if(this.storageKey=s.storageKey,this.instanceID=(n=Rg.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,Rg.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.instanceID>0&&ri()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=s.persistSession,this.autoRefreshToken=s.autoRefreshToken,this.admin=new EZ({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=k4(s.fetch),this.lock=s.lock||QO,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,this.throwOnError=s.throwOnError,s.lock?this.lock=s.lock:ri()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=CZ:this.lock=QO,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new VZ(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:j4()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=YO(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=YO(this.memoryStorage)),ri()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${E4}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(ri()&&(n=rZ(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),ri()&&this.detectSessionInUrl&&r!=="none"){const{data:i,error:s}=await this._getSessionFromURL(n,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),YQ(s)){const l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:o,redirectType:a}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return ot(n)?this._returnResult({error:n}):this._returnResult({error:new ed("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,i;try{const s=await St(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:Co}),{data:o,error:a}=s;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(s){if(ot(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signUp(e){var n,r,i;try{let s;if("email"in e){const{email:d,password:h,options:p}=e;let f=null,m=null;this.flowType==="pkce"&&([f,m]=await kh(this.storage,this.storageKey)),s=await St(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p==null?void 0:p.emailRedirectTo,body:{email:d,password:h,data:(n=p==null?void 0:p.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:f,code_challenge_method:m},xform:Co})}else if("phone"in e){const{phone:d,password:h,options:p}=e;s=await St(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:h,data:(r=p==null?void 0:p.data)!==null&&r!==void 0?r:{},channel:(i=p==null?void 0:p.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:Co})}else throw new My("You must provide either an email or phone number and a password");const{data:o,error:a}=s;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(s){if(ot(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithPassword(e){try{let n;if("email"in e){const{email:s,password:o,options:a}=e;n=await St(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:GO})}else if("phone"in e){const{phone:s,password:o,options:a}=e;n=await St(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:GO})}else throw new My("You must provide either an email or phone number and a password");const{data:r,error:i}=n;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!r||!r.session||!r.user){const s=new jh;return this._returnResult({data:{user:null,session:null},error:s})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:i})}catch(n){if(ot(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,i,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,i,s,o,a,l,c,d,h,p;let f,m;if("message"in e)f=e.message,m=e.signature;else{const{chain:g,wallet:v,statement:b,options:x}=e;let y;if(ri())if(typeof v=="object")y=v;else{const P=window;if("ethereum"in P&&typeof P.ethereum=="object"&&"request"in P.ethereum&&typeof P.ethereum.request=="function")y=P.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!(x!=null&&x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=v}const w=new URL((n=x==null?void 0:x.url)!==null&&n!==void 0?n:window.location.href),E=await y.request({method:"eth_requestAccounts"}).then(P=>P).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!E||E.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const S=T4(E[0]);let j=(r=x==null?void 0:x.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!j){const P=await y.request({method:"eth_chainId"});j=kZ(P)}const C={domain:w.host,address:S,statement:b,uri:w.href,version:"1",chainId:j,nonce:(i=x==null?void 0:x.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(o=(s=x==null?void 0:x.signInWithEthereum)===null||s===void 0?void 0:s.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=x==null?void 0:x.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=x==null?void 0:x.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=x==null?void 0:x.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(d=x==null?void 0:x.signInWithEthereum)===null||d===void 0?void 0:d.resources};f=TZ(C),m=await y.request({method:"personal_sign",params:[PZ(f),S]})}try{const{data:g,error:v}=await St(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:m},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Co});if(v)throw v;if(!g||!g.session||!g.user){const b=new jh;return this._returnResult({data:{user:null,session:null},error:b})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:Object.assign({},g),error:v})}catch(g){if(ot(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async signInWithSolana(e){var n,r,i,s,o,a,l,c,d,h,p,f;let m,g;if("message"in e)m=e.message,g=e.signature;else{const{chain:v,wallet:b,statement:x,options:y}=e;let w;if(ri())if(typeof b=="object")w=b;else{const S=window;if("solana"in S&&typeof S.solana=="object"&&("signIn"in S.solana&&typeof S.solana.signIn=="function"||"signMessage"in S.solana&&typeof S.solana.signMessage=="function"))w=S.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(y!=null&&y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=b}const E=new URL((n=y==null?void 0:y.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in w&&w.signIn){const S=await w.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},y==null?void 0:y.signInWithSolana),{version:"1",domain:E.host,uri:E.href}),x?{statement:x}:null));let j;if(Array.isArray(S)&&S[0]&&typeof S[0]=="object")j=S[0];else if(S&&typeof S=="object"&&"signedMessage"in S&&"signature"in S)j=S;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in j&&"signature"in j&&(typeof j.signedMessage=="string"||j.signedMessage instanceof Uint8Array)&&j.signature instanceof Uint8Array)m=typeof j.signedMessage=="string"?j.signedMessage:new TextDecoder().decode(j.signedMessage),g=j.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in w)||typeof w.signMessage!="function"||!("publicKey"in w)||typeof w!="object"||!w.publicKey||!("toBase58"in w.publicKey)||typeof w.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${E.host} wants you to sign in with your Solana account:`,w.publicKey.toBase58(),...x?["",x,""]:[""],"Version: 1",`URI: ${E.href}`,`Issued At: ${(i=(r=y==null?void 0:y.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((s=y==null?void 0:y.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...!((o=y==null?void 0:y.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...!((a=y==null?void 0:y.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...!((l=y==null?void 0:y.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...!((c=y==null?void 0:y.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...!((h=(d=y==null?void 0:y.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||h===void 0)&&h.length?["Resources",...y.signInWithSolana.resources.map(j=>`- ${j}`)]:[]].join(`
`);const S=await w.signMessage(new TextEncoder().encode(m),"utf8");if(!S||!(S instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=S}}try{const{data:v,error:b}=await St(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:id(g)},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:Co});if(b)throw b;if(!v||!v.session||!v.user){const x=new jh;return this._returnResult({data:{user:null,session:null},error:x})}return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),this._returnResult({data:Object.assign({},v),error:b})}catch(v){if(ot(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async _exchangeCodeForSession(e){const n=await Iu(this.storage,`${this.storageKey}-code-verifier`),[r,i]=(n??"").split("/");try{const{data:s,error:o}=await St(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Co});if(await nc(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!s||!s.session||!s.user){const a=new jh;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign(Object.assign({},s),{redirectType:i??null}),error:o})}catch(s){if(ot(s))return this._returnResult({data:{user:null,session:null,redirectType:null},error:s});throw s}}async signInWithIdToken(e){try{const{options:n,provider:r,token:i,access_token:s,nonce:o}=e,a=await St(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:i,access_token:s,nonce:o,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Co}),{data:l,error:c}=a;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const d=new jh;return this._returnResult({data:{user:null,session:null},error:d})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(n){if(ot(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,i,s,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,d=null;this.flowType==="pkce"&&([c,d]=await kh(this.storage,this.storageKey));const{error:h}=await St(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:d},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:h})}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:d}=await St(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(i=l==null?void 0:l.data)!==null&&i!==void 0?i:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:d})}throw new My("You must provide either an email or phone number.")}catch(a){if(ot(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var n,r;try{let i,s;"options"in e&&(i=(n=e.options)===null||n===void 0?void 0:n.redirectTo,s=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await St(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:Co});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(ot(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(e){var n,r,i,s,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await kh(this.storage,this.storageKey));const c=await St(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:bZ});return!((s=c.data)===null||s===void 0)&&s.url&&ri()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(a){if(ot(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new So;const{error:i}=await St(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(e){if(ot(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:i,options:s}=e,{error:o}=await St(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},redirectTo:s==null?void 0:s.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:r,type:i,options:s}=e,{data:o,error:a}=await St(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a})}throw new My("You must provide either an email or phone number and a type")}catch(n){if(ot(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await Iu(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<U1:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=await Iu(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=W1()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=gZ(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{session:null},error:s}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await St(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:_c}):await this._useSession(async n=>{var r,i,s;const{data:o,error:a}=n;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new So}:await St(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0,xform:_c})})}catch(n){if(ot(n))return KQ(n)&&(await this._removeSession(),await nc(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:i,error:s}=r;if(s)throw s;if(!i.session)throw new So;const o=i.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await kh(this.storage,this.storageKey));const{data:c,error:d}=await St(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:_c});if(d)throw d;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(r){if(ot(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new So;const n=Date.now()/1e3;let r=n,i=!0,s=null;const{payload:o}=q1(e.access_token);if(o.exp&&(r=o.exp,i=r<=n),i){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return this._returnResult({data:{user:s.user,session:s},error:null})}catch(n){if(ot(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:o,error:a}=n;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new So;const{data:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{user:null,session:null},error:s}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(ot(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!ri())throw new Ly("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ly(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new FO("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ly("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new FO("No code detected.");const{data:x,error:y}=await this._exchangeCodeForSession(e.code);if(y)throw y;const w=new URL(window.location.href);return w.searchParams.delete("code"),window.history.replaceState(window.history.state,"",w.toString()),{data:{session:x.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:i,access_token:s,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!s||!a||!o||!c)throw new Ly("No session defined in URL");const d=Math.round(Date.now()/1e3),h=parseInt(a);let p=d+h;l&&(p=parseInt(l));const f=p-d;f*1e3<=qh&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const m=p-h;d-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,p,d):d-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,p,d);const{data:g,error:v}=await this._getUser(s);if(v)throw v;const b={provider_token:r,provider_refresh_token:i,access_token:s,expires_in:h,expires_at:p,refresh_token:o,token_type:c,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:b,redirectType:e.type},error:null})}catch(r){if(ot(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await Iu(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:i,error:s}=n;if(s)return this._returnResult({error:s});const o=(r=i.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(GQ(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await nc(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=nZ(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,i;try{const{data:{session:s},error:o}=n;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,n={}){let r=null,i=null;this.flowType==="pkce"&&([r,i]=await kh(this.storage,this.storageKey,!0));try{return await St(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(s){if(ot(s))return this._returnResult({data:null,error:s});throw s}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(ot(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:i}=await this._useSession(async s=>{var o,a,l,c,d;const{data:h,error:p}=s;if(p)throw p;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await St(this.fetch,"GET",f,{headers:this.headers,jwt:(d=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return ri()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(ot(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:i,data:{session:s}}=n;if(i)throw i;const{options:o,provider:a,token:l,access_token:c,nonce:d}=e,h=await St(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=s==null?void 0:s.access_token)!==null&&r!==void 0?r:void 0,body:{provider:a,id_token:l,access_token:c,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Co}),{data:p,error:f}=h;return f?this._returnResult({data:{user:null,session:null},error:f}):!p||!p.session||!p.user?this._returnResult({data:{user:null,session:null},error:new jh}):(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("USER_UPDATED",p.session)),this._returnResult({data:p,error:f}))}catch(i){if(ot(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,i;const{data:s,error:o}=n;if(o)throw o;return await St(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0})})}catch(n){if(ot(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await oZ(async i=>(i>0&&await sZ(200*Math.pow(2,i-1)),this._debug(n,"refreshing attempt",i),await St(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Co})),(i,s)=>{const o=200*Math.pow(2,i);return s&&V1(s)&&Date.now()+o-r<qh})}catch(r){if(this._debug(n,"error",r),ot(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),ri()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const i=await Iu(this.storage,this.storageKey);if(i&&this.userStorage){let o=await Iu(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:i.user},await Wh(this.userStorage,this.storageKey+"-user",o)),i.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:W1()}else if(i&&!i.user&&!i.user){const o=await Iu(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(i.user=o.user,await nc(this.storage,this.storageKey+"-user"),await Wh(this.storage,this.storageKey,i)):i.user=W1()}if(this._debug(r,"session from storage",i),!this._isValidSession(i)){this._debug(r,"session is not valid"),i!==null&&await this._removeSession();return}const s=((n=i.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<U1;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${U1}s`),s){if(this.autoRefreshToken&&i.refresh_token){const{error:o}=await this._callRefreshToken(i.refresh_token);o&&(console.error(o),V1(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(i.access_token);!a&&(o!=null&&o.user)?(i.user=o.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(r,"error",i),console.error(i);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new So;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new gw;const{data:s,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!s.session)throw new So;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={data:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(i,"error",s),ot(s)){const o={data:null,error:s};return V1(s)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,n,r=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const s=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,n)}catch(l){s.push(l)}});if(await Promise.all(o),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await Wh(this.userStorage,this.storageKey+"-user",{user:n.user});const i=Object.assign({},n);delete i.user;const s=qO(i);await Wh(this.storage,this.storageKey,s)}else{const i=qO(n);await Wh(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await nc(this.storage,this.storageKey),await nc(this.storage,this.storageKey+"-code-verifier"),await nc(this.storage,this.storageKey+"-user"),this.userStorage&&await nc(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ri()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),qh);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((r.expires_at*1e3-e)/qh);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${qh}ms, refresh threshold is ${VS} ticks`),i<=VS&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof P4)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ri()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const i=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&i.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&i.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[s,o]=await kh(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(a.toString())}if(r!=null&&r.queryParams){const s=new URLSearchParams(r.queryParams);i.push(s.toString())}return r!=null&&r.skipBrowserRedirect&&i.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:i,error:s}=n;return s?this._returnResult({data:null,error:s}):await St(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(ot(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,i;const{data:s,error:o}=n;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await St(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):(e.factorType==="totp"&&l.type==="totp"&&(!((i=l==null?void 0:l.totp)===null||i===void 0)&&i.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(n){if(ot(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:i,error:s}=n;if(s)return this._returnResult({data:null,error:s});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?$Z(e.webauthn.credential_response):MZ(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await St(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(n){if(ot(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:i,error:s}=n;if(s)return this._returnResult({data:null,error:s});const o=await St(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:IZ(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:DZ(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(ot(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const i={all:[],phone:[],totp:[],webauthn:[]};for(const s of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])i.all.push(s),s.status==="verified"&&i[s.factor_type].push(s);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:r},error:i}=await this.getSession();if(i)return this._returnResult({data:null,error:i});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:s}=q1(r.access_token);let o=null;s.aal&&(o=s.aal);let a=o;((n=(e=r.user.factors)===null||e===void 0?void 0:e.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(a="aal2");const c=s.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:c},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:i}=n;return i?this._returnResult({data:null,error:i}):r?await St(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new So})})}catch(n){if(ot(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:i},error:s}=r;if(s)return this._returnResult({data:null,error:s});if(!i)return this._returnResult({data:null,error:new So});const o=await St(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&ri()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(ot(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:i},error:s}=r;if(s)return this._returnResult({data:null,error:s});if(!i)return this._returnResult({data:null,error:new So});const o=await St(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&ri()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(ot(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(a=>a.kid===e);if(r)return r;const i=Date.now();if(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+qQ>i)return r;const{data:s,error:o}=await St(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=i,r=s.keys.find(a=>a.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:f,error:m}=await this.getSession();if(m||!f.session)return this._returnResult({data:null,error:m});r=f.session.access_token}const{header:i,payload:s,signature:o,raw:{header:a,payload:l}}=q1(r);n!=null&&n.allowExpired||pZ(s.exp);const c=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!c){const{error:f}=await this.getUser(r);if(f)throw f;return{data:{claims:s,header:i,signature:o},error:null}}const d=fZ(i.alg),h=await crypto.subtle.importKey("jwk",c,d,!0,["verify"]);if(!await crypto.subtle.verify(d,h,o,eZ(`${a}.${l}`)))throw new GS("Invalid JWT signature");return{data:{claims:s,header:i,signature:o},error:null}}catch(r){if(ot(r))return this._returnResult({data:null,error:r});throw r}}}Rg.nextInstanceID={};const WZ=Rg;class GZ extends WZ{constructor(e){super(e)}}class KZ{constructor(e,n,r){var i,s,o;this.supabaseUrl=e,this.supabaseKey=n;const a=FQ(e);if(!n)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const l=`sb-${a.hostname.split(".")[0]}-auth-token`,c={db:RQ,realtime:IQ,auth:Object.assign(Object.assign({},AQ),{storageKey:l}),global:OQ},d=BQ(r??{},c);this.storageKey=(i=d.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(s=d.global.headers)!==null&&s!==void 0?s:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(h,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=MQ(n,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.accessToken&&this.accessToken().then(h=>this.realtime.setAuth(h)).catch(h=>console.warn("Failed to set initial Realtime auth token:",h)),this.rest=new zX(new URL("rest/v1",a).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new PQ(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new LX(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,n,r)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,n;if(this.accessToken)return await this.accessToken();const{data:r}=await this.auth.getSession();return(n=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:i,userStorage:s,storageKey:o,flowType:a,lock:l,debug:c,throwOnError:d},h,p){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new GZ({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),h),storageKey:o,autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:i,userStorage:s,flowType:a,lock:l,debug:c,throwOnError:d,fetch:p,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new iQ(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,n,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const YZ=(t,e,n)=>new KZ(t,e,n);function XZ(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}XZ()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const QZ="https://lnxbvkcggoyfmpfthhhk.supabase.co",ZZ="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxueGJ2a2NnZ295Zm1wZnRoaGhrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0OTg5MzcsImV4cCI6MjA3NTA3NDkzN30.jA9UekW12CqU7vKHBZUPN2dtwG-nhqy1yxE8L70HZjM",JZ=ZZ,he=YZ(QZ,JZ,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0},global:{headers:{Accept:"application/json","Content-Type":"application/json"}}});var eJ=Symbol.for("react.lazy"),Zb=zY[" use ".trim().toString()];function tJ(t){return typeof t=="object"&&t!==null&&"then"in t}function O4(t){return t!=null&&typeof t=="object"&&"$$typeof"in t&&t.$$typeof===eJ&&"_payload"in t&&tJ(t._payload)}function vw(t){const e=nJ(t),n=_.forwardRef((r,i)=>{let{children:s,...o}=r;O4(s)&&typeof Zb=="function"&&(s=Zb(s._payload));const a=_.Children.toArray(s),l=a.find(iJ);if(l){const c=l.props.children,d=a.map(h=>h===l?_.Children.count(c)>1?_.Children.only(null):_.isValidElement(c)?c.props.children:null:h);return u.jsx(e,{...o,ref:i,children:_.isValidElement(c)?_.cloneElement(c,void 0,d):null})}return u.jsx(e,{...o,ref:i,children:s})});return n.displayName=`${t}.Slot`,n}var R4=vw("Slot");function nJ(t){const e=_.forwardRef((n,r)=>{let{children:i,...s}=n;if(O4(i)&&typeof Zb=="function"&&(i=Zb(i._payload)),_.isValidElement(i)){const o=oJ(i),a=sJ(s,i.props);return i.type!==_.Fragment&&(a.ref=r?_B(r,o):o),_.cloneElement(i,a)}return _.Children.count(i)>1?_.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var rJ=Symbol("radix.slottable");function iJ(t){return _.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===rJ}function sJ(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{const l=s(...a);return i(...a),l}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function oJ(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function A4(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=A4(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function Aa(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=A4(t))&&(r&&(r+=" "),r+=e);return r}const ZO=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,JO=Aa,xv=(t,e)=>n=>{var r;if((e==null?void 0:e.variants)==null)return JO(t,n==null?void 0:n.class,n==null?void 0:n.className);const{variants:i,defaultVariants:s}=e,o=Object.keys(i).map(c=>{const d=n==null?void 0:n[c],h=s==null?void 0:s[c];if(d===null)return null;const p=ZO(d)||ZO(h);return i[c][p]}),a=n&&Object.entries(n).reduce((c,d)=>{let[h,p]=d;return p===void 0||(c[h]=p),c},{}),l=e==null||(r=e.compoundVariants)===null||r===void 0?void 0:r.reduce((c,d)=>{let{class:h,className:p,...f}=d;return Object.entries(f).every(m=>{let[g,v]=m;return Array.isArray(v)?v.includes({...s,...a}[g]):{...s,...a}[g]===v})?[...c,h,p]:c},[]);return JO(t,o,l,n==null?void 0:n.class,n==null?void 0:n.className)},zk="-",aJ=t=>{const e=cJ(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=t;return{getClassGroupId:o=>{const a=o.split(zk);return a[0]===""&&a.length!==1&&a.shift(),I4(a,e)||lJ(o)},getConflictingClassGroupIds:(o,a)=>{const l=n[o]||[];return a&&r[o]?[...l,...r[o]]:l}}},I4=(t,e)=>{var o;if(t.length===0)return e.classGroupId;const n=t[0],r=e.nextPart.get(n),i=r?I4(t.slice(1),r):void 0;if(i)return i;if(e.validators.length===0)return;const s=t.join(zk);return(o=e.validators.find(({validator:a})=>a(s)))==null?void 0:o.classGroupId},eR=/^\[(.+)\]$/,lJ=t=>{if(eR.test(t)){const e=eR.exec(t)[1],n=e==null?void 0:e.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},cJ=t=>{const{theme:e,prefix:n}=t,r={nextPart:new Map,validators:[]};return dJ(Object.entries(t.classGroups),n).forEach(([s,o])=>{KS(o,r,s,e)}),r},KS=(t,e,n,r)=>{t.forEach(i=>{if(typeof i=="string"){const s=i===""?e:tR(e,i);s.classGroupId=n;return}if(typeof i=="function"){if(uJ(i)){KS(i(r),e,n,r);return}e.validators.push({validator:i,classGroupId:n});return}Object.entries(i).forEach(([s,o])=>{KS(o,tR(e,s),n,r)})})},tR=(t,e)=>{let n=t;return e.split(zk).forEach(r=>{n.nextPart.has(r)||n.nextPart.set(r,{nextPart:new Map,validators:[]}),n=n.nextPart.get(r)}),n},uJ=t=>t.isThemeGetter,dJ=(t,e)=>e?t.map(([n,r])=>{const i=r.map(s=>typeof s=="string"?e+s:typeof s=="object"?Object.fromEntries(Object.entries(s).map(([o,a])=>[e+o,a])):s);return[n,i]}):t,hJ=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,r=new Map;const i=(s,o)=>{n.set(s,o),e++,e>t&&(e=0,r=n,n=new Map)};return{get(s){let o=n.get(s);if(o!==void 0)return o;if((o=r.get(s))!==void 0)return i(s,o),o},set(s,o){n.has(s)?n.set(s,o):i(s,o)}}},D4="!",pJ=t=>{const{separator:e,experimentalParseClassName:n}=t,r=e.length===1,i=e[0],s=e.length,o=a=>{const l=[];let c=0,d=0,h;for(let v=0;v<a.length;v++){let b=a[v];if(c===0){if(b===i&&(r||a.slice(v,v+s)===e)){l.push(a.slice(d,v)),d=v+s;continue}if(b==="/"){h=v;continue}}b==="["?c++:b==="]"&&c--}const p=l.length===0?a:a.substring(d),f=p.startsWith(D4),m=f?p.substring(1):p,g=h&&h>d?h-d:void 0;return{modifiers:l,hasImportantModifier:f,baseClassName:m,maybePostfixModifierPosition:g}};return n?a=>n({className:a,parseClassName:o}):o},fJ=t=>{if(t.length<=1)return t;const e=[];let n=[];return t.forEach(r=>{r[0]==="["?(e.push(...n.sort(),r),n=[]):n.push(r)}),e.push(...n.sort()),e},mJ=t=>({cache:hJ(t.cacheSize),parseClassName:pJ(t),...aJ(t)}),gJ=/\s+/,vJ=(t,e)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:i}=e,s=[],o=t.trim().split(gJ);let a="";for(let l=o.length-1;l>=0;l-=1){const c=o[l],{modifiers:d,hasImportantModifier:h,baseClassName:p,maybePostfixModifierPosition:f}=n(c);let m=!!f,g=r(m?p.substring(0,f):p);if(!g){if(!m){a=c+(a.length>0?" "+a:a);continue}if(g=r(p),!g){a=c+(a.length>0?" "+a:a);continue}m=!1}const v=fJ(d).join(":"),b=h?v+D4:v,x=b+g;if(s.includes(x))continue;s.push(x);const y=i(g,m);for(let w=0;w<y.length;++w){const E=y[w];s.push(b+E)}a=c+(a.length>0?" "+a:a)}return a};function yJ(){let t=0,e,n,r="";for(;t<arguments.length;)(e=arguments[t++])&&(n=$4(e))&&(r&&(r+=" "),r+=n);return r}const $4=t=>{if(typeof t=="string")return t;let e,n="";for(let r=0;r<t.length;r++)t[r]&&(e=$4(t[r]))&&(n&&(n+=" "),n+=e);return n};function xJ(t,...e){let n,r,i,s=o;function o(l){const c=e.reduce((d,h)=>h(d),t());return n=mJ(c),r=n.cache.get,i=n.cache.set,s=a,a(l)}function a(l){const c=r(l);if(c)return c;const d=vJ(l,n);return i(l,d),d}return function(){return s(yJ.apply(null,arguments))}}const Ln=t=>{const e=n=>n[t]||[];return e.isThemeGetter=!0,e},M4=/^\[(?:([a-z-]+):)?(.+)\]$/i,bJ=/^\d+\/\d+$/,wJ=new Set(["px","full","screen"]),_J=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,EJ=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,SJ=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,CJ=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,jJ=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,el=t=>dp(t)||wJ.has(t)||bJ.test(t),rc=t=>Sf(t,"length",IJ),dp=t=>!!t&&!Number.isNaN(Number(t)),K1=t=>Sf(t,"number",dp),pm=t=>!!t&&Number.isInteger(Number(t)),kJ=t=>t.endsWith("%")&&dp(t.slice(0,-1)),Ft=t=>M4.test(t),ic=t=>_J.test(t),PJ=new Set(["length","size","percentage"]),TJ=t=>Sf(t,PJ,L4),NJ=t=>Sf(t,"position",L4),OJ=new Set(["image","url"]),RJ=t=>Sf(t,OJ,$J),AJ=t=>Sf(t,"",DJ),fm=()=>!0,Sf=(t,e,n)=>{const r=M4.exec(t);return r?r[1]?typeof e=="string"?r[1]===e:e.has(r[1]):n(r[2]):!1},IJ=t=>EJ.test(t)&&!SJ.test(t),L4=()=>!1,DJ=t=>CJ.test(t),$J=t=>jJ.test(t),MJ=()=>{const t=Ln("colors"),e=Ln("spacing"),n=Ln("blur"),r=Ln("brightness"),i=Ln("borderColor"),s=Ln("borderRadius"),o=Ln("borderSpacing"),a=Ln("borderWidth"),l=Ln("contrast"),c=Ln("grayscale"),d=Ln("hueRotate"),h=Ln("invert"),p=Ln("gap"),f=Ln("gradientColorStops"),m=Ln("gradientColorStopPositions"),g=Ln("inset"),v=Ln("margin"),b=Ln("opacity"),x=Ln("padding"),y=Ln("saturate"),w=Ln("scale"),E=Ln("sepia"),S=Ln("skew"),j=Ln("space"),C=Ln("translate"),P=()=>["auto","contain","none"],R=()=>["auto","hidden","clip","visible","scroll"],N=()=>["auto",Ft,e],I=()=>[Ft,e],M=()=>["",el,rc],W=()=>["auto",dp,Ft],ce=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],se=()=>["solid","dashed","dotted","double","none"],ve=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],pt=()=>["start","end","center","between","around","evenly","stretch"],je=()=>["","0",Ft],lt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Nt=()=>[dp,Ft];return{cacheSize:500,separator:":",theme:{colors:[fm],spacing:[el,rc],blur:["none","",ic,Ft],brightness:Nt(),borderColor:[t],borderRadius:["none","","full",ic,Ft],borderSpacing:I(),borderWidth:M(),contrast:Nt(),grayscale:je(),hueRotate:Nt(),invert:je(),gap:I(),gradientColorStops:[t],gradientColorStopPositions:[kJ,rc],inset:N(),margin:N(),opacity:Nt(),padding:I(),saturate:Nt(),scale:Nt(),sepia:je(),skew:Nt(),space:I(),translate:I()},classGroups:{aspect:[{aspect:["auto","square","video",Ft]}],container:["container"],columns:[{columns:[ic]}],"break-after":[{"break-after":lt()}],"break-before":[{"break-before":lt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ce(),Ft]}],overflow:[{overflow:R()}],"overflow-x":[{"overflow-x":R()}],"overflow-y":[{"overflow-y":R()}],overscroll:[{overscroll:P()}],"overscroll-x":[{"overscroll-x":P()}],"overscroll-y":[{"overscroll-y":P()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",pm,Ft]}],basis:[{basis:N()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ft]}],grow:[{grow:je()}],shrink:[{shrink:je()}],order:[{order:["first","last","none",pm,Ft]}],"grid-cols":[{"grid-cols":[fm]}],"col-start-end":[{col:["auto",{span:["full",pm,Ft]},Ft]}],"col-start":[{"col-start":W()}],"col-end":[{"col-end":W()}],"grid-rows":[{"grid-rows":[fm]}],"row-start-end":[{row:["auto",{span:[pm,Ft]},Ft]}],"row-start":[{"row-start":W()}],"row-end":[{"row-end":W()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ft]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ft]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...pt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...pt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...pt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[x]}],px:[{px:[x]}],py:[{py:[x]}],ps:[{ps:[x]}],pe:[{pe:[x]}],pt:[{pt:[x]}],pr:[{pr:[x]}],pb:[{pb:[x]}],pl:[{pl:[x]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[j]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[j]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Ft,e]}],"min-w":[{"min-w":[Ft,e,"min","max","fit"]}],"max-w":[{"max-w":[Ft,e,"none","full","min","max","fit","prose",{screen:[ic]},ic]}],h:[{h:[Ft,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Ft,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Ft,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Ft,e,"auto","min","max","fit"]}],"font-size":[{text:["base",ic,rc]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",K1]}],"font-family":[{font:[fm]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ft]}],"line-clamp":[{"line-clamp":["none",dp,K1]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",el,Ft]}],"list-image":[{"list-image":["none",Ft]}],"list-style-type":[{list:["none","disc","decimal",Ft]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[b]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[b]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...se(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",el,rc]}],"underline-offset":[{"underline-offset":["auto",el,Ft]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:I()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ft]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ft]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[b]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ce(),NJ]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",TJ]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},RJ]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[m]}],"gradient-via-pos":[{via:[m]}],"gradient-to-pos":[{to:[m]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[s]}],"rounded-s":[{"rounded-s":[s]}],"rounded-e":[{"rounded-e":[s]}],"rounded-t":[{"rounded-t":[s]}],"rounded-r":[{"rounded-r":[s]}],"rounded-b":[{"rounded-b":[s]}],"rounded-l":[{"rounded-l":[s]}],"rounded-ss":[{"rounded-ss":[s]}],"rounded-se":[{"rounded-se":[s]}],"rounded-ee":[{"rounded-ee":[s]}],"rounded-es":[{"rounded-es":[s]}],"rounded-tl":[{"rounded-tl":[s]}],"rounded-tr":[{"rounded-tr":[s]}],"rounded-br":[{"rounded-br":[s]}],"rounded-bl":[{"rounded-bl":[s]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[b]}],"border-style":[{border:[...se(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[b]}],"divide-style":[{divide:se()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:["",...se()]}],"outline-offset":[{"outline-offset":[el,Ft]}],"outline-w":[{outline:[el,rc]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:M()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[b]}],"ring-offset-w":[{"ring-offset":[el,rc]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",ic,AJ]}],"shadow-color":[{shadow:[fm]}],opacity:[{opacity:[b]}],"mix-blend":[{"mix-blend":[...ve(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":ve()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",ic,Ft]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[h]}],saturate:[{saturate:[y]}],sepia:[{sepia:[E]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[b]}],"backdrop-saturate":[{"backdrop-saturate":[y]}],"backdrop-sepia":[{"backdrop-sepia":[E]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ft]}],duration:[{duration:Nt()}],ease:[{ease:["linear","in","out","in-out",Ft]}],delay:[{delay:Nt()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ft]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[w]}],"scale-x":[{"scale-x":[w]}],"scale-y":[{"scale-y":[w]}],rotate:[{rotate:[pm,Ft]}],"translate-x":[{"translate-x":[C]}],"translate-y":[{"translate-y":[C]}],"skew-x":[{"skew-x":[S]}],"skew-y":[{"skew-y":[S]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ft]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ft]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":I()}],"scroll-mx":[{"scroll-mx":I()}],"scroll-my":[{"scroll-my":I()}],"scroll-ms":[{"scroll-ms":I()}],"scroll-me":[{"scroll-me":I()}],"scroll-mt":[{"scroll-mt":I()}],"scroll-mr":[{"scroll-mr":I()}],"scroll-mb":[{"scroll-mb":I()}],"scroll-ml":[{"scroll-ml":I()}],"scroll-p":[{"scroll-p":I()}],"scroll-px":[{"scroll-px":I()}],"scroll-py":[{"scroll-py":I()}],"scroll-ps":[{"scroll-ps":I()}],"scroll-pe":[{"scroll-pe":I()}],"scroll-pt":[{"scroll-pt":I()}],"scroll-pr":[{"scroll-pr":I()}],"scroll-pb":[{"scroll-pb":I()}],"scroll-pl":[{"scroll-pl":I()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ft]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[el,rc,K1]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},LJ=xJ(MJ);function Se(...t){return LJ(Aa(t))}const Hk=xv("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-160 ease-out disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:shadow-[0_0_0_1px_hsl(var(--ring)),0_0_8px_hsl(var(--ring)/0.5)]",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 hover:scale-[1.03] hover:-translate-y-0.5 hover:shadow-lg active:scale-[0.98] active:translate-y-0",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 hover:scale-[1.03] hover:shadow-lg active:scale-[0.98]",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:scale-[1.03] hover:shadow-md active:scale-[0.98]",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 hover:scale-[1.03] hover:shadow-md active:scale-[0.98]",ghost:"hover:bg-accent hover:text-accent-foreground hover:scale-[1.03] active:scale-[0.98]",link:"text-primary underline-offset-4 hover:underline hover:scale-[1.02] active:scale-[0.98]"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),G=_.forwardRef(({className:t,variant:e,size:n,asChild:r=!1,...i},s)=>{const o=r?R4:"button";return u.jsx(o,{className:Se(Hk({variant:e,size:n,className:t})),ref:s,...i})});G.displayName="Button";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BJ=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),B4=(...t)=>t.filter((e,n,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===n).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var FJ={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zJ=_.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:i="",children:s,iconNode:o,...a},l)=>_.createElement("svg",{ref:l,...FJ,width:e,height:e,stroke:t,strokeWidth:r?Number(n)*24/Number(e):n,className:B4("lucide",i),...a},[...o.map(([c,d])=>_.createElement(c,d)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=(t,e)=>{const n=_.forwardRef(({className:r,...i},s)=>_.createElement(zJ,{ref:s,iconNode:e,className:B4(`lucide-${BJ(t)}`,r),...i}));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YS=le("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HJ=le("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xh=le("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UJ=le("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VJ=le("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qJ=le("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hp=le("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WJ=le("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uk=le("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GJ=le("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=le("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=le("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mm=le("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ag=le("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jo=le("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KJ=le("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vm=le("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F4=le("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YJ=le("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XJ=le("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QJ=le("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZJ=le("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vk=le("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jb=le("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JJ=le("Cog",[["path",{d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z",key:"sobvz5"}],["path",{d:"M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",key:"11i496"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 22v-2",key:"1osdcq"}],["path",{d:"m17 20.66-1-1.73",key:"eq3orb"}],["path",{d:"M11 10.27 7 3.34",key:"16pf9h"}],["path",{d:"m20.66 17-1.73-1",key:"sg0v6f"}],["path",{d:"m3.34 7 1.73 1",key:"1ulond"}],["path",{d:"M14 12h8",key:"4f43i9"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"m20.66 7-1.73 1",key:"1ow05n"}],["path",{d:"m3.34 17 1.73-1",key:"nuk764"}],["path",{d:"m17 3.34-1 1.73",key:"2wel8s"}],["path",{d:"m11 13.73-4 6.93",key:"794ttg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nR=le("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z4=le("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ip=le("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=le("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Od=le("Factory",[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rR=le("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eee=le("FileSearch",[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4.268 21a2 2 0 0 0 1.727 1H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"ms7g94"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=le("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XS=le("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tee=le("FolderKanban",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e0=le("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qk=le("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H4=le("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nee=le("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ree=le("Hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iee=le("Handshake",[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y1=le("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=le("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bv=le("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QS=le("Languages",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iR=le("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const see=le("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oee=le("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=le("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aee=le("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sR=le("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wk=le("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lee=le("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xb=le("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cee=le("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U4=le("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uee=le("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gk=le("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZS=le("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ig=le("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dee=le("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hee=le("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pee=le("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fee=le("MousePointerClick",[["path",{d:"M14 4.1 12 6",key:"ita8i4"}],["path",{d:"m5.1 8-2.9-.8",key:"1go3kf"}],["path",{d:"m6 12-1.9 2",key:"mnht97"}],["path",{d:"M7.2 2.2 8 5.1",key:"1cfko1"}],["path",{d:"M9.037 9.69a.498.498 0 0 1 .653-.653l11 4.5a.5.5 0 0 1-.074.949l-4.349 1.041a1 1 0 0 0-.74.739l-1.04 4.35a.5.5 0 0 1-.95.074z",key:"s0h3yz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mee=le("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sg=le("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gee=le("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vee=le("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qh=le("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oR=le("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JS=le("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yee=le("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V4=le("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xee=le("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q4=le("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bee=le("Scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ig=le("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const og=le("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wee=le("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t0=le("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _ee=le("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sl=le("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eee=le("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yd=le("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kk=le("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const See=le("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aR=le("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wv=le("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const By=le("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eC=le("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bb=le("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cee=le("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dg=le("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n0=le("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=le("Workflow",[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jee=le("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=le("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kee=le("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wb=le("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tC=le("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Pee=1,Tee=1e6;let X1=0;function Nee(){return X1=(X1+1)%Number.MAX_SAFE_INTEGER,X1.toString()}const Q1=new Map,lR=t=>{if(Q1.has(t))return;const e=setTimeout(()=>{Q1.delete(t),ag({type:"REMOVE_TOAST",toastId:t})},Tee);Q1.set(t,e)},Oee=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,Pee)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(n=>n.id===e.toast.id?{...n,...e.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=e;return n?lR(n):t.toasts.forEach(r=>{lR(r.id)}),{...t,toasts:t.toasts.map(r=>r.id===n||n===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(n=>n.id!==e.toastId)}}},_b=[];let Eb={toasts:[]};function ag(t){Eb=Oee(Eb,t),_b.forEach(e=>{e(Eb)})}function Ree({...t}){const e=Nee(),n=i=>ag({type:"UPDATE_TOAST",toast:{...i,id:e}}),r=()=>ag({type:"DISMISS_TOAST",toastId:e});return ag({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:i=>{i||r()}}}),{id:e,dismiss:r,update:n}}function _v(){const[t,e]=_.useState(Eb);return _.useEffect(()=>(_b.push(e),()=>{const n=_b.indexOf(e);n>-1&&_b.splice(n,1)}),[t]),{...t,toast:Ree,dismiss:n=>ag({type:"DISMISS_TOAST",toastId:n})}}const W4=t=>{const[e,n]=_.useState(!1),[r,i]=_.useState(!0);return _.useEffect(()=>{(async()=>{if(!t){n(!1),i(!1);return}try{const{data:o,error:a}=await he.from("user_roles").select("role").eq("user_id",t.id).eq("role","admin").maybeSingle();a?(a.code!=="PGRST116"&&a.code!=="PGRST301"&&console.error("Error checking admin status:",a),n(!1)):n(!!o)}catch(o){console.error("Unexpected error checking admin:",o),n(!1)}finally{i(!1)}})()},[t]),{isAdmin:e,isLoading:r}},G4=yk,K4=EB,Aee=vk,Y4=_.forwardRef(({className:t,...e},n)=>u.jsx(hv,{className:Se("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e,ref:n}));Y4.displayName=hv.displayName;const Iee=xv("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Yk=_.forwardRef(({side:t="right",className:e,children:n,...r},i)=>u.jsxs(Aee,{children:[u.jsx(Y4,{}),u.jsxs(pv,{ref:i,className:Se(Iee({side:t}),e),...r,children:[n,u.jsxs(cw,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[u.jsx(xa,{className:"h-4 w-4"}),u.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Yk.displayName=pv.displayName;const Xk=({className:t,...e})=>u.jsx("div",{className:Se("flex flex-col space-y-2 text-center sm:text-left",t),...e});Xk.displayName="SheetHeader";const Qk=_.forwardRef(({className:t,...e},n)=>u.jsx(fv,{ref:n,className:Se("text-lg font-semibold text-foreground",t),...e}));Qk.displayName=fv.displayName;const Dee=_.forwardRef(({className:t,...e},n)=>u.jsx(mv,{ref:n,className:Se("text-sm text-muted-foreground",t),...e}));Dee.displayName=mv.displayName;const X4=_.createContext(void 0),Z1="prossmind-theme";function $ee({children:t}){const[e,n]=_.useState(()=>typeof window>"u"?"system":localStorage.getItem(Z1)||"system"),[r,i]=_.useState(()=>typeof window>"u"?"light":e==="system"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e);_.useEffect(()=>{if(e==="system"){const o=window.matchMedia("(prefers-color-scheme: dark)"),a=l=>{i(l.matches?"dark":"light")};return a(o),o.addEventListener("change",a),()=>o.removeEventListener("change",a)}else i(e)},[e]),_.useEffect(()=>{const o=window.document.documentElement;o.classList.remove("light","dark"),r==="dark"?o.classList.add("dark"):o.classList.add("light")},[r]);const s=o=>{n(o),typeof window<"u"&&localStorage.setItem(Z1,o)};return _.useEffect(()=>{const o=window.document.documentElement,l=localStorage.getItem(Z1)||"system";let c="light";l==="system"?c=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":c=l,o.classList.remove("light","dark"),o.classList.add(c)},[]),u.jsx(X4.Provider,{value:{theme:e,setTheme:s,resolvedTheme:r},children:t})}function Mee(){const t=_.useContext(X4);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const J1=()=>{const{theme:t,setTheme:e,resolvedTheme:n}=Mee(),[r,i]=_.useState(!1);if(_.useEffect(()=>{i(!0)},[]),!r)return u.jsx(G,{variant:"ghost",size:"icon",className:"h-9 w-9","aria-label":"Theme toggle",disabled:!0,children:u.jsx(aR,{className:"h-5 w-5","aria-hidden":"true"})});const s=()=>{e(t==="light"?"dark":t==="dark"?"system":"light")};return u.jsxs(G,{variant:"ghost",size:"icon",onClick:s,className:"h-9 w-9 relative transition-all","aria-label":`Switch to ${n==="dark"?"light":"dark"} mode`,title:`Current: ${n==="dark"?"Dark":"Light"} mode (${t==="system"?"Auto":"Manual"})`,children:[n==="dark"?u.jsx(aR,{className:"h-5 w-5 transition-all rotate-0 scale-100","aria-hidden":"true"}):u.jsx(pee,{className:"h-5 w-5 transition-all rotate-0 scale-100","aria-hidden":"true"}),u.jsx("span",{className:"sr-only",children:n==="dark"?"Switch to light mode":"Switch to dark mode"})]})},Nl=()=>{const[t,e]=_.useState(!1);return _.useEffect(()=>{const n=window.matchMedia("(prefers-reduced-motion: reduce)");e(n.matches);const r=i=>{e(i.matches)};return n.addEventListener?(n.addEventListener("change",r),()=>n.removeEventListener("change",r)):(n.addListener(r),()=>n.removeListener(r))},[]),t},zt=t=>{if(t)return{duration:0}},Ev=()=>{const e=new URLSearchParams(window.location.search).get("subdomain");if(e)return e;const r=window.location.host.split(".");return r.length>2?r[0]:null},Q4=()=>{const t=Ev();return t&&["app","docs","admin","status","api","de","fr","bpmn","pid","partners"].includes(t)?t:"main"},Lee=()=>Q4()==="app",ys=()=>{const t=window.location.host,e=window.location.hostname;return t.includes("localhost")||t.includes("127.0.0.1")||t.includes("0.0.0.0")||e.endsWith(".localhost")},Z4=()=>{const t=window.location.host,e=t.split(".");return e.length>2?e.slice(-2).join("."):t},J4=(t,e="")=>{if(ys()){const s=e.startsWith("/")?e:`/${e}`,o=`${window.location.origin}${s}`,a=o.includes("?")?"&":"?";return`${o}${a}subdomain=${t}`}const n=window.location.protocol,r=Z4(),i=e.startsWith("/")?e:`/${e}`;return`${n}//${t}.${r}${i}`},Ao=(t="",e=!1)=>{const n=J4("app",t);e?window.open(n,"_blank"):window.location.href=n},nC=(t,e="")=>J4(t,e),ko=()=>{const t=Ev();return t?`?subdomain=${t}`:""},sr=(t,e)=>{const n=Ev();if(n&&ys()){const r=e.includes("?")?"&":"?";t(`${e}${r}subdomain=${n}`)}else t(e)},Bee=()=>{if(ys())return`${window.location.origin}/`;const t=window.location.protocol,e=Z4();return`${t}//${e}/`},Os=({user:t})=>{const e=dv(),{toast:n}=_v(),r=_.useRef(!1),i=_.useRef(null),s=_.useRef(null),[o,a]=_.useState(()=>{const j=t??null;return s.current=j,j}),{isAdmin:l}=W4(o),c=Nl(),[d,h]=_.useState(!1),[p,f]=_.useState(!1),[m,g]=_.useState(!1),{scrollY:v}=bB();_.useEffect(()=>{he.auth.getSession().then(({data:{session:C}})=>{r.current=!0;const P=(C==null?void 0:C.user)??null;i.current=P,s.current=P,a(P)});const{data:{subscription:j}}=he.auth.onAuthStateChange((C,P)=>{r.current=!0;const R=(P==null?void 0:P.user)??null;i.current=R,s.current=R,a(R)});return()=>j.unsubscribe()},[]),_.useEffect(()=>{r.current&&(t!==void 0?(s.current=t,a(t),t&&(i.current=t)):t===void 0&&s.current===null&&i.current!==null&&(s.current=i.current,a(i.current)))},[t]),_.useEffect(()=>{s.current=o},[o]),_.useEffect(()=>{const j=()=>{h(window.innerWidth<1080)};return j(),window.addEventListener("resize",j),()=>window.removeEventListener("resize",j)},[]),_.useEffect(()=>{const j=v.on("change",C=>{g(C>50)});return()=>j()},[v]);const b=async()=>{var C,P;const{error:j}=await he.auth.signOut();j&&!((C=j.message)!=null&&C.includes("session"))&&!((P=j.message)!=null&&P.includes("Session"))&&n({variant:"destructive",title:"Error signing out",description:j.message}),a(null),i.current=null,s.current=null,window.location.href="/"},y=Q4()==="app",w=[{name:"Dashboard",path:"/dashboard",icon:see},{name:"Projects",path:"/projects",icon:tee},{name:"Templates",path:"/templates",icon:nr},{name:"Vision AI",path:"/vision-ai",icon:Ia}],E=[{name:"Features",path:"/features"},{name:"Vision AI",path:"/vision-ai"},{name:"Pricing",path:"/pricing"},{name:"Documentation",path:nC("docs"),external:!0},{name:"Contact",path:"/contact"}],S=y?w:E;return u.jsx(Re.nav,{className:"fixed top-0 left-0 right-0 z-50 border-b border-border/50 h-16 bg-background/95 backdrop-blur-lg",style:{backgroundColor:eg(v,[0,100],["hsl(var(--background) / 0.95)","hsl(var(--background) / 1)"]),backdropFilter:eg(v,[0,100],["blur(16px)","blur(24px)"]),boxShadow:eg(v,[0,100],["0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)","0 4px 30px rgba(37, 99, 235, 0.1)"])},initial:c?{y:0}:{y:-100},animate:{y:0},transition:zt(c)||{duration:.3},children:u.jsx("div",{className:"container mx-auto px-6 h-full",children:u.jsxs("div",{className:"flex items-center justify-between h-full",children:[u.jsx(Re.div,{animate:c?{scale:1}:{scale:m?.95:1},transition:zt(c)||{duration:.3},children:u.jsxs("a",{href:Bee(),className:"flex items-center space-x-3 group flex-shrink-0","aria-label":"ProssMind Home",children:[u.jsx(Re.img,{src:"/prossmind-logo.jpeg",alt:"ProssMind Logo",className:"h-10 w-auto",whileHover:c?{}:{scale:1.05},transition:zt(c)||{duration:.2}}),u.jsx("div",{className:"text-xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent whitespace-nowrap",children:"ProssMind"})]})}),!d&&u.jsxs(u.Fragment,{children:[u.jsx(Re.div,{className:"flex items-center space-x-1 bg-secondary/50 rounded-full px-2 py-1.5 shadow-sm flex-shrink-0 relative border border-border/30",style:{borderRadius:"40px"},animate:c?{}:{paddingTop:m?"0.25rem":"0.375rem",paddingBottom:m?"0.25rem":"0.375rem"},transition:zt(c)||{duration:.3},children:S.map(j=>{const C=j.icon,P=j.external,R=!P&&(e.pathname===j.path||j.path==="/dashboard"&&e.pathname==="/"),N=`px-5 py-2 rounded-full text-sm font-medium transition-all duration-300 whitespace-nowrap relative flex items-center gap-2 ${R?"text-primary-foreground":"text-foreground/70 hover:text-foreground hover:bg-muted/80 hover:scale-[1.02]"}`;if(P)return u.jsxs("a",{href:j.path,target:"_blank",rel:"noopener noreferrer",className:N,"aria-label":`Navigate to ${j.name} page`,children:[C&&u.jsx(C,{className:"h-4 w-4 relative z-10"}),u.jsx("span",{className:"relative z-10",children:j.name})]},j.path);const I=!P&&ys()?`${j.path}${ko()}`:j.path;return u.jsxs(Mr,{to:I,className:N,"aria-label":`Navigate to ${j.name} page`,children:[R?u.jsx(Re.div,{layoutId:c?void 0:"activeNavIndicator",className:"absolute inset-0 bg-primary rounded-full shadow-md",transition:zt(c)||{type:"spring",stiffness:380,damping:30}}):null,C&&u.jsx(C,{className:"h-4 w-4 relative z-10"}),u.jsx("span",{className:"relative z-10",children:j.name})]},j.path)})}),o?u.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[u.jsx(J1,{}),y&&u.jsxs(u.Fragment,{children:[u.jsx(Mr,{to:ys()?`/account${ko()}`:"/account",children:u.jsx(G,{variant:"ghost",size:"sm",className:"gap-2","aria-label":"Account",children:u.jsx(Dg,{className:"h-4 w-4"})})}),u.jsx(Mr,{to:ys()?`/settings${ko()}`:"/settings",children:u.jsx(G,{variant:"ghost",size:"sm",className:"gap-2","aria-label":"Settings",children:u.jsx(t0,{className:"h-4 w-4"})})})]}),l&&u.jsx(Mr,{to:ys()?`/admin${ko()}`:"/admin",children:u.jsxs(G,{variant:"outline",size:"sm",className:"gap-2 hover:bg-primary/10 hover:border-primary/50 transition-all whitespace-nowrap","aria-label":"Admin Dashboard",children:[u.jsx(Sl,{className:"h-4 w-4","aria-hidden":"true"}),"Admin"]})}),u.jsx("span",{className:"text-sm text-muted-foreground font-medium whitespace-nowrap truncate max-w-[200px]","aria-label":`Logged in as ${o.email}`,children:o.email}),u.jsxs(G,{onClick:b,variant:"outline",className:"items-center gap-2 hover:bg-destructive/10 hover:border-destructive/50 hover:text-destructive transition-all whitespace-nowrap","aria-label":"Sign out",children:[u.jsx(sR,{className:"h-4 w-4","aria-hidden":"true"}),"Sign Out"]})]}):u.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[u.jsx(J1,{}),u.jsx(Mr,{to:ys()?`/auth${ko()}`:"/auth",className:"flex-shrink-0",children:u.jsxs(G,{className:"flex items-center gap-2 bg-primary hover:bg-primary/90 shadow-md hover:shadow-lg transition-all whitespace-nowrap","aria-label":"Sign up or log in",children:[y?"Sign In":"Sign Up",u.jsx(Ag,{className:"h-4 w-4","aria-hidden":"true"})]})})]})]}),d&&u.jsxs(G4,{open:p,onOpenChange:f,children:[u.jsx(K4,{asChild:!0,children:u.jsx(Re.div,{whileTap:c?{}:{scale:.95},children:u.jsxs(G,{variant:"ghost",size:"icon",className:"md:hidden","aria-label":"Open navigation menu",children:[u.jsx(Re.div,{animate:c?{rotate:p?90:0}:{rotate:p?90:0},transition:zt(c)||{duration:.3},children:u.jsx(U4,{className:"h-6 w-6","aria-hidden":"true"})}),u.jsx("span",{className:"sr-only",children:"Open menu"})]})})}),u.jsxs(Yk,{side:"right",className:"w-[300px] sm:w-[400px]",children:[u.jsx(Xk,{children:u.jsx(Qk,{children:"Menu"})}),u.jsxs("nav",{className:"flex flex-col gap-4 mt-6",children:[u.jsxs(Re.div,{className:"flex items-center justify-between px-4 py-2 border-b border-border mb-2",initial:c?{opacity:1,x:0}:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:zt(c)||{delay:.1},children:[u.jsx("span",{className:"text-sm font-medium",children:"Theme"}),u.jsx(J1,{})]}),S.map((j,C)=>{const P=j.icon,R=j.external,I=`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-2 ${!R&&(e.pathname===j.path||j.path==="/dashboard"&&e.pathname==="/")?"bg-primary text-primary-foreground":"text-foreground/70 hover:text-foreground hover:bg-muted/80"}`;return u.jsx(Re.div,{initial:c?{opacity:1,x:0}:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:zt(c)||{delay:.1+C*.05},children:R?u.jsxs("a",{href:j.path,target:"_blank",rel:"noopener noreferrer",className:I,"aria-label":`Navigate to ${j.name} page`,children:[P&&u.jsx(P,{className:"h-4 w-4"}),j.name]}):u.jsxs(Mr,{to:ys()?`${j.path}${ko()}`:j.path,onClick:()=>f(!1),className:I,"aria-label":`Navigate to ${j.name} page`,children:[P&&u.jsx(P,{className:"h-4 w-4"}),j.name]})},j.path)}),y&&o&&u.jsxs(u.Fragment,{children:[u.jsx(Re.div,{initial:c?{opacity:1,x:0}:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:zt(c)||{delay:.3},children:u.jsxs(Mr,{to:ys()?`/account${ko()}`:"/account",onClick:()=>f(!1),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-2 ${e.pathname==="/account"?"bg-primary text-primary-foreground":"text-foreground/70 hover:text-foreground hover:bg-muted/80"}`,children:[u.jsx(Dg,{className:"h-4 w-4"}),"Account"]})}),u.jsx(Re.div,{initial:c?{opacity:1,x:0}:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:zt(c)||{delay:.35},children:u.jsxs(Mr,{to:ys()?`/settings${ko()}`:"/settings",onClick:()=>f(!1),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-2 ${e.pathname==="/settings"?"bg-primary text-primary-foreground":"text-foreground/70 hover:text-foreground hover:bg-muted/80"}`,children:[u.jsx(t0,{className:"h-4 w-4"}),"Settings"]})})]}),o?u.jsxs(u.Fragment,{children:[l&&u.jsx(Mr,{to:ys()?`/admin${ko()}`:"/admin",onClick:()=>f(!1),children:u.jsxs(G,{variant:"outline",className:"w-full justify-start gap-2","aria-label":"Admin Dashboard",children:[u.jsx(Sl,{className:"h-4 w-4","aria-hidden":"true"}),"Admin"]})}),u.jsx("div",{className:"px-4 py-2 text-sm text-muted-foreground","aria-label":`Logged in as ${o.email}`,children:o.email}),u.jsxs(G,{onClick:()=>{b(),f(!1)},variant:"outline",className:"w-full justify-start gap-2 hover:bg-destructive/10 hover:border-destructive/50 hover:text-destructive","aria-label":"Sign out",children:[u.jsx(sR,{className:"h-4 w-4","aria-hidden":"true"}),"Sign Out"]})]}):u.jsx(Mr,{to:ys()?`/auth${ko()}`:"/auth",onClick:()=>f(!1),children:u.jsxs(G,{className:"w-full gap-2","aria-label":"Sign up or log in",children:["Sign Up",u.jsx(Ag,{className:"h-4 w-4","aria-hidden":"true"})]})})]})]})]})]})})})},Fee="/assets/hero-mind-process-CVwas96Y.jpg",zee=()=>{const t=_.useRef(null),e=_.useRef([]),n=_.useRef();return _.useEffect(()=>{const r=t.current;if(!r)return;const i=r.getContext("2d");if(!i)return;const s=()=>{r.width=window.innerWidth,r.height=window.innerHeight};s(),window.addEventListener("resize",s);const o=Math.min(20,Math.max(15,Math.floor(r.width*r.height/2e4)));e.current=Array.from({length:o},()=>({x:Math.random()*r.width,y:Math.random()*r.height,vx:(Math.random()-.5)*.3,vy:(Math.random()-.5)*.3-.2,size:Math.random()*2+1,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.02,opacity:Math.random()*.5+.3}));const a=()=>{i.clearRect(0,0,r.width,r.height);const l=e.current;l.forEach(c=>{let d=c.x+c.vx,h=c.y+c.vy;c.rotation+=c.rotationSpeed,d<0&&(d=r.width,c.opacity=Math.random()*.5+.3),d>r.width&&(d=0,c.opacity=Math.random()*.5+.3),h<0&&(h=r.height,c.opacity=Math.random()*.5+.3),h>r.height&&(h=0,c.opacity=Math.random()*.5+.3),c.x=d,c.y=h,i.save(),i.translate(c.x,c.y),i.rotate(c.rotation),i.beginPath(),i.arc(0,0,c.size,0,Math.PI*2),i.fillStyle=`rgba(37, 99, 235, ${c.opacity})`,i.fill(),i.restore()}),l.forEach((c,d)=>{l.slice(d+1).forEach(h=>{const p=c.x-h.x,f=c.y-h.y,m=Math.sqrt(p*p+f*f);m<150&&(i.beginPath(),i.moveTo(c.x,c.y),i.lineTo(h.x,h.y),i.strokeStyle=`rgba(37, 99, 235, ${.1*(1-m/150)})`,i.lineWidth=.5,i.stroke())})}),n.current=requestAnimationFrame(a)};return a(),()=>{window.removeEventListener("resize",s),n.current&&cancelAnimationFrame(n.current)}},[]),u.jsx(Re.canvas,{ref:t,className:"absolute inset-0 pointer-events-none",initial:{opacity:0},animate:{opacity:1},transition:{duration:1}})},Hee=({containerRef:t,centerX:e,centerY:n})=>{const r=_.useRef(null),[i,s]=_.useState([]),o=_.useRef();if(_.useEffect(()=>{if(!t.current||e===0||n===0)return;const l=t.current.getBoundingClientRect(),c=e-l.left,d=n-l.top,h=6,p=Array.from({length:h},(m,g)=>{const v=g/h*Math.PI*2,b=150+Math.random()*100,x=c+Math.cos(v)*b,y=d+Math.sin(v)*b,w=3+Math.floor(Math.random()*3),E=Array.from({length:w},()=>({progress:Math.random(),speed:.005+Math.random()*.005}));return{id:g,startX:c,startY:d,endX:x,endY:y,particles:E}});s(p);const f=()=>{s(m=>m.map(g=>({...g,particles:g.particles.map(v=>({...v,progress:(v.progress+v.speed)%1}))}))),o.current=requestAnimationFrame(f)};return f(),()=>{o.current&&cancelAnimationFrame(o.current)}},[e,n,t]),!t.current)return null;const a=t.current.getBoundingClientRect();return u.jsxs("svg",{ref:r,className:"absolute inset-0 pointer-events-none",width:a.width,height:a.height,children:[u.jsx("defs",{children:u.jsxs("filter",{id:"glow",children:[u.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),u.jsxs("feMerge",{children:[u.jsx("feMergeNode",{in:"coloredBlur"}),u.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),i.map(l=>u.jsxs("g",{children:[u.jsx(Re.line,{x1:l.startX,y1:l.startY,x2:l.endX,y2:l.endY,stroke:"rgba(37, 99, 235, 0.2)",strokeWidth:"1",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1,ease:"easeOut"}}),l.particles.map((c,d)=>{const h=l.startX+(l.endX-l.startX)*c.progress,p=l.startY+(l.endY-l.startY)*c.progress,f=1-c.progress%.2*5;return u.jsxs("g",{children:[u.jsx("circle",{cx:h,cy:p,r:"8",fill:"rgba(37, 99, 235, 0.1)",opacity:f,filter:"url(#glow)"}),u.jsx(Re.circle,{cx:h,cy:p,r:"3",fill:"rgba(37, 99, 235, 0.8)",filter:"url(#glow)",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}})]},d)})]},l.id))]})},Uee=({src:t,autoplay:e=!0,loop:n=!0,className:r="","aria-label":i,lazy:s=!0,fallback:o})=>{const a=_.useRef(null),l=_.useRef(null),[c,d]=_.useState(!1),[h,p]=_.useState(!1),f=Nl(),[m,g]=_.useState(!s);return _.useEffect(()=>{if(!s||m)return;const v=a.current;if(!v)return;const b=new IntersectionObserver(x=>{x.forEach(y=>{y.isIntersecting&&(g(!0),b.disconnect())})},{rootMargin:"100px",threshold:0});if(b.observe(v),typeof window.requestIdleCallback<"u"){const x=window.requestIdleCallback(()=>{m||g(!0)});return()=>{b.disconnect(),window.cancelIdleCallback(x)}}return()=>b.disconnect()},[s,m]),_.useEffect(()=>{if(!m||!a.current||f){f&&o&&d(!0);return}let v=!0;return(async()=>{try{const x=await fetch(t);if(!x.ok)throw new Error(`Failed to load animation: ${x.statusText}`);const y=await x.json();if(!v||!a.current)return;const w=cX.loadAnimation({container:a.current,renderer:"svg",loop:n,autoplay:e,animationData:y});l.current=w,d(!0)}catch(x){console.error("Error loading Lottie animation:",x),v&&(p(!0),d(!0))}})(),()=>{v=!1,l.current&&(l.current.destroy(),l.current=null)}},[t,m,f,e,n,o]),f&&o?u.jsx("div",{className:r,children:o}):h&&o?u.jsx("div",{className:r,children:o}):u.jsx("div",{ref:a,className:r,"aria-label":i,"aria-hidden":i?void 0:"true",role:i?"img":void 0})},Zk=t=>{const e=_.useRef(null),n=BY(e,{once:(t==null?void 0:t.once)??!0,amount:(t==null?void 0:t.threshold)??.15});return{ref:e,isInView:n}},Vee={hidden:{opacity:0,y:30},visible:{opacity:1,y:0,transition:{duration:.6,ease:"easeOut"}}},Jk={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.1}}},lg={hidden:{opacity:0,y:18},visible:{opacity:1,y:0,transition:{duration:.6,ease:[.2,.9,.3,1]}}},e3=()=>{const t=Nl(),e=_.useRef(null),[n,r]=_.useState(null);_.useEffect(()=>{he.auth.getSession().then(({data:{session:l}})=>{r((l==null?void 0:l.user)??null)})},[]);const i=()=>{Ao(n?"/dashboard":"/auth")},{scrollY:s}=bB();eg(s,[0,500],[0,100]),eg(s,[0,300],[1,0]);const[o,a]=_.useState({x:0,y:0});return _.useEffect(()=>{if(e.current){const l=e.current.getBoundingClientRect();a({x:l.left+l.width/2,y:l.top+l.height/2})}},[]),u.jsxs(Re.section,{className:"relative min-h-screen bg-gradient-to-b from-gray-50 to-white dark:from-background dark:to-card text-hero-foreground dark:text-foreground overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:[u.jsx(zee,{}),u.jsx("div",{className:"container mx-auto px-8 md:px-12 pb-8 md:pb-16 relative z-10",children:u.jsxs("div",{className:"grid md:grid-cols-2 gap-16 items-center min-h-[600px]",children:[u.jsxs(Re.div,{className:"space-y-6 md:space-y-8 flex flex-col justify-center",initial:"hidden",animate:"visible",variants:Vee,children:[u.jsxs(Re.div,{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-primary/10 dark:bg-primary/20 border border-primary/20 dark:border-primary/30 text-xs font-medium mb-2",style:{width:"fit-content"},initial:t?{opacity:1,x:0}:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:zt(t)||{delay:.2,duration:.5},children:[u.jsx(yd,{className:"h-3 w-3 text-primary"}),u.jsx("span",{children:"AI-Powered Process Intelligence"})]}),u.jsx(Re.h1,{className:"text-5xl md:text-7xl font-bold leading-tight tracking-tight",initial:t?{opacity:1,y:0}:{opacity:0,y:20},animate:{opacity:1,y:0},transition:zt(t)||{delay:.4,duration:.7,ease:"easeOut"},children:"ProssMind"}),u.jsx(Re.p,{className:"text-lg md:text-xl text-foreground/80 dark:text-foreground/80 max-w-lg leading-relaxed",initial:t?{opacity:1,y:0}:{opacity:0,y:10},animate:{opacity:1,y:0},transition:zt(t)||{delay:1.1,duration:.6},children:"Swiss AI Process Intelligence  GDPR Compliant  Locally Hosted."}),u.jsxs(Re.div,{className:"flex flex-col gap-4 sm:flex-row sm:gap-6 pt-2",initial:t?{opacity:1,y:0}:{opacity:0,y:20},animate:{opacity:1,y:0},transition:zt(t)||{delay:.5,duration:.6},children:[u.jsx(Re.div,{whileHover:t?{}:{scale:1.02},transition:zt(t)||{duration:.2},children:u.jsx(G,{size:"lg",className:"group text-base px-8 py-6 shadow-lg hover:shadow-xl transition-all focus-visible:outline-2 focus-visible:outline-offset-2 relative overflow-hidden",onClick:i,"aria-label":"Try ProssMind for free",style:{background:"linear-gradient(135deg, hsl(var(--primary)), hsl(var(--primary) / 0.9))"},children:u.jsxs(Re.span,{className:"flex items-center",whileHover:t?{}:{scale:1.02},children:["Try It Free",u.jsx(Re.span,{className:"ml-2",animate:t?{x:0}:{x:[0,4,0]},transition:zt(t)||{duration:1.5,repeat:1/0,repeatDelay:2},children:u.jsx(Xh,{className:"h-5 w-5 group-hover:translate-x-1 transition-transform","aria-hidden":"true"})})]})})}),u.jsx(Re.div,{whileHover:t?{}:{scale:1.02},transition:zt(t)||{duration:.2},children:u.jsx(G,{size:"lg",variant:"outline",className:"group text-base px-8 py-6 bg-hero-foreground/5 dark:bg-foreground/5 hover:bg-primary/5 border-2 border-primary/30 hover:border-primary transition-all focus-visible:outline-2 focus-visible:outline-offset-2 relative","aria-label":"View ProssMind features",style:{boxShadow:"0 0 0px rgba(100, 180, 255, 0)"},onMouseEnter:l=>{l.currentTarget.style.boxShadow="0 0 15px rgba(100, 180, 255, 0.5)",l.currentTarget.style.color="hsl(var(--primary))"},onMouseLeave:l=>{l.currentTarget.style.boxShadow="0 0 0px rgba(100, 180, 255, 0)",l.currentTarget.style.color=""},children:u.jsxs("span",{className:"flex items-center",children:["View Features",u.jsx(Re.span,{initial:t?{opacity:1,x:0}:{opacity:0,x:-5},whileHover:t?{}:{opacity:1,x:0},transition:zt(t)||{duration:.2},className:"ml-2",children:u.jsx(Ag,{className:"h-5 w-5","aria-hidden":"true"})})]})})})]})]}),u.jsxs(Re.div,{ref:e,className:"relative",initial:t?{opacity:1,x:0}:{opacity:0,x:50},animate:{opacity:1,x:0},transition:zt(t)||{delay:.6,duration:.7},children:[o.x>0&&o.y>0&&u.jsx(Hee,{containerRef:e,centerX:o.x,centerY:o.y}),u.jsx(Re.div,{className:"absolute inset-0 bg-primary/20 dark:bg-primary/10 blur-3xl rounded-full glow-effect",animate:t?{scale:1}:{scale:[1,1.1,1]},transition:zt(t)||{duration:4,repeat:1/0}}),u.jsx(Re.div,{className:"relative z-10 rounded-2xl overflow-hidden shadow-2xl border border-hero-foreground/10 dark:border-border/50",whileHover:t?{}:{scale:1.02},animate:t?{scale:1}:{scale:[1,1.02,1]},transition:zt(t)||{duration:2,repeat:1/0,ease:"easeInOut"},children:u.jsx(Uee,{src:"/animations/brain-flow.json",autoplay:!0,loop:!0,className:"w-full h-auto","aria-label":"Mind and Process Mining Intelligence animation",lazy:!0,fallback:u.jsx("img",{src:Fee,alt:"Mind and Process Mining Intelligence",className:"w-full h-auto",loading:"lazy"})})})]})]})}),u.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-24 bg-gradient-to-t from-background to-transparent"})]})},t3=()=>{const t=Nl(),e=[{icon:nr,title:"Upload Your Document",description:"Upload images, PDFs, Word documents, or text files describing your process.",color:"text-blue-500",glowColor:"blue"},{icon:WJ,title:"AI Analysis",description:"Our AI analyzes your document and extracts process information using advanced NLP.",color:"text-purple-500",glowColor:"purple"},{icon:js,title:"BPMN Generation",description:"The AI generates a complete BPMN diagram with tasks, gateways, and flows.",color:"text-green-500",glowColor:"green"},{icon:Vm,title:"Ready to Use",description:"Download your BPMN diagram or integrate directly with your workflow tools.",color:"text-primary",glowColor:"primary"}],n=r=>{switch(r){case"blue":return"hover:shadow-[0_0_20px_rgba(59,130,246,0.5)] hover:shadow-blue-500/50";case"purple":return"hover:shadow-[0_0_20px_rgba(168,85,247,0.5)] hover:shadow-purple-500/50";case"green":return"hover:shadow-[0_0_20px_rgba(34,197,94,0.5)] hover:shadow-green-500/50";case"primary":return"hover:shadow-[0_0_20px_hsl(var(--primary))] hover:shadow-primary/50";default:return"hover:shadow-[0_0_20px_rgba(59,130,246,0.5)]"}};return u.jsx(Re.section,{className:"py-24 bg-background relative overflow-hidden",initial:t?{opacity:1}:{opacity:0,y:50},whileInView:{opacity:1,y:0},viewport:{once:!0,amount:.2},transition:zt(t)||{duration:.7},children:u.jsxs("div",{className:"container mx-auto px-6",children:[u.jsxs(Re.div,{className:"text-center mb-16",initial:t?{opacity:1,y:0}:{opacity:0,y:30,scale:.95},whileInView:{opacity:1,y:0,scale:1},viewport:{once:!0,amount:.3},transition:zt(t)||{duration:.6,delay:.2},children:[u.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"How It Works"}),u.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"From document to diagram in seconds"})]}),u.jsx("div",{className:"max-w-4xl mx-auto",children:u.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-8",children:e.map((r,i)=>{const s=r.icon;return u.jsxs(Re.div,{className:`text-center space-y-4 p-6 rounded-2xl transition-all duration-300 cursor-pointer ${n(r.glowColor)}`,initial:t?{opacity:1,y:0}:{opacity:0,y:20},whileInView:t?{}:{opacity:1,y:0},viewport:{once:!0,amount:.5},transition:zt(t)||{duration:.6,delay:i*.1},whileHover:t?{}:{scale:1.05,y:-5},children:[u.jsx(Re.div,{className:"w-16 h-16 mx-auto rounded-full bg-muted flex items-center justify-center transition-all duration-300","aria-hidden":"true",children:u.jsx(s,{className:`h-8 w-8 ${r.color} transition-all duration-300`,"aria-hidden":"true"})}),u.jsx("h3",{className:"text-xl font-semibold",children:r.title}),u.jsx("p",{className:"text-sm text-muted-foreground",children:r.description})]},i)})})})]})})},De=_.forwardRef(({className:t,...e},n)=>u.jsx("div",{ref:n,className:Se("rounded-lg border bg-card text-card-foreground shadow-sm",t),...e}));De.displayName="Card";const He=_.forwardRef(({className:t,...e},n)=>u.jsx("div",{ref:n,className:Se("flex flex-col space-y-1.5 p-6",t),...e}));He.displayName="CardHeader";const We=_.forwardRef(({className:t,...e},n)=>u.jsx("h3",{ref:n,className:Se("text-2xl font-semibold leading-none tracking-tight",t),...e}));We.displayName="CardTitle";const Je=_.forwardRef(({className:t,...e},n)=>u.jsx("p",{ref:n,className:Se("text-sm text-muted-foreground",t),...e}));Je.displayName="CardDescription";const Ue=_.forwardRef(({className:t,...e},n)=>u.jsx("div",{ref:n,className:Se("p-6 pt-0",t),...e}));Ue.displayName="CardContent";const qee=_.forwardRef(({className:t,...e},n)=>u.jsx("div",{ref:n,className:Se("flex items-center p-6 pt-0",t),...e}));qee.displayName="CardFooter";const Wee=[{icon:js,title:"Process Generator",description:"Design and build automated business processes with powerful AI capabilities."},{icon:Ia,title:"Vision Automation",description:"Automate visual tasks with advanced computer vision and image processing."},{icon:Ip,title:"BPMN Integration",description:"Download BPMN diagrams and integrate with SAP Signavio, Camunda, Flowable, and more."}],n3=()=>{const t=Nl(),{ref:e,isInView:n}=Zk({threshold:.1});return u.jsx(Re.section,{className:"py-24 bg-muted/30 relative",initial:t?{opacity:1}:{opacity:0,y:50},whileInView:{opacity:1,y:0},viewport:{once:!0,amount:.2},transition:zt(t)||{duration:.7},children:u.jsxs("div",{className:"container mx-auto px-6",children:[u.jsxs(Re.div,{className:"text-center mb-16",initial:t?{opacity:1,y:0}:{opacity:0,y:30,scale:.95},whileInView:{opacity:1,y:0,scale:1},viewport:{once:!0,amount:.3},transition:zt(t)||{duration:.6,delay:.2},children:[u.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Powerful Features"}),u.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Everything you need to automate and optimize your business processes"})]}),u.jsx(Re.div,{ref:e,className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",variants:Jk,initial:"hidden",animate:n?"visible":"hidden",children:Wee.map((r,i)=>u.jsx(Re.div,{variants:t?void 0:lg,whileHover:t?{}:{y:-12,rotateY:2,rotateX:2,scale:1.03},transition:zt(t)||{duration:.3},style:{perspective:1e3},children:u.jsxs(De,{className:"card-hover cursor-pointer border-border/50 hover:border-primary bg-card/50 backdrop-blur-sm flex flex-col h-full rounded-2xl shadow-md transition-all p-6 relative overflow-hidden group",style:{boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},role:"article","aria-label":`Feature: ${r.title}`,children:[u.jsx(Re.div,{className:"absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity",style:{background:"linear-gradient(45deg, hsl(var(--primary)), hsl(var(--accent)))",padding:"1px"},initial:!1,children:u.jsx("div",{className:"w-full h-full bg-card/50 backdrop-blur-sm rounded-2xl"})}),u.jsxs(He,{className:"flex-shrink-0 relative z-10",children:[u.jsxs(Re.div,{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center mb-6 tech-glow relative",animate:t?{rotate:0}:{rotate:[-2,2,-2]},transition:zt(t)||{duration:4,repeat:1/0,ease:"easeInOut"},whileHover:t?{}:{scale:1.15,rotate:15,filter:"brightness(1.3)"},children:[u.jsx(Re.div,{whileHover:t?{}:{scale:1.2},transition:zt(t)||{duration:.2},style:{filter:"drop-shadow(0 0 20px hsl(var(--primary)))"},children:u.jsx(r.icon,{className:"h-7 w-7 text-primary"})}),u.jsx(Re.div,{className:"absolute inset-0 rounded-xl bg-primary/20 blur-xl",animate:t?{scale:1,opacity:0}:{scale:[1,1.3,1],opacity:[0,.8,0]},transition:zt(t)||{duration:1.5,repeat:1/0,ease:"easeInOut"}})]}),u.jsx(We,{className:"text-2xl mb-2",children:r.title})]}),u.jsx(Ue,{className:"flex-grow flex flex-col relative z-10",children:u.jsx(Je,{className:"text-base leading-relaxed break-words overflow-visible min-h-0",children:r.description})})]})},i))})]})})},Gee=[{name:"ProssMind Light",description:"Perfect for individuals and small teams",features:["Basic automation features","Up to 5 processes","Community support","Basic analytics"]},{name:"ProssMind Vision",description:"Advanced features for growing businesses",features:["All Light features","Unlimited processes","Vision automation","Priority support","Advanced analytics","Custom integrations"],popular:!0},{name:"Custom Models",description:"Enterprise-grade solution",features:["All Vision features","Custom AI models","Dedicated support","On-premise deployment","SLA guarantee","Training & consulting"]}],e2=()=>{const{ref:t,isInView:e}=Zk({threshold:.1}),n=Nl();return u.jsx(Re.section,{className:"py-24 bg-background relative",initial:n?{opacity:1}:{opacity:0,y:50},whileInView:{opacity:1,y:0},viewport:{once:!0,amount:.2},transition:n?{}:{duration:.7},children:u.jsxs("div",{className:"container mx-auto px-6",children:[u.jsxs(Re.div,{className:"text-center mb-16",initial:n?{opacity:1,y:0}:{opacity:0,y:30,scale:.95},whileInView:{opacity:1,y:0,scale:1},viewport:{once:!0,amount:.3},transition:n?{}:{duration:.6,delay:.2},children:[u.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Choose Your Plan"}),u.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Select the perfect plan for your business needs"})]}),u.jsx(Re.div,{ref:t,className:"grid md:grid-cols-3 gap-8 max-w-6xl mx-auto",variants:Jk,initial:"hidden",animate:e?"visible":"hidden",children:Gee.map((r,i)=>u.jsx(Re.div,{variants:lg,whileHover:{y:-8,rotateY:r.popular?0:2,rotateX:r.popular?0:2,scale:r.popular?1.05:1.02},style:{perspective:1e3},children:u.jsxs(De,{className:`relative card-hover flex flex-col h-full transition-all ${r.popular?"border-primary shadow-2xl bg-gradient-to-b from-card to-primary/5 hover:border-primary/80":"border-border bg-card/50 backdrop-blur-sm hover:border-primary/50"}`,role:"article","aria-label":`Pricing tier: ${r.name}${r.popular?" - Most Popular":""}`,children:[r.popular&&u.jsxs(Re.div,{className:"absolute -top-4 left-1/2 -translate-x-1/2 z-10",animate:{scale:[1,1.08,1],opacity:[.8,1,.8]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},whileHover:{scale:1.1},children:[u.jsx(Re.span,{className:"bg-gradient-to-r from-primary to-accent text-primary-foreground text-sm font-semibold px-6 py-2 rounded-full shadow-lg block",animate:{boxShadow:["0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 0 20px rgba(37, 99, 235, 0.5)","0 10px 15px -3px rgba(37, 99, 235, 0.3), 0 0 30px rgba(37, 99, 235, 0.8)","0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 0 20px rgba(37, 99, 235, 0.5)"]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},children:"Most Popular"}),u.jsx(Re.div,{animate:{scale:[1,1.15,1]},transition:{duration:.3,repeat:1/0,repeatDelay:5,ease:"easeOut"},className:"absolute inset-0",style:{pointerEvents:"none"}})]}),u.jsxs(He,{className:"text-center pb-8 pt-8 flex-shrink-0",children:[u.jsx(We,{className:"text-2xl mb-3 font-bold",children:r.name}),u.jsx(Je,{className:"text-base",children:r.description})]}),u.jsxs(Ue,{className:"flex flex-col flex-grow space-y-8",children:[u.jsx("ul",{className:"space-y-4 flex-grow",children:r.features.map((s,o)=>u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx("div",{className:"rounded-full bg-primary/10 p-1 flex-shrink-0",children:u.jsx(ns,{className:"h-4 w-4 text-primary"})}),u.jsx("span",{className:"text-sm leading-relaxed",children:s})]},o))}),u.jsx(G,{className:`w-full text-base py-6 mt-auto hover:scale-[1.03] transition-all ${r.popular?"shadow-lg hover:shadow-xl":""}`,variant:r.popular?"default":"outline",size:"lg","aria-label":`Get started with ${r.name}`,children:"Get Started"})]})]})},i))})]})})},$i=_.forwardRef(({className:t,...e},n)=>u.jsx("textarea",{className:Se("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground transition-all duration-200 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:border-ring focus-visible:shadow-[0_0_0_1px_hsl(var(--ring)),0_0_8px_hsl(var(--ring)/0.3)] disabled:cursor-not-allowed disabled:opacity-50",t),ref:n,...e}));$i.displayName="Textarea";function rC(t,[e,n]){return Math.min(n,Math.max(e,t))}function Kee(t,e){return _.useReducer((n,r)=>e[n][r]??n,t)}var t2="ScrollArea",[r3]=Tl(t2),[Yee,ao]=r3(t2),i3=_.forwardRef((t,e)=>{const{__scopeScrollArea:n,type:r="hover",dir:i,scrollHideDelay:s=600,...o}=t,[a,l]=_.useState(null),[c,d]=_.useState(null),[h,p]=_.useState(null),[f,m]=_.useState(null),[g,v]=_.useState(null),[b,x]=_.useState(0),[y,w]=_.useState(0),[E,S]=_.useState(!1),[j,C]=_.useState(!1),P=Mn(e,N=>l(N)),R=uw(i);return u.jsx(Yee,{scope:n,type:r,dir:R,scrollHideDelay:s,scrollArea:a,viewport:c,onViewportChange:d,content:h,onContentChange:p,scrollbarX:f,onScrollbarXChange:m,scrollbarXEnabled:E,onScrollbarXEnabledChange:S,scrollbarY:g,onScrollbarYChange:v,scrollbarYEnabled:j,onScrollbarYEnabledChange:C,onCornerWidthChange:x,onCornerHeightChange:w,children:u.jsx(Yt.div,{dir:R,...o,ref:P,style:{position:"relative","--radix-scroll-area-corner-width":b+"px","--radix-scroll-area-corner-height":y+"px",...t.style}})})});i3.displayName=t2;var s3="ScrollAreaViewport",o3=_.forwardRef((t,e)=>{const{__scopeScrollArea:n,children:r,nonce:i,...s}=t,o=ao(s3,n),a=_.useRef(null),l=Mn(e,a,o.onViewportChange);return u.jsxs(u.Fragment,{children:[u.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:i}),u.jsx(Yt.div,{"data-radix-scroll-area-viewport":"",...s,ref:l,style:{overflowX:o.scrollbarXEnabled?"scroll":"hidden",overflowY:o.scrollbarYEnabled?"scroll":"hidden",...t.style},children:u.jsx("div",{ref:o.onContentChange,style:{minWidth:"100%",display:"table"},children:r})})]})});o3.displayName=s3;var Ba="ScrollAreaScrollbar",n2=_.forwardRef((t,e)=>{const{forceMount:n,...r}=t,i=ao(Ba,t.__scopeScrollArea),{onScrollbarXEnabledChange:s,onScrollbarYEnabledChange:o}=i,a=t.orientation==="horizontal";return _.useEffect(()=>(a?s(!0):o(!0),()=>{a?s(!1):o(!1)}),[a,s,o]),i.type==="hover"?u.jsx(Xee,{...r,ref:e,forceMount:n}):i.type==="scroll"?u.jsx(Qee,{...r,ref:e,forceMount:n}):i.type==="auto"?u.jsx(a3,{...r,ref:e,forceMount:n}):i.type==="always"?u.jsx(r2,{...r,ref:e}):null});n2.displayName=Ba;var Xee=_.forwardRef((t,e)=>{const{forceMount:n,...r}=t,i=ao(Ba,t.__scopeScrollArea),[s,o]=_.useState(!1);return _.useEffect(()=>{const a=i.scrollArea;let l=0;if(a){const c=()=>{window.clearTimeout(l),o(!0)},d=()=>{l=window.setTimeout(()=>o(!1),i.scrollHideDelay)};return a.addEventListener("pointerenter",c),a.addEventListener("pointerleave",d),()=>{window.clearTimeout(l),a.removeEventListener("pointerenter",c),a.removeEventListener("pointerleave",d)}}},[i.scrollArea,i.scrollHideDelay]),u.jsx(Gc,{present:n||s,children:u.jsx(a3,{"data-state":s?"visible":"hidden",...r,ref:e})})}),Qee=_.forwardRef((t,e)=>{const{forceMount:n,...r}=t,i=ao(Ba,t.__scopeScrollArea),s=t.orientation==="horizontal",o=xw(()=>l("SCROLL_END"),100),[a,l]=Kee("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return _.useEffect(()=>{if(a==="idle"){const c=window.setTimeout(()=>l("HIDE"),i.scrollHideDelay);return()=>window.clearTimeout(c)}},[a,i.scrollHideDelay,l]),_.useEffect(()=>{const c=i.viewport,d=s?"scrollLeft":"scrollTop";if(c){let h=c[d];const p=()=>{const f=c[d];h!==f&&(l("SCROLL"),o()),h=f};return c.addEventListener("scroll",p),()=>c.removeEventListener("scroll",p)}},[i.viewport,s,l,o]),u.jsx(Gc,{present:n||a!=="hidden",children:u.jsx(r2,{"data-state":a==="hidden"?"hidden":"visible",...r,ref:e,onPointerEnter:Pt(t.onPointerEnter,()=>l("POINTER_ENTER")),onPointerLeave:Pt(t.onPointerLeave,()=>l("POINTER_LEAVE"))})})}),a3=_.forwardRef((t,e)=>{const n=ao(Ba,t.__scopeScrollArea),{forceMount:r,...i}=t,[s,o]=_.useState(!1),a=t.orientation==="horizontal",l=xw(()=>{if(n.viewport){const c=n.viewport.offsetWidth<n.viewport.scrollWidth,d=n.viewport.offsetHeight<n.viewport.scrollHeight;o(a?c:d)}},10);return Dp(n.viewport,l),Dp(n.content,l),u.jsx(Gc,{present:r||s,children:u.jsx(r2,{"data-state":s?"visible":"hidden",...i,ref:e})})}),r2=_.forwardRef((t,e)=>{const{orientation:n="vertical",...r}=t,i=ao(Ba,t.__scopeScrollArea),s=_.useRef(null),o=_.useRef(0),[a,l]=_.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),c=h3(a.viewport,a.content),d={...r,sizes:a,onSizesChange:l,hasThumb:c>0&&c<1,onThumbChange:p=>s.current=p,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:p=>o.current=p};function h(p,f){return rte(p,o.current,a,f)}return n==="horizontal"?u.jsx(Zee,{...d,ref:e,onThumbPositionChange:()=>{if(i.viewport&&s.current){const p=i.viewport.scrollLeft,f=cR(p,a,i.dir);s.current.style.transform=`translate3d(${f}px, 0, 0)`}},onWheelScroll:p=>{i.viewport&&(i.viewport.scrollLeft=p)},onDragScroll:p=>{i.viewport&&(i.viewport.scrollLeft=h(p,i.dir))}}):n==="vertical"?u.jsx(Jee,{...d,ref:e,onThumbPositionChange:()=>{if(i.viewport&&s.current){const p=i.viewport.scrollTop,f=cR(p,a);s.current.style.transform=`translate3d(0, ${f}px, 0)`}},onWheelScroll:p=>{i.viewport&&(i.viewport.scrollTop=p)},onDragScroll:p=>{i.viewport&&(i.viewport.scrollTop=h(p))}}):null}),Zee=_.forwardRef((t,e)=>{const{sizes:n,onSizesChange:r,...i}=t,s=ao(Ba,t.__scopeScrollArea),[o,a]=_.useState(),l=_.useRef(null),c=Mn(e,l,s.onScrollbarXChange);return _.useEffect(()=>{l.current&&a(getComputedStyle(l.current))},[l]),u.jsx(c3,{"data-orientation":"horizontal",...i,ref:c,sizes:n,style:{bottom:0,left:s.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:s.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":yw(n)+"px",...t.style},onThumbPointerDown:d=>t.onThumbPointerDown(d.x),onDragScroll:d=>t.onDragScroll(d.x),onWheelScroll:(d,h)=>{if(s.viewport){const p=s.viewport.scrollLeft+d.deltaX;t.onWheelScroll(p),f3(p,h)&&d.preventDefault()}},onResize:()=>{l.current&&s.viewport&&o&&r({content:s.viewport.scrollWidth,viewport:s.viewport.offsetWidth,scrollbar:{size:l.current.clientWidth,paddingStart:i0(o.paddingLeft),paddingEnd:i0(o.paddingRight)}})}})}),Jee=_.forwardRef((t,e)=>{const{sizes:n,onSizesChange:r,...i}=t,s=ao(Ba,t.__scopeScrollArea),[o,a]=_.useState(),l=_.useRef(null),c=Mn(e,l,s.onScrollbarYChange);return _.useEffect(()=>{l.current&&a(getComputedStyle(l.current))},[l]),u.jsx(c3,{"data-orientation":"vertical",...i,ref:c,sizes:n,style:{top:0,right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":yw(n)+"px",...t.style},onThumbPointerDown:d=>t.onThumbPointerDown(d.y),onDragScroll:d=>t.onDragScroll(d.y),onWheelScroll:(d,h)=>{if(s.viewport){const p=s.viewport.scrollTop+d.deltaY;t.onWheelScroll(p),f3(p,h)&&d.preventDefault()}},onResize:()=>{l.current&&s.viewport&&o&&r({content:s.viewport.scrollHeight,viewport:s.viewport.offsetHeight,scrollbar:{size:l.current.clientHeight,paddingStart:i0(o.paddingTop),paddingEnd:i0(o.paddingBottom)}})}})}),[ete,l3]=r3(Ba),c3=_.forwardRef((t,e)=>{const{__scopeScrollArea:n,sizes:r,hasThumb:i,onThumbChange:s,onThumbPointerUp:o,onThumbPointerDown:a,onThumbPositionChange:l,onDragScroll:c,onWheelScroll:d,onResize:h,...p}=t,f=ao(Ba,n),[m,g]=_.useState(null),v=Mn(e,P=>g(P)),b=_.useRef(null),x=_.useRef(""),y=f.viewport,w=r.content-r.viewport,E=ws(d),S=ws(l),j=xw(h,10);function C(P){if(b.current){const R=P.clientX-b.current.left,N=P.clientY-b.current.top;c({x:R,y:N})}}return _.useEffect(()=>{const P=R=>{const N=R.target;(m==null?void 0:m.contains(N))&&E(R,w)};return document.addEventListener("wheel",P,{passive:!1}),()=>document.removeEventListener("wheel",P,{passive:!1})},[y,m,w,E]),_.useEffect(S,[r,S]),Dp(m,j),Dp(f.content,j),u.jsx(ete,{scope:n,scrollbar:m,hasThumb:i,onThumbChange:ws(s),onThumbPointerUp:ws(o),onThumbPositionChange:S,onThumbPointerDown:ws(a),children:u.jsx(Yt.div,{...p,ref:v,style:{position:"absolute",...p.style},onPointerDown:Pt(t.onPointerDown,P=>{P.button===0&&(P.target.setPointerCapture(P.pointerId),b.current=m.getBoundingClientRect(),x.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",f.viewport&&(f.viewport.style.scrollBehavior="auto"),C(P))}),onPointerMove:Pt(t.onPointerMove,C),onPointerUp:Pt(t.onPointerUp,P=>{const R=P.target;R.hasPointerCapture(P.pointerId)&&R.releasePointerCapture(P.pointerId),document.body.style.webkitUserSelect=x.current,f.viewport&&(f.viewport.style.scrollBehavior=""),b.current=null})})})}),r0="ScrollAreaThumb",u3=_.forwardRef((t,e)=>{const{forceMount:n,...r}=t,i=l3(r0,t.__scopeScrollArea);return u.jsx(Gc,{present:n||i.hasThumb,children:u.jsx(tte,{ref:e,...r})})}),tte=_.forwardRef((t,e)=>{const{__scopeScrollArea:n,style:r,...i}=t,s=ao(r0,n),o=l3(r0,n),{onThumbPositionChange:a}=o,l=Mn(e,h=>o.onThumbChange(h)),c=_.useRef(void 0),d=xw(()=>{c.current&&(c.current(),c.current=void 0)},100);return _.useEffect(()=>{const h=s.viewport;if(h){const p=()=>{if(d(),!c.current){const f=ite(h,a);c.current=f,a()}};return a(),h.addEventListener("scroll",p),()=>h.removeEventListener("scroll",p)}},[s.viewport,d,a]),u.jsx(Yt.div,{"data-state":o.hasThumb?"visible":"hidden",...i,ref:l,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...r},onPointerDownCapture:Pt(t.onPointerDownCapture,h=>{const f=h.target.getBoundingClientRect(),m=h.clientX-f.left,g=h.clientY-f.top;o.onThumbPointerDown({x:m,y:g})}),onPointerUp:Pt(t.onPointerUp,o.onThumbPointerUp)})});u3.displayName=r0;var i2="ScrollAreaCorner",d3=_.forwardRef((t,e)=>{const n=ao(i2,t.__scopeScrollArea),r=!!(n.scrollbarX&&n.scrollbarY);return n.type!=="scroll"&&r?u.jsx(nte,{...t,ref:e}):null});d3.displayName=i2;var nte=_.forwardRef((t,e)=>{const{__scopeScrollArea:n,...r}=t,i=ao(i2,n),[s,o]=_.useState(0),[a,l]=_.useState(0),c=!!(s&&a);return Dp(i.scrollbarX,()=>{var h;const d=((h=i.scrollbarX)==null?void 0:h.offsetHeight)||0;i.onCornerHeightChange(d),l(d)}),Dp(i.scrollbarY,()=>{var h;const d=((h=i.scrollbarY)==null?void 0:h.offsetWidth)||0;i.onCornerWidthChange(d),o(d)}),c?u.jsx(Yt.div,{...r,ref:e,style:{width:s,height:a,position:"absolute",right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function i0(t){return t?parseInt(t,10):0}function h3(t,e){const n=t/e;return isNaN(n)?0:n}function yw(t){const e=h3(t.viewport,t.content),n=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,r=(t.scrollbar.size-n)*e;return Math.max(r,18)}function rte(t,e,n,r="ltr"){const i=yw(n),s=i/2,o=e||s,a=i-o,l=n.scrollbar.paddingStart+o,c=n.scrollbar.size-n.scrollbar.paddingEnd-a,d=n.content-n.viewport,h=r==="ltr"?[0,d]:[d*-1,0];return p3([l,c],h)(t)}function cR(t,e,n="ltr"){const r=yw(e),i=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,s=e.scrollbar.size-i,o=e.content-e.viewport,a=s-r,l=n==="ltr"?[0,o]:[o*-1,0],c=rC(t,l);return p3([0,o],[0,a])(c)}function p3(t,e){return n=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(t[1]-t[0]);return e[0]+r*(n-t[0])}}function f3(t,e){return t>0&&t<e}var ite=(t,e=()=>{})=>{let n={left:t.scrollLeft,top:t.scrollTop},r=0;return function i(){const s={left:t.scrollLeft,top:t.scrollTop},o=n.left!==s.left,a=n.top!==s.top;(o||a)&&e(),n=s,r=window.requestAnimationFrame(i)}(),()=>window.cancelAnimationFrame(r)};function xw(t,e){const n=ws(t),r=_.useRef(0);return _.useEffect(()=>()=>window.clearTimeout(r.current),[]),_.useCallback(()=>{window.clearTimeout(r.current),r.current=window.setTimeout(n,e)},[n,e])}function Dp(t,e){const n=ws(e);as(()=>{let r=0;if(t){const i=new ResizeObserver(()=>{cancelAnimationFrame(r),r=window.requestAnimationFrame(n)});return i.observe(t),()=>{window.cancelAnimationFrame(r),i.unobserve(t)}}},[t,n])}var m3=i3,ste=o3,ote=d3;const vc=_.forwardRef(({className:t,children:e,...n},r)=>u.jsxs(m3,{ref:r,className:Se("relative overflow-hidden",t),...n,children:[u.jsx(ste,{className:"h-full w-full rounded-[inherit]",children:e}),u.jsx(g3,{}),u.jsx(ote,{})]}));vc.displayName=m3.displayName;const g3=_.forwardRef(({className:t,orientation:e="vertical",...n},r)=>u.jsx(n2,{ref:r,orientation:e,className:Se("flex touch-none select-none transition-colors",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...n,children:u.jsx(u3,{className:"relative flex-1 rounded-full bg-border"})}));g3.displayName=n2.displayName;var ate=t=>{switch(t){case"success":return ute;case"info":return hte;case"warning":return dte;case"error":return pte;default:return null}},lte=Array(12).fill(0),cte=({visible:t,className:e})=>be.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":t},be.createElement("div",{className:"sonner-spinner"},lte.map((n,r)=>be.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),ute=be.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},be.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),dte=be.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},be.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),hte=be.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},be.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),pte=be.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},be.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),fte=be.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},be.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),be.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),mte=()=>{let[t,e]=be.useState(document.hidden);return be.useEffect(()=>{let n=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",n),()=>window.removeEventListener("visibilitychange",n)},[]),t},iC=1,gte=class{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{let e=this.subscribers.indexOf(t);this.subscribers.splice(e,1)}),this.publish=t=>{this.subscribers.forEach(e=>e(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var e;let{message:n,...r}=t,i=typeof(t==null?void 0:t.id)=="number"||((e=t.id)==null?void 0:e.length)>0?t.id:iC++,s=this.toasts.find(a=>a.id===i),o=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(i)&&this.dismissedToasts.delete(i),s?this.toasts=this.toasts.map(a=>a.id===i?(this.publish({...a,...t,id:i,title:n}),{...a,...t,id:i,dismissible:o,title:n}):a):this.addToast({title:n,...r,dismissible:o,id:i}),i},this.dismiss=t=>(this.dismissedToasts.add(t),t||this.toasts.forEach(e=>{this.subscribers.forEach(n=>n({id:e.id,dismiss:!0}))}),this.subscribers.forEach(e=>e({id:t,dismiss:!0})),t),this.message=(t,e)=>this.create({...e,message:t}),this.error=(t,e)=>this.create({...e,message:t,type:"error"}),this.success=(t,e)=>this.create({...e,type:"success",message:t}),this.info=(t,e)=>this.create({...e,type:"info",message:t}),this.warning=(t,e)=>this.create({...e,type:"warning",message:t}),this.loading=(t,e)=>this.create({...e,type:"loading",message:t}),this.promise=(t,e)=>{if(!e)return;let n;e.loading!==void 0&&(n=this.create({...e,promise:t,type:"loading",message:e.loading,description:typeof e.description!="function"?e.description:void 0}));let r=t instanceof Promise?t:t(),i=n!==void 0,s,o=r.then(async l=>{if(s=["resolve",l],be.isValidElement(l))i=!1,this.create({id:n,type:"default",message:l});else if(yte(l)&&!l.ok){i=!1;let c=typeof e.error=="function"?await e.error(`HTTP error! status: ${l.status}`):e.error,d=typeof e.description=="function"?await e.description(`HTTP error! status: ${l.status}`):e.description;this.create({id:n,type:"error",message:c,description:d})}else if(e.success!==void 0){i=!1;let c=typeof e.success=="function"?await e.success(l):e.success,d=typeof e.description=="function"?await e.description(l):e.description;this.create({id:n,type:"success",message:c,description:d})}}).catch(async l=>{if(s=["reject",l],e.error!==void 0){i=!1;let c=typeof e.error=="function"?await e.error(l):e.error,d=typeof e.description=="function"?await e.description(l):e.description;this.create({id:n,type:"error",message:c,description:d})}}).finally(()=>{var l;i&&(this.dismiss(n),n=void 0),(l=e.finally)==null||l.call(e)}),a=()=>new Promise((l,c)=>o.then(()=>s[0]==="reject"?c(s[1]):l(s[1])).catch(c));return typeof n!="string"&&typeof n!="number"?{unwrap:a}:Object.assign(n,{unwrap:a})},this.custom=(t,e)=>{let n=(e==null?void 0:e.id)||iC++;return this.create({jsx:t(n),id:n,...e}),n},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},es=new gte,vte=(t,e)=>{let n=(e==null?void 0:e.id)||iC++;return es.addToast({title:t,...e,id:n}),n},yte=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",xte=vte,bte=()=>es.toasts,wte=()=>es.getActiveToasts(),L=Object.assign(xte,{success:es.success,info:es.info,warning:es.warning,error:es.error,custom:es.custom,message:es.message,promise:es.promise,dismiss:es.dismiss,loading:es.loading},{getHistory:bte,getToasts:wte});function _te(t,{insertAt:e}={}){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",e==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}_te(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function Fy(t){return t.label!==void 0}var Ete=3,Ste="32px",Cte="16px",uR=4e3,jte=356,kte=14,Pte=20,Tte=200;function Eo(...t){return t.filter(Boolean).join(" ")}function Nte(t){let[e,n]=t.split("-"),r=[];return e&&r.push(e),n&&r.push(n),r}var Ote=t=>{var e,n,r,i,s,o,a,l,c,d,h;let{invert:p,toast:f,unstyled:m,interacting:g,setHeights:v,visibleToasts:b,heights:x,index:y,toasts:w,expanded:E,removeToast:S,defaultRichColors:j,closeButton:C,style:P,cancelButtonStyle:R,actionButtonStyle:N,className:I="",descriptionClassName:M="",duration:W,position:ce,gap:se,loadingIcon:ve,expandByDefault:pt,classNames:je,icons:lt,closeButtonAriaLabel:Nt="Close toast",pauseWhenPageIsHidden:Ae}=t,[Qe,ze]=be.useState(null),[Ot,Zt]=be.useState(null),[me,oe]=be.useState(!1),[pe,ne]=be.useState(!1),[Te,de]=be.useState(!1),[Ie,qe]=be.useState(!1),[_t,Ht]=be.useState(!1),[on,te]=be.useState(0),[Be,xe]=be.useState(0),ct=be.useRef(f.duration||W||uR),ft=be.useRef(null),nt=be.useRef(null),fe=y===0,Ye=y+1<=b,In=f.type,wr=f.dismissible!==!1,Jt=f.className||"",Zo=f.descriptionClassName||"",Yi=be.useMemo(()=>x.findIndex(jt=>jt.toastId===f.id)||0,[x,f.id]),Jo=be.useMemo(()=>{var jt;return(jt=f.closeButton)!=null?jt:C},[f.closeButton,C]),Ds=be.useMemo(()=>f.duration||W||uR,[f.duration,W]),Su=be.useRef(0),ea=be.useRef(0),fh=be.useRef(0),ta=be.useRef(null),[nm,na]=ce.split("-"),ra=be.useMemo(()=>x.reduce((jt,en,Sn)=>Sn>=Yi?jt:jt+en.height,0),[x,Yi]),mh=mte(),Cu=f.invert||p,Gl=In==="loading";ea.current=be.useMemo(()=>Yi*se+ra,[Yi,ra]),be.useEffect(()=>{ct.current=Ds},[Ds]),be.useEffect(()=>{oe(!0)},[]),be.useEffect(()=>{let jt=nt.current;if(jt){let en=jt.getBoundingClientRect().height;return xe(en),v(Sn=>[{toastId:f.id,height:en,position:f.position},...Sn]),()=>v(Sn=>Sn.filter(fi=>fi.toastId!==f.id))}},[v,f.id]),be.useLayoutEffect(()=>{if(!me)return;let jt=nt.current,en=jt.style.height;jt.style.height="auto";let Sn=jt.getBoundingClientRect().height;jt.style.height=en,xe(Sn),v(fi=>fi.find(ei=>ei.toastId===f.id)?fi.map(ei=>ei.toastId===f.id?{...ei,height:Sn}:ei):[{toastId:f.id,height:Sn,position:f.position},...fi])},[me,f.title,f.description,v,f.id]);let Xi=be.useCallback(()=>{ne(!0),te(ea.current),v(jt=>jt.filter(en=>en.toastId!==f.id)),setTimeout(()=>{S(f)},Tte)},[f,S,v,ea]);be.useEffect(()=>{if(f.promise&&In==="loading"||f.duration===1/0||f.type==="loading")return;let jt;return E||g||Ae&&mh?(()=>{if(fh.current<Su.current){let en=new Date().getTime()-Su.current;ct.current=ct.current-en}fh.current=new Date().getTime()})():ct.current!==1/0&&(Su.current=new Date().getTime(),jt=setTimeout(()=>{var en;(en=f.onAutoClose)==null||en.call(f,f),Xi()},ct.current)),()=>clearTimeout(jt)},[E,g,f,In,Ae,mh,Xi]),be.useEffect(()=>{f.delete&&Xi()},[Xi,f.delete]);function rm(){var jt,en,Sn;return lt!=null&&lt.loading?be.createElement("div",{className:Eo(je==null?void 0:je.loader,(jt=f==null?void 0:f.classNames)==null?void 0:jt.loader,"sonner-loader"),"data-visible":In==="loading"},lt.loading):ve?be.createElement("div",{className:Eo(je==null?void 0:je.loader,(en=f==null?void 0:f.classNames)==null?void 0:en.loader,"sonner-loader"),"data-visible":In==="loading"},ve):be.createElement(cte,{className:Eo(je==null?void 0:je.loader,(Sn=f==null?void 0:f.classNames)==null?void 0:Sn.loader),visible:In==="loading"})}return be.createElement("li",{tabIndex:0,ref:nt,className:Eo(I,Jt,je==null?void 0:je.toast,(e=f==null?void 0:f.classNames)==null?void 0:e.toast,je==null?void 0:je.default,je==null?void 0:je[In],(n=f==null?void 0:f.classNames)==null?void 0:n[In]),"data-sonner-toast":"","data-rich-colors":(r=f.richColors)!=null?r:j,"data-styled":!(f.jsx||f.unstyled||m),"data-mounted":me,"data-promise":!!f.promise,"data-swiped":_t,"data-removed":pe,"data-visible":Ye,"data-y-position":nm,"data-x-position":na,"data-index":y,"data-front":fe,"data-swiping":Te,"data-dismissible":wr,"data-type":In,"data-invert":Cu,"data-swipe-out":Ie,"data-swipe-direction":Ot,"data-expanded":!!(E||pt&&me),style:{"--index":y,"--toasts-before":y,"--z-index":w.length-y,"--offset":`${pe?on:ea.current}px`,"--initial-height":pt?"auto":`${Be}px`,...P,...f.style},onDragEnd:()=>{de(!1),ze(null),ta.current=null},onPointerDown:jt=>{Gl||!wr||(ft.current=new Date,te(ea.current),jt.target.setPointerCapture(jt.pointerId),jt.target.tagName!=="BUTTON"&&(de(!0),ta.current={x:jt.clientX,y:jt.clientY}))},onPointerUp:()=>{var jt,en,Sn,fi;if(Ie||!wr)return;ta.current=null;let ei=Number(((jt=nt.current)==null?void 0:jt.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),ki=Number(((en=nt.current)==null?void 0:en.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),zr=new Date().getTime()-((Sn=ft.current)==null?void 0:Sn.getTime()),ti=Qe==="x"?ei:ki,$s=Math.abs(ti)/zr;if(Math.abs(ti)>=Pte||$s>.11){te(ea.current),(fi=f.onDismiss)==null||fi.call(f,f),Zt(Qe==="x"?ei>0?"right":"left":ki>0?"down":"up"),Xi(),qe(!0),Ht(!1);return}de(!1),ze(null)},onPointerMove:jt=>{var en,Sn,fi,ei;if(!ta.current||!wr||((en=window.getSelection())==null?void 0:en.toString().length)>0)return;let ki=jt.clientY-ta.current.y,zr=jt.clientX-ta.current.x,ti=(Sn=t.swipeDirections)!=null?Sn:Nte(ce);!Qe&&(Math.abs(zr)>1||Math.abs(ki)>1)&&ze(Math.abs(zr)>Math.abs(ki)?"x":"y");let $s={x:0,y:0};Qe==="y"?(ti.includes("top")||ti.includes("bottom"))&&(ti.includes("top")&&ki<0||ti.includes("bottom")&&ki>0)&&($s.y=ki):Qe==="x"&&(ti.includes("left")||ti.includes("right"))&&(ti.includes("left")&&zr<0||ti.includes("right")&&zr>0)&&($s.x=zr),(Math.abs($s.x)>0||Math.abs($s.y)>0)&&Ht(!0),(fi=nt.current)==null||fi.style.setProperty("--swipe-amount-x",`${$s.x}px`),(ei=nt.current)==null||ei.style.setProperty("--swipe-amount-y",`${$s.y}px`)}},Jo&&!f.jsx?be.createElement("button",{"aria-label":Nt,"data-disabled":Gl,"data-close-button":!0,onClick:Gl||!wr?()=>{}:()=>{var jt;Xi(),(jt=f.onDismiss)==null||jt.call(f,f)},className:Eo(je==null?void 0:je.closeButton,(i=f==null?void 0:f.classNames)==null?void 0:i.closeButton)},(s=lt==null?void 0:lt.close)!=null?s:fte):null,f.jsx||_.isValidElement(f.title)?f.jsx?f.jsx:typeof f.title=="function"?f.title():f.title:be.createElement(be.Fragment,null,In||f.icon||f.promise?be.createElement("div",{"data-icon":"",className:Eo(je==null?void 0:je.icon,(o=f==null?void 0:f.classNames)==null?void 0:o.icon)},f.promise||f.type==="loading"&&!f.icon?f.icon||rm():null,f.type!=="loading"?f.icon||(lt==null?void 0:lt[In])||ate(In):null):null,be.createElement("div",{"data-content":"",className:Eo(je==null?void 0:je.content,(a=f==null?void 0:f.classNames)==null?void 0:a.content)},be.createElement("div",{"data-title":"",className:Eo(je==null?void 0:je.title,(l=f==null?void 0:f.classNames)==null?void 0:l.title)},typeof f.title=="function"?f.title():f.title),f.description?be.createElement("div",{"data-description":"",className:Eo(M,Zo,je==null?void 0:je.description,(c=f==null?void 0:f.classNames)==null?void 0:c.description)},typeof f.description=="function"?f.description():f.description):null),_.isValidElement(f.cancel)?f.cancel:f.cancel&&Fy(f.cancel)?be.createElement("button",{"data-button":!0,"data-cancel":!0,style:f.cancelButtonStyle||R,onClick:jt=>{var en,Sn;Fy(f.cancel)&&wr&&((Sn=(en=f.cancel).onClick)==null||Sn.call(en,jt),Xi())},className:Eo(je==null?void 0:je.cancelButton,(d=f==null?void 0:f.classNames)==null?void 0:d.cancelButton)},f.cancel.label):null,_.isValidElement(f.action)?f.action:f.action&&Fy(f.action)?be.createElement("button",{"data-button":!0,"data-action":!0,style:f.actionButtonStyle||N,onClick:jt=>{var en,Sn;Fy(f.action)&&((Sn=(en=f.action).onClick)==null||Sn.call(en,jt),!jt.defaultPrevented&&Xi())},className:Eo(je==null?void 0:je.actionButton,(h=f==null?void 0:f.classNames)==null?void 0:h.actionButton)},f.action.label):null))};function dR(){if(typeof window>"u"||typeof document>"u")return"ltr";let t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function Rte(t,e){let n={};return[t,e].forEach((r,i)=>{let s=i===1,o=s?"--mobile-offset":"--offset",a=s?Cte:Ste;function l(c){["top","right","bottom","left"].forEach(d=>{n[`${o}-${d}`]=typeof c=="number"?`${c}px`:c})}typeof r=="number"||typeof r=="string"?l(r):typeof r=="object"?["top","right","bottom","left"].forEach(c=>{r[c]===void 0?n[`${o}-${c}`]=a:n[`${o}-${c}`]=typeof r[c]=="number"?`${r[c]}px`:r[c]}):l(a)}),n}var Ate=_.forwardRef(function(t,e){let{invert:n,position:r="bottom-right",hotkey:i=["altKey","KeyT"],expand:s,closeButton:o,className:a,offset:l,mobileOffset:c,theme:d="light",richColors:h,duration:p,style:f,visibleToasts:m=Ete,toastOptions:g,dir:v=dR(),gap:b=kte,loadingIcon:x,icons:y,containerAriaLabel:w="Notifications",pauseWhenPageIsHidden:E}=t,[S,j]=be.useState([]),C=be.useMemo(()=>Array.from(new Set([r].concat(S.filter(Ae=>Ae.position).map(Ae=>Ae.position)))),[S,r]),[P,R]=be.useState([]),[N,I]=be.useState(!1),[M,W]=be.useState(!1),[ce,se]=be.useState(d!=="system"?d:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),ve=be.useRef(null),pt=i.join("+").replace(/Key/g,"").replace(/Digit/g,""),je=be.useRef(null),lt=be.useRef(!1),Nt=be.useCallback(Ae=>{j(Qe=>{var ze;return(ze=Qe.find(Ot=>Ot.id===Ae.id))!=null&&ze.delete||es.dismiss(Ae.id),Qe.filter(({id:Ot})=>Ot!==Ae.id)})},[]);return be.useEffect(()=>es.subscribe(Ae=>{if(Ae.dismiss){j(Qe=>Qe.map(ze=>ze.id===Ae.id?{...ze,delete:!0}:ze));return}setTimeout(()=>{HY.flushSync(()=>{j(Qe=>{let ze=Qe.findIndex(Ot=>Ot.id===Ae.id);return ze!==-1?[...Qe.slice(0,ze),{...Qe[ze],...Ae},...Qe.slice(ze+1)]:[Ae,...Qe]})})})}),[]),be.useEffect(()=>{if(d!=="system"){se(d);return}if(d==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?se("dark"):se("light")),typeof window>"u")return;let Ae=window.matchMedia("(prefers-color-scheme: dark)");try{Ae.addEventListener("change",({matches:Qe})=>{se(Qe?"dark":"light")})}catch{Ae.addListener(({matches:ze})=>{try{se(ze?"dark":"light")}catch(Ot){console.error(Ot)}})}},[d]),be.useEffect(()=>{S.length<=1&&I(!1)},[S]),be.useEffect(()=>{let Ae=Qe=>{var ze,Ot;i.every(Zt=>Qe[Zt]||Qe.code===Zt)&&(I(!0),(ze=ve.current)==null||ze.focus()),Qe.code==="Escape"&&(document.activeElement===ve.current||(Ot=ve.current)!=null&&Ot.contains(document.activeElement))&&I(!1)};return document.addEventListener("keydown",Ae),()=>document.removeEventListener("keydown",Ae)},[i]),be.useEffect(()=>{if(ve.current)return()=>{je.current&&(je.current.focus({preventScroll:!0}),je.current=null,lt.current=!1)}},[ve.current]),be.createElement("section",{ref:e,"aria-label":`${w} ${pt}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},C.map((Ae,Qe)=>{var ze;let[Ot,Zt]=Ae.split("-");return S.length?be.createElement("ol",{key:Ae,dir:v==="auto"?dR():v,tabIndex:-1,ref:ve,className:a,"data-sonner-toaster":!0,"data-theme":ce,"data-y-position":Ot,"data-lifted":N&&S.length>1&&!s,"data-x-position":Zt,style:{"--front-toast-height":`${((ze=P[0])==null?void 0:ze.height)||0}px`,"--width":`${jte}px`,"--gap":`${b}px`,...f,...Rte(l,c)},onBlur:me=>{lt.current&&!me.currentTarget.contains(me.relatedTarget)&&(lt.current=!1,je.current&&(je.current.focus({preventScroll:!0}),je.current=null))},onFocus:me=>{me.target instanceof HTMLElement&&me.target.dataset.dismissible==="false"||lt.current||(lt.current=!0,je.current=me.relatedTarget)},onMouseEnter:()=>I(!0),onMouseMove:()=>I(!0),onMouseLeave:()=>{M||I(!1)},onDragEnd:()=>I(!1),onPointerDown:me=>{me.target instanceof HTMLElement&&me.target.dataset.dismissible==="false"||W(!0)},onPointerUp:()=>W(!1)},S.filter(me=>!me.position&&Qe===0||me.position===Ae).map((me,oe)=>{var pe,ne;return be.createElement(Ote,{key:me.id,icons:y,index:oe,toast:me,defaultRichColors:h,duration:(pe=g==null?void 0:g.duration)!=null?pe:p,className:g==null?void 0:g.className,descriptionClassName:g==null?void 0:g.descriptionClassName,invert:n,visibleToasts:m,closeButton:(ne=g==null?void 0:g.closeButton)!=null?ne:o,interacting:M,position:Ae,style:g==null?void 0:g.style,unstyled:g==null?void 0:g.unstyled,classNames:g==null?void 0:g.classNames,cancelButtonStyle:g==null?void 0:g.cancelButtonStyle,actionButtonStyle:g==null?void 0:g.actionButtonStyle,removeToast:Nt,toasts:S.filter(Te=>Te.position==me.position),heights:P.filter(Te=>Te.position==me.position),setHeights:R,expandByDefault:s,gap:b,loadingIcon:x,expanded:N,pauseWhenPageIsHidden:E,swipeDirections:t.swipeDirections})})):null}))});const v3=()=>{const[t,e]=_.useState(!1),[n,r]=_.useState([{role:"assistant",content:"Hi! I'm ProssMind AI Assistant. I can help you with creating BPMN diagrams, using the interface, or answering any questions. How can I help you today?"}]),[i,s]=_.useState(""),[o,a]=_.useState(!1),l=_.useRef(null),c=_.useRef(null);_.useEffect(()=>{var f;(f=c.current)==null||f.scrollIntoView({behavior:"smooth"})},[n]);const d=async f=>{var g,v,b;const m=[...n,{role:"user",content:f}];r(m),s(""),a(!0);try{const y=await fetch("https://lnxbvkcggoyfmpfthhhk.supabase.co/functions/v1/chatbot",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},body:JSON.stringify({messages:m})});if(!y.ok){y.status===429?L.error("Rate limit exceeded. Please try again in a moment."):y.status===402?L.error("AI credits depleted. Please contact support."):L.error("Failed to get response from AI."),a(!1);return}if(!y.body)throw new Error("No response body");const w=y.body.getReader(),E=new TextDecoder;let S="",j="",C=!1;const P=R=>{r(N=>{const I=N[N.length-1];return(I==null?void 0:I.role)==="assistant"?N.map((M,W)=>W===N.length-1?{...M,content:R}:M):[...N,{role:"assistant",content:R}]})};for(;!C;){const{done:R,value:N}=await w.read();if(R)break;S+=E.decode(N,{stream:!0});let I;for(;(I=S.indexOf(`
`))!==-1;){let M=S.slice(0,I);if(S=S.slice(I+1),M.endsWith("\r")&&(M=M.slice(0,-1)),M.startsWith(":")||M.trim()===""||!M.startsWith("data: "))continue;const W=M.slice(6).trim();if(W==="[DONE]"){C=!0;break}try{const se=(b=(v=(g=JSON.parse(W).choices)==null?void 0:g[0])==null?void 0:v.delta)==null?void 0:b.content;se&&(j+=se,P(j))}catch{S=M+`
`+S;break}}}a(!1)}catch(x){console.error("Chat error:",x),L.error("An error occurred. Please try again."),a(!1)}},h=()=>{!i.trim()||o||d(i)},p=f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),h())};return u.jsxs(u.Fragment,{children:[!t&&u.jsx(G,{onClick:()=>e(!0),className:"fixed bottom-6 right-6 h-14 w-14 rounded-full shadow-2xl hover:shadow-xl transition-all z-50 animate-fade-in",size:"icon",children:u.jsx(uee,{className:"h-6 w-6"})}),t&&u.jsxs(De,{className:"fixed bottom-6 right-6 w-96 h-[600px] shadow-2xl flex flex-col z-50 animate-scale-in",children:[u.jsx(He,{className:"border-b bg-gradient-to-r from-primary to-accent text-primary-foreground",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(hp,{className:"h-5 w-5"}),u.jsx(We,{className:"text-lg",children:"ProssMind Assistant"})]}),u.jsx(G,{variant:"ghost",size:"icon",onClick:()=>e(!1),className:"text-primary-foreground hover:bg-primary-foreground/20",children:u.jsx(xa,{className:"h-4 w-4"})})]})}),u.jsxs(Ue,{className:"flex-1 flex flex-col p-0",children:[u.jsx(vc,{className:"flex-1 p-4",ref:l,children:u.jsxs("div",{className:"space-y-4",children:[n.map((f,m)=>u.jsxs("div",{className:`flex gap-3 ${f.role==="user"?"justify-end":"justify-start"}`,children:[f.role==="assistant"&&u.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:u.jsx(hp,{className:"h-4 w-4 text-primary"})}),u.jsx("div",{className:`max-w-[75%] rounded-2xl px-4 py-2 ${f.role==="user"?"bg-primary text-primary-foreground":"bg-muted"}`,children:u.jsx("p",{className:"text-sm whitespace-pre-wrap",children:f.content})}),f.role==="user"&&u.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary flex items-center justify-center",children:u.jsx(Dg,{className:"h-4 w-4 text-primary-foreground"})})]},m)),u.jsx("div",{ref:c})]})}),u.jsx("div",{className:"border-t p-4",children:u.jsxs("div",{className:"flex gap-2",children:[u.jsx($i,{value:i,onChange:f=>s(f.target.value),onKeyDown:p,placeholder:"Ask me anything about ProssMind...",className:"resize-none min-h-[60px]",disabled:o}),u.jsx(G,{onClick:h,disabled:!i.trim()||o,size:"icon",className:"h-[60px] w-[60px] flex-shrink-0",children:u.jsx(og,{className:"h-5 w-5"})})]})})]})]})]})},y3=()=>{const{ref:t,isInView:e}=Zk({threshold:.1});return u.jsx("footer",{className:"border-t border-border bg-background",children:u.jsxs("div",{className:"container mx-auto px-6 py-12",children:[u.jsxs(Re.div,{ref:t,className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-8",variants:Jk,initial:"hidden",animate:e?"visible":"hidden",children:[u.jsxs(Re.div,{variants:lg,children:[u.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Product"}),u.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[u.jsx("li",{children:u.jsxs(Mr,{to:"/features",className:"hover:text-foreground transition-colors relative group",children:["Features",u.jsx(Re.span,{className:"absolute bottom-0 left-0 w-0 h-0.5 bg-primary group-hover:w-full transition-all duration-300",whileHover:{width:"100%"}})]})}),u.jsx("li",{children:u.jsxs(Mr,{to:"/pricing",className:"hover:text-foreground transition-colors relative group",children:["Pricing",u.jsx(Re.span,{className:"absolute bottom-0 left-0 w-0 h-0.5 bg-primary group-hover:w-full transition-all duration-300",whileHover:{width:"100%"}})]})}),u.jsx("li",{children:u.jsxs("a",{href:nC("docs"),className:"hover:text-foreground transition-colors relative group",children:["Documentation",u.jsx(Re.span,{className:"absolute bottom-0 left-0 w-0 h-0.5 bg-primary group-hover:w-full transition-all duration-300",whileHover:{width:"100%"}})]})}),u.jsx("li",{children:u.jsxs("a",{href:nC("status"),className:"hover:text-foreground transition-colors relative group",children:["Status",u.jsx(Re.span,{className:"absolute bottom-0 left-0 w-0 h-0.5 bg-primary group-hover:w-full transition-all duration-300",whileHover:{width:"100%"}})]})})]})]}),u.jsxs(Re.div,{variants:lg,children:[u.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Legal"}),u.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[u.jsx("li",{children:u.jsxs(Mr,{to:"/privacy",className:"hover:text-foreground transition-colors relative group",children:["Privacy Policy",u.jsx(Re.span,{className:"absolute bottom-0 left-0 w-0 h-0.5 bg-primary group-hover:w-full transition-all duration-300",whileHover:{width:"100%"}})]})}),u.jsx("li",{children:u.jsxs(Mr,{to:"/terms",className:"hover:text-foreground transition-colors relative group",children:["Terms of Service",u.jsx(Re.span,{className:"absolute bottom-0 left-0 w-0 h-0.5 bg-primary group-hover:w-full transition-all duration-300",whileHover:{width:"100%"}})]})}),u.jsx("li",{children:u.jsxs(Mr,{to:"/contact",className:"hover:text-foreground transition-colors relative group",children:["Contact",u.jsx(Re.span,{className:"absolute bottom-0 left-0 w-0 h-0.5 bg-primary group-hover:w-full transition-all duration-300",whileHover:{width:"100%"}})]})})]})]}),u.jsxs(Re.div,{variants:lg,children:[u.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Company"}),u.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[u.jsx("li",{children:u.jsxs(Mr,{to:"/about",className:"hover:text-foreground transition-colors relative group",children:["About Us",u.jsx(Re.span,{className:"absolute bottom-0 left-0 w-0 h-0.5 bg-primary group-hover:w-full transition-all duration-300",whileHover:{width:"100%"}})]})}),u.jsx("li",{children:u.jsxs(Mr,{to:"/contact",className:"hover:text-foreground transition-colors relative group",children:["Contact Us",u.jsx(Re.span,{className:"absolute bottom-0 left-0 w-0 h-0.5 bg-primary group-hover:w-full transition-all duration-300",whileHover:{width:"100%"}})]})})]})]})]}),u.jsxs("div",{className:"flex flex-wrap items-center gap-4 justify-center md:justify-start mb-8 pb-8 border-b border-border",children:[u.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-primary/10 border border-primary/20",children:[u.jsx(Sl,{className:"h-4 w-4 text-primary","aria-hidden":"true"}),u.jsx("span",{className:"text-sm font-medium text-foreground",children:"GDPR"})]}),u.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-primary/10 border border-primary/20",children:[u.jsx(lee,{className:"h-4 w-4 text-primary","aria-hidden":"true"}),u.jsx("span",{className:"text-sm font-medium text-foreground",children:"Swiss Hosted"})]}),u.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-muted border border-border",children:[u.jsx(F4,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true"}),u.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"SOC 2 pending"})]})]}),u.jsx("div",{className:"text-sm text-muted-foreground text-center",children:u.jsxs("p",{children:[" ",new Date().getFullYear()," ProssMind. All rights reserved."]})})]})})},Ite=WY,Dte=GY,x3=_.forwardRef(({className:t,align:e="center",sideOffset:n=4,...r},i)=>u.jsx(qY,{children:u.jsx(SB,{ref:i,align:e,sideOffset:n,className:Se("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}));x3.displayName=SB.displayName;const b3=()=>{const t=Nl(),e=[{icon:wee,label:"Swiss Hosted",title:"Swiss Hosted Infrastructure",description:"All data is hosted in Switzerland, ensuring maximum privacy and data sovereignty. Our infrastructure complies with Swiss data protection laws.",link:"#"},{icon:Sl,label:"GDPR Compliant",title:"GDPR Compliance",description:"We are fully compliant with the General Data Protection Regulation (GDPR). Your data is processed with the highest standards of privacy and security.",link:"#"},{icon:qk,label:"SOC 2 Pending",title:"SOC 2 Certification",description:"We are currently undergoing SOC 2 Type II certification to demonstrate our commitment to security, availability, and confidentiality.",link:"#"}];return u.jsx("div",{className:"bg-muted/50 dark:bg-muted/30 py-2 text-sm text-muted-foreground text-center border-b border-border/50",children:u.jsx("div",{className:"container mx-auto px-6",children:u.jsx("div",{className:"flex items-center justify-center gap-6 flex-wrap",children:e.map((n,r)=>u.jsxs(Ite,{children:[u.jsx(Dte,{asChild:!0,children:u.jsxs(Re.button,{className:"flex items-center gap-2 hover:text-foreground transition-colors cursor-pointer focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded px-2 py-1",whileHover:t?{}:{scale:1.05},whileTap:t?{}:{scale:.95},"aria-label":`Learn more about ${n.label}`,children:[u.jsx(n.icon,{className:"h-4 w-4","aria-hidden":"true"}),u.jsx("span",{children:n.label})]})}),u.jsx(x3,{className:"w-80",side:"bottom",align:"center",children:u.jsxs("div",{className:"space-y-2",children:[u.jsx("h4",{className:"font-semibold text-sm",children:n.title}),u.jsx("p",{className:"text-xs text-muted-foreground",children:n.description})]})})]},r))})})})},$te=()=>{const[t,e]=_.useState(null),[n,r]=_.useState(!0);return _.useEffect(()=>{const{data:{subscription:i}}=he.auth.onAuthStateChange((s,o)=>{e((o==null?void 0:o.user)??null),r(!1)});return he.auth.getSession().then(({data:{session:s}})=>{e((s==null?void 0:s.user)??null),r(!1)}),()=>i.unsubscribe()},[]),n?u.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),u.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading..."})]})}):u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(Os,{user:t}),u.jsx(b3,{}),u.jsx(e3,{}),u.jsx(t3,{}),u.jsx(n3,{}),u.jsx(e2,{}),u.jsx(v3,{}),u.jsx(y3,{})]})},mn=({children:t,className:e})=>u.jsx("div",{className:Se("max-w-[1200px] mx-auto p-4 md:p-8",e),children:t}),Mte=[{icon:hp,title:"AI Agent Generator",description:"Create intelligent agents that can automate complex workflows and tasks with advanced machine learning capabilities.",benefits:["Natural language processing","Self-learning algorithms","Multi-task handling"]},{icon:js,title:"Process Generator",description:"Design and build automated business processes with powerful AI capabilities and intuitive visual tools. Download BPMN diagrams and integrate seamlessly with SAP Signavio, Camunda, Flowable, and more.",benefits:["Visual process builder","Real-time monitoring","Automatic optimization","Export BPMN diagrams","Integration with SAP Signavio, Camunda, Flowable"]},{icon:Ia,title:"Vision Automation",description:"Automate visual tasks with advanced computer vision and image processing powered by state-of-the-art AI.",benefits:["Image recognition","OCR capabilities"]},{icon:kee,title:"Lightning Fast",description:"Process automation that runs at incredible speeds with minimal latency and maximum efficiency.",benefits:["Sub-second response","Real-time processing","Edge computing"]},{icon:Sl,title:"Enterprise Security",description:"Bank-level security with end-to-end encryption, ensuring your data and processes are always protected.",benefits:["256-bit encryption","SOC 2 compliant","GDPR ready"]},{icon:e0,title:"Performance Analytics",description:"Deep insights into your automation performance with comprehensive analytics and reporting tools.",benefits:["Real-time dashboards","Custom reports","Predictive insights"]}],Lte=()=>{const t=Nl();return u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(Os,{}),u.jsx("main",{className:"pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"text-center mb-16",children:[u.jsxs("h1",{className:"text-5xl font-bold mb-4",children:["Powerful ",u.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Features"})]}),u.jsx("p",{className:"text-xl text-muted-foreground max-w-3xl mx-auto",children:"Everything you need to automate your business processes with cutting-edge AI technology"})]}),u.jsx("div",{className:"grid md:grid-cols-2 gap-8",children:Mte.map((e,n)=>u.jsx(Re.div,{whileHover:t?{}:{y:-12,rotateY:2,rotateX:2,scale:1.03},transition:zt(t)||{duration:.3},style:{perspective:1e3},children:u.jsxs(De,{className:"card-hover cursor-pointer border-border/50 hover:border-primary bg-card/50 backdrop-blur-sm flex flex-col h-full rounded-2xl shadow-md transition-all relative overflow-hidden group",style:{boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},role:"article","aria-label":`Feature: ${e.title}`,children:[u.jsx(Re.div,{className:"absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity",style:{background:"linear-gradient(45deg, hsl(var(--primary)), hsl(var(--accent)))",padding:"1px"},initial:!1,children:u.jsx("div",{className:"w-full h-full bg-card/50 backdrop-blur-sm rounded-2xl"})}),u.jsxs(He,{className:"flex-shrink-0 relative z-10",children:[u.jsxs(Re.div,{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center mb-4 relative",animate:t?{rotate:0}:{rotate:[-2,2,-2]},transition:zt(t)||{duration:4,repeat:1/0,ease:"easeInOut"},whileHover:t?{}:{scale:1.15,rotate:15,filter:"brightness(1.3)"},children:[u.jsx(Re.div,{whileHover:t?{}:{scale:1.2},transition:zt(t)||{duration:.2},style:{filter:"drop-shadow(0 0 20px hsl(var(--primary)))"},children:u.jsx(e.icon,{className:"h-7 w-7 text-primary"})}),u.jsx(Re.div,{className:"absolute inset-0 rounded-xl bg-primary/20 blur-xl",animate:t?{scale:1,opacity:0}:{scale:[1,1.3,1],opacity:[0,.8,0]},transition:zt(t)||{duration:1.5,repeat:1/0,ease:"easeInOut"}})]}),u.jsx(We,{className:"text-2xl mb-2",children:e.title}),u.jsx(Je,{className:"text-base mt-2",children:e.description})]}),u.jsx(Ue,{className:"flex-grow flex flex-col relative z-10",children:u.jsx("ul",{className:"space-y-2",children:e.benefits.map((r,i)=>u.jsxs("li",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[u.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary"}),r]},i))})})]})},n))})]})})]})},Bte="modulepreload",Fte=function(t){return"/"+t},hR={},pp=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(n.map(l=>{if(l=Fte(l),l in hR)return;hR[l]=!0;const c=l.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":Bte,c||(h.as="script"),h.crossOrigin="",h.href=l,a&&h.setAttribute("nonce",a),document.head.appendChild(h),c)return new Promise((p,f)=>{h.addEventListener("load",p),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},Ur=yk,zte=vk,w3=_.forwardRef(({className:t,...e},n)=>u.jsx(hv,{ref:n,className:Se("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));w3.displayName=hv.displayName;const Ar=_.forwardRef(({className:t,children:e,...n},r)=>u.jsxs(zte,{children:[u.jsx(w3,{}),u.jsxs(pv,{ref:r,className:Se("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n,children:[e,u.jsxs(cw,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[u.jsx(xa,{className:"h-4 w-4"}),u.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ar.displayName=pv.displayName;const Ir=({className:t,...e})=>u.jsx("div",{className:Se("flex flex-col space-y-1.5 text-center sm:text-left",t),...e});Ir.displayName="DialogHeader";const s0=({className:t,...e})=>u.jsx("div",{className:Se("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e});s0.displayName="DialogFooter";const Dr=_.forwardRef(({className:t,...e},n)=>u.jsx(fv,{ref:n,className:Se("text-lg font-semibold leading-none tracking-tight",t),...e}));Dr.displayName=fv.displayName;const $r=_.forwardRef(({className:t,...e},n)=>u.jsx(mv,{ref:n,className:Se("text-sm text-muted-foreground",t),...e}));$r.displayName=mv.displayName;var bw="Tabs",[Hte]=Tl(bw,[CB]),_3=CB(),[Ute,s2]=Hte(bw),E3=_.forwardRef((t,e)=>{const{__scopeTabs:n,value:r,onValueChange:i,defaultValue:s,orientation:o="horizontal",dir:a,activationMode:l="automatic",...c}=t,d=uw(a),[h,p]=Mc({prop:r,onChange:i,defaultProp:s??"",caller:bw});return u.jsx(Ute,{scope:n,baseId:vf(),value:h,onValueChange:p,orientation:o,dir:d,activationMode:l,children:u.jsx(Yt.div,{dir:d,"data-orientation":o,...c,ref:e})})});E3.displayName=bw;var S3="TabsList",C3=_.forwardRef((t,e)=>{const{__scopeTabs:n,loop:r=!0,...i}=t,s=s2(S3,n),o=_3(n);return u.jsx(KY,{asChild:!0,...o,orientation:s.orientation,dir:s.dir,loop:r,children:u.jsx(Yt.div,{role:"tablist","aria-orientation":s.orientation,...i,ref:e})})});C3.displayName=S3;var j3="TabsTrigger",k3=_.forwardRef((t,e)=>{const{__scopeTabs:n,value:r,disabled:i=!1,...s}=t,o=s2(j3,n),a=_3(n),l=N3(o.baseId,r),c=O3(o.baseId,r),d=r===o.value;return u.jsx(YY,{asChild:!0,...a,focusable:!i,active:d,children:u.jsx(Yt.button,{type:"button",role:"tab","aria-selected":d,"aria-controls":c,"data-state":d?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:l,...s,ref:e,onMouseDown:Pt(t.onMouseDown,h=>{!i&&h.button===0&&h.ctrlKey===!1?o.onValueChange(r):h.preventDefault()}),onKeyDown:Pt(t.onKeyDown,h=>{[" ","Enter"].includes(h.key)&&o.onValueChange(r)}),onFocus:Pt(t.onFocus,()=>{const h=o.activationMode!=="manual";!d&&!i&&h&&o.onValueChange(r)})})})});k3.displayName=j3;var P3="TabsContent",T3=_.forwardRef((t,e)=>{const{__scopeTabs:n,value:r,forceMount:i,children:s,...o}=t,a=s2(P3,n),l=N3(a.baseId,r),c=O3(a.baseId,r),d=r===a.value,h=_.useRef(d);return _.useEffect(()=>{const p=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(p)},[]),u.jsx(Gc,{present:i||d,children:({present:p})=>u.jsx(Yt.div,{"data-state":d?"active":"inactive","data-orientation":a.orientation,role:"tabpanel","aria-labelledby":l,hidden:!p,id:c,tabIndex:0,...o,ref:e,style:{...t.style,animationDuration:h.current?"0s":void 0},children:p&&s})})});T3.displayName=P3;function N3(t,e){return`${t}-trigger-${e}`}function O3(t,e){return`${t}-content-${e}`}var R3=E3,ww=C3,_w=k3,Ew=T3;const A3=R3,o2=_.forwardRef(({className:t,...e},n)=>u.jsx(ww,{ref:n,className:Se("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground relative gap-1",t),...e}));o2.displayName=ww.displayName;const xd=_.forwardRef(({className:t,children:e,...n},r)=>{const i=_.useRef(null),[s,o]=_.useState(!1);return _.useImperativeHandle(r,()=>i.current),_.useEffect(()=>{const a=()=>{i.current&&o(i.current.getAttribute("data-state")==="active")};a();const l=new MutationObserver(a);return i.current&&l.observe(i.current,{attributes:!0,attributeFilter:["data-state"]}),()=>l.disconnect()},[]),u.jsxs(_w,{ref:i,className:Se("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative z-10 flex-1","data-[state=active]:text-foreground","hover:text-foreground/90",t),...n,children:[u.jsx("span",{className:"relative z-10 flex items-center justify-center w-full",children:e}),s&&u.jsx(Re.div,{layoutId:"activeTabIndicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary",initial:!1,transition:{type:"spring",stiffness:380,damping:30,duration:.4}})]})});xd.displayName=_w.displayName;const bd=_.forwardRef(({className:t,...e},n)=>{const[r,i]=_.useState(1),s=_.useRef();return _.useEffect(()=>{if(s.current&&e.value){const o=parseInt(s.current)||0,a=parseInt(e.value)||0;i(a>o?1:-1)}s.current=e.value},[e.value]),u.jsx(xB,{mode:"wait",custom:r,children:u.jsx(Ew,{ref:n,className:Se("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...e,asChild:!0,children:u.jsx(Re.div,{custom:r,initial:{opacity:0,x:r*20},animate:{opacity:1,x:0},exit:{opacity:0,x:r*-20},transition:{opacity:{duration:.3},x:{duration:.2},ease:"easeInOut"},children:e.children})},e.value)})});bd.displayName=Ew.displayName;function Vte(t,e=[]){let n=[];function r(s,o){const a=_.createContext(o);a.displayName=s+"Context";const l=n.length;n=[...n,o];const c=h=>{var b;const{scope:p,children:f,...m}=h,g=((b=p==null?void 0:p[t])==null?void 0:b[l])||a,v=_.useMemo(()=>m,Object.values(m));return u.jsx(g.Provider,{value:v,children:f})};c.displayName=s+"Provider";function d(h,p){var g;const f=((g=p==null?void 0:p[t])==null?void 0:g[l])||a,m=_.useContext(f);if(m)return m;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${s}\``)}return[c,d]}const i=()=>{const s=n.map(o=>_.createContext(o));return function(a){const l=(a==null?void 0:a[t])||s;return _.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return i.scopeName=t,[r,qte(i,...e)]}function qte(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:l,scopeName:c})=>{const h=l(s)[`__scope${c}`];return{...a,...h}},{});return _.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}var Wte=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],I3=Wte.reduce((t,e)=>{const n=vw(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,l=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),u.jsx(l,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{}),a2="Progress",l2=100,[Gte]=Vte(a2),[Kte,Yte]=Gte(a2),D3=_.forwardRef((t,e)=>{const{__scopeProgress:n,value:r=null,max:i,getValueLabel:s=Xte,...o}=t;(i||i===0)&&!pR(i)&&console.error(Qte(`${i}`,"Progress"));const a=pR(i)?i:l2;r!==null&&!fR(r,a)&&console.error(Zte(`${r}`,"Progress"));const l=fR(r,a)?r:null,c=o0(l)?s(l,a):void 0;return u.jsx(Kte,{scope:n,value:l,max:a,children:u.jsx(I3.div,{"aria-valuemax":a,"aria-valuemin":0,"aria-valuenow":o0(l)?l:void 0,"aria-valuetext":c,role:"progressbar","data-state":L3(l,a),"data-value":l??void 0,"data-max":a,...o,ref:e})})});D3.displayName=a2;var $3="ProgressIndicator",M3=_.forwardRef((t,e)=>{const{__scopeProgress:n,...r}=t,i=Yte($3,n);return u.jsx(I3.div,{"data-state":L3(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...r,ref:e})});M3.displayName=$3;function Xte(t,e){return`${Math.round(t/e*100)}%`}function L3(t,e){return t==null?"indeterminate":t===e?"complete":"loading"}function o0(t){return typeof t=="number"}function pR(t){return o0(t)&&!isNaN(t)&&t>0}function fR(t,e){return o0(t)&&!isNaN(t)&&t<=e&&t>=0}function Qte(t,e){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${e}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${l2}\`.`}function Zte(t,e){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${e}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${l2} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var B3=D3,Jte=M3;const bs=_.forwardRef(({className:t,value:e,...n},r)=>u.jsx(B3,{ref:r,className:Se("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...n,children:u.jsx(Jte,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(e||0)}%)`}})}));bs.displayName=B3.displayName;async function F3(t,e=1920,n=1920,r=.85,i=500){return new Promise((s,o)=>{const a=new FileReader;a.onload=l=>{var d;const c=new Image;c.onload=()=>{const h=document.createElement("canvas");let p=c.width,f=c.height;if(p>e||f>n){const g=Math.min(e/p,n/f);p=p*g,f=f*g}h.width=p,h.height=f;const m=h.getContext("2d");if(!m){o(new Error("Could not get canvas context"));return}m.drawImage(c,0,0,p,f),h.toBlob(g=>{if(!g){o(new Error("Failed to compress image"));return}g.size>i*1024&&r>.5?h.toBlob(v=>{if(!v){s(new File([g],t.name,{type:t.type}));return}s(new File([v],t.name,{type:t.type}))},t.type,r*.7):s(new File([g],t.name,{type:t.type}))},t.type,r)},c.onerror=()=>o(new Error("Failed to load image")),c.src=(d=l.target)==null?void 0:d.result},a.onerror=()=>o(new Error("Failed to read file")),a.readAsDataURL(t)})}async function z3(t,e=!0){let n=t;if(e&&t.type.startsWith("image/"))try{n=await F3(t)}catch(r){console.warn("Image compression failed, using original:",r)}return new Promise((r,i)=>{const s=new FileReader;s.onload=()=>{const o=s.result,a=o.includes(",")?o.split(",")[1]:o;r(a)},s.onerror=()=>i(new Error("Failed to read file")),s.readAsDataURL(n)})}function H3(t,e=500){return t.size>e*1024&&t.type.startsWith("image/")}const sC=Object.freeze(Object.defineProperty({__proto__:null,compressImage:F3,fileToBase64:z3,shouldCompressImage:H3},Symbol.toStringTag,{value:"Module"})),eE=new Map,ene=6e4;function tne(t,e){const n=eE.get(t);if(n&&Date.now()-n.timestamp<ene)return n.promise;const r=e().finally(()=>{eE.delete(t)});return eE.set(t,{promise:r,timestamp:Date.now()}),r}function nne(t,e){const n=Object.keys(e).sort().map(r=>`${r}:${JSON.stringify(e[r])}`).join("|");return`${t}:${n}`}async function U3(t,e,n){const{deduplicate:r=!0,timeout:i=6e4}=n||{},s=async()=>{var o;try{const a=new AbortController,l=setTimeout(()=>a.abort(),i),{data:c,error:d}=await he.functions.invoke(t,{body:e,signal:a.signal});return clearTimeout(l),d?{error:{message:d.message||"Unknown error",code:(o=d.status)==null?void 0:o.toString()}}:{data:c}}catch(a){return a instanceof Error&&a.name==="AbortError"?{error:{message:"Request timeout",code:"TIMEOUT"}}:{error:{message:a instanceof Error?a.message:"Unknown error"}}}};if(r){const o=nne(t,e);return tne(o,s)}return s()}const c2=Object.freeze(Object.defineProperty({__proto__:null,invokeFunction:U3},Symbol.toStringTag,{value:"Module"})),V3=()=>{const t=Ns(),[e,n]=_.useState(!1),[r,i]=_.useState(null),[s,o]=_.useState(!1),[a,l]=_.useState(null),[c,d]=_.useState("bpmn"),[h,p]=_.useState(0),[f,m]=_.useState(""),[g,v]=_.useState(null);_.useEffect(()=>{if(!a)return;let w;const E=async()=>{const{data:C,error:P}=await he.from("vision_bpmn_jobs").select("status, bpmn_xml, error_message").eq("id",a).single();if(P){console.error("Error checking job status:",P);return}if(console.log("Job status:",C.status),C.status==="completed"&&C.bpmn_xml){const R=c==="bpmn"?"generatedBpmn":c==="pid"?"generatedPid":"generatedDmn";localStorage.setItem(R,C.bpmn_xml),localStorage.setItem("diagramType",c);const N=c==="bpmn"?"BPMN":c==="pid"?"P&ID":"DMN";p(100),m("Complete!");const I=c==="bpmn"?"/bpmn-generator":c==="pid"?"/pid-generator":"/dmn-generator";L.success(`${N} diagram generated successfully!`,{description:"Redirecting to editor..."}),setTimeout(()=>{sr(t,I)},1e3),n(!1),i(null),o(!1),l(null),v(null),w&&clearInterval(w)}else if(C.status==="failed"){const R=C.error_message||"Please try again";v(R),L.error("Upload failed  retry or contact support",{description:R,action:{label:"Retry",onClick:()=>{v(null),r&&y()}},duration:1e4}),o(!1),l(null),p(0),m(""),w&&clearInterval(w)}},S=he.channel(`job-${a}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"vision_bpmn_jobs",filter:`id=eq.${a}`},C=>{const P=C.new;if(console.log("Realtime job status update:",P.status),P.status==="completed"&&P.bpmn_xml){const R=c==="bpmn"?"generatedBpmn":c==="pid"?"generatedPid":"generatedDmn";localStorage.setItem(R,P.bpmn_xml),localStorage.setItem("diagramType",c);const N=c==="bpmn"?"BPMN":c==="pid"?"P&ID":"DMN";p(100),m("Complete!");const I=c==="bpmn"?"/bpmn-generator":c==="pid"?"/pid-generator":"/dmn-generator";L.success(`${N} diagram generated successfully!`,{description:"Redirecting to editor..."}),setTimeout(()=>{sr(t,I)},1e3),n(!1),i(null),o(!1),l(null),v(null),w&&clearInterval(w)}else if(P.status==="failed"){const R=P.error_message||"Please try again";v(R),L.error("Upload failed  retry or contact support",{description:R,action:{label:"Retry",onClick:()=>{v(null),r&&y()}},duration:1e4}),o(!1),l(null),p(0),m(""),w&&clearInterval(w)}}).subscribe();w=window.setInterval(E,3e3),E();const j=window.setTimeout(()=>{w&&clearInterval(w);const C="Processing timed out - Please try refreshing the page or contact support";v(C),p(0),m(""),L.error("Upload failed  retry or contact support",{description:C,action:{label:"Retry",onClick:()=>{v(null),r&&y()}},duration:1e4}),o(!1),l(null)},3e5);return()=>{clearTimeout(j),he.removeChannel(S),w&&clearInterval(w)}},[a,c,r]);const b=()=>{n(!0)},x=w=>{var S;const E=(S=w.target.files)==null?void 0:S[0];if(E){if(E.size>209715200){L.error("File too large",{description:"Maximum file size is 200 MB. Please select a smaller file."}),w.target.value="";return}i(E),v(null),p(10),m("File selected, ready to upload...")}},y=async()=>{if(s)return;if(!r){L.error("Please select a file");return}o(!0),v(null),p(10),m("Analyzing frame 1 of 20...");const w=L.loading("Processing your file...",{description:"This may take 30-60 seconds for complex diagrams"});try{const{data:{user:E},error:S}=await he.auth.getUser();if(!E||S){L.dismiss(w);const N=(S==null?void 0:S.message)||"Please log in to use this feature";v(N),L.error("Upload failed  retry or contact support",{description:N,action:{label:"Retry",onClick:()=>{v(null),y()}},duration:1e4}),o(!1),p(0),m(""),sr(t,"/auth");return}let j=r;if(H3(r)){L.info("Compressing image for faster upload...");try{const{compressImage:N}=await pp(async()=>{const{compressImage:I}=await Promise.resolve().then(()=>sC);return{compressImage:I}},void 0);j=await N(r)}catch(N){console.warn("Image compression failed, using original:",N)}}const C=await z3(j,!1),P=`data:${j.type};base64,${C}`;L.dismiss(w),p(20),m("Uploading file...");const R=L.loading("Starting diagram generation...",{description:"This will continue in the background"});try{const{data:N,error:I}=await U3("vision-to-bpmn",{imageBase64:P,diagramType:c},{deduplicate:!0});if(L.dismiss(R),I){const M=I.message||"Failed to start diagram generation";v(M),p(0),m(""),L.error("Upload failed  retry or contact support",{description:M,action:{label:"Retry",onClick:()=>{v(null),y()}},duration:1e4}),o(!1);return}if(!N||!N.jobId){const M="Failed to start processing";v(M),p(0),m(""),L.error("Upload failed  retry or contact support",{description:M,action:{label:"Retry",onClick:()=>{v(null),y()}},duration:1e4}),o(!1);return}l(N.jobId),p(30),m("Processing started, analyzing frames..."),L.info("Processing started",{description:"We'll notify you when your diagram is ready (this may take 1-2 minutes)"})}catch{const I="Network error - Please check your connection and try again";v(I),p(0),m(""),L.dismiss(R),L.error("Upload failed  retry or contact support",{description:I,action:{label:"Retry",onClick:()=>{v(null),y()}},duration:1e4}),o(!1)}}catch(E){const S=E instanceof Error?E.message:"Failed to generate diagram";v(S),p(0),m(""),L.dismiss(w),L.error("Upload failed  retry or contact support",{description:S,action:{label:"Retry",onClick:()=>{v(null),y()}},duration:1e4}),o(!1)}};return u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(Os,{}),u.jsx("main",{className:"pt-24 pb-20",children:u.jsxs("div",{className:"container mx-auto px-6",children:[u.jsxs("div",{className:"text-center mb-16",children:[u.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-primary/10 mb-6",children:u.jsx(Ia,{className:"h-10 w-10 text-primary"})}),u.jsxs("h1",{className:"text-5xl font-bold mb-4",children:["Vision ",u.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"AI"})]}),u.jsx("p",{className:"text-xl text-muted-foreground max-w-3xl mx-auto",children:"See what computers see. Our advanced vision AI technology enables your automation to understand and process visual information just like humans do."})]}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-12 items-center mb-20",children:[u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-2xl font-bold",children:"Self-Learning Vision System"}),u.jsx("p",{className:"text-lg text-muted-foreground",children:"Our Vision AI continuously learns and adapts to your specific use cases, improving accuracy and performance over time without manual intervention."}),u.jsxs("ul",{className:"space-y-4",children:[u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx(GJ,{className:"h-6 w-6 text-primary flex-shrink-0 mt-1"}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-sm font-semibold mb-1",children:"Real-time Processing"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Process images and video streams in real-time with minimal latency"})]})]}),u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx(bee,{className:"h-6 w-6 text-primary flex-shrink-0 mt-1"}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-sm font-semibold mb-1",children:"Object Detection"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Identify and track multiple objects across frames"})]})]}),u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx(ts,{className:"h-6 w-6 text-primary flex-shrink-0 mt-1"}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-sm font-semibold mb-1",children:"Image Classification"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Automatically categorize and tag visual content"})]})]})]}),u.jsx(G,{size:"lg",className:"mt-6",onClick:b,children:"Start Free Trial"})]}),u.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-accent/10 rounded-2xl p-12 text-center",children:[u.jsx(Ia,{className:"h-32 w-32 mx-auto text-primary mb-6"}),u.jsx("h3",{className:"text-xl font-bold mb-4",children:"100% Client-Side Processing"}),u.jsx("p",{className:"text-muted-foreground",children:"All vision processing happens on your device. Your data never leaves your control, ensuring maximum privacy and security."})]})]}),u.jsxs("div",{className:"bg-hero-bg text-hero-foreground rounded-2xl p-12 text-center",children:[u.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Ready to See the Future?"}),u.jsx("p",{className:"text-xl text-hero-foreground/80 mb-8 max-w-2xl mx-auto",children:"Join thousands of companies already using ProssMind Vision AI to transform their automation workflows"}),u.jsx(G,{size:"lg",variant:"secondary",className:"text-lg px-8",onClick:b,children:"Get Started Now"})]})]})}),u.jsx(Ur,{open:e,onOpenChange:n,children:u.jsxs(Ar,{className:"max-w-2xl",children:[u.jsxs(Ir,{children:[u.jsx(Dr,{children:"Upload Your Process"}),u.jsx($r,{children:"Upload handwritten notes, whiteboard images, process documents, or text files to generate a diagram"})]}),u.jsx("div",{className:"space-y-6",children:u.jsxs(A3,{value:c,onValueChange:w=>d(w),className:"w-full",children:[u.jsxs(o2,{className:"grid w-full grid-cols-3",children:[u.jsx(xd,{value:"bpmn",children:"BPMN Diagram"}),u.jsx(xd,{value:"pid",children:"P&ID Diagram"}),u.jsx(xd,{value:"dmn",children:"DMN Decision"})]}),u.jsxs(bd,{value:"bpmn",className:"mt-6 space-y-6",children:[u.jsxs("div",{className:"bg-card border-2 border-dashed border-border rounded-lg p-8 text-center hover:border-primary/50 transition-colors",children:[u.jsx("input",{type:"file",accept:"image/*,.pdf,.doc,.docx,.txt",onChange:x,className:"hidden",id:"file-upload",disabled:s}),u.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer flex flex-col items-center gap-4",children:[u.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:u.jsx(ts,{className:"w-8 h-8 text-primary"})}),u.jsxs("div",{children:[u.jsx("p",{className:"text-lg font-semibold mb-1",children:r?r.name:"Drop your process image or document"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Images, PDF, Word documents, or text files"})]})]}),s&&h>0&&u.jsxs("div",{className:"mt-6 space-y-2",children:[u.jsx(bs,{value:h,className:"w-full"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:f})]}),g&&u.jsx("div",{className:"mt-4 p-3 bg-destructive/10 border border-destructive/20 rounded-lg",children:u.jsx("p",{className:"text-sm text-destructive",children:g})})]}),u.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[u.jsxs("div",{className:"flex flex-col items-center gap-2 p-4 bg-muted rounded-lg",children:[u.jsx(ts,{className:"w-8 h-8 text-primary"}),u.jsx("span",{className:"text-sm font-medium",children:"Images"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"JPG, PNG, WEBP"})]}),u.jsxs("div",{className:"flex flex-col items-center gap-2 p-4 bg-muted rounded-lg",children:[u.jsx(nr,{className:"w-8 h-8 text-primary"}),u.jsx("span",{className:"text-sm font-medium",children:"Documents"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"PDF, DOC, DOCX"})]}),u.jsxs("div",{className:"flex flex-col items-center gap-2 p-4 bg-muted rounded-lg",children:[u.jsx(nr,{className:"w-8 h-8 text-primary"}),u.jsx("span",{className:"text-sm font-medium",children:"Text"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"TXT files"})]})]}),u.jsxs("div",{className:"flex justify-end gap-4",children:[u.jsx(G,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),u.jsx(G,{onClick:y,disabled:!r||s,children:s?"Generating...":`Generate ${c==="bpmn"?"BPMN":c==="pid"?"P&ID":"DMN"}`})]})]}),u.jsxs(bd,{value:"pid",className:"mt-6 space-y-6",children:[u.jsxs("div",{className:"bg-card border-2 border-dashed border-border rounded-lg p-8 text-center hover:border-primary/50 transition-colors",children:[u.jsx("input",{type:"file",accept:"image/*,.pdf,.doc,.docx,.txt",onChange:x,className:"hidden",id:"file-upload-pid",disabled:s}),u.jsxs("label",{htmlFor:"file-upload-pid",className:"cursor-pointer flex flex-col items-center gap-4",children:[u.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:u.jsx(ts,{className:"w-8 h-8 text-primary"})}),u.jsxs("div",{children:[u.jsx("p",{className:"text-lg font-semibold mb-1",children:r?r.name:"Drop your process image or document"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Images, PDF, Word documents, or text files"})]})]}),s&&h>0&&u.jsxs("div",{className:"mt-6 space-y-2",children:[u.jsx(bs,{value:h,className:"w-full"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:f})]}),g&&u.jsx("div",{className:"mt-4 p-3 bg-destructive/10 border border-destructive/20 rounded-lg",children:u.jsx("p",{className:"text-sm text-destructive",children:g})})]}),u.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[u.jsxs("div",{className:"flex flex-col items-center gap-2 p-4 bg-muted rounded-lg",children:[u.jsx(ts,{className:"w-8 h-8 text-primary"}),u.jsx("span",{className:"text-sm font-medium",children:"Images"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"JPG, PNG, WEBP"})]}),u.jsxs("div",{className:"flex flex-col items-center gap-2 p-4 bg-muted rounded-lg",children:[u.jsx(nr,{className:"w-8 h-8 text-primary"}),u.jsx("span",{className:"text-sm font-medium",children:"Documents"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"PDF, DOC, DOCX"})]}),u.jsxs("div",{className:"flex flex-col items-center gap-2 p-4 bg-muted rounded-lg",children:[u.jsx(nr,{className:"w-8 h-8 text-primary"}),u.jsx("span",{className:"text-sm font-medium",children:"Text"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"TXT files"})]})]}),u.jsxs("div",{className:"flex justify-end gap-4",children:[u.jsx(G,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),u.jsx(G,{onClick:y,disabled:!r||s,children:s?"Generating...":"Generate P&ID"})]})]}),u.jsxs(bd,{value:"dmn",className:"mt-6 space-y-6",children:[u.jsxs("div",{className:"bg-card border-2 border-dashed border-border rounded-lg p-8 text-center hover:border-primary/50 transition-colors",children:[u.jsx("input",{type:"file",accept:"image/*,.pdf,.doc,.docx,.txt",onChange:x,className:"hidden",id:"file-upload-dmn",disabled:s}),u.jsxs("label",{htmlFor:"file-upload-dmn",className:"cursor-pointer flex flex-col items-center gap-4",children:[u.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:u.jsx(ts,{className:"w-8 h-8 text-primary"})}),u.jsxs("div",{children:[u.jsx("p",{className:"text-lg font-semibold mb-1",children:r?r.name:"Drop your decision document or image"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Images, PDF, Word documents, or text files"})]})]}),s&&h>0&&u.jsxs("div",{className:"mt-6 space-y-2",children:[u.jsx(bs,{value:h,className:"w-full"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:f})]}),g&&u.jsx("div",{className:"mt-4 p-3 bg-destructive/10 border border-destructive/20 rounded-lg",children:u.jsx("p",{className:"text-sm text-destructive",children:g})})]}),u.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[u.jsxs("div",{className:"flex flex-col items-center gap-2 p-4 bg-muted rounded-lg",children:[u.jsx(ts,{className:"w-8 h-8 text-primary"}),u.jsx("span",{className:"text-sm font-medium",children:"Images"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"JPG, PNG, WEBP"})]}),u.jsxs("div",{className:"flex flex-col items-center gap-2 p-4 bg-muted rounded-lg",children:[u.jsx(nr,{className:"w-8 h-8 text-primary"}),u.jsx("span",{className:"text-sm font-medium",children:"Documents"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"PDF, DOC, DOCX"})]}),u.jsxs("div",{className:"flex flex-col items-center gap-2 p-4 bg-muted rounded-lg",children:[u.jsx(nr,{className:"w-8 h-8 text-primary"}),u.jsx("span",{className:"text-sm font-medium",children:"Text"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"TXT files"})]})]}),u.jsxs("div",{className:"flex justify-end gap-4",children:[u.jsx(G,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),u.jsx(G,{onClick:y,disabled:!r||s,children:s?"Generating...":"Generate DMN"})]})]})]})})]})})]})},rne=()=>u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(Os,{}),u.jsx("main",{className:"pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"text-center mb-16",children:[u.jsxs("h1",{className:"text-5xl font-bold mb-4",children:["Simple, ",u.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Transparent"})," Pricing"]}),u.jsx("p",{className:"text-xl text-muted-foreground max-w-3xl mx-auto",children:"Choose the plan that fits your needs. All plans include our core automation features."})]}),u.jsx(e2,{}),u.jsxs("div",{className:"mt-20 bg-muted/30 rounded-2xl p-12",children:[u.jsx("h2",{className:"text-3xl font-bold text-center mb-12",children:"All Plans Include"}),u.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx(ns,{className:"h-6 w-6 text-primary flex-shrink-0 mt-1"}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-semibold mb-2",children:"99.9% Uptime SLA"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Reliable service you can count on"})]})]}),u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx(ns,{className:"h-6 w-6 text-primary flex-shrink-0 mt-1"}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-semibold mb-2",children:"24/7 Support"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Help whenever you need it"})]})]}),u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx(ns,{className:"h-6 w-6 text-primary flex-shrink-0 mt-1"}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-semibold mb-2",children:"Free Updates"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Always get the latest features"})]})]}),u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx(ns,{className:"h-6 w-6 text-primary flex-shrink-0 mt-1"}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-semibold mb-2",children:"Data Encryption"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Bank-level security for your data"})]})]}),u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx(ns,{className:"h-6 w-6 text-primary flex-shrink-0 mt-1"}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-semibold mb-2",children:"API Access"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Integrate with your tools"})]})]}),u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx(ns,{className:"h-6 w-6 text-primary flex-shrink-0 mt-1"}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-semibold mb-2",children:"No Hidden Fees"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"What you see is what you pay"})]})]})]})]})]})})]}),zn=_.forwardRef(({className:t,type:e,...n},r)=>u.jsx("input",{type:e,className:Se("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground transition-all duration-200 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:border-ring focus-visible:shadow-[0_0_0_1px_hsl(var(--ring)),0_0_8px_hsl(var(--ring)/0.3)] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...n}));zn.displayName="Input";function ine(t,e=[]){let n=[];function r(s,o){const a=_.createContext(o);a.displayName=s+"Context";const l=n.length;n=[...n,o];const c=h=>{var b;const{scope:p,children:f,...m}=h,g=((b=p==null?void 0:p[t])==null?void 0:b[l])||a,v=_.useMemo(()=>m,Object.values(m));return u.jsx(g.Provider,{value:v,children:f})};c.displayName=s+"Provider";function d(h,p){var g;const f=((g=p==null?void 0:p[t])==null?void 0:g[l])||a,m=_.useContext(f);if(m)return m;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${s}\``)}return[c,d]}const i=()=>{const s=n.map(o=>_.createContext(o));return function(a){const l=(a==null?void 0:a[t])||s;return _.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return i.scopeName=t,[r,sne(i,...e)]}function sne(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:l,scopeName:c})=>{const h=l(s)[`__scope${c}`];return{...a,...h}},{});return _.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}var one=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],u2=one.reduce((t,e)=>{const n=vw(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,l=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),u.jsx(l,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{}),q3={exports:{}},W3={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $p=_;function ane(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var lne=typeof Object.is=="function"?Object.is:ane,cne=$p.useState,une=$p.useEffect,dne=$p.useLayoutEffect,hne=$p.useDebugValue;function pne(t,e){var n=e(),r=cne({inst:{value:n,getSnapshot:e}}),i=r[0].inst,s=r[1];return dne(function(){i.value=n,i.getSnapshot=e,tE(i)&&s({inst:i})},[t,n,e]),une(function(){return tE(i)&&s({inst:i}),t(function(){tE(i)&&s({inst:i})})},[t]),hne(n),n}function tE(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!lne(t,n)}catch{return!0}}function fne(t,e){return e()}var mne=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?fne:pne;W3.useSyncExternalStore=$p.useSyncExternalStore!==void 0?$p.useSyncExternalStore:mne;q3.exports=W3;var gne=q3.exports;function vne(){return gne.useSyncExternalStore(yne,()=>!0,()=>!1)}function yne(){return()=>{}}var d2="Avatar",[xne]=ine(d2),[bne,G3]=xne(d2),K3=_.forwardRef((t,e)=>{const{__scopeAvatar:n,...r}=t,[i,s]=_.useState("idle");return u.jsx(bne,{scope:n,imageLoadingStatus:i,onImageLoadingStatusChange:s,children:u.jsx(u2.span,{...r,ref:e})})});K3.displayName=d2;var Y3="AvatarImage",X3=_.forwardRef((t,e)=>{const{__scopeAvatar:n,src:r,onLoadingStatusChange:i=()=>{},...s}=t,o=G3(Y3,n),a=wne(r,s),l=ws(c=>{i(c),o.onImageLoadingStatusChange(c)});return as(()=>{a!=="idle"&&l(a)},[a,l]),a==="loaded"?u.jsx(u2.img,{...s,ref:e,src:r}):null});X3.displayName=Y3;var Q3="AvatarFallback",Z3=_.forwardRef((t,e)=>{const{__scopeAvatar:n,delayMs:r,...i}=t,s=G3(Q3,n),[o,a]=_.useState(r===void 0);return _.useEffect(()=>{if(r!==void 0){const l=window.setTimeout(()=>a(!0),r);return()=>window.clearTimeout(l)}},[r]),o&&s.imageLoadingStatus!=="loaded"?u.jsx(u2.span,{...i,ref:e}):null});Z3.displayName=Q3;function mR(t,e){return t?e?(t.src!==e&&(t.src=e),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function wne(t,{referrerPolicy:e,crossOrigin:n}){const r=vne(),i=_.useRef(null),s=r?(i.current||(i.current=new window.Image),i.current):null,[o,a]=_.useState(()=>mR(s,t));return as(()=>{a(mR(s,t))},[s,t]),as(()=>{const l=h=>()=>{a(h)};if(!s)return;const c=l("loaded"),d=l("error");return s.addEventListener("load",c),s.addEventListener("error",d),e&&(s.referrerPolicy=e),typeof n=="string"&&(s.crossOrigin=n),()=>{s.removeEventListener("load",c),s.removeEventListener("error",d)}},[s,n,e]),o}var J3=K3,eF=X3,tF=Z3;const _ne=_.forwardRef(({className:t,...e},n)=>u.jsx(J3,{ref:n,className:Se("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...e}));_ne.displayName=J3.displayName;const Ene=_.forwardRef(({className:t,...e},n)=>u.jsx(eF,{ref:n,className:Se("aspect-square h-full w-full object-cover",t),...e}));Ene.displayName=eF.displayName;const Sne=_.forwardRef(({className:t,...e},n)=>u.jsx(tF,{ref:n,className:Se("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...e}));Sne.displayName=tF.displayName;const Cne={showTeamSection:!1},jne=()=>{const[t,e]=_.useState({name:"",email:"",subject:"",message:""}),n=r=>{r.preventDefault(),L.success("Message sent! We'll get back to you soon."),e({name:"",email:"",subject:"",message:""})};return u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(Os,{}),u.jsx("main",{className:"pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"text-center mb-16",children:[u.jsxs("h1",{className:"text-5xl font-bold mb-4",children:["Get in"," ",u.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Touch"})]}),u.jsx("p",{className:"text-xl text-muted-foreground max-w-3xl mx-auto",children:"Have questions? We'd love to hear from you. Send us a message and we'll respond as soon as possible."})]}),u.jsxs("div",{className:"grid md:grid-cols-3 gap-8 mb-16",children:[u.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 text-center transition-all duration-300 cursor-pointer hover:shadow-[0_0_20px_rgba(59,130,246,0.5)] hover:shadow-blue-500/50 hover:scale-[1.02] hover:-translate-y-1",children:[u.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4 transition-all duration-300",children:u.jsx(Wk,{className:"h-6 w-6 text-primary"})}),u.jsx("h3",{className:"font-semibold mb-2",children:"Email Us"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"info@prossmind.com"})]}),u.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 text-center transition-all duration-300 cursor-pointer hover:shadow-[0_0_20px_rgba(59,130,246,0.5)] hover:shadow-blue-500/50 hover:scale-[1.02] hover:-translate-y-1",children:[u.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4 transition-all duration-300",children:u.jsx(gee,{className:"h-6 w-6 text-primary"})}),u.jsx("h3",{className:"font-semibold mb-2",children:"Call Us"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"+41 78 330 79 67"})]}),u.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 text-center transition-all duration-300 cursor-pointer hover:shadow-[0_0_20px_rgba(59,130,246,0.5)] hover:shadow-blue-500/50 hover:scale-[1.02] hover:-translate-y-1",children:[u.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4 transition-all duration-300",children:u.jsx(Gk,{className:"h-6 w-6 text-primary"})}),u.jsx("h3",{className:"font-semibold mb-2",children:"Live Chat"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Available 24/7"})]})]}),Cne.showTeamSection,u.jsx("div",{className:"max-w-2xl mx-auto",children:u.jsxs("form",{onSubmit:n,className:"bg-card border border-border rounded-2xl p-8 space-y-6 transition-all duration-300 hover:shadow-[0_0_20px_rgba(59,130,246,0.3)] hover:shadow-blue-500/30",children:[u.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx("label",{htmlFor:"name",className:"text-sm font-medium",children:"Name"}),u.jsx(zn,{id:"name",value:t.name,onChange:r=>e({...t,name:r.target.value}),placeholder:"Your name",className:"transition-all duration-300 focus:shadow-[0_0_15px_rgba(59,130,246,0.4)] focus:shadow-blue-500/40",required:!0})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"Email"}),u.jsx(zn,{id:"email",type:"email",value:t.email,onChange:r=>e({...t,email:r.target.value}),placeholder:"your@email.com",className:"transition-all duration-300 focus:shadow-[0_0_15px_rgba(59,130,246,0.4)] focus:shadow-blue-500/40",required:!0})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx("label",{htmlFor:"subject",className:"text-sm font-medium",children:"Subject"}),u.jsx(zn,{id:"subject",value:t.subject,onChange:r=>e({...t,subject:r.target.value}),placeholder:"How can we help?",className:"transition-all duration-300 focus:shadow-[0_0_15px_rgba(59,130,246,0.4)] focus:shadow-blue-500/40",required:!0})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx("label",{htmlFor:"message",className:"text-sm font-medium",children:"Message"}),u.jsx($i,{id:"message",value:t.message,onChange:r=>e({...t,message:r.target.value}),placeholder:"Tell us more about your inquiry...",className:"min-h-[150px] transition-all duration-300 focus:shadow-[0_0_15px_rgba(59,130,246,0.4)] focus:shadow-blue-500/40",required:!0})]}),u.jsx(G,{type:"submit",size:"lg",className:"w-full transition-all duration-300 hover:shadow-[0_0_20px_rgba(59,130,246,0.6)] hover:shadow-blue-500/60 hover:scale-[1.02]",children:"Send Message"})]})})]})})]})};var kne=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Pne=kne.reduce((t,e)=>{const n=vw(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,l=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),u.jsx(l,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{}),Tne="Label",nF=_.forwardRef((t,e)=>u.jsx(Pne.label,{...t,ref:e,onMouseDown:n=>{var i;n.target.closest("button, input, select, textarea")||((i=t.onMouseDown)==null||i.call(t,n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));nF.displayName=Tne;var rF=nF;const Nne=xv("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Vt=_.forwardRef(({className:t,...e},n)=>u.jsx(rF,{ref:n,className:Se(Nne(),t),...e}));Vt.displayName=rF.displayName;var pn;(function(t){t.assertEqual=i=>{};function e(i){}t.assertIs=e;function n(i){throw new Error}t.assertNever=n,t.arrayToEnum=i=>{const s={};for(const o of i)s[o]=o;return s},t.getValidEnumValues=i=>{const s=t.objectKeys(i).filter(a=>typeof i[i[a]]!="number"),o={};for(const a of s)o[a]=i[a];return t.objectValues(o)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const s=[];for(const o in i)Object.prototype.hasOwnProperty.call(i,o)&&s.push(o);return s},t.find=(i,s)=>{for(const o of i)if(s(o))return o},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function r(i,s=" | "){return i.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}t.joinValues=r,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(pn||(pn={}));var gR;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(gR||(gR={}));const Xe=pn.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),yc=t=>{switch(typeof t){case"undefined":return Xe.undefined;case"string":return Xe.string;case"number":return Number.isNaN(t)?Xe.nan:Xe.number;case"boolean":return Xe.boolean;case"function":return Xe.function;case"bigint":return Xe.bigint;case"symbol":return Xe.symbol;case"object":return Array.isArray(t)?Xe.array:t===null?Xe.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?Xe.promise:typeof Map<"u"&&t instanceof Map?Xe.map:typeof Set<"u"&&t instanceof Set?Xe.set:typeof Date<"u"&&t instanceof Date?Xe.date:Xe.object;default:return Xe.unknown}},_e=pn.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Cl extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(s){return s.message},r={_errors:[]},i=s=>{for(const o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(i);else if(o.code==="invalid_return_type")i(o.returnTypeError);else if(o.code==="invalid_arguments")i(o.argumentsError);else if(o.path.length===0)r._errors.push(n(o));else{let a=r,l=0;for(;l<o.path.length;){const c=o.path[l];l===o.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(n(o))):a[c]=a[c]||{_errors:[]},a=a[c],l++}}};return i(this),r}static assert(e){if(!(e instanceof Cl))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,pn.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},r=[];for(const i of this.issues)if(i.path.length>0){const s=i.path[0];n[s]=n[s]||[],n[s].push(e(i))}else r.push(e(i));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}Cl.create=t=>new Cl(t);const oC=(t,e)=>{let n;switch(t.code){case _e.invalid_type:t.received===Xe.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case _e.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,pn.jsonStringifyReplacer)}`;break;case _e.unrecognized_keys:n=`Unrecognized key(s) in object: ${pn.joinValues(t.keys,", ")}`;break;case _e.invalid_union:n="Invalid input";break;case _e.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${pn.joinValues(t.options)}`;break;case _e.invalid_enum_value:n=`Invalid enum value. Expected ${pn.joinValues(t.options)}, received '${t.received}'`;break;case _e.invalid_arguments:n="Invalid function arguments";break;case _e.invalid_return_type:n="Invalid function return type";break;case _e.invalid_date:n="Invalid date";break;case _e.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:pn.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case _e.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case _e.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case _e.custom:n="Invalid input";break;case _e.invalid_intersection_types:n="Intersection results could not be merged";break;case _e.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case _e.not_finite:n="Number must be finite";break;default:n=e.defaultError,pn.assertNever(t)}return{message:n}};let One=oC;function Rne(){return One}const Ane=t=>{const{data:e,path:n,errorMaps:r,issueData:i}=t,s=[...n,...i.path||[]],o={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let a="";const l=r.filter(c=>!!c).slice().reverse();for(const c of l)a=c(o,{data:e,defaultError:a}).message;return{...i,path:s,message:a}};function Le(t,e){const n=Rne(),r=Ane({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===oC?void 0:oC].filter(i=>!!i)});t.common.issues.push(r)}class ks{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const r=[];for(const i of n){if(i.status==="aborted")return $t;i.status==="dirty"&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){const r=[];for(const i of n){const s=await i.key,o=await i.value;r.push({key:s,value:o})}return ks.mergeObjectSync(e,r)}static mergeObjectSync(e,n){const r={};for(const i of n){const{key:s,value:o}=i;if(s.status==="aborted"||o.status==="aborted")return $t;s.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof o.value<"u"||i.alwaysSet)&&(r[s.value]=o.value)}return{status:e.value,value:r}}}const $t=Object.freeze({status:"aborted"}),qm=t=>({status:"dirty",value:t}),lo=t=>({status:"valid",value:t}),vR=t=>t.status==="aborted",yR=t=>t.status==="dirty",Mp=t=>t.status==="valid",a0=t=>typeof Promise<"u"&&t instanceof Promise;var Ze;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(Ze||(Ze={}));class Lc{constructor(e,n,r,i){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const xR=(t,e)=>{if(Mp(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new Cl(t.common.issues);return this._error=n,this._error}}};function qt(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:r,description:i}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(o,a)=>{const{message:l}=t;return o.code==="invalid_enum_value"?{message:l??a.defaultError}:typeof a.data>"u"?{message:l??r??a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:l??n??a.defaultError}},description:i}}class hn{get description(){return this._def.description}_getType(e){return yc(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:yc(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ks,ctx:{common:e.parent.common,data:e.data,parsedType:yc(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(a0(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){const r={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:yc(e)},i=this._parseSync({data:e,path:r.path,parent:r});return xR(r,i)}"~validate"(e){var r,i;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:yc(e)};if(!this["~standard"].async)try{const s=this._parseSync({data:e,path:[],parent:n});return Mp(s)?{value:s.value}:{issues:n.common.issues}}catch(s){(i=(r=s==null?void 0:s.message)==null?void 0:r.toLowerCase())!=null&&i.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(s=>Mp(s)?{value:s.value}:{issues:n.common.issues})}async parseAsync(e,n){const r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:yc(e)},i=this._parse({data:e,path:r.path,parent:r}),s=await(a0(i)?i:Promise.resolve(i));return xR(r,s)}refine(e,n){const r=i=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(i):n;return this._refinement((i,s)=>{const o=e(i),a=()=>s.addIssue({code:_e.custom,...r(i)});return typeof Promise<"u"&&o instanceof Promise?o.then(l=>l?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,n){return this._refinement((r,i)=>e(r)?!0:(i.addIssue(typeof n=="function"?n(r,i):n),!1))}_refinement(e){return new Bp({schema:this,typeName:Mt.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Dc.create(this,this._def)}nullable(){return Fp.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Pa.create(this)}promise(){return d0.create(this,this._def)}or(e){return c0.create([this,e],this._def)}and(e){return u0.create(this,e,this._def)}transform(e){return new Bp({...qt(this._def),schema:this,typeName:Mt.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new lC({...qt(this._def),innerType:this,defaultValue:n,typeName:Mt.ZodDefault})}brand(){return new nre({typeName:Mt.ZodBranded,type:this,...qt(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new cC({...qt(this._def),innerType:this,catchValue:n,typeName:Mt.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return h2.create(this,e)}readonly(){return uC.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Ine=/^c[^\s-]{8,}$/i,Dne=/^[0-9a-z]+$/,$ne=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Mne=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Lne=/^[a-z0-9_-]{21}$/i,Bne=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Fne=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,zne=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Hne="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let nE;const Une=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Vne=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,qne=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Wne=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Gne=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Kne=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,iF="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Yne=new RegExp(`^${iF}$`);function sF(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function Xne(t){return new RegExp(`^${sF(t)}$`)}function Qne(t){let e=`${iF}T${sF(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function Zne(t,e){return!!((e==="v4"||!e)&&Une.test(t)||(e==="v6"||!e)&&qne.test(t))}function Jne(t,e){if(!Bne.test(t))return!1;try{const[n]=t.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),i=JSON.parse(atob(r));return!(typeof i!="object"||i===null||"typ"in i&&(i==null?void 0:i.typ)!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function ere(t,e){return!!((e==="v4"||!e)&&Vne.test(t)||(e==="v6"||!e)&&Wne.test(t))}class Oc extends hn{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Xe.string){const s=this._getOrReturnCtx(e);return Le(s,{code:_e.invalid_type,expected:Xe.string,received:s.parsedType}),$t}const r=new ks;let i;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),Le(i,{code:_e.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),Le(i,{code:_e.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){const o=e.data.length>s.value,a=e.data.length<s.value;(o||a)&&(i=this._getOrReturnCtx(e,i),o?Le(i,{code:_e.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&Le(i,{code:_e.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")zne.test(e.data)||(i=this._getOrReturnCtx(e,i),Le(i,{validation:"email",code:_e.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")nE||(nE=new RegExp(Hne,"u")),nE.test(e.data)||(i=this._getOrReturnCtx(e,i),Le(i,{validation:"emoji",code:_e.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")Mne.test(e.data)||(i=this._getOrReturnCtx(e,i),Le(i,{validation:"uuid",code:_e.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")Lne.test(e.data)||(i=this._getOrReturnCtx(e,i),Le(i,{validation:"nanoid",code:_e.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")Ine.test(e.data)||(i=this._getOrReturnCtx(e,i),Le(i,{validation:"cuid",code:_e.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")Dne.test(e.data)||(i=this._getOrReturnCtx(e,i),Le(i,{validation:"cuid2",code:_e.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")$ne.test(e.data)||(i=this._getOrReturnCtx(e,i),Le(i,{validation:"ulid",code:_e.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),Le(i,{validation:"url",code:_e.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),Le(i,{validation:"regex",code:_e.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),Le(i,{code:_e.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),Le(i,{code:_e.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),Le(i,{code:_e.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?Qne(s).test(e.data)||(i=this._getOrReturnCtx(e,i),Le(i,{code:_e.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?Yne.test(e.data)||(i=this._getOrReturnCtx(e,i),Le(i,{code:_e.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?Xne(s).test(e.data)||(i=this._getOrReturnCtx(e,i),Le(i,{code:_e.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?Fne.test(e.data)||(i=this._getOrReturnCtx(e,i),Le(i,{validation:"duration",code:_e.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?Zne(e.data,s.version)||(i=this._getOrReturnCtx(e,i),Le(i,{validation:"ip",code:_e.invalid_string,message:s.message}),r.dirty()):s.kind==="jwt"?Jne(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),Le(i,{validation:"jwt",code:_e.invalid_string,message:s.message}),r.dirty()):s.kind==="cidr"?ere(e.data,s.version)||(i=this._getOrReturnCtx(e,i),Le(i,{validation:"cidr",code:_e.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?Gne.test(e.data)||(i=this._getOrReturnCtx(e,i),Le(i,{validation:"base64",code:_e.invalid_string,message:s.message}),r.dirty()):s.kind==="base64url"?Kne.test(e.data)||(i=this._getOrReturnCtx(e,i),Le(i,{validation:"base64url",code:_e.invalid_string,message:s.message}),r.dirty()):pn.assertNever(s);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(i=>e.test(i),{validation:n,code:_e.invalid_string,...Ze.errToObj(r)})}_addCheck(e){return new Oc({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Ze.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Ze.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Ze.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Ze.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Ze.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Ze.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Ze.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Ze.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Ze.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Ze.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Ze.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Ze.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Ze.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...Ze.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...Ze.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Ze.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...Ze.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...Ze.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...Ze.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...Ze.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...Ze.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...Ze.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...Ze.errToObj(n)})}nonempty(e){return this.min(1,Ze.errToObj(e))}trim(){return new Oc({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Oc({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Oc({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Oc.create=t=>new Oc({checks:[],typeName:Mt.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...qt(t)});function tre(t,e){const n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=n>r?n:r,s=Number.parseInt(t.toFixed(i).replace(".","")),o=Number.parseInt(e.toFixed(i).replace(".",""));return s%o/10**i}class $g extends hn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Xe.number){const s=this._getOrReturnCtx(e);return Le(s,{code:_e.invalid_type,expected:Xe.number,received:s.parsedType}),$t}let r;const i=new ks;for(const s of this._def.checks)s.kind==="int"?pn.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),Le(r,{code:_e.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),Le(r,{code:_e.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),Le(r,{code:_e.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?tre(e.data,s.value)!==0&&(r=this._getOrReturnCtx(e,r),Le(r,{code:_e.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),Le(r,{code:_e.not_finite,message:s.message}),i.dirty()):pn.assertNever(s);return{status:i.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,Ze.toString(n))}gt(e,n){return this.setLimit("min",e,!1,Ze.toString(n))}lte(e,n){return this.setLimit("max",e,!0,Ze.toString(n))}lt(e,n){return this.setLimit("max",e,!1,Ze.toString(n))}setLimit(e,n,r,i){return new $g({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:Ze.toString(i)}]})}_addCheck(e){return new $g({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Ze.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Ze.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Ze.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Ze.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Ze.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:Ze.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:Ze.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Ze.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Ze.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&pn.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}}$g.create=t=>new $g({checks:[],typeName:Mt.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...qt(t)});class Mg extends hn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Xe.bigint)return this._getInvalidInput(e);let r;const i=new ks;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),Le(r,{code:_e.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),Le(r,{code:_e.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),Le(r,{code:_e.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):pn.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return Le(n,{code:_e.invalid_type,expected:Xe.bigint,received:n.parsedType}),$t}gte(e,n){return this.setLimit("min",e,!0,Ze.toString(n))}gt(e,n){return this.setLimit("min",e,!1,Ze.toString(n))}lte(e,n){return this.setLimit("max",e,!0,Ze.toString(n))}lt(e,n){return this.setLimit("max",e,!1,Ze.toString(n))}setLimit(e,n,r,i){return new Mg({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:Ze.toString(i)}]})}_addCheck(e){return new Mg({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Ze.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Ze.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Ze.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Ze.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:Ze.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Mg.create=t=>new Mg({checks:[],typeName:Mt.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...qt(t)});class bR extends hn{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Xe.boolean){const r=this._getOrReturnCtx(e);return Le(r,{code:_e.invalid_type,expected:Xe.boolean,received:r.parsedType}),$t}return lo(e.data)}}bR.create=t=>new bR({typeName:Mt.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...qt(t)});class l0 extends hn{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Xe.date){const s=this._getOrReturnCtx(e);return Le(s,{code:_e.invalid_type,expected:Xe.date,received:s.parsedType}),$t}if(Number.isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return Le(s,{code:_e.invalid_date}),$t}const r=new ks;let i;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),Le(i,{code:_e.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),Le(i,{code:_e.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):pn.assertNever(s);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new l0({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:Ze.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:Ze.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}l0.create=t=>new l0({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:Mt.ZodDate,...qt(t)});class wR extends hn{_parse(e){if(this._getType(e)!==Xe.symbol){const r=this._getOrReturnCtx(e);return Le(r,{code:_e.invalid_type,expected:Xe.symbol,received:r.parsedType}),$t}return lo(e.data)}}wR.create=t=>new wR({typeName:Mt.ZodSymbol,...qt(t)});class _R extends hn{_parse(e){if(this._getType(e)!==Xe.undefined){const r=this._getOrReturnCtx(e);return Le(r,{code:_e.invalid_type,expected:Xe.undefined,received:r.parsedType}),$t}return lo(e.data)}}_R.create=t=>new _R({typeName:Mt.ZodUndefined,...qt(t)});class ER extends hn{_parse(e){if(this._getType(e)!==Xe.null){const r=this._getOrReturnCtx(e);return Le(r,{code:_e.invalid_type,expected:Xe.null,received:r.parsedType}),$t}return lo(e.data)}}ER.create=t=>new ER({typeName:Mt.ZodNull,...qt(t)});class SR extends hn{constructor(){super(...arguments),this._any=!0}_parse(e){return lo(e.data)}}SR.create=t=>new SR({typeName:Mt.ZodAny,...qt(t)});class CR extends hn{constructor(){super(...arguments),this._unknown=!0}_parse(e){return lo(e.data)}}CR.create=t=>new CR({typeName:Mt.ZodUnknown,...qt(t)});class Bc extends hn{_parse(e){const n=this._getOrReturnCtx(e);return Le(n,{code:_e.invalid_type,expected:Xe.never,received:n.parsedType}),$t}}Bc.create=t=>new Bc({typeName:Mt.ZodNever,...qt(t)});class jR extends hn{_parse(e){if(this._getType(e)!==Xe.undefined){const r=this._getOrReturnCtx(e);return Le(r,{code:_e.invalid_type,expected:Xe.void,received:r.parsedType}),$t}return lo(e.data)}}jR.create=t=>new jR({typeName:Mt.ZodVoid,...qt(t)});class Pa extends hn{_parse(e){const{ctx:n,status:r}=this._processInputParams(e),i=this._def;if(n.parsedType!==Xe.array)return Le(n,{code:_e.invalid_type,expected:Xe.array,received:n.parsedType}),$t;if(i.exactLength!==null){const o=n.data.length>i.exactLength.value,a=n.data.length<i.exactLength.value;(o||a)&&(Le(n,{code:o?_e.too_big:_e.too_small,minimum:a?i.exactLength.value:void 0,maximum:o?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(i.minLength!==null&&n.data.length<i.minLength.value&&(Le(n,{code:_e.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&n.data.length>i.maxLength.value&&(Le(n,{code:_e.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((o,a)=>i.type._parseAsync(new Lc(n,o,n.path,a)))).then(o=>ks.mergeArray(r,o));const s=[...n.data].map((o,a)=>i.type._parseSync(new Lc(n,o,n.path,a)));return ks.mergeArray(r,s)}get element(){return this._def.type}min(e,n){return new Pa({...this._def,minLength:{value:e,message:Ze.toString(n)}})}max(e,n){return new Pa({...this._def,maxLength:{value:e,message:Ze.toString(n)}})}length(e,n){return new Pa({...this._def,exactLength:{value:e,message:Ze.toString(n)}})}nonempty(e){return this.min(1,e)}}Pa.create=(t,e)=>new Pa({type:t,minLength:null,maxLength:null,exactLength:null,typeName:Mt.ZodArray,...qt(e)});function Gh(t){if(t instanceof Cr){const e={};for(const n in t.shape){const r=t.shape[n];e[n]=Dc.create(Gh(r))}return new Cr({...t._def,shape:()=>e})}else return t instanceof Pa?new Pa({...t._def,type:Gh(t.element)}):t instanceof Dc?Dc.create(Gh(t.unwrap())):t instanceof Fp?Fp.create(Gh(t.unwrap())):t instanceof Rd?Rd.create(t.items.map(e=>Gh(e))):t}class Cr extends hn{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=pn.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==Xe.object){const c=this._getOrReturnCtx(e);return Le(c,{code:_e.invalid_type,expected:Xe.object,received:c.parsedType}),$t}const{status:r,ctx:i}=this._processInputParams(e),{shape:s,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof Bc&&this._def.unknownKeys==="strip"))for(const c in i.data)o.includes(c)||a.push(c);const l=[];for(const c of o){const d=s[c],h=i.data[c];l.push({key:{status:"valid",value:c},value:d._parse(new Lc(i,h,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof Bc){const c=this._def.unknownKeys;if(c==="passthrough")for(const d of a)l.push({key:{status:"valid",value:d},value:{status:"valid",value:i.data[d]}});else if(c==="strict")a.length>0&&(Le(i,{code:_e.unrecognized_keys,keys:a}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const d of a){const h=i.data[d];l.push({key:{status:"valid",value:d},value:c._parse(new Lc(i,h,i.path,d)),alwaysSet:d in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const c=[];for(const d of l){const h=await d.key,p=await d.value;c.push({key:h,value:p,alwaysSet:d.alwaysSet})}return c}).then(c=>ks.mergeObjectSync(r,c)):ks.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return Ze.errToObj,new Cr({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{var s,o;const i=((o=(s=this._def).errorMap)==null?void 0:o.call(s,n,r).message)??r.defaultError;return n.code==="unrecognized_keys"?{message:Ze.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new Cr({...this._def,unknownKeys:"strip"})}passthrough(){return new Cr({...this._def,unknownKeys:"passthrough"})}extend(e){return new Cr({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Cr({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Mt.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new Cr({...this._def,catchall:e})}pick(e){const n={};for(const r of pn.objectKeys(e))e[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new Cr({...this._def,shape:()=>n})}omit(e){const n={};for(const r of pn.objectKeys(this.shape))e[r]||(n[r]=this.shape[r]);return new Cr({...this._def,shape:()=>n})}deepPartial(){return Gh(this)}partial(e){const n={};for(const r of pn.objectKeys(this.shape)){const i=this.shape[r];e&&!e[r]?n[r]=i:n[r]=i.optional()}return new Cr({...this._def,shape:()=>n})}required(e){const n={};for(const r of pn.objectKeys(this.shape))if(e&&!e[r])n[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof Dc;)s=s._def.innerType;n[r]=s}return new Cr({...this._def,shape:()=>n})}keyof(){return oF(pn.objectKeys(this.shape))}}Cr.create=(t,e)=>new Cr({shape:()=>t,unknownKeys:"strip",catchall:Bc.create(),typeName:Mt.ZodObject,...qt(e)});Cr.strictCreate=(t,e)=>new Cr({shape:()=>t,unknownKeys:"strict",catchall:Bc.create(),typeName:Mt.ZodObject,...qt(e)});Cr.lazycreate=(t,e)=>new Cr({shape:t,unknownKeys:"strip",catchall:Bc.create(),typeName:Mt.ZodObject,...qt(e)});class c0 extends hn{_parse(e){const{ctx:n}=this._processInputParams(e),r=this._def.options;function i(s){for(const a of s)if(a.result.status==="valid")return a.result;for(const a of s)if(a.result.status==="dirty")return n.common.issues.push(...a.ctx.common.issues),a.result;const o=s.map(a=>new Cl(a.ctx.common.issues));return Le(n,{code:_e.invalid_union,unionErrors:o}),$t}if(n.common.async)return Promise.all(r.map(async s=>{const o={...n,common:{...n.common,issues:[]},parent:null};return{result:await s._parseAsync({data:n.data,path:n.path,parent:o}),ctx:o}})).then(i);{let s;const o=[];for(const l of r){const c={...n,common:{...n.common,issues:[]},parent:null},d=l._parseSync({data:n.data,path:n.path,parent:c});if(d.status==="valid")return d;d.status==="dirty"&&!s&&(s={result:d,ctx:c}),c.common.issues.length&&o.push(c.common.issues)}if(s)return n.common.issues.push(...s.ctx.common.issues),s.result;const a=o.map(l=>new Cl(l));return Le(n,{code:_e.invalid_union,unionErrors:a}),$t}}get options(){return this._def.options}}c0.create=(t,e)=>new c0({options:t,typeName:Mt.ZodUnion,...qt(e)});function aC(t,e){const n=yc(t),r=yc(e);if(t===e)return{valid:!0,data:t};if(n===Xe.object&&r===Xe.object){const i=pn.objectKeys(e),s=pn.objectKeys(t).filter(a=>i.indexOf(a)!==-1),o={...t,...e};for(const a of s){const l=aC(t[a],e[a]);if(!l.valid)return{valid:!1};o[a]=l.data}return{valid:!0,data:o}}else if(n===Xe.array&&r===Xe.array){if(t.length!==e.length)return{valid:!1};const i=[];for(let s=0;s<t.length;s++){const o=t[s],a=e[s],l=aC(o,a);if(!l.valid)return{valid:!1};i.push(l.data)}return{valid:!0,data:i}}else return n===Xe.date&&r===Xe.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class u0 extends hn{_parse(e){const{status:n,ctx:r}=this._processInputParams(e),i=(s,o)=>{if(vR(s)||vR(o))return $t;const a=aC(s.value,o.value);return a.valid?((yR(s)||yR(o))&&n.dirty(),{status:n.value,value:a.data}):(Le(r,{code:_e.invalid_intersection_types}),$t)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,o])=>i(s,o)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}u0.create=(t,e,n)=>new u0({left:t,right:e,typeName:Mt.ZodIntersection,...qt(n)});class Rd extends hn{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==Xe.array)return Le(r,{code:_e.invalid_type,expected:Xe.array,received:r.parsedType}),$t;if(r.data.length<this._def.items.length)return Le(r,{code:_e.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),$t;!this._def.rest&&r.data.length>this._def.items.length&&(Le(r,{code:_e.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const s=[...r.data].map((o,a)=>{const l=this._def.items[a]||this._def.rest;return l?l._parse(new Lc(r,o,r.path,a)):null}).filter(o=>!!o);return r.common.async?Promise.all(s).then(o=>ks.mergeArray(n,o)):ks.mergeArray(n,s)}get items(){return this._def.items}rest(e){return new Rd({...this._def,rest:e})}}Rd.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Rd({items:t,typeName:Mt.ZodTuple,rest:null,...qt(e)})};class kR extends hn{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==Xe.map)return Le(r,{code:_e.invalid_type,expected:Xe.map,received:r.parsedType}),$t;const i=this._def.keyType,s=this._def.valueType,o=[...r.data.entries()].map(([a,l],c)=>({key:i._parse(new Lc(r,a,r.path,[c,"key"])),value:s._parse(new Lc(r,l,r.path,[c,"value"]))}));if(r.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const l of o){const c=await l.key,d=await l.value;if(c.status==="aborted"||d.status==="aborted")return $t;(c.status==="dirty"||d.status==="dirty")&&n.dirty(),a.set(c.value,d.value)}return{status:n.value,value:a}})}else{const a=new Map;for(const l of o){const c=l.key,d=l.value;if(c.status==="aborted"||d.status==="aborted")return $t;(c.status==="dirty"||d.status==="dirty")&&n.dirty(),a.set(c.value,d.value)}return{status:n.value,value:a}}}}kR.create=(t,e,n)=>new kR({valueType:e,keyType:t,typeName:Mt.ZodMap,...qt(n)});class Lg extends hn{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==Xe.set)return Le(r,{code:_e.invalid_type,expected:Xe.set,received:r.parsedType}),$t;const i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(Le(r,{code:_e.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),n.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(Le(r,{code:_e.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),n.dirty());const s=this._def.valueType;function o(l){const c=new Set;for(const d of l){if(d.status==="aborted")return $t;d.status==="dirty"&&n.dirty(),c.add(d.value)}return{status:n.value,value:c}}const a=[...r.data.values()].map((l,c)=>s._parse(new Lc(r,l,r.path,c)));return r.common.async?Promise.all(a).then(l=>o(l)):o(a)}min(e,n){return new Lg({...this._def,minSize:{value:e,message:Ze.toString(n)}})}max(e,n){return new Lg({...this._def,maxSize:{value:e,message:Ze.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}Lg.create=(t,e)=>new Lg({valueType:t,minSize:null,maxSize:null,typeName:Mt.ZodSet,...qt(e)});class PR extends hn{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}PR.create=(t,e)=>new PR({getter:t,typeName:Mt.ZodLazy,...qt(e)});class TR extends hn{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return Le(n,{received:n.data,code:_e.invalid_literal,expected:this._def.value}),$t}return{status:"valid",value:e.data}}get value(){return this._def.value}}TR.create=(t,e)=>new TR({value:t,typeName:Mt.ZodLiteral,...qt(e)});function oF(t,e){return new Lp({values:t,typeName:Mt.ZodEnum,...qt(e)})}class Lp extends hn{_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),r=this._def.values;return Le(n,{expected:pn.joinValues(r),received:n.parsedType,code:_e.invalid_type}),$t}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const n=this._getOrReturnCtx(e),r=this._def.values;return Le(n,{received:n.data,code:_e.invalid_enum_value,options:r}),$t}return lo(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return Lp.create(e,{...this._def,...n})}exclude(e,n=this._def){return Lp.create(this.options.filter(r=>!e.includes(r)),{...this._def,...n})}}Lp.create=oF;class NR extends hn{_parse(e){const n=pn.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==Xe.string&&r.parsedType!==Xe.number){const i=pn.objectValues(n);return Le(r,{expected:pn.joinValues(i),received:r.parsedType,code:_e.invalid_type}),$t}if(this._cache||(this._cache=new Set(pn.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const i=pn.objectValues(n);return Le(r,{received:r.data,code:_e.invalid_enum_value,options:i}),$t}return lo(e.data)}get enum(){return this._def.values}}NR.create=(t,e)=>new NR({values:t,typeName:Mt.ZodNativeEnum,...qt(e)});class d0 extends hn{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==Xe.promise&&n.common.async===!1)return Le(n,{code:_e.invalid_type,expected:Xe.promise,received:n.parsedType}),$t;const r=n.parsedType===Xe.promise?n.data:Promise.resolve(n.data);return lo(r.then(i=>this._def.type.parseAsync(i,{path:n.path,errorMap:n.common.contextualErrorMap})))}}d0.create=(t,e)=>new d0({type:t,typeName:Mt.ZodPromise,...qt(e)});class Bp extends hn{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Mt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:r}=this._processInputParams(e),i=this._def.effect||null,s={addIssue:o=>{Le(r,o),o.fatal?n.abort():n.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="preprocess"){const o=i.transform(r.data,s);if(r.common.async)return Promise.resolve(o).then(async a=>{if(n.value==="aborted")return $t;const l=await this._def.schema._parseAsync({data:a,path:r.path,parent:r});return l.status==="aborted"?$t:l.status==="dirty"||n.value==="dirty"?qm(l.value):l});{if(n.value==="aborted")return $t;const a=this._def.schema._parseSync({data:o,path:r.path,parent:r});return a.status==="aborted"?$t:a.status==="dirty"||n.value==="dirty"?qm(a.value):a}}if(i.type==="refinement"){const o=a=>{const l=i.refinement(a,s);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?$t:(a.status==="dirty"&&n.dirty(),o(a.value),{status:n.value,value:a.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>a.status==="aborted"?$t:(a.status==="dirty"&&n.dirty(),o(a.value).then(()=>({status:n.value,value:a.value}))))}if(i.type==="transform")if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Mp(o))return $t;const a=i.transform(o.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:a}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>Mp(o)?Promise.resolve(i.transform(o.value,s)).then(a=>({status:n.value,value:a})):$t);pn.assertNever(i)}}Bp.create=(t,e,n)=>new Bp({schema:t,typeName:Mt.ZodEffects,effect:e,...qt(n)});Bp.createWithPreprocess=(t,e,n)=>new Bp({schema:e,effect:{type:"preprocess",transform:t},typeName:Mt.ZodEffects,...qt(n)});class Dc extends hn{_parse(e){return this._getType(e)===Xe.undefined?lo(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Dc.create=(t,e)=>new Dc({innerType:t,typeName:Mt.ZodOptional,...qt(e)});class Fp extends hn{_parse(e){return this._getType(e)===Xe.null?lo(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Fp.create=(t,e)=>new Fp({innerType:t,typeName:Mt.ZodNullable,...qt(e)});class lC extends hn{_parse(e){const{ctx:n}=this._processInputParams(e);let r=n.data;return n.parsedType===Xe.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}lC.create=(t,e)=>new lC({innerType:t,typeName:Mt.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...qt(e)});class cC extends hn{_parse(e){const{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return a0(i)?i.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Cl(r.common.issues)},input:r.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Cl(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}cC.create=(t,e)=>new cC({innerType:t,typeName:Mt.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...qt(e)});class OR extends hn{_parse(e){if(this._getType(e)!==Xe.nan){const r=this._getOrReturnCtx(e);return Le(r,{code:_e.invalid_type,expected:Xe.nan,received:r.parsedType}),$t}return{status:"valid",value:e.data}}}OR.create=t=>new OR({typeName:Mt.ZodNaN,...qt(t)});class nre extends hn{_parse(e){const{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class h2 extends hn{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?$t:s.status==="dirty"?(n.dirty(),qm(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{const i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?$t:i.status==="dirty"?(n.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(e,n){return new h2({in:e,out:n,typeName:Mt.ZodPipeline})}}class uC extends hn{_parse(e){const n=this._def.innerType._parse(e),r=i=>(Mp(i)&&(i.value=Object.freeze(i.value)),i);return a0(n)?n.then(i=>r(i)):r(n)}unwrap(){return this._def.innerType}}uC.create=(t,e)=>new uC({innerType:t,typeName:Mt.ZodReadonly,...qt(e)});var Mt;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(Mt||(Mt={}));const RR=Oc.create;Bc.create;Pa.create;const rre=Cr.create;c0.create;u0.create;Rd.create;Lp.create;d0.create;Dc.create;Fp.create;const ire=rre({email:RR().email("Invalid email address").max(255,"Email too long"),password:RR().min(6,"Password must be at least 6 characters").max(100,"Password too long")}),aF=()=>{const t=Ns(),{toast:e}=_v(),[n,r]=_.useState(!1),[i,s]=_.useState(""),[o,a]=_.useState(""),[l,c]=_.useState(!1),[d,h]=_.useState(""),[p,f]=_.useState("");_.useEffect(()=>{he.auth.getSession().then(({data:{session:x}})=>{x&&t("/")});const{data:{subscription:b}}=he.auth.onAuthStateChange((x,y)=>{y&&t("/")});return()=>b.unsubscribe()},[t]);const m=async b=>{if(b.preventDefault(),d.length!==6){e({variant:"destructive",title:"Invalid OTP",description:"Please enter a 6-digit code"});return}r(!0);const{error:x}=await he.auth.verifyOtp({email:p,token:d,type:"email"});r(!1),x?e({variant:"destructive",title:"Verification failed",description:x.message}):(e({title:"Success!",description:"Your email has been verified. You can now sign in."}),c(!1),h(""),f(""),s(""),a(""))},g=async()=>{r(!0);const{error:b}=await he.auth.resend({type:"signup",email:p});r(!1),e(b?{variant:"destructive",title:"Resend failed",description:b.message}:{title:"OTP Resent",description:"Check your email for a new verification code."})},v=async b=>{b.preventDefault();const x=ire.safeParse({email:i,password:o});if(!x.success){e({variant:"destructive",title:"Validation Error",description:x.error.errors[0].message});return}r(!0);const{error:y}=await he.auth.signInWithPassword({email:x.data.email,password:x.data.password});r(!1),y&&e({variant:"destructive",title:"Sign in failed",description:y.message})};return u.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:u.jsxs(De,{className:"w-full max-w-md",children:[u.jsxs(He,{children:[u.jsx(We,{className:"text-2xl text-center",children:"Welcome to ProssMind"}),u.jsx(Je,{className:"text-center",children:l?"Verify your email":"Sign in to start generating BPMN diagrams"})]}),u.jsx(Ue,{children:l?u.jsxs("form",{onSubmit:m,className:"space-y-4",children:[u.jsxs(G,{type:"button",variant:"ghost",onClick:()=>{c(!1),h(""),f("")},className:"mb-4 p-0 h-auto",children:[u.jsx(HJ,{className:"h-4 w-4 mr-2"}),"Back to sign up"]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Vt,{htmlFor:"otp",children:"Verification Code"}),u.jsx(zn,{id:"otp",type:"text",placeholder:"Enter 6-digit code",value:d,onChange:b=>h(b.target.value.replace(/\D/g,"").slice(0,6)),maxLength:6,required:!0,disabled:n,className:"text-center text-2xl tracking-widest"}),u.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Enter the 6-digit code sent to ",p]})]}),u.jsx(G,{type:"submit",className:"w-full",disabled:n||d.length!==6,children:n?"Verifying...":"Verify Email"}),u.jsx(G,{type:"button",variant:"link",className:"w-full text-sm",onClick:g,disabled:n,children:"Didn't receive the code? Resend"})]}):u.jsxs("form",{onSubmit:v,className:"space-y-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Vt,{htmlFor:"signin-email",children:"Email"}),u.jsx(zn,{id:"signin-email",type:"email",placeholder:"you@example.com",value:i,onChange:b=>s(b.target.value),required:!0,disabled:n})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Vt,{htmlFor:"signin-password",children:"Password"}),u.jsx(zn,{id:"signin-password",type:"password",placeholder:"",value:o,onChange:b=>a(b.target.value),required:!0,disabled:n})]}),u.jsx(G,{type:"submit",className:"w-full",disabled:n,children:n?"Signing in...":"Sign In"})]})})]})})},Ud=_.forwardRef(({className:t,...e},n)=>u.jsx("div",{className:"relative w-full overflow-auto",children:u.jsx("table",{ref:n,className:Se("w-full caption-bottom text-sm",t),...e})}));Ud.displayName="Table";const Vd=_.forwardRef(({className:t,...e},n)=>u.jsx("thead",{ref:n,className:Se("[&_tr]:border-b",t),...e}));Vd.displayName="TableHeader";const qd=_.forwardRef(({className:t,...e},n)=>u.jsx("tbody",{ref:n,className:Se("[&_tr:last-child]:border-0",t),...e}));qd.displayName="TableBody";const sre=_.forwardRef(({className:t,...e},n)=>u.jsx("tfoot",{ref:n,className:Se("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...e}));sre.displayName="TableFooter";const os=_.forwardRef(({className:t,...e},n)=>u.jsx("tr",{ref:n,className:Se("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",t),...e}));os.displayName="TableRow";const kn=_.forwardRef(({className:t,...e},n)=>u.jsx("th",{ref:n,className:Se("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...e}));kn.displayName="TableHead";const _n=_.forwardRef(({className:t,...e},n)=>u.jsx("td",{ref:n,className:Se("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...e}));_n.displayName="TableCell";const ore=_.forwardRef(({className:t,...e},n)=>u.jsx("caption",{ref:n,className:Se("mt-4 text-sm text-muted-foreground",t),...e}));ore.displayName="TableCaption";const are=xv("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Bn({className:t,variant:e,...n}){return u.jsx("div",{className:Se(are({variant:e}),t),...n})}const lre=()=>{const t=Ns(),[e,n]=_.useState(null),[r,i]=_.useState(!0),[s,o]=_.useState(!1),[a,l]=_.useState([]);_.useEffect(()=>{const{data:{subscription:h}}=he.auth.onAuthStateChange((p,f)=>{n((f==null?void 0:f.user)??null),f!=null&&f.user||t("/auth")});return he.auth.getSession().then(({data:{session:p}})=>{n((p==null?void 0:p.user)??null),p!=null&&p.user||t("/auth")}),()=>h.unsubscribe()},[t]),_.useEffect(()=>{e&&(async()=>{if(e)try{const{data:p,error:f}=await he.from("user_roles").select("role").eq("user_id",e.id).eq("role","admin").maybeSingle();if(f&&f.code!=="PGRST116"&&f.code!=="PGRST301"){console.error("Error checking admin status:",f),L.error("Failed to verify admin status"),t("/");return}const m=!!p;o(m),m||(L.error("Access denied: Admin privileges required"),t("/"))}catch(p){console.error("Unexpected error:",p),t("/")}finally{i(!1)}})()},[e,t]),_.useEffect(()=>{(async()=>{if(s)try{const{data:p,error:f}=await he.from("user_profiles").select("*").order("created_at",{ascending:!1});if(f)throw f;const{data:m,error:g}=await he.from("user_roles").select("user_id, role");if(g)throw g;const v=(m==null?void 0:m.reduce((x,y)=>(x[y.user_id]||(x[y.user_id]=[]),x[y.user_id].push(y.role),x),{}))||{},b=(p==null?void 0:p.map(x=>({...x,roles:v[x.user_id]||["user"]})))||[];l(b)}catch(p){console.error("Error fetching users:",p),L.error("Failed to load users")}})()},[s]);const c=async(h,p)=>{const f=p.includes("admin");try{if(f){const{error:x}=await he.from("user_roles").delete().eq("user_id",h).eq("role","admin");if(x)throw x;L.success("Admin privileges revoked")}else{const{error:x}=await he.from("user_roles").insert({user_id:h,role:"admin"});if(x)throw x;L.success("Admin privileges granted")}const{data:m}=await he.from("user_profiles").select("*").order("created_at",{ascending:!1}),{data:g}=await he.from("user_roles").select("user_id, role"),v=(g==null?void 0:g.reduce((x,y)=>(x[y.user_id]||(x[y.user_id]=[]),x[y.user_id].push(y.role),x),{}))||{},b=(m==null?void 0:m.map(x=>({...x,roles:v[x.user_id]||["user"]})))||[];l(b)}catch(m){console.error("Error toggling admin:",m),L.error("Failed to update admin status")}},d=async h=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{const{error:p}=await he.auth.admin.deleteUser(h);if(p)throw p;L.success("User deleted successfully"),l(a.filter(f=>f.user_id!==h))}catch(p){console.error("Error deleting user:",p),L.error("Failed to delete user")}};return r?u.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),u.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading..."})]})}):s?u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(Os,{user:e}),u.jsxs("div",{className:"container mx-auto px-6 py-24",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[u.jsx(Sl,{className:"h-8 w-8 text-primary"}),u.jsx("h1",{className:"text-4xl font-bold",children:"Admin Dashboard"})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(Cee,{className:"h-5 w-5"}),"User Management"]}),u.jsx(Je,{children:"Manage users, assign roles, and control access permissions"})]}),u.jsx(Ue,{children:u.jsxs(Ud,{children:[u.jsx(Vd,{children:u.jsxs(os,{children:[u.jsx(kn,{children:"Email"}),u.jsx(kn,{children:"Roles"}),u.jsx(kn,{children:"Created At"}),u.jsx(kn,{children:"Actions"})]})}),u.jsx(qd,{children:a.map(h=>u.jsxs(os,{children:[u.jsx(_n,{className:"font-medium",children:h.email}),u.jsx(_n,{children:u.jsx("div",{className:"flex gap-2",children:h.roles.map(p=>u.jsxs(Bn,{variant:p==="admin"?"default":"secondary",children:[p==="admin"&&u.jsx(nR,{className:"h-3 w-3 mr-1"}),p]},p))})}),u.jsx(_n,{children:new Date(h.created_at).toLocaleDateString()}),u.jsx(_n,{children:u.jsxs("div",{className:"flex gap-2",children:[u.jsxs(G,{variant:h.roles.includes("admin")?"destructive":"default",size:"sm",onClick:()=>c(h.user_id,h.roles),disabled:h.user_id===(e==null?void 0:e.id),children:[u.jsx(nR,{className:"h-4 w-4 mr-1"}),h.roles.includes("admin")?"Revoke Admin":"Make Admin"]}),u.jsx(G,{variant:"outline",size:"sm",onClick:()=>d(h.user_id),disabled:h.user_id===(e==null?void 0:e.id),children:u.jsx(wv,{className:"h-4 w-4"})})]})})]},h.id))})]})})]})]})]}):null},cre=()=>{const t=Ns();return _.useEffect(()=>{(async()=>{try{const{data:{user:n}}=await he.auth.getUser();if(!n){L.error("Please log in"),t("/auth");return}const{data:r,error:i}=await he.from("vision_bpmn_jobs").select("bpmn_xml").eq("user_id",n.id).eq("status","completed").order("completed_at",{ascending:!1}).limit(1).single();if(i||!(r!=null&&r.bpmn_xml)){L.error("No completed diagrams found"),t("/vision-ai");return}const s=localStorage.getItem("diagramType")||"bpmn",o=s==="bpmn"?"generatedBpmn":"generatedPid";localStorage.setItem(o,r.bpmn_xml);const a=s==="bpmn"?"BPMN":"P&ID";L.success(`${a} diagram loaded successfully!`),t("/")}catch(n){console.error("Error loading diagram:",n),L.error("Failed to load diagram"),t("/vision-ai")}})()},[t]),u.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),u.jsx("p",{className:"text-muted-foreground",children:"Loading your diagram..."})]})})},ure=()=>{const t=dv();return _.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",t.pathname)},[t.pathname]),u.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gradient-to-br from-background via-muted/30 to-background",children:u.jsxs("div",{className:"text-center px-6 slide-up",children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"mb-4 text-8xl md:text-9xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"404"}),u.jsx("div",{className:"h-1 w-24 bg-gradient-to-r from-primary to-accent mx-auto rounded-full"})]}),u.jsx("h2",{className:"mb-4 text-2xl md:text-3xl font-semibold",children:"Page Not Found"}),u.jsx("p",{className:"mb-8 text-lg text-muted-foreground max-w-md mx-auto",children:"The page you're looking for doesn't exist or has been moved."}),u.jsxs("a",{href:"/",className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-all shadow-lg hover:shadow-xl font-medium",children:[u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Return to Home"]})]})})},lF=()=>u.jsxs(gf,{children:[u.jsx(Ct,{path:"/",element:u.jsx(Ja,{children:u.jsx($te,{})})}),u.jsx(Ct,{path:"/features",element:u.jsx(Ja,{children:u.jsx(Lte,{})})}),u.jsx(Ct,{path:"/vision-ai",element:u.jsx(Ja,{children:u.jsx(V3,{})})}),u.jsx(Ct,{path:"/pricing",element:u.jsx(Ja,{children:u.jsx(rne,{})})}),u.jsx(Ct,{path:"/contact",element:u.jsx(Ja,{children:u.jsx(jne,{})})}),u.jsx(Ct,{path:"/auth",element:u.jsx(Ja,{children:u.jsx(aF,{})})}),u.jsx(Ct,{path:"/admin",element:u.jsx(Ja,{children:u.jsx(lre,{})})}),u.jsx(Ct,{path:"/load-diagram",element:u.jsx(Ja,{children:u.jsx(cre,{})})}),u.jsx(Ct,{path:"*",element:u.jsx(Ja,{children:u.jsx(ure,{})})})]}),dre=()=>u.jsxs("div",{children:[u.jsx("h1",{children:"BPMN Subdomain"}),u.jsx("p",{children:"This is the BPMN subdomain."})]}),rE="prossmind_free_prompts",gm=5,Sw=t=>{const[e,n]=_.useState(gm),[r,i]=_.useState(!1);return _.useEffect(()=>{if(t)n(1/0),i(!1);else{const o=localStorage.getItem(rE),a=o?parseInt(o,10):0,l=Math.max(0,gm-a);n(l),i(l===0)}},[t]),{remainingPrompts:e,hasUsedAllPrompts:r,usePrompt:()=>{if(t)return!0;if(r)return!1;const o=localStorage.getItem(rE),a=o?parseInt(o,10):0;if(a>=gm)return i(!0),n(0),!1;const l=a+1;return localStorage.setItem(rE,l.toString()),n(gm-l),l>=gm&&i(!0),!0},isUnlimited:t}};function Sv(t){bk.call(this,t),this.on("import.parse.complete",function(e){e.error||this._collectIds(e.definitions,e.elementsById)},this),this.on("diagram.destroy",function(){this.get("moddle").ids.clear()},this)}Ce(Sv,bk);Sv.prototype._createModdle=function(t){var e=bk.prototype._createModdle.call(this,t);return e.ids=new wk([32,36,1]),e};Sv.prototype._collectIds=function(t,e){var n=t.$model,r=n.ids,i;r.clear();for(i in e)r.claim(i,e[i])};var hre=["c","C"],pre=["v","V"],fre=["y","Y"],cF=["z","Z"];function mre(t){return t.ctrlKey||t.metaKey||t.shiftKey||t.altKey}function Js(t){return t.altKey?!1:t.ctrlKey||t.metaKey}function Lr(t,e){return t=ke(t)?t:[t],t.indexOf(e.key)!==-1||t.indexOf(e.code)!==-1}function p2(t){return t.shiftKey}function gre(t){return Js(t)&&Lr(hre,t)}function vre(t){return Js(t)&&Lr(pre,t)}function yre(t){return Js(t)&&!p2(t)&&Lr(cF,t)}function xre(t){return Js(t)&&(Lr(fre,t)||Lr(cF,t)&&p2(t))}var Cw="keyboard.keydown",bre="keyboard.keyup",wre=1e3,uF="Keyboard binding is now implicit; explicit binding to an element got removed. For more information, see https://github.com/bpmn-io/diagram-js/issues/661";function Ci(t,e){var n=this;this._config=t=t||{},this._eventBus=e,this._keydownHandler=this._keydownHandler.bind(this),this._keyupHandler=this._keyupHandler.bind(this),e.on("diagram.destroy",function(){n._fire("destroy"),n.unbind()}),t.bindTo&&console.error("unsupported configuration <keyboard.bindTo>",new Error(uF));var r=t&&t.bind!==!1;e.on("canvas.init",function(i){n._target=i.svg,r&&n.bind(),n._fire("init")})}Ci.$inject=["config.keyboard","eventBus"];Ci.prototype._keydownHandler=function(t){this._keyHandler(t,Cw)};Ci.prototype._keyupHandler=function(t){this._keyHandler(t,bre)};Ci.prototype._keyHandler=function(t,e){var n;if(!this._isEventIgnored(t)){var r={keyEvent:t};n=this._eventBus.fire(e||Cw,r),n&&t.preventDefault()}};Ci.prototype._isEventIgnored=function(t){return!1};Ci.prototype.bind=function(t){t&&console.error("unsupported argument <node>",new Error(uF)),this.unbind(),t=this._node=this._target,ie.bind(t,"keydown",this._keydownHandler),ie.bind(t,"keyup",this._keyupHandler),this._fire("bind")};Ci.prototype.getBinding=function(){return this._node};Ci.prototype.unbind=function(){var t=this._node;t&&(this._fire("unbind"),ie.unbind(t,"keydown",this._keydownHandler),ie.unbind(t,"keyup",this._keyupHandler)),this._node=null};Ci.prototype._fire=function(t){this._eventBus.fire("keyboard."+t,{node:this._node})};Ci.prototype.addListener=function(t,e,n){Bt(t)&&(n=e,e=t,t=wre),this._eventBus.on(n||Cw,t,e)};Ci.prototype.removeListener=function(t,e){this._eventBus.off(e||Cw,t)};Ci.prototype.hasModifier=mre;Ci.prototype.isCmd=Js;Ci.prototype.isShift=p2;Ci.prototype.isKey=Lr;var _re=500;function Cf(t,e){var n=this;t.on("editorActions.init",_re,function(r){var i=r.editorActions;n.registerBindings(e,i)})}Cf.$inject=["eventBus","keyboard"];Cf.prototype.registerBindings=function(t,e){function n(r,i){e.isRegistered(r)&&t.addListener(i)}n("undo",function(r){var i=r.keyEvent;if(yre(i))return e.trigger("undo"),!0}),n("redo",function(r){var i=r.keyEvent;if(xre(i))return e.trigger("redo"),!0}),n("copy",function(r){var i=r.keyEvent;if(gre(i))return e.trigger("copy"),!0}),n("paste",function(r){var i=r.keyEvent;if(vre(i))return e.trigger("paste"),!0}),n("stepZoom",function(r){var i=r.keyEvent;if(Lr(["+","Add","="],i)&&Js(i))return e.trigger("stepZoom",{value:1}),!0}),n("stepZoom",function(r){var i=r.keyEvent;if(Lr(["-","Subtract"],i)&&Js(i))return e.trigger("stepZoom",{value:-1}),!0}),n("zoom",function(r){var i=r.keyEvent;if(Lr("0",i)&&Js(i))return e.trigger("zoom",{value:1}),!0}),n("removeSelection",function(r){var i=r.keyEvent;if(Lr(["Backspace","Delete","Del"],i))return e.trigger("removeSelection"),!0})};const f2={__init__:["keyboard","keyboardBindings"],keyboard:["type",Ci],keyboardBindings:["type",Cf]};var Ere={moveSpeed:50,moveSpeedAccelerated:200};function dF(t,e,n){var r=this;this._config=B({},Ere,t||{}),e.addListener(i);function i(s){var o=s.keyEvent,a=r._config;if(e.isCmd(o)&&e.isKey(["ArrowLeft","Left","ArrowUp","Up","ArrowDown","Down","ArrowRight","Right"],o)){var l=e.isShift(o)?a.moveSpeedAccelerated:a.moveSpeed,c;switch(o.key){case"ArrowLeft":case"Left":c="left";break;case"ArrowUp":case"Up":c="up";break;case"ArrowRight":case"Right":c="right";break;case"ArrowDown":case"Down":c="down";break}return r.moveCanvas({speed:l,direction:c}),!0}}this.moveCanvas=function(s){var o=0,a=0,l=s.speed,c=l/Math.min(Math.sqrt(n.viewbox().scale),1);switch(s.direction){case"left":o=c;break;case"up":a=c;break;case"right":o=-c;break;case"down":a=-c;break}n.scroll({dx:o,dy:a})}}dF.$inject=["config.keyboardMove","keyboard","canvas"];const hF={__depends__:[f2],__init__:["keyboardMove"],keyboardMove:["type",dF]};var Sre=/^djs-cursor-.*$/;function jw(t){var e=vt(document.body);e.removeMatching(Sre),t&&e.add("djs-cursor-"+t)}function pF(){jw(null)}var Cre=5e3;function fF(t,e){e=e||"element.click";function n(){return!1}return t.once(e,Cre,n),function(){t.off(e,n)}}function cg(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function Bo(t,e){return{x:t.x-e.x,y:t.y-e.y}}var jre=15;function mF(t,e){var n;function r(a){return o(a.originalEvent)}t.on("canvas.focus.changed",function(a){a.focused?t.on("element.mousedown",500,r):t.off("element.mousedown",r)});function i(a){var l=n.start,c=n.button,d=Pd(a),h=Bo(d,l);if(!n.dragging&&kre(h)>jre&&(n.dragging=!0,c===0&&fF(t),jw("grab")),n.dragging){var p=n.last||n.start;h=Bo(d,p),e.scroll({dx:h.x,dy:h.y}),n.last=d}a.preventDefault()}function s(a){ie.unbind(document,"mousemove",i),ie.unbind(document,"mouseup",s),n=null,pF()}function o(a){if(!ur(a.target,".djs-draggable")){var l=a.button;if(!(l>=2||a.ctrlKey||a.shiftKey||a.altKey))return n={button:l,start:Pd(a)},ie.bind(document,"mousemove",i),ie.bind(document,"mouseup",s),!0}}this.isActive=function(){return!!n}}mF.$inject=["eventBus","canvas"];function kre(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}const gF={__init__:["moveCanvas"],moveCanvas:["type",mF]};function dC(t){return Math.log(t)/Math.log(10)}function vF(t,e){var n=dC(t.min),r=dC(t.max),i=Math.abs(n)+Math.abs(r);return i/e}function Pre(t,e){return Math.max(t.min,Math.min(t.max,e))}var Tre=Math.sign||function(t){return t>=0?1:-1},m2={min:.2,max:4},yF=10,Nre=.1,Ore=.75;function Fa(t,e,n){t=t||{},this._enabled=!1,this._canvas=n,this._container=n._container,this._handleWheel=li(this._handleWheel,this),this._totalDelta=0,this._scale=t.scale||Ore;var r=this;e.on("canvas.focus.changed",function(i){r._init(i.focused&&t.enabled!==!1)})}Fa.$inject=["config.zoomScroll","eventBus","canvas"];Fa.prototype.scroll=function(e){this._canvas.scroll(e)};Fa.prototype.reset=function(){this._canvas.zoom("fit-viewport")};Fa.prototype.zoom=function(e,n){var r=vF(m2,yF*2);this._totalDelta+=e,Math.abs(this._totalDelta)>Nre&&(this._zoom(e,n,r),this._totalDelta=0)};Fa.prototype._handleWheel=function(e){if(this._canvas.isFocused()){var n=this._container;e.preventDefault();var r=e.ctrlKey||uX()&&e.metaKey,i=e.shiftKey,s=-1*this._scale,o;if(r?s*=e.deltaMode===0?.02:.32:s*=e.deltaMode===0?1:16,r){var a=n.getBoundingClientRect(),l={x:e.clientX-a.left,y:e.clientY-a.top};o=Math.sqrt(Math.pow(e.deltaY,2)+Math.pow(e.deltaX,2))*Tre(e.deltaY)*s,this.zoom(o,l)}else i?o={dx:s*e.deltaY,dy:0}:o={dx:s*e.deltaX,dy:s*e.deltaY},this.scroll(o)}};Fa.prototype.stepZoom=function(e,n){var r=vF(m2,yF);this._zoom(e,n,r)};Fa.prototype._zoom=function(t,e,n){var r=this._canvas,i=t>0?1:-1,s=dC(r.zoom()),o=Math.round(s/n)*n;o+=n*i;var a=Math.pow(10,o);r.zoom(Pre(m2,a),e)};Fa.prototype.toggle=function(e){var n=this._container,r=this._handleWheel,i=this._enabled;return typeof e>"u"&&(e=!i),i!==e&&ie[e?"bind":"unbind"](n,"wheel",r,!1),this._enabled=e,e};Fa.prototype._init=function(t){this.toggle(t)};const xF={__init__:["zoomScroll"],zoomScroll:["type",Fa]};function Bg(t){gv.call(this,t)}Ce(Bg,gv);Bg.prototype._navigationModules=[hF,gF,xF];Bg.prototype._modules=[].concat(gv.prototype._modules,Bg.prototype._navigationModules);function iE(t){return t&&t[t.length-1]}function AR(t){return t.y}function IR(t){return t.x}var Rre={left:IR,center:IR,right:function(t){return t.x+t.width},top:AR,middle:AR,bottom:function(t){return t.y+t.height}};function jf(t,e){this._modeling=t,this._rules=e}jf.$inject=["modeling","rules"];jf.prototype._getOrientationDetails=function(t){var e=["top","bottom","middle"],n="x",r="width";return e.indexOf(t)!==-1&&(n="y",r="height"),{axis:n,dimension:r}};jf.prototype._isType=function(t,e){return e.indexOf(t)!==-1};jf.prototype._alignmentPosition=function(t,e){var n=this._getOrientationDetails(t),r=n.axis,i=n.dimension,s={},o={},a=!1,l,c,d;function h(p,f){return Math.round((p[r]+f[r]+f[i])/2)}if(this._isType(t,["left","top"]))s[t]=e[0][r];else if(this._isType(t,["right","bottom"]))d=iE(e),s[t]=d[r]+d[i];else if(this._isType(t,["center","middle"])){if($(e,function(p){var f=p[r]+Math.round(p[i]/2);o[f]?o[f].elements.push(p):o[f]={elements:[p],center:f}}),l=Ei(o,function(p){return p.elements.length>1&&(a=!0),p.elements.length}),a)return s[t]=iE(l).center,s;c=e[0],e=Ei(e,function(p){return p[r]+p[i]}),d=iE(e),s[t]=h(c,d)}return s};jf.prototype.trigger=function(t,e){var n=this._modeling,r,i=ht(t,function(l){return!(l.waypoints||l.host||l.labelTarget)});if(r=this._rules.allowed("elements.align",{elements:i}),ke(r)&&(i=r),!(i.length<2||!r)){var s=Rre[e],o=Ei(i,s),a=this._alignmentPosition(e,o);n.alignElements(o,a)}};const Are={__init__:["alignElements"],alignElements:["type",jf]},Ire=new _k;function kf(t){this._scheduled={},t.on("diagram.destroy",()=>{Object.keys(this._scheduled).forEach(e=>{this.cancel(e)})})}kf.$inject=["eventBus"];kf.prototype.schedule=function(t,e=Ire.next()){this.cancel(e);const n=this._schedule(t,e);return this._scheduled[e]=n,n.promise};kf.prototype._schedule=function(t,e){const n=Dre();return{executionId:setTimeout(()=>{try{this._scheduled[e]=null;try{n.resolve(t())}catch(i){n.reject(i)}}catch(i){console.error("Scheduler#_schedule execution failed",i)}}),promise:n.promise}};kf.prototype.cancel=function(t){const e=this._scheduled[t];e&&(this._cancel(e),this._scheduled[t]=null)};kf.prototype._cancel=function(t){clearTimeout(t.executionId)};function Dre(){const t={};return t.promise=new Promise((e,n)=>{t.resolve=e,t.reject=n}),t}const $re={scheduler:["type",kf]};var Mre="djs-element-hidden",zy=".entry",Lre=1e3,DR=8,Bre=300;function dr(t,e,n,r){this._canvas=t,this._elementRegistry=e,this._eventBus=n,this._scheduler=r,this._current=null,this._init()}dr.$inject=["canvas","elementRegistry","eventBus","scheduler"];dr.prototype._init=function(){var t=this;this._eventBus.on("selection.changed",function(e){var n=e.newSelection,r=n.length?n.length===1?n[0]:n:null;r?t.open(r,!0):t.close()}),this._eventBus.on("elements.changed",function(e){var n=e.elements,r=t._current;if(r){var i=r.target,s=ke(i)?i:[i],o=s.filter(function(l){return n.includes(l)});if(o.length){t.close();var a=s.filter(function(l){return t._elementRegistry.get(l.id)});a.length&&t._updateAndOpen(a.length>1?a:a[0])}}}),this._eventBus.on("canvas.viewbox.changed",function(){t._updatePosition()}),this._eventBus.on("element.marker.update",function(e){if(t.isOpen()){var n=e.element,r=t._current,i=ke(r.target)?r.target:[r.target];i.includes(n)&&t._updateVisibility()}}),this._container=this._createContainer()};dr.prototype._createContainer=function(){var t=bt('<div class="djs-context-pad-parent"></div>');return this._canvas.getContainer().appendChild(t),t};dr.prototype.registerProvider=function(t,e){e||(e=t,t=Lre),this._eventBus.on("contextPad.getProviders",t,function(n){n.providers.push(e)})};dr.prototype.getEntries=function(t){var e=this._getProviders(),n=ke(t)?"getMultiElementContextPadEntries":"getContextPadEntries",r={};return $(e,function(i){if(Bt(i[n])){var s=i[n](t);Bt(s)?r=s(r):$(s,function(o,a){r[a]=o})}}),r};dr.prototype.trigger=function(t,e,n){var r=this,i,s,o=e.delegateTarget||e.target;if(!o)return e.preventDefault();if(i=vn(o,"data-action"),s=e.originalEvent||e,t==="mouseover"){this._timeout=setTimeout(function(){r._mouseout=r.triggerEntry(i,"hover",s,n)},Bre);return}else if(t==="mouseout"){clearTimeout(this._timeout),this._mouseout&&(this._mouseout(),this._mouseout=null);return}return this.triggerEntry(i,t,s,n)};dr.prototype.triggerEntry=function(t,e,n,r){if(this.isShown()){var i=this._current.target,s=this._current.entries,o=s[t];if(o){var a=o.action;if(this._eventBus.fire("contextPad.trigger",{entry:o,event:n})!==!1){if(Bt(a)){if(e==="click")return a(n,i,r)}else if(a[e])return a[e](n,i,r);n.preventDefault()}}}};dr.prototype.open=function(t,e){!e&&this.isOpen(t)||(this.close(),this._updateAndOpen(t))};dr.prototype._getProviders=function(){var t=this._eventBus.createEvent({type:"contextPad.getProviders",providers:[]});return this._eventBus.fire(t),t.providers};dr.prototype._updateAndOpen=function(t){var e=this.getEntries(t),n=this._createHtml(t),r;$(e,function(i,s){var o=i.group||"default",a=bt(i.html||'<div class="entry" draggable="true"></div>'),l;vn(a,"data-action",s),l=at("[data-group="+Sg(o)+"]",n),l||(l=bt('<div class="group"></div>'),vn(l,"data-group",o),n.appendChild(l)),l.appendChild(a),i.className&&Fre(a,i.className),i.title&&vn(a,"title",i.title),i.imageUrl&&(r=bt("<img>"),vn(r,"src",i.imageUrl),r.style.width="100%",r.style.height="100%",a.appendChild(r))}),vt(n).add("open"),this._current={entries:e,html:n,target:t},this._updatePosition(),this._updateVisibility(),this._eventBus.fire("contextPad.open",{current:this._current})};dr.prototype._createHtml=function(t){var e=this,n=bt('<div class="djs-context-pad"></div>');return Zn.bind(n,zy,"click",function(r){e.trigger("click",r)}),Zn.bind(n,zy,"dragstart",function(r){e.trigger("dragstart",r)}),Zn.bind(n,zy,"mouseover",function(r){e.trigger("mouseover",r)}),Zn.bind(n,zy,"mouseout",function(r){e.trigger("mouseout",r)}),ie.bind(n,"mousedown",function(r){r.stopPropagation()}),this._container.appendChild(n),this._eventBus.fire("contextPad.create",{target:t,pad:n}),n};dr.prototype.getPad=function(t){console.warn(new Error("ContextPad#getPad is deprecated and will be removed in future library versions, cf. https://github.com/bpmn-io/diagram-js/pull/888"));let e;return this.isOpen()&&Hre(this._current.target,t)?e=this._current.html:e=this._createHtml(t),{html:e}};dr.prototype.close=function(){this.isOpen()&&(clearTimeout(this._timeout),this._container.innerHTML="",this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)};dr.prototype.isOpen=function(t){var e=this._current;if(!e)return!1;if(!t)return!0;var n=e.target;return ke(t)!==ke(n)?!1:ke(t)?t.length===n.length&&Zs(t,function(r){return n.includes(r)}):n===t};dr.prototype.isShown=function(){return this.isOpen()&&vt(this._current.html).has("open")};dr.prototype.show=function(){this.isOpen()&&(vt(this._current.html).add("open"),this._updatePosition(),this._eventBus.fire("contextPad.show",{current:this._current}))};dr.prototype.hide=function(){this.isOpen()&&(vt(this._current.html).remove("open"),this._eventBus.fire("contextPad.hide",{current:this._current}))};dr.prototype._getPosition=function(t){if(!ke(t)&&En(t)){var e=this._canvas.viewbox(),n=zre(t),r=n.x*e.scale-e.x*e.scale,i=n.y*e.scale-e.y*e.scale;return{left:r+DR*this._canvas.zoom(),top:i}}var s=this._canvas.getContainer(),o=s.getBoundingClientRect(),a=this._getTargetBounds(t);return{left:a.right-o.left+DR*this._canvas.zoom(),top:a.top-o.top}};dr.prototype._updatePosition=function(){const t=()=>{if(this.isOpen()){var e=this._current.html,n=this._getPosition(this._current.target);"x"in n&&"y"in n?(e.style.left=n.x+"px",e.style.top=n.y+"px"):["top","right","bottom","left"].forEach(function(r){r in n&&(e.style[r]=n[r]+"px")})}};this._scheduler.schedule(t,"ContextPad#_updatePosition")};dr.prototype._updateVisibility=function(){const t=()=>{if(this.isOpen()){var e=this,n=this._current.target,r=ke(n)?n:[n],i=r.some(function(s){return e._canvas.hasMarker(s,Mre)});i?e.hide():e.show()}};this._scheduler.schedule(t,"ContextPad#_updateVisibility")};dr.prototype._getTargetBounds=function(t){var e=this,n=ke(t)?t:[t],r=n.map(function(i){return e._canvas.getGraphics(i)});return r.reduce(function(i,s){const o=s.getBoundingClientRect();return i.top=Math.min(i.top,o.top),i.right=Math.max(i.right,o.right),i.bottom=Math.max(i.bottom,o.bottom),i.left=Math.min(i.left,o.left),i.x=i.left,i.y=i.top,i.width=i.right-i.left,i.height=i.bottom-i.top,i},{top:1/0,right:-1/0,bottom:-1/0,left:1/0})};function Fre(t,e){var n=vt(t);e=ke(e)?e:e.split(/\s+/g),e.forEach(function(r){n.add(r)})}function zre(t){return t.waypoints[t.waypoints.length-1]}function Hre(t,e){return t=ke(t)?t:[t],e=ke(e)?e:[e],t.length===e.length&&Zs(t,function(n){return e.includes(n)})}const bF={__depends__:[Ek,$re,zB],contextPad:["type",dr]};var kw,Hn,wF,td,$R,_F,EF,SF,g2,hC,pC,Fg={},CF=[],Ure=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Pw=Array.isArray;function dl(t,e){for(var n in e)t[n]=e[n];return t}function v2(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function jF(t,e,n){var r,i,s,o={};for(s in e)s=="key"?r=e[s]:s=="ref"?i=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?kw.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)o[s]===void 0&&(o[s]=t.defaultProps[s]);return Sb(t,o,r,i,null)}function Sb(t,e,n,r,i){var s={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++wF,__i:-1,__u:0};return i==null&&Hn.vnode!=null&&Hn.vnode(s),s}function Tw(t){return t.children}function Cb(t,e){this.props=t,this.context=e}function zp(t,e){if(e==null)return t.__?zp(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?zp(t):null}function kF(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return kF(t)}}function MR(t){(!t.__d&&(t.__d=!0)&&td.push(t)&&!h0.__r++||$R!=Hn.debounceRendering)&&(($R=Hn.debounceRendering)||_F)(h0)}function h0(){for(var t,e,n,r,i,s,o,a=1;td.length;)td.length>a&&td.sort(EF),t=td.shift(),a=td.length,t.__d&&(n=void 0,r=void 0,i=(r=(e=t).__v).__e,s=[],o=[],e.__P&&((n=dl({},r)).__v=r.__v+1,Hn.vnode&&Hn.vnode(n),y2(e.__P,n,r,e.__n,e.__P.namespaceURI,32&r.__u?[i]:null,s,i??zp(r),!!(32&r.__u),o),n.__v=r.__v,n.__.__k[n.__i]=n,NF(s,n,o),r.__e=r.__=null,n.__e!=i&&kF(n)));h0.__r=0}function PF(t,e,n,r,i,s,o,a,l,c,d){var h,p,f,m,g,v,b,x=r&&r.__k||CF,y=e.length;for(l=Vre(n,e,x,l,y),h=0;h<y;h++)(f=n.__k[h])!=null&&(p=f.__i==-1?Fg:x[f.__i]||Fg,f.__i=h,v=y2(t,f,p,i,s,o,a,l,c,d),m=f.__e,f.ref&&p.ref!=f.ref&&(p.ref&&x2(p.ref,null,f),d.push(f.ref,f.__c||m,f)),g==null&&m!=null&&(g=m),(b=!!(4&f.__u))||p.__k===f.__k?l=TF(f,l,t,b):typeof f.type=="function"&&v!==void 0?l=v:m&&(l=m.nextSibling),f.__u&=-7);return n.__e=g,l}function Vre(t,e,n,r,i){var s,o,a,l,c,d=n.length,h=d,p=0;for(t.__k=new Array(i),s=0;s<i;s++)(o=e[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(l=s+p,(o=t.__k[s]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?Sb(null,o,null,null,null):Pw(o)?Sb(Tw,{children:o},null,null,null):o.constructor==null&&o.__b>0?Sb(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,a=null,(c=o.__i=qre(o,n,l,h))!=-1&&(h--,(a=n[c])&&(a.__u|=2)),a==null||a.__v==null?(c==-1&&(i>d?p--:i<d&&p++),typeof o.type!="function"&&(o.__u|=4)):c!=l&&(c==l-1?p--:c==l+1?p++:(c>l?p--:p++,o.__u|=4))):t.__k[s]=null;if(h)for(s=0;s<d;s++)(a=n[s])!=null&&!(2&a.__u)&&(a.__e==r&&(r=zp(a)),RF(a,a));return r}function TF(t,e,n,r){var i,s;if(typeof t.type=="function"){for(i=t.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=t,e=TF(i[s],e,n,r));return e}t.__e!=e&&(r&&(e&&t.type&&!e.parentNode&&(e=zp(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function qre(t,e,n,r){var i,s,o,a=t.key,l=t.type,c=e[n],d=c!=null&&(2&c.__u)==0;if(c===null&&t.key==null||d&&a==c.key&&l==c.type)return n;if(r>(d?1:0)){for(i=n-1,s=n+1;i>=0||s<e.length;)if((c=e[o=i>=0?i--:s++])!=null&&!(2&c.__u)&&a==c.key&&l==c.type)return o}return-1}function LR(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||Ure.test(e)?n:n+"px"}function Hy(t,e,n,r,i){var s,o;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||LR(t.style,e,"");if(n)for(e in n)r&&n[e]==r[e]||LR(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(SF,"$1")),o=e.toLowerCase(),e=o in t||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=n,n?r?n.u=r.u:(n.u=g2,t.addEventListener(e,s?pC:hC,s)):t.removeEventListener(e,s?pC:hC,s);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function BR(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=g2++;else if(e.t<n.u)return;return n(Hn.event?Hn.event(e):e)}}}function y2(t,e,n,r,i,s,o,a,l,c){var d,h,p,f,m,g,v,b,x,y,w,E,S,j,C,P,R,N=e.type;if(e.constructor!=null)return null;128&n.__u&&(l=!!(32&n.__u),s=[a=e.__e=n.__e]),(d=Hn.__b)&&d(e);e:if(typeof N=="function")try{if(b=e.props,x="prototype"in N&&N.prototype.render,y=(d=N.contextType)&&r[d.__c],w=d?y?y.props.value:d.__:r,n.__c?v=(h=e.__c=n.__c).__=h.__E:(x?e.__c=h=new N(b,w):(e.__c=h=new Cb(b,w),h.constructor=N,h.render=Gre),y&&y.sub(h),h.props=b,h.state||(h.state={}),h.context=w,h.__n=r,p=h.__d=!0,h.__h=[],h._sb=[]),x&&h.__s==null&&(h.__s=h.state),x&&N.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=dl({},h.__s)),dl(h.__s,N.getDerivedStateFromProps(b,h.__s))),f=h.props,m=h.state,h.__v=e,p)x&&N.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),x&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(x&&N.getDerivedStateFromProps==null&&b!==f&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(b,w),!h.__e&&h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(b,h.__s,w)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(h.props=b,h.state=h.__s,h.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(I){I&&(I.__=e)}),E=0;E<h._sb.length;E++)h.__h.push(h._sb[E]);h._sb=[],h.__h.length&&o.push(h);break e}h.componentWillUpdate!=null&&h.componentWillUpdate(b,h.__s,w),x&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(f,m,g)})}if(h.context=w,h.props=b,h.__P=t,h.__e=!1,S=Hn.__r,j=0,x){for(h.state=h.__s,h.__d=!1,S&&S(e),d=h.render(h.props,h.state,h.context),C=0;C<h._sb.length;C++)h.__h.push(h._sb[C]);h._sb=[]}else do h.__d=!1,S&&S(e),d=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++j<25);h.state=h.__s,h.getChildContext!=null&&(r=dl(dl({},r),h.getChildContext())),x&&!p&&h.getSnapshotBeforeUpdate!=null&&(g=h.getSnapshotBeforeUpdate(f,m)),P=d,d!=null&&d.type===Tw&&d.key==null&&(P=OF(d.props.children)),a=PF(t,Pw(P)?P:[P],e,n,r,i,s,o,a,l,c),h.base=e.__e,e.__u&=-161,h.__h.length&&o.push(h),v&&(h.__E=h.__=null)}catch(I){if(e.__v=null,l||s!=null)if(I.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,e.__e=a}else{for(R=s.length;R--;)v2(s[R]);fC(e)}else e.__e=n.__e,e.__k=n.__k,I.then||fC(e);Hn.__e(I,e,n)}else s==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):a=e.__e=Wre(n.__e,e,n,r,i,s,o,l,c);return(d=Hn.diffed)&&d(e),128&e.__u?void 0:a}function fC(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(fC)}function NF(t,e,n){for(var r=0;r<n.length;r++)x2(n[r],n[++r],n[++r]);Hn.__c&&Hn.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(s){s.call(i)})}catch(s){Hn.__e(s,i.__v)}})}function OF(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:Pw(t)?t.map(OF):dl({},t)}function Wre(t,e,n,r,i,s,o,a,l){var c,d,h,p,f,m,g,v=n.props,b=e.props,x=e.type;if(x=="svg"?i="http://www.w3.org/2000/svg":x=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(c=0;c<s.length;c++)if((f=s[c])&&"setAttribute"in f==!!x&&(x?f.localName==x:f.nodeType==3)){t=f,s[c]=null;break}}if(t==null){if(x==null)return document.createTextNode(b);t=document.createElementNS(i,x,b.is&&b),a&&(Hn.__m&&Hn.__m(e,s),a=!1),s=null}if(x==null)v===b||a&&t.data==b||(t.data=b);else{if(s=s&&kw.call(t.childNodes),v=n.props||Fg,!a&&s!=null)for(v={},c=0;c<t.attributes.length;c++)v[(f=t.attributes[c]).name]=f.value;for(c in v)if(f=v[c],c!="children"){if(c=="dangerouslySetInnerHTML")h=f;else if(!(c in b)){if(c=="value"&&"defaultValue"in b||c=="checked"&&"defaultChecked"in b)continue;Hy(t,c,null,f,i)}}for(c in b)f=b[c],c=="children"?p=f:c=="dangerouslySetInnerHTML"?d=f:c=="value"?m=f:c=="checked"?g=f:a&&typeof f!="function"||v[c]===f||Hy(t,c,f,v[c],i);if(d)a||h&&(d.__html==h.__html||d.__html==t.innerHTML)||(t.innerHTML=d.__html),e.__k=[];else if(h&&(t.innerHTML=""),PF(e.type=="template"?t.content:t,Pw(p)?p:[p],e,n,r,x=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,o,s?s[0]:n.__k&&zp(n,0),a,l),s!=null)for(c=s.length;c--;)v2(s[c]);a||(c="value",x=="progress"&&m==null?t.removeAttribute("value"):m!=null&&(m!==t[c]||x=="progress"&&!m||x=="option"&&m!=v[c])&&Hy(t,c,m,v[c],i),c="checked",g!=null&&g!=t[c]&&Hy(t,c,g,v[c],i))}return t}function x2(t,e,n){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(i){Hn.__e(i,n)}}function RF(t,e,n){var r,i;if(Hn.unmount&&Hn.unmount(t),(r=t.ref)&&(r.current&&r.current!=t.__e||x2(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){Hn.__e(s,e)}r.base=r.__P=null}if(r=t.__k)for(i=0;i<r.length;i++)r[i]&&RF(r[i],e,n||typeof t.type!="function");n||v2(t.__e),t.__c=t.__=t.__e=void 0}function Gre(t,e,n){return this.constructor(t,n)}function Nw(t,e,n){var r,i,s,o;e==document&&(e=document.documentElement),Hn.__&&Hn.__(t,e),i=(r=!1)?null:e.__k,s=[],o=[],y2(e,t=e.__k=jF(Tw,null,[t]),i||Fg,Fg,e.namespaceURI,i?null:e.firstChild?kw.call(e.childNodes):null,s,i?i.__e:e.firstChild,r,o),NF(s,t,o)}kw=CF.slice,Hn={__e:function(t,e,n,r){for(var i,s,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(t)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,r||{}),o=i.__d),o)return i.__E=i}catch(a){t=a}throw t}},wF=0,Cb.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=dl({},this.state),typeof t=="function"&&(t=t(dl({},n),this.props)),t&&dl(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),MR(this))},Cb.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),MR(this))},Cb.prototype.render=Tw,td=[],_F=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,EF=function(t,e){return t.__v.__b-e.__v.__b},h0.__r=0,SF=/(PointerCapture)$|Capture$/i,g2=0,hC=BR(!1),pC=BR(!0);var AF=function(t,e,n,r){var i;e[0]=0;for(var s=1;s<e.length;s++){var o=e[s++],a=e[s]?(e[0]|=o?1:2,n[e[s++]]):e[++s];o===3?r[0]=a:o===4?r[1]=Object.assign(r[1]||{},a):o===5?(r[1]=r[1]||{})[e[++s]]=a:o===6?r[1][e[++s]]+=a+"":o?(i=t.apply(a,AF(t,a,n,["",null])),r.push(i),a[0]?e[0]|=2:(e[s-2]=0,e[s]=i)):r.push(a)}return r},FR=new Map;function Kre(t){var e=FR.get(this);return e||(e=new Map,FR.set(this,e)),(e=AF(this,e.get(t)||(e.set(t,e=function(n){for(var r,i,s=1,o="",a="",l=[0],c=function(p){s===1&&(p||(o=o.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?l.push(0,p,o):s===3&&(p||o)?(l.push(3,p,o),s=2):s===2&&o==="..."&&p?l.push(4,p,0):s===2&&o&&!p?l.push(5,0,!0,o):s>=5&&((o||!p&&s===5)&&(l.push(s,0,o,i),s=6),p&&(l.push(s,p,0,i),s=6)),o=""},d=0;d<n.length;d++){d&&(s===1&&c(),c(d));for(var h=0;h<n[d].length;h++)r=n[d][h],s===1?r==="<"?(c(),l=[l],s=3):o+=r:s===4?o==="--"&&r===">"?(s=1,o=""):o=r+o[0]:a?r===a?a="":o+=r:r==='"'||r==="'"?a=r:r===">"?(c(),s=1):s&&(r==="="?(s=5,i=o,o=""):r==="/"&&(s<5||n[d][h+1]===">")?(c(),s===3&&(l=l[0]),s=l,(l=l[0]).push(2,0,s),s=0):r===" "||r==="	"||r===`
`||r==="\r"?(c(),s=2):o+=r),s===3&&o==="!--"&&(s=4,l=l[0])}return c(),l}(t)),e),arguments,[])).length>1?e:e[0]}var Dt=Kre.bind(jF),Hp,or,sE,zR,zg=0,IF=[],fr=Hn,HR=fr.__b,UR=fr.__r,VR=fr.diffed,qR=fr.__c,WR=fr.unmount,GR=fr.__;function Ow(t,e){fr.__h&&fr.__h(or,t,zg||e),zg=0;var n=or.__H||(or.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function fp(t){return zg=1,Yre(DF,t)}function Yre(t,e,n){var r=Ow(Hp++,2);if(r.t=t,!r.__c&&(r.__=[DF(void 0,e),function(a){var l=r.__N?r.__N[0]:r.__[0],c=r.t(l,a);l!==c&&(r.__N=[c,r.__[1]],r.__c.setState({}))}],r.__c=or,!or.__f)){var i=function(a,l,c){if(!r.__c.__H)return!0;var d=r.__c.__H.__.filter(function(p){return!!p.__c});if(d.every(function(p){return!p.__N}))return!s||s.call(this,a,l,c);var h=r.__c.props!==a;return d.forEach(function(p){if(p.__N){var f=p.__[0];p.__=p.__N,p.__N=void 0,f!==p.__[0]&&(h=!0)}}),s&&s.call(this,a,l,c)||h};or.__f=!0;var s=or.shouldComponentUpdate,o=or.componentWillUpdate;or.componentWillUpdate=function(a,l,c){if(this.__e){var d=s;s=void 0,i(a,l,c),s=d}o&&o.call(this,a,l,c)},or.shouldComponentUpdate=i}return r.__N||r.__}function mp(t,e){var n=Ow(Hp++,3);!fr.__s&&b2(n.__H,e)&&(n.__=t,n.u=e,or.__H.__h.push(n))}function Ad(t,e){var n=Ow(Hp++,4);!fr.__s&&b2(n.__H,e)&&(n.__=t,n.u=e,or.__h.push(n))}function Cv(t){return zg=5,ml(function(){return{current:t}},[])}function ml(t,e){var n=Ow(Hp++,7);return b2(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function Io(t,e){return zg=8,ml(function(){return t},e)}function Xre(){for(var t;t=IF.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(jb),t.__H.__h.forEach(mC),t.__H.__h=[]}catch(e){t.__H.__h=[],fr.__e(e,t.__v)}}fr.__b=function(t){or=null,HR&&HR(t)},fr.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),GR&&GR(t,e)},fr.__r=function(t){UR&&UR(t),Hp=0;var e=(or=t.__c).__H;e&&(sE===or?(e.__h=[],or.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(jb),e.__h.forEach(mC),e.__h=[],Hp=0)),sE=or},fr.diffed=function(t){VR&&VR(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(IF.push(e)!==1&&zR===fr.requestAnimationFrame||((zR=fr.requestAnimationFrame)||Qre)(Xre)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),sE=or=null},fr.__c=function(t,e){e.some(function(n){try{n.__h.forEach(jb),n.__h=n.__h.filter(function(r){return!r.__||mC(r)})}catch(r){e.some(function(i){i.__h&&(i.__h=[])}),e=[],fr.__e(r,n.__v)}}),qR&&qR(t,e)},fr.unmount=function(t){WR&&WR(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{jb(r)}catch(i){e=i}}),n.__H=void 0,e&&fr.__e(e,n.__v))};var KR=typeof requestAnimationFrame=="function";function Qre(t){var e,n=function(){clearTimeout(r),KR&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,35);KR&&(e=requestAnimationFrame(n))}function jb(t){var e=or,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),or=e}function mC(t){var e=or;t.__c=t.__(),or=e}function b2(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function DF(t,e){return typeof e=="function"?e(t):e}function Zre(t){const{headerEntries:e,onSelect:n,selectedEntry:r,setSelectedEntry:i,title:s}=t,o=ml(()=>Jre(e),[e]),a=c=>c.action&&!c.disabled,l=(c,d)=>{if(a(d))return n(c,d)};return Dt`
    <div class="djs-popup-header">
      <h3 class="djs-popup-title" title=${s}>${s}</h3>
      ${o.map(c=>Dt`
        <ul key=${c.id} class="djs-popup-header-group" data-header-group=${c.id}>

          ${c.entries.map(d=>Dt`
            <li key=${d.id}>
              <${a(d)?"button":"span"}
                class=${eie(d,d===r)}
                onClick=${h=>l(h,d)}
                title=${d.title||d.label}
                data-id=${d.id}
                aria-disabled=${d.disabled||void 0}
                onMouseEnter=${()=>a(d)&&i(d)}
                onMouseLeave=${()=>a(d)&&i(null)}
                onFocus=${()=>a(d)&&i(d)}
                onBlur=${()=>a(d)&&i(null)}
              >
                ${d.imageUrl&&Dt`<img class="djs-popup-entry-icon" src=${d.imageUrl} alt="" />`||d.imageHtml&&Dt`<div class="djs-popup-entry-icon" dangerouslySetInnerHTML=${{__html:d.imageHtml}} />`}
                ${d.label?Dt`
                  <span class="djs-popup-label">${d.label}</span>
                `:null}
              </${d.action?"button":"span"}>
            </li>
          `)}
        </ul>
      `)}
    </div>
  `}function Jre(t){return t.reduce((e,n)=>{const r=n.group||"default",i=e.find(s=>s.id===r);return i?i.entries.push(n):e.push({id:r,entries:[n]}),e},[])}function eie(t,e){return Aa("entry",t.className,t.active?"active":"",t.disabled?"disabled":"",e?"selected":"")}function tie(t){const{entry:e,selected:n,onMouseEnter:r,onMouseLeave:i,onAction:s}=t,o=(a,l)=>{if(!e.disabled)return s(a,e,l)};return Dt`
    <li
      class=${Aa("entry",{selected:n,disabled:e.disabled})}
      data-id=${e.id}
      title=${e.title||e.label}
      aria-disabled=${e.disabled||void 0}
      tabIndex="0"
      onClick=${o}
      onFocus=${r}
      onBlur=${i}
      onMouseEnter=${r}
      onMouseLeave=${i}
      onDragStart=${a=>o(a,"dragstart")}
      draggable=${!0}
    >
      <div class="djs-popup-entry-content">
        <span
          class=${Aa("djs-popup-entry-name",e.className)}
        >
          ${e.imageUrl&&Dt`<img class="djs-popup-entry-icon" src=${e.imageUrl} alt="" />`||e.imageHtml&&Dt`<div class="djs-popup-entry-icon" dangerouslySetInnerHTML=${{__html:e.imageHtml}} />`}

          ${e.label?Dt`
            <span class="djs-popup-label">
              ${e.label}
            </span>
          `:null}
        </span>
        ${e.description&&Dt`
          <span
            class="djs-popup-entry-description"
            title=${e.description}
          >
            ${e.description}
          </span>
        `}
      </div>
      ${e.documentationRef&&Dt`
        <div class="djs-popup-entry-docs">
          <a
            href="${e.documentationRef}"
            onClick=${a=>a.stopPropagation()}
            title="Open element documentation"
            target="_blank"
            rel="noopener"
          >
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M10.6368 10.6375V5.91761H11.9995V10.6382C11.9995 10.9973 11.8623 11.3141 11.5878 11.5885C11.3134 11.863 10.9966 12.0002 10.6375 12.0002H1.36266C0.982345 12.0002 0.660159 11.8681 0.396102 11.6041C0.132044 11.34 1.52588e-05 11.0178 1.52588e-05 10.6375V1.36267C1.52588e-05 0.98236 0.132044 0.660173 0.396102 0.396116C0.660159 0.132058 0.982345 2.95639e-05 1.36266 2.95639e-05H5.91624V1.36267H1.36266V10.6375H10.6368ZM12 0H7.2794L7.27873 1.36197H9.68701L3.06507 7.98391L4.01541 8.93425L10.6373 2.31231V4.72059H12V0Z" fill="#818798"/>
            </svg>
          </a>
        </div>
      `}
    </li>
  `}function nie(t){const{selectedEntry:e,setSelectedEntry:n,groupedEntries:r,...i}=t,s=Cv();return Ad(()=>{const o=s.current;if(!o)return;const a=o.querySelector(".selected");a&&rie(a)},[e]),Dt`
    <div class="djs-popup-results" ref=${s}>
      ${r.map(o=>Dt`
        ${o.name&&Dt`
          <div key=${o.id} class="entry-header" title=${o.name}>
            ${o.name}
          </div>
        `}
        <ul class="djs-popup-group" data-group=${o.id}>
          ${o.entries.map(a=>Dt`
            <${tie}
              key=${a.id}
              entry=${a}
              selected=${a===e}
              onMouseEnter=${()=>n(a)}
              onMouseLeave=${()=>n(null)}
              ...${i}
            />
          `)}
        </ul>
      `)}
    </div>
  `}function rie(t){typeof t.scrollIntoViewIfNeeded=="function"?t.scrollIntoViewIfNeeded():t.scrollIntoView({scrollMode:"if-needed",block:"nearest"})}function iie(t){const{onClose:e,onSelect:n,className:r,headerEntries:i,position:s,title:o,width:a,scale:l,search:c,emptyPlaceholder:d,searchFn:h,entries:p,onOpened:f,onClosed:m}=t,g=ml(()=>an(c)?p.length>5:!1,[c,p]),[v,b]=fp(""),x=Io((M,W)=>{if(!g)return M;if(!W.trim())return M.filter(({rank:se=0})=>se>=0);const ce=M.filter(({searchable:se})=>se!==!1);return h(ce,W,{keys:["label","search","description"]}).map(({item:se})=>se)},[g]),[y,w]=fp(x(p,v)),[E,S]=fp(y[0]),j=ml(()=>aie(y),[y]),C=Io(M=>{S(M[0]),w(M)},[w,S]);mp(()=>{C(x(p,v))},[v,p]);const P=Io(M=>{const W=oie(j);let se=W.indexOf(E)+M;se<0&&(se=W.length-1),se>=W.length&&(se=0),S(W[se])},[j,E,S]),R=Io(M=>{if(M.key==="Enter"&&E)return E.disabled?void 0:n(M,E);if(M.key==="ArrowUp")return P(-1),M.preventDefault();if(M.key==="ArrowDown")return P(1),M.preventDefault()},[n,E,P]),N=Io(M=>{zd(M.target,"input")&&b(()=>M.target.value)},[b]);mp(()=>(f(),()=>{m()}),[]);const I=ml(()=>o||i.length>0,[o,i]);return Dt`
    <${YR}
      onClose=${e}
      onKeyup=${N}
      onKeydown=${R}
      className=${r}
      position=${s}
      width=${a}
      scale=${l}
    >
      ${I&&Dt`
        <${Zre}
          headerEntries=${i}
          onSelect=${n}
          selectedEntry=${E}
          setSelectedEntry=${S}
          title=${o}
        />
      `}
      ${p.length>0&&Dt`
        <div class="djs-popup-body">

          ${g&&Dt`
          <div class="djs-popup-search">
            <svg class="djs-popup-search-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.0325 8.5H9.625L13.3675 12.25L12.25 13.3675L8.5 9.625V9.0325L8.2975 8.8225C7.4425 9.5575 6.3325 10 5.125 10C2.4325 10 0.25 7.8175 0.25 5.125C0.25 2.4325 2.4325 0.25 5.125 0.25C7.8175 0.25 10 2.4325 10 5.125C10 6.3325 9.5575 7.4425 8.8225 8.2975L9.0325 8.5ZM1.75 5.125C1.75 6.9925 3.2575 8.5 5.125 8.5C6.9925 8.5 8.5 6.9925 8.5 5.125C8.5 3.2575 6.9925 1.75 5.125 1.75C3.2575 1.75 1.75 3.2575 1.75 5.125Z" fill="#22242A"/>
            </svg>
            <input type="text" spellcheck=${!1} aria-label="${o}" />
          </div>
          `}

          <${nie}
            groupedEntries=${j}
            selectedEntry=${E}
            setSelectedEntry=${S}
            onAction=${n}
          />
        </div>
      `}
    ${d&&y.length===0&&Dt`
      <div class="djs-popup-no-results">${Bt(d)?d(v):d}</div>
    `}
    </${YR}>
  `}function YR(t){const{onClose:e,onKeydown:n,onKeyup:r,className:i,children:s,position:o}=t,a=Cv();return Ad(()=>{if(typeof o!="function")return;const l=a.current,c=o(l);l.style.left=`${c.x}px`,l.style.top=`${c.y}px`},[a.current,o]),Ad(()=>{const l=a.current;if(!l)return;(l.querySelector("input")||l).focus()},[]),mp(()=>{const l=d=>{if(d.key==="Escape")return d.preventDefault(),e()},c=d=>{if(!ur(d.target,".djs-popup",!0))return e()};return document.documentElement.addEventListener("keydown",l),document.body.addEventListener("click",c),()=>{document.documentElement.removeEventListener("keydown",l),document.body.removeEventListener("click",c)}},[]),Dt`
    <div
      class=${Aa("djs-popup",i)}
      style=${sie(t)}
      onKeydown=${n}
      onKeyup=${r}
      ref=${a}
      tabIndex="-1"
    >
      ${s}
    </div>
  `}function sie(t){return{transform:`scale(${t.scale})`,width:`${t.width}px`,"transform-origin":"top left"}}function oie(t){const e=[];return t.forEach(n=>{n.entries.forEach(r=>{e.push(r)})}),e}function aie(t){const e=[],n=s=>e.find(o=>s.id===o.id),r=s=>!!n(s),i=s=>typeof s=="string"?{id:s}:s;return t.forEach(s=>{const o=s.group?i(s.group):{id:"default"};r(o)?n(o).entries.push(s):e.push({...o,entries:[s]})}),e}var lie="data-id",$F=["contextPad.close","canvas.viewbox.changing","commandStack.changed"],cie=1e3;function Gn(t,e,n,r){this._eventBus=e,this._canvas=n,this._search=r,this._current=null;var i=an(t&&t.scale)?t.scale:{min:1,max:1};this._config={scale:i},e.on("diagram.destroy",()=>{this.close()}),e.on("element.changed",s=>{const o=this.isOpen()&&this._current.target;s.element===o&&this.refresh()})}Gn.$inject=["config.popupMenu","eventBus","canvas","search"];Gn.prototype._render=function(){const{position:t,providerId:e,entries:n,headerEntries:r,emptyPlaceholder:i,options:s}=this._current,o=Object.entries(n).map(([p,f])=>({id:p,...f})),a=Object.entries(r).map(([p,f])=>({id:p,...f})),l=t&&(p=>this._ensureVisible(p,t)),c=this._updateScale(this._current.container);Nw(Dt`
      <${iie}
        onClose=${p=>this.close(p)}
        onSelect=${(p,f,m)=>this.trigger(p,f,m)}
        position=${l}
        className=${e}
        entries=${o}
        headerEntries=${a}
        emptyPlaceholder=${i}
        scale=${c}
        onOpened=${this._onOpened.bind(this)}
        onClosed=${this._onClosed.bind(this)}
        searchFn=${this._search}
        ...${{...s}}
      />
    `,this._current.container)};Gn.prototype.open=function(t,e,n,r){if(!t)throw new Error("target is missing");if(!e)throw new Error("providers for <"+e+"> not found");if(!n)throw new Error("position is missing");this.isOpen()&&this.close();const{entries:i,headerEntries:s,emptyPlaceholder:o}=this._getContext(t,e);this._current={position:n,providerId:e,target:t,entries:i,headerEntries:s,emptyPlaceholder:o,container:this._createContainer({provider:e}),options:r},this._emit("open"),this._bindAutoClose(),this._render()};Gn.prototype.refresh=function(){if(!this.isOpen())return;const{target:t,providerId:e}=this._current,{entries:n,headerEntries:r,emptyPlaceholder:i}=this._getContext(t,e);this._current={...this._current,entries:n,headerEntries:r,emptyPlaceholder:i},this._emit("refresh"),this._render()};Gn.prototype._getContext=function(t,e){const n=this._getProviders(e);if(!n||!n.length)throw new Error("provider for <"+e+"> not found");const r=this._getEntries(t,n),i=this._getHeaderEntries(t,n),s=this._getEmptyPlaceholder(n);return{entries:r,headerEntries:i,emptyPlaceholder:s,empty:!(Object.keys(r).length||Object.keys(i).length)}};Gn.prototype.close=function(){this.isOpen()&&(this._emit("close"),this.reset(),this._canvas.restoreFocus(),this._current=null)};Gn.prototype.reset=function(){const t=this._current.container;Nw(null,t),Nr(t)};Gn.prototype._emit=function(t,e){this._eventBus.fire(`popupMenu.${t}`,e)};Gn.prototype._onOpened=function(){this._emit("opened")};Gn.prototype._onClosed=function(){this._emit("closed")};Gn.prototype._createContainer=function(t){var e=this._canvas,n=e.getContainer();const r=bt(`<div class="djs-popup-parent djs-scrollable" data-popup=${t.provider}></div>`);return n.appendChild(r),r};Gn.prototype._bindAutoClose=function(){this._eventBus.once($F,this.close,this)};Gn.prototype._unbindAutoClose=function(){this._eventBus.off($F,this.close,this)};Gn.prototype._updateScale=function(){var t=this._canvas.zoom(),e=this._config.scale,n,r,i=t;return e!==!0&&(e===!1?(n=1,r=1):(n=e.min,r=e.max),an(n)&&t<n&&(i=n),an(r)&&t>r&&(i=r)),i};Gn.prototype._ensureVisible=function(t,e){var n=document.documentElement.getBoundingClientRect(),r=t.getBoundingClientRect(),i={},s=e.x,o=e.y;return e.x+r.width>n.width&&(i.x=!0),e.y+r.height>n.height&&(i.y=!0),i.x&&i.y?(s=e.x-r.width,o=e.y-r.height):i.x?(s=e.x-r.width,o=e.y):i.y&&e.y<r.height?(s=e.x,o=10):i.y&&(s=e.x,o=e.y-r.height),e.y<n.top&&(o=e.y+r.height),{x:s,y:o}};Gn.prototype.isEmpty=function(t,e){if(!t)throw new Error("target is missing");if(!e)throw new Error("provider ID is missing");const n=this._getProviders(e);return!n||!n.length?!0:this._getContext(t,e).empty};Gn.prototype.registerProvider=function(t,e,n){n||(n=e,e=cie),this._eventBus.on("popupMenu.getProviders."+t,e,function(r){r.providers.push(n)})};Gn.prototype._getProviders=function(t){var e=this._eventBus.createEvent({type:"popupMenu.getProviders."+t,providers:[]});return this._eventBus.fire(e),e.providers};Gn.prototype._getEntries=function(t,e){var n={};return $(e,function(r){if(!r.getPopupMenuEntries){$(r.getEntries(t),function(s){var o=s.id;if(!o)throw new Error("entry ID is missing");n[o]=oo(s,["id"])});return}var i=r.getPopupMenuEntries(t);Bt(i)?n=i(n):$(i,function(s,o){n[o]=s})}),n};Gn.prototype._getHeaderEntries=function(t,e){var n={};return $(e,function(r){if(!r.getPopupMenuHeaderEntries){if(!r.getHeaderEntries)return;$(r.getHeaderEntries(t),function(s){var o=s.id;if(!o)throw new Error("entry ID is missing");n[o]=oo(s,["id"])});return}var i=r.getPopupMenuHeaderEntries(t);Bt(i)?n=i(n):$(i,function(s,o){n[o]=s})}),n};Gn.prototype._getEmptyPlaceholder=function(t){const e=t.find(n=>Bt(n.getEmptyPlaceholder));return e&&e.getEmptyPlaceholder()};Gn.prototype.isOpen=function(){return!!this._current};Gn.prototype.trigger=function(t,e,n="click"){if(t.preventDefault(),!e){let i=ur(t.delegateTarget||t.target,".entry",!0),s=vn(i,lie);e={id:s,...this._getEntry(s)}}const r=e.action;if(this._emit("trigger",{entry:e,event:t})!==!1){if(Bt(r)){if(n==="click")return r(t,e)}else if(r[n])return r[n](t,e)}};Gn.prototype._getEntry=function(t){var e=this._current.entries[t]||this._current.headerEntries[t];if(!e)throw new Error("entry not found");return e};function uie(t,e,n){const{keys:r}=n;if(e=e.trim().toLowerCase(),!e)throw new Error("<pattern> must not be empty");const i=e.trim().toLowerCase().split(/\s+/);return t.flatMap(s=>{const o=die(s,i,r);return o?{item:s,tokens:o}:[]}).sort(hie(r))}function die(t,e,n){const{matchedWords:r,tokens:i}=n.reduce((s,o)=>{const a=t[o],{tokens:l,matchedWords:c}=ke(a)?a.reduce((d,h)=>{const{tokens:p,matchedWords:f}=ZR(h,e);return{tokens:[...d.tokens,p],matchedWords:{...d.matchedWords,...f}}},{matchedWords:{},tokens:[]}):ZR(a,e);return{tokens:{...s.tokens,[o]:l},matchedWords:{...s.matchedWords,...c}}},{matchedWords:{},tokens:{}});return Object.keys(r).length!==e.length?null:i}function hie(t){return(e,n)=>{let r=0,i=1;for(const s of t){const o=pie(e.tokens[s],n.tokens[s]);if(o!==0){r+=o*i,i*=.9;continue}const a=fie(e.item[s],n.item[s]);if(a!==0){r+=a*i,i*=.9;continue}}return r}}function pie(t,e){return XR(e)-XR(t)}function XR(t){return t.reduce((e,n)=>e+MF(n),0)}function MF(t){if(ke(t))return Math.max(...t.map(MF));const e=Math.log(t.value.length);return t.match?(t.start?t.end?131.9:7.87:t.wordStart?2.19:1)*e:-.07*e}function QR(t=""){return ke(t)?t.join(", "):t}function fie(t,e){return QR(t).localeCompare(QR(e))}function ZR(t,e){if(!t)return{tokens:[],matchedWords:{}};const n=[],r={},i=e.map(mie),s=[`(?<all>${i.join("\\s+")})`,...i].join("|"),o=new RegExp(s,"ig");let a,l=0;for(;a=o.exec(t);){const[c]=a,d=a.index,h=a.index+c.length,p=d===0,f=h===t.length,m=!!a.groups.all,g=p||/\s/.test(t.charAt(d-1)),v=f||/\s/.test(t.charAt(h));a.index>l&&n.push({value:t.slice(l,a.index),index:l}),n.push({value:c,index:a.index,match:!0,wordStart:g,wordEnd:v,start:p,end:f,all:m});const b=m?e:[c];for(const x of b)r[x.toLowerCase()]=!0;l=a.index+c.length}return l<t.length&&n.push({value:t.slice(l),index:l}),{tokens:n,matchedWords:r}}function mie(t){return t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&")}const LF={search:["value",uie]},w2={__depends__:[LF],__init__:["popupMenu"],popupMenu:["type",Gn]};var BF={align:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2000 2000">
              <line x1="200" y1="150" x2="200" y2="1850" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
              <rect x="500" y="150" width="1300" height="700" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
              <rect x="500" y="1150" width="700" height="700" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,bottom:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="150" y1="1650" x2="1650" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="150" y="350" width="600" height="1300" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="1050" y="850" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,center:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="900" y1="150" x2="900" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="250" y="150" width="1300" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="500" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,left:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="100" y1="150" x2="100" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="100" y="150" width="1300" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="100" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,right:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="1650" y1="150" x2="1650" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="350" y="150" width="1300" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="850" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,top:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="150" y1="150" x2="1650" y2="150" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="150" y="150" width="600" height="1300" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="1050" y="150" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,middle:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="150" y1="900" x2="1650" y2="900" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="150" y="250" width="600" height="1300" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="1050" y="500" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`},gie=900;function Pf(t,e,n,r){t.registerProvider(gie,this),this._contextPad=t,this._popupMenu=e,this._translate=n,this._canvas=r}Pf.$inject=["contextPad","popupMenu","translate","canvas"];Pf.prototype.getMultiElementContextPadEntries=function(t){var e={};return this._isAllowed(t)&&B(e,this._getEntries(t)),e};Pf.prototype._isAllowed=function(t){return!this._popupMenu.isEmpty(t,"align-elements")};Pf.prototype._getEntries=function(){var t=this;return{"align-elements":{group:"align-elements",title:t._translate("Align elements"),html:`<div class="entry">${BF.align}</div>`,action:{click:function(e,n){var r=t._getMenuPosition(n);B(r,{cursor:{x:e.x,y:e.y}}),t._popupMenu.open(n,"align-elements",r)}}}}};Pf.prototype._getMenuPosition=function(t){var e=5,n=this._contextPad.getPad(t).html,r=n.getBoundingClientRect(),i={x:r.left,y:r.bottom+e};return i};var vie=["left","center","right","top","middle","bottom"];function jv(t,e,n,r){this._alignElements=e,this._translate=n,this._popupMenu=t,this._rules=r,t.registerProvider("align-elements",this)}jv.$inject=["popupMenu","alignElements","translate","rules"];jv.prototype.getPopupMenuEntries=function(t){var e={};return this._isAllowed(t)&&B(e,this._getEntries(t)),e};jv.prototype._isAllowed=function(t){return this._rules.allowed("elements.align",{elements:t})};jv.prototype._getEntries=function(t){var e=this._alignElements,n=this._translate,r=this._popupMenu,i={};return $(vie,function(s){i["align-elements-"+s]={group:"align",title:n("Align elements "+s),className:"bjs-align-elements-menu-entry",imageHtml:BF[s],action:function(){e.trigger(t,s),r.close()}}}),i};function co(t){ye.call(this,t),this.init()}co.$inject=["eventBus"];Ce(co,ye);co.prototype.addRule=function(t,e,n){var r=this;typeof t=="string"&&(t=[t]),t.forEach(function(i){r.canExecute(i,e,function(s,o,a){return n(s)},!0)})};co.prototype.init=function(){};function Rw(t){co.call(this,t)}Rw.$inject=["eventBus"];Ce(Rw,co);Rw.prototype.init=function(){this.addRule("elements.align",function(t){var e=t.elements,n=ht(e,function(r){return!(r.waypoints||r.host||r.labelTarget)});return n=hw(n),n.length<2?!1:n})};const yie={__depends__:[Are,bF,w2],__init__:["alignElementsContextPadProvider","alignElementsMenuProvider","bpmnAlignElements"],alignElementsContextPadProvider:["type",Pf],alignElementsMenuProvider:["type",jv],bpmnAlignElements:["type",Rw]};var xie=10,FF=50,bie=250;function _2(t,e,n,r){for(var i;i=wie(t,n,e);)n=r(e,n,i);return n}function E2(t){return function(e,n,r){var i={x:n.x,y:n.y};return["x","y"].forEach(function(s){var o=t[s];if(o){var a=s==="x"?"width":"height",l=o.margin,c=o.minDistance;l<0?i[s]=Math.min(r[s]+l-e[a]/2,n[s]-c+l):i[s]=Math.max(r[s]+r[a]+l+e[a]/2,n[s]+c+l)}}),i}}function wie(t,e,n){var r={x:e.x-n.width/2,y:e.y-n.height/2,width:n.width,height:n.height},i=Eie(t);return Tt(i,function(s){if(s===n)return!1;var o=ci(s,r,xie);return o==="intersect"})}function _ie(t,e){e||(e={});function n(m){return m.source===t?1:-1}var r=e.defaultDistance||FF,i=e.direction||"e",s=e.filter,o=e.getWeight||n,a=e.maxDistance||bie,l=e.reference||"start";s||(s=jie);function c(m,g){return i==="n"?l==="start"?dt(m).top-dt(g).bottom:l==="center"?dt(m).top-xt(g).y:dt(m).top-dt(g).top:i==="w"?l==="start"?dt(m).left-dt(g).right:l==="center"?dt(m).left-xt(g).x:dt(m).left-dt(g).left:i==="s"?l==="start"?dt(g).top-dt(m).bottom:l==="center"?xt(g).y-dt(m).bottom:dt(g).bottom-dt(m).bottom:l==="start"?dt(g).left-dt(m).right:l==="center"?xt(g).x-dt(m).right:dt(g).right-dt(m).right}var d=t.incoming.filter(s).map(function(m){var g=o(m),v=g<0?c(m.source,t):c(t,m.source);return{id:m.source.id,distance:v,weight:g}}),h=t.outgoing.filter(s).map(function(m){var g=o(m),v=g>0?c(t,m.target):c(m.target,t);return{id:m.target.id,distance:v,weight:g}}),p=d.concat(h).reduce(function(m,g){return m[g.id+"__weight_"+g.weight]=g,m},{}),f=xr(p,function(m,g){var v=g.distance,b=g.weight;return v<0||v>a||(m[String(v)]||(m[String(v)]=0),m[String(v)]+=1*b,(!m.distance||m[m.distance]<m[String(v)])&&(m.distance=v)),m},{});return f.distance||r}function Eie(t){var e=oE(t);return t.host&&(e=e.concat(oE(t.host))),t.attachers&&(e=e.concat(t.attachers.reduce(function(n,r){return n.concat(oE(r))},[]))),e}function oE(t){return Cie(t).concat(Sie(t))}function Sie(t){return t.incoming.map(function(e){return e.source})}function Cie(t){return t.outgoing.map(function(e){return e.target})}function jie(){return!0}var kie=100;function zF(t,e,n){t.on("autoPlace",kie,function(r){var i=r.shape,s=r.source;return Pie(s,i)}),t.on("autoPlace.end",function(r){n.scrollToElement(r.shape)}),this.append=function(r,i,s){t.fire("autoPlace.start",{source:r,shape:i});var o=t.fire("autoPlace",{source:r,shape:i}),a=e.appendShape(r,i,o,r.parent,s);return t.fire("autoPlace.end",{source:r,shape:a}),a}}zF.$inject=["eventBus","modeling","canvas"];function Pie(t,e,n){n||(n={});var r=n.defaultDistance||FF,i=xt(t),s=dt(t);return{x:s.right+r+e.width/2,y:i.y}}function HF(t,e){t.on("autoPlace.end",500,function(n){e.select(n.shape)})}HF.$inject=["eventBus","selection"];const Tie={__init__:["autoPlaceSelectionBehavior"],autoPlace:["type",zF],autoPlaceSelectionBehavior:["type",HF]};function Up(t,e){for(Fi(e)&&(e=[e]);t=t.parent;)if(Lt(t,e))return t;return null}function UF(t,e){var n=Up(t,"bpmn:Process");if(n)return!0;var r=["bpmn:Participant","bpmn:Lane"];if(n=Up(t,r),n)return Yr(n);if(Lt(t,r))return Yr(t);var i;for(i=Me(t);i&&!T(i,"bpmn:Process");i=i.$parent);if(!e)return!0;var s=e.find(function(o){var a=Me(o);return a&&a.get("processRef")===i});return s?Yr(s):!0}function VF(t,e,n){var r=UF(t,n);if(T(e,"bpmn:TextAnnotation"))return Oie(t,e,r);if(Lt(e,["bpmn:DataObjectReference","bpmn:DataStoreReference"]))return Rie(t,e,r);if(T(e,"bpmn:FlowNode"))return Nie(t,e,r)}function Nie(t,e,n){var r=dt(t),i=xt(t),s=n?{directionHint:"e",minDistance:80,baseOrientation:"left",boundaryOrientation:"top",start:"top",end:"bottom"}:{directionHint:"s",minDistance:90,baseOrientation:"top",boundaryOrientation:"left",start:"left",end:"right"},o=_ie(t,{filter:function(f){return T(f,"bpmn:SequenceFlow")},direction:s.directionHint}),a=30,l=s.minDistance,c=s.baseOrientation;T(t,"bpmn:BoundaryEvent")&&(c=ci(t,t.host,-25),c.indexOf(s.boundaryOrientation)!==-1&&(a*=-1));var d=n?{x:r.right+o+e.width/2,y:i.y+JR(c,l,s)}:{x:i.x+JR(c,l,s),y:r.bottom+o+e.height/2},h={margin:a,minDistance:l},p=n?{y:h}:{x:h};return _2(t,e,d,E2(p))}function JR(t,e,n){return t.includes(n.start)?-1*e:t.includes(n.end)?e:0}function Oie(t,e,n){var r=dt(t),i=n?{x:r.right+e.width/2,y:r.top-50-e.height/2}:{x:r.right+50+e.width/2,y:r.bottom+e.height/2};En(t)&&(i=xt(t),n?(i.x+=100,i.y-=50):(i.x+=100,i.y+=50));var s={margin:n?-30:30,minDistance:20},o=n?{y:s}:{x:s};return _2(t,e,i,E2(o))}function Rie(t,e,n){var r=dt(t),i=n?{x:r.right-10+e.width/2,y:r.bottom+40+e.width/2}:{x:r.left-40-e.width/2,y:r.bottom-10+e.height/2},s={margin:30,minDistance:30},o=n?{x:s}:{y:s};return _2(t,e,i,E2(o))}function qF(t,e){t.on("autoPlace",function(n){var r=n.shape,i=n.source;return VF(i,r,e)})}qF.$inject=["eventBus","elementRegistry"];const S2={__depends__:[Tie],__init__:["bpmnAutoPlace"],bpmnAutoPlace:["type",qF]};function Ol(t,e,n,r){ye.call(this,t),this._elementRegistry=e,this._modeling=n,this._rules=r;var i=this;this.postExecuted(["shape.create"],function(s){var o=s.context,a=o.hints||{},l=o.shape,c=o.parent||o.newParent;a.autoResize!==!1&&i._expand([l],c)}),this.postExecuted(["elements.move"],function(s){var o=s.context,a=Cg(yf(o.closure.topLevel)),l=o.hints,c=l?l.autoResize:!0;if(c!==!1){var d=Kc(a,function(h){return h.parent.id});$(d,function(h,p){ke(c)&&(h=h.filter(function(f){return Tt(c,Cs({id:f.id}))})),i._expand(h,p)})}}),this.postExecuted(["shape.toggleCollapse"],function(s){var o=s.context,a=o.hints,l=o.shape;a&&a.autoResize===!1||l.collapsed||i._expand(l.children||[],l)}),this.postExecuted(["shape.resize"],function(s){var o=s.context,a=o.hints,l=o.shape,c=l.parent;a&&a.autoResize===!1||c&&i._expand([l],c)})}Ol.$inject=["eventBus","elementRegistry","modeling","rules"];Ce(Ol,ye);Ol.prototype._getOptimalBounds=function(t,e){var n=this.getOffset(e),r=this.getPadding(e),i=dt(Di(t)),s=dt(e),o={};return i.top-s.top<r.top&&(o.top=i.top-n.top),i.left-s.left<r.left&&(o.left=i.left-n.left),s.right-i.right<r.right&&(o.right=i.right+n.right),s.bottom-i.bottom<r.bottom&&(o.bottom=i.bottom+n.bottom),Sk(B({},s,o))};Ol.prototype._expand=function(t,e){typeof e=="string"&&(e=this._elementRegistry.get(e));var n=this._rules.allowed("element.autoResize",{elements:t,target:e});if(n){var r=this._getOptimalBounds(t,e);if(Aie(r,e)){var i=Iie(ui(e,["x","y","width","height"]),r);this.resize(e,r,{autoResize:i});var s=e.parent;s&&this._expand([e],s)}}};Ol.prototype.getOffset=function(t){return{top:60,bottom:60,left:100,right:100}};Ol.prototype.getPadding=function(t){return{top:2,bottom:2,left:15,right:15}};Ol.prototype.resize=function(t,e,n){this._modeling.resizeShape(t,e,null,n)};function Aie(t,e){return t.x!==e.x||t.y!==e.y||t.width!==e.width||t.height!==e.height}function Iie(t,e){var n="";return t=dt(t),e=dt(e),t.top>e.top&&(n=n.concat("n")),t.right<e.right&&(n=n.concat("w")),t.bottom<e.bottom&&(n=n.concat("s")),t.left>e.left&&(n=n.concat("e")),n}function Aw(t){t.invoke(Ol,this)}Aw.$inject=["injector"];Ce(Aw,Ol);Aw.prototype.resize=function(t,e,n){T(t,"bpmn:Participant")?this._modeling.resizeLane(t,e,null,n):this._modeling.resizeShape(t,e,null,n)};function kv(t){co.call(this,t);var e=this;this.addRule("element.autoResize",function(n){return e.canResize(n.elements,n.target)})}kv.$inject=["eventBus"];Ce(kv,co);kv.prototype.canResize=function(t,e){return!1};function Iw(t,e){kv.call(this,t),this._modeling=e}Ce(Iw,kv);Iw.$inject=["eventBus","modeling"];Iw.prototype.canResize=function(t,e){if(T(e.di,"bpmndi:BPMNPlane")||!T(e,"bpmn:Participant")&&!T(e,"bpmn:Lane")&&!T(e,"bpmn:SubProcess"))return!1;var n=!0;return $(t,function(r){if(T(r,"bpmn:Lane")||Wt(r)){n=!1;return}}),n};const Die={__init__:["bpmnAutoResize","bpmnAutoResizeProvider"],bpmnAutoResize:["type",Aw],bpmnAutoResizeProvider:["type",Iw]};var eA=1500;function WF(t,e,n){var r=this,i=n.get("dragging",!1);function s(o){if(!o.hover){var a=o.originalEvent,l=r._findTargetGfx(a),c=l&&t.get(l);l&&c&&(o.stopPropagation(),i.hover({element:c,gfx:l}),i.move(a))}}i&&e.on("drag.start",function(o){e.once("drag.move",eA,function(a){s(a)})}),function(){var o,a;e.on("element.hover",function(l){o=l.gfx,a=l.element}),e.on("element.hover",eA,function(l){a&&e.fire("element.out",{element:a,gfx:o})}),e.on("element.out",function(){o=null,a=null})}(),this._findTargetGfx=function(o){var a,l;if(o instanceof MouseEvent)return a=Pd(o),l=document.elementFromPoint(a.x,a.y),$ie(l)}}WF.$inject=["elementRegistry","eventBus","injector"];function $ie(t){return ur(t,"svg, .djs-element",!0)}const Mie={__init__:["hoverFix"],hoverFix:["type",WF]};var Oh=Math.round,tA="djs-drag-active";function Du(t){t.preventDefault()}function Lie(t){return typeof TouchEvent<"u"&&t instanceof TouchEvent}function Bie(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}function GF(t,e,n,r){var i={threshold:5,trapClick:!0},s;function o(y){var w=e.viewbox(),E=e._container.getBoundingClientRect();return{x:w.x+(y.x-E.left)/w.scale,y:w.y+(y.y-E.top)/w.scale}}function a(y,w){w=w||s;var E=t.createEvent(B({},w.payload,w.data,{isTouch:w.isTouch}));return t.fire("drag."+y,E)===!1?!1:t.fire(w.prefix+"."+y,E)}function l(y){var w=y.filter(function(E){return r.get(E.id)});w.length&&n.select(w)}function c(y,w){var E=s.payload,S=s.displacement,j=s.globalStart,C=Pd(y),P=Bo(C,j),R=s.localStart,N=o(C),I=Bo(N,R);if(!s.active&&(w||Bie(P)>s.threshold)){if(B(E,{x:Oh(R.x+S.x),y:Oh(R.y+S.y),dx:0,dy:0},{originalEvent:y}),a("start")===!1)return v();s.active=!0,s.keepSelection||(E.previousSelection=n.get(),n.select(null)),s.cursor&&jw(s.cursor),e.addMarker(e.getRootElement(),tA)}L1(y),s.active&&(B(E,{x:Oh(N.x+S.x),y:Oh(N.y+S.y),dx:Oh(I.x),dy:Oh(I.y)},{originalEvent:y}),a("move"))}function d(y){var w,E=!0;s.active&&(y&&(s.payload.originalEvent=y,L1(y)),E=a("end")),E===!1&&a("rejected"),w=b(E!==!0),a("ended",w)}function h(y){Lr("Escape",y)&&(Du(y),v())}function p(y){var w;s.active&&(w=fF(t),setTimeout(w,400),Du(y)),d(y)}function f(y){c(y)}function m(y){var w=s.payload;w.hoverGfx=y.gfx,w.hover=y.element,a("hover")}function g(y){a("out");var w=s.payload;w.hoverGfx=null,w.hover=null}function v(y){var w;if(s){var E=s.active;E&&a("cancel"),w=b(y),E&&a("canceled",w)}}function b(y){var w,E;a("cleanup"),pF(),s.trapClick?E=p:E=d,ie.unbind(document,"mousemove",c),ie.unbind(document,"dragstart",Du),ie.unbind(document,"selectstart",Du),ie.unbind(document,"mousedown",E,!0),ie.unbind(document,"mouseup",E,!0),ie.unbind(document,"keyup",h),ie.unbind(document,"touchstart",f,!0),ie.unbind(document,"touchcancel",v,!0),ie.unbind(document,"touchmove",c,!0),ie.unbind(document,"touchend",d,!0),t.off("element.hover",m),t.off("element.out",g),e.removeMarker(e.getRootElement(),tA);var S=s.payload.previousSelection;return y!==!1&&S&&!n.get().length&&l(S),w=s,s=null,w}function x(y,w,E,S){s&&v(!1),typeof w=="string"&&(S=E,E=w,w=null),S=B({},i,S||{});var j=S.data||{},C,P,R,N,I;S.trapClick?N=p:N=d,y?(C=HB(y)||y,P=Pd(y),L1(y),C.type==="dragstart"&&Du(C)):(C=null,P={x:0,y:0}),R=o(P),w||(w=R),I=Lie(C),s=B({prefix:E,data:j,payload:{},globalStart:P,displacement:Bo(w,R),localStart:R,isTouch:I},S),S.manual||(I?(ie.bind(document,"touchstart",f,!0),ie.bind(document,"touchcancel",v,!0),ie.bind(document,"touchmove",c,!0),ie.bind(document,"touchend",d,!0)):(ie.bind(document,"mousemove",c),ie.bind(document,"dragstart",Du),ie.bind(document,"selectstart",Du),ie.bind(document,"mousedown",N,!0),ie.bind(document,"mouseup",N,!0)),ie.bind(document,"keyup",h),t.on("element.hover",m),t.on("element.out",g)),a("init"),S.autoActivate&&c(y,!0)}t.on("diagram.destroy",v),this.init=x,this.move=c,this.hover=m,this.out=g,this.end=d,this.cancel=v,this.context=function(){return s},this.setOptions=function(y){B(i,y)}}GF.$inject=["eventBus","canvas","selection","elementRegistry"];const Rl={__depends__:[Mie,Ma],dragging:["type",GF]};function Tf(t,e,n){this._canvas=n,this._opts=B({scrollThresholdIn:[20,20,20,20],scrollThresholdOut:[0,0,0,0],scrollRepeatTimeout:15,scrollStep:10},t);var r=this;e.on("drag.move",function(i){var s=r._toBorderPoint(i);r.startScroll(s)}),e.on(["drag.cleanup"],function(){r.stopScroll()})}Tf.$inject=["config.autoScroll","eventBus","canvas"];Tf.prototype.startScroll=function(t){var e=this._canvas,n=this._opts,r=this,i=e.getContainer().getBoundingClientRect(),s=[t.x,t.y,i.width-t.x,i.height-t.y];this.stopScroll();for(var o=0,a=0,l=0;l<4;l++)Fie(s[l],n.scrollThresholdOut[l],n.scrollThresholdIn[l])&&(l===0?o=n.scrollStep:l==1?a=n.scrollStep:l==2?o=-n.scrollStep:l==3&&(a=-n.scrollStep));(o!==0||a!==0)&&(e.scroll({dx:o,dy:a}),this._scrolling=setTimeout(function(){r.startScroll(t)},n.scrollRepeatTimeout))};function Fie(t,e,n){return e<t&&t<n}Tf.prototype.stopScroll=function(){clearTimeout(this._scrolling)};Tf.prototype.setOptions=function(t){this._opts=B({},this._opts,t)};Tf.prototype._toBorderPoint=function(t){var e=this._canvas._container.getBoundingClientRect(),n=Pd(t.originalEvent);return{x:n.x-e.left,y:n.y-e.top}};const zie={__depends__:[Rl],__init__:["autoScroll"],autoScroll:["type",Tf]};function C2(t){this._commandStack=t.get("commandStack",!1)}C2.$inject=["injector"];C2.prototype.allowed=function(t,e){var n=!0,r=this._commandStack;return r&&(n=r.canExecute(t,e)),n===void 0?!0:n};const Vo={__init__:["rules"],rules:["type",C2]};var Uy=Math.round,Hie=Math.max;function Uie(t,e){var n=t.x,r=t.y;return[["M",n,r],["m",0,-e],["a",e,e,0,1,1,0,2*e],["a",e,e,0,1,1,0,-2*e],["z"]]}function Vie(t){var e=[];return t.forEach(function(n,r){e.push([r===0?"M":"L",n.x,n.y])}),e}var KF=10;function qie(t,e){var n,r;for(n=0;r=t[n];n++)if(UB(r,e)<=KF)return{point:t[n],bendpoint:!0,index:n};return null}function Wie(t,e){var n=Ck(Uie(e,KF),Vie(t)),r=n[0],i=n[n.length-1],s;return r?r!==i?r.segment2!==i.segment2?(s=Hie(r.segment2,i.segment2)-1,{point:t[s],bendpoint:!0,index:s}):{point:{x:Uy(r.x+i.x)/2,y:Uy(r.y+i.y)/2},index:r.segment2}:{point:{x:Uy(r.x),y:Uy(r.y)},index:r.segment2}:null}function gC(t,e){return qie(t,e)||Wie(t,e)}function YF(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}function nA(t){return Math.atan((t[1].y-t[0].y)/(t[1].x-t[0].x))}function Gie(t,e){return e?{x:Math.cos(e)*t.x-Math.sin(e)*t.y,y:Math.sin(e)*t.x+Math.cos(e)*t.y}:t}function Kie(t,e,n){var r=[{n:t[0]-n[0],lambda:e[0]},{n:t[1]-n[1],lambda:e[1]}],i=r[0].n*e[0]+r[1].n*e[1],s=r[0].lambda*e[0]+r[1].lambda*e[1];return-i/s}function j2(t,e){var n=e[0],r=e[1],i={x:r.x-n.x,y:r.y-n.y},s=Kie([n.x,n.y],[i.x,i.y],[t.x,t.y]);return{x:n.x+s*i.x,y:n.y+s*i.y}}function XF(t,e){var n=j2(t,e),r={x:n.x-t.x,y:n.y-t.y};return YF(r)}function p0(t,e){return YF({x:t.x-e.x,y:t.y-e.y})}var QF="djs-bendpoint",ZF="djs-segment-dragger";function Yie(t,e){var n=Pd(e),r=t._container.getBoundingClientRect(),i;i={x:r.left,y:r.top};var s=t.viewbox();return{x:s.x+(n.x-i.x)/s.scale,y:s.y+(n.y-i.y)/s.scale}}function vC(t,e,n){var r=Yie(t,n),i=gC(e,r);return i}function yC(t,e){var n=ee("g");Ge(n).add(QF),re(t,n);var r=ee("circle");K(r,{cx:0,cy:0,r:4}),Ge(r).add("djs-visual"),re(n,r);var i=ee("circle");return K(i,{cx:0,cy:0,r:10}),Ge(i).add("djs-hit"),re(n,i),e&&Ge(n).add(e),n}function Xie(t,e,n,r){var i=ee("g");re(t,i);var s=18,o=6,a=11,l=Zie(e,n,r),c=o+a,d=ee("rect");K(d,{x:-s/2,y:-o/2,width:s,height:o}),Ge(d).add("djs-visual"),re(i,d);var h=ee("rect");return K(h,{x:-l/2,y:-c/2,width:l,height:c}),Ge(h).add("djs-hit"),re(i,h),dX(i,r==="v"?90:0),i}function JF(t,e,n){var r=ee("g"),i=IS(e,n),s=ul(e,n);return re(t,r),Xie(r,e,n,s),Ge(r).add(ZF),Ge(r).add(s==="h"?"horizontal":"vertical"),wi(r,i.x,i.y),r}function xC(t){return Math.abs(Math.round(t*2/3))}function Qie(t,e){var n=Jie(t,e);return j2(t,n)}function Zie(t,e,n){var r=e.x-t.x,i=e.y-t.y;return xC(n==="h"?r:i)}function Jie(t,e){for(var n=e.waypoints,r=1/0,i,s=0;s<n.length-1;s++){var o=n[s],a=n[s+1],l=XF(t,[o,a]);l<r&&(r=l,i=s)}return[n[i],n[i+1]]}function e6(t,e,n,r,i){function s(y,w,E){var S=y.index,j=y.point,C,P,R,N,I,M;return S<=0||y.bendpoint?!1:(C=w[S-1],P=w[S],R=IS(C,P),N=ul(C,P),I=Math.abs(j.x-R.x),M=Math.abs(j.y-R.y),N&&I<=E&&M<=E)}function o(y,w){var E=y.waypoints,S,j,C,P;return w.index<=0||w.bendpoint||(S={start:E[w.index-1],end:E[w.index]},j=ul(S.start,S.end),!j)?null:(j==="h"?C=S.end.x-S.start.x:C=S.end.y-S.start.y,P=xC(C)/2,P)}function a(y,w){var E=w.waypoints,S=vC(e,E,y),j;if(S)return j=o(w,S),s(S,E,j)?i.start(y,w,S.index):r.start(y,w,S.index,!S.bendpoint),!0}function l(y,w,E){ie.bind(y,w,function(S){n.triggerMouseEvent(w,S,E),S.stopPropagation()})}function c(y,w){var E=e.getLayer("overlays"),S=at('.djs-bendpoints[data-element-id="'+Sg(y.id)+'"]',E);return!S&&w&&(S=ee("g"),K(S,{"data-element-id":y.id}),Ge(S).add("djs-bendpoints"),re(E,S),l(S,"mousedown",y),l(S,"click",y),l(S,"dblclick",y)),S}function d(y,w){return at('.djs-segment-dragger[data-segment-idx="'+y+'"]',w)}function h(y,w){w.waypoints.forEach(function(E,S){var j=yC(y);re(y,j),wi(j,E.x,E.y)}),yC(y,"floating")}function p(y,w){for(var E=w.waypoints,S,j,C,P=1;P<E.length;P++)S=E[P-1],j=E[P],ul(S,j)&&(C=JF(y,S,j),K(C,{"data-segment-idx":P}),l(C,"mousemove",w))}function f(y){$(zo("."+QF,y),function(w){un(w)})}function m(y){$(zo("."+ZF,y),function(w){un(w)})}function g(y){var w=c(y);return w||(w=c(y,!0),h(w,y),p(w,y)),w}function v(y){var w=c(y);w&&(m(w),f(w),p(w,y),h(w,y))}function b(y,w){var E=at(".floating",y),S=w.point;E&&wi(E,S.x,S.y)}function x(y,w,E){var S=d(w.index,y),j=E[w.index-1],C=E[w.index],P=w.point,R=IS(j,C),N=ul(j,C),I,M;S&&(I=ese(S),M={x:P.x-R.x,y:P.y-R.y},N==="v"&&(M={x:M.y,y:M.x}),wi(I,M.x,M.y))}t.on("connection.changed",function(y){v(y.element)}),t.on("connection.remove",function(y){var w=c(y.element);w&&un(w)}),t.on("element.marker.update",function(y){var w=y.element,E;w.waypoints&&(E=g(w),y.add?Ge(E).add(y.marker):Ge(E).remove(y.marker))}),t.on("element.mousemove",function(y){var w=y.element,E=w.waypoints,S,j;if(E){if(S=c(w,!0),j=vC(e,E,y.originalEvent),!j)return;b(S,j),j.bendpoint||x(S,j,E)}}),t.on("element.mousedown",function(y){if(jk(y)){var w=y.originalEvent,E=y.element;if(E.waypoints)return a(w,E)}}),t.on("selection.changed",function(y){var w=y.newSelection,E=w[0];E&&E.waypoints&&g(E)}),t.on("element.hover",function(y){var w=y.element;w.waypoints&&(g(w),n.registerEvent(y.gfx,"mousemove","element.mousemove"))}),t.on("element.out",function(y){n.unregisterEvent(y.gfx,"mousemove","element.mousemove")}),t.on("element.updateId",function(y){var w=y.element,E=y.newId;if(w.waypoints){var S=c(w);S&&K(S,{"data-element-id":E})}}),this.addHandles=g,this.updateHandles=v,this.getBendpointsContainer=c,this.getSegmentDragger=d}e6.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"];function ese(t){return at(".djs-visual",t)}var rA=Math.round,Gu="reconnectStart",Ku="reconnectEnd",vm="updateWaypoints";function k2(t,e,n,r,i,s){this._injector=t,this.start=function(o,a,l,c){var d=n.getGraphics(a),h=a.source,p=a.target,f=a.waypoints,m;!c&&l===0?m=Gu:!c&&l===f.length-1?m=Ku:m=vm;var g=m===vm?"connection.updateWaypoints":"connection.reconnect",v=i.allowed(g,{connection:a,source:h,target:p});v===!1&&(v=i.allowed(g,{connection:a,source:p,target:h})),v!==!1&&r.init(o,"bendpoint.move",{data:{connection:a,connectionGfx:d,context:{allowed:v,bendpointIndex:l,connection:a,source:h,target:p,insert:c,type:m}}})},e.on("bendpoint.move.hover",function(o){var a=o.context,l=a.connection,c=l.source,d=l.target,h=o.hover,p=a.type;a.hover=h;var f;if(h){var m=p===vm?"connection.updateWaypoints":"connection.reconnect";if(f=a.allowed=i.allowed(m,{connection:l,source:p===Gu?h:c,target:p===Ku?h:d}),f){a.source=p===Gu?h:c,a.target=p===Ku?h:d;return}f===!1&&(f=a.allowed=i.allowed(m,{connection:l,source:p===Ku?h:d,target:p===Gu?h:c})),f&&(a.source=p===Ku?h:d,a.target=p===Gu?h:c)}}),e.on(["bendpoint.move.out","bendpoint.move.cleanup"],function(o){var a=o.context,l=a.type;a.hover=null,a.source=null,a.target=null,l!==vm&&(a.allowed=!1)}),e.on("bendpoint.move.end",function(o){var a=o.context,l=a.allowed,c=a.bendpointIndex,d=a.connection,h=a.insert,p=d.waypoints.slice(),f=a.source,m=a.target,g=a.type,v=a.hints||{},b={x:rA(o.x),y:rA(o.y)};if(!l)return!1;g===vm?(h?p.splice(c,0,b):p[c]=b,v.bendpointMove={insert:h,bendpointIndex:c},p=this.cropWaypoints(d,p),s.updateWaypoints(d,hX(p),v)):(g===Gu?(v.docking="source",f0(a)&&(v.docking="target",v.newWaypoints=p.reverse())):g===Ku&&(v.docking="target",f0(a)&&(v.docking="source",v.newWaypoints=p.reverse())),s.reconnect(d,f,m,b,v))},this)}k2.$inject=["injector","eventBus","canvas","dragging","rules","modeling"];k2.prototype.cropWaypoints=function(t,e){var n=this._injector.get("connectionDocking",!1);if(!n)return e;var r=t.waypoints;return t.waypoints=e,t.waypoints=n.getCroppedWaypoints(t),e=t.waypoints,t.waypoints=r,e};function f0(t){var e=t.hover,n=t.source,r=t.target,i=t.type;if(i===Gu)return e&&r&&e===r&&n!==r;if(i===Ku)return e&&n&&e===n&&n!==r}var tse="reconnectStart",nse="reconnectEnd",iA="updateWaypoints",ym="connect-ok",Vy="connect-not-ok",sA="connect-hover",oA="djs-updating",aA="djs-dragging",lA=1100;function t6(t,e,n,r){this._injector=e;var i=e.get("connectionPreview",!1);n.on("bendpoint.move.start",function(s){var o=s.context,a=o.bendpointIndex,l=o.connection,c=o.insert,d=l.waypoints,h=d.slice();o.waypoints=d,c&&h.splice(a,0,{x:s.x,y:s.y}),l.waypoints=h;var p=o.draggerGfx=yC(r.getLayer("overlays"));Ge(p).add("djs-dragging"),r.addMarker(l,aA),r.addMarker(l,oA)}),n.on("bendpoint.move.hover",function(s){var o=s.context,a=o.allowed,l=o.hover,c=o.type;if(l){if(r.addMarker(l,sA),c===iA)return;a?(r.removeMarker(l,Vy),r.addMarker(l,ym)):a===!1&&(r.removeMarker(l,ym),r.addMarker(l,Vy))}}),n.on(["bendpoint.move.out","bendpoint.move.cleanup"],lA,function(s){var o=s.context,a=o.hover,l=o.target;a&&(r.removeMarker(a,sA),r.removeMarker(a,l?ym:Vy))}),n.on("bendpoint.move.move",function(s){var o=s.context,a=o.allowed,l=o.bendpointIndex,c=o.draggerGfx,d=o.hover,h=o.type,p=o.connection,f=p.source,m=p.target,g=p.waypoints.slice(),v={x:s.x,y:s.y},b=o.hints||{},x={};i&&(b.connectionStart&&(x.connectionStart=b.connectionStart),b.connectionEnd&&(x.connectionEnd=b.connectionEnd),h===tse?f0(o)?(x.connectionEnd=x.connectionEnd||v,x.source=m,x.target=d||f,g=g.reverse()):(x.connectionStart=x.connectionStart||v,x.source=d||f,x.target=m):h===nse?f0(o)?(x.connectionStart=x.connectionStart||v,x.source=d||m,x.target=f,g=g.reverse()):(x.connectionEnd=x.connectionEnd||v,x.source=f,x.target=d||m):(x.noCropping=!0,x.noLayout=!0,g[l]=v),h===iA&&(g=t.cropWaypoints(p,g)),x.waypoints=g,i.drawPreview(o,a,x)),wi(c,s.x,s.y)},this),n.on(["bendpoint.move.end","bendpoint.move.cancel"],lA,function(s){var o=s.context,a=o.connection,l=o.draggerGfx,c=o.hover,d=o.target,h=o.waypoints;a.waypoints=h,un(l),r.removeMarker(a,oA),r.removeMarker(a,aA),c&&(r.removeMarker(c,ym),r.removeMarker(c,d?ym:Vy)),i&&i.cleanUp(o)})}t6.$inject=["bendpointMove","injector","eventBus","canvas"];var cA="connect-hover",uA="djs-updating";function dA(t,e,n){return P2(t,e,t[e]+n)}function P2(t,e,n){return{x:e==="x"?n:t.x,y:e==="y"?n:t.y}}function rse(t,e,n,r){var i=Math.max(e[r],n[r]),s=Math.min(e[r],n[r]),o=20,a=Math.min(Math.max(s+o,t[r]),i-o);return P2(e,r,a)}function n6(t){return t==="x"?"y":"x"}function hA(t,e,n){var r,i;return t.original?t.original:(r=xt(e),i=n6(n),P2(t,i,r[i]))}function r6(t,e,n,r,i,s){var o=t.get("connectionDocking",!1);this.start=function(h,p,f){var m,g=n.getGraphics(p),v=f-1,b=f,x=p.waypoints,y=x[v],w=x[b],E=vC(n,x,h),S,j,C;S=ul(y,w),S&&(j=S==="v"?"x":"y",v===0&&(y=hA(y,p.source,j)),b===x.length-1&&(w=hA(w,p.target,j)),E?C=E.point:C={x:(y.x+w.x)/2,y:(y.y+w.y)/2},m={connection:p,segmentStartIndex:v,segmentEndIndex:b,segmentStart:y,segmentEnd:w,axis:j,dragPosition:C},r.init(h,C,"connectionSegment.move",{cursor:j==="x"?"resize-ew":"resize-ns",data:{connection:p,connectionGfx:g,context:m}}))};function a(h,p){if(!o)return p;var f=h.waypoints,m;return h.waypoints=p,m=o.getCroppedWaypoints(h),h.waypoints=f,m}function l(h){i.update("connection",h.connection,h.connectionGfx)}function c(h,p,f){var m=h.newWaypoints,g=h.segmentStartIndex+p,v=m[g],b=h.segmentEndIndex+p,x=m[b],y=n6(h.axis),w=rse(f,v,x,y);wi(h.draggerGfx,w.x,w.y)}function d(h,p){var f=0,m=h.filter(function(g,v){return VB(h[v-1],h[v+1],g)?(f=v<=p?f-1:f,!1):!0});return{waypoints:m,segmentOffset:f}}e.on("connectionSegment.move.start",function(h){var p=h.context,f=h.connection,m=n.getLayer("overlays");p.originalWaypoints=f.waypoints.slice(),p.draggerGfx=JF(m,p.segmentStart,p.segmentEnd),Ge(p.draggerGfx).add("djs-dragging"),n.addMarker(f,uA)}),e.on("connectionSegment.move.move",function(h){var p=h.context,f=p.connection,m=p.segmentStartIndex,g=p.segmentEndIndex,v=p.segmentStart,b=p.segmentEnd,x=p.axis,y=p.originalWaypoints.slice(),w=dA(v,x,h["d"+x]),E=dA(b,x,h["d"+x]),S=y.length,j=0;y[m]=w,y[g]=E;var C,P;m<2&&(C=ci(f.source,w),m===1?C==="intersect"&&(y.shift(),y[0]=w,j--):C!=="intersect"&&(y.unshift(v),j++)),g>S-3&&(P=ci(f.target,E),g===S-2?P==="intersect"&&(y.pop(),y[y.length-1]=E):P!=="intersect"&&y.push(b)),p.newWaypoints=f.waypoints=a(f,y),c(p,j,h),p.newSegmentStartIndex=m+j,l(h)}),e.on("connectionSegment.move.hover",function(h){h.context.hover=h.hover,n.addMarker(h.hover,cA)}),e.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],function(h){var p=h.context.hover;p&&n.removeMarker(p,cA)}),e.on("connectionSegment.move.cleanup",function(h){var p=h.context,f=p.connection;p.draggerGfx&&un(p.draggerGfx),n.removeMarker(f,uA)}),e.on(["connectionSegment.move.cancel","connectionSegment.move.end"],function(h){var p=h.context,f=p.connection;f.waypoints=p.originalWaypoints,l(h)}),e.on("connectionSegment.move.end",function(h){var p=h.context,f=p.connection,m=p.newWaypoints,g=p.newSegmentStartIndex;m=m.map(function(E){return{original:E.original,x:Math.round(E.x),y:Math.round(E.y)}});var v=d(m,g),b=v.waypoints,x=a(f,b),y=v.segmentOffset,w={segmentMove:{segmentStartIndex:p.segmentStartIndex,newSegmentStartIndex:g+y}};s.updateWaypoints(f,x,w)})}r6.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","modeling"];var ise=Math.abs,pA=Math.round;function sse(t,e,n){n=n===void 0?10:n;var r,i;for(r=0;r<e.length;r++)if(i=e[r],ise(i-t)<=n)return i}function i6(t){return{x:t.x,y:t.y}}function s6(t){return{x:t.x+t.width,y:t.y+t.height}}function Ys(t,e){return!t||isNaN(t.x)||isNaN(t.y)?e:{x:pA(t.x+t.width/2),y:pA(t.y+t.height/2)}}function Vp(t,e){var n=t.snapped;return n?typeof e=="string"?n[e]:n.x&&n.y:!1}function ar(t,e,n){if(typeof e!="string")throw new Error("axis must be in [x, y]");if(typeof n!="number"&&n!==!1)throw new Error("value must be Number or false");var r,i=t[e],s=t.snapped=t.snapped||{};return n===!1?s[e]=!1:(s[e]=!0,r=n-i,t[e]+=r,t["d"+e]+=r),i}function o6(t){return t.children||[]}var ose=Math.abs,fA=Math.round,aE=10;function a6(t){function e(s,o){if(ke(s)){for(var a=s.length;a--;)if(ose(s[a]-o)<=aE)return s[a]}else{s=+s;var l=o%s;if(l<aE)return o-l;if(l>s-aE)return o-l+s}return o}function n(s,o){if(s.waypoints)return Qie(o,s);if(s.width)return{x:fA(s.width/2+s.x),y:fA(s.height/2+s.y)}}function r(s){var o=s.context,a=o.snapPoints,l=o.connection,c=l.waypoints,d=o.segmentStart,h=o.segmentStartIndex,p=o.segmentEnd,f=o.segmentEndIndex,m=o.axis;if(a)return a;var g=[c[h-1],d,p,c[f+1]];return h<2&&g.unshift(n(l.source,s)),f>c.length-3&&g.unshift(n(l.target,s)),o.snapPoints=a={horizontal:[],vertical:[]},$(g,function(v){v&&(v=v.original||v,m==="y"&&a.horizontal.push(v.y),m==="x"&&a.vertical.push(v.x))}),a}t.on("connectionSegment.move.move",1500,function(s){var o=r(s),a=s.x,l=s.y,c,d;if(o){c=e(o.vertical,a),d=e(o.horizontal,l);var h=a-c,p=l-d;B(s,{dx:s.dx-h,dy:s.dy-p,x:c,y:d}),(h||o.vertical.indexOf(a)!==-1)&&ar(s,"x",c),(p||o.horizontal.indexOf(l)!==-1)&&ar(s,"y",d)}});function i(s){var o=s.snapPoints,a=s.connection.waypoints,l=s.bendpointIndex;if(o)return o;var c=[a[l-1],a[l+1]];return s.snapPoints=o={horizontal:[],vertical:[]},$(c,function(d){d&&(d=d.original||d,o.horizontal.push(d.y),o.vertical.push(d.x))}),o}t.on(["connect.hover","connect.move","connect.end"],1500,function(s){var o=s.context,a=o.hover,l=a&&n(a,s);!En(a)||!l||!l.x||!l.y||(ar(s,"x",l.x),ar(s,"y",l.y))}),t.on(["bendpoint.move.move","bendpoint.move.end"],1500,function(s){var o=s.context,a=i(o),l=o.hover,c=l&&n(l,s),d=s.x,h=s.y,p,f;if(a){p=e(c?a.vertical.concat([c.x]):a.vertical,d),f=e(c?a.horizontal.concat([c.y]):a.horizontal,h);var m=d-p,g=h-f;B(s,{dx:s.dx-m,dy:s.dy-g,x:s.x-m,y:s.y-g}),(m||a.vertical.indexOf(d)!==-1)&&ar(s,"x",p),(g||a.horizontal.indexOf(h)!==-1)&&ar(s,"y",f)}})}a6.$inject=["eventBus"];const ase={__depends__:[Rl,Vo],__init__:["bendpoints","bendpointSnapping","bendpointMovePreview"],bendpoints:["type",e6],bendpointMove:["type",k2],bendpointMovePreview:["type",t6],connectionSegmentMove:["type",r6],bendpointSnapping:["type",a6]};function l6(t,e,n,r){function i(o,a){return r.allowed("connection.create",{source:o,target:a})}function s(o,a){return i(a,o)}t.on("connect.hover",function(o){var a=o.context,l=a.start,c=o.hover,d;if(a.hover=c,d=a.canExecute=i(l,c),!jg(d)){if(d!==!1){a.source=l,a.target=c;return}d=a.canExecute=s(l,c),!jg(d)&&d!==!1&&(a.source=c,a.target=l)}}),t.on(["connect.out","connect.cleanup"],function(o){var a=o.context;a.hover=null,a.source=null,a.target=null,a.canExecute=!1}),t.on("connect.end",function(o){var a=o.context,l=a.canExecute,c=a.connectionStart,d={x:o.x,y:o.y},h=a.source,p=a.target;if(!l)return!1;var f=null,m={connectionStart:bC(a)?d:c,connectionEnd:bC(a)?c:d};Wn(l)&&(f=l),a.connection=n.connect(h,p,f,m)}),this.start=function(o,a,l,c){Wn(l)||(c=l,l=xt(a)),e.init(o,"connect",{autoActivate:c,data:{shape:a,context:{start:a,connectionStart:l}}})}}l6.$inject=["eventBus","dragging","modeling","rules"];function bC(t){var e=t.hover,n=t.source,r=t.target;return e&&n&&e===n&&n!==r}var lse=1100,cse=900,mA="connect-ok",gA="connect-not-ok";function c6(t,e,n){var r=t.get("connectionPreview",!1);r&&e.on("connect.move",function(i){var s=i.context,o=s.canExecute,a=s.hover,l=s.source,c=s.start,d=s.startPosition,h=s.target,p=s.connectionStart||d,f=s.connectionEnd||{x:i.x,y:i.y},m=p,g=f;bC(s)&&(m=f,g=p),r.drawPreview(s,o,{source:l||c,target:h||a,connectionStart:m,connectionEnd:g})}),e.on("connect.hover",cse,function(i){var s=i.context,o=i.hover,a=s.canExecute;a!==null&&n.addMarker(o,a?mA:gA)}),e.on(["connect.out","connect.cleanup"],lse,function(i){var s=i.hover;s&&(n.removeMarker(s,mA),n.removeMarker(s,gA))}),r&&e.on("connect.cleanup",function(i){r.cleanUp(i.context)})}c6.$inject=["injector","eventBus","canvas"];const T2={__depends__:[Ma,Vo,Rl],__init__:["connectPreview"],connect:["type",l6],connectPreview:["type",c6]};var use="djs-dragger";function Al(t,e,n,r){this._canvas=e,this._graphicsFactory=n,this._elementFactory=r,this._connectionDocking=t.get("connectionDocking",!1),this._layouter=t.get("layouter",!1)}Al.$inject=["injector","canvas","graphicsFactory","elementFactory"];Al.prototype.drawPreview=function(t,e,n){n=n||{};var r=t.connectionPreviewGfx,i=t.getConnection,s=n.source,o=n.target,a=n.waypoints,l=n.connectionStart,c=n.connectionEnd,d=n.noLayout,h=n.noCropping,p=n.noNoop,f,m=this;if(r||(r=t.connectionPreviewGfx=this.createConnectionPreviewGfx()),Hd(r),i||(i=t.getConnection=dse(function(g,v,b){return m.getConnection(g,v,b)})),e&&(f=i(e,s,o)),!f){!p&&this.drawNoopPreview(r,n);return}f.waypoints=a||[],this._layouter&&!d&&(f.waypoints=this._layouter.layoutConnection(f,{source:s,target:o,connectionStart:l,connectionEnd:c,waypoints:n.waypoints||f.waypoints})),(!f.waypoints||!f.waypoints.length)&&(f.waypoints=[s?xt(s):l,o?xt(o):c]),this._connectionDocking&&(s||o)&&!h&&(f.waypoints=this._connectionDocking.getCroppedWaypoints(f,s,o)),this._graphicsFactory.drawConnection(r,f,{stroke:"var(--element-dragger-color)"})};Al.prototype.drawNoopPreview=function(t,e){var n=e.source,r=e.target,i=e.connectionStart||xt(n),s=e.connectionEnd||xt(r),o=this.cropWaypoints(i,s,n,r),a=this.createNoopConnection(o[0],o[1]);re(t,a)};Al.prototype.cropWaypoints=function(t,e,n,r){var i=this._graphicsFactory,s=n&&i.getShapePath(n),o=r&&i.getShapePath(r),a=i.getConnectionPath({waypoints:[t,e]});return t=n&&DS(s,a,!0)||t,e=r&&DS(o,a,!1)||e,[t,e]};Al.prototype.cleanUp=function(t){t&&t.connectionPreviewGfx&&un(t.connectionPreviewGfx)};Al.prototype.getConnection=function(t){var e=hse(t);return this._elementFactory.createConnection(e)};Al.prototype.createConnectionPreviewGfx=function(){var t=ee("g");return K(t,{pointerEvents:"none"}),Ge(t).add(use),re(this._canvas.getActiveLayer(),t),t};Al.prototype.createNoopConnection=function(t,e){return pX([t,e],{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"})};function dse(t){var e={};return function(n){var r=JSON.stringify(n),i=e[r];return i||(i=e[r]=t.apply(null,arguments)),i}}function hse(t){return Wn(t)?t:{}}const pse={__init__:["connectionPreview"],connectionPreview:["type",Al]},fse=new _k("ps");var mse=["marker-start","marker-mid","marker-end"],gse=["circle","ellipse","line","path","polygon","polyline","path","rect"];function Qc(t,e,n,r){this._elementRegistry=t,this._canvas=n,this._styles=r}Qc.$inject=["elementRegistry","eventBus","canvas","styles"];Qc.prototype.cleanUp=function(){console.warn("PreviewSupport#cleanUp is deprecated and will be removed in future versions. You do not need to manually clean up previews anymore. cf. https://github.com/bpmn-io/diagram-js/pull/906")};Qc.prototype.getGfx=function(t){return this._elementRegistry.getGraphics(t)};Qc.prototype.addDragger=function(t,e,n,r="djs-dragger"){n=n||this.getGfx(t);var i=pw(n),s=n.getBoundingClientRect();return this._cloneMarkers(cp(i),r),K(i,this._styles.cls(r,[],{x:s.top,y:s.left})),re(e,i),K(i,"data-preview-support-element-id",t.id),i};Qc.prototype.addFrame=function(t,e){var n=ee("rect",{class:"djs-resize-overlay",width:t.width,height:t.height,x:t.x,y:t.y});return re(e,n),K(n,"data-preview-support-element-id",t.id),n};Qc.prototype._cloneMarkers=function(t,e="djs-dragger",n=t){var r=this;t.childNodes&&t.childNodes.forEach(i=>{r._cloneMarkers(i,e,n)}),bse(t)&&mse.forEach(function(i){if(K(t,i)){var s=vse(t,i,r._canvas.getContainer());s&&r._cloneMarker(n,t,s,i,e)}})};Qc.prototype._cloneMarker=function(t,e,n,r,i="djs-dragger"){var s=[n.id,i,fse.next()].join("-"),o=at("marker#"+n.id,t);t=t||this._canvas._svg;var a=o||pw(n);a.id=s,Ge(a).add(i);var l=at(":scope > defs",t);l||(l=ee("defs"),re(t,l)),re(l,a);var c=xse(a.id);K(e,r,c)};function vse(t,e,n){var r=yse(K(t,e));return at("marker#"+r,n||document)}function yse(t){return t.match(/url\(['"]?#([^'"]*)['"]?\)/)[1]}function xse(t){return"url(#"+t+")"}function bse(t){return gse.indexOf(t.nodeName)!==-1}const Nf={__init__:["previewSupport"],previewSupport:["type",Qc]},qy="complex-preview";class u6{constructor(e,n,r){this._canvas=e,this._graphicsFactory=n,this._previewSupport=r,this._markers=[]}create(e){this.cleanUp();const{created:n=[],moved:r=[],removed:i=[],resized:s=[]}=e,o=this._canvas.getLayer(qy);n.filter(a=>!wse(a)).forEach(a=>{let l;En(a)?(l=this._graphicsFactory._createContainer("connection",ee("g")),this._graphicsFactory.drawConnection(cp(l),a)):(l=this._graphicsFactory._createContainer("shape",ee("g")),this._graphicsFactory.drawShape(cp(l),a),wi(l,a.x,a.y)),this._previewSupport.addDragger(a,o,l)}),r.forEach(({element:a,delta:l})=>{this._previewSupport.addDragger(a,o,void 0,"djs-dragging"),this._canvas.addMarker(a,"djs-element-hidden"),this._markers.push([a,"djs-element-hidden"]);const c=this._previewSupport.addDragger(a,o);En(a)?wi(c,l.x,l.y):wi(c,a.x+l.x,a.y+l.y)}),i.forEach(a=>{this._previewSupport.addDragger(a,o,void 0,"djs-dragging"),this._canvas.addMarker(a,"djs-element-hidden"),this._markers.push([a,"djs-element-hidden"])}),s.forEach(({shape:a,bounds:l})=>{this._canvas.addMarker(a,"djs-hidden"),this._markers.push([a,"djs-hidden"]),this._previewSupport.addDragger(a,o,void 0,"djs-dragging");const c=this._graphicsFactory._createContainer("shape",ee("g"));this._graphicsFactory.drawShape(cp(c),a,{width:l.width,height:l.height}),wi(c,l.x,l.y),this._previewSupport.addDragger(a,o,c)})}cleanUp(){Hd(this._canvas.getLayer(qy)),this._markers.forEach(([e,n])=>this._canvas.removeMarker(e,n)),this._markers=[]}show(){this._canvas.showLayer(qy)}hide(){this._canvas.hideLayer(qy)}}u6.$inject=["canvas","graphicsFactory","previewSupport"];function wse(t){return t.hidden}const _se={__depends__:[Nf],__init__:["complexPreview"],complexPreview:["type",u6]};var N2=["top","bottom","left","right"],Wy=10;function O2(t,e){ye.call(this,t),this.postExecuted(["connection.create","connection.layout","connection.updateWaypoints"],function(i){var s=i.context,o=s.connection,a=o.source,l=o.target,c=s.hints||{};c.createElementsBehavior!==!1&&(n(a),n(l))}),this.postExecuted(["label.create"],function(i){var s=i.context,o=s.shape,a=s.hints||{};a.createElementsBehavior!==!1&&n(o.labelTarget)}),this.postExecuted(["elements.create"],function(i){var s=i.context,o=s.elements,a=s.hints||{};a.createElementsBehavior!==!1&&o.forEach(function(l){n(l)})});function n(i){if(fw(i)&&!En(i)){var s=Cse(i);s&&r(i,s)}}function r(i,s){var o=xt(i),a=i.label,l=xt(a);if(a.parent){var c=dt(i),d;switch(s){case"top":d={x:o.x,y:c.top-Wy-a.height/2};break;case"left":d={x:c.left-Wy-a.width/2,y:o.y};break;case"bottom":d={x:o.x,y:c.bottom+Wy+a.height/2};break;case"right":d={x:c.right+Wy+a.width/2,y:o.y};break}var h=Bo(d,l);e.moveShape(a,h)}}}Ce(O2,ye);O2.$inject=["eventBus","modeling"];function Ese(t){var e=t.host,n=xt(t),r=ci(n,e),i;r.indexOf("-")>=0?i=r.split("-"):i=[r];var s=N2.filter(function(o){return i.indexOf(o)===-1});return s}function Sse(t){var e=xt(t),n=[].concat(t.incoming.map(function(r){return r.waypoints[r.waypoints.length-2]}),t.outgoing.map(function(r){return r.waypoints[1]})).map(function(r){return d6(e,r)});return n}function Cse(t){var e=xt(t.label),n=xt(t),r=d6(n,e);if(jse(r)){var i=Sse(t);if(t.host){var s=Ese(t);i=i.concat(s)}var o=N2.filter(function(a){return i.indexOf(a)===-1});if(o.indexOf(r)===-1)return o[0]}}function d6(t,e){return ci(e,t,5)}function jse(t){return N2.indexOf(t)!==-1}function R2(t){ye.call(this,t),this.preExecute("shape.append",function(e){var n=e.source,r=e.shape;e.position||(T(r,"bpmn:TextAnnotation")?e.position={x:n.x+n.width/2+75,y:n.y-50-r.height/2}:e.position={x:n.x+n.width+80+r.width/2,y:n.y+n.height/2})},!0)}Ce(R2,ye);R2.$inject=["eventBus"];function A2(t,e){t.invoke(ye,this),this.postExecute("shape.move",function(n){var r=n.newParent,i=n.shape,s=ht(i.incoming.concat(i.outgoing),function(o){return T(o,"bpmn:Association")});$(s,function(o){e.moveConnection(o,{x:0,y:0},r)})},!0)}Ce(A2,ye);A2.$inject=["injector","modeling"];var vA=500;function Dw(t,e){e.invoke(ye,this),this._bpmnReplace=t;var n=this;this.postExecuted("elements.create",vA,function(r){var i=r.elements;i=i.filter(function(s){var o=s.host;return yA(s,o)}),i.length===1&&i.map(function(s){return i.indexOf(s)}).forEach(function(s){var o=i[s];r.elements[s]=n._replaceShape(i[s],o)})},!0),this.preExecute("elements.move",vA,function(r){var i=r.shapes,s=r.newHost;if(i.length===1){var o=i[0];yA(o,s)&&(r.shapes=[n._replaceShape(o,s)])}},!0)}Dw.$inject=["bpmnReplace","injector"];Ce(Dw,ye);Dw.prototype._replaceShape=function(t,e){var n=kse(t),r={type:"bpmn:BoundaryEvent",host:e};return n&&(r.eventDefinitionType=n.$type),this._bpmnReplace.replaceElement(t,r,{layoutConnection:!1})};function kse(t){var e=Me(t),n=e.eventDefinitions;return n&&n[0]}function yA(t,e){return!Wt(t)&&Lt(t,["bpmn:IntermediateThrowEvent","bpmn:IntermediateCatchEvent"])&&!!e}function I2(t,e){ye.call(this,t);function n(r){return ht(r.attachers,function(i){return T(i,"bpmn:BoundaryEvent")})}this.postExecute("connection.create",function(r){var i=r.context.source,s=r.context.target,o=n(s);T(i,"bpmn:EventBasedGateway")&&T(s,"bpmn:ReceiveTask")&&o.length>0&&e.removeElements(o)}),this.postExecute("connection.reconnect",function(r){var i=r.context.oldSource,s=r.context.newSource;T(i,"bpmn:Gateway")&&T(s,"bpmn:EventBasedGateway")&&$(s.outgoing,function(o){var a=o.target,l=n(a);T(a,"bpmn:ReceiveTask")&&l.length>0&&e.removeElements(l)})})}I2.$inject=["eventBus","modeling"];Ce(I2,ye);function D2(t,e,n){ye.call(this,t),this.preExecute("shape.replace",a,!0),this.postExecuted("shape.replace",l,!0),this.preExecute("connection.create",i,!0),this.postExecuted("connection.delete",r,!0),this.postExecuted("connection.reconnect",s,!0),this.postExecuted("element.updateProperties",o,!0);function r(v){const b=v.source,x=v.target;Rh(b)&&xm(x)&&d(x)}function i(v){const b=v.connection,x=v.source,y=v.target;Rh(x)&&Gy(y)&&(c(y),p(x,[b]))}function s(v){const b=v.newTarget,x=v.oldSource,y=v.oldTarget;if(y!==b){const w=x;xm(y)&&d(y),Rh(w)&&Gy(b)&&c(b)}}function o(v){const{element:b}=v;xm(b)?(h(b),f(b)):Gy(b)&&m(b)}function a(v){const{newData:b,oldShape:x}=v;if(Rh(v.oldShape)&&b.eventDefinitionType!=="bpmn:CompensateEventDefinition"||b.type!=="bpmn:BoundaryEvent"){const y=x.outgoing.find(({target:w})=>xm(w));y&&y.target&&(v._connectionTarget=y.target)}else if(!Rh(v.oldShape)&&b.eventDefinitionType==="bpmn:CompensateEventDefinition"&&b.type==="bpmn:BoundaryEvent"){const y=x.outgoing.find(({target:w})=>Gy(w));y&&y.target&&(v._connectionTarget=y.target),g(x)}}function l(v){const{_connectionTarget:b,newShape:x}=v;b&&e.connect(x,b)}function c(v){e.updateProperties(v,{isForCompensation:!0})}function d(v){e.updateProperties(v,{isForCompensation:void 0})}function h(v){for(const b of v.incoming)n.canConnect(b.source,v)||e.removeConnection(b);for(const b of v.outgoing)n.canConnect(v,b.target)||e.removeConnection(b)}function p(v,b){v.outgoing.filter(w=>T(w,"bpmn:Association")).filter(w=>xm(w.target)&&!b.includes(w)).forEach(w=>e.removeConnection(w))}function f(v){const b=v.attachers.slice();b.length&&e.removeElements(b)}function m(v){const b=v.incoming.filter(x=>Rh(x.source));e.removeElements(b)}function g(v){const b=v.outgoing.filter(x=>T(x,"bpmn:SequenceFlow"));e.removeElements(b)}}Ce(D2,ye);D2.$inject=["eventBus","modeling","bpmnRules"];function xm(t){const e=Me(t);return e&&e.get("isForCompensation")}function Rh(t){return t&&T(t,"bpmn:BoundaryEvent")&&kk(t,"bpmn:CompensateEventDefinition")}function Gy(t){return t&&T(t,"bpmn:Activity")&&!_i(t)}function $2(t){t.invoke(ye,this),this.preExecute("shape.create",1500,function(e){var n=e.context,r=n.parent,i=n.shape;T(r,"bpmn:Lane")&&!T(i,"bpmn:Lane")&&(n.parent=Up(r,"bpmn:Participant"))})}$2.$inject=["injector"];Ce($2,ye);function M2(t,e){ye.call(this,t),this.preExecute("shape.create",function(n){var o;var r=n.context,i=r.shape;if(T(i,"bpmn:DataObjectReference")&&i.type!=="label"){var s=e.create("bpmn:DataObject");s.isCollection=((o=i.businessObject.dataObjectRef)==null?void 0:o.isCollection)||!1,i.businessObject.dataObjectRef=s}})}M2.$inject=["eventBus","bpmnFactory"];Ce(M2,ye);var wC=20,_C=20,h6=30,Ky=2e3;function L2(t,e,n){ye.call(this,e),e.on(["create.start","shape.move.start"],Ky,function(i){var s=i.context,o=s.shape,a=t.getRootElement();if(!(!T(o,"bpmn:Participant")||!T(a,"bpmn:Process")||!a.children.length)){var l=a.children.filter(function(h){return!T(h,"bpmn:Group")&&!Wt(h)&&!En(h)});if(l.length){var c=Di(l),d=Pse(o,c);B(o,d),s.createConstraints=Tse(o,c)}}}),e.on("create.start",Ky,function(i){var s=i.context,o=s.shape,a=t.getRootElement(),l=t.getGraphics(a);function c(d){d.element=a,d.gfx=l}T(o,"bpmn:Participant")&&T(a,"bpmn:Process")&&(e.on("element.hover",Ky,c),e.once("create.cleanup",function(){e.off("element.hover",c)}))});function r(){var i=t.getRootElement();return T(i,"bpmn:Collaboration")?i:n.makeCollaboration()}this.preExecute("elements.create",Ky,function(i){var s=i.elements,o=i.parent,a=Nse(s),l;a&&T(o,"bpmn:Process")&&(i.parent=r(),l=i.hints=i.hints||{},l.participant=a,l.process=o,l.processRef=Me(a).get("processRef"))},!0),this.preExecute("shape.create",function(i){var s=i.parent,o=i.shape;T(o,"bpmn:Participant")&&T(s,"bpmn:Process")&&(i.parent=r(),i.process=s,i.processRef=Me(o).get("processRef"))},!0),this.execute("shape.create",function(i){var s=i.hints||{},o=i.process||s.process,a=i.shape,l=s.participant;o&&(!l||a===l)&&Me(a).set("processRef",Me(o))},!0),this.revert("shape.create",function(i){var s=i.hints||{},o=i.process||s.process,a=i.processRef||s.processRef,l=i.shape,c=s.participant;o&&(!c||l===c)&&Me(l).set("processRef",a)},!0),this.postExecute("shape.create",function(i){var s=i.hints||{},o=i.process||i.hints.process,a=i.shape,l=s.participant;if(o){var c=o.children.slice();l?a===l&&n.moveElements(c,{x:0,y:0},l):n.moveElements(c,{x:0,y:0},a)}},!0)}L2.$inject=["canvas","eventBus","modeling"];Ce(L2,ye);function Pse(t,e){e={width:e.width+wC*2+h6,height:e.height+_C*2};var n=Math.max(t.width,e.width),r=Math.max(t.height,e.height);return{x:-n/2,y:-r/2,width:n,height:r}}function Tse(t,e){return e=dt(e),{bottom:e.top+t.height/2-_C,left:e.right-t.width/2+wC,top:e.bottom-t.height/2+_C,right:e.left+t.width/2-wC-h6}}function Nse(t){return Tt(t,function(e){return T(e,"bpmn:Participant")})}var xA="__targetRef_placeholder";function B2(t,e){ye.call(this,t),this.executed(["connection.create","connection.delete","connection.move","connection.reconnect"],bA(s)),this.reverted(["connection.create","connection.delete","connection.move","connection.reconnect"],bA(s));function n(o,a,l){var c=o.get("dataInputAssociations");return Tt(c,function(d){return d!==l&&d.targetRef===a})}function r(o,a){var l=o.get("properties"),c=Tt(l,function(d){return d.name===xA});return!c&&a&&(c=e.create("bpmn:Property",{name:xA}),Or(l,c)),c}function i(o,a){var l=r(o);l&&(n(o,l,a)||vr(o.get("properties"),l))}function s(o){var a=o.context,l=a.connection,c=l.businessObject,d=l.target,h=d&&d.businessObject,p=a.newTarget,f=p&&p.businessObject,m=a.oldTarget||a.target,g=m&&m.businessObject,v=l.businessObject,b;g&&g!==h&&i(g,c),f&&f!==h&&i(f,c),h?(b=r(h,!0),v.targetRef=b):v.targetRef=null}}B2.$inject=["eventBus","bpmnFactory"];Ce(B2,ye);function bA(t){return function(e){var n=e.context,r=n.connection;if(T(r,"bpmn:DataInputAssociation"))return t(e)}}function $w(t){this._bpmnUpdater=t}$w.$inject=["bpmnUpdater"];$w.prototype.execute=function(t){var e=t.dataStoreBo,n=t.dataStoreDi,r=t.newSemanticParent,i=t.newDiParent;return t.oldSemanticParent=e.$parent,t.oldDiParent=n.$parent,this._bpmnUpdater.updateSemanticParent(e,r),this._bpmnUpdater.updateDiParent(n,i),[]};$w.prototype.revert=function(t){var e=t.dataStoreBo,n=t.dataStoreDi,r=t.oldSemanticParent,i=t.oldDiParent;return this._bpmnUpdater.updateSemanticParent(e,r),this._bpmnUpdater.updateDiParent(n,i),[]};function F2(t,e,n,r){ye.call(this,r),e.registerHandler("dataStore.updateContainment",$w);function i(){return n.filter(function(a){return T(a,"bpmn:Participant")&&Me(a).processRef})[0]}function s(a){return a.children.filter(function(l){return T(l,"bpmn:DataStoreReference")&&!l.labelTarget})}function o(a,l){var c=a.businessObject||a;if(l=l||i(),l){var d=l.businessObject||l;e.execute("dataStore.updateContainment",{dataStoreBo:c,dataStoreDi:yn(a),newSemanticParent:d.processRef||d,newDiParent:yn(l)})}}this.preExecute("shape.create",function(a){var l=a.context,c=l.shape;T(c,"bpmn:DataStoreReference")&&c.type!=="label"&&(l.hints||(l.hints={}),l.hints.autoResize=!1)}),this.preExecute("elements.move",function(a){var l=a.context,c=l.shapes,d=c.filter(function(h){return T(h,"bpmn:DataStoreReference")});d.length&&(l.hints||(l.hints={}),l.hints.autoResize=c.filter(function(h){return!T(h,"bpmn:DataStoreReference")}))}),this.postExecute("shape.create",function(a){var l=a.context,c=l.shape,d=c.parent;T(c,"bpmn:DataStoreReference")&&c.type!=="label"&&T(d,"bpmn:Collaboration")&&o(c)}),this.postExecute("shape.move",function(a){var l=a.context,c=l.shape,d=l.oldParent,h=c.parent;if(!T(d,"bpmn:Collaboration")&&T(c,"bpmn:DataStoreReference")&&c.type!=="label"&&T(h,"bpmn:Collaboration")){var p=T(d,"bpmn:Participant")?d:Rse(d,"bpmn:Participant");o(c,p)}}),this.postExecute("shape.delete",function(a){var l=a.context,c=l.shape,d=t.getRootElement();Lt(c,["bpmn:Participant","bpmn:SubProcess"])&&T(d,"bpmn:Collaboration")&&s(d).filter(function(h){return Ose(h,c)}).forEach(function(h){o(h)})}),this.postExecute("canvas.updateRoot",function(a){var l=a.context,c=l.oldRoot,d=l.newRoot,h=s(c);h.forEach(function(p){T(d,"bpmn:Process")&&o(p,d)})})}F2.$inject=["canvas","commandStack","elementRegistry","eventBus"];Ce(F2,ye);function Ose(t,e){for(var n=t.businessObject||t,r=e.businessObject||e;n.$parent;){if(n.$parent===r.processRef||r)return!0;n=n.$parent}return!1}function Rse(t,e){for(;t.parent;){if(T(t.parent,e))return t.parent;t=t.parent}}var m0=Math.max,g0=Math.min,Ase=20;function p6(t,e){return{top:t.top-e.top,right:t.right-e.right,bottom:t.bottom-e.bottom,left:t.left-e.left}}function Ise(t,e,n){var r=n.x,i=n.y,s={x:t.x,y:t.y,width:t.width,height:t.height};return e.indexOf("n")!==-1?(s.y=t.y+i,s.height=t.height-i):e.indexOf("s")!==-1&&(s.height=t.height+i),e.indexOf("e")!==-1?s.width=t.width+r:e.indexOf("w")!==-1&&(s.x=t.x+r,s.width=t.width-r),s}function Dse(t,e){return{x:t.x+(e.left||0),y:t.y+(e.top||0),width:t.width-(e.left||0)+(e.right||0),height:t.height-(e.top||0)+(e.bottom||0)}}function Yy(t,e,n){var r=e[t],i=n.min&&n.min[t],s=n.max&&n.max[t];return Oe(i)&&(r=(/top|left/.test(t)?g0:m0)(r,i)),Oe(s)&&(r=(/top|left/.test(t)?m0:g0)(r,s)),r}function $se(t,e){if(!e)return t;var n=dt(t);return Sk({top:Yy("top",n,e),right:Yy("right",n,e),bottom:Yy("bottom",n,e),left:Yy("left",n,e)})}function Mse(t,e,n,r){var i=dt(e),s={top:/n/.test(t)?i.bottom-n.height:i.top,left:/w/.test(t)?i.right-n.width:i.left,bottom:/s/.test(t)?i.top+n.height:i.bottom,right:/e/.test(t)?i.left+n.width:i.right},o=r?dt(r):s,a={top:g0(s.top,o.top),left:g0(s.left,o.left),bottom:m0(s.bottom,o.bottom),right:m0(s.right,o.right)};return Sk(a)}function bm(t,e){return typeof t<"u"?t:Ase}function Lse(t,e){var n,r,i,s;return typeof e=="object"?(n=bm(e.left),r=bm(e.right),i=bm(e.top),s=bm(e.bottom)):n=r=i=s=bm(e),{x:t.x-n,y:t.y-i,width:t.width+n+r,height:t.height+i+s}}function Bse(t){return!(t.waypoints||t.type==="label")}function f6(t,e){var n;if(t.length===void 0?n=ht(t.children,Bse):n=t,n.length)return Lse(Di(n),e)}var sc=Math.abs;function Fse(t,e){return p6(dt(e),dt(t))}var zse=["bpmn:Participant","bpmn:Process","bpmn:SubProcess"],Vs=30;function Mw(t,e){return e=e||[],t.children.filter(function(n){T(n,"bpmn:Lane")&&(Mw(n,e),e.push(n))}),e}function Zc(t){return t.children.filter(function(e){return T(e,"bpmn:Lane")})}function Gs(t){return Up(t,zse)||t}function Hse(t,e){var n=Gs(t),r=T(n,"bpmn:Process")?[]:[n],i=Mw(n,r),s=dt(t),o=dt(e),a=Fse(t,e),l=[],c=Yr(t);return i.forEach(function(d){if(d!==t){var h=c?0:a.top,p=c?a.right:0,f=c?0:a.bottom,m=c?a.left:0,g=dt(d);a.top&&(sc(g.bottom-s.top)<10&&(f=o.top-g.bottom),sc(g.top-s.top)<5&&(h=o.top-g.top)),a.left&&(sc(g.right-s.left)<10&&(p=o.left-g.right),sc(g.left-s.left)<5&&(m=o.left-g.left)),a.bottom&&(sc(g.top-s.bottom)<10&&(h=o.bottom-g.top),sc(g.bottom-s.bottom)<5&&(f=o.bottom-g.bottom)),a.right&&(sc(g.left-s.right)<10&&(m=o.right-g.left),sc(g.right-s.right)<5&&(p=o.right-g.right)),(h||p||f||m)&&l.push({shape:d,newBounds:Dse(d,{top:h,right:p,bottom:f,left:m})})}}),l}var Use=500;function z2(t,e){ye.call(this,t);function n(r,i){var s=Yr(r),o=Zc(i),a=[],l=[],c=[],d=[];if(mw(o,function(v){return s?v.y>r.y?l.push(v):a.push(v):v.x>r.x?d.push(v):c.push(v),v.children}),!!o.length){var h;s?l.length&&a.length?h=r.height/2:h=r.height:d.length&&c.length?h=r.width/2:h=r.width;var p,f,m,g;a.length&&(p=e.calculateAdjustments(a,"y",h,r.y-10),e.makeSpace(p.movingShapes,p.resizingShapes,{x:0,y:h},"s")),l.length&&(f=e.calculateAdjustments(l,"y",-h,r.y+r.height+10),e.makeSpace(f.movingShapes,f.resizingShapes,{x:0,y:-h},"n")),c.length&&(m=e.calculateAdjustments(c,"x",h,r.x-10),e.makeSpace(m.movingShapes,m.resizingShapes,{x:h,y:0},"e")),d.length&&(g=e.calculateAdjustments(d,"x",-h,r.x+r.width+10),e.makeSpace(g.movingShapes,g.resizingShapes,{x:-h,y:0},"w"))}}this.postExecuted("shape.delete",Use,function(r){var i=r.context,s=i.hints,o=i.shape,a=i.oldParent;T(o,"bpmn:Lane")&&(s&&s.nested||n(o,a))})}z2.$inject=["eventBus","spaceTool"];Ce(z2,ye);var wA=500;function Lw(t,e){e.invoke(ye,this),this._bpmnReplace=t;var n=this;this.postExecuted("elements.create",wA,function(r){var i=r.elements;i.filter(function(s){var o=s.host;return _A(s,o)}).map(function(s){return i.indexOf(s)}).forEach(function(s){r.elements[s]=n._replaceShape(i[s])})},!0),this.preExecute("elements.move",wA,function(r){var i=r.shapes,s=r.newHost;i.forEach(function(o,a){var l=o.host;_A(o,qse(i,l)?l:s)&&(i[a]=n._replaceShape(o))})},!0)}Lw.$inject=["bpmnReplace","injector"];Ce(Lw,ye);Lw.prototype._replaceShape=function(t){var e=Vse(t),n;return e?n={type:"bpmn:IntermediateCatchEvent",eventDefinitionType:e.$type}:n={type:"bpmn:IntermediateThrowEvent"},this._bpmnReplace.replaceElement(t,n,{layoutConnection:!1})};function Vse(t){var e=Me(t),n=e.eventDefinitions;return n&&n[0]}function _A(t,e){return!Wt(t)&&T(t,"bpmn:BoundaryEvent")&&!e}function qse(t,e){return t.indexOf(e)!==-1}function H2(t,e,n){ye.call(this,t);function r(i,s,o){var a=s.waypoints,l,c,d,h,p,f,m,g=i.outgoing.slice(),v=i.incoming.slice(),b;Oe(o.width)?b=xt(o):b=o;var x=gC(a,b);if(x){if(l=a.slice(0,x.index),c=a.slice(x.index+(x.bendpoint?1:0)),!l.length||!c.length)return;d=x.bendpoint?a[x.index]:b,(l.length===1||!EA(i,l[l.length-1]))&&l.push(SA(d)),(c.length===1||!EA(i,c[0]))&&c.unshift(SA(d))}h=s.source,p=s.target,e.canConnect(h,i,s)&&(n.reconnectEnd(s,i,l||b),f=s),e.canConnect(i,p,s)&&(f?m=n.connect(i,p,{type:s.type,waypoints:c}):(n.reconnectStart(s,i,c||b),m=s));var y=[].concat(f&&ht(v,function(w){return w.source===f.source})||[],m&&ht(g,function(w){return w.target===m.target})||[]);y.length&&n.removeElements(y)}this.preExecute("elements.move",function(i){var s=i.newParent,o=i.shapes,a=i.delta,l=o[0];if(!(!l||!s)){s&&s.waypoints&&(i.newParent=s=s.parent);var c=xt(l),d={x:c.x+a.x,y:c.y+a.y},h=Tt(s.children,function(p){var f=e.canInsert(o,p);return f&&gC(p.waypoints,d)});h&&(i.targetFlow=h,i.position=d)}},!0),this.postExecuted("elements.move",function(i){var s=i.shapes,o=i.targetFlow,a=i.position;o&&r(s[0],o,a)},!0),this.preExecute("shape.create",function(i){var s=i.parent,o=i.shape;e.canInsert(o,s)&&(i.targetFlow=s,i.parent=s.parent)},!0),this.postExecuted("shape.create",function(i){var s=i.shape,o=i.targetFlow,a=i.position;o&&r(s,o,a)},!0)}Ce(H2,ye);H2.$inject=["eventBus","bpmnRules","modeling"];function EA(t,e){var n=e.x,r=e.y;return n>=t.x&&n<=t.x+t.width&&r>=t.y&&r<=t.y+t.height}function SA(t){return B({},t)}function U2(t,e){ye.call(this,t),this.preExecuted("connection.create",function(n){var r=n.context,i=r.connection,s=r.source,o=r.target,a=r.hints;if(!(a&&a.createElementsBehavior===!1)&&Ah(i)){var l=[];T(s,"bpmn:EventBasedGateway")?l=o.incoming.filter(c=>c!==i&&Ah(c)):l=o.incoming.filter(c=>c!==i&&Ah(c)&&T(c.source,"bpmn:EventBasedGateway")),l.forEach(function(c){e.removeConnection(c)})}}),this.preExecuted("shape.replace",function(n){var r=n.context,i=r.newShape;if(T(i,"bpmn:EventBasedGateway")){var s=i.outgoing.filter(Ah).reduce(function(o,a){return o.includes(a.target)?o:o.concat(a.target)},[]);s.forEach(function(o){o.incoming.filter(Ah).forEach(function(a){const l=o.incoming.filter(Ah).filter(function(c){return c.source===i});(a.source!==i||l.length>1)&&e.removeConnection(a)})})}})}U2.$inject=["eventBus","modeling"];Ce(U2,ye);function Ah(t){return T(t,"bpmn:SequenceFlow")}var Xy=1500,CA=2e3;function m6(t,e,n){e.on(["create.hover","create.move","create.out","create.end","shape.move.hover","shape.move.move","shape.move.out","shape.move.end"],Xy,function(r){var i=r.context,s=i.shape||r.shape,o=r.hover;T(o,"bpmn:Lane")&&!Lt(s,["bpmn:Lane","bpmn:Participant"])&&(r.hover=Gs(o),r.hoverGfx=t.getGraphics(r.hover));var a=n.getRootElement();o!==a&&(s.labelTarget||Lt(s,["bpmn:Group","bpmn:TextAnnotation"]))&&(r.hover=a,r.hoverGfx=t.getGraphics(r.hover))}),e.on(["connect.hover","connect.out","connect.end","connect.cleanup","global-connect.hover","global-connect.out","global-connect.end","global-connect.cleanup"],Xy,function(r){var i=r.hover;T(i,"bpmn:Lane")&&(r.hover=Gs(i)||i,r.hoverGfx=t.getGraphics(r.hover))}),e.on(["bendpoint.move.hover"],Xy,function(r){var i=r.context,s=r.hover,o=i.type;T(s,"bpmn:Lane")&&/reconnect/.test(o)&&(r.hover=Gs(s)||s,r.hoverGfx=t.getGraphics(r.hover))}),e.on(["connect.start"],Xy,function(r){var i=r.context,s=i.start;T(s,"bpmn:Lane")&&(i.start=Gs(s)||s)}),e.on("shape.move.start",CA,function(r){var i=r.shape;T(i,"bpmn:Lane")&&(r.shape=Gs(i)||i)}),e.on("spaceTool.move",CA,function(r){var i=r.hover;i&&T(i,"bpmn:Lane")&&(r.hover=Gs(i))})}m6.$inject=["elementRegistry","eventBus","canvas"];function Wse(t){return t.create("bpmn:Category")}function Gse(t){return t.create("bpmn:CategoryValue")}function Kse(t,e,n){return Or(e.get("categoryValue"),t),t.$parent=e,Or(n.get("rootElements"),e),e.$parent=n,t}function Yse(t){var e=t.$parent;return e&&(vr(e.get("categoryValue"),t),t.$parent=null),t}function Xse(t){var e=t.$parent;return e&&(vr(e.get("rootElements"),t),t.$parent=null),t}var jA=770;function V2(t,e,n,r,i,s){i.invoke(ye,this);function o(){return n.filter(function(m){return T(m,"bpmn:Group")})}function a(m,g){return m.some(function(v){var b=Me(v),x=b.categoryValueRef&&b.categoryValueRef.$parent;return x===g})}function l(m,g){return m.some(function(v){var b=Me(v);return b.categoryValueRef===g})}function c(m,g,v){var b=o().filter(function(x){return x.businessObject!==v});g&&!a(b,g)&&Xse(g),m&&!l(b,m)&&Yse(m)}function d(m,g){return Kse(m,g,e.getDefinitions())}function h(m,g){var v=Me(m),b=v.categoryValueRef;b||(b=v.categoryValueRef=g.categoryValue=g.categoryValue||Gse(t));var x=b.$parent;x||(x=b.$parent=g.category=g.category||Wse(t)),d(b,x,e.getDefinitions())}function p(m,g){var v=g.category,b=g.categoryValue,x=Me(m);b?(x.categoryValueRef=null,c(b,v,x)):c(null,x.categoryValueRef.$parent,x)}this.execute("label.create",function(m){var g=m.context,v=g.labelTarget;T(v,"bpmn:Group")&&h(v,g)}),this.revert("label.create",function(m){var g=m.context,v=g.labelTarget;T(v,"bpmn:Group")&&p(v,g)}),this.execute("shape.delete",function(m){var g=m.context,v=g.shape,b=Me(v);if(!(!T(v,"bpmn:Group")||v.labelTarget)){var x=g.categoryValue=b.categoryValueRef,y;x&&(y=g.category=x.$parent,c(x,y,b),b.categoryValueRef=null)}}),this.reverted("shape.delete",function(m){var g=m.context,v=g.shape;if(!(!T(v,"bpmn:Group")||v.labelTarget)){var b=g.category,x=g.categoryValue,y=Me(v);x&&(y.categoryValueRef=x,d(x,b))}}),this.execute("shape.create",function(m){var g=m.context,v=g.shape;!T(v,"bpmn:Group")||v.labelTarget||Me(v).categoryValueRef&&h(v,g)}),this.reverted("shape.create",function(m){var g=m.context,v=g.shape;!T(v,"bpmn:Group")||v.labelTarget||Me(v).categoryValueRef&&p(v,g)});function f(m,g){var v=t.create(m.$type);return s.copyElement(m,v,null,g)}r.on("copyPaste.copyElement",jA,function(m){var g=m.descriptor,v=m.element;if(!(!T(v,"bpmn:Group")||v.labelTarget)){var b=Me(v);if(b.categoryValueRef){var x=b.categoryValueRef;g.categoryValue=f(x,!0),x.$parent&&(g.category=f(x.$parent,!0))}}}),r.on("copyPaste.pasteElement",jA,function(m){var g=m.descriptor,v=g.businessObject,b=g.categoryValue,x=g.category;b&&(b=v.categoryValueRef=f(b)),x&&(b.$parent=f(x)),delete g.category,delete g.categoryValue})}V2.$inject=["bpmnFactory","bpmnjs","elementRegistry","eventBus","injector","moddleCopy"];Ce(V2,ye);function EC(t,e,n,r){var i,s,o,a,l;return i=(r.y-n.y)*(e.x-t.x)-(r.x-n.x)*(e.y-t.y),i==0?null:(s=t.y-n.y,o=t.x-n.x,l=(r.x-n.x)*s-(r.y-n.y)*o,a=l/i,{x:Math.round(t.x+a*(e.x-t.x)),y:Math.round(t.y+a*(e.y-t.y))})}function g6(t){function e(r,i,s){var o={x:s.x,y:s.y-50},a={x:s.x-50,y:s.y},l=EC(r,i,s,o),c=EC(r,i,s,a),d;l&&c?kA(l,s)>kA(c,s)?d=c:d=l:d=l||c,r.original=d}function n(r){var i=r.waypoints;e(i[0],i[1],xt(r.source)),e(i[i.length-1],i[i.length-2],xt(r.target))}t.on("bpmnElement.added",function(r){var i=r.element;i.waypoints&&n(i)})}g6.$inject=["eventBus"];function kA(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function q2(t){ye.call(this,t);var e=["bpmn:Participant","bpmn:Lane"];this.executed(["shape.move","shape.create","shape.resize"],function(n){var r=n.context.shape,i=Me(r),s=yn(r);if(Lt(i,e)){var o=s.get("isHorizontal");o===void 0&&(o=!0),s.set("isHorizontal",o)}})}q2.$inject=["eventBus"];Ce(q2,ye);var v6=Math.sqrt,y6=Math.min,Qse=Math.max,PA=Math.abs;function TA(t){return Math.pow(t,2)}function wm(t,e){return v6(TA(t.x-e.x)+TA(t.y-e.y))}function Zse(t,e){var n=0,r,i,s,o,a,l,c,d,h,p,f;for(n=0;n<e.length-1;n++){if(r=e[n],i=e[n+1],OA(r,i)?c=[r]:(s=wm(t,r),o=wm(t,i),l=y6(s,o),c=Jse(r,i,t,l)),c.length<1)throw new Error("expected between [1, 2] circle -> line intersections");c.length===1&&(d={type:"bendpoint",position:c[0],segmentIndex:n,bendpointIndex:OA(r,c[0])?n:n+1}),c.length===2&&(a=toe(c[0],c[1]),d={type:"segment",position:a,segmentIndex:n,relativeLocation:wm(r,a)/wm(r,i)}),h=wm(d.position,t),(!f||p>h)&&(f=d,p=h)}return f}function Jse(t,e,n,r){var i=e.x-t.x,s=e.y-t.y,o=n.x-t.x,a=n.y-t.y,l=i*i+s*s,c=i*o+s*a,d=o*o+a*a-r*r,h=c/l,p=d/l,f=h*h-p;if(f<0&&f>-1e-6&&(f=0),f<0)return[];var m=v6(f),g=-h+m,v=-h-m,b={x:t.x-i*g,y:t.y-s*g};if(f===0)return[b];var x={x:t.x-i*v,y:t.y-s*v};return[b,x].filter(function(y){return eoe(y,t,e)})}function eoe(t,e,n){return NA(t.x,e.x,n.x)&&NA(t.y,e.y,n.y)}function NA(t,e,n){return t>=y6(e,n)-v0&&t<=Qse(e,n)+v0}function toe(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}var v0=.1;function OA(t,e){return PA(t.x-e.x)<=v0&&PA(t.y-e.y)<=v0}function noe(t,e,n,r){var i=n.segmentIndex,s=e.length-t.length;if(r.segmentMove){var o=r.segmentMove.segmentStartIndex,a=r.segmentMove.newSegmentStartIndex;return i===o?a:i>=a?i+s<a?a:i+s:i}if(r.bendpointMove){var l=r.bendpointMove.insert,c=r.bendpointMove.bendpointIndex,d;if(s===0)return i;if(i>=c&&(d=l?i+1:i-1),i<c&&(d=i,l&&n.type!=="bendpoint"&&c-1===i)){var h=b6(e,c);h<n.relativeLocation&&d++}return d}return s===0?i:r.connectionStart&&i===0?0:r.connectionEnd&&i===t.length-2?e.length-2:Math.floor((e.length-2)/2)}function x6(t,e,n,r){var i=0,s=0,o={point:t,delta:{x:0,y:0}},a=Zse(t,n),l=a.segmentIndex,c=noe(n,e,a,r);if(c<0||c>e.length-2||c===null)return o;var d=RA(n,l),h=RA(e,c),p=a.position,f=ioe(d,p),m=roe(d,h);if(a.type==="bendpoint"){var g=e.length-n.length,v=a.bendpointIndex,b=n[v];if(e.indexOf(b)!==-1)return o;if(g===0){var x=e[v];return i=x.x-a.position.x,s=x.y-a.position.y,{delta:{x:i,y:s},point:{x:t.x+i,y:t.y+s}}}g<0&&v!==0&&v<n.length-1&&(f=b6(n,v))}var y={x:(h[1].x-h[0].x)*f+h[0].x,y:(h[1].y-h[0].y)*f+h[0].y},w=Gie({x:t.x-p.x,y:t.y-p.y},m);return i=y.x+w.x-t.x,s=y.y+w.y-t.y,{point:kg(y),delta:kg({x:i,y:s})}}function b6(t,e){var n=p0(t[e-1],t[e]),r=p0(t[e],t[e+1]),i=n/(n+r);return i}function roe(t,e){var n=nA(t),r=nA(e);return r-n}function RA(t,e){return[t[e],t[e+1]]}function ioe(t,e){var n=p0(t[0],t[1]),r=p0(t[0],e);return n===0?0:r/n}function soe(t,e,n,r){var i=xt(t);return x6(i,e,n,r).delta}function Pv(t,e,n){var r=cg(e),i=cg(n),s=Bo(t,r),o={x:s.x*(n.width/e.width),y:s.y*(n.height/e.height)};return kg({x:i.x+o.x,y:i.y+o.y})}function AA(t,e,n){var r=cg(t),i=cg(e),s=cg(n),o=Bo(t,r),a=Bo(r,i),l=ooe(r,e,n);if(l)return l;var c={x:a.x*(n.width/e.width),y:a.y*(n.height/e.height)},d={x:s.x+c.x,y:s.y+c.y};return kg({x:d.x+o.x-t.x,y:d.y+o.y-t.y})}function ooe(t,e,n){var r=dt(e),i=dt(n);if(aoe(r,i))return null;var s=ci(e,t),o,a,l;if(s==="top")o={x:0,y:i.bottom-r.bottom};else if(s==="bottom")o={x:0,y:i.top-r.top};else if(s==="right")o={x:i.left-r.left,y:0};else if(s==="left")o={x:i.right-r.right,y:0};else return null;return a={x:t.x+o.x,y:t.y+o.y},l=ci(n,a),l!==s?null:o}function aoe(t,e){return loe(t,e)||coe(t,e)}function loe(t,e){return t.right!==e.right&&t.left!==e.left}function coe(t,e){return t.top!==e.top&&t.bottom!==e.bottom}var IA="name",DA="text";function W2(t,e,n,r){ye.call(this,t),this.postExecute("element.updateProperties",i),this.postExecute("element.updateModdleProperties",o=>{Me(o.context.element)===o.context.moddleElement&&i(o)});function i(o){var a=o.context,l=a.element,c=a.properties;if(IA in c&&e.updateLabel(l,c[IA]),DA in c&&T(l,"bpmn:TextAnnotation")){var d=r.getTextAnnotationBounds({x:l.x,y:l.y,width:l.width,height:l.height},c[DA]||"");e.updateLabel(l,c.text,d)}}this.postExecute(["shape.create","connection.create"],function(o){var a=o.context,l=a.hints||{};if(l.createElementsBehavior!==!1){var c=a.shape||a.connection;Wt(c)||!Ap(c)||Td(c)&&e.updateLabel(c,Td(c))}}),this.postExecute("shape.delete",function(o){var a=o.context,l=a.labelTarget,c=a.hints||{};l&&c.unsetLabel!==!1&&e.updateLabel(l,null,null,{removeShape:!1})});function s(o){var a=o.context,l=a.connection,c=l.label,d=B({},a.hints),h=a.newWaypoints||l.waypoints,p=a.oldWaypoints;return typeof d.startChanged>"u"&&(d.startChanged=!!d.connectionStart),typeof d.endChanged>"u"&&(d.endChanged=!!d.connectionEnd),soe(c,h,p,d)}this.postExecute(["connection.layout","connection.updateWaypoints"],function(o){var a=o.context,l=a.hints||{};if(l.labelBehavior!==!1){var c=a.connection,d=c.label,h;!d||!d.parent||(h=s(o),e.moveShape(d,h))}}),this.postExecute(["shape.replace"],function(o){var a=o.context,l=a.newShape,c=a.oldShape,d=Me(l);d&&Ap(d)&&c.label&&l.label&&(l.label.x=c.label.x,l.label.y=c.label.y)}),this.postExecute("shape.resize",function(o){var a=o.context,l=a.shape,c=a.newBounds,d=a.oldBounds;if(fw(l)){var h=l.label,p=xt(h),f=hoe(d),m=doe(p,f),g=uoe(m,d,c);e.moveShape(h,g)}})}Ce(W2,ye);W2.$inject=["eventBus","modeling","bpmnFactory","textRenderer"];function uoe(t,e,n){var r=Pv(t,e,n);return kg(Bo(r,t))}function doe(t,e){if(e.length){var n=poe(t,e);return j2(t,n)}}function hoe(t){return[[{x:t.x,y:t.y},{x:t.x+(t.width||0),y:t.y}],[{x:t.x+(t.width||0),y:t.y},{x:t.x+(t.width||0),y:t.y+(t.height||0)}],[{x:t.x,y:t.y+(t.height||0)},{x:t.x+(t.width||0),y:t.y+(t.height||0)}],[{x:t.x,y:t.y},{x:t.x,y:t.y+(t.height||0)}]]}function poe(t,e){var n=e.map(function(i){return{line:i,distance:XF(t,i)}}),r=Ei(n,"distance");return r[0].line}function foe(t,e,n,r){return x6(t,e,n,r).point}function G2(t,e){ye.call(this,t);function n(r,i){var s=r.context,o=s.connection,a=B({},s.hints),l=s.newWaypoints||o.waypoints,c=s.oldWaypoints;return typeof a.startChanged>"u"&&(a.startChanged=!!a.connectionStart),typeof a.endChanged>"u"&&(a.endChanged=!!a.connectionEnd),foe(i,l,c,a)}this.postExecute(["connection.layout","connection.updateWaypoints"],function(r){var i=r.context,s=i.connection,o=s.outgoing,a=s.incoming;a.forEach(function(l){var c=l.waypoints[l.waypoints.length-1],d=n(r,c),h=[].concat(l.waypoints.slice(0,-1),[d]);e.updateWaypoints(l,h)}),o.forEach(function(l){var c=l.waypoints[0],d=n(r,c),h=[].concat([d],l.waypoints.slice(1));e.updateWaypoints(l,h)})}),this.postExecute(["connection.move"],function(r){var i=r.context,s=i.connection,o=s.outgoing,a=s.incoming,l=i.delta;a.forEach(function(c){var d=c.waypoints[c.waypoints.length-1],h={x:d.x+l.x,y:d.y+l.y},p=[].concat(c.waypoints.slice(0,-1),[h]);e.updateWaypoints(c,p)}),o.forEach(function(c){var d=c.waypoints[0],h={x:d.x+l.x,y:d.y+l.y},p=[].concat([h],c.waypoints.slice(1));e.updateWaypoints(c,p)})})}Ce(G2,ye);G2.$inject=["eventBus","modeling"];function Bw(t,e,n){var r=zw(t),i=_6(r,e),s=r[0];return i.length?i[i.length-1]:Pv(s.original||s,n,e)}function Fw(t,e,n){var r=zw(t),i=_6(r,e),s=r[r.length-1];return i.length?i[0]:Pv(s.original||s,n,e)}function K2(t,e,n){var r=zw(t),i=w6(e,n),s=r[0];return Pv(s.original||s,i,e)}function Y2(t,e,n){var r=zw(t),i=w6(e,n),s=r[r.length-1];return Pv(s.original||s,i,e)}function w6(t,e){return{x:t.x-e.x,y:t.y-e.y,width:t.width,height:t.height}}function zw(t){var e=t.waypoints;if(!e.length)throw new Error("connection#"+t.id+": no waypoints");return e}function _6(t,e){var n=yr(t,goe);return ht(n,function(r){return moe(r,e)})}function moe(t,e){return ci(e,t,1)==="intersect"}function goe(t){return t.original||t}function X2(t,e){ye.call(this,t),this.postExecute("shape.replace",function(n){var r=n.oldShape,i=n.newShape;if(voe(r,i)){var s=yoe(r);s.incoming.forEach(function(o){var a=Fw(o,i,r);e.reconnectEnd(o,i,a)}),s.outgoing.forEach(function(o){var a=Bw(o,i,r);e.reconnectStart(o,i,a)})}},!0)}X2.$inject=["eventBus","modeling"];Ce(X2,ye);function voe(t,e){return T(t,"bpmn:Participant")&&rn(t)&&T(e,"bpmn:Participant")&&!rn(e)}function yoe(t){var e=vv([t],!1),n=[],r=[];return e.forEach(function(i){i!==t&&(i.incoming.forEach(function(s){T(s,"bpmn:MessageFlow")&&n.push(s)}),i.outgoing.forEach(function(s){T(s,"bpmn:MessageFlow")&&r.push(s)}))},[]),{incoming:n,outgoing:r}}const xoe=["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:EscalationEventDefinition","bpmn:ConditionalEventDefinition","bpmn:SignalEventDefinition"];function E6(t){const e=Me(t);if(!T(e,"bpmn:BoundaryEvent")&&!(T(e,"bpmn:StartEvent")&&_i(e.$parent)))return!1;const n=e.get("eventDefinitions");return!n||!n.length?!1:xoe.some(r=>T(n[0],r))}function S6(t){return T(t,"bpmn:BoundaryEvent")?"cancelActivity":"isInterrupting"}function Q2(t,e){t.invoke(ye,this),this.postExecuted("shape.replace",function(n){const r=n.context.oldShape,i=n.context.newShape,s=n.context.hints;if(!E6(i))return;const o=S6(i);if(s.targetElement&&s.targetElement[o]!==void 0)return;const l=Me(r).get(o),c=Me(i).get(o);l!==c&&e.updateProperties(i,{[o]:l})})}Q2.$inject=["injector","modeling"];Ce(Q2,ye);function Z2(t,e){ye.call(this,t),this.preExecute("shape.resize",function(n){var r=n.shape,i=yn(r),s=i&&i.get("label"),o=s&&s.get("bounds");o&&e.updateModdleProperties(r,s,{bounds:void 0})},!0)}Ce(Z2,ye);Z2.$inject=["eventBus","modeling"];function J2(t,e,n){ye.call(this,t),this.preExecute("shape.delete",function(r){var i=r.context.shape;if(!(i.incoming.length!==1||i.outgoing.length!==1)){var s=i.incoming[0],o=i.outgoing[0];if(!(!T(s,"bpmn:SequenceFlow")||!T(o,"bpmn:SequenceFlow"))&&e.canConnect(s.source,o.target,s)){var a=boe(s.waypoints,o.waypoints);n.reconnectEnd(s,o.target,a)}}})}Ce(J2,ye);J2.$inject=["eventBus","bpmnRules","modeling"];function Ih(t){return t.original||t}function boe(t,e){var n=EC(Ih(t[t.length-2]),Ih(t[t.length-1]),Ih(e[1]),Ih(e[0]));return n?[].concat(t.slice(0,t.length-1),[n],e.slice(1)):[Ih(t[0]),Ih(e[e.length-1])]}function eP(t,e){ye.call(this,t),this.preExecute("shape.delete",function(n){var r=n.shape,i=r.parent;T(r,"bpmn:Participant")&&(n.collaborationRoot=i)},!0),this.postExecute("shape.delete",function(n){var r=n.collaborationRoot;if(r&&!r.businessObject.participants.length){var i=e.makeProcess(),s=r.children.slice();e.moveElements(s,{x:0,y:0},i)}},!0)}eP.$inject=["eventBus","modeling"];Ce(eP,ye);function tP(t,e,n,r){ye.call(this,t);var i=r.get("dragging",!1);function s(l){var c=l.source,d=l.target,h=l.parent;if(h){var p,f;T(l,"bpmn:SequenceFlow")&&(n.canConnectSequenceFlow(c,d)||(f=!0),n.canConnectMessageFlow(c,d)&&(p="bpmn:MessageFlow")),T(l,"bpmn:MessageFlow")&&(n.canConnectMessageFlow(c,d)||(f=!0),n.canConnectSequenceFlow(c,d)&&(p="bpmn:SequenceFlow")),f&&e.removeConnection(l),p&&e.connect(c,d,{type:p,waypoints:l.waypoints.slice()})}}function o(l){var c=l.context,d=c.connection,h=c.newSource||d.source,p=c.newTarget||d.target,f,m;f=n.canConnect(h,p),!(!f||f.type===d.type)&&(m=e.connect(h,p,{type:f.type,associationDirection:f.associationDirection,waypoints:d.waypoints.slice()}),d.parent&&e.removeConnection(d),c.connection=m,i&&a(d,m))}function a(l,c){var d=i.context(),h=d&&d.payload.previousSelection,p;!h||!h.length||(p=h.indexOf(l),p!==-1&&h.splice(p,1,c))}this.postExecuted("elements.move",function(l){var c=l.closure,d=c.allConnections;$(d,s)},!0),this.preExecute("connection.reconnect",o),this.postExecuted("element.updateProperties",function(l){var c=l.context,d=c.properties,h=c.element,p=h.businessObject,f;d.default&&(f=Tt(h.outgoing,Cs({id:h.businessObject.default.id})),f&&e.updateProperties(f,{conditionExpression:void 0})),d.conditionExpression&&p.sourceRef.default===p&&e.updateProperties(h.source,{default:void 0})})}Ce(tP,ye);tP.$inject=["eventBus","modeling","bpmnRules","injector"];function Hw(t,e,n,r,i,s){r.invoke(ye,this),this._bpmnReplace=t,this._elementRegistry=n,this._selection=s,this.postExecuted(["elements.create"],500,function(o){var a=o.context,l=a.parent,c=a.elements,d=xr(c,function(h,p){var f=e.canReplace([p],p.host||p.parent||l);return f?h.concat(f.replacements):h},[]);d.length&&this._replaceElements(c,d)},this),this.postExecuted(["elements.move"],500,function(o){var a=o.context,l=a.newParent,c=a.newHost,d=[];$(a.closure.topLevel,function(p){_i(p)?d=d.concat(p.children):d=d.concat(p)}),d.length===1&&c&&(l=c);var h=e.canReplace(d,l);h&&this._replaceElements(d,h.replacements,c)},this),this.postExecute(["shape.replace"],1500,function(o){var a=o.context,l=a.oldShape,c=a.newShape,d=l.attachers,h;d&&d.length&&(h=e.canReplace(d,c),this._replaceElements(d,h.replacements))},this),this.postExecuted(["shape.replace"],1500,function(o){var a=o.context,l=a.oldShape,c=a.newShape;i.unclaimId(l.businessObject.id,l.businessObject),i.updateProperties(c,{id:l.id})})}Ce(Hw,ye);Hw.prototype._replaceElements=function(t,e){var n=this._elementRegistry,r=this._bpmnReplace,i=this._selection;$(e,function(s){var o={type:s.newElementType},a=n.get(s.oldElementId),l=t.indexOf(a);t[l]=r.replaceElement(a,o,{select:!1})}),e&&i.select(t)};Hw.$inject=["bpmnReplace","bpmnRules","elementRegistry","injector","modeling","selection"];var woe=1500,_oe={width:140,height:120},nP={width:300,height:60},rP={width:60,height:300},kb={width:300,height:150},Pb={width:150,height:300},C6={width:140,height:120},j6={width:50,height:30};function k6(t){t.on("resize.start",woe,function(e){var n=e.context,r=n.shape,i=n.direction,s=n.balanced;(T(r,"bpmn:Lane")||T(r,"bpmn:Participant"))&&(n.resizeConstraints=koe(r,i,s)),T(r,"bpmn:SubProcess")&&rn(r)&&(n.minDimensions=C6),T(r,"bpmn:TextAnnotation")&&(n.minDimensions=j6)})}k6.$inject=["eventBus"];var oc=Math.abs,Eoe=Math.min,Soe=Math.max;function P6(t,e,n,r){var i=t[e];t[e]=i===void 0?n:r(n,i)}function Dh(t,e,n){return P6(t,e,n,Eoe)}function $h(t,e,n){return P6(t,e,n,Soe)}var Coe={top:20,left:50,right:20,bottom:20},joe={top:50,left:20,right:20,bottom:20};function koe(t,e,n){var r=Gs(t),i=!0,s=!0,o=Mw(r,[r]),a=dt(t),l={},c={},d=Yr(t),h=d?nP:rP;/n/.test(e)?c.top=a.bottom-h.height:/e/.test(e)?c.right=a.left+h.width:/s/.test(e)?c.bottom=a.top+h.height:/w/.test(e)&&(c.left=a.right-h.width),o.forEach(function(m){var g=dt(m);d?(g.top<a.top-10&&(i=!1),g.bottom>a.bottom+10&&(s=!1)):(g.left<a.left-10&&(i=!1),g.right>a.right+10&&(s=!1)),/n/.test(e)&&(n&&oc(a.top-g.bottom)<10&&$h(l,"top",g.top+h.height),oc(a.top-g.top)<5&&Dh(c,"top",g.bottom-h.height)),/e/.test(e)&&(n&&oc(a.right-g.left)<10&&Dh(l,"right",g.right-h.width),oc(a.right-g.right)<5&&$h(c,"right",g.left+h.width)),/s/.test(e)&&(n&&oc(a.bottom-g.top)<10&&Dh(l,"bottom",g.bottom-h.height),oc(a.bottom-g.bottom)<5&&$h(c,"bottom",g.top+h.height)),/w/.test(e)&&(n&&oc(a.left-g.right)<10&&$h(l,"left",g.left+h.width),oc(a.left-g.left)<5&&Dh(c,"left",g.right-h.width))});var p=r.children.filter(function(m){return!m.hidden&&!m.waypoints&&(T(m,"bpmn:FlowElement")||T(m,"bpmn:Artifact"))}),f=d?Coe:joe;return p.forEach(function(m){var g=dt(m);/n/.test(e)&&(!d||i)&&Dh(c,"top",g.top-f.top),/e/.test(e)&&(d||s)&&$h(c,"right",g.right+f.right),/s/.test(e)&&(!d||s)&&$h(c,"bottom",g.bottom+f.bottom),/w/.test(e)&&(d||i)&&Dh(c,"left",g.left-f.left)}),{min:c,max:l}}var $A=1001;function T6(t,e){t.on("resize.start",$A+500,function(n){var r=n.context,i=r.shape;(T(i,"bpmn:Lane")||T(i,"bpmn:Participant"))&&(r.balanced=!Pg(n))}),t.on("resize.end",$A,function(n){var r=n.context,i=r.shape,s=r.canExecute,o=r.newBounds;if(T(i,"bpmn:Lane")||T(i,"bpmn:Participant"))return s&&(o=qB(o),e.resizeLane(i,o,r.balanced)),!1})}T6.$inject=["eventBus","modeling"];var Poe=500;function iP(t,e,n,r,i){n.invoke(ye,this);function s(d){return Lt(d,["bpmn:ReceiveTask","bpmn:SendTask"])||Toe(d,["bpmn:ErrorEventDefinition","bpmn:EscalationEventDefinition","bpmn:MessageEventDefinition","bpmn:SignalEventDefinition"])}function o(d){var h=t.getDefinitions(),p=h.get("rootElements");return!!Tt(p,Cs({id:d.id}))}function a(d){if(T(d,"bpmn:ErrorEventDefinition"))return"errorRef";if(T(d,"bpmn:EscalationEventDefinition"))return"escalationRef";if(T(d,"bpmn:MessageEventDefinition"))return"messageRef";if(T(d,"bpmn:SignalEventDefinition"))return"signalRef"}function l(d){if(Lt(d,["bpmn:ReceiveTask","bpmn:SendTask"]))return d.get("messageRef");var h=d.get("eventDefinitions"),p=h[0];return p.get(a(p))}function c(d,h){if(Lt(d,["bpmn:ReceiveTask","bpmn:SendTask"]))return d.set("messageRef",h);var p=d.get("eventDefinitions"),f=p[0];return f.set(a(f),h)}this.executed(["shape.create","element.updateProperties","element.updateModdleProperties"],function(d){var h=d.shape||d.element;if(s(h)){var p=Me(h),f=l(p),m;f&&!o(f)&&(m=t.getDefinitions().get("rootElements"),Or(m,f),d.addedRootElement=f)}},!0),this.reverted(["shape.create","element.updateProperties","element.updateModdleProperties"],function(d){var h=d.addedRootElement;if(h){var p=t.getDefinitions().get("rootElements");vr(p,h)}},!0),e.on("copyPaste.copyElement",function(d){var h=d.descriptor,p=d.element;if(!(p.labelTarget||!s(p))){var f=Me(p),m=l(f);m&&(h.referencedRootElement=m)}}),e.on("copyPaste.pasteElement",Poe,function(d){var h=d.descriptor,p=h.businessObject,f=h.referencedRootElement;f&&(o(f)||(f=r.copyElement(f,i.create(f.$type))),c(p,f),delete h.referencedRootElement)})}iP.$inject=["bpmnjs","eventBus","injector","moddleCopy","bpmnFactory"];Ce(iP,ye);function Toe(t,e){return ke(e)||(e=[e]),Yc(e,function(n){return kk(t,n)})}var N6=Math.max;function O6(t){t.on("spaceTool.getMinDimensions",function(e){var n=e.shapes,r=e.axis,i=e.start,s={};return $(n,function(o){var a=o.id;T(o,"bpmn:Participant")&&(s[a]=Ooe(o,r,i)),T(o,"bpmn:Lane")&&(s[a]=Yr(o)?nP:rP),T(o,"bpmn:SubProcess")&&rn(o)&&(s[a]=C6),T(o,"bpmn:TextAnnotation")&&(s[a]=j6),T(o,"bpmn:Group")&&(s[a]=_oe)}),s})}O6.$inject=["eventBus"];function Noe(t){return t==="x"}function Ooe(t,e,n){var r=Yr(t);if(!Ioe(t))return r?kb:Pb;var i=Noe(e),s={};return i?r?s=kb:s={width:Aoe(t,n,i),height:Pb.height}:r?s={width:kb.width,height:Roe(t,n,i)}:s=Pb,s}function Roe(t,e,n){var r;return r=Doe(t,e,n),N6(kb.height,r)}function Aoe(t,e,n){var r;return r=$oe(t,e,n),N6(Pb.width,r)}function Ioe(t){return!!Zc(t).length}function Doe(t,e,n){var r=Zc(t),i;return i=sP(r,e,n),t.height-i.height+nP.height}function $oe(t,e,n){var r=Zc(t),i;return i=sP(r,e,n),t.width-i.width+rP.width}function sP(t,e,n){var r,i,s;for(r=0;r<t.length;r++)if(i=t[r],!n&&e>=i.y&&e<=i.y+i.height||n&&e>=i.x&&e<=i.x+i.width)return s=Zc(i),s.length?sP(s,e,n):i}var MA=400,Moe=600,LA={x:180,y:160};function Jc(t,e,n,r,i,s,o){ye.call(this,e),this._canvas=t,this._eventBus=e,this._modeling=n,this._elementFactory=r,this._bpmnFactory=i,this._bpmnjs=s,this._elementRegistry=o;var a=this;function l(h){return T(h,"bpmn:SubProcess")&&!rn(h)}function c(h){var p=h.shape,f=h.newRootElement,m=Me(p);f=a._addDiagram(f||m),h.newRootElement=t.addRootElement(f)}function d(h){var p=h.shape,f=Me(p);a._removeDiagram(f);var m=h.newRootElement=o.get(Vh(f));t.removeRootElement(m)}this.executed("shape.create",function(h){var p=h.shape;l(p)&&c(h)},!0),this.postExecuted("shape.create",function(h){var p=h.shape,f=h.newRootElement;!f||!p.children||(a._showRecursively(p.children),a._moveChildrenToShape(p,f))},!0),this.reverted("shape.create",function(h){var p=h.shape;l(p)&&d(h)},!0),this.preExecuted("shape.delete",function(h){var p=h.shape;if(l(p)){var f=o.get(Vh(p));f&&n.removeElements(f.children.slice())}},!0),this.executed("shape.delete",function(h){var p=h.shape;l(p)&&d(h)},!0),this.reverted("shape.delete",function(h){var p=h.shape;l(p)&&c(h)},!0),this.preExecuted("shape.replace",function(h){var p=h.oldShape,f=h.newShape;!l(p)||!l(f)||(h.oldRoot=t.removeRootElement(Vh(p)))},!0),this.postExecuted("shape.replace",function(h){var p=h.newShape,f=h.oldRoot,m=t.findRoot(Vh(p));if(!(!f||!m)){var g=f.children;n.moveElements(g,{x:0,y:0},m)}},!0),this.executed("element.updateProperties",function(h){var p=h.element;if(T(p,"bpmn:SubProcess")){var f=h.properties,m=h.oldProperties,g=m.id,v=f.id;if(g!==v){if(yb(p)){o.updateId(p,Ru(v)),o.updateId(g,v);return}var b=o.get(Ru(g));b&&o.updateId(Ru(g),Ru(v))}}},!0),this.reverted("element.updateProperties",function(h){var p=h.element;if(T(p,"bpmn:SubProcess")){var f=h.properties,m=h.oldProperties,g=m.id,v=f.id;if(g!==v){if(yb(p)){o.updateId(p,Ru(g)),o.updateId(v,g);return}var b=o.get(Ru(v));b&&o.updateId(b,Ru(g))}}},!0),e.on("element.changed",function(h){var p=h.element;if(yb(p)){var f=p,m=o.get(_O(f));!m||m===f||e.fire("element.changed",{element:m})}}),this.executed("shape.toggleCollapse",MA,function(h){var p=h.shape;T(p,"bpmn:SubProcess")&&(rn(p)?d(h):(c(h),a._showRecursively(p.children)))},!0),this.reverted("shape.toggleCollapse",MA,function(h){var p=h.shape;T(p,"bpmn:SubProcess")&&(rn(p)?d(h):(c(h),a._showRecursively(p.children)))},!0),this.postExecuted("shape.toggleCollapse",Moe,function(h){var p=h.shape;if(T(p,"bpmn:SubProcess")){var f=h.newRootElement;f&&(rn(p)?a._moveChildrenToShape(f,p):a._moveChildrenToShape(p,f))}},!0),e.on("copyPaste.createTree",function(h){var p=h.element,f=h.children;if(l(p)){var m=Vh(p),g=o.get(m);g&&f.push.apply(f,g.children)}}),e.on("copyPaste.copyElement",function(h){var p=h.descriptor,f=h.element,m=h.elements,g=f.parent,v=T(yn(g),"bpmndi:BPMNPlane");if(v){var b=_O(g),x=Tt(m,function(y){return y.id===b});x&&(p.parent=x.id)}}),e.on("copyPaste.pasteElement",function(h){var p=h.descriptor;p.parent&&(l(p.parent)||p.parent.hidden)&&(p.hidden=!0)})}Ce(Jc,ye);Jc.prototype._moveChildrenToShape=function(t,e){var n=this._modeling,r=t.children,i;if(r){r=r.concat(r.reduce(function(c,d){return d.label&&d.label.parent!==t?c.concat(d.label):c},[]));var s=r.filter(function(c){return!c.hidden});if(!s.length){n.moveElements(r,{x:0,y:0},e,{autoResize:!1});return}var o=Di(s);if(!e.x)i={x:LA.x-o.x,y:LA.y-o.y};else{var a=xt(e),l=xt(o);i={x:a.x-l.x,y:a.y-l.y}}n.moveElements(r,i,e,{autoResize:!1})}};Jc.prototype._showRecursively=function(t,e){var n=this,r=[];return t.forEach(function(i){i.hidden=!!e,r=r.concat(i),i.children&&(r=r.concat(n._showRecursively(i.children,i.collapsed||e)))}),r};Jc.prototype._addDiagram=function(t){var e=this._bpmnjs,n=e.getDefinitions().diagrams;return t.businessObject||(t=this._createNewDiagram(t)),n.push(t.di.$parent),t};Jc.prototype._createNewDiagram=function(t){var e=this._bpmnFactory,n=this._elementFactory,r=e.create("bpmndi:BPMNPlane",{bpmnElement:t}),i=e.create("bpmndi:BPMNDiagram",{plane:r});r.$parent=i;var s=n.createRoot({id:Vh(t),type:t.$type,di:r,businessObject:t,collapsed:!0});return s};Jc.prototype._removeDiagram=function(t){var e=this._bpmnjs,n=e.getDefinitions().diagrams,r=Tt(n,function(i){return i.plane.bpmnElement.id===t.id});return n.splice(n.indexOf(r),1),r};Jc.$inject=["canvas","eventBus","modeling","elementFactory","bpmnFactory","bpmnjs","elementRegistry"];function oP(t,e){t.invoke(ye,this),this.postExecuted("shape.replace",function(n){var r=n.context.oldShape,i=n.context.newShape;if(!(!T(i,"bpmn:SubProcess")||T(i,"bpmn:AdHocSubProcess")||!(T(r,"bpmn:Task")||T(r,"bpmn:CallActivity"))||!rn(i))){var s=Loe(i);e.createShape({type:"bpmn:StartEvent"},s,i)}})}oP.$inject=["injector","modeling"];Ce(oP,ye);function Loe(t){return{x:t.x+t.width/6,y:t.y+t.height/2}}function aP(t){ye.call(this,t),this.preExecute("connection.create",function(e){const{target:n}=e;T(n,"bpmn:TextAnnotation")&&(e.parent=n.parent)},!0),this.preExecute(["shape.create","shape.resize","elements.move"],function(e){const n=e.shapes||[e.shape];n.length===1&&T(n[0],"bpmn:TextAnnotation")&&(e.hints=e.hints||{},e.hints.autoResize=!1)},!0)}Ce(aP,ye);aP.$inject=["eventBus"];function lP(t,e){ye.call(this,t),this.postExecuted("shape.toggleCollapse",1500,function(n){var r=n.shape;if(rn(r))return;var i=vv(r);i.forEach(function(o){var a=o.incoming.slice(),l=o.outgoing.slice();$(a,function(c){s(c,!0)}),$(l,function(c){s(c,!1)})});function s(o,a){i.indexOf(o.source)!==-1&&i.indexOf(o.target)!==-1||(a?e.reconnectEnd(o,r,xt(r)):e.reconnectStart(o,r,xt(r)))}},!0)}Ce(lP,ye);lP.$inject=["eventBus","modeling"];var lE=500;function cP(t,e,n){ye.call(this,t);function r(o){o.length&&o.forEach(function(a){a.type==="label"&&!a.businessObject.name&&(a.hidden=!0)})}function i(o,a){var l=o.children,c=a,d,h;return d=Boe(l).concat([o]),h=f6(d),h?(c.width=Math.max(h.width,c.width),c.height=Math.max(h.height,c.height),c.x=h.x+(h.width-c.width)/2,c.y=h.y+(h.height-c.height)/2):(c.x=o.x+(o.width-c.width)/2,c.y=o.y+(o.height-c.height)/2),c}function s(o,a){return{x:o.x+(o.width-a.width)/2,y:o.y+(o.height-a.height)/2,width:a.width,height:a.height}}this.executed(["shape.toggleCollapse"],lE,function(o){var a=o.context,l=a.shape;T(l,"bpmn:SubProcess")&&(l.collapsed?yn(l).isExpanded=!1:(r(l.children),yn(l).isExpanded=!0))}),this.reverted(["shape.toggleCollapse"],lE,function(o){var a=o.context,l=a.shape;l.collapsed?yn(l).isExpanded=!1:yn(l).isExpanded=!0}),this.postExecuted(["shape.toggleCollapse"],lE,function(o){var a=o.context.shape,l=e.getDefaultSize(a),c;a.collapsed?c=s(a,l):c=i(a,l),n.resizeShape(a,c,null,{autoResize:a.collapsed?!1:"nwse"})})}Ce(cP,ye);cP.$inject=["eventBus","elementFactory","modeling"];function Boe(t){return t.filter(function(e){return!e.hidden})}function uP(t,e,n,r){e.invoke(ye,this),this.preExecute("shape.delete",function(i){var s=i.context,o=s.shape,a=o.businessObject;Wt(o)||(T(o,"bpmn:Participant")&&rn(o)&&n.ids.unclaim(a.processRef.id),r.unclaimId(a.id,a))}),this.preExecute("connection.delete",function(i){var s=i.context,o=s.connection,a=o.businessObject;r.unclaimId(a.id,a)}),this.preExecute("canvas.updateRoot",function(){var i=t.getRootElement(),s=i.businessObject;T(i,"bpmn:Collaboration")&&n.ids.unclaim(s.id)})}Ce(uP,ye);uP.$inject=["canvas","injector","moddle","modeling"];function dP(t,e){ye.call(this,t),this.preExecute("connection.delete",function(n){var r=n.context,i=r.connection,s=i.source;Foe(i,s)&&e.updateProperties(s,{default:null})})}Ce(dP,ye);dP.$inject=["eventBus","modeling"];function Foe(t,e){if(!T(t,"bpmn:SequenceFlow"))return!1;var n=Me(e),r=Me(t);return n.get("default")===r}var zoe=500,Hoe=5e3;function hP(t,e){ye.call(this,t);var n;function r(){return n=n||new Uoe,n.enter(),n}function i(){if(!n)throw new Error("out of bounds release");return n}function s(){if(!n)throw new Error("out of bounds release");var a=n.leave();return a&&(e.updateLaneRefs(n.flowNodes,n.lanes),n=null),a}var o=["spaceTool","lane.add","lane.resize","lane.split","elements.create","elements.delete","elements.move","shape.create","shape.delete","shape.move","shape.resize"];this.preExecute(o,Hoe,function(a){r()}),this.postExecuted(o,zoe,function(a){s()}),this.preExecute(["shape.create","shape.move","shape.delete","shape.resize"],function(a){var l=a.context,c=l.shape,d=i();c.labelTarget||(T(c,"bpmn:Lane")&&d.addLane(c),T(c,"bpmn:FlowNode")&&d.addFlowNode(c))})}hP.$inject=["eventBus","modeling"];Ce(hP,ye);function Uoe(){this.flowNodes=[],this.lanes=[],this.counter=0,this.addLane=function(t){this.lanes.push(t)},this.addFlowNode=function(t){this.flowNodes.push(t)},this.enter=function(){this.counter++},this.leave=function(){return this.counter--,!this.counter}}function pP(t,e){ye.call(this,t),this.postExecuted("elements.create",function(n){const r=n.context,i=r.elements;for(const s of i)Voe(s)&&!Woe(s)&&e.updateProperties(s,{isForCompensation:void 0})})}Ce(pP,ye);pP.$inject=["eventBus","modeling"];function Voe(t){const e=Me(t);return e&&e.isForCompensation}function qoe(t){return t&&T(t,"bpmn:BoundaryEvent")&&kk(t,"bpmn:CompensateEventDefinition")}function Woe(t){return t.incoming.filter(n=>qoe(n.source)).length>0}const Goe={__init__:["adaptiveLabelPositioningBehavior","appendBehavior","associationBehavior","attachEventBehavior","boundaryEventBehavior","compensateBoundaryEventBehaviour","createBehavior","createDataObjectBehavior","createParticipantBehavior","dataInputAssociationBehavior","dataStoreBehavior","deleteLaneBehavior","detachEventBehavior","dropOnFlowBehavior","eventBasedGatewayBehavior","fixHoverBehavior","groupBehavior","importDockingFix","isHorizontalFix","labelBehavior","layoutConnectionBehavior","messageFlowBehavior","nonInterruptingBehavior","removeElementBehavior","removeEmbeddedLabelBoundsBehavior","removeParticipantBehavior","replaceConnectionBehavior","replaceElementBehaviour","resizeBehavior","resizeLaneBehavior","rootElementReferenceBehavior","spaceToolBehavior","subProcessPlaneBehavior","subProcessStartEventBehavior","textAnnotationBehavior","toggleCollapseConnectionBehaviour","toggleElementCollapseBehaviour","unclaimIdBehavior","updateFlowNodeRefsBehavior","unsetDefaultFlowBehavior","setCompensationActivityAfterPasteBehavior"],adaptiveLabelPositioningBehavior:["type",O2],appendBehavior:["type",R2],associationBehavior:["type",A2],attachEventBehavior:["type",Dw],boundaryEventBehavior:["type",I2],compensateBoundaryEventBehaviour:["type",D2],createBehavior:["type",$2],createDataObjectBehavior:["type",M2],createParticipantBehavior:["type",L2],dataInputAssociationBehavior:["type",B2],dataStoreBehavior:["type",F2],deleteLaneBehavior:["type",z2],detachEventBehavior:["type",Lw],dropOnFlowBehavior:["type",H2],eventBasedGatewayBehavior:["type",U2],fixHoverBehavior:["type",m6],groupBehavior:["type",V2],importDockingFix:["type",g6],isHorizontalFix:["type",q2],labelBehavior:["type",W2],layoutConnectionBehavior:["type",G2],messageFlowBehavior:["type",X2],nonInterruptingBehavior:["type",Q2],removeElementBehavior:["type",J2],removeEmbeddedLabelBoundsBehavior:["type",Z2],removeParticipantBehavior:["type",eP],replaceConnectionBehavior:["type",tP],replaceElementBehaviour:["type",Hw],resizeBehavior:["type",k6],resizeLaneBehavior:["type",T6],rootElementReferenceBehavior:["type",iP],spaceToolBehavior:["type",O6],subProcessPlaneBehavior:["type",Jc],subProcessStartEventBehavior:["type",oP],textAnnotationBehavior:["type",aP],toggleCollapseConnectionBehaviour:["type",lP],toggleElementCollapseBehaviour:["type",cP],unclaimIdBehavior:["type",uP],unsetDefaultFlowBehavior:["type",dP],updateFlowNodeRefsBehavior:["type",hP],setCompensationActivityAfterPasteBehavior:["type",pP]};function R6(t,e){var n=ci(t,e,-15);return n!=="intersect"?n:null}function Zr(t){co.call(this,t)}Ce(Zr,co);Zr.$inject=["eventBus"];Zr.prototype.init=function(){this.addRule("connection.start",function(t){var e=t.source;return Koe(e)}),this.addRule("connection.create",function(t){var e=t.source,n=t.target,r=t.hints||{},i=r.targetParent,s=r.targetAttach;if(s)return!1;i&&(n.parent=i);try{return Tb(e,n)}finally{i&&(n.parent=null)}}),this.addRule("connection.reconnect",function(t){var e=t.connection,n=t.source,r=t.target;return Tb(n,r,e)}),this.addRule("connection.updateWaypoints",function(t){return{type:t.connection.type}}),this.addRule("shape.resize",function(t){var e=t.shape,n=t.newBounds;return z6(e,n)}),this.addRule("elements.create",function(t){var e=t.elements,n=t.position,r=t.target;return En(r)&&!y0(e,r)?!1:Zs(e,function(i){return En(i)?Tb(i.source,i.target,i):i.host?ug(i,i.host,null,n):kC(i,r,null)})}),this.addRule("elements.move",function(t){var e=t.target,n=t.shapes,r=t.position;return ug(n,e,null,r)||B6(n,e,r)||F6(n,e)||y0(n,e)}),this.addRule("shape.create",function(t){return kC(t.shape,t.target,t.source,t.position)}),this.addRule("shape.attach",function(t){return ug(t.shape,t.target,null,t.position)}),this.addRule("element.copy",function(t){var e=t.element,n=t.elements;return W6(n,e)})};Zr.prototype.canConnectMessageFlow=V6;Zr.prototype.canConnectSequenceFlow=q6;Zr.prototype.canConnectDataAssociation=mP;Zr.prototype.canConnectAssociation=H6;Zr.prototype.canConnectCompensationAssociation=U6;Zr.prototype.canMove=F6;Zr.prototype.canAttach=ug;Zr.prototype.canReplace=B6;Zr.prototype.canDrop=qp;Zr.prototype.canInsert=y0;Zr.prototype.canCreate=kC;Zr.prototype.canConnect=Tb;Zr.prototype.canResize=z6;Zr.prototype.canCopy=W6;function Koe(t){return SC(t)?null:Lt(t,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference","bpmn:Group","bpmn:TextAnnotation"])}function SC(t){return!t||Wt(t)}function Yoe(t,e){return t===e}function BA(t){do{if(T(t,"bpmn:Process"))return Me(t);if(T(t,"bpmn:Participant"))return Me(t).processRef||Me(t)}while(t=t.parent)}function CC(t){return T(t,"bpmn:TextAnnotation")}function fP(t){return T(t,"bpmn:Group")&&!t.labelTarget}function A6(t){return T(t,"bpmn:BoundaryEvent")&&Ca(t,"bpmn:CompensateEventDefinition")}function Uw(t){return Me(t).isForCompensation}function Xoe(t,e){var n=BA(t),r=BA(e);return n===r}function Qoe(t){return T(t,"bpmn:InteractionNode")&&!T(t,"bpmn:BoundaryEvent")&&(!T(t,"bpmn:Event")||T(t,"bpmn:ThrowEvent")&&D6(t,"bpmn:MessageEventDefinition"))}function Zoe(t){return T(t,"bpmn:InteractionNode")&&!Uw(t)&&(!T(t,"bpmn:Event")||T(t,"bpmn:CatchEvent")&&D6(t,"bpmn:MessageEventDefinition"))&&!(T(t,"bpmn:BoundaryEvent")&&!Ca(t,"bpmn:MessageEventDefinition"))}function FA(t){for(var e=t;e=e.parent;){if(T(e,"bpmn:FlowElementsContainer"))return Me(e);if(T(e,"bpmn:Participant"))return Me(e).processRef}return null}function I6(t,e){var n=FA(t),r=FA(e);return n===r}function Ca(t,e){var n=Me(t);return!!Tt(n.eventDefinitions||[],function(r){return T(r,e)})}function D6(t,e){var n=Me(t);return(n.eventDefinitions||[]).every(function(r){return T(r,e)})}function Joe(t){return T(t,"bpmn:FlowNode")&&!T(t,"bpmn:EndEvent")&&!_i(t)&&!(T(t,"bpmn:IntermediateThrowEvent")&&Ca(t,"bpmn:LinkEventDefinition"))&&!A6(t)&&!Uw(t)}function eae(t){return T(t,"bpmn:FlowNode")&&!T(t,"bpmn:StartEvent")&&!T(t,"bpmn:BoundaryEvent")&&!_i(t)&&!(T(t,"bpmn:IntermediateCatchEvent")&&Ca(t,"bpmn:LinkEventDefinition"))&&!Uw(t)}function tae(t){return T(t,"bpmn:ReceiveTask")||T(t,"bpmn:IntermediateCatchEvent")&&(Ca(t,"bpmn:MessageEventDefinition")||Ca(t,"bpmn:TimerEventDefinition")||Ca(t,"bpmn:ConditionalEventDefinition")||Ca(t,"bpmn:SignalEventDefinition"))}function nae(t){for(var e=[];t;)t=t.parent,t&&e.push(t);return e}function jC(t,e){var n=nae(e);return n.indexOf(t)!==-1}function Tb(t,e,n){if(SC(t)||SC(e))return null;if(!T(n,"bpmn:DataAssociation")){if(V6(t,e))return{type:"bpmn:MessageFlow"};if(q6(t,e))return{type:"bpmn:SequenceFlow"}}var r=mP(t,e);return r||(U6(t,e)?{type:"bpmn:Association",associationDirection:"One"}:H6(t,e)?{type:"bpmn:Association",associationDirection:"None"}:!1)}function qp(t,e){return Wt(t)||fP(t)?!0:T(e,"bpmn:Participant")&&!rn(e)?!1:T(t,"bpmn:Participant")?T(e,"bpmn:Process")||T(e,"bpmn:Collaboration"):Lt(t,["bpmn:DataInput","bpmn:DataOutput"])&&t.parent?e===t.parent:T(t,"bpmn:Lane")?T(e,"bpmn:Participant")||T(e,"bpmn:Lane"):T(t,"bpmn:BoundaryEvent")&&!rae(t)?!1:T(t,"bpmn:FlowElement")&&!T(t,"bpmn:DataStoreReference")?T(e,"bpmn:FlowElementsContainer")?rn(e):Lt(e,["bpmn:Participant","bpmn:Lane"]):T(t,"bpmn:DataStoreReference")&&T(e,"bpmn:Collaboration")?Yc(Me(e).get("participants"),function(n){return!!n.get("processRef")}):Lt(t,["bpmn:Artifact","bpmn:DataAssociation","bpmn:DataStoreReference"])?Lt(e,["bpmn:Collaboration","bpmn:Lane","bpmn:Participant","bpmn:Process","bpmn:SubProcess"]):T(t,"bpmn:MessageFlow")?T(e,"bpmn:Collaboration")||t.source.parent==e||t.target.parent==e:!1}function rae(t){return Me(t).cancelActivity&&($6(t)||M6(t))}function iae(t){return!Wt(t)&&T(t,"bpmn:BoundaryEvent")}function sae(t){return T(t,"bpmn:Lane")}function oae(t){return iae(t)||T(t,"bpmn:IntermediateThrowEvent")&&$6(t)?!0:T(t,"bpmn:IntermediateCatchEvent")&&M6(t)}function $6(t){var e=Me(t);return e&&!(e.eventDefinitions&&e.eventDefinitions.length)}function M6(t){return L6(t,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])}function L6(t,e){return e.some(function(n){return Ca(t,n)})}function aae(t){return T(t,"bpmn:ReceiveTask")&&Tt(t.incoming,function(e){return T(e.source,"bpmn:EventBasedGateway")})}function ug(t,e,n,r){if(Array.isArray(t)||(t=[t]),t.length!==1)return!1;var i=t[0];return Wt(i)||!oae(i)||_i(e)||!T(e,"bpmn:Activity")||Uw(e)||r&&!R6(r,e)||aae(e)?!1:"attach"}function B6(t,e,n){if(!e)return!1;var r={replacements:[]};return $(t,function(i){_i(e)||T(i,"bpmn:StartEvent")&&i.type!=="label"&&qp(i,e)&&(fX(i)||r.replacements.push({oldElementId:i.id,newElementType:"bpmn:StartEvent"}),(mX(i)||gX(i)||vX(i))&&r.replacements.push({oldElementId:i.id,newElementType:"bpmn:StartEvent"}),L6(i,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])&&T(e,"bpmn:SubProcess")&&r.replacements.push({oldElementId:i.id,newElementType:"bpmn:StartEvent"})),T(e,"bpmn:Transaction")||Ca(i,"bpmn:CancelEventDefinition")&&i.type!=="label"&&(T(i,"bpmn:EndEvent")&&qp(i,e)&&r.replacements.push({oldElementId:i.id,newElementType:"bpmn:EndEvent"}),T(i,"bpmn:BoundaryEvent")&&ug(i,e,null,n)&&r.replacements.push({oldElementId:i.id,newElementType:"bpmn:BoundaryEvent"}))}),r.replacements.length?r:!1}function F6(t,e){return Yc(t,sae)?!1:e?t.every(function(n){return qp(n,e)}):!0}function kC(t,e,n,r){return e?Wt(t)||fP(t)?!0:Yoe(n,e)||n&&jC(n,e)?!1:qp(t,e)||y0(t,e):!1}function z6(t,e){return T(t,"bpmn:SubProcess")?rn(t)&&(!e||e.width>=100&&e.height>=80):!!(T(t,"bpmn:Lane")||T(t,"bpmn:Participant")||CC(t)||fP(t))}function lae(t,e){var n=CC(t),r=CC(e);return(n||r)&&n!==r}function H6(t,e){return jC(e,t)||jC(t,e)?!1:lae(t,e)?!0:!!mP(t,e)}function U6(t,e){return I6(t,e)&&A6(t)&&T(e,"bpmn:Activity")&&!uae(e,t)&&!_i(e)}function V6(t,e){return zA(t)&&!zA(e)?!1:Qoe(t)&&Zoe(e)&&!Xoe(t,e)}function q6(t,e){return Joe(t)&&eae(e)&&I6(t,e)&&!(T(t,"bpmn:EventBasedGateway")&&!tae(e))}function mP(t,e){return Lt(t,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&Lt(e,["bpmn:Activity","bpmn:ThrowEvent"])?{type:"bpmn:DataInputAssociation"}:Lt(e,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&Lt(t,["bpmn:Activity","bpmn:CatchEvent"])?{type:"bpmn:DataOutputAssociation"}:!1}function y0(t,e,n){if(!e)return!1;if(Array.isArray(t)){if(t.length!==1)return!1;t=t[0]}return e.source===t||e.target===t?!1:Lt(e,["bpmn:SequenceFlow","bpmn:MessageFlow"])&&!Wt(e)&&T(t,"bpmn:FlowNode")&&!T(t,"bpmn:BoundaryEvent")&&qp(t,e.parent)}function cae(t,e){return t&&e&&t.indexOf(e)!==-1}function W6(t,e){return Wt(e)?!0:!(T(e,"bpmn:Lane")&&!cae(t,e.parent))}function zA(t){return Up(t,"bpmn:Process")||Up(t,"bpmn:Collaboration")}function uae(t,e){return t.attachers.includes(e)}const dae={__depends__:[Vo],__init__:["bpmnRules"],bpmnRules:["type",Zr]};var hae=2e3;function G6(t,e){t.on("saveXML.start",hae,n);function n(){var r=e.getRootElements();$(r,function(i){var s=yn(i),o,a;o=vv([i],!1),o=ht(o,function(l){return l!==i&&!l.labelTarget}),a=yr(o,yn),s.set("planeElement",a)})}}G6.$inject=["eventBus","canvas"];const pae={__init__:["bpmnDiOrdering"],bpmnDiOrdering:["type",G6]};function Vw(t){ye.call(this,t);var e=this;this.preExecute(["shape.create","connection.create"],function(n){var r=n.context,i=r.shape||r.connection,s=r.parent,o=e.getOrdering(i,s);o&&(o.parent!==void 0&&(r.parent=o.parent),r.parentIndex=o.index)}),this.preExecute(["shape.move","connection.move"],function(n){var r=n.context,i=r.shape||r.connection,s=r.newParent||i.parent,o=e.getOrdering(i,s);o&&(o.parent!==void 0&&(r.newParent=o.parent),r.newParentIndex=o.index)})}Vw.prototype.getOrdering=function(t,e){return null};Ce(Vw,ye);function gP(t,e){Vw.call(this,t);var n=[{type:"bpmn:SubProcess",order:{level:6}},{type:"bpmn:SequenceFlow",order:{level:9,containers:["bpmn:Participant","bpmn:FlowElementsContainer"]}},{type:"bpmn:DataAssociation",order:{level:9,containers:["bpmn:Collaboration","bpmn:FlowElementsContainer"]}},{type:"bpmn:TextAnnotation",order:{level:9}},{type:"bpmn:MessageFlow",order:{level:9,containers:["bpmn:Collaboration"]}},{type:"bpmn:Association",order:{level:6,containers:["bpmn:Participant","bpmn:FlowElementsContainer","bpmn:Collaboration"]}},{type:"bpmn:BoundaryEvent",order:{level:8}},{type:"bpmn:Group",order:{level:10,containers:["bpmn:Collaboration","bpmn:FlowElementsContainer"]}},{type:"bpmn:FlowElement",order:{level:5}},{type:"bpmn:Participant",order:{level:-2}},{type:"bpmn:Lane",order:{level:-1}}];function r(o){if(o.labelTarget)return{level:10};var a=Tt(n,function(l){return Lt(o,[l.type])});return a&&a.order||{level:1}}function i(o){var a=o.order;if(a||(o.order=a=r(o)),!a)throw new Error(`no order for <${o.id}>`);return a}function s(o,a,l){for(var c=a;c&&!Lt(c,l);)c=c.parent;if(!c)throw new Error(`no parent for <${o.id}> in <${a&&a.id}>`);return c}this.getOrdering=function(o,a){if(o.labelTarget||T(o,"bpmn:TextAnnotation"))return{parent:e.findRoot(a)||e.getRootElement(),index:-1};var l=i(o);l.containers&&(a=s(o,a,l.containers));var c=a.children.indexOf(o),d=yX(a.children,function(h){return!o.labelTarget&&h.labelTarget?!1:l.level<i(h).level});return d!==-1&&c!==-1&&c<d&&(d-=1),{index:d,parent:a}}}gP.$inject=["eventBus","canvas"];Ce(gP,Vw);const fae={__init__:["bpmnOrderingProvider"],bpmnOrderingProvider:["type",gP]};function Tv(){}Tv.prototype.get=function(){return this._data};Tv.prototype.set=function(t){this._data=t};Tv.prototype.clear=function(){var t=this._data;return delete this._data,t};Tv.prototype.isEmpty=function(){return!this._data};const mae={clipboard:["type",Tv]};var gae="drop-ok",HA="drop-not-ok",UA="attach-ok",VA="new-parent",qA="create",vae=2e3;function K6(t,e,n,r,i){function s(l,c,d,h,p){if(!c)return!1;l=ht(l,function(x){var y=x.labelTarget;return!x.parent&&!(Wt(x)&&l.indexOf(y)!==-1)});var f=Tt(l,function(x){return!En(x)}),m=!1,g=!1,v=!1;GA(l)&&(m=i.allowed("shape.attach",{position:d,shape:f,target:c})),m||(GA(l)?v=i.allowed("shape.create",{position:d,shape:f,source:h,target:c}):v=i.allowed("elements.create",{elements:l,position:d,target:c}));var b=p.connectionTarget;return v||m?(f&&h&&(g=i.allowed("connection.create",{source:b===h?f:h,target:b===h?h:f,hints:{targetParent:c,targetAttach:m}})),{attach:m,connect:g}):v===null||m===null?null:!1}function o(l,c){[UA,gae,HA,VA].forEach(function(d){d===c?t.addMarker(l,d):t.removeMarker(l,d)})}n.on(["create.move","create.hover"],function(l){var c=l.context,d=c.elements,h=l.hover,p=c.source,f=c.hints||{};if(!h){c.canExecute=!1,c.target=null;return}WA(l);var m={x:l.x,y:l.y},g=c.canExecute=h&&s(d,h,m,p,f);h&&g!==null&&(c.target=h,g&&g.attach?o(h,UA):o(h,g?VA:HA))}),n.on(["create.end","create.out","create.cleanup"],function(l){var c=l.hover;c&&o(c,null)}),n.on("create.end",function(l){var c=l.context,d=c.source,h=c.shape,p=c.elements,f=c.target,m=c.canExecute,g=m&&m.attach,v=m&&m.connect,b=c.hints||{};if(m===!1||!f)return!1;WA(l);var x={x:l.x,y:l.y};v?h=r.appendShape(d,h,x,f,{attach:g,connection:v===!0?{}:v,connectionTarget:b.connectionTarget}):(p=r.createElements(p,x,f,B({},b,{attach:g})),h=Tt(p,function(y){return!En(y)})),B(c,{elements:p,shape:h}),B(l,{elements:p,shape:h})});function a(){var l=e.context();l&&l.prefix===qA&&e.cancel()}n.on("create.init",function(){n.on("elements.changed",a),n.once(["create.cancel","create.end"],vae,function(){n.off("elements.changed",a)})}),this.start=function(l,c,d){ke(c)||(c=[c]);var h=Tt(c,function(m){return!En(m)});if(h){d=B({elements:c,hints:{},shape:h},d||{}),$(c,function(m){Oe(m.x)||(m.x=0),Oe(m.y)||(m.y=0)});var p=ht(c,function(m){return!m.hidden}),f=Di(p);$(c,function(m){En(m)&&(m.waypoints=yr(m.waypoints,function(g){return{x:g.x-f.x-f.width/2,y:g.y-f.y-f.height/2}})),B(m,{x:m.x-f.x-f.width/2,y:m.y-f.y-f.height/2})}),e.init(l,qA,{cursor:"grabbing",autoActivate:!0,data:{shape:h,elements:c,context:d}})}}}K6.$inject=["canvas","dragging","eventBus","modeling","rules"];function WA(t){var e=t.context,n=e.createConstraints;n&&(n.left&&(t.x=Math.max(t.x,n.left)),n.right&&(t.x=Math.min(t.x,n.right)),n.top&&(t.y=Math.max(t.y,n.top)),n.bottom&&(t.y=Math.min(t.y,n.bottom)))}function GA(t){return t&&t.length===1&&!En(t[0])}var yae=750;function Y6(t,e,n,r,i){function s(o){var a=ee("g");K(a,i.cls("djs-drag-group",["no-events"]));var l=ee("g");return o.forEach(function(c){var d;c.hidden||(c.waypoints?(d=n._createContainer("connection",l),n.drawConnection(cp(d),c)):(d=n._createContainer("shape",l),n.drawShape(cp(d),c),wi(d,c.x,c.y)),r.addDragger(c,a,d))}),a}e.on("create.move",yae,function(o){var a=o.hover,l=o.context,c=l.elements,d=l.dragGroup;d||(d=l.dragGroup=s(c));var h;a?(d.parentNode||(h=t.getActiveLayer(),re(h,d)),wi(d,o.x,o.y)):un(d)}),e.on("create.cleanup",function(o){var a=o.context,l=a.dragGroup;l&&un(l)})}Y6.$inject=["canvas","eventBus","graphicsFactory","previewSupport","styles"];const qw={__depends__:[Rl,Nf,Vo,Ma],__init__:["create","createPreview"],create:["type",K6],createPreview:["type",Y6]};function vP(t){var e=this;this._lastMoveEvent=null;function n(r){e._lastMoveEvent=r}t.on("canvas.init",function(r){var i=e._svg=r.svg;i.addEventListener("mousemove",n)}),t.on("canvas.destroy",function(){e._lastMouseEvent=null,e._svg.removeEventListener("mousemove",n)})}vP.$inject=["eventBus"];vP.prototype.getLastMoveEvent=function(){return this._lastMoveEvent||xae(0,0)};function xae(t,e){var n=document.createEvent("MouseEvent"),r=t,i=e,s=t,o=e;return n.initMouseEvent&&n.initMouseEvent("mousemove",!0,!0,window,0,r,i,s,o,!1,!1,!1,!1,0,null),n}const Nv={__init__:["mouse"],mouse:["type",vP]};function qo(t,e,n,r,i,s,o,a){this._canvas=t,this._create=e,this._clipboard=n,this._elementFactory=r,this._eventBus=i,this._modeling=s,this._mouse=o,this._rules=a,i.on("copyPaste.copyElement",function(l){var c=l.descriptor,d=l.element,h=l.elements;c.priority=1,c.id=d.id;var p=Tt(h,function(f){return f===d.parent});p&&(c.parent=d.parent.id),bae(d)&&(c.priority=2,c.host=d.host.id),En(d)&&(c.priority=3,c.source=d.source.id,c.target=d.target.id,c.waypoints=wae(d)),Wt(d)&&(c.priority=4,c.labelTarget=d.labelTarget.id),$(["x","y","width","height"],function(f){Oe(d[f])&&(c[f]=d[f])}),c.hidden=d.hidden,c.collapsed=d.collapsed}),i.on("copyPaste.pasteElements",function(l){var c=l.hints;B(c,{createElementsBehavior:!1})})}qo.$inject=["canvas","create","clipboard","elementFactory","eventBus","modeling","mouse","rules"];qo.prototype.copy=function(t){var e,n;return ke(t)||(t=t?[t]:[]),e=this._eventBus.fire("copyPaste.canCopyElements",{elements:t}),e===!1?n={}:n=this.createTree(ke(e)?e:t),this._clipboard.set(n),this._eventBus.fire("copyPaste.elementsCopied",{elements:t,tree:n}),n};qo.prototype.paste=function(t){var e=this._clipboard.get();if(!this._clipboard.isEmpty()){var n=t&&t.hints||{};this._eventBus.fire("copyPaste.pasteElements",{hints:n});var r=this._createElements(e);if(t&&t.element&&t.point)return this._paste(r,t.element,t.point,n);this._create.start(this._mouse.getLastMoveEvent(),r,{hints:n||{}})}};qo.prototype._paste=function(t,e,n,r){$(t,function(s){Oe(s.x)||(s.x=0),Oe(s.y)||(s.y=0)});var i=Di(t);return $(t,function(s){En(s)&&(s.waypoints=yr(s.waypoints,function(o){return{x:o.x-i.x-i.width/2,y:o.y-i.y-i.height/2}})),B(s,{x:s.x-i.x-i.width/2,y:s.y-i.y-i.height/2})}),this._modeling.createElements(t,n,e,B({},r))};qo.prototype._createElements=function(t){var e=this,n=this._eventBus,r={},i=[];return $(t,function(s,o){s=Ei(s,"priority"),$(s,function(a){var l=B({},oo(a,["priority"]));r[a.parent]?l.parent=r[a.parent]:delete l.parent,n.fire("copyPaste.pasteElement",{cache:r,descriptor:l});var c;if(En(l)){l.source=r[a.source],l.target=r[a.target],c=r[a.id]=e.createConnection(l),i.push(c);return}if(Wt(l)){l.labelTarget=r[l.labelTarget],c=r[a.id]=e.createLabel(l),i.push(c);return}l.host&&(l.host=r[l.host]),c=r[a.id]=e.createShape(l),i.push(c)})}),i};qo.prototype.createConnection=function(t){var e=this._elementFactory.createConnection(oo(t,["id"]));return e};qo.prototype.createLabel=function(t){var e=this._elementFactory.createLabel(oo(t,["id"]));return e};qo.prototype.createShape=function(t){var e=this._elementFactory.createShape(oo(t,["id"]));return e};qo.prototype.hasRelations=function(t,e){var n,r,i;return!(En(t)&&(r=Tt(e,Cs({id:t.source.id})),i=Tt(e,Cs({id:t.target.id})),!r||!i)||Wt(t)&&(n=Tt(e,Cs({id:t.labelTarget.id})),!n))};qo.prototype.createTree=function(t){var e=this._rules,n=this,r={},i=[],s=hw(t);function o(c,d){return e.allowed("element.copy",{element:c,elements:d})}function a(c,d){var h=Tt(i,function(p){return c===p.element});if(!h){i.push({element:c,depth:d});return}h.depth<d&&(i=l(h,i),i.push({element:h.element,depth:d}))}function l(c,d){var h=d.indexOf(c);return h!==-1&&d.splice(h,1),d}return mw(s,function(c,d,h){if(Wt(c))return;$(c.labels,function(m){a(m,h)});function p(m){m&&m.length&&$(m,function(g){$(g.labels,function(v){a(v,h)}),a(g,h)})}$([c.attachers,c.incoming,c.outgoing],p),a(c,h);var f=[];return c.children&&(f=c.children.slice()),n._eventBus.fire("copyPaste.createTree",{element:c,children:f}),f}),t=yr(i,function(c){return c.element}),i=yr(i,function(c){return c.descriptor={},n._eventBus.fire("copyPaste.copyElement",{descriptor:c.descriptor,element:c.element,elements:t}),c}),i=Ei(i,function(c){return c.descriptor.priority}),t=yr(i,function(c){return c.element}),$(i,function(c){var d=c.depth;if(!n.hasRelations(c.element,t)){YA(c.element,t);return}if(!o(c.element,t)){YA(c.element,t);return}r[d]||(r[d]=[]),r[d].push(c.descriptor)}),r};function bae(t){return!!t.host}function wae(t){return yr(t.waypoints,function(e){return e=KA(e),e.original&&(e.original=KA(e.original)),e})}function KA(t){return B({},t)}function YA(t,e){var n=e.indexOf(t);return n===-1?e:e.splice(n,1)}const _ae={__depends__:[mae,qw,Nv,Vo],__init__:["copyPaste"],copyPaste:["type",qo]};function cE(t,e,n){ke(n)||(n=[n]),$(n,function(r){Pk(t[r])||(e[r]=t[r])})}var uE=750;function X6(t,e,n){function r(l,c){var d=t.create(l.$type);return n.copyElement(l,d,null,c)}e.on("copyPaste.copyElement",uE,function(l){var c=l.descriptor,d=l.element,h=Me(d);if(Wt(d))return c;var p=c.businessObject=r(h,!0),f=c.di=r(yn(d),!0);f.bpmnElement=p,cE(p,c,"name"),cE(f,c,"isExpanded"),h.default&&(c.default=h.default.id)});var i="-bpmn-js-refs";function s(l){return l[i]=l[i]||{}}function o(l,c){l[i]=c}function a(l,c,d){var h=Me(l);return l.default&&(d[l.default]={element:h,property:"default"}),l.host&&(Me(l).attachedToRef=Me(c[l.host])),oo(d,xr(d,function(p,f,m){var g=f.element,v=f.property;return m===l.id&&(g.set(v,h),p.push(l.id)),p},[]))}e.on("copyPaste.pasteElement",function(l){var c=l.cache,d=l.descriptor,h=d.businessObject,p=d.di;if(Wt(d)){d.businessObject=Me(c[d.labelTarget]),d.di=yn(c[d.labelTarget]);return}h=d.businessObject=r(h),p=d.di=r(p),p.bpmnElement=h,cE(d,h,["isExpanded","name"]),d.type=h.$type}),e.on("copyPaste.copyElement",uE,function(l){var c=l.descriptor,d=l.element;if(T(d,"bpmn:Participant")){var h=Me(d);h.processRef&&(c.processRef=r(h.processRef,!0))}}),e.on("copyPaste.pasteElement",function(l){var c=l.descriptor,d=c.processRef;d&&(c.processRef=r(d))}),e.on("copyPaste.pasteElement",uE,function(l){var c=l.cache,d=l.descriptor;o(c,a(d,c,s(c)))})}X6.$inject=["bpmnFactory","eventBus","moddleCopy"];const Eae=["artifacts","dataInputAssociations","dataOutputAssociations","default","flowElements","lanes","incoming","outgoing","categoryValue"],Sae=["errorRef","escalationRef","messageRef","signalRef","dataObjectRef"];function Ov(t,e,n){this._bpmnFactory=e,this._eventBus=t,this._moddle=n,t.on("moddleCopy.canCopyProperties",r=>{const{propertyNames:i}=r;if(!(!i||!i.length))return Ei(i,s=>s==="extensionElements")}),t.on("moddleCopy.canCopyProperty",r=>{const{parent:i,property:s,propertyName:o}=r,a=Wn(i)&&i.$descriptor;if(o&&Sae.includes(o))return s;if(o&&Eae.includes(o)||o&&a&&!Tt(a.properties,Cs({name:o})))return!1}),t.on("moddleCopy.canSetCopiedProperty",r=>{const{property:i}=r;if(T(i,"bpmn:ExtensionElements")&&(!i.values||!i.values.length))return!1})}Ov.$inject=["eventBus","bpmnFactory","moddle"];Ov.prototype.copyElement=function(t,e,n,r=!1){n&&!ke(n)&&(n=[n]),n=n||PC(t.$descriptor);const i=this._eventBus.fire("moddleCopy.canCopyProperties",{propertyNames:n,sourceElement:t,targetElement:e,clone:r});return i===!1||(ke(i)&&(n=i),$(n,s=>{let o;Do(t,s)&&(o=t.get(s));const a=this.copyProperty(o,e,s,r);!an(a)||this._eventBus.fire("moddleCopy.canSetCopiedProperty",{parent:e,property:a,propertyName:s})===!1||e.set(s,a)})),e};Ov.prototype.copyProperty=function(t,e,n,r=!1){let i=this._eventBus.fire("moddleCopy.canCopyProperty",{parent:e,property:t,propertyName:n,clone:r});if(i===!1)return;if(i)return Wn(i)&&i.$type&&!i.$parent&&(i.$parent=e),i;const s=this._moddle.getPropertyDescriptor(e,n);if(!s.isReference)return s.isId?t&&this._copyId(t,e,r):ke(t)?xr(t,(o,a)=>{const l=this.copyProperty(a,e,n,r);return l?o.concat(l):o},[]):Wn(t)&&t.$type?this._moddle.getElementDescriptor(t).isGeneric?void 0:(i=this._bpmnFactory.create(t.$type),i.$parent=e,i=this.copyElement(t,i,null,r),i):t};Ov.prototype._copyId=function(t,e,n=!1){if(n)return t;if(!this._moddle.ids.assigned(t))return this._moddle.ids.claim(t,e),t};function PC(t,e){return xr(t.properties,(n,r)=>e&&r.default?n:n.concat(r.name),[])}const Q6={__depends__:[_ae],__init__:["bpmnCopyPaste","moddleCopy"],bpmnCopyPaste:["type",X6],moddleCopy:["type",Ov]};var XA=Math.round;function yP(t,e){this._modeling=t,this._eventBus=e}yP.$inject=["modeling","eventBus"];yP.prototype.replaceElement=function(t,e,n){if(t.waypoints)return null;var r=this._modeling,i=this._eventBus;i.fire("replace.start",{element:t,attrs:e,hints:n});var s=e.width||t.width,o=e.height||t.height,a=e.x||t.x,l=e.y||t.y,c=XA(a+s/2),d=XA(l+o/2),h=r.replaceShape(t,B({},e,{x:c,y:d,width:s,height:o}),n);return i.fire("replace.end",{element:t,newElement:h,hints:n}),h};function Z6(t,e){e.on("replace.end",500,function(n){const{newElement:r,hints:i={}}=n;i.select!==!1&&t.select(r)})}Z6.$inject=["selection","eventBus"];const Cae={__init__:["replace","replaceSelectionBehavior"],replaceSelectionBehavior:["type",Z6],replace:["type",yP]};function jae(t,e,n){ke(n)||(n=[n]),$(n,function(r){Pk(t[r])||(e[r]=t[r])})}var kae=["cancelActivity","instantiate","eventGatewayType","triggeredByEvent","isInterrupting"];function Pae(t,e){var n=t&&Do(t,"collapsed")?t.collapsed:!rn(t),r;return e&&(Do(e,"collapsed")||Do(e,"isExpanded"))?r=Do(e,"collapsed")?e.collapsed:!e.isExpanded:r=n,n!==r}function J6(t,e,n,r,i,s){function o(a,l,c){c=c||{};var d=l.type,h=a.businessObject;if(Qy(h)&&(d==="bpmn:SubProcess"||d==="bpmn:AdHocSubProcess")&&Pae(a,l))return r.toggleCollapse(a),a;var p=t.create(d),f={type:d,businessObject:p};f.di={},d==="bpmn:ExclusiveGateway"&&(f.di.isMarkerVisible=!0),jae(a.di,f.di,["fill","stroke","background-color","border-color","color"]);var m=PC(h.$descriptor),g=PC(p.$descriptor,!0),v=Tae(m,g);B(p,ui(l,kae));var b=ht(v,function(w){return w==="eventDefinitions"?QA(a,l.eventDefinitionType):w==="loopCharacteristics"?!_i(p):Do(p,w)||w==="processRef"&&l.isExpanded===!1||w==="triggeredByEvent"?!1:w==="isForCompensation"?!_i(p):!0});if(p=n.copyElement(h,p,b),l.eventDefinitionType&&(QA(p,l.eventDefinitionType)||(f.eventDefinitionType=l.eventDefinitionType,f.eventDefinitionAttrs=l.eventDefinitionAttrs)),T(h,"bpmn:Activity")){if(Qy(h))f.isExpanded=rn(a);else if(l&&Do(l,"isExpanded")){f.isExpanded=l.isExpanded;var x=e.getDefaultSize(p,{isExpanded:f.isExpanded});f.width=x.width,f.height=x.height,f.x=a.x-(f.width-a.width)/2,f.y=a.y-(f.height-a.height)/2}rn(a)&&!T(h,"bpmn:Task")&&f.isExpanded&&(f.width=a.width,f.height=a.height)}if(Qy(h)&&!Qy(p)&&(c.moveChildren=!1),T(h,"bpmn:Participant")){l.isExpanded===!0?p.processRef=t.create("bpmn:Process"):c.moveChildren=!1;var y=Yr(a);yn(a).isHorizontal||(yn(f).isHorizontal=y),f.width=y?a.width:e.getDefaultSize(f).width,f.height=y?e.getDefaultSize(f).height:a.height}return s.allowed("shape.resize",{shape:p})||(f.height=e.getDefaultSize(f).height,f.width=e.getDefaultSize(f).width),p.name=h.name,Lt(h,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&Lt(p,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&(p.default=h.default),l.host&&!T(h,"bpmn:BoundaryEvent")&&T(p,"bpmn:BoundaryEvent")&&(f.host=l.host),(f.type==="bpmn:DataStoreReference"||f.type==="bpmn:DataObjectReference")&&(f.x=a.x+(a.width-f.width)/2),i.replaceElement(a,f,{...c,targetElement:l})}this.replaceElement=o}J6.$inject=["bpmnFactory","elementFactory","moddleCopy","modeling","replace","rules"];function Qy(t){return T(t,"bpmn:SubProcess")}function QA(t,e){var n=Me(t);return e&&n.get("eventDefinitions").some(function(r){return T(r,e)})}function Tae(t,e){return t.filter(function(n){return e.includes(n)})}const ez={__depends__:[Q6,Cae,Ma],bpmnReplace:["type",J6]};var Nae=250;function Wd(t){this._eventBus=t,this._tools=[],this._active=null}Wd.$inject=["eventBus"];Wd.prototype.registerTool=function(t,e){var n=this._tools;if(!e)throw new Error(`A tool has to be registered with it's "events"`);n.push(t),this.bindEvents(t,e)};Wd.prototype.isActive=function(t){return t&&this._active===t};Wd.prototype.length=function(t){return this._tools.length};Wd.prototype.setActive=function(t){var e=this._eventBus;this._active!==t&&(this._active=t,e.fire("tool-manager.update",{tool:t}))};Wd.prototype.bindEvents=function(t,e){var n=this._eventBus,r=[];n.on(e.tool+".init",function(i){var s=i.context;if(!s.reactivate&&this.isActive(t)){this.setActive(null);return}this.setActive(t)},this),$(e,function(i){r.push(i+".ended"),r.push(i+".canceled")}),n.on(r,Nae,function(i){this._active&&(Oae(i)||this.setActive(null))},this)};function Oae(t){var e=t.originalEvent&&t.originalEvent.target;return e&&ur(e,'.group[data-group="tools"]')}const Ww={__depends__:[Rl],__init__:["toolManager"],toolManager:["type",Wd]};function Rae(t,e){if(t==="x"){if(e>0)return"e";if(e<0)return"w"}if(t==="y"){if(e>0)return"s";if(e<0)return"n"}return null}function Aae(t,e){var n=[];return $(t.concat(e),function(r){var i=r.incoming,s=r.outgoing;$(i.concat(s),function(o){var a=o.source,l=o.target;(_m(t,a)||_m(t,l)||_m(e,a)||_m(e,l))&&(_m(n,o)||n.push(o))})}),n}function _m(t,e){return t.indexOf(e)!==-1}function Iae(t,e,n){var r=t.x,i=t.y,s=t.width,o=t.height,a=n.x,l=n.y;switch(e){case"n":return{x:r,y:i+l,width:s,height:o-l};case"s":return{x:r,y:i,width:s,height:o+l};case"w":return{x:r+a,y:i,width:s-a,height:o};case"e":return{x:r,y:i,width:s+a,height:o};default:throw new Error("unknown direction: "+e)}}var dE=Math.abs,Dae=Math.round,rl={x:"width",y:"height"},tz="crosshair",ac={n:"top",w:"left",s:"bottom",e:"right"},$ae=1500,Zy={n:"s",w:"e",s:"n",e:"w"},Jy=20;function uo(t,e,n,r,i,s,o){this._canvas=t,this._dragging=e,this._eventBus=n,this._modeling=r,this._rules=i,this._toolManager=s,this._mouse=o;var a=this;s.registerTool("space",{tool:"spaceTool.selection",dragging:"spaceTool"}),n.on("spaceTool.selection.end",function(l){n.once("spaceTool.selection.ended",function(){a.activateMakeSpace(l.originalEvent)})}),n.on("spaceTool.move",$ae,function(l){var c=l.context,d=c.initialized;d||(d=c.initialized=a.init(l,c)),d&&JA(l)}),n.on("spaceTool.end",function(l){var c=l.context,d=c.axis,h=c.direction,p=c.movingShapes,f=c.resizingShapes,m=c.start;if(c.initialized){JA(l);var g={x:0,y:0};g[d]=Dae(l["d"+d]),a.makeSpace(p,f,g,h,m),n.once("spaceTool.ended",function(v){a.activateSelection(v.originalEvent,!0,!0)})}})}uo.$inject=["canvas","dragging","eventBus","modeling","rules","toolManager","mouse"];uo.prototype.activateSelection=function(t,e,n){this._dragging.init(t,"spaceTool.selection",{autoActivate:e,cursor:tz,data:{context:{reactivate:n}},trapClick:!1})};uo.prototype.activateMakeSpace=function(t){this._dragging.init(t,"spaceTool",{autoActivate:!0,cursor:tz,data:{context:{}}})};uo.prototype.makeSpace=function(t,e,n,r,i){return this._modeling.createSpace(t,e,n,r,i)};uo.prototype.init=function(t,e){var n=dE(t.dx)>dE(t.dy)?"x":"y",r=t["d"+n],i=t[n]-r;if(dE(r)<5)return!1;r<0&&(r*=-1),Pg(t)&&(r*=-1);var s=Rae(n,r),o=this._canvas.getRootElement();!$S(t)&&t.hover&&(o=t.hover);var a=[...vv(o,!0),...o.attachers||[]],l=this.calculateAdjustments(a,n,r,i),c=this._eventBus.fire("spaceTool.getMinDimensions",{axis:n,direction:s,shapes:l.resizingShapes,start:i}),d=Mae(l,n,s,i,c);return B(e,l,{axis:n,direction:s,spaceToolConstraints:d,start:i}),jw("resize-"+(n==="x"?"ew":"ns")),!0};uo.prototype.calculateAdjustments=function(t,e,n,r){var i=this._rules,s=[],o=[],a=[],l=[];function c(p){s.includes(p)||s.push(p);var f=p.label;f&&!s.includes(f)&&s.push(f)}function d(p){o.includes(p)||o.push(p)}$(t,function(p){if(!(!p.parent||Wt(p))){if(En(p)){l.push(p);return}var f=p[e],m=f+p[rl[e]];if(Lae(p)&&(n>0&&xt(p)[e]>r||n<0&&xt(p)[e]<r)){a.push(p);return}if(n>0&&f>r||n<0&&m<r){c(p);return}if(f<r&&m>r&&i.allowed("shape.resize",{shape:p})){d(p);return}}}),$(s,function(p){var f=p.attachers;f&&$(f,function(m){c(m)})});var h=s.concat(o);return $(a,function(p){var f=p.host;sd(h,f)&&c(p)}),h=s.concat(o),$(l,function(p){var f=p.source,m=p.target,g=p.label;sd(h,f)&&sd(h,m)&&g&&c(g)}),{movingShapes:s,resizingShapes:o}};uo.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateSelection(t,!!t)};uo.prototype.isActive=function(){var t=this._dragging.context();return t?/^spaceTool/.test(t.prefix):!1};function ZA(t){return{top:t.top-Jy,right:t.right+Jy,bottom:t.bottom+Jy,left:t.left-Jy}}function JA(t){var e=t.context,n=e.spaceToolConstraints;if(n){var r,i;Oe(n.left)&&(r=Math.max(t.x,n.left),t.dx=t.dx+r-t.x,t.x=r),Oe(n.right)&&(r=Math.min(t.x,n.right),t.dx=t.dx+r-t.x,t.x=r),Oe(n.top)&&(i=Math.max(t.y,n.top),t.dy=t.dy+i-t.y,t.y=i),Oe(n.bottom)&&(i=Math.min(t.y,n.bottom),t.dy=t.dy+i-t.y,t.y=i)}}function Mae(t,e,n,r,i){var s=t.movingShapes,o=t.resizingShapes;if(o.length){var a={},l,c;return $(o,function(d){var h=d.attachers,p=d.children,f=dt(d),m=ht(p,function(R){return!En(R)&&!Wt(R)&&!sd(s,R)&&!sd(o,R)}),g=ht(p,function(R){return!En(R)&&!Wt(R)&&sd(s,R)}),v,b,x,y=[],w=[],E,S,j,C;m.length&&(b=ZA(dt(Di(m))),v=r-f[ac[n]]+b[ac[n]],n==="n"?a.bottom=c=Oe(c)?Math.min(c,v):v:n==="w"?a.right=c=Oe(c)?Math.min(c,v):v:n==="s"?a.top=l=Oe(l)?Math.max(l,v):v:n==="e"&&(a.left=l=Oe(l)?Math.max(l,v):v)),g.length&&(x=ZA(dt(Di(g))),v=r-x[ac[Zy[n]]]+f[ac[Zy[n]]],n==="n"?a.bottom=c=Oe(c)?Math.min(c,v):v:n==="w"?a.right=c=Oe(c)?Math.min(c,v):v:n==="s"?a.top=l=Oe(l)?Math.max(l,v):v:n==="e"&&(a.left=l=Oe(l)?Math.max(l,v):v)),h&&h.length&&(h.forEach(function(R){sd(s,R)?y.push(R):w.push(R)}),y.length&&(E=dt(Di(y.map(xt))),S=f[ac[Zy[n]]]-(E[ac[Zy[n]]]-r)),w.length&&(j=dt(Di(w.map(xt))),C=j[ac[n]]-(f[ac[n]]-r)),n==="n"?(v=Math.min(S||1/0,C||1/0),a.bottom=c=Oe(c)?Math.min(c,v):v):n==="w"?(v=Math.min(S||1/0,C||1/0),a.right=c=Oe(c)?Math.min(c,v):v):n==="s"?(v=Math.max(S||-1/0,C||-1/0),a.top=l=Oe(l)?Math.max(l,v):v):n==="e"&&(v=Math.max(S||-1/0,C||-1/0),a.left=l=Oe(l)?Math.max(l,v):v));var P=i&&i[d.id];P&&(n==="n"?(v=r+d[rl[e]]-P[rl[e]],a.bottom=c=Oe(c)?Math.min(c,v):v):n==="w"?(v=r+d[rl[e]]-P[rl[e]],a.right=c=Oe(c)?Math.min(c,v):v):n==="s"?(v=r-d[rl[e]]+P[rl[e]],a.top=l=Oe(l)?Math.max(l,v):v):n==="e"&&(v=r-d[rl[e]]+P[rl[e]],a.left=l=Oe(l)?Math.max(l,v):v))}),a}}function sd(t,e){return t.indexOf(e)!==-1}function Lae(t){return!!t.host}var hE="djs-dragging",eI="djs-resizing",Bae=250,ex=Math.max;function nz(t,e,n,r,i){function s(o,a){$(o,function(l){i.addDragger(l,a),n.addMarker(l,hE)})}t.on("spaceTool.selection.start",function(o){var a=n.getLayer("space"),l=o.context,c={x:"M 0,-10000 L 0,10000",y:"M -10000,0 L 10000,0"},d=ee("g");K(d,r.cls("djs-crosshair-group",["no-events"])),re(a,d);var h=ee("path");K(h,"d",c.x),Ge(h).add("djs-crosshair"),re(d,h);var p=ee("path");K(p,"d",c.y),Ge(p).add("djs-crosshair"),re(d,p),l.crosshairGroup=d}),t.on("spaceTool.selection.move",function(o){var a=o.context.crosshairGroup;wi(a,o.x,o.y)}),t.on("spaceTool.selection.cleanup",function(o){var a=o.context,l=a.crosshairGroup;l&&un(l)}),t.on("spaceTool.move",Bae,function(o){var a=o.context,l=a.line,c=a.axis,d=a.movingShapes,h=a.resizingShapes;if(a.initialized){if(!a.dragGroup){var p=n.getLayer("space");l=ee("path"),K(l,"d","M0,0 L0,0"),Ge(l).add("djs-crosshair"),re(p,l),a.line=l;var f=ee("g");K(f,r.cls("djs-drag-group",["no-events"])),re(n.getActiveLayer(),f),s(d,f);var m=a.movingConnections=e.filter(function(w){var E=!1;$(d,function(P){$(P.outgoing,function(R){w===R&&(E=!0)})});var S=!1;$(d,function(P){$(P.incoming,function(R){w===R&&(S=!0)})});var j=!1;$(h,function(P){$(P.outgoing,function(R){w===R&&(j=!0)})});var C=!1;return $(h,function(P){$(P.incoming,function(R){w===R&&(C=!0)})}),En(w)&&(E||j)&&(S||C)});s(m,f),a.dragGroup=f}if(!a.frameGroup){var g=ee("g");K(g,r.cls("djs-frame-group",["no-events"])),re(n.getActiveLayer(),g);var v=[];$(h,function(w){var E=i.addFrame(w,g),S=E.getBBox();v.push({element:E,initialBounds:S}),n.addMarker(w,eI)}),a.frameGroup=g,a.frames=v}var b={x:"M"+o.x+", -10000 L"+o.x+", 10000",y:"M -10000, "+o.y+" L 10000, "+o.y};K(l,{d:b[c]});var x={x:"y",y:"x"},y={x:o.dx,y:o.dy};y[x[a.axis]]=0,wi(a.dragGroup,y.x,y.y),$(a.frames,function(w){var E=w.element,S=w.initialBounds,j,C;a.direction==="e"?K(E,{width:ex(S.width+y.x,5)}):(j=ex(S.width-y.x,5),K(E,{width:j,x:S.x+S.width-j})),a.direction==="s"?K(E,{height:ex(S.height+y.y,5)}):(C=ex(S.height-y.y,5),K(E,{height:C,y:S.y+S.height-C}))})}}),t.on("spaceTool.cleanup",function(o){var a=o.context,l=a.movingShapes,c=a.movingConnections,d=a.resizingShapes,h=a.line,p=a.dragGroup,f=a.frameGroup;$(l,function(m){n.removeMarker(m,hE)}),$(c,function(m){n.removeMarker(m,hE)}),p&&(un(h),un(p)),$(d,function(m){n.removeMarker(m,eI)}),f&&un(f)})}nz.$inject=["eventBus","elementRegistry","canvas","styles","previewSupport"];const Fae={__init__:["spaceToolPreview"],__depends__:[Rl,Vo,Ww,Nf,Nv],spaceTool:["type",uo],spaceToolPreview:["type",nz]};function Gw(t,e){t.invoke(uo,this),this._canvas=e}Gw.$inject=["injector","canvas"];Ce(Gw,uo);Gw.prototype.calculateAdjustments=function(t,e,n,r){var i=this._canvas.getRootElement(),s=t[0]===i?null:t[0],o=[];s&&(o=yf(WB(i.children.filter(c=>T(c,"bpmn:Artifact")),Di(s))));const a=[...t,...o];var l=uo.prototype.calculateAdjustments.call(this,a,e,n,r);return l.resizingShapes=l.resizingShapes.filter(function(c){return!(T(c,"bpmn:TextAnnotation")||zae(c)&&(e==="y"&&Yr(c)||e==="x"&&!Yr(c)))}),l};function zae(t){return T(t,"bpmn:Participant")&&!Me(t).processRef}const rz={__depends__:[Fae],spaceTool:["type",Gw]};function Kn(t,e){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[],trigger:null},this._injector=e,this._eventBus=t,this._uid=1,t.on(["diagram.destroy","diagram.clear"],function(){this.clear(!1)},this)}Kn.$inject=["eventBus","injector"];Kn.prototype.execute=function(t,e){if(!t)throw new Error("command required");this._currentExecution.trigger="execute";const n={command:t,context:e};this._pushAction(n),this._internalExecute(n),this._popAction()};Kn.prototype.canExecute=function(t,e){const n={command:t,context:e},r=this._getHandler(t);let i=this._fire(t,"canExecute",n);if(i===void 0){if(!r)return!1;r.canExecute&&(i=r.canExecute(e))}return i};Kn.prototype.clear=function(t){this._stack.length=0,this._stackIdx=-1,t!==!1&&this._fire("changed",{trigger:"clear"})};Kn.prototype.undo=function(){let t=this._getUndoAction(),e;if(t){for(this._currentExecution.trigger="undo",this._pushAction(t);t&&(this._internalUndo(t),e=this._getUndoAction(),!(!e||e.id!==t.id));)t=e;this._popAction()}};Kn.prototype.redo=function(){let t=this._getRedoAction(),e;if(t){for(this._currentExecution.trigger="redo",this._pushAction(t);t&&(this._internalExecute(t,!0),e=this._getRedoAction(),!(!e||e.id!==t.id));)t=e;this._popAction()}};Kn.prototype.register=function(t,e){this._setHandler(t,e)};Kn.prototype.registerHandler=function(t,e){if(!t||!e)throw new Error("command and handlerCls must be defined");const n=this._injector.instantiate(e);this.register(t,n)};Kn.prototype.canUndo=function(){return!!this._getUndoAction()};Kn.prototype.canRedo=function(){return!!this._getRedoAction()};Kn.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]};Kn.prototype._getUndoAction=function(){return this._stack[this._stackIdx]};Kn.prototype._internalUndo=function(t){const e=t.command,n=t.context,r=this._getHandler(e);this._atomicDo(()=>{this._fire(e,"revert",t),r.revert&&this._markDirty(r.revert(n)),this._revertedAction(t),this._fire(e,"reverted",t)})};Kn.prototype._fire=function(t,e,n){arguments.length<3&&(n=e,e=null);const r=e?[t+"."+e,e]:[t];let i;n=this._eventBus.createEvent(n);for(const s of r)if(i=this._eventBus.fire("commandStack."+s,n),n.cancelBubble)break;return i};Kn.prototype._createId=function(){return this._uid++};Kn.prototype._atomicDo=function(t){const e=this._currentExecution;e.atomic=!0;try{t()}finally{e.atomic=!1}};Kn.prototype._internalExecute=function(t,e){const n=t.command,r=t.context,i=this._getHandler(n);if(!i)throw new Error("no command handler registered for <"+n+">");this._pushAction(t),e||(this._fire(n,"preExecute",t),i.preExecute&&i.preExecute(r),this._fire(n,"preExecuted",t)),this._atomicDo(()=>{this._fire(n,"execute",t),i.execute&&this._markDirty(i.execute(r)),this._executedAction(t,e),this._fire(n,"executed",t)}),e||(this._fire(n,"postExecute",t),i.postExecute&&i.postExecute(r),this._fire(n,"postExecuted",t)),this._popAction()};Kn.prototype._pushAction=function(t){const e=this._currentExecution,n=e.actions,r=n[0];if(e.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+t.command+")");t.id||(t.id=r&&r.id||this._createId()),n.push(t)};Kn.prototype._popAction=function(){const t=this._currentExecution,e=t.trigger,n=t.actions,r=t.dirty;n.pop(),n.length||(this._eventBus.fire("elements.changed",{elements:Tk("id",r.reverse())}),r.length=0,this._fire("changed",{trigger:e}),t.trigger=null)};Kn.prototype._markDirty=function(t){const e=this._currentExecution;t&&(t=ke(t)?t:[t],e.dirty=e.dirty.concat(t))};Kn.prototype._executedAction=function(t,e){const n=++this._stackIdx;e||this._stack.splice(n,this._stack.length,t)};Kn.prototype._revertedAction=function(t){this._stackIdx--};Kn.prototype._getHandler=function(t){return this._handlerMap[t]};Kn.prototype._setHandler=function(t,e){if(!t||!e)throw new Error("command and handler required");if(this._handlerMap[t])throw new Error("overriding handler for command <"+t+">");this._handlerMap[t]=e};const iz={commandStack:["type",Kn]};function $c(t,e){if(typeof e!="function")throw new Error("removeFn iterator must be a function");if(t){for(var n;n=t[0];)e(n);return t}}var Hae=250,tI=1400;function xP(t,e,n){ye.call(this,e);var r=t.get("movePreview",!1);e.on("shape.move.start",tI,function(i){var s=i.context,o=s.shapes,a=s.validatedShapes;s.shapes=nI(o),s.validatedShapes=nI(a)}),r&&e.on("shape.move.start",Hae,function(i){var s=i.context,o=s.shapes,a=[];$(o,function(l){$(l.labels,function(c){!c.hidden&&s.shapes.indexOf(c)===-1&&a.push(c),l.labelTarget&&a.push(l)})}),$(a,function(l){r.makeDraggable(s,l,!0)})}),this.preExecuted("elements.move",tI,function(i){var s=i.context,o=s.closure,a=o.enclosedElements,l=[];$(a,function(c){$(c.labels,function(d){a[d.id]||l.push(d)})}),o.addAll(l)}),this.preExecute(["connection.delete","shape.delete"],function(i){var s=i.context,o=s.connection||s.shape;$c(o.labels,function(a){n.removeShape(a,{nested:!0})})}),this.execute("shape.delete",function(i){var s=i.context,o=s.shape,a=o.labelTarget;a&&(s.labelTargetIndex=Nk(a.labels,o),s.labelTarget=a,o.labelTarget=null)}),this.revert("shape.delete",function(i){var s=i.context,o=s.shape,a=s.labelTarget,l=s.labelTargetIndex;a&&(Or(a.labels,o,l),o.labelTarget=a)})}Ce(xP,ye);xP.$inject=["injector","eventBus","modeling"];function nI(t){return ht(t,function(e){return t.indexOf(e.labelTarget)===-1})}const Uae={__init__:["labelSupport"],labelSupport:["type",xP]};var Vae=251,rI=1401,iI="attach-ok";function bP(t,e,n,r,i){ye.call(this,e);var s=t.get("movePreview",!1);e.on("shape.move.start",rI,function(o){var a=o.context,l=a.shapes,c=a.validatedShapes;a.shapes=qae(l),a.validatedShapes=Wae(c)}),s&&e.on("shape.move.start",Vae,function(o){var a=o.context,l=a.shapes,c=TC(l);$(c,function(d){s.makeDraggable(a,d,!0),$(d.labels,function(h){s.makeDraggable(a,h,!0)})})}),s&&e.on("shape.move.start",function(o){var a=o.context,l=a.shapes;if(l.length===1){var c=l[0],d=c.host;d&&(n.addMarker(d,iI),e.once(["shape.move.out","shape.move.cleanup"],function(){n.removeMarker(d,iI)}))}}),this.preExecuted("elements.move",rI,function(o){var a=o.context,l=a.closure,c=a.shapes,d=TC(c);$(d,function(h){l.add(h,l.topLevel[h.host.id])})}),this.postExecuted("elements.move",function(o){var a=o.context,l=a.shapes,c=a.newHost,d;c&&l.length!==1||(c?d=l:d=ht(l,function(h){var p=h.host;return Gae(h)&&!Kae(l,p)}),$(d,function(h){i.updateAttachment(h,c)}))}),this.postExecuted("elements.move",function(o){var a=o.context.shapes;$(a,function(l){$(l.attachers,function(c){$(c.outgoing.slice(),function(d){var h=r.allowed("connection.reconnect",{connection:d,source:d.source,target:d.target});h||i.removeConnection(d)}),$(c.incoming.slice(),function(d){var h=r.allowed("connection.reconnect",{connection:d,source:d.source,target:d.target});h||i.removeConnection(d)})})})}),this.postExecute("shape.create",function(o){var a=o.context,l=a.shape,c=a.host;c&&i.updateAttachment(l,c)}),this.postExecute("shape.replace",function(o){var a=o.context,l=a.oldShape,c=a.newShape;$c(l.attachers,function(d){var h=r.allowed("elements.move",{target:c,shapes:[d]});h==="attach"?i.updateAttachment(d,c):i.removeShape(d)}),c.attachers.length&&$(c.attachers,function(d){var h=AA(d,l,c);i.moveShape(d,h,d.parent)})}),this.postExecute("shape.resize",function(o){var a=o.context,l=a.shape,c=a.oldBounds,d=a.newBounds,h=l.attachers,p=a.hints||{};p.attachSupport!==!1&&$(h,function(f){var m=AA(f,c,d);i.moveShape(f,m,f.parent),$(f.labels,function(g){i.moveShape(g,m,g.parent)})})}),this.preExecute("shape.delete",function(o){var a=o.context.shape;$c(a.attachers,function(l){i.removeShape(l)}),a.host&&i.updateAttachment(a,null)})}Ce(bP,ye);bP.$inject=["injector","eventBus","canvas","rules","modeling"];function TC(t){return Cg(yr(t,function(e){return e.attachers||[]}))}function qae(t){var e=TC(t);return xX("id",t,e)}function Wae(t){var e=Kc(t,"id");return ht(t,function(n){for(;n;){if(n.host&&e[n.host.id])return!1;n=n.parent}return!0})}function Gae(t){return!!t.host}function Kae(t,e){return t.indexOf(e)!==-1}const Yae={__depends__:[Vo],__init__:["attachSupport"],attachSupport:["type",bP]};function ho(t){this._model=t}ho.$inject=["moddle"];ho.prototype._needsId=function(t){return Lt(t,["bpmn:RootElement","bpmn:FlowElement","bpmn:MessageFlow","bpmn:DataAssociation","bpmn:Artifact","bpmn:Participant","bpmn:Lane","bpmn:LaneSet","bpmn:Process","bpmn:Collaboration","bpmndi:BPMNShape","bpmndi:BPMNEdge","bpmndi:BPMNDiagram","bpmndi:BPMNPlane","bpmn:Property","bpmn:CategoryValue"])};ho.prototype._ensureId=function(t){if(t.id){this._model.ids.claim(t.id,t);return}var e;T(t,"bpmn:Activity")?e="Activity":T(t,"bpmn:Event")?e="Event":T(t,"bpmn:Gateway")?e="Gateway":Lt(t,["bpmn:SequenceFlow","bpmn:MessageFlow"])?e="Flow":e=(t.$type||"").replace(/^[^:]*:/g,""),e+="_",!t.id&&this._needsId(t)&&(t.id=this._model.ids.nextPrefixed(e,t))};ho.prototype.create=function(t,e){var n=this._model.create(t,e||{});return this._ensureId(n),n};ho.prototype.createDiLabel=function(){return this.create("bpmndi:BPMNLabel",{bounds:this.createDiBounds()})};ho.prototype.createDiShape=function(t,e){return this.create("bpmndi:BPMNShape",B({bpmnElement:t,bounds:this.createDiBounds()},e))};ho.prototype.createDiBounds=function(t){return this.create("dc:Bounds",t)};ho.prototype.createDiWaypoints=function(t){var e=this;return yr(t,function(n){return e.createDiWaypoint(n)})};ho.prototype.createDiWaypoint=function(t){return this.create("dc:Point",ui(t,["x","y"]))};ho.prototype.createDiEdge=function(t,e){return this.create("bpmndi:BPMNEdge",B({bpmnElement:t,waypoint:this.createDiWaypoints([])},e))};ho.prototype.createDiPlane=function(t,e){return this.create("bpmndi:BPMNPlane",B({bpmnElement:t},e))};function cs(t,e,n){ye.call(this,t),this._bpmnFactory=e;var r=this;function i(f){var m=f.context,g=m.hints||{},v;!m.cropped&&g.createElementsBehavior!==!1&&(v=m.connection,v.waypoints=n.getCroppedWaypoints(v),m.cropped=!0)}this.executed(["connection.layout","connection.create"],i),this.reverted(["connection.layout"],function(f){delete f.context.cropped});function s(f){var m=f.context;r.updateParent(m.shape||m.connection,m.oldParent)}function o(f){var m=f.context,g=m.shape||m.connection,v=m.parent||m.newParent;r.updateParent(g,v)}this.executed(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],Ji(s)),this.reverted(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],Ji(o));function a(f){var m=f.context,g=m.oldRoot,v=g.children;$(v,function(b){T(b,"bpmn:BaseElement")&&r.updateParent(b)})}this.executed(["canvas.updateRoot"],a),this.reverted(["canvas.updateRoot"],a);function l(f){var m=f.context.shape;T(m,"bpmn:BaseElement")&&r.updateBounds(m)}this.executed(["shape.move","shape.create","shape.resize"],Ji(function(f){f.context.shape.type!=="label"&&l(f)})),this.reverted(["shape.move","shape.create","shape.resize"],Ji(function(f){f.context.shape.type!=="label"&&l(f)})),t.on("shape.changed",function(f){f.element.type==="label"&&l({context:{shape:f.element}})});function c(f){r.updateConnection(f.context)}this.executed(["connection.create","connection.move","connection.delete","connection.reconnect"],Ji(c)),this.reverted(["connection.create","connection.move","connection.delete","connection.reconnect"],Ji(c));function d(f){r.updateConnectionWaypoints(f.context.connection)}this.executed(["connection.layout","connection.move","connection.updateWaypoints"],Ji(d)),this.reverted(["connection.layout","connection.move","connection.updateWaypoints"],Ji(d)),this.executed("connection.reconnect",Ji(function(f){var m=f.context,g=m.connection,v=m.oldSource,b=m.newSource,x=Me(g),y=Me(v),w=Me(b);x.conditionExpression&&!Lt(w,["bpmn:Activity","bpmn:ExclusiveGateway","bpmn:InclusiveGateway"])&&(m.oldConditionExpression=x.conditionExpression,delete x.conditionExpression),v!==b&&y.default===x&&(m.oldDefault=y.default,delete y.default)})),this.reverted("connection.reconnect",Ji(function(f){var m=f.context,g=m.connection,v=m.oldSource,b=m.newSource,x=Me(g),y=Me(v),w=Me(b);m.oldConditionExpression&&(x.conditionExpression=m.oldConditionExpression),m.oldDefault&&(y.default=m.oldDefault,delete w.default)}));function h(f){r.updateAttachment(f.context)}this.executed(["element.updateAttachment"],Ji(h)),this.reverted(["element.updateAttachment"],Ji(h)),this.executed("element.updateLabel",Ji(p)),this.reverted("element.updateLabel",Ji(p));function p(f){const{element:m}=f.context,g=Td(m),v=yn(m),b=v&&v.get("label");Ap(m)||yb(m)||(g&&!b?v.set("label",e.create("bpmndi:BPMNLabel")):!g&&b&&v.set("label",void 0))}}Ce(cs,ye);cs.$inject=["eventBus","bpmnFactory","connectionDocking"];cs.prototype.updateAttachment=function(t){var e=t.shape,n=e.businessObject,r=e.host;n.attachedToRef=r&&r.businessObject};cs.prototype.updateParent=function(t,e){if(!Wt(t)&&!(T(t,"bpmn:DataStoreReference")&&t.parent&&T(t.parent,"bpmn:Collaboration"))){var n=t.parent,r=t.businessObject,i=yn(t),s=n&&n.businessObject,o=yn(n);T(t,"bpmn:FlowNode")&&this.updateFlowNodeRefs(r,s,e&&e.businessObject),T(t,"bpmn:DataOutputAssociation")&&(t.source?s=t.source.businessObject:s=null),T(t,"bpmn:DataInputAssociation")&&(t.target?s=t.target.businessObject:s=null),this.updateSemanticParent(r,s),T(t,"bpmn:DataObjectReference")&&r.dataObjectRef&&this.updateSemanticParent(r.dataObjectRef,s),this.updateDiParent(i,o)}};cs.prototype.updateBounds=function(t){var e=yn(t),n=Qae(t);if(n){var r=Bo(n,e.get("bounds"));B(n,{x:t.x+r.x,y:t.y+r.y})}var i=Wt(t)?this._getLabel(e):e,s=i.bounds;s||(s=this._bpmnFactory.createDiBounds(),i.set("bounds",s)),B(s,{x:t.x,y:t.y,width:t.width,height:t.height})};cs.prototype.updateFlowNodeRefs=function(t,e,n){if(n!==e){var r,i;T(n,"bpmn:Lane")&&(r=n.get("flowNodeRef"),vr(r,t)),T(e,"bpmn:Lane")&&(i=e.get("flowNodeRef"),Or(i,t))}};cs.prototype.updateDiConnection=function(t,e,n){var r=yn(t),i=yn(e),s=yn(n);r.sourceElement&&r.sourceElement.bpmnElement!==Me(e)&&(r.sourceElement=e&&i),r.targetElement&&r.targetElement.bpmnElement!==Me(n)&&(r.targetElement=n&&s)};cs.prototype.updateDiParent=function(t,e){if(e&&!T(e,"bpmndi:BPMNPlane")&&(e=e.$parent),t.$parent!==e){var n=(e||t.$parent).get("planeElement");e?(n.push(t),t.$parent=e):(vr(n,t),t.$parent=null)}};function Xae(t){for(;t&&!T(t,"bpmn:Definitions");)t=t.$parent;return t}cs.prototype.getLaneSet=function(t){var e,n;return T(t,"bpmn:Lane")?(e=t.childLaneSet,e||(e=this._bpmnFactory.create("bpmn:LaneSet"),t.childLaneSet=e,e.$parent=t),e):(T(t,"bpmn:Participant")&&(t=t.processRef),n=t.get("laneSets"),e=n[0],e||(e=this._bpmnFactory.create("bpmn:LaneSet"),e.$parent=t,n.push(e)),e)};cs.prototype.updateSemanticParent=function(t,e,n){var r;if(t.$parent!==e&&!((T(t,"bpmn:DataInput")||T(t,"bpmn:DataOutput"))&&(T(e,"bpmn:Participant")&&"processRef"in e&&(e=e.processRef),"ioSpecification"in e&&e.ioSpecification===t.$parent))){if(T(t,"bpmn:Lane"))e&&(e=this.getLaneSet(e)),r="lanes";else if(T(t,"bpmn:FlowElement")){if(e){if(T(e,"bpmn:Participant"))e=e.processRef;else if(T(e,"bpmn:Lane"))do e=e.$parent.$parent;while(T(e,"bpmn:Lane"))}r="flowElements"}else if(T(t,"bpmn:Artifact")){for(;e&&!T(e,"bpmn:Process")&&!T(e,"bpmn:SubProcess")&&!T(e,"bpmn:Collaboration");)if(T(e,"bpmn:Participant")){e=e.processRef;break}else e=e.$parent;r="artifacts"}else if(T(t,"bpmn:MessageFlow"))r="messageFlows";else if(T(t,"bpmn:Participant")){r="participants";var i=t.processRef,s;i&&(s=Xae(t.$parent||e),t.$parent&&(vr(s.get("rootElements"),i),i.$parent=null),e&&(Or(s.get("rootElements"),i),i.$parent=s))}else T(t,"bpmn:DataOutputAssociation")?r="dataOutputAssociations":T(t,"bpmn:DataInputAssociation")&&(r="dataInputAssociations");if(!r)throw new Error(`no parent for <${t.id}> in <${e.id}>`);var o;if(t.$parent&&(o=t.$parent.get(r),vr(o,t)),e?(o=e.get(r),o.push(t),t.$parent=e):t.$parent=null,n){var a=n.get(r);vr(o,t),e&&(a||(a=[],e.set(r,a)),a.push(t))}}};cs.prototype.updateConnectionWaypoints=function(t){var e=yn(t);e.set("waypoint",this._bpmnFactory.createDiWaypoints(t.waypoints))};cs.prototype.updateConnection=function(t){var e=t.connection,n=Me(e),r=e.source,i=Me(r),s=e.target,o=Me(e.target),a;if(T(n,"bpmn:DataAssociation"))T(n,"bpmn:DataInputAssociation")?(n.get("sourceRef")[0]=i,a=t.parent||t.newParent||o,this.updateSemanticParent(n,o,a)):T(n,"bpmn:DataOutputAssociation")&&(a=t.parent||t.newParent||i,this.updateSemanticParent(n,i,a),n.targetRef=o);else{var l=T(n,"bpmn:SequenceFlow");n.sourceRef!==i&&(l&&(vr(n.sourceRef&&n.sourceRef.get("outgoing"),n),i&&i.get("outgoing")&&i.get("outgoing").push(n)),n.sourceRef=i),n.targetRef!==o&&(l&&(vr(n.targetRef&&n.targetRef.get("incoming"),n),o&&o.get("incoming")&&o.get("incoming").push(n)),n.targetRef=o)}this.updateConnectionWaypoints(e),this.updateDiConnection(e,r,s)};cs.prototype._getLabel=function(t){return t.label||(t.label=this._bpmnFactory.createDiLabel()),t.label};function Ji(t){return function(e){var n=e.context,r=n.shape||n.connection||n.element;T(r,"bpmn:BaseElement")&&t(e)}}function Qae(t){if(T(t,"bpmn:Activity")){var e=yn(t);if(e){var n=e.get("label");if(n)return n.get("bounds")}}}function eu(t,e){Ok.call(this),this._bpmnFactory=t,this._moddle=e}Ce(eu,Ok);eu.$inject=["bpmnFactory","moddle"];eu.prototype._baseCreate=Ok.prototype.create;eu.prototype.create=function(t,e){if(t==="label"){var n=e.di||this._bpmnFactory.createDiLabel();return this._baseCreate(t,B({type:"label",di:n},bX,e))}return this.createElement(t,e)};eu.prototype.createElement=function(t,e){e=B({},e||{});var n,r=e.businessObject,i=e.di;if(!r){if(!e.type)throw new Error("no shape type specified");r=this._bpmnFactory.create(e.type),wX(r)}if(!Jae(i)){var s=B({},i||{},{id:r.id+"_di"});t==="root"?i=this._bpmnFactory.createDiPlane(r,s):t==="connection"?i=this._bpmnFactory.createDiEdge(r,s):i=this._bpmnFactory.createDiShape(r,s)}T(r,"bpmn:Group")&&(e=B({isFrame:!0},e)),e=Zae(r,e,["processRef","isInterrupting","associationDirection","isForCompensation"]),e.isExpanded&&(e=NC(i,e,"isExpanded")),Lt(r,["bpmn:Lane","bpmn:Participant"])&&(e=NC(i,e,"isHorizontal")),T(r,"bpmn:SubProcess")&&(e.collapsed=!rn(r,i)),T(r,"bpmn:ExclusiveGateway")&&(Do(i,"isMarkerVisible")?i.isMarkerVisible===void 0&&(i.isMarkerVisible=!1):i.isMarkerVisible=!0),an(e.triggeredByEvent)&&(r.triggeredByEvent=e.triggeredByEvent,delete e.triggeredByEvent),an(e.cancelActivity)&&(r.cancelActivity=e.cancelActivity,delete e.cancelActivity);var o,a;return e.eventDefinitionType&&(o=r.get("eventDefinitions")||[],a=this._bpmnFactory.create(e.eventDefinitionType,e.eventDefinitionAttrs),e.eventDefinitionType==="bpmn:ConditionalEventDefinition"&&(a.condition=this._bpmnFactory.create("bpmn:FormalExpression")),o.push(a),a.$parent=r,r.eventDefinitions=o,delete e.eventDefinitionType),n=this.getDefaultSize(r,i),e=B({id:r.id},n,e,{businessObject:r,di:i}),this._baseCreate(t,e)};eu.prototype.getDefaultSize=function(t,e){var n=Me(t);if(e=e||yn(t),T(n,"bpmn:SubProcess"))return rn(n,e)?{width:350,height:200}:{width:100,height:80};if(T(n,"bpmn:Task"))return{width:100,height:80};if(T(n,"bpmn:Gateway"))return{width:50,height:50};if(T(n,"bpmn:Event"))return{width:36,height:36};if(T(n,"bpmn:Participant")){var r=e.isHorizontal===void 0||e.isHorizontal===!0;return rn(n,e)?r?{width:600,height:250}:{width:250,height:600}:r?{width:400,height:60}:{width:60,height:400}}return T(n,"bpmn:Lane")?{width:400,height:100}:T(n,"bpmn:DataObjectReference")?{width:36,height:50}:T(n,"bpmn:DataStoreReference")?{width:50,height:50}:T(n,"bpmn:TextAnnotation")?{width:100,height:30}:T(n,"bpmn:Group")?{width:300,height:300}:{width:100,height:80}};eu.prototype.createParticipantShape=function(t){return Wn(t)||(t={isExpanded:t}),t=B({type:"bpmn:Participant"},t||{}),t.isExpanded!==!1&&(t.processRef=this._bpmnFactory.create("bpmn:Process")),this.createShape(t)};function Zae(t,e,n){return $(n,function(r){e=NC(t,e,r)}),e}function NC(t,e,n){return e[n]===void 0?e:(t[n]=e[n],oo(e,[n]))}function Jae(t){return Lt(t,["bpmndi:BPMNShape","bpmndi:BPMNEdge","bpmndi:BPMNDiagram","bpmndi:BPMNPlane"])}function Kw(t,e){this._modeling=t,this._canvas=e}Kw.$inject=["modeling","canvas"];Kw.prototype.preExecute=function(t){var e=this._modeling,n=t.elements,r=t.alignment;$(n,function(i){var s={x:0,y:0};an(r.left)?s.x=r.left-i.x:an(r.right)?s.x=r.right-i.width-i.x:an(r.center)?s.x=r.center-Math.round(i.width/2)-i.x:an(r.top)?s.y=r.top-i.y:an(r.bottom)?s.y=r.bottom-i.height-i.y:an(r.middle)&&(s.y=r.middle-Math.round(i.height/2)-i.y),e.moveElements([i],s,i.parent)})};Kw.prototype.postExecute=function(t){};function Yw(t){this._modeling=t}Yw.$inject=["modeling"];Yw.prototype.preExecute=function(t){var e=t.source;if(!e)throw new Error("source required");var n=t.target||e.parent,r=t.shape,i=t.hints||{};r=t.shape=this._modeling.createShape(r,t.position,n,{attach:i.attach}),t.shape=r};Yw.prototype.postExecute=function(t){var e=t.hints||{};ele(t.source,t.shape)||(e.connectionTarget===t.source?this._modeling.connect(t.shape,t.source,t.connection):this._modeling.connect(t.source,t.shape,t.connection))};function ele(t,e){return Yc(t.outgoing,function(n){return n.target===e})}function Xw(t,e){this._canvas=t,this._layouter=e}Xw.$inject=["canvas","layouter"];Xw.prototype.execute=function(t){var e=t.connection,n=t.source,r=t.target,i=t.parent,s=t.parentIndex,o=t.hints;if(!n||!r)throw new Error("source and target required");if(!i)throw new Error("parent required");return e.source=n,e.target=r,e.waypoints||(e.waypoints=this._layouter.layoutConnection(e,o)),this._canvas.addConnection(e,i,s),e};Xw.prototype.revert=function(t){var e=t.connection;return this._canvas.removeConnection(e),e.source=null,e.target=null,e};var tx=Math.round;function wP(t){this._modeling=t}wP.$inject=["modeling"];wP.prototype.preExecute=function(t){var e=t.elements,n=t.parent,r=t.parentIndex,i=t.position,s=t.hints,o=this._modeling;$(e,function(h){Oe(h.x)||(h.x=0),Oe(h.y)||(h.y=0)});var a=ht(e,function(h){return!h.hidden}),l=Di(a);$(e,function(h){En(h)&&(h.waypoints=yr(h.waypoints,function(p){return{x:tx(p.x-l.x-l.width/2+i.x),y:tx(p.y-l.y-l.height/2+i.y)}})),B(h,{x:tx(h.x-l.x-l.width/2+i.x),y:tx(h.y-l.y-l.height/2+i.y)})});var c=hw(e),d={};$(e,function(h){if(En(h)){d[h.id]=Oe(r)?o.createConnection(d[h.source.id],d[h.target.id],r,h,h.parent||n,s):o.createConnection(d[h.source.id],d[h.target.id],h,h.parent||n,s);return}var p=B({},s);c.indexOf(h)===-1&&(p.autoResize=!1),Wt(h)&&(p=oo(p,["attach"])),d[h.id]=Oe(r)?o.createShape(h,ui(h,["x","y","width","height"]),h.parent||n,r,p):o.createShape(h,ui(h,["x","y","width","height"]),h.parent||n,p)}),t.elements=yf(d)};var sI=Math.round;function tu(t){this._canvas=t}tu.$inject=["canvas"];tu.prototype.execute=function(t){var e=t.shape,n=t.position,r=t.parent,i=t.parentIndex;if(!r)throw new Error("parent required");if(!n)throw new Error("position required");return n.width!==void 0?B(e,n):B(e,{x:n.x-sI(e.width/2),y:n.y-sI(e.height/2)}),this._canvas.addShape(e,r,i),e};tu.prototype.revert=function(t){var e=t.shape;return this._canvas.removeShape(e),e};function Rv(t){tu.call(this,t)}Ce(Rv,tu);Rv.$inject=["canvas"];var tle=tu.prototype.execute;Rv.prototype.execute=function(t){var e=t.shape;return rle(e),e.labelTarget=t.labelTarget,tle.call(this,t)};var nle=tu.prototype.revert;Rv.prototype.revert=function(t){return t.shape.labelTarget=null,nle.call(this,t)};function rle(t){["width","height"].forEach(function(e){typeof t[e]>"u"&&(t[e]=0)})}function Av(t,e){this._canvas=t,this._modeling=e}Av.$inject=["canvas","modeling"];Av.prototype.preExecute=function(t){var e=this._modeling,n=t.connection;$c(n.incoming,function(r){e.removeConnection(r,{nested:!0})}),$c(n.outgoing,function(r){e.removeConnection(r,{nested:!0})})};Av.prototype.execute=function(t){var e=t.connection,n=e.parent;return t.parent=n,t.parentIndex=Nk(n.children,e),t.source=e.source,t.target=e.target,this._canvas.removeConnection(e),e.source=null,e.target=null,e};Av.prototype.revert=function(t){var e=t.connection,n=t.parent,r=t.parentIndex;return e.source=t.source,e.target=t.target,Or(n.children,e,r),this._canvas.addConnection(e,n),e};function _P(t,e){this._modeling=t,this._elementRegistry=e}_P.$inject=["modeling","elementRegistry"];_P.prototype.postExecute=function(t){var e=this._modeling,n=this._elementRegistry,r=t.elements;$(r,function(i){n.get(i.id)&&(i.waypoints?e.removeConnection(i):e.removeShape(i))})};function Iv(t,e){this._canvas=t,this._modeling=e}Iv.$inject=["canvas","modeling"];Iv.prototype.preExecute=function(t){var e=this._modeling,n=t.shape;$c(n.incoming,function(r){e.removeConnection(r,{nested:!0})}),$c(n.outgoing,function(r){e.removeConnection(r,{nested:!0})}),$c(n.children,function(r){En(r)?e.removeConnection(r,{nested:!0}):e.removeShape(r,{nested:!0})})};Iv.prototype.execute=function(t){var e=this._canvas,n=t.shape,r=n.parent;return t.oldParent=r,t.oldParentIndex=Nk(r.children,n),e.removeShape(n),n};Iv.prototype.revert=function(t){var e=this._canvas,n=t.shape,r=t.oldParent,i=t.oldParentIndex;return Or(r.children,n,i),e.addShape(n,r),n};function Qw(t){this._modeling=t}Qw.$inject=["modeling"];var oI={x:"y",y:"x"};Qw.prototype.preExecute=function(t){var e=this._modeling,n=t.groups,r=t.axis,i=t.dimension;function s(v,b){v.range.min=Math.min(b[r],v.range.min),v.range.max=Math.max(b[r]+b[i],v.range.max)}function o(v){return v[r]+v[i]/2}function a(v){return v.length-1}function l(v){return v.max-v.min}function c(v,b){var x={y:0};x[r]=v-o(b),x[r]&&(x[oI[r]]=0,e.moveElements([b],x,b.parent))}var d=n[0],h=a(n),p=n[h],f,m,g=0;$(n,function(v,b){var x,y,w;if(v.elements.length<2){b&&b!==n.length-1&&(s(v,v.elements[0]),g+=l(v.range));return}x=Ei(v.elements,r),y=x[0],b===h&&(y=x[a(x)]),w=o(y),v.range=null,$(x,function(E){if(c(w,E),v.range===null){v.range={min:E[r],max:E[r]+E[i]};return}s(v,E)}),b&&b!==n.length-1&&(g+=l(v.range))}),m=Math.abs(p.range.min-d.range.max),f=Math.round((m-g)/(n.length-1)),!(f<n.length-1)&&$(n,function(v,b){var x={},y;v===d||v===p||(y=n[b-1],v.range.max=0,$(v.elements,function(w,E){x[oI[r]]=0,x[r]=y.range.max-w[r]+f,v.range.min!==w[r]&&(x[r]+=w[r]-v.range.min),x[r]&&e.moveElements([w],x,w.parent),v.range.max=Math.max(w[r]+w[i],E?v.range.max:0)}))})};Qw.prototype.postExecute=function(t){};function Zw(t,e){this._layouter=t,this._canvas=e}Zw.$inject=["layouter","canvas"];Zw.prototype.execute=function(t){var e=t.connection,n=e.waypoints;return B(t,{oldWaypoints:n}),e.waypoints=this._layouter.layoutConnection(e,t.hints),e};Zw.prototype.revert=function(t){var e=t.connection;return e.waypoints=t.oldWaypoints,e};function EP(){}EP.prototype.execute=function(t){var e=t.connection,n=t.delta,r=t.newParent||e.parent,i=t.newParentIndex,s=e.parent;return t.oldParent=s,t.oldParentIndex=vr(s.children,e),Or(r.children,e,i),e.parent=r,$(e.waypoints,function(o){o.x+=n.x,o.y+=n.y,o.original&&(o.original.x+=n.x,o.original.y+=n.y)}),e};EP.prototype.revert=function(t){var e=t.connection,n=e.parent,r=t.oldParent,i=t.oldParentIndex,s=t.delta;return vr(n.children,e),Or(r.children,e,i),e.parent=r,$(e.waypoints,function(o){o.x-=s.x,o.y-=s.y,o.original&&(o.original.x-=s.x,o.original.y-=s.y)}),e};function SP(){this.allShapes={},this.allConnections={},this.enclosedElements={},this.enclosedConnections={},this.topLevel={}}SP.prototype.add=function(t,e){return this.addAll([t],e)};SP.prototype.addAll=function(t,e){var n=_X(t,!!e,this);return B(this,n),this};function Dv(t){this._modeling=t}Dv.prototype.moveRecursive=function(t,e,n){return t?this.moveClosure(this.getClosure(t),e,n):[]};Dv.prototype.moveClosure=function(t,e,n,r,i){var s=this._modeling,o=t.allShapes,a=t.allConnections,l=t.enclosedConnections,c=t.topLevel,d=!1;i&&i.parent===n&&(d=!0),$(o,function(h){s.moveShape(h,e,c[h.id]&&!d&&n,{recurse:!1,layout:!1})}),$(a,function(h){var p=!!o[h.source.id],f=!!o[h.target.id];l[h.id]&&p&&f?s.moveConnection(h,e,c[h.id]&&!d&&n):s.layoutConnection(h,{connectionStart:p&&K2(h,h.source,e),connectionEnd:f&&Y2(h,h.target,e)})})};Dv.prototype.getClosure=function(t){return new SP().addAll(t,!0)};function Jw(t){this._helper=new Dv(t)}Jw.$inject=["modeling"];Jw.prototype.preExecute=function(t){t.closure=this._helper.getClosure(t.shapes)};Jw.prototype.postExecute=function(t){var e=t.hints,n;e&&e.primaryShape&&(n=e.primaryShape,e.oldParent=n.parent),this._helper.moveClosure(t.closure,t.delta,t.newParent,t.newHost,n)};function Gd(t){this._modeling=t,this._helper=new Dv(t)}Gd.$inject=["modeling"];Gd.prototype.execute=function(t){var e=t.shape,n=t.delta,r=t.newParent||e.parent,i=t.newParentIndex,s=e.parent;return t.oldBounds=ui(e,["x","y","width","height"]),t.oldParent=s,t.oldParentIndex=vr(s.children,e),Or(r.children,e,i),B(e,{parent:r,x:e.x+n.x,y:e.y+n.y}),e};Gd.prototype.postExecute=function(t){var e=t.shape,n=t.delta,r=t.hints,i=this._modeling;r.layout!==!1&&($(e.incoming,function(s){i.layoutConnection(s,{connectionEnd:Y2(s,e,n)})}),$(e.outgoing,function(s){i.layoutConnection(s,{connectionStart:K2(s,e,n)})})),r.recurse!==!1&&this.moveChildren(t)};Gd.prototype.revert=function(t){var e=t.shape,n=t.oldParent,r=t.oldParentIndex,i=t.delta;return Or(n.children,e,r),B(e,{parent:n,x:e.x-i.x,y:e.y-i.y}),e};Gd.prototype.moveChildren=function(t){var e=t.delta,n=t.shape;this._helper.moveRecursive(n.children,e,null)};Gd.prototype.getNewParent=function(t){return t.newParent||t.shape.parent};function $v(t){this._modeling=t}$v.$inject=["modeling"];$v.prototype.execute=function(t){var e=t.newSource,n=t.newTarget,r=t.connection,i=t.dockingOrPoints;if(!e&&!n)throw new Error("newSource or newTarget required");return ke(i)&&(t.oldWaypoints=r.waypoints,r.waypoints=i),e&&(t.oldSource=r.source,r.source=e),n&&(t.oldTarget=r.target,r.target=n),r};$v.prototype.postExecute=function(t){var e=t.connection,n=t.newSource,r=t.newTarget,i=t.dockingOrPoints,s=t.hints||{},o={};s.connectionStart&&(o.connectionStart=s.connectionStart),s.connectionEnd&&(o.connectionEnd=s.connectionEnd),s.layoutConnection!==!1&&(n&&(!r||s.docking==="source")&&(o.connectionStart=o.connectionStart||aI(ke(i)?i[0]:i)),r&&(!n||s.docking==="target")&&(o.connectionEnd=o.connectionEnd||aI(ke(i)?i[i.length-1]:i)),s.newWaypoints&&(o.waypoints=s.newWaypoints),this._modeling.layoutConnection(e,o))};$v.prototype.revert=function(t){var e=t.oldSource,n=t.oldTarget,r=t.oldWaypoints,i=t.connection;return e&&(i.source=e),n&&(i.target=n),r&&(i.waypoints=r),i};function aI(t){return t.original||t}function Il(t,e){this._modeling=t,this._rules=e}Il.$inject=["modeling","rules"];Il.prototype.preExecute=function(t){var e=this,n=this._modeling,r=this._rules,i=t.oldShape,s=t.newData,o=t.hints||{},a;function l(m,g,v){return r.allowed("connection.reconnect",{connection:v,source:m,target:g})}var c={x:s.x,y:s.y},d={x:i.x,y:i.y,width:i.width,height:i.height};a=t.newShape=t.newShape||e.createShape(s,c,i.parent,o),i.host&&n.updateAttachment(a,i.host);var h;o.moveChildren!==!1&&(h=i.children.slice(),n.moveElements(h,{x:0,y:0},a,o));var p=i.incoming.slice(),f=i.outgoing.slice();$(p,function(m){var g=m.source,v=l(g,a,m);v&&e.reconnectEnd(m,a,Fw(m,a,d),o)}),$(f,function(m){var g=m.target,v=l(a,g,m);v&&e.reconnectStart(m,a,Bw(m,a,d),o)})};Il.prototype.postExecute=function(t){var e=t.oldShape;this._modeling.removeShape(e)};Il.prototype.execute=function(t){};Il.prototype.revert=function(t){};Il.prototype.createShape=function(t,e,n,r){return this._modeling.createShape(t,e,n,r)};Il.prototype.reconnectStart=function(t,e,n,r){this._modeling.reconnectStart(t,e,n,r)};Il.prototype.reconnectEnd=function(t,e,n,r){this._modeling.reconnectEnd(t,e,n,r)};function Mv(t){this._modeling=t}Mv.$inject=["modeling"];Mv.prototype.execute=function(t){var e=t.shape,n=t.newBounds,r=t.minBounds;if(n.x===void 0||n.y===void 0||n.width===void 0||n.height===void 0)throw new Error("newBounds must have {x, y, width, height} properties");if(r&&(n.width<r.width||n.height<r.height))throw new Error("width and height cannot be less than minimum height and width");if(!r&&n.width<10||n.height<10)throw new Error("width and height cannot be less than 10px");return t.oldBounds={width:e.width,height:e.height,x:e.x,y:e.y},B(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e};Mv.prototype.postExecute=function(t){var e=this._modeling,n=t.shape,r=t.oldBounds,i=t.hints||{};i.layout!==!1&&($(n.incoming,function(s){e.layoutConnection(s,{connectionEnd:Fw(s,n,r)})}),$(n.outgoing,function(s){e.layoutConnection(s,{connectionStart:Bw(s,n,r)})}))};Mv.prototype.revert=function(t){var e=t.shape,n=t.oldBounds;return B(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e};function nu(t){this._modeling=t}nu.$inject=["modeling"];nu.prototype.preExecute=function(t){var e=t.delta,n=t.direction,r=t.movingShapes,i=t.resizingShapes,s=t.start,o={};this.moveShapes(r,e),$(i,function(a){o[a.id]=sle(a)}),this.resizeShapes(i,e,n),this.updateConnectionWaypoints(Aae(r,i),e,n,s,r,i,o)};nu.prototype.execute=function(){};nu.prototype.revert=function(){};nu.prototype.moveShapes=function(t,e){var n=this;$(t,function(r){n._modeling.moveShape(r,e,null,{autoResize:!1,layout:!1,recurse:!1})})};nu.prototype.resizeShapes=function(t,e,n){var r=this;$(t,function(i){var s=Iae(i,n,e);r._modeling.resizeShape(i,s,null,{attachSupport:!1,autoResize:!1,layout:!1})})};nu.prototype.updateConnectionWaypoints=function(t,e,n,r,i,s,o){var a=this,l=i.concat(s);$(t,function(c){var d=c.source,h=c.target,p=ile(c),f=sz(n),m={};lc(l,d)&&lc(l,h)?(p=yr(p,function(g){return cI(g,r,n)&&(g[f]=g[f]+e[f]),g.original&&cI(g.original,r,n)&&(g.original[f]=g.original[f]+e[f]),g}),a._modeling.updateWaypoints(c,p,{labelBehavior:!1})):(lc(l,d)||lc(l,h))&&(lc(i,d)?m.connectionStart=K2(c,d,e):lc(i,h)?m.connectionEnd=Y2(c,h,e):lc(s,d)?m.connectionStart=Bw(c,d,o[d.id]):lc(s,h)&&(m.connectionEnd=Fw(c,h,o[h.id])),a._modeling.layoutConnection(c,m))})};function lI(t){return B({},t)}function ile(t){return yr(t.waypoints,function(e){return e=lI(e),e.original&&(e.original=lI(e.original)),e})}function sz(t){switch(t){case"n":return"y";case"w":return"x";case"s":return"y";case"e":return"x"}}function cI(t,e,n){var r=sz(n);if(/e|s/.test(n))return t[r]>e;if(/n|w/.test(n))return t[r]<e}function lc(t,e){return t.indexOf(e)!==-1}function sle(t){return{x:t.x,y:t.y,height:t.height,width:t.width}}function e_(t){this._modeling=t}e_.$inject=["modeling"];e_.prototype.execute=function(t){var e=t.shape,n=e.children;t.oldChildrenVisibility=oz(n),e.collapsed=!e.collapsed;var r=az(n,e.collapsed);return[e].concat(r)};e_.prototype.revert=function(t){var e=t.shape,n=t.oldChildrenVisibility,r=e.children,i=lz(r,n);return e.collapsed=!e.collapsed,[e].concat(i)};function oz(t){var e={};return $(t,function(n){e[n.id]=n.hidden,n.children&&(e=B({},e,oz(n.children)))}),e}function az(t,e){var n=[];return $(t,function(r){r.hidden=e,n=n.concat(r),r.children&&(n=n.concat(az(r.children,r.collapsed||e)))}),n}function lz(t,e){var n=[];return $(t,function(r){r.hidden=e[r.id],n=n.concat(r),r.children&&(n=n.concat(lz(r.children,e)))}),n}function t_(t){this._modeling=t}t_.$inject=["modeling"];t_.prototype.execute=function(t){var e=t.shape,n=t.newHost,r=e.host;return t.oldHost=r,t.attacherIdx=cz(r,e),uz(n,e),e.host=n,e};t_.prototype.revert=function(t){var e=t.shape,n=t.newHost,r=t.oldHost,i=t.attacherIdx;return e.host=r,cz(n,e),uz(r,e,i),e};function cz(t,e){return vr(t&&t.attachers,e)}function uz(t,e,n){if(t){var r=t.attachers;r||(t.attachers=r=[]),Or(r,e,n)}}function CP(){}CP.prototype.execute=function(t){var e=t.connection,n=t.newWaypoints;return t.oldWaypoints=e.waypoints,e.waypoints=n,e};CP.prototype.revert=function(t){var e=t.connection,n=t.oldWaypoints;return e.waypoints=n,e};function xn(t,e,n){this._eventBus=t,this._elementFactory=e,this._commandStack=n;var r=this;t.on("diagram.init",function(){r.registerHandlers(n)})}xn.$inject=["eventBus","elementFactory","commandStack"];xn.prototype.getHandlers=function(){return{"shape.append":Yw,"shape.create":tu,"shape.delete":Iv,"shape.move":Gd,"shape.resize":Mv,"shape.replace":Il,"shape.toggleCollapse":e_,spaceTool:nu,"label.create":Rv,"connection.create":Xw,"connection.delete":Av,"connection.move":EP,"connection.layout":Zw,"connection.updateWaypoints":CP,"connection.reconnect":$v,"elements.create":wP,"elements.move":Jw,"elements.delete":_P,"elements.distribute":Qw,"elements.align":Kw,"element.updateAttachment":t_}};xn.prototype.registerHandlers=function(t){$(this.getHandlers(),function(e,n){t.registerHandler(n,e)})};xn.prototype.moveShape=function(t,e,n,r,i){typeof r=="object"&&(i=r,r=null);var s={shape:t,delta:e,newParent:n,newParentIndex:r,hints:i||{}};this._commandStack.execute("shape.move",s)};xn.prototype.updateAttachment=function(t,e){var n={shape:t,newHost:e};this._commandStack.execute("element.updateAttachment",n)};xn.prototype.moveElements=function(t,e,n,r){r=r||{};var i=r.attach,s=n,o;i===!0?(o=n,s=n.parent):i===!1&&(o=null);var a={shapes:t,delta:e,newParent:s,newHost:o,hints:r};this._commandStack.execute("elements.move",a)};xn.prototype.moveConnection=function(t,e,n,r,i){typeof r=="object"&&(i=r,r=void 0);var s={connection:t,delta:e,newParent:n,newParentIndex:r,hints:i||{}};this._commandStack.execute("connection.move",s)};xn.prototype.layoutConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.layout",n)};xn.prototype.createConnection=function(t,e,n,r,i,s){typeof n=="object"&&(s=i,i=r,r=n,n=void 0),r=this._create("connection",r);var o={source:t,target:e,parent:i,parentIndex:n,connection:r,hints:s};return this._commandStack.execute("connection.create",o),o.connection};xn.prototype.createShape=function(t,e,n,r,i){typeof r!="number"&&(i=r,r=void 0),i=i||{};var s=i.attach,o,a;t=this._create("shape",t),s?(o=n.parent,a=n):o=n;var l={position:e,shape:t,parent:o,parentIndex:r,host:a,hints:i};return this._commandStack.execute("shape.create",l),l.shape};xn.prototype.createElements=function(t,e,n,r,i){ke(t)||(t=[t]),typeof r!="number"&&(i=r,r=void 0),i=i||{};var s={position:e,elements:t,parent:n,parentIndex:r,hints:i};return this._commandStack.execute("elements.create",s),s.elements};xn.prototype.createLabel=function(t,e,n,r){n=this._create("label",n);var i={labelTarget:t,position:e,parent:r||t.parent,shape:n};return this._commandStack.execute("label.create",i),i.shape};xn.prototype.appendShape=function(t,e,n,r,i){i=i||{},e=this._create("shape",e);var s={source:t,position:n,target:r,shape:e,connection:i.connection,connectionParent:i.connectionParent,hints:i};return this._commandStack.execute("shape.append",s),s.shape};xn.prototype.removeElements=function(t){var e={elements:t};this._commandStack.execute("elements.delete",e)};xn.prototype.distributeElements=function(t,e,n){var r={groups:t,axis:e,dimension:n};this._commandStack.execute("elements.distribute",r)};xn.prototype.removeShape=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.delete",n)};xn.prototype.removeConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.delete",n)};xn.prototype.replaceShape=function(t,e,n){var r={oldShape:t,newData:e,hints:n||{}};return this._commandStack.execute("shape.replace",r),r.newShape};xn.prototype.alignElements=function(t,e){var n={elements:t,alignment:e};this._commandStack.execute("elements.align",n)};xn.prototype.resizeShape=function(t,e,n,r){var i={shape:t,newBounds:e,minBounds:n,hints:r};this._commandStack.execute("shape.resize",i)};xn.prototype.createSpace=function(t,e,n,r,i){var s={delta:n,direction:r,movingShapes:t,resizingShapes:e,start:i};this._commandStack.execute("spaceTool",s)};xn.prototype.updateWaypoints=function(t,e,n){var r={connection:t,newWaypoints:e,hints:n||{}};this._commandStack.execute("connection.updateWaypoints",r)};xn.prototype.reconnect=function(t,e,n,r,i){var s={connection:t,newSource:e,newTarget:n,dockingOrPoints:r,hints:i||{}};this._commandStack.execute("connection.reconnect",s)};xn.prototype.reconnectStart=function(t,e,n,r){r||(r={}),this.reconnect(t,e,t.target,n,B(r,{docking:"source"}))};xn.prototype.reconnectEnd=function(t,e,n,r){r||(r={}),this.reconnect(t,t.source,e,n,B(r,{docking:"target"}))};xn.prototype.connect=function(t,e,n,r){return this.createConnection(t,e,n||{},t.parent,r)};xn.prototype._create=function(t,e){return EX(e)?e:this._elementFactory.create(t,e)};xn.prototype.toggleCollapse=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.toggleCollapse",n)};function Lv(t){this._elementRegistry=t}Lv.$inject=["elementRegistry"];Lv.prototype.execute=function(t){var e=t.element,n=t.moddleElement,r=t.properties;if(!n)throw new Error("<moddleElement> required");var i=t.changed||this._getVisualReferences(n).concat(e),s=t.oldProperties||ole(n,Nd(r));return dz(n,r),t.oldProperties=s,t.changed=i,i};Lv.prototype.revert=function(t){var e=t.oldProperties,n=t.moddleElement,r=t.changed;return dz(n,e),r};Lv.prototype._getVisualReferences=function(t){var e=this._elementRegistry;return T(t,"bpmn:DataObject")?ale(t,e):[]};function ole(t,e){return xr(e,function(n,r){return n[r]=t.get(r),n},{})}function dz(t,e){$(e,function(n,r){t.set(r,n)})}function ale(t,e){return e.filter(function(n){return T(n,"bpmn:DataObjectReference")&&Me(n).dataObjectRef===t})}var Em="default",gl="id",hz="di",lle={width:0,height:0};function Bv(t,e,n,r){this._elementRegistry=t,this._moddle=e,this._modeling=n,this._textRenderer=r}Bv.$inject=["elementRegistry","moddle","modeling","textRenderer"];Bv.prototype.execute=function(t){var e=t.element,n=[e];if(!e)throw new Error("element required");var r=this._elementRegistry,i=this._moddle.ids,s=e.businessObject,o=ple(t.properties),a=t.oldProperties||cle(e,o);return pz(o,s)&&(i.unclaim(s[gl]),r.updateId(e,o[gl]),i.claim(o[gl],s)),Em in o&&(o[Em]&&n.push(r.get(o[Em].id)),s[Em]&&n.push(r.get(s[Em].id))),fz(e,o),t.oldProperties=a,t.changed=n,n};Bv.prototype.postExecute=function(t){var e=t.element,n=e.label,r=n&&Me(n).name;if(r){var i=this._textRenderer.getExternalLabelBounds(n,r);this._modeling.resizeShape(n,i,lle)}};Bv.prototype.revert=function(t){var e=t.element,n=t.properties,r=t.oldProperties,i=e.businessObject,s=this._elementRegistry,o=this._moddle.ids;return fz(e,r),pz(n,i)&&(o.unclaim(n[gl]),s.updateId(e,r[gl]),o.claim(r[gl],i)),t.changed};function pz(t,e){return gl in t&&t[gl]!==e[gl]}function cle(t,e){var n=Nd(e),r=t.businessObject,i=yn(t);return xr(n,function(s,o){return o!==hz?s[o]=r.get(o):s[o]=ule(i,Nd(e.di)),s},{})}function ule(t,e){return xr(e,function(n,r){return n[r]=t&&t.get(r),n},{})}function fz(t,e){var n=t.businessObject,r=yn(t);$(e,function(i,s){s!==hz?n.set(s,i):r&&dle(r,i)})}function dle(t,e){$(e,function(n,r){t.set(r,n)})}var hle=["default"];function ple(t){var e=B({},t);return hle.forEach(function(n){n in t&&(e[n]=Me(e[n]))}),e}function n_(t,e){this._canvas=t,this._modeling=e}n_.$inject=["canvas","modeling"];n_.prototype.execute=function(t){var e=this._canvas,n=t.newRoot,r=n.businessObject,i=e.getRootElement(),s=i.businessObject,o=s.$parent,a=yn(i);return e.setRootElement(n),e.removeRootElement(i),Or(o.rootElements,r),r.$parent=o,vr(o.rootElements,s),s.$parent=null,i.di=null,a.bpmnElement=r,n.di=a,t.oldRoot=i,[]};n_.prototype.revert=function(t){var e=this._canvas,n=t.newRoot,r=n.businessObject,i=t.oldRoot,s=i.businessObject,o=r.$parent,a=yn(n);return e.setRootElement(i),e.removeRootElement(n),vr(o.rootElements,r),r.$parent=null,Or(o.rootElements,s),s.$parent=o,n.di=null,a.bpmnElement=s,i.di=a,[]};function jP(t,e){this._modeling=t,this._spaceTool=e}jP.$inject=["modeling","spaceTool"];jP.prototype.preExecute=function(t){var e=this._spaceTool,n=this._modeling,r=t.shape,i=t.location,s=Gs(r),o=s===r,a=o?r:r.parent,l=Zc(a),c=Yr(r);if(c?i==="left"?i="top":i==="right"&&(i="bottom"):i==="top"?i="left":i==="bottom"&&(i="right"),!l.length){var d=c?{x:r.x+Vs,y:r.y,width:r.width-Vs,height:r.height}:{x:r.x,y:r.y+Vs,width:r.width,height:r.height-Vs};n.createShape({type:"bpmn:Lane",isHorizontal:c},d,a)}var h=[];mw(s,function(w){return h.push(w),w.label&&h.push(w.label),w===r?[]:ht(w.children,function(E){return E!==r})});var p,f,m,g,v;i==="top"?(p=-120,f=r.y,m=f+10,g="n",v="y"):i==="left"?(p=-120,f=r.x,m=f+10,g="w",v="x"):i==="bottom"?(p=120,f=r.y+r.height,m=f-10,g="s",v="y"):i==="right"&&(p=120,f=r.x+r.width,m=f-10,g="e",v="x");var b=e.calculateAdjustments(h,v,p,m),x=c?{x:0,y:p}:{x:p,y:0};e.makeSpace(b.movingShapes,b.resizingShapes,x,g,m);var y=c?{x:r.x+(o?Vs:0),y:f-(i==="top"?120:0),width:r.width-(o?Vs:0),height:120}:{x:f-(i==="left"?120:0),y:r.y+(o?Vs:0),width:120,height:r.height-(o?Vs:0)};t.newLane=n.createShape({type:"bpmn:Lane",isHorizontal:c},y,a)};function kP(t){this._modeling=t}kP.$inject=["modeling"];kP.prototype.preExecute=function(t){var e=this._modeling,n=t.shape,r=t.count,i=Zc(n),s=i.length;if(s>r)throw new Error(`more than <${r}> child lanes`);var o=Yr(n),a=o?n.height:n.width,l=Math.round(a/r),c,d,h,p;for(p=0;p<r;p++)p===r-1?c=a-l*p:c=l,d=o?{x:n.x+Vs,y:n.y+p*l,width:n.width-Vs,height:c}:{x:n.x+p*l,y:n.y+Vs,width:c,height:n.height-Vs},p<s?e.resizeShape(i[p],d):(h={type:"bpmn:Lane",isHorizontal:o},e.createShape(h,d,n))};function Fv(t,e){this._modeling=t,this._spaceTool=e}Fv.$inject=["modeling","spaceTool"];Fv.prototype.preExecute=function(t){var e=t.shape,n=t.newBounds,r=t.balanced;r!==!1?this.resizeBalanced(e,n):this.resizeSpace(e,n)};Fv.prototype.resizeBalanced=function(t,e){var n=this._modeling,r=Hse(t,e);n.resizeShape(t,e),r.forEach(function(i){n.resizeShape(i.shape,i.newBounds)})};Fv.prototype.resizeSpace=function(t,e){var n=this._spaceTool,r=dt(t),i=dt(e),s=p6(i,r),o=Gs(t),a=[],l=[];mw(o,function(m){return a.push(m),(T(m,"bpmn:Lane")||T(m,"bpmn:Participant"))&&l.push(m),m.children});var c,d,h,p,f;(s.bottom||s.top)&&(c=s.bottom||s.top,d=t.y+(s.bottom?t.height:0)+(s.bottom?-10:10),h=s.bottom?"s":"n",p=s.top>0||s.bottom<0?-c:c,f=n.calculateAdjustments(a,"y",p,d),n.makeSpace(f.movingShapes,f.resizingShapes,{x:0,y:c},h)),(s.left||s.right)&&(c=s.right||s.left,d=t.x+(s.right?t.width:0)+(s.right?-10:100),h=s.right?"e":"w",p=s.left>0||s.right<0?-c:c,f=n.calculateAdjustments(l,"x",p,d),n.makeSpace(f.movingShapes,f.resizingShapes,{x:c,y:0},h))};var Hg="flowNodeRef",PP="lanes";function zv(t){this._elementRegistry=t}zv.$inject=["elementRegistry"];zv.prototype._computeUpdates=function(t,e){var n=[],r=[],i={},s=[];function o(d,h){var p=dt(h),f={x:d.x+d.width/2,y:d.y+d.height/2};return f.x>p.left&&f.x<p.right&&f.y>p.top&&f.y<p.bottom}function a(d){n.indexOf(d)===-1&&(s.push(d),n.push(d))}function l(d){var h=Gs(d);return i[h.id]||(i[h.id]=Mw(h)),i[h.id]}function c(d){if(!d.parent)return[];var h=l(d);return h.filter(function(p){return o(d,p)}).map(function(p){return p.businessObject})}return e.forEach(function(d){var h=Gs(d);if(!(!h||n.indexOf(h)!==-1)){var p=h.children.filter(function(f){return T(f,"bpmn:FlowNode")});p.forEach(a),n.push(h)}}),t.forEach(a),s.forEach(function(d){var h=d.businessObject,p=h.get(PP),f=p.slice(),m=c(d);r.push({flowNode:h,remove:f,add:m})}),e.forEach(function(d){var h=d.businessObject;d.parent||h.get(Hg).forEach(function(p){r.push({flowNode:p,remove:[h],add:[]})})}),r};zv.prototype.execute=function(t){var e=t.updates;return e||(e=t.updates=this._computeUpdates(t.flowNodeShapes,t.laneShapes)),e.forEach(function(n){var r=n.flowNode,i=r.get(PP);n.remove.forEach(function(s){vr(i,s),vr(s.get(Hg),r)}),n.add.forEach(function(s){Or(i,s),Or(s.get(Hg),r)})}),[]};zv.prototype.revert=function(t){var e=t.updates;return e.forEach(function(n){var r=n.flowNode,i=r.get(PP);n.add.forEach(function(s){vr(i,s),vr(s.get(Hg),r)}),n.remove.forEach(function(s){Or(i,s),Or(s.get(Hg),r)})}),[]};function r_(t){this._moddle=t}r_.$inject=["moddle"];r_.prototype.execute=function(t){var e=this._moddle.ids,n=t.id,r=t.element,i=t.claiming;return i?e.claim(n,r):e.unclaim(n),[]};r_.prototype.revert=function(t){var e=this._moddle.ids,n=t.id,r=t.element,i=t.claiming;return i?e.unclaim(n):e.claim(n,r),[]};var fle={fill:void 0,stroke:void 0};function TP(t){this._commandStack=t,this._normalizeColor=function(e){if(e){if(Fi(e)){var n=mle(e);if(n)return n}throw new Error(`invalid color value: ${e}`)}}}TP.$inject=["commandStack"];TP.prototype.postExecute=function(t){var e=t.elements,n=t.colors||fle,r=this,i={};"fill"in n&&B(i,{"background-color":this._normalizeColor(n.fill)}),"stroke"in n&&B(i,{"border-color":this._normalizeColor(n.stroke)}),$(e,function(s){var o=En(s)?ui(i,["border-color"]):i,a=yn(s);if(gle(o),Wt(s))r._commandStack.execute("element.updateModdleProperties",{element:s,moddleElement:a.label,properties:{color:i["border-color"]}});else{if(!Lt(a,["bpmndi:BPMNEdge","bpmndi:BPMNShape"]))return;r._commandStack.execute("element.updateProperties",{element:s,properties:{di:o}})}})};function mle(t){var e=document.createElement("canvas").getContext("2d");return e.fillStyle="transparent",e.fillStyle=t,/^#[0-9a-fA-F]{6}$/.test(e.fillStyle)?e.fillStyle:null}function gle(t){"border-color"in t&&(t.stroke=t["border-color"]),"background-color"in t&&(t.fill=t["background-color"])}var vle={width:0,height:0};function mz(t,e,n){function r(l,c){var d=l.label||l,h=l.labelTarget||l;return SX(d,c),[d,h]}function i(l){var c=l.element,d=c.businessObject,h=l.newLabel;if(!Wt(c)&&Ap(c)&&!fw(c)&&!uI(h)){var p=7,f=GB(c);f={x:f.x,y:f.y+p},t.createLabel(c,f,{id:d.id+"_label",businessObject:d,di:c.di})}}function s(l){return l.oldLabel=Td(l.element),r(l.element,l.newLabel)}function o(l){return r(l.element,l.oldLabel)}function a(l){var c=l.element,d=c.label||c,h=l.newLabel,p=l.newBounds,f=l.hints||{};if(!(!Wt(d)&&!T(d,"bpmn:TextAnnotation"))){if(Wt(d)&&uI(h)){f.removeShape!==!1&&t.removeShape(d,{unsetLabel:!1});return}var m=Td(c);typeof p>"u"&&(p=e.getExternalLabelBounds(d,m)),p&&t.resizeShape(d,p,vle)}}this.preExecute=i,this.execute=s,this.revert=o,this.postExecute=a}mz.$inject=["modeling","textRenderer","bpmnFactory"];function uI(t){return!t||!t.trim()}function di(t,e,n,r){xn.call(this,t,e,n),this._bpmnRules=r}Ce(di,xn);di.$inject=["eventBus","elementFactory","commandStack","bpmnRules"];di.prototype.getHandlers=function(){var t=xn.prototype.getHandlers.call(this);return t["element.updateModdleProperties"]=Lv,t["element.updateProperties"]=Bv,t["canvas.updateRoot"]=n_,t["lane.add"]=jP,t["lane.resize"]=Fv,t["lane.split"]=kP,t["lane.updateRefs"]=zv,t["id.updateClaim"]=r_,t["element.setColor"]=TP,t["element.updateLabel"]=mz,t};di.prototype.updateLabel=function(t,e,n,r){this._commandStack.execute("element.updateLabel",{element:t,newLabel:e,newBounds:n,hints:r||{}})};di.prototype.connect=function(t,e,n,r){var i=this._bpmnRules;if(n||(n=i.canConnect(t,e)),!!n)return this.createConnection(t,e,n,t.parent,r)};di.prototype.updateModdleProperties=function(t,e,n){this._commandStack.execute("element.updateModdleProperties",{element:t,moddleElement:e,properties:n})};di.prototype.updateProperties=function(t,e){this._commandStack.execute("element.updateProperties",{element:t,properties:e})};di.prototype.resizeLane=function(t,e,n){this._commandStack.execute("lane.resize",{shape:t,newBounds:e,balanced:n})};di.prototype.addLane=function(t,e){var n={shape:t,location:e};return this._commandStack.execute("lane.add",n),n.newLane};di.prototype.splitLane=function(t,e){this._commandStack.execute("lane.split",{shape:t,count:e})};di.prototype.makeCollaboration=function(){var t=this._create("root",{type:"bpmn:Collaboration"}),e={newRoot:t};return this._commandStack.execute("canvas.updateRoot",e),t};di.prototype.makeProcess=function(){var t=this._create("root",{type:"bpmn:Process"}),e={newRoot:t};return this._commandStack.execute("canvas.updateRoot",e),t};di.prototype.updateLaneRefs=function(t,e){this._commandStack.execute("lane.updateRefs",{flowNodeShapes:t,laneShapes:e})};di.prototype.claimId=function(t,e){this._commandStack.execute("id.updateClaim",{id:t,element:e,claiming:!0})};di.prototype.unclaimId=function(t,e){this._commandStack.execute("id.updateClaim",{id:t,element:e})};di.prototype.setColor=function(t,e){t.length||(t=[t]),this._commandStack.execute("element.setColor",{elements:t,colors:e})};function gz(){}gz.prototype.layoutConnection=function(t,e){return e=e||{},[e.connectionStart||xt(e.source||t.source),e.connectionEnd||xt(e.target||t.target)]};var nx=20,yle=5,x0=Math.round,dI=20,xle={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};function ble(t,e){return!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[e].test(t)}function wle(t,e){return{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[t].test(e)}function vz(t,e,n){var r=ci(e,t,yle),i=n.split(":")[0],s=x0((e.x-t.x)/2+t.x),o=x0((e.y-t.y)/2+t.y),a,l,c=wle(i,r),d=/h|r|l/.test(i),h=!1,p=!1;return c?(a=d?{x:s,y:t.y}:{x:t.x,y:o},l=d?"h:h":"v:v"):(h=ble(r,i),l=d?"h:v":"v:h",h?d?(p=o===t.y,a={x:t.x+nx*(/l/.test(i)?-1:1),y:p?o+nx:o}):(p=s===t.x,a={x:p?s+nx:s,y:t.y+nx*(/t/.test(i)?-1:1)}):a={x:s,y:o}),{waypoints:NP(t,a,l).concat(a),directions:l,turnNextDirections:p}}function _le(t,e,n){return vz(t,e,n)}function Ele(t,e,n){var r=vz(e,t,hI(n));return{waypoints:r.waypoints.slice().reverse(),directions:hI(r.directions),turnNextDirections:r.turnNextDirections}}function Sle(t,e){var n=t.directions.split(":")[1],r=e.directions.split(":")[0];t.turnNextDirections&&(n=n=="h"?"v":"h"),e.turnNextDirections&&(r=r=="h"?"v":"h");var i=n+":"+r,s=NP(t.waypoints[t.waypoints.length-1],e.waypoints[0],i);return{waypoints:s,directions:i}}function hI(t){return t.split(":").reverse().join(":")}function Cle(t,e,n){var r=x0((e.x-t.x)/2+t.x),i=x0((e.y-t.y)/2+t.y);if(n==="h:v")return[{x:e.x,y:t.y}];if(n==="v:h")return[{x:t.x,y:e.y}];if(n==="h:h")return[{x:r,y:t.y},{x:r,y:e.y}];if(n==="v:v")return[{x:t.x,y:i},{x:e.x,y:i}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}function NP(t,e,n){if(n=n||"h:h",!Ile(n))throw new Error("unknown directions: <"+n+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");if(yz(n)){var r=_le(t,e,n),i=Ele(t,e,n),s=Sle(r,i);return[].concat(r.waypoints,s.waypoints,i.waypoints)}return Cle(t,e,n)}function jle(t,e,n){var r=NP(t,e,n);return r.unshift(t),r.push(e),xz(r)}function kle(t,e,n,r,i){var s=i&&i.preferredLayouts||[],o=CX(s,"straight")[0]||"h:h",a=xle[o]||0,l=ci(t,e,a),c=Ale(l,o);n=n||xt(t),r=r||xt(e);var d=c.split(":"),h=fI(n,t,d[0],Dle(l)),p=fI(r,e,d[1],l);return jle(h,p,c)}function Ple(t,e,n,r,i,s){ke(n)&&(i=n,s=r,n=xt(t),r=xt(e)),s=B({preferredLayouts:[]},s),i=i||[];var o=s.preferredLayouts,a=o.indexOf("straight")!==-1,l;return l=a&&Nle(t,e,n,r,s),l||(l=s.connectionEnd&&Rle(e,t,r,i),l)||(l=s.connectionStart&&Ole(t,e,n,i),l)?l:!s.connectionStart&&!s.connectionEnd&&i&&i.length?i:kle(t,e,n,r,s)}function Tle(t,e,n){return t>=e&&t<=n}function pI(t,e,n){var r={x:"width",y:"height"};return Tle(e[t],n[t],n[t]+n[r[t]])}function Nle(t,e,n,r,i){var s={},o,a;return a=ci(t,e),/^(top|bottom|left|right)$/.test(a)?(/top|bottom/.test(a)&&(o="x"),/left|right/.test(a)&&(o="y"),i.preserveDocking==="target"?pI(o,r,t)?(s[o]=r[o],[{x:s.x!==void 0?s.x:n.x,y:s.y!==void 0?s.y:n.y,original:{x:s.x!==void 0?s.x:n.x,y:s.y!==void 0?s.y:n.y}},{x:r.x,y:r.y}]):null:pI(o,n,e)?(s[o]=n[o],[{x:n.x,y:n.y},{x:s.x!==void 0?s.x:r.x,y:s.y!==void 0?s.y:r.y,original:{x:s.x!==void 0?s.x:r.x,y:s.y!==void 0?s.y:r.y}}]):null):null}function Ole(t,e,n,r){return OP(t,e,n,r)}function Rle(t,e,n,r){var i=r.slice().reverse();return i=OP(t,e,n,i),i?i.reverse():null}function OP(t,e,n,r){function i(d){return d.length<3?!0:d.length>4?!1:!!Tt(d,function(h,p){var f=d[p-1];return f&&UB(h,f)<3})}function s(d,h,p){var f=ul(h,d);switch(f){case"v":return{x:p.x,y:d.y};case"h":return{x:d.x,y:p.y}}return{x:d.x,y:d.y}}function o(d,h,p){var f;for(f=d.length-2;f!==0;f--)if(EO(d[f],h,dI)||EO(d[f],p,dI))return d.slice(f);return d}if(i(r))return null;var a=r[0],l=r.slice(),c;return l[0]=n,l[1]=s(l[1],a,n),c=o(l,t,e),c!==l&&(l=OP(t,e,n,c)),l&&ul(l)?null:l}function Ale(t,e){if(yz(e))return e;switch(t){case"intersect":return"t:t";case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return e}}function Ile(t){return t&&/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(t)}function yz(t){return t&&/t|r|b|l/.test(t)}function Dle(t){return{top:"bottom",bottom:"top",left:"right",right:"left","top-left":"bottom-right","bottom-right":"top-left","top-right":"bottom-left","bottom-left":"top-right"}[t]}function fI(t,e,n,r){if(n==="h"&&(n=/left/.test(r)?"l":"r"),n==="v"&&(n=/top/.test(r)?"t":"b"),n==="t")return{original:t,x:t.x,y:e.y};if(n==="r")return{original:t,x:e.x+e.width,y:t.y};if(n==="b")return{original:t,x:t.x,y:e.y+e.height};if(n==="l")return{original:t,x:e.x,y:t.y};throw new Error("unexpected dockingDirection: <"+n+">")}function xz(t){return t.reduce(function(e,n,r){var i=e[e.length-1],s=t[r+1];return VB(i,s,n,0)||e.push(n),e},[])}var $le=-10,Mle=40,Lle={default:["h:h"],fromGateway:["v:h"],toGateway:["h:v"],loop:{fromTop:["t:r"],fromRight:["r:b"],fromLeft:["l:t"],fromBottom:["b:l"]},boundaryLoop:{alternateHorizontalSide:"b",alternateVerticalSide:"l",default:"v"},messageFlow:["straight","v:v"],subProcess:["straight","h:h"],isHorizontal:!0},Ble={default:["v:v"],fromGateway:["h:v"],toGateway:["v:h"],loop:{fromTop:["t:l"],fromRight:["r:t"],fromLeft:["l:b"],fromBottom:["b:r"]},boundaryLoop:{alternateHorizontalSide:"t",alternateVerticalSide:"r",default:"h"},messageFlow:["straight","h:h"],subProcess:["straight","v:v"],isHorizontal:!1},RP={top:"bottom","top-right":"bottom-left","top-left":"bottom-right",right:"left",bottom:"top","bottom-right":"top-left","bottom-left":"top-right",left:"right"},Wm={top:"t",right:"r",bottom:"b",left:"l"};function i_(t){this._elementRegistry=t}Ce(i_,gz);i_.prototype.layoutConnection=function(t,e){e||(e={});var n=e.source||t.source,r=e.target||t.target,i=e.waypoints||t.waypoints,s=e.connectionStart,o=e.connectionEnd,a=this._elementRegistry,l,c;if(s||(s=mI(i&&i[0],n)),o||(o=mI(i&&i[i.length-1],r)),(T(t,"bpmn:Association")||T(t,"bpmn:DataAssociation"))&&i&&!gI(n,r))return[].concat([s],i.slice(1,-1),[o]);var d=UF(n,a)?Lle:Ble;return T(t,"bpmn:MessageFlow")?l=zle(n,r,d):(T(t,"bpmn:SequenceFlow")||gI(n,r))&&(n===r?l={preferredLayouts:Gle(n,t,d)}:T(n,"bpmn:BoundaryEvent")?l={preferredLayouts:Kle(n,r,o,d)}:Ug(n)||Ug(r)?l={preferredLayouts:d.subProcess,preserveDocking:Ule(n)}:T(n,"bpmn:Gateway")?l={preferredLayouts:d.fromGateway}:T(r,"bpmn:Gateway")?l={preferredLayouts:d.toGateway}:l={preferredLayouts:d.default}),l&&(l=B(l,e),c=xz(Ple(n,r,s,o,i,l))),c||[s,o]};function Fle(t){var e=t.host;return ci(xt(t),e,$le)}function zle(t,e,n){return{preferredLayouts:n.messageFlow,preserveDocking:Hle(t,e)}}function Hle(t,e){return T(e,"bpmn:Participant")?"source":T(t,"bpmn:Participant")?"target":Ug(e)?"source":Ug(t)||T(e,"bpmn:Event")?"target":T(t,"bpmn:Event")?"source":null}function Ule(t){return Ug(t)?"target":"source"}function mI(t,e){return t?t.original||t:xt(e)}function gI(t,e){return T(e,"bpmn:Activity")&&T(t,"bpmn:BoundaryEvent")&&e.businessObject.isForCompensation}function Ug(t){return T(t,"bpmn:SubProcess")&&rn(t)}function od(t,e){return t===e}function Vle(t,e){return e.indexOf(t)!==-1}function Wp(t){var e=/right|left/.exec(t);return e&&e[0]}function Gp(t){var e=/top|bottom/.exec(t);return e&&e[0]}function vI(t,e){return RP[t]===e}function qle(t,e){var n=Wp(t),r=RP[n];return e.indexOf(r)!==-1}function Wle(t,e){var n=Gp(t),r=RP[n];return e.indexOf(r)!==-1}function bz(t){return t==="right"||t==="left"}function Gle(t,e,n){var r=e.waypoints,i=r&&r.length&&ci(r[0],t);return i==="top"?n.loop.fromTop:i==="right"?n.loop.fromRight:i==="left"?n.loop.fromLeft:n.loop.fromBottom}function Kle(t,e,n,r){var i=xt(t),s=xt(e),o=Fle(t),a,l,c=od(t.host,e),d=Vle(o,["top","right","bottom","left"]),h=ci(s,i,{x:t.width/2+e.width/2,y:t.height/2+e.height/2});return c?Yle(o,d,t,e,n,r):(a=Xle(o,h,d,r.isHorizontal),l=Qle(o,h,d,r.isHorizontal),[a+":"+l])}function Yle(t,e,n,r,i,s){var o=e?t:s.isHorizontal?Gp(t):Wp(t),a=Wm[o],l;return e?bz(t)?l=yI("y",n,r,i)?"h":s.boundaryLoop.alternateHorizontalSide:l=yI("x",n,r,i)?"v":s.boundaryLoop.alternateVerticalSide:l=s.boundaryLoop.default,[a+":"+l]}function yI(t,e,n,r){var i=Mle;return!(pE(t,r,n,i)||pE(t,r,{x:n.x+n.width,y:n.y+n.height},i)||pE(t,r,xt(e),i))}function pE(t,e,n,r){return Math.abs(e[t]-n[t])<r}function Xle(t,e,n,r){if(n)return Wm[t];var i=Gp(t),s=Wp(t),o=Gp(e),a=Wp(e);if(r){if(od(i,o)||vI(s,a))return Wm[i]}else if(od(s,a)||vI(i,o))return Wm[s];return Wm[r?s:i]}function Qle(t,e,n,r){return n?bz(t)?qle(t,e)||od(t,e)?"h":"v":Wle(t,e)||od(t,e)?"v":"h":r?od(Gp(t),Gp(e))?"h":"v":od(Wp(t),Wp(e))?"v":"h"}i_.$inject=["elementRegistry"];function xI(t){return B({original:t.point.original||t.point},t.actual)}function ru(t,e){this._elementRegistry=t,this._graphicsFactory=e}ru.$inject=["elementRegistry","graphicsFactory"];ru.prototype.getCroppedWaypoints=function(t,e,n){e=e||t.source,n=n||t.target;var r=this.getDockingPoint(t,e,!0),i=this.getDockingPoint(t,n),s=t.waypoints.slice(r.idx+1,i.idx);return s.unshift(xI(r)),s.push(xI(i)),s};ru.prototype.getDockingPoint=function(t,e,n){var r=t.waypoints,i,s,o;return i=n?0:r.length-1,s=r[i],o=this._getIntersection(e,t,n),{point:s,actual:o||s,idx:i}};ru.prototype._getIntersection=function(t,e,n){var r=this._getShapePath(t),i=this._getConnectionPath(e);return DS(r,i,n)};ru.prototype._getConnectionPath=function(t){return this._graphicsFactory.getConnectionPath(t)};ru.prototype._getShapePath=function(t){return this._graphicsFactory.getShapePath(t)};ru.prototype._getGfx=function(t){return this._elementRegistry.getGraphics(t)};const wz={__init__:["modeling","bpmnUpdater"],__depends__:[Goe,dae,pae,fae,ez,iz,Uae,Yae,Ma,KB,rz],bpmnFactory:["type",ho],bpmnUpdater:["type",cs],elementFactory:["type",eu],modeling:["type",di],layouter:["type",i_],connectionDocking:["type",ru]},bI=Math.round;function s_(t,e,n,r,i,s){this._complexPreview=t,this._connectionDocking=e,this._elementFactory=n,this._eventBus=r,this._layouter=i,this._rules=s}s_.prototype.create=function(t,e,n){const r=this._complexPreview,i=this._connectionDocking,s=this._elementFactory,o=this._eventBus,a=this._layouter,l=this._rules,c=s.createShape(B({type:e},n)),d=o.fire("autoPlace",{source:t,shape:c});if(!d)return;B(c,{x:d.x-bI(c.width/2),y:d.y-bI(c.height/2)});const h=l.allowed("connection.create",{source:t,target:c,hints:{targetParent:t.parent}});let p=null;h&&(p=s.createConnection(h),p.waypoints=a.layoutConnection(p,{source:t,target:c}),p.waypoints=i.getCroppedWaypoints(p,t,c)),r.create({created:[c,p].filter(f=>!jg(f))})};s_.prototype.cleanUp=function(){this._complexPreview.cleanUp()};s_.$inject=["complexPreview","connectionDocking","elementFactory","eventBus","layouter","rules"];const Zle={__depends__:[S2,_se,wz],__init__:["appendPreview"],appendPreview:["type",s_]};var wI=Math.min,_I=Math.max;function fE(t){t.preventDefault()}function dg(t){t.stopPropagation()}function Jle(t){return t.nodeType===Node.TEXT_NODE}function ece(t){return[].slice.call(t)}function Wo(t){this.container=t.container,this.parent=bt('<div class="djs-direct-editing-parent"><div class="djs-direct-editing-content" contenteditable="true"></div></div>'),this.content=at("[contenteditable]",this.parent),this.keyHandler=t.keyHandler||function(){},this.resizeHandler=t.resizeHandler||function(){},this.autoResize=li(this.autoResize,this),this.handlePaste=li(this.handlePaste,this)}Wo.prototype.create=function(t,e,n,r){var i=this,s=this.parent,o=this.content,a=this.container;r=this.options=r||{},e=this.style=e||{};var l=ui(e,["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);B(s.style,{width:t.width+"px",height:t.height+"px",maxWidth:t.maxWidth+"px",maxHeight:t.maxHeight+"px",minWidth:t.minWidth+"px",minHeight:t.minHeight+"px",left:t.x+"px",top:t.y+"px",backgroundColor:"#ffffff",position:"absolute",overflow:"visible",border:"1px solid #ccc",boxSizing:"border-box",wordWrap:"normal",textAlign:"center",outline:"none"},l);var c=ui(e,["fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return B(o.style,{boxSizing:"border-box",width:"100%",outline:"none",wordWrap:"break-word"},c),r.centerVertically&&B(o.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},c),o.innerText=n,ie.bind(o,"keydown",this.keyHandler),ie.bind(o,"mousedown",dg),ie.bind(o,"paste",i.handlePaste),r.autoResize&&ie.bind(o,"input",this.autoResize),r.resizable&&this.resizable(e),a.appendChild(s),this.setSelection(o.lastChild,o.lastChild&&o.lastChild.length),s};Wo.prototype.handlePaste=function(t){var e=this.options,n=this.style;t.preventDefault();var r;if(t.clipboardData?r=t.clipboardData.getData("text/plain"):r=window.clipboardData.getData("Text"),this.insertText(r),e.autoResize){var i=this.autoResize(n);i&&this.resizeHandler(i)}};Wo.prototype.insertText=function(t){t=tce(t);var e=document.execCommand("insertText",!1,t);e||this._insertTextIE(t)};Wo.prototype._insertTextIE=function(t){var e=this.getSelection(),n=e.startContainer,r=e.endContainer,i=e.startOffset,s=e.endOffset,o=e.commonAncestorContainer,a=ece(o.childNodes),l,c;if(Jle(o)){var d=n.textContent;n.textContent=d.substring(0,i)+t+d.substring(s),l=n,c=i+t.length}else if(n===this.content&&r===this.content){var h=document.createTextNode(t);this.content.insertBefore(h,a[i]),l=h,c=h.textContent.length}else{var p=a.indexOf(n),f=a.indexOf(r);a.forEach(function(m,g){g===p?m.textContent=n.textContent.substring(0,i)+t+r.textContent.substring(s):g>p&&g<=f&&Nr(m)}),l=n,c=i+t.length}l&&c!==void 0&&setTimeout(function(){self.setSelection(l,c)})};Wo.prototype.autoResize=function(){var t=this.parent,e=this.content,n=parseInt(this.style.fontSize)||12;if(e.scrollHeight>t.offsetHeight||e.scrollHeight<t.offsetHeight-n){var r=t.getBoundingClientRect(),i=e.scrollHeight;t.style.height=i+"px",this.resizeHandler({width:r.width,height:r.height,dx:0,dy:i-r.height})}};Wo.prototype.resizable=function(){var t=this,e=this.parent,n=this.resizeHandle,r=parseInt(this.style.minWidth)||0,i=parseInt(this.style.minHeight)||0,s=parseInt(this.style.maxWidth)||1/0,o=parseInt(this.style.maxHeight)||1/0;if(!n){n=this.resizeHandle=bt('<div class="djs-direct-editing-resize-handle"></div>');var a,l,c,d,h=function(m){fE(m),dg(m),a=m.clientX,l=m.clientY;var g=e.getBoundingClientRect();c=g.width,d=g.height,ie.bind(document,"mousemove",p),ie.bind(document,"mouseup",f)},p=function(m){fE(m),dg(m);var g=wI(_I(c+m.clientX-a,r),s),v=wI(_I(d+m.clientY-l,i),o);e.style.width=g+"px",e.style.height=v+"px",t.resizeHandler({width:c,height:d,dx:m.clientX-a,dy:m.clientY-l})},f=function(m){fE(m),dg(m),ie.unbind(document,"mousemove",p,!1),ie.unbind(document,"mouseup",f,!1)};ie.bind(n,"mousedown",h)}B(n.style,{position:"absolute",bottom:"0px",right:"0px",cursor:"nwse-resize",width:"0",height:"0",borderTop:(parseInt(this.style.fontSize)/4||3)+"px solid transparent",borderRight:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderBottom:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderLeft:(parseInt(this.style.fontSize)/4||3)+"px solid transparent"}),e.appendChild(n)};Wo.prototype.destroy=function(){var t=this.parent,e=this.content,n=this.resizeHandle;e.innerText="",t.removeAttribute("style"),e.removeAttribute("style"),ie.unbind(e,"keydown",this.keyHandler),ie.unbind(e,"mousedown",dg),ie.unbind(e,"input",this.autoResize),ie.unbind(e,"paste",this.handlePaste),n&&(n.removeAttribute("style"),Nr(n)),Nr(t)};Wo.prototype.getValue=function(){return this.content.innerText.trim()};Wo.prototype.getSelection=function(){var t=window.getSelection(),e=t.getRangeAt(0);return e};Wo.prototype.setSelection=function(t,e){var n=document.createRange();t===null?n.selectNodeContents(this.content):(n.setStart(t,e),n.setEnd(t,e));var r=window.getSelection();r.removeAllRanges(),r.addRange(n)};function tce(t){return t.replace(/\r\n|\r|\n/g,`
`)}function po(t,e){this._eventBus=t,this._canvas=e,this._providers=[],this._textbox=new Wo({container:e.getContainer(),keyHandler:li(this._handleKey,this),resizeHandler:li(this._handleResize,this)})}po.$inject=["eventBus","canvas"];po.prototype.registerProvider=function(t){this._providers.push(t)};po.prototype.isActive=function(t){return!!(this._active&&(!t||this._active.element===t))};po.prototype.cancel=function(){this._active&&(this._fire("cancel"),this.close())};po.prototype._fire=function(t,e){this._eventBus.fire("directEditing."+t,e||{active:this._active})};po.prototype.close=function(){this._textbox.destroy(),this._fire("deactivate"),this._active=null,this.resizable=void 0,this._canvas.restoreFocus&&this._canvas.restoreFocus()};po.prototype.complete=function(){var t=this._active;if(t){var e,n=t.context.bounds,r=this.$textbox.getBoundingClientRect(),i=this.getValue(),s=t.context.text;(i!==s||r.height!==n.height||r.width!==n.width)&&(e=this._textbox.container.getBoundingClientRect(),t.provider.update(t.element,i,t.context.text,{x:r.left-e.left,y:r.top-e.top,width:r.width,height:r.height})),this._fire("complete"),this.close()}};po.prototype.getValue=function(){return this._textbox.getValue()};po.prototype._handleKey=function(t){t.stopPropagation();var e=t.keyCode||t.charCode;if(e===27)return t.preventDefault(),this.cancel();if(e===13&&!t.shiftKey)return t.preventDefault(),this.complete()};po.prototype._handleResize=function(t){this._fire("resize",t)};po.prototype.activate=function(t){this.isActive()&&this.cancel();var e,n=Tt(this._providers,function(r){return(e=r.activate(t))?r:null});return e&&(this.$textbox=this._textbox.create(e.bounds,e.style,e.text,e.options),this._active={element:t,context:e,provider:n},e.options&&e.options.resizable&&(this.resizable=!0),this._fire("activate")),!!e};const _z={__depends__:[Ek],__init__:["directEditing"],directEditing:["type",po]};function nce(t){return function(e){var n=e.target,r=Me(t),i=r.eventDefinitions&&r.eventDefinitions[0],s=r.$type===n.type,o=(i&&i.$type)===n.eventDefinitionType,a=!!n.triggeredByEvent==!!r.triggeredByEvent,l=n.isExpanded===void 0||n.isExpanded===rn(t);return!s||!o||!a||!l}}var rce=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message start event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer start event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Conditional start event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Signal start event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],ice=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}}],sce=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message intermediate catch event",actionName:"replace-with-message-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message intermediate throw event",actionName:"replace-with-message-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-message",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer intermediate catch event",actionName:"replace-with-timer-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation intermediate throw event",actionName:"replace-with-escalation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-escalation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional intermediate catch event",actionName:"replace-with-conditional-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Link intermediate catch event",actionName:"replace-with-link-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-link",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Link intermediate throw event",actionName:"replace-with-link-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-link",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Compensation intermediate throw event",actionName:"replace-with-compensation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-compensation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal intermediate catch event",actionName:"replace-with-signal-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal intermediate throw event",actionName:"replace-with-signal-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-signal",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],oce=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message end event",actionName:"replace-with-message-end",className:"bpmn-icon-end-event-message",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Escalation end event",actionName:"replace-with-escalation-end",className:"bpmn-icon-end-event-escalation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Error end event",actionName:"replace-with-error-end",className:"bpmn-icon-end-event-error",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel end event",actionName:"replace-with-cancel-end",className:"bpmn-icon-end-event-cancel",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Compensation end event",actionName:"replace-with-compensation-end",className:"bpmn-icon-end-event-compensation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal end event",actionName:"replace-with-signal-end",className:"bpmn-icon-end-event-signal",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Terminate end event",actionName:"replace-with-terminate-end",className:"bpmn-icon-end-event-terminate",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:TerminateEventDefinition"}}],ace=[{label:"Exclusive gateway",actionName:"replace-with-exclusive-gateway",className:"bpmn-icon-gateway-xor",target:{type:"bpmn:ExclusiveGateway"}},{label:"Parallel gateway",actionName:"replace-with-parallel-gateway",className:"bpmn-icon-gateway-parallel",target:{type:"bpmn:ParallelGateway"}},{label:"Inclusive gateway",actionName:"replace-with-inclusive-gateway",className:"bpmn-icon-gateway-or",target:{type:"bpmn:InclusiveGateway"}},{label:"Complex gateway",actionName:"replace-with-complex-gateway",className:"bpmn-icon-gateway-complex",target:{type:"bpmn:ComplexGateway"}},{label:"Event-based gateway",actionName:"replace-with-event-based-gateway",className:"bpmn-icon-gateway-eventbased",target:{type:"bpmn:EventBasedGateway",instantiate:!1,eventGatewayType:"Exclusive"}}],lce=[{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Event sub-process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}},{label:"Ad-hoc sub-process",actionName:"replace-with-ad-hoc-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:AdHocSubProcess",isExpanded:!0}},{label:"Sub-process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}}],cce=[{label:"Sub-process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Event sub-process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}},{label:"Ad-hoc sub-process (collapsed)",actionName:"replace-with-collapsed-ad-hoc-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:AdHocSubProcess",isExpanded:!1}}],Ez=[{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Sub-process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Ad-hoc sub-process",actionName:"replace-with-ad-hoc-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:AdHocSubProcess",isExpanded:!0}},{label:"Event sub-process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}}],uce=Ez,EI=[{label:"Task",actionName:"replace-with-task",className:"bpmn-icon-task",target:{type:"bpmn:Task"}},{label:"User task",actionName:"replace-with-user-task",className:"bpmn-icon-user",target:{type:"bpmn:UserTask"}},{label:"Service task",actionName:"replace-with-service-task",className:"bpmn-icon-service",target:{type:"bpmn:ServiceTask"}},{label:"Send task",actionName:"replace-with-send-task",className:"bpmn-icon-send",target:{type:"bpmn:SendTask"}},{label:"Receive task",actionName:"replace-with-receive-task",className:"bpmn-icon-receive",target:{type:"bpmn:ReceiveTask"}},{label:"Manual task",actionName:"replace-with-manual-task",className:"bpmn-icon-manual",target:{type:"bpmn:ManualTask"}},{label:"Business rule task",actionName:"replace-with-rule-task",className:"bpmn-icon-business-rule",target:{type:"bpmn:BusinessRuleTask"}},{label:"Script task",actionName:"replace-with-script-task",className:"bpmn-icon-script",target:{type:"bpmn:ScriptTask"}},{label:"Call activity",actionName:"replace-with-call-activity",className:"bpmn-icon-call-activity",target:{type:"bpmn:CallActivity"}},{label:"Sub-process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}},{label:"Sub-process (expanded)",actionName:"replace-with-expanded-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Ad-hoc sub-process (collapsed)",actionName:"replace-with-collapsed-ad-hoc-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:AdHocSubProcess",isExpanded:!1}},{label:"Ad-hoc sub-process (expanded)",actionName:"replace-with-ad-hoc-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:AdHocSubProcess",isExpanded:!0}}],dce=[{label:"Data store reference",actionName:"replace-with-data-store-reference",className:"bpmn-icon-data-store",target:{type:"bpmn:DataStoreReference"}}],hce=[{label:"Data object reference",actionName:"replace-with-data-object-reference",className:"bpmn-icon-data-object",target:{type:"bpmn:DataObjectReference"}}],pce=[{label:"Message boundary event",actionName:"replace-with-message-boundary",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition",cancelActivity:!0}},{label:"Timer boundary event",actionName:"replace-with-timer-boundary",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition",cancelActivity:!0}},{label:"Escalation boundary event",actionName:"replace-with-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",cancelActivity:!0}},{label:"Conditional boundary event",actionName:"replace-with-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",cancelActivity:!0}},{label:"Error boundary event",actionName:"replace-with-error-boundary",className:"bpmn-icon-intermediate-event-catch-error",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ErrorEventDefinition",cancelActivity:!0}},{label:"Cancel boundary event",actionName:"replace-with-cancel-boundary",className:"bpmn-icon-intermediate-event-catch-cancel",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CancelEventDefinition",cancelActivity:!0}},{label:"Signal boundary event",actionName:"replace-with-signal-boundary",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition",cancelActivity:!0}},{label:"Compensation boundary event",actionName:"replace-with-compensation-boundary",className:"bpmn-icon-intermediate-event-catch-compensation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CompensateEventDefinition",cancelActivity:!0}},{label:"Message boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-message-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition",cancelActivity:!1}},{label:"Timer boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition",cancelActivity:!1}},{label:"Escalation boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",cancelActivity:!1}},{label:"Conditional boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",cancelActivity:!1}},{label:"Signal boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition",cancelActivity:!1}}],fce=[{label:"Message start event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition",isInterrupting:!0}},{label:"Timer start event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition",isInterrupting:!0}},{label:"Conditional start event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",isInterrupting:!0}},{label:"Signal start event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition",isInterrupting:!0}},{label:"Error start event",actionName:"replace-with-error-start",className:"bpmn-icon-start-event-error",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ErrorEventDefinition",isInterrupting:!0}},{label:"Escalation start event",actionName:"replace-with-escalation-start",className:"bpmn-icon-start-event-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",isInterrupting:!0}},{label:"Compensation start event",actionName:"replace-with-compensation-start",className:"bpmn-icon-start-event-compensation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:CompensateEventDefinition",isInterrupting:!0}},{label:"Message start event (non-interrupting)",actionName:"replace-with-non-interrupting-message-start",className:"bpmn-icon-start-event-non-interrupting-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition",isInterrupting:!1}},{label:"Timer start event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-start",className:"bpmn-icon-start-event-non-interrupting-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition",isInterrupting:!1}},{label:"Conditional start event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-start",className:"bpmn-icon-start-event-non-interrupting-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",isInterrupting:!1}},{label:"Signal start event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-start",className:"bpmn-icon-start-event-non-interrupting-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition",isInterrupting:!1}},{label:"Escalation start event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-start",className:"bpmn-icon-start-event-non-interrupting-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",isInterrupting:!1}}],mce=[{label:"Sequence flow",actionName:"replace-with-sequence-flow",className:"bpmn-icon-connection"},{label:"Default flow",actionName:"replace-with-default-flow",className:"bpmn-icon-default-flow"},{label:"Conditional flow",actionName:"replace-with-conditional-flow",className:"bpmn-icon-conditional-flow"}],gce=[{label:"Expanded pool/participant",actionName:"replace-with-expanded-pool",className:"bpmn-icon-participant",target:{type:"bpmn:Participant",isExpanded:!0}},{label:function(t){var e="Empty pool/participant";return t.children&&t.children.length&&(e+=" (removes content)"),e},actionName:"replace-with-collapsed-pool",className:"bpmn-icon-lane",target:{type:"bpmn:Participant",isExpanded:!1}}],vce={"bpmn:MessageEventDefinition":[{label:"Message start event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message intermediate catch event",actionName:"replace-with-message-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message intermediate throw event",actionName:"replace-with-message-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-message",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message end event",actionName:"replace-with-message-end",className:"bpmn-icon-end-event-message",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}}],"bpmn:TimerEventDefinition":[{label:"Timer start event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Timer intermediate catch event",actionName:"replace-with-timer-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}}],"bpmn:ConditionalEventDefinition":[{label:"Conditional start event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Conditional intermediate catch event",actionName:"replace-with-conditional-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}}],"bpmn:SignalEventDefinition":[{label:"Signal start event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal intermediate catch event",actionName:"replace-with-signal-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal intermediate throw event",actionName:"replace-with-signal-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-signal",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal end event",actionName:"replace-with-signal-end",className:"bpmn-icon-end-event-signal",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],"bpmn:ErrorEventDefinition":[{label:"Error start event",actionName:"replace-with-error-start",className:"bpmn-icon-start-event-error",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Error end event",actionName:"replace-with-error-end",className:"bpmn-icon-end-event-error",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}}],"bpmn:EscalationEventDefinition":[{label:"Escalation start event",actionName:"replace-with-escalation-start",className:"bpmn-icon-start-event-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Escalation intermediate throw event",actionName:"replace-with-escalation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-escalation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Escalation end event",actionName:"replace-with-escalation-end",className:"bpmn-icon-end-event-escalation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}}],"bpmn:CompensateEventDefinition":[{label:"Compensation start event",actionName:"replace-with-compensation-start",className:"bpmn-icon-start-event-compensation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Compensation intermediate throw event",actionName:"replace-with-compensation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-compensation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Compensation end event",actionName:"replace-with-compensation-end",className:"bpmn-icon-end-event-compensation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}}]};const SI={"start-event-non-interrupting":`
  <svg viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg">
    <g transform="translate(0 995.64)">
      <path d="m1899 28.357c21.545 567.43-598.38 1023.5-1133.6 835.92-548.09-147.21-801.57-873.95-463.59-1330 302.62-480.3 1071.7-507.54 1407.6-49.847 122.14 153.12 190.07 348.07 189.59 543.91z" fill="none" stroke="currentColor" stroke-dasharray="418.310422, 361.2328165" stroke-linecap="round" stroke-width="100"/>
    </g>
  </svg>`,"intermediate-event-non-interrupting":`
  <svg viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg">
     <g transform="translate(0 995.64)" fill="none" stroke="currentColor" stroke-linecap="round">
        <circle cx="1024" cy="28.357" r="875" stroke-dasharray="418.310422, 361.2328165" stroke-width="100"/>
        <circle cx="1024" cy="28.357" r="685" stroke-dasharray="348.31044857,261.23283643" stroke-dashoffset="500" stroke-width="100"/>
     </g>
  </svg>`};function fo(t,e,n,r,i,s,o,a){this._bpmnFactory=t,this._popupMenu=e,this._modeling=n,this._moddle=r,this._bpmnReplace=i,this._rules=s,this._translate=o,this._moddleCopy=a,this._register()}fo.$inject=["bpmnFactory","popupMenu","modeling","moddle","bpmnReplace","rules","translate","moddleCopy"];fo.prototype._register=function(){this._popupMenu.registerProvider("bpmn-replace",this)};fo.prototype.getPopupMenuEntries=function(t){var a;var e=t.businessObject,n=this._rules,r=[],i,s=[];if(ke(t)||!n.allowed("shape.replace",{element:t}))return{};var o=nce(t);return T(e,"bpmn:DataObjectReference")?this._createEntries(t,dce):T(e,"bpmn:DataStoreReference")&&!T(t.parent,"bpmn:Collaboration")?this._createEntries(t,hce):(T(e,"bpmn:Event")&&!T(e,"bpmn:BoundaryEvent")&&(i=(a=e.get("eventDefinitions")[0])==null?void 0:a.$type,r=vce[i]||[],!_i(e.$parent)&&T(e.$parent,"bpmn:SubProcess")&&(r=ht(r,function(l){return l.target.type!=="bpmn:StartEvent"}))),T(e,"bpmn:StartEvent")&&!T(e.$parent,"bpmn:SubProcess")?(s=ht(rce.concat(r),o),this._createEntries(t,s)):T(e,"bpmn:Participant")?(s=ht(gce,function(l){return rn(t)!==l.target.isExpanded}),this._createEntries(t,s)):T(e,"bpmn:StartEvent")&&_i(e.$parent)?(s=ht(fce.concat(r),function(l){var c=l.target,d=c.isInterrupting!==!1,h=e.isInterrupting===d;return o(l)||!o(l)&&!h}),this._createEntries(t,s)):T(e,"bpmn:StartEvent")&&!_i(e.$parent)&&T(e.$parent,"bpmn:SubProcess")?(s=ht(ice.concat(r),o),this._createEntries(t,s)):T(e,"bpmn:EndEvent")?(s=ht(oce.concat(r),function(l){var c=l.target;return c.eventDefinitionType=="bpmn:CancelEventDefinition"&&!T(e.$parent,"bpmn:Transaction")?!1:o(l)}),this._createEntries(t,s)):T(e,"bpmn:BoundaryEvent")?(s=ht(pce,function(l){var c=l.target;if(c.eventDefinitionType=="bpmn:CancelEventDefinition"&&!T(e.attachedToRef,"bpmn:Transaction"))return!1;var d=c.cancelActivity!==!1,h=e.cancelActivity==d;return o(l)||!o(l)&&!h}),this._createEntries(t,s)):T(e,"bpmn:IntermediateCatchEvent")||T(e,"bpmn:IntermediateThrowEvent")?(s=ht(sce.concat(r),o),this._createEntries(t,s)):T(e,"bpmn:Gateway")?(s=ht(ace,o),this._createEntries(t,s)):T(e,"bpmn:Transaction")?(s=ht(Ez,o),this._createEntries(t,s)):_i(e)&&rn(t)?(s=ht(uce,o),this._createEntries(t,s)):T(e,"bpmn:AdHocSubProcess")&&rn(t)?(s=ht(cce,o),this._createEntries(t,s)):T(e,"bpmn:SubProcess")&&rn(t)?(s=ht(lce,o),this._createEntries(t,s)):T(e,"bpmn:SubProcess")&&!rn(t)?(s=ht(EI,function(l){var c=l.target.type===t.type,d=l.target.isExpanded===!0;return c===d}),this._createEntries(t,s)):T(e,"bpmn:SequenceFlow")?this._createSequenceFlowEntries(t,mce):T(e,"bpmn:FlowNode")?(s=ht(EI,o),this._createEntries(t,s)):{})};fo.prototype.getPopupMenuHeaderEntries=function(t){var e={};return T(t,"bpmn:Activity")&&!_i(t)&&(e={...e,...this._getLoopCharacteristicsHeaderEntries(t)}),T(t,"bpmn:DataObjectReference")&&(e={...e,...this._getCollectionHeaderEntries(t)}),T(t,"bpmn:Participant")&&(e={...e,...this._getParticipantMultiplicityHeaderEntries(t)}),E6(t)&&(e={...e,...this._getNonInterruptingHeaderEntries(t)}),e};fo.prototype._createEntries=function(t,e){var n={},r=this;return $(e,function(i){n[i.actionName]=r._createEntry(i,t)}),n};fo.prototype._createSequenceFlowEntries=function(t,e){var n=Me(t),r={},i=this._modeling,s=this._moddle,o=this;return $(e,function(a){switch(a.actionName){case"replace-with-default-flow":n.sourceRef.default!==n&&(T(n.sourceRef,"bpmn:ExclusiveGateway")||T(n.sourceRef,"bpmn:InclusiveGateway")||T(n.sourceRef,"bpmn:ComplexGateway")||T(n.sourceRef,"bpmn:Activity"))&&(r={...r,[a.actionName]:o._createEntry(a,t,function(){i.updateProperties(t.source,{default:n})})});break;case"replace-with-conditional-flow":!n.conditionExpression&&T(n.sourceRef,"bpmn:Activity")&&(r={...r,[a.actionName]:o._createEntry(a,t,function(){var l=s.create("bpmn:FormalExpression",{body:""});i.updateProperties(t,{conditionExpression:l})})});break;default:T(n.sourceRef,"bpmn:Activity")&&n.conditionExpression&&(r={...r,[a.actionName]:o._createEntry(a,t,function(){i.updateProperties(t,{conditionExpression:void 0})})}),(T(n.sourceRef,"bpmn:ExclusiveGateway")||T(n.sourceRef,"bpmn:InclusiveGateway")||T(n.sourceRef,"bpmn:ComplexGateway")||T(n.sourceRef,"bpmn:Activity"))&&n.sourceRef.default===n&&(r={...r,[a.actionName]:o._createEntry(a,t,function(){i.updateProperties(t.source,{default:void 0})})})}}),r};fo.prototype._createEntry=function(t,e,n){var r=this._translate,i=this._bpmnReplace.replaceElement,s=function(){return i(e,t.target)},o=t.label;return o&&typeof o=="function"&&(o=o(e)),n=n||s,{label:r(o),className:t.className,action:n}};fo.prototype._getLoopCharacteristicsHeaderEntries=function(t){var e=this,n=this._translate;function r(c,d){if(d.active){e._modeling.updateProperties(t,{loopCharacteristics:void 0});return}var h=t.businessObject.get("loopCharacteristics");h&&T(h,d.options.loopCharacteristics)?e._modeling.updateModdleProperties(t,h,{isSequential:d.options.isSequential}):(h=e._moddle.create(d.options.loopCharacteristics,{isSequential:d.options.isSequential}),e._modeling.updateProperties(t,{loopCharacteristics:h}))}var i=Me(t),s=i.loopCharacteristics,o,a,l;return s&&(o=s.isSequential,a=s.isSequential===void 0,l=s.isSequential!==void 0&&!s.isSequential),{"toggle-parallel-mi":{className:"bpmn-icon-parallel-mi-marker",title:n("Parallel multi-instance"),active:l,action:r,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!1}},"toggle-sequential-mi":{className:"bpmn-icon-sequential-mi-marker",title:n("Sequential multi-instance"),active:o,action:r,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!0}},"toggle-loop":{className:"bpmn-icon-loop-marker",title:n("Loop"),active:a,action:r,options:{loopCharacteristics:"bpmn:StandardLoopCharacteristics"}}}};fo.prototype._getCollectionHeaderEntries=function(t){var e=this,n=this._translate,r=t.businessObject.dataObjectRef;if(!r)return{};function i(o,a){e._modeling.updateModdleProperties(t,r,{isCollection:!a.active})}var s=r.isCollection;return{"toggle-is-collection":{className:"bpmn-icon-parallel-mi-marker",title:n("Collection"),active:s,action:i}}};fo.prototype._getParticipantMultiplicityHeaderEntries=function(t){var e=this,n=this._bpmnFactory,r=this._translate;function i(o,a){var l=a.active,c;l||(c=n.create("bpmn:ParticipantMultiplicity")),e._modeling.updateProperties(t,{participantMultiplicity:c})}var s=t.businessObject.participantMultiplicity;return{"toggle-participant-multiplicity":{className:"bpmn-icon-parallel-mi-marker",title:r("Participant multiplicity"),active:!!s,action:i}}};fo.prototype._getNonInterruptingHeaderEntries=function(t){const e=this._translate,n=Me(t),r=this,i=S6(t),s=T(t,"bpmn:BoundaryEvent")?SI["intermediate-event-non-interrupting"]:SI["start-event-non-interrupting"],o=!n[i];return{"toggle-non-interrupting":{imageHtml:s,title:e("Toggle non-interrupting"),active:o,action:function(){r._modeling.updateProperties(t,{[i]:!!o})}}}};const yce={__depends__:[w2,ez,S2],__init__:["replaceMenuProvider"],replaceMenuProvider:["type",fo]};function Hv(t,e,n,r,i,s,o,a,l,c,d,h,p){t=t||{},r.registerProvider(this),this._contextPad=r,this._modeling=i,this._elementFactory=s,this._connect=o,this._create=a,this._popupMenu=l,this._canvas=c,this._rules=d,this._translate=h,this._eventBus=n,this._appendPreview=p,t.autoPlace!==!1&&(this._autoPlace=e.get("autoPlace",!1)),n.on("create.end",250,function(f){var m=f.context,g=m.shape;if(!(!Pg(f)||!r.isOpen(g))){var v=r.getEntries(g);v.replace&&v.replace.action.click(f,g)}}),n.on("contextPad.close",function(){p.cleanUp()})}Hv.$inject=["config.contextPad","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate","appendPreview"];Hv.prototype.getMultiElementContextPadEntries=function(t){var e=this._modeling,n={};return this._isDeleteAllowed(t)&&B(n,{delete:{group:"edit",className:"bpmn-icon-trash",title:this._translate("Delete"),action:{click:function(r,i){e.removeElements(i.slice())}}}}),n};Hv.prototype._isDeleteAllowed=function(t){var e=this._rules.allowed("elements.delete",{elements:t});return ke(e)?Zs(t,n=>e.includes(n)):e};Hv.prototype.getContextPadEntries=function(t){var e=this._contextPad,n=this._modeling,r=this._elementFactory,i=this._connect,s=this._create,o=this._popupMenu,a=this._autoPlace,l=this._translate,c=this._appendPreview,d={};if(t.type==="label")return this._isDeleteAllowed([t])&&B(d,m()),d;var h=t.businessObject;function p(y,w){i.start(y,w)}function f(y,w){n.removeElements([w])}function m(){return{delete:{group:"edit",className:"bpmn-icon-trash",title:l("Delete"),action:{click:f}}}}function g(y){var w=5,E=e.getPad(y).html,S=E.getBoundingClientRect(),j={x:S.left,y:S.bottom+w};return j}function v(y,w,E,S){function j(R,N){var I=r.createShape(B({type:y},S));s.start(R,I,{source:N})}var C=a?function(R,N){var I=r.createShape(B({type:y},S));a.append(N,I)}:j,P=a?function(R,N){return c.create(N,y,S),()=>{c.cleanUp()}}:null;return{group:"model",className:w,title:E,action:{dragstart:j,click:C,hover:P}}}function b(y){return function(w,E){n.splitLane(E,y),e.open(E,!0)}}if(Lt(h,["bpmn:Lane","bpmn:Participant"])&&rn(t)){var x=Zc(t);B(d,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:l("Add lane above"),action:{click:function(y,w){n.addLane(w,"top")}}}}),x.length<2&&((Yr(t)?t.height>=120:t.width>=120)&&B(d,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:l("Divide into two lanes"),action:{click:b(2)}}}),(Yr(t)?t.height>=180:t.width>=180)&&B(d,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:l("Divide into three lanes"),action:{click:b(3)}}})),B(d,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:l("Add lane below"),action:{click:function(y,w){n.addLane(w,"bottom")}}}})}return T(h,"bpmn:FlowNode")&&(T(h,"bpmn:EventBasedGateway")?B(d,{"append.receive-task":v("bpmn:ReceiveTask","bpmn-icon-receive-task",l("Append receive task")),"append.message-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",l("Append message intermediate catch event"),{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",l("Append timer intermediate catch event"),{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condition-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",l("Append conditional intermediate catch event"),{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",l("Append signal intermediate catch event"),{eventDefinitionType:"bpmn:SignalEventDefinition"})}):CI(h,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?B(d,{"append.compensation-activity":v("bpmn:Task","bpmn-icon-task",l("Append compensation activity"),{isForCompensation:!0})}):!T(h,"bpmn:EndEvent")&&!h.isForCompensation&&!CI(h,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")&&!_i(h)&&B(d,{"append.end-event":v("bpmn:EndEvent","bpmn-icon-end-event-none",l("Append end event")),"append.gateway":v("bpmn:ExclusiveGateway","bpmn-icon-gateway-none",l("Append gateway")),"append.append-task":v("bpmn:Task","bpmn-icon-task",l("Append task")),"append.intermediate-event":v("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none",l("Append intermediate/boundary event"))})),o.isEmpty(t,"bpmn-replace")||B(d,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:l("Change element"),action:{click:function(y,w){var E=B(g(w),{cursor:{x:y.x,y:y.y}});o.open(w,"bpmn-replace",E,{title:l("Change element"),width:300,search:!0})}}}}),T(h,"bpmn:SequenceFlow")&&B(d,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation",l("Add text annotation"))}),T(h,"bpmn:MessageFlow")&&B(d,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation",l("Add text annotation"))}),Lt(h,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&B(d,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation",l("Add text annotation")),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:l("Connect to other element"),action:{click:p,dragstart:p}}}),T(h,"bpmn:TextAnnotation")&&B(d,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:l("Connect using association"),action:{click:p,dragstart:p}}}),Lt(h,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&B(d,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:l("Connect using data input association"),action:{click:p,dragstart:p}}}),T(h,"bpmn:Group")&&B(d,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation",l("Add text annotation"))}),this._isDeleteAllowed([t])&&B(d,m()),d};function CI(t,e,n){var r=t.$instanceOf(e),i=!1,s=t.eventDefinitions||[];return $(s,function(o){o.$type===n&&(i=!0)}),r&&i}const xce={__depends__:[Zle,_z,bF,Ma,T2,qw,yce],__init__:["contextPadProvider"],contextPadProvider:["type",Hv]};var bce={horizontal:["x","width"],vertical:["y","height"]},jI=5;function Dl(t,e){this._modeling=t,this._filters=[],this.registerFilter(function(n){var r=e.allowed("elements.distribute",{elements:n});return ke(r)?r:r?n:[]})}Dl.$inject=["modeling","rules"];Dl.prototype.registerFilter=function(t){if(typeof t!="function")throw new Error("the filter has to be a function");this._filters.push(t)};Dl.prototype.trigger=function(t,e){var n=this._modeling,r,i;if(!(t.length<3)&&(this._setOrientation(e),i=this._filterElements(t),r=this._createGroups(i),!(r.length<=2)))return n.distributeElements(r,this._axis,this._dimension),r};Dl.prototype._filterElements=function(t){var e=this._filters,n=this._axis,r=this._dimension,i=[].concat(t);return e.length?($(e,function(s){i=s(i,n,r)}),i):t};Dl.prototype._createGroups=function(t){var e=[],n=this,r=this._axis,i=this._dimension;if(!r)throw new Error('must have a defined "axis" and "dimension"');var s=Ei(t,r);return $(s,function(o,a){var l=n._findRange(o,r,i),c,d=e[e.length-1];d&&n._hasIntersection(d.range,l)?e[e.length-1].elements.push(o):(c={range:l,elements:[o]},e.push(c))}),e};Dl.prototype._setOrientation=function(t){var e=bce[t];this._axis=e[0],this._dimension=e[1]};Dl.prototype._hasIntersection=function(t,e){return Math.max(t.min,t.max)>=Math.min(e.min,e.max)&&Math.min(t.min,t.max)<=Math.max(e.min,e.max)};Dl.prototype._findRange=function(t){var e=t[this._axis],n=t[this._dimension];return{min:e+jI,max:e+n-jI}};const wce={__init__:["distributeElements"],distributeElements:["type",Dl]};function o_(t){co.call(this,t)}o_.$inject=["eventBus"];Ce(o_,co);o_.prototype.init=function(){this.addRule("elements.distribute",function(t){var e=t.elements;return e=ht(e,function(n){var r=Lt(n,["bpmn:Association","bpmn:BoundaryEvent","bpmn:DataInputAssociation","bpmn:DataOutputAssociation","bpmn:Lane","bpmn:MessageFlow","bpmn:SequenceFlow","bpmn:TextAnnotation"]);return!(n.labelTarget||r)}),e=hw(e),e.length<3?!1:e})};var kI={horizontal:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
                <polyline points="450 400 450 150 1350 150 1350 400" style="fill:none;stroke:currentColor;stroke-width:100;stroke-linejoin:round;"/>
                <rect x="150" y="450" width="600" height="1200" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
                <rect x="1050" y="450" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
              </svg>`,vertical:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
              <polyline points="400 1350 150 1350 150 450 400 450" style="fill:none;stroke:currentColor;stroke-width:100;stroke-linejoin:round;"/>
              <rect x="450" y="150" width="1200" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
              <rect x="450" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
            </svg>`},_ce=900;function Uv(t,e,n,r){this._distributeElements=e,this._translate=n,this._popupMenu=t,this._rules=r,t.registerProvider("align-elements",_ce,this)}Uv.$inject=["popupMenu","distributeElements","translate","rules"];Uv.prototype.getPopupMenuEntries=function(t){var e={};return this._isAllowed(t)&&B(e,this._getEntries(t)),e};Uv.prototype._isAllowed=function(t){return this._rules.allowed("elements.distribute",{elements:t})};Uv.prototype._getEntries=function(t){var e=this._distributeElements,n=this._translate,r=this._popupMenu,i={"distribute-elements-horizontal":{group:"distribute",title:n("Distribute elements horizontally"),className:"bjs-align-elements-menu-entry",imageHtml:kI.horizontal,action:function(s,o){e.trigger(t,"horizontal"),r.close()}},"distribute-elements-vertical":{group:"distribute",title:n("Distribute elements vertically"),imageHtml:kI.vertical,action:function(s,o){e.trigger(t,"vertical"),r.close()}}};return i};const Ece={__depends__:[w2,wce],__init__:["bpmnDistributeElements","distributeElementsMenuProvider"],bpmnDistributeElements:["type",o_],distributeElementsMenuProvider:["type",Uv]};var Sz="is not a registered action",Sce="is already registered";function mo(t,e){this._actions={};var n=this;t.on("diagram.init",function(){n._registerDefaultActions(e),t.fire("editorActions.init",{editorActions:n})})}mo.$inject=["eventBus","injector"];mo.prototype._registerDefaultActions=function(t){var e=t.get("commandStack",!1),n=t.get("modeling",!1),r=t.get("selection",!1),i=t.get("zoomScroll",!1),s=t.get("copyPaste",!1),o=t.get("canvas",!1),a=t.get("rules",!1),l=t.get("keyboardMove",!1),c=t.get("keyboardMoveSelection",!1);e&&(this.register("undo",function(){e.undo()}),this.register("redo",function(){e.redo()})),s&&r&&this.register("copy",function(){var d=r.get();if(d.length)return s.copy(d)}),s&&this.register("paste",function(){s.paste()}),i&&this.register("stepZoom",function(d){i.stepZoom(d.value)}),o&&this.register("zoom",function(d){o.zoom(d.value)}),n&&r&&a&&this.register("removeSelection",function(){var d=r.get();if(d.length){var h=a.allowed("elements.delete",{elements:d}),p;h!==!1&&(ke(h)?p=h:p=d,p.length&&n.removeElements(p.slice()))}}),l&&this.register("moveCanvas",function(d){l.moveCanvas(d)}),c&&this.register("moveSelection",function(d){c.moveSelection(d.direction,d.accelerated)})};mo.prototype.trigger=function(t,e){if(!this._actions[t])throw AP(t,Sz);return this._actions[t](e)};mo.prototype.register=function(t,e){var n=this;if(typeof t=="string")return this._registerAction(t,e);$(t,function(r,i){n._registerAction(i,r)})};mo.prototype._registerAction=function(t,e){if(this.isRegistered(t))throw AP(t,Sce);this._actions[t]=e};mo.prototype.unregister=function(t){if(!this.isRegistered(t))throw AP(t,Sz);this._actions[t]=void 0};mo.prototype.getActions=function(){return Object.keys(this._actions)};mo.prototype.isRegistered=function(t){return!!this._actions[t]};function AP(t,e){return new Error(t+" "+e)}const Cce={__init__:["editorActions"],editorActions:["type",mo]};function a_(t){t.invoke(mo,this)}Ce(a_,mo);a_.$inject=["injector"];a_.prototype._registerDefaultActions=function(t){mo.prototype._registerDefaultActions.call(this,t);var e=t.get("canvas",!1),n=t.get("elementRegistry",!1),r=t.get("selection",!1),i=t.get("spaceTool",!1),s=t.get("lassoTool",!1),o=t.get("handTool",!1),a=t.get("globalConnect",!1),l=t.get("distributeElements",!1),c=t.get("alignElements",!1),d=t.get("directEditing",!1),h=t.get("searchPad",!1),p=t.get("modeling",!1),f=t.get("contextPad",!1);e&&n&&r&&this._registerAction("selectElements",function(){var m=e.getRootElement(),g=n.filter(function(v){return v!==m});return r.select(g),g}),i&&this._registerAction("spaceTool",function(){i.toggle()}),s&&this._registerAction("lassoTool",function(){s.toggle()}),o&&this._registerAction("handTool",function(){o.toggle()}),a&&this._registerAction("globalConnectTool",function(){a.toggle()}),r&&l&&this._registerAction("distributeElements",function(m){var g=r.get(),v=m.type;g.length&&l.trigger(g,v)}),r&&c&&this._registerAction("alignElements",function(m){var g=r.get(),v=[],b=m.type;g.length&&(v=ht(g,function(x){return!T(x,"bpmn:Lane")}),c.trigger(v,b))}),r&&p&&this._registerAction("setColor",function(m){var g=r.get();g.length&&p.setColor(g,m)}),r&&d&&this._registerAction("directEditing",function(){var m=r.get();m.length&&d.activate(m[0])}),h&&this._registerAction("find",function(){h.toggle()}),e&&p&&this._registerAction("moveToOrigin",function(){var m=e.getRootElement(),g,v;T(m,"bpmn:Collaboration")?v=n.filter(function(b){return T(b.parent,"bpmn:Collaboration")}):v=n.filter(function(b){return b!==m&&!T(b.parent,"bpmn:SubProcess")}),g=Di(v),p.moveElements(v,{x:-g.x,y:-g.y},m)}),r&&f&&this._registerAction("replaceElement",function(m){f.triggerEntry("replace","click",m)})};const jce={__depends__:[Cce],editorActions:["type",a_]};function Cz(t){t.on(["create.init","shape.move.init"],function(e){var n=e.context,r=e.shape;Lt(r,["bpmn:Participant","bpmn:SubProcess","bpmn:TextAnnotation"])&&(n.gridSnappingContext||(n.gridSnappingContext={}),n.gridSnappingContext.snapLocation="top-left")})}Cz.$inject=["eventBus"];var Nb=10;function mE(t,e,n){return n||(n="round"),Math[n](t/e)*e}var kce=1200,Pce=800;function iu(t,e,n){var r=!n||n.active!==!1;this._eventBus=e;var i=this;e.on("diagram.init",Pce,function(){i.setActive(r)}),e.on(["create.move","create.end","bendpoint.move.move","bendpoint.move.end","connect.move","connect.end","connectionSegment.move.move","connectionSegment.move.end","resize.move","resize.end","shape.move.move","shape.move.end"],kce,function(s){var o=s.originalEvent;if(!(!i.active||o&&Js(o))){var a=s.context,l=a.gridSnappingContext;l||(l=a.gridSnappingContext={}),["x","y"].forEach(function(c){var d={},h=Nce(s,c,t);h&&(d.offset=h);var p=Tce(s,c);p&&B(d,p),Vp(s,c)||i.snapEvent(s,c,d)})}})}iu.prototype.snapEvent=function(t,e,n){var r=this.snapValue(t[e],n);ar(t,e,r)};iu.prototype.getGridSpacing=function(){return Nb};iu.prototype.snapValue=function(t,e){var n=0;e&&e.offset&&(n=e.offset),t+=n,t=mE(t,Nb);var r,i;return e&&e.min&&(r=e.min,Oe(r)&&(r=mE(r+n,Nb,"ceil"),t=Math.max(t,r))),e&&e.max&&(i=e.max,Oe(i)&&(i=mE(i+n,Nb,"floor"),t=Math.min(t,i))),t-=n,t};iu.prototype.isActive=function(){return this.active};iu.prototype.setActive=function(t){this.active=t,this._eventBus.fire("gridSnapping.toggle",{active:t})};iu.prototype.toggleActive=function(){this.setActive(!this.active)};iu.$inject=["elementRegistry","eventBus","config.gridSnapping"];function Tce(t,e){var n=t.context,r=n.createConstraints,i=n.resizeConstraints||{},s=n.gridSnappingContext,o=s.snapConstraints;if(o&&o[e])return o[e];o||(o=s.snapConstraints={}),o[e]||(o[e]={});var a=n.direction;r&&(Ob(e)?(o.x.min=r.left,o.x.max=r.right):(o.y.min=r.top,o.y.max=r.bottom));var l=i.min,c=i.max;return l&&(Ob(e)?TI(a)?o.x.max=l.left:o.x.min=l.right:PI(a)?o.y.max=l.top:o.y.min=l.bottom),c&&(Ob(e)?TI(a)?o.x.min=c.left:o.x.max=c.right:PI(a)?o.y.min=c.top:o.y.max=c.bottom),o[e]}function Nce(t,e,n){var r=t.context,i=t.shape,s=r.gridSnappingContext,o=s.snapLocation,a=s.snapOffset;return a&&Oe(a[e])||(a||(a=s.snapOffset={}),Oe(a[e])||(a[e]=0),!i)||(n.get(i.id)||(Ob(e)?a[e]+=i[e]+i.width/2:a[e]+=i[e]+i.height/2),!o)||(e==="x"?/left/.test(o)?a[e]-=i.width/2:/right/.test(o)&&(a[e]+=i.width/2):/top/.test(o)?a[e]-=i.height/2:/bottom/.test(o)&&(a[e]+=i.height/2)),a[e]}function Ob(t){return t==="x"}function PI(t){return t.indexOf("n")!==-1}function TI(t){return t.indexOf("w")!==-1}function Kd(t,e){ye.call(this,t),this._gridSnapping=e;var n=this;this.preExecute("shape.resize",function(r){var i=r.context,s=i.hints||{},o=s.autoResize;if(o){var a=i.shape,l=i.newBounds;Fi(o)?i.newBounds=n.snapComplex(l,o):i.newBounds=n.snapSimple(a,l)}})}Kd.$inject=["eventBus","gridSnapping","modeling"];Ce(Kd,ye);Kd.prototype.snapSimple=function(t,e){var n=this._gridSnapping;return e.width=n.snapValue(e.width,{min:e.width}),e.height=n.snapValue(e.height,{min:e.height}),e.x=t.x+t.width/2-e.width/2,e.y=t.y+t.height/2-e.height/2,e};Kd.prototype.snapComplex=function(t,e){return/w|e/.test(e)&&(t=this.snapHorizontally(t,e)),/n|s/.test(e)&&(t=this.snapVertically(t,e)),t};Kd.prototype.snapHorizontally=function(t,e){var n=this._gridSnapping,r=/w/.test(e),i=/e/.test(e),s={};return s.width=n.snapValue(t.width,{min:t.width}),i&&(r?(s.x=n.snapValue(t.x,{max:t.x}),s.width+=n.snapValue(t.x-s.x,{min:t.x-s.x})):t.x=t.x+t.width-s.width),B(t,s),t};Kd.prototype.snapVertically=function(t,e){var n=this._gridSnapping,r=/n/.test(e),i=/s/.test(e),s={};return s.height=n.snapValue(t.height,{min:t.height}),r&&(i?(s.y=n.snapValue(t.y,{max:t.y}),s.height+=n.snapValue(t.y-s.y,{min:t.y-s.y})):t.y=t.y+t.height-s.height),B(t,s),t};var Oce=2e3;function jz(t,e){t.on(["spaceTool.move","spaceTool.end"],Oce,function(n){var r=n.context;if(r.initialized){var i=r.axis,s;i==="x"?(s=e.snapValue(n.dx),n.x=n.x+s-n.dx,n.dx=s):(s=e.snapValue(n.dy),n.y=n.y+s-n.dy,n.dy=s)}})}jz.$inject=["eventBus","gridSnapping"];const Rce={__init__:["gridSnappingResizeBehavior","gridSnappingSpaceToolBehavior"],gridSnappingResizeBehavior:["type",Kd],gridSnappingSpaceToolBehavior:["type",jz]},Ace={__depends__:[Rce],__init__:["gridSnapping"],gridSnapping:["type",iu]};var Ice=2e3;function kz(t,e,n){t.on("autoPlace",Ice,function(r){var i=r.source,s=xt(i),o=r.shape,a=VF(i,o,n);return["x","y"].forEach(function(l){var c={};a[l]!==s[l]&&(a[l]>s[l]?c.min=a[l]:c.max=a[l],T(o,"bpmn:TextAnnotation")&&(Dce(l)?c.offset=-o.width/2:c.offset=-o.height/2),a[l]=e.snapValue(a[l],c))}),a})}kz.$inject=["eventBus","gridSnapping","elementRegistry"];function Dce(t){return t==="x"}var $ce=1750;function Pz(t,e,n){e.on(["create.start","shape.move.start"],$ce,function(r){var i=r.context,s=i.shape,o=t.getRootElement();if(!(!T(s,"bpmn:Participant")||!T(o,"bpmn:Process")||!o.children.length)){var a=i.createConstraints;a&&(s.width=n.snapValue(s.width,{min:s.width}),s.height=n.snapValue(s.height,{min:s.height}))}})}Pz.$inject=["canvas","eventBus","gridSnapping"];var Mce=3e3;function l_(t,e,n){ye.call(this,t),this._gridSnapping=e;var r=this;this.postExecuted(["connection.create","connection.layout"],Mce,function(i){var s=i.context,o=s.connection,a=s.hints||{},l=o.waypoints;a.connectionStart||a.connectionEnd||a.createElementsBehavior===!1||Lce(l)&&n.updateWaypoints(o,r.snapMiddleSegments(l))})}l_.$inject=["eventBus","gridSnapping","modeling"];Ce(l_,ye);l_.prototype.snapMiddleSegments=function(t){var e=this._gridSnapping,n;t=t.slice();for(var r=1;r<t.length-2;r++)n=zce(e,t[r],t[r+1]),t[r]=n[0],t[r+1]=n[1];return t};function Lce(t){return t.length>3}function Bce(t){return t==="h"}function Fce(t){return t==="v"}function zce(t,e,n){var r=ul(e,n),i={};return Bce(r)&&(i.y=t.snapValue(e.y)),Fce(r)&&(i.x=t.snapValue(e.x)),("x"in i||"y"in i)&&(e=B({},e,i),n=B({},n,i)),[e,n]}const Hce={__init__:["gridSnappingAutoPlaceBehavior","gridSnappingParticipantBehavior","gridSnappingLayoutConnectionBehavior"],gridSnappingAutoPlaceBehavior:["type",kz],gridSnappingParticipantBehavior:["type",Pz],gridSnappingLayoutConnectionBehavior:["type",l_]},Uce={__depends__:[Ace,Hce],__init__:["bpmnGridSnapping"],bpmnGridSnapping:["type",Cz]};var Vce=30,Tz=30;function Vv(t,e){this._interactionEvents=e;var n=this;t.on(["interactionEvents.createHit","interactionEvents.updateHit"],function(r){var i=r.element,s=r.gfx;if(T(i,"bpmn:Lane"))return n._createParticipantHit(i,s);if(T(i,"bpmn:Participant"))return rn(i)?n._createParticipantHit(i,s):n._createDefaultHit(i,s);if(T(i,"bpmn:SubProcess"))return rn(i)?n._createSubProcessHit(i,s):n._createDefaultHit(i,s)})}Vv.$inject=["eventBus","interactionEvents"];Vv.prototype._createDefaultHit=function(t,e){return this._interactionEvents.removeHits(e),this._interactionEvents.createDefaultHit(t,e),!0};Vv.prototype._createParticipantHit=function(t,e){this._interactionEvents.removeHits(e),this._interactionEvents.createBoxHit(e,"no-move",{width:t.width,height:t.height}),this._interactionEvents.createBoxHit(e,"click-stroke",{width:t.width,height:t.height});var n=Yr(t)?{width:Vce,height:t.height}:{width:t.width,height:Tz};return this._interactionEvents.createBoxHit(e,"all",n),!0};Vv.prototype._createSubProcessHit=function(t,e){return this._interactionEvents.removeHits(e),this._interactionEvents.createBoxHit(e,"no-move",{width:t.width,height:t.height}),this._interactionEvents.createBoxHit(e,"click-stroke",{width:t.width,height:t.height}),this._interactionEvents.createBoxHit(e,"all",{width:t.width,height:Tz}),!0};const qce={__init__:["bpmnInteractionEvents"],bpmnInteractionEvents:["type",Vv]};function c_(t){t.invoke(Cf,this)}Ce(c_,Cf);c_.$inject=["injector"];c_.prototype.registerBindings=function(t,e){Cf.prototype.registerBindings.call(this,t,e);function n(r,i){e.isRegistered(r)&&t.addListener(i)}n("selectElements",function(r){var i=r.keyEvent;if(t.isKey(["a","A"],i)&&t.isCmd(i))return e.trigger("selectElements"),!0}),n("find",function(r){var i=r.keyEvent;if(t.isKey(["f","F"],i)&&t.isCmd(i))return e.trigger("find"),!0}),n("spaceTool",function(r){var i=r.keyEvent;if(!t.hasModifier(i)&&t.isKey(["s","S"],i))return e.trigger("spaceTool"),!0}),n("lassoTool",function(r){var i=r.keyEvent;if(!t.hasModifier(i)&&t.isKey(["l","L"],i))return e.trigger("lassoTool"),!0}),n("handTool",function(r){var i=r.keyEvent;if(!t.hasModifier(i)&&t.isKey(["h","H"],i))return e.trigger("handTool"),!0}),n("globalConnectTool",function(r){var i=r.keyEvent;if(!t.hasModifier(i)&&t.isKey(["c","C"],i))return e.trigger("globalConnectTool"),!0}),n("directEditing",function(r){var i=r.keyEvent;if(!t.hasModifier(i)&&t.isKey(["e","E"],i))return e.trigger("directEditing"),!0}),n("replaceElement",function(r){var i=r.keyEvent;if(!t.hasModifier(i)&&t.isKey(["r","R"],i))return e.trigger("replaceElement",i),!0})};const Wce={__depends__:[f2],__init__:["keyboardBindings"],keyboardBindings:["type",c_]};var Gce={moveSpeed:1,moveSpeedAccelerated:10},Kce=1500,NI="left",OI="up",RI="right",AI="down",Yce={ArrowLeft:NI,Left:NI,ArrowUp:OI,Up:OI,ArrowRight:RI,Right:RI,ArrowDown:AI,Down:AI},Xce={left:function(t){return{x:-t,y:0}},up:function(t){return{x:0,y:-t}},right:function(t){return{x:t,y:0}},down:function(t){return{x:0,y:t}}};function Nz(t,e,n,r,i){var s=this;this._config=B({},Gce,t||{}),e.addListener(Kce,function(o){var a=o.keyEvent,l=Yce[a.key];if(l&&!e.isCmd(a)){var c=e.isShift(a);return s.moveSelection(l,c),!0}}),this.moveSelection=function(o,a){var l=i.get();if(l.length){var c=this._config[a?"moveSpeedAccelerated":"moveSpeed"],d=Xce[o](c),h=r.allowed("elements.move",{shapes:l});h&&n.moveElements(l,d)}}}Nz.$inject=["config.keyboardMoveSelection","keyboard","modeling","rules","selection"];const Qce={__depends__:[f2,Ma],__init__:["keyboardMoveSelection"],keyboardMoveSelection:["type",Nz]};var II=10;function qv(t,e,n,r){this._dragging=r,this._rules=e;var i=this;function s(l,c){var d=l.shape,h=l.direction,p=l.resizeConstraints,f;l.delta=c,f=Ise(d,h,c),l.newBounds=$se(f,p),l.canExecute=i.canResize(l)}function o(l){var c=l.resizeConstraints,d=l.minBounds;c===void 0&&(d===void 0&&(d=i.computeMinResizeBox(l)),l.resizeConstraints={min:dt(d)})}function a(l){var c=l.shape,d=l.canExecute,h=l.newBounds;if(d){if(h=qB(h),!Zce(c,h))return;n.resizeShape(c,h)}}t.on("resize.start",function(l){o(l.context)}),t.on("resize.move",function(l){var c={x:l.dx,y:l.dy};s(l.context,c)}),t.on("resize.end",function(l){a(l.context)})}qv.prototype.canResize=function(t){var e=this._rules,n=ui(t,["newBounds","shape","delta","direction"]);return e.allowed("shape.resize",n)};qv.prototype.activate=function(t,e,n){var r=this._dragging,i,s;if(typeof n=="string"&&(n={direction:n}),i=B({shape:e},n),s=i.direction,!s)throw new Error("must provide a direction (n|w|s|e|nw|se|ne|sw)");r.init(t,Oz(e,s),"resize",{autoActivate:!0,cursor:Jce(s),data:{shape:e,context:i}})};qv.prototype.computeMinResizeBox=function(t){var e=t.shape,n=t.direction,r,i;return r=t.minDimensions||{width:II,height:II},i=f6(e,t.childrenBoxPadding),Mse(n,e,r,i)};qv.$inject=["eventBus","rules","modeling","dragging"];function Zce(t,e){return t.x!==e.x||t.y!==e.y||t.width!==e.width||t.height!==e.height}function Oz(t,e){var n=xt(t),r=dt(t),i={x:n.x,y:n.y};return e.indexOf("n")!==-1?i.y=r.top:e.indexOf("s")!==-1&&(i.y=r.bottom),e.indexOf("e")!==-1?i.x=r.right:e.indexOf("w")!==-1&&(i.x=r.left),i}function Jce(t){var e="resize-";return t==="n"||t==="s"?e+"ns":t==="e"||t==="w"?e+"ew":t==="nw"||t==="se"?e+"nwse":e+"nesw"}var DI="djs-resizing",$I="resize-not-ok",eue=500;function Rz(t,e,n){function r(s){var o=s.shape,a=s.newBounds,l=s.frame;l||(l=s.frame=n.addFrame(o,e.getActiveLayer()),e.addMarker(o,DI)),a.width>5&&K(l,{x:a.x,width:a.width}),a.height>5&&K(l,{y:a.y,height:a.height}),s.canExecute?Ge(l).remove($I):Ge(l).add($I)}function i(s){var o=s.shape,a=s.frame;a&&un(s.frame),e.removeMarker(o,DI)}t.on("resize.move",eue,function(s){r(s.context)}),t.on("resize.cleanup",function(s){i(s.context)})}Rz.$inject=["eventBus","canvas","previewSupport"];var rx=-6,ix=8,sx=20,Sm="djs-resizer",tue=["n","w","s","e","nw","ne","se","sw"];function su(t,e,n,r){this._resize=r,this._canvas=e;var i=this;t.on("selection.changed",function(s){var o=s.newSelection;i.removeResizers(),o.length===1&&$(o,li(i.addResizer,i))}),t.on("shape.changed",function(s){var o=s.element;n.isSelected(o)&&(i.removeResizers(),i.addResizer(o))})}su.prototype.makeDraggable=function(t,e,n){var r=this._resize;function i(s){jk(s)&&r.activate(s,t,n)}ie.bind(e,"mousedown",i),ie.bind(e,"touchstart",i)};su.prototype._createResizer=function(t,e,n,r){var i=this._getResizersParent(),s=nue(r),o=ee("g");Ge(o).add(Sm),Ge(o).add(Sm+"-"+t.id),Ge(o).add(Sm+"-"+r),re(i,o);var a=ee("rect");K(a,{x:-ix/2+s.x,y:-ix/2+s.y,width:ix,height:ix}),Ge(a).add(Sm+"-visual"),re(o,a);var l=ee("rect");return K(l,{x:-sx/2+s.x,y:-sx/2+s.y,width:sx,height:sx}),Ge(l).add(Sm+"-hit"),re(o,l),jX(o,e,n),o};su.prototype.createResizer=function(t,e){var n=Oz(t,e),r=this._createResizer(t,n.x,n.y,e);this.makeDraggable(t,r,e)};su.prototype.addResizer=function(t){var e=this;En(t)||!this._resize.canResize({shape:t})||$(tue,function(n){e.createResizer(t,n)})};su.prototype.removeResizers=function(){var t=this._getResizersParent();Hd(t)};su.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")};su.$inject=["eventBus","canvas","selection","resize"];function nue(t){var e={x:0,y:0};return t.indexOf("e")!==-1?e.x=-rx:t.indexOf("w")!==-1&&(e.x=rx),t.indexOf("s")!==-1?e.y=-rx:t.indexOf("n")!==-1&&(e.y=rx),e}const Az={__depends__:[Vo,Rl,Nf],__init__:["resize","resizePreview","resizeHandles"],resize:["type",qv],resizePreview:["type",Rz],resizeHandles:["type",su]};var rue=2e3;function Wv(t,e,n,r,i,s,o){this._bpmnFactory=e,this._canvas=n,this._modeling=i,this._textRenderer=o,r.registerProvider(this),t.on("element.dblclick",function(l){a(l.element,!0)}),t.on(["autoPlace.start","canvas.viewbox.changing","drag.init","element.mousedown","popupMenu.open","root.set","selection.changed"],function(){r.isActive()&&r.complete()}),t.on(["shape.remove","connection.remove"],rue,function(l){r.isActive(l.element)&&r.cancel()}),t.on(["commandStack.changed"],function(l){r.isActive()&&r.cancel()}),t.on("directEditing.activate",function(l){s.removeResizers()}),t.on("create.end",500,function(l){var c=l.context,d=c.shape,h=l.context.canExecute,p=l.isTouch;p||h&&(c.hints&&c.hints.createElementsBehavior===!1||a(d))}),t.on("autoPlace.end",500,function(l){a(l.shape)});function a(l,c){(c||Lt(l,["bpmn:Task","bpmn:TextAnnotation","bpmn:Participant"])||IP(l))&&r.activate(l)}}Wv.$inject=["eventBus","bpmnFactory","canvas","directEditing","modeling","resizeHandles","textRenderer"];Wv.prototype.activate=function(t){var e=Td(t);if(e!==void 0){var n={text:e},r=this.getEditingBBox(t);B(n,r);var i={},s=n.style||{};return B(s,{backgroundColor:null,border:null}),(Lt(t,["bpmn:Task","bpmn:Participant","bpmn:Lane","bpmn:CallActivity"])||IP(t))&&B(i,{centerVertically:!0}),Ap(t)&&(B(i,{autoResize:!0}),B(s,{backgroundColor:"#ffffff",border:"1px solid #ccc"})),T(t,"bpmn:TextAnnotation")&&(B(i,{resizable:!0,autoResize:!0}),B(s,{backgroundColor:"#ffffff",border:"1px solid #ccc"})),B(n,{options:i,style:s}),n}};Wv.prototype.getEditingBBox=function(t){var e=this._canvas,n=t.label||t,r=e.getAbsoluteBBox(n),i={x:r.x+r.width/2,y:r.y+r.height/2},s={x:r.x,y:r.y},o=e.zoom(),a=this._textRenderer.getDefaultStyle(),l=this._textRenderer.getExternalStyle(),c=l.fontSize*o,d=l.lineHeight,h=a.fontSize*o,p=a.lineHeight,f={fontFamily:this._textRenderer.getDefaultStyle().fontFamily,fontWeight:this._textRenderer.getDefaultStyle().fontWeight};if(T(t,"bpmn:Lane")||oue(t)){var m=Yr(t),g=m?{width:r.height,height:30*o,x:r.x-r.height/2+15*o,y:i.y-30*o/2}:{width:r.width,height:30*o};B(s,g),B(f,{fontSize:h+"px",lineHeight:p,paddingTop:7*o+"px",paddingBottom:7*o+"px",paddingLeft:5*o+"px",paddingRight:5*o+"px",transform:m?"rotate(-90deg)":null})}if(sue(t)){var v=Yr(t),b=v?{width:r.width,height:r.height}:{width:r.height,height:r.width,x:i.x-r.height/2,y:i.y-r.width/2};B(s,b),B(f,{fontSize:h+"px",lineHeight:p,paddingTop:7*o+"px",paddingBottom:7*o+"px",paddingLeft:5*o+"px",paddingRight:5*o+"px",transform:v?null:"rotate(-90deg)"})}(Lt(t,["bpmn:Task","bpmn:CallActivity"])||IP(t))&&(B(s,{width:r.width,height:r.height}),B(f,{fontSize:h+"px",lineHeight:p,paddingTop:7*o+"px",paddingBottom:7*o+"px",paddingLeft:5*o+"px",paddingRight:5*o+"px"})),iue(t)&&(B(s,{width:r.width,x:r.x}),B(f,{fontSize:h+"px",lineHeight:p,paddingTop:7*o+"px",paddingBottom:7*o+"px",paddingLeft:5*o+"px",paddingRight:5*o+"px"}));var x=90*o,y=7*o,w=4*o;if(n.labelTarget&&(B(s,{width:x,height:r.height+y+w,x:i.x-x/2,y:r.y-y}),B(f,{fontSize:c+"px",lineHeight:d,paddingTop:y+"px",paddingBottom:w+"px"})),Ap(n)&&!fw(n)&&!Wt(n)){var E=GB(t),S=e.getAbsoluteBBox({x:E.x,y:E.y,width:0,height:0}),j=c+y+w;B(s,{width:x,height:j,x:S.x-x/2,y:S.y-j/2}),B(f,{fontSize:c+"px",lineHeight:d,paddingTop:y+"px",paddingBottom:w+"px"})}return T(t,"bpmn:TextAnnotation")&&(B(s,{width:r.width,height:r.height,minWidth:30*o,minHeight:10*o}),B(f,{textAlign:"left",paddingTop:5*o+"px",paddingBottom:7*o+"px",paddingLeft:7*o+"px",paddingRight:5*o+"px",fontSize:h+"px",lineHeight:p})),{bounds:s,style:f}};Wv.prototype.update=function(t,e,n,r){var i,s;T(t,"bpmn:TextAnnotation")&&(s=this._canvas.getAbsoluteBBox(t),i={x:t.x,y:t.y,width:t.width/s.width*r.width,height:t.height/s.height*r.height}),aue(e)&&(e=null),this._modeling.updateLabel(t,e,i)};function IP(t){return T(t,"bpmn:SubProcess")&&!rn(t)}function iue(t){return T(t,"bpmn:SubProcess")&&rn(t)}function sue(t){return T(t,"bpmn:Participant")&&!rn(t)}function oue(t){return T(t,"bpmn:Participant")&&rn(t)}function aue(t){return!t||!t.trim()}var MI="djs-element-hidden",LI="djs-label-hidden";function Iz(t,e,n){var r=this,i=e.getDefaultLayer(),s,o,a;t.on("directEditing.activate",function(l){var c=l.active;if(s=c.element.label||c.element,T(s,"bpmn:TextAnnotation")){o=e.getAbsoluteBBox(s),a=ee("g");var d=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:s.width,containerHeight:s.height,position:{mx:0,my:0}}),h=r.path=ee("path");K(h,{d,strokeWidth:2,stroke:lue(s)}),re(a,h),re(i,a),wi(a,s.x,s.y)}T(s,"bpmn:TextAnnotation")||s.labelTarget?e.addMarker(s,MI):(T(s,"bpmn:Task")||T(s,"bpmn:CallActivity")||T(s,"bpmn:SubProcess")||T(s,"bpmn:Participant")||T(s,"bpmn:Lane"))&&e.addMarker(s,LI)}),t.on("directEditing.resize",function(l){if(T(s,"bpmn:TextAnnotation")){var c=l.height,d=l.dy,h=Math.max(s.height/o.height*(c+d),0),p=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:s.width,containerHeight:h,position:{mx:0,my:0}});K(r.path,{d:p})}}),t.on(["directEditing.complete","directEditing.cancel"],function(l){var c=l.active;c&&(e.removeMarker(c.element.label||c.element,MI),e.removeMarker(s,LI)),s=void 0,o=void 0,a&&(un(a),a=void 0)})}Iz.$inject=["eventBus","canvas","pathMap"];function lue(t,e){var n=yn(t);return n.get("stroke")||e||"black"}const cue={__depends__:[KB,Az,_z],__init__:["labelEditingProvider","labelEditingPreview"],labelEditingProvider:["type",Wv],labelEditingPreview:["type",Iz]};var uue=new _k("tt");function due(t){var e=bt('<div class="djs-tooltip-container" />');return La(e,{position:"absolute",width:"0",height:"0"}),t.insertBefore(e,t.firstChild),e}function hue(t,e,n){La(t,{left:e+"px",top:n+"px"})}function DP(t,e){t.style.display=e===!1?"none":""}var Dz="djs-tooltip",gE="."+Dz;function qi(t,e){this._eventBus=t,this._canvas=e,this._ids=uue,this._tooltipDefaults={show:{minZoom:.7,maxZoom:5}},this._tooltips={},this._tooltipRoot=due(e.getContainer());var n=this;Zn.bind(this._tooltipRoot,gE,"mousedown",function(r){r.stopPropagation()}),Zn.bind(this._tooltipRoot,gE,"mouseover",function(r){n.trigger("mouseover",r)}),Zn.bind(this._tooltipRoot,gE,"mouseout",function(r){n.trigger("mouseout",r)}),this._init()}qi.$inject=["eventBus","canvas"];qi.prototype.add=function(t){if(!t.position)throw new Error("must specifiy tooltip position");if(!t.html)throw new Error("must specifiy tooltip html");var e=this._ids.next();return t=B({},this._tooltipDefaults,t,{id:e}),this._addTooltip(t),t.timeout&&this.setTimeout(t),e};qi.prototype.trigger=function(t,e){var n=e.delegateTarget||e.target,r=this.get(vn(n,"data-tooltip-id"));r&&(t==="mouseover"&&r.timeout&&this.clearTimeout(r),t==="mouseout"&&r.timeout&&(r.timeout=1e3,this.setTimeout(r)))};qi.prototype.get=function(t){return typeof t!="string"&&(t=t.id),this._tooltips[t]};qi.prototype.clearTimeout=function(t){if(t=this.get(t),!!t){var e=t.removeTimer;e&&(clearTimeout(e),t.removeTimer=null)}};qi.prototype.setTimeout=function(t){if(t=this.get(t),!!t){this.clearTimeout(t);var e=this;t.removeTimer=setTimeout(function(){e.remove(t)},t.timeout)}};qi.prototype.remove=function(t){var e=this.get(t);e&&(Nr(e.html),Nr(e.htmlContainer),delete e.htmlContainer,delete this._tooltips[e.id])};qi.prototype.show=function(){DP(this._tooltipRoot)};qi.prototype.hide=function(){DP(this._tooltipRoot,!1)};qi.prototype._updateRoot=function(t){var e=t.scale||1,n=t.scale||1,r="matrix("+e+",0,0,"+n+","+-1*t.x*e+","+-1*t.y*n+")";this._tooltipRoot.style.transform=r,this._tooltipRoot.style["-ms-transform"]=r};qi.prototype._addTooltip=function(t){var e=t.id,n=t.html,r,i=this._tooltipRoot;n.get&&n.constructor.prototype.jquery&&(n=n.get(0)),Fi(n)&&(n=bt(n)),r=bt('<div data-tooltip-id="'+e+'" class="'+Dz+'">'),La(r,{position:"absolute"}),r.appendChild(n),t.type&&vt(r).add("djs-tooltip-"+t.type),t.className&&vt(r).add(t.className),t.htmlContainer=r,i.appendChild(r),this._tooltips[e]=t,this._updateTooltip(t)};qi.prototype._updateTooltip=function(t){var e=t.position,n=t.htmlContainer;hue(n,e.x,e.y)};qi.prototype._updateTooltipVisibilty=function(t){$(this._tooltips,function(e){var n=e.show,r=e.htmlContainer,i=!0;n&&((n.minZoom>t.scale||n.maxZoom<t.scale)&&(i=!1),DP(r,i))})};qi.prototype._init=function(){var t=this;function e(n){t._updateRoot(n),t._updateTooltipVisibilty(n),t.show()}this._eventBus.on("canvas.viewbox.changing",function(n){t.hide()}),this._eventBus.on("canvas.viewbox.changed",function(n){e(n.viewbox)})};const pue={__init__:["tooltips"],tooltips:["type",qi]};var fue="flow elements must be children of pools/participants",mue="Data object must be placed within a pool/participant.";function $z(t,e,n){function r(i,s,o){e.add({position:{x:i.x+5,y:i.y+5},type:"error",timeout:2e3,html:"<div>"+s+"</div>"})}t.on(["shape.move.rejected","create.rejected"],function(i){var s=i.context,o=s.shape,a=s.target;T(a,"bpmn:Collaboration")&&(T(o,"bpmn:FlowNode")?r(i,n(fue)):T(o,"bpmn:DataObjectReference")&&r(i,n(mue)))})}$z.$inject=["eventBus","tooltips","translate"];const gue={__depends__:[pue],__init__:["modelingFeedback"],modelingFeedback:["type",$z]};var vue=500,yue=1e3;function Yd(t,e){this._eventBus=t,this.offset=5;var n=e.cls("djs-outline",["no-fill"]),r=this;function i(s){var o=ee("rect");return K(o,B({x:0,y:0,rx:4,width:100,height:100},n)),o}t.on(["shape.added","shape.changed"],vue,function(s){var o=s.element,a=s.gfx,l=at(".djs-outline",a);l||(l=r.getOutline(o)||i(),re(a,l)),r.updateShapeOutline(l,o)}),t.on(["connection.added","connection.changed"],function(s){var o=s.element,a=s.gfx,l=at(".djs-outline",a);l||(l=i(),re(a,l)),r.updateConnectionOutline(l,o)})}Yd.prototype.updateShapeOutline=function(t,e){var n=!1,r=this._getProviders();r.length&&$(r,function(i){n=n||i.updateOutline(e,t)}),n||K(t,{x:-this.offset,y:-this.offset,width:e.width+this.offset*2,height:e.height+this.offset*2})};Yd.prototype.updateConnectionOutline=function(t,e){var n=Di(e);K(t,{x:n.x-this.offset,y:n.y-this.offset,width:n.width+this.offset*2,height:n.height+this.offset*2})};Yd.prototype.registerProvider=function(t,e){e||(e=t,t=yue),this._eventBus.on("outline.getProviders",t,function(n){n.providers.push(e)})};Yd.prototype._getProviders=function(){var t=this._eventBus.createEvent({type:"outline.getProviders",providers:[]});return this._eventBus.fire(t),t.providers};Yd.prototype.getOutline=function(t){var e,n=this._getProviders();return $(n,function(r){Bt(r.getOutline)&&(e=e||r.getOutline(t))}),e};Yd.$inject=["eventBus","styles","elementRegistry"];var ox=6;function $P(t,e,n){this._canvas=e;var r=this;t.on("element.changed",function(i){n.isSelected(i.element)&&r._updateMultiSelectionOutline(n.get())}),t.on("selection.changed",function(i){var s=i.newSelection;r._updateMultiSelectionOutline(s)})}$P.prototype._updateMultiSelectionOutline=function(t){var e=this._canvas.getLayer("selectionOutline");Hd(e);var n=t.length>1,r=this._canvas.getContainer();if(Ge(r)[n?"add":"remove"]("djs-multi-select"),!!n){var i=xue(Di(t)),s=ee("rect");K(s,B({rx:3},i)),Ge(s).add("djs-selection-outline"),re(e,s)}};$P.$inject=["eventBus","canvas","selection"];function xue(t){return{x:t.x-ox,y:t.y-ox,width:t.width+ox*2,height:t.height+ox*2}}const Mz={__depends__:[Ma],__init__:["outline","multiSelectionOutline"],outline:["type",Yd],multiSelectionOutline:["type",$P]};var bue=500,wue=1250,_ue=1500,b0=Math.round;function Eue(t){return{x:t.x+b0(t.width/2),y:t.y+b0(t.height/2)}}function Lz(t,e,n,r,i){function s(a,l,c,d){return i.allowed("elements.move",{shapes:a,delta:l,position:c,target:d})}t.on("shape.move.start",_ue,function(a){var l=a.context,c=a.shape,d=r.get().slice();d.indexOf(c)===-1&&(d=[c]),d=Sue(d),B(l,{shapes:d,validatedShapes:d,shape:c})}),t.on("shape.move.start",wue,function(a){var l=a.context,c=l.validatedShapes,d;if(d=l.canExecute=s(c),!d)return!1}),t.on("shape.move.move",bue,function(a){var l=a.context,c=l.validatedShapes,d=a.hover,h={x:a.dx,y:a.dy},p={x:a.x,y:a.y},f;if(f=s(c,h,p,d),l.delta=h,l.canExecute=f,f===null){l.target=null;return}l.target=d}),t.on("shape.move.end",function(a){var l=a.context,c=l.delta,d=l.canExecute,h=d==="attach",p=l.shapes;if(d===!1)return!1;c.x=b0(c.x),c.y=b0(c.y),!(c.x===0&&c.y===0)&&n.moveElements(p,c,l.target,{primaryShape:l.shape,attach:h})}),t.on("element.mousedown",function(a){if(jk(a)){var l=HB(a);if(!l)throw new Error("must supply DOM mousedown event");return o(l,a.element)}});function o(a,l,c,d){if(Wn(c)&&(d=c,c=!1),!(l.waypoints||!l.parent)&&!Ge(a.target).has("djs-hit-no-move")){var h=Eue(l);return e.init(a,h,"shape.move",{cursor:"grabbing",autoActivate:c,data:{shape:l,context:d||{}}}),!0}}this.start=o}Lz.$inject=["eventBus","dragging","modeling","selection","rules"];function Sue(t){var e=Kc(t,"id");return ht(t,function(n){for(;n=n.parent;)if(e[n.id])return!1;return!0})}var BI=499,vE="djs-dragging",FI="drop-ok",zI="drop-not-ok",HI="new-parent",UI="attach-ok";function Bz(t,e,n,r){function i(l){var c=s(l),d=Cue(c);return d}function s(l){var c=vv(l,!0),d=c.flatMap(f=>(f.incoming||[]).concat(f.outgoing||[])),h=c.concat(d),p=[...new Set(h)];return p}function o(l,c){[UI,FI,zI,HI].forEach(function(d){d===c?e.addMarker(l,d):e.removeMarker(l,d)})}function a(l,c,d){r.addDragger(c,l.dragGroup),d&&e.addMarker(c,vE),l.allDraggedElements?l.allDraggedElements.push(c):l.allDraggedElements=[c]}t.on("shape.move.start",BI,function(l){var c=l.context,d=c.shapes,h=c.allDraggedElements,p=i(d);if(!c.dragGroup){var f=ee("g");K(f,n.cls("djs-drag-group",["no-events"]));var m=e.getActiveLayer();re(m,f),c.dragGroup=f}p.forEach(function(g){r.addDragger(g,c.dragGroup)}),h?h=Cg([h,s(d)]):h=s(d),$(h,function(g){e.addMarker(g,vE)}),c.allDraggedElements=h,c.differentParents=jue(d)}),t.on("shape.move.move",BI,function(l){var c=l.context,d=c.dragGroup,h=c.target,p=c.shape.parent,f=c.canExecute;h&&(f==="attach"?o(h,UI):c.canExecute&&p&&h.id!==p.id?o(h,HI):o(h,c.canExecute?FI:zI)),wi(d,l.dx,l.dy)}),t.on(["shape.move.out","shape.move.cleanup"],function(l){var c=l.context,d=c.target;d&&o(d,null)}),t.on("shape.move.cleanup",function(l){var c=l.context,d=c.allDraggedElements,h=c.dragGroup;$(d,function(p){e.removeMarker(p,vE)}),h&&un(h)}),this.makeDraggable=a}Bz.$inject=["eventBus","canvas","styles","previewSupport"];function Cue(t){var e=ht(t,function(n){return En(n)?Tt(t,Cs({id:n.source.id}))&&Tt(t,Cs({id:n.target.id})):!0});return e}function jue(t){return YB(Kc(t,function(e){return e.parent&&e.parent.id}))!==1}const kue={__depends__:[Ek,Ma,Mz,Vo,Rl,Nf],__init__:["move","movePreview"],move:["type",Lz],movePreview:["type",Bz]};var Fz=".djs-palette-toggle",zz=".entry",Pue=Fz+", "+zz,OC="djs-palette-",Tue="shown",RC="open",VI="two-column",Nue=1e3;function lr(t,e){this._eventBus=t,this._canvas=e;var n=this;t.on("tool-manager.update",function(r){var i=r.tool;n.updateToolHighlight(i)}),t.on("i18n.changed",function(){n._update()}),t.on("diagram.init",function(){n._diagramInitialized=!0,n._rebuild()})}lr.$inject=["eventBus","canvas"];lr.prototype.registerProvider=function(t,e){e||(e=t,t=Nue),this._eventBus.on("palette.getProviders",t,function(n){n.providers.push(e)}),this._rebuild()};lr.prototype.getEntries=function(){var t=this._getProviders();return t.reduce(Rue,{})};lr.prototype._rebuild=function(){if(this._diagramInitialized){var t=this._getProviders();t.length&&(this._container||this._init(),this._update())}};lr.prototype._init=function(){var t=this,e=this._eventBus,n=this._getParentContainer(),r=this._container=bt(lr.HTML_MARKUP);n.appendChild(r),vt(n).add(OC+Tue),Zn.bind(r,Pue,"click",function(i){var s=i.delegateTarget;if(zd(s,Fz))return t.toggle();t.trigger("click",i)}),ie.bind(r,"mousedown",function(i){i.stopPropagation()}),Zn.bind(r,zz,"dragstart",function(i){t.trigger("dragstart",i)}),e.on("canvas.resized",this._layoutChanged,this),e.fire("palette.create",{container:r})};lr.prototype._getProviders=function(t){var e=this._eventBus.createEvent({type:"palette.getProviders",providers:[]});return this._eventBus.fire(e),e.providers};lr.prototype._toggleState=function(t){t=t||{};var e=this._getParentContainer(),n=this._container,r=this._eventBus,i,s=vt(n),o=vt(e);"twoColumn"in t?i=t.twoColumn:i=this._needsCollapse(e.clientHeight,this._entries||{}),s.toggle(VI,i),o.toggle(OC+VI,i),"open"in t&&(s.toggle(RC,t.open),o.toggle(OC+RC,t.open)),r.fire("palette.changed",{twoColumn:i,open:this.isOpen()})};lr.prototype._update=function(){var t=at(".djs-palette-entries",this._container),e=this._entries=this.getEntries();xf(t),$(e,function(n,r){var i=n.group||"default",s=at("[data-group="+Sg(i)+"]",t);s||(s=bt('<div class="group"></div>'),vn(s,"data-group",i),t.appendChild(s));var o=n.html||(n.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),a=bt(o);if(s.appendChild(a),!n.separator&&(vn(a,"data-action",r),n.title&&vn(a,"title",n.title),n.className&&Oue(a,n.className),n.imageUrl)){var l=bt("<img>");vn(l,"src",n.imageUrl),a.appendChild(l)}}),this.open()};lr.prototype.trigger=function(t,e,n){var r,i,s=e.delegateTarget||e.target;return s?(r=vn(s,"data-action"),i=e.originalEvent||e,this.triggerEntry(r,t,i,n)):e.preventDefault()};lr.prototype.triggerEntry=function(t,e,n,r){var i=this._entries,s,o;if(s=i[t],!!s&&(o=s.action,this._eventBus.fire("palette.trigger",{entry:s,event:n})!==!1)){if(Bt(o)){if(e==="click")return o(n,r)}else if(o[e])return o[e](n,r);n.preventDefault()}};lr.prototype._layoutChanged=function(){this._toggleState({})};lr.prototype._needsCollapse=function(t,e){var n=50,r=Object.keys(e).length*46;return t<r+n};lr.prototype.close=function(){this._toggleState({open:!1,twoColumn:!1})};lr.prototype.open=function(){this._toggleState({open:!0})};lr.prototype.toggle=function(){this.isOpen()?this.close():this.open()};lr.prototype.isActiveTool=function(t){return t&&this._activeTool===t};lr.prototype.updateToolHighlight=function(t){var e,n;this._toolsContainer||(e=at(".djs-palette-entries",this._container),this._toolsContainer=at("[data-group=tools]",e)),n=this._toolsContainer,$(n.children,function(r){var i=r.getAttribute("data-action");if(i){var s=vt(r);i=i.replace("-tool",""),s.contains("entry")&&i===t?s.add("highlighted-entry"):s.remove("highlighted-entry")}})};lr.prototype.isOpen=function(){return vt(this._container).has(RC)};lr.prototype._getParentContainer=function(){return this._canvas.getContainer()};lr.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>';function Oue(t,e){var n=vt(t),r=ke(e)?e:e.split(/\s+/g);r.forEach(function(i){n.add(i)})}function Rue(t,e){var n=e.getPaletteEntries();return Bt(n)?n(t):($(n,function(r,i){t[i]=r}),t)}const Aue={__init__:["palette"],palette:["type",lr]};var Hz="crosshair";function Xd(t,e,n,r,i,s,o){this._selection=i,this._dragging=n,this._mouse=o;var a=this,l={create:function(c){var d=e.getActiveLayer(),h;h=c.frame=ee("rect"),K(h,{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),re(d,h)},update:function(c){var d=c.frame,h=c.bbox;K(d,{x:h.x,y:h.y,width:h.width,height:h.height})},remove:function(c){c.frame&&un(c.frame)}};s.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),t.on("lasso.selection.end",function(c){var d=c.originalEvent.target;!c.hover&&!(d instanceof SVGElement)||t.once("lasso.selection.ended",function(){a.activateLasso(c.originalEvent,!0)})}),t.on("lasso.end",0,function(c){var d=c.context,h=yE(c),p=r.filter(function(m){return m}),f=$S(c);a.select(p,h,f?d.selection:[])}),t.on("lasso.start",function(c){var d=c.context;d.bbox=yE(c),l.create(d),d.selection=i.get()}),t.on("lasso.move",function(c){var d=c.context;d.bbox=yE(c),l.update(d)}),t.on("lasso.cleanup",function(c){var d=c.context;l.remove(d)}),t.on("element.mousedown",1500,function(c){if($S(c))return a.activateLasso(c.originalEvent),!0})}Xd.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager","mouse"];Xd.prototype.activateLasso=function(t,e){this._dragging.init(t,"lasso",{autoActivate:e,cursor:Hz,data:{context:{}}})};Xd.prototype.activateSelection=function(t,e){this._dragging.init(t,"lasso.selection",{trapClick:!1,autoActivate:e,cursor:Hz,data:{context:{}},keepSelection:!0})};Xd.prototype.select=function(t,e,n=[]){var r=WB(t,e);this._selection.select([...n,...yf(r)])};Xd.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateSelection(t,!!t)};Xd.prototype.isActive=function(){var t=this._dragging.context();return t&&/^lasso/.test(t.prefix)};function yE(t){var e={x:t.x-t.dx,y:t.y-t.dy},n={x:t.x,y:t.y},r;return e.x<=n.x&&e.y<n.y||e.x<n.x&&e.y<=n.y?r={x:e.x,y:e.y,width:n.x-e.x,height:n.y-e.y}:e.x>=n.x&&e.y<n.y||e.x>n.x&&e.y<=n.y?r={x:n.x,y:e.y,width:e.x-n.x,height:n.y-e.y}:e.x<=n.x&&e.y>n.y||e.x<n.x&&e.y>=n.y?r={x:e.x,y:n.y,width:n.x-e.x,height:e.y-n.y}:e.x>=n.x&&e.y>n.y||e.x>n.x&&e.y>=n.y?r={x:n.x,y:n.y,width:e.x-n.x,height:e.y-n.y}:r={x:n.x,y:n.y,width:0,height:0},r}const Iue={__depends__:[Ww,Nv],__init__:["lassoTool"],lassoTool:["type",Xd]};var xE=1500,Uz="grab";function Of(t,e,n,r,i,s){this._dragging=n,this._mouse=s;var o=this,a=r.get("keyboard",!1);i.registerTool("hand",{tool:"hand",dragging:"hand.move"}),t.on("element.mousedown",xE,function(l){if(Pg(l))return o.activateMove(l.originalEvent,!0),!1}),a&&a.addListener(xE,function(l){if(!(!qI(l.keyEvent)||o.isActive())){var c=o._mouse.getLastMoveEvent();o.activateMove(c,!!c)}},"keyboard.keydown"),a&&a.addListener(xE,function(l){!qI(l.keyEvent)||!o.isActive()||o.toggle()},"keyboard.keyup"),t.on("hand.end",function(l){var c=l.originalEvent.target;if(!l.hover&&!(c instanceof SVGElement))return!1;t.once("hand.ended",function(){o.activateMove(l.originalEvent,{reactivate:!0})})}),t.on("hand.move.move",function(l){var c=e.viewbox().scale;e.scroll({dx:l.dx*c,dy:l.dy*c})}),t.on("hand.move.end",function(l){var c=l.context,d=c.reactivate;return!Pg(l)&&d&&t.once("hand.move.ended",function(h){o.activateHand(h.originalEvent,!0,!0)}),!1})}Of.$inject=["eventBus","canvas","dragging","injector","toolManager","mouse"];Of.prototype.activateMove=function(t,e,n){typeof e=="object"&&(n=e,e=!1),this._dragging.init(t,"hand.move",{autoActivate:e,cursor:Uz,data:{context:n||{}}})};Of.prototype.activateHand=function(t,e,n){this._dragging.init(t,"hand",{trapClick:!1,autoActivate:e,cursor:Uz,data:{context:{reactivate:n}}})};Of.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateHand(t,!!t)};Of.prototype.isActive=function(){var t=this._dragging.context();return t?/^(hand|hand\.move)$/.test(t.prefix):!1};function qI(t){return Lr("Space",t)}const Due={__depends__:[Ww,Nv],__init__:["handTool"],handTool:["type",Of]};var WI="connect-ok",GI="connect-not-ok";function Rf(t,e,n,r,i,s,o){var a=this;this._dragging=e,this._rules=s,this._mouse=o,i.registerTool("global-connect",{tool:"global-connect",dragging:"global-connect.drag"}),t.on("global-connect.hover",function(l){var c=l.context,d=l.hover,h=c.canStartConnect=a.canStartConnect(d);h!==null&&(c.startTarget=d,r.addMarker(d,h?WI:GI))}),t.on(["global-connect.out","global-connect.cleanup"],function(l){var c=l.context.startTarget,d=l.context.canStartConnect;c&&r.removeMarker(c,d?WI:GI)}),t.on(["global-connect.ended"],function(l){var c=l.context,d=c.startTarget,h={x:l.x,y:l.y},p=a.canStartConnect(d);if(p)return t.once("element.out",function(){t.once(["connect.ended","connect.canceled"],function(){t.fire("global-connect.drag.ended")}),n.start(null,d,h)}),!1})}Rf.$inject=["eventBus","dragging","connect","canvas","toolManager","rules","mouse"];Rf.prototype.start=function(t,e){this._dragging.init(t,"global-connect",{autoActivate:e,trapClick:!1,data:{context:{}}})};Rf.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();return this.start(t,!!t)};Rf.prototype.isActive=function(){var t=this._dragging.context();return t&&/^global-connect/.test(t.prefix)};Rf.prototype.canStartConnect=function(t){return this._rules.allowed("connection.start",{source:t})};const $ue={__depends__:[T2,Vo,Rl,Ww,Nv],globalConnect:["type",Rf]};function MP(t,e,n,r,i,s,o,a){this._palette=t,this._create=e,this._elementFactory=n,this._spaceTool=r,this._lassoTool=i,this._handTool=s,this._globalConnect=o,this._translate=a,t.registerProvider(this)}MP.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"];MP.prototype.getPaletteEntries=function(){var t={},e=this._create,n=this._elementFactory,r=this._spaceTool,i=this._lassoTool,s=this._handTool,o=this._globalConnect,a=this._translate;function l(h,p,f,m,g){function v(b){var x=n.createShape(B({type:h},g));e.start(b,x)}return{group:p,className:f,title:m,action:{dragstart:v,click:v}}}function c(h){var p=n.createShape({type:"bpmn:SubProcess",x:0,y:0,isExpanded:!0}),f=n.createShape({type:"bpmn:StartEvent",x:40,y:82,parent:p});e.start(h,[p,f],{hints:{autoSelect:[p]}})}function d(h){e.start(h,n.createParticipantShape())}return B(t,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:a("Activate hand tool"),action:{click:function(h){s.activateHand(h)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:a("Activate lasso tool"),action:{click:function(h){i.activateSelection(h)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:a("Activate create/remove space tool"),action:{click:function(h){r.activateSelection(h)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:a("Activate global connect tool"),action:{click:function(h){o.start(h)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":l("bpmn:StartEvent","event","bpmn-icon-start-event-none",a("Create start event")),"create.intermediate-event":l("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",a("Create intermediate/boundary event")),"create.end-event":l("bpmn:EndEvent","event","bpmn-icon-end-event-none",a("Create end event")),"create.exclusive-gateway":l("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-none",a("Create gateway")),"create.task":l("bpmn:Task","activity","bpmn-icon-task",a("Create task")),"create.data-object":l("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",a("Create data object reference")),"create.data-store":l("bpmn:DataStoreReference","data-store","bpmn-icon-data-store",a("Create data store reference")),"create.subprocess-expanded":{group:"activity",className:"bpmn-icon-subprocess-expanded",title:a("Create expanded sub-process"),action:{dragstart:c,click:c}},"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:a("Create pool/participant"),action:{dragstart:d,click:d}},"create.group":l("bpmn:Group","artifact","bpmn-icon-group",a("Create group"))}),t};const Mue={__depends__:[Aue,qw,rz,Iue,Due,$ue,XB],__init__:["paletteProvider"],paletteProvider:["type",MP]};var Lue=250;function LP(t,e,n,r,i){ye.call(this,t);function s(a){var l=a.canExecute.replacements;$(l,function(c){var d=c.oldElementId,h={type:c.newElementType};if(!a.visualReplacements[d]){var p=e.get(d);B(h,{x:p.x,y:p.y});var f=n.createShape(h);r.addShape(f,p.parent);var m=at('[data-element-id="'+Sg(p.id)+'"]',a.dragGroup);m&&K(m,{display:"none"});var g=i.addDragger(f,a.dragGroup);a.visualReplacements[d]=g,r.removeShape(f)}})}function o(a){var l=a.visualReplacements;$(l,function(c,d){var h=at('[data-element-id="'+Sg(d)+'"]',a.dragGroup);h&&K(h,{display:"inline"}),c.remove(),l[d]&&delete l[d]})}t.on("shape.move.move",Lue,function(a){var l=a.context,c=l.canExecute;l.visualReplacements||(l.visualReplacements={}),c&&c.replacements?s(l):o(l)})}LP.$inject=["eventBus","elementRegistry","elementFactory","canvas","previewSupport"];Ce(LP,ye);const Bue={__depends__:[Nf],__init__:["bpmnReplacePreview"],bpmnReplacePreview:["type",LP]};var Fue=1250,bE=40,zue=20,Hue=10,KI=20,Vz=["x","y"],Uue=Math.abs;function qz(t){t.on(["connect.hover","connect.move","connect.end"],Fue,function(e){var n=e.context,r=n.canExecute,i=n.start,s=n.hover,o=n.source,a=n.target;e.originalEvent&&Js(e.originalEvent)||(n.initialConnectionStart||(n.initialConnectionStart=n.connectionStart),r&&s&&Vue(e,s,Kue(s)),s&&Gue(r,["bpmn:Association","bpmn:DataInputAssociation","bpmn:DataOutputAssociation","bpmn:SequenceFlow"])?(n.connectionStart=Ys(i),Lt(s,["bpmn:Event","bpmn:Gateway"])&&YI(e,Ys(s)),Lt(s,["bpmn:Task","bpmn:SubProcess"])&&que(e,s),T(o,"bpmn:BoundaryEvent")&&a===o.host&&Wue(e)):Wz(r,"bpmn:MessageFlow")?(T(i,"bpmn:Event")&&(n.connectionStart=Ys(i)),T(s,"bpmn:Event")&&YI(e,Ys(s))):n.connectionStart=n.initialConnectionStart)})}qz.$inject=["eventBus"];function Vue(t,e,n){Vz.forEach(function(r){var i=Gz(r,e);t[r]<e[r]+n?ar(t,r,e[r]+n):t[r]>e[r]+i-n&&ar(t,r,e[r]+i-n)})}function que(t,e){var n=Ys(e);Vz.forEach(function(r){Yue(t,e,r)&&ar(t,r,n[r])})}function Wue(t){var e=t.context,n=e.source,r=e.target;if(!Xue(e)){var i=Ys(n),s=ci(i,r,-10),o=[];/top|bottom/.test(s)&&o.push("x"),/left|right/.test(s)&&o.push("y"),o.forEach(function(a){var l=t[a],c;Uue(l-i[a])<bE&&(l>i[a]?c=i[a]+bE:c=i[a]-bE,ar(t,a,c))})}}function YI(t,e){ar(t,"x",e.x),ar(t,"y",e.y)}function Wz(t,e){return t&&t.type===e}function Gue(t,e){return Yc(e,function(n){return Wz(t,n)})}function Gz(t,e){return t==="x"?e.width:e.height}function Kue(t){return T(t,"bpmn:Task")?Hue:zue}function Yue(t,e,n){return t[n]>e[n]+KI&&t[n]<e[n]+Gz(n,e)-KI}function Xue(t){var e=t.hover,n=t.source;return e&&n&&e===n}function ou(){this._targets={},this._snapOrigins={},this._snapLocations=[],this._defaultSnaps={}}ou.prototype.getSnapOrigin=function(t){return this._snapOrigins[t]};ou.prototype.setSnapOrigin=function(t,e){this._snapOrigins[t]=e,this._snapLocations.indexOf(t)===-1&&this._snapLocations.push(t)};ou.prototype.addDefaultSnap=function(t,e){var n=this._defaultSnaps[t];n||(n=this._defaultSnaps[t]=[]),n.push(e)};ou.prototype.getSnapLocations=function(){return this._snapLocations};ou.prototype.setSnapLocations=function(t){this._snapLocations=t};ou.prototype.pointsForTarget=function(t){var e=t.id||t,n=this._targets[e];return n||(n=this._targets[e]=new u_,n.initDefaults(this._defaultSnaps)),n};function u_(){this._snapValues={}}u_.prototype.add=function(t,e){var n=this._snapValues[t];n||(n=this._snapValues[t]={x:[],y:[]}),n.x.indexOf(e.x)===-1&&n.x.push(e.x),n.y.indexOf(e.y)===-1&&n.y.push(e.y)};u_.prototype.snap=function(t,e,n,r){var i=this._snapValues[e];return i&&sse(t[n],i[n],r)};u_.prototype.initDefaults=function(t){var e=this;$(t||{},function(n,r){$(n,function(i){e.add(r,i)})})};var Que=1250;function za(t,e,n){var r=this;this._elementRegistry=t,e.on(["create.start","shape.move.start"],function(i){r.initSnap(i)}),e.on(["create.move","create.end","shape.move.move","shape.move.end"],Que,function(i){var s=i.context,o=s.shape,a=s.snapContext,l=s.target;if(!(i.originalEvent&&Js(i.originalEvent))&&!(Vp(i)||!l)){var c=a.pointsForTarget(l);c.initialized||(c=r.addSnapTargetPoints(c,o,l),c.initialized=!0),n.snap(i,c)}}),e.on(["create.cleanup","shape.move.cleanup"],function(){n.hide()})}za.$inject=["elementRegistry","eventBus","snapping"];za.prototype.initSnap=function(t){var e=this._elementRegistry,n=t.context,r=n.shape,i=n.snapContext;i||(i=n.snapContext=new ou);var s;e.get(r.id)?s=Ys(r,t):s={x:t.x+Ys(r).x,y:t.y+Ys(r).y};var o={x:s.x-r.width/2,y:s.y-r.height/2},a={x:s.x+r.width/2,y:s.y+r.height/2};return i.setSnapOrigin("mid",{x:s.x-t.x,y:s.y-t.y}),Wt(r)||(i.setSnapOrigin("top-left",{x:o.x-t.x,y:o.y-t.y}),i.setSnapOrigin("bottom-right",{x:a.x-t.x,y:a.y-t.y})),i};za.prototype.addSnapTargetPoints=function(t,e,n){var r=this.getSnapTargets(e,n);return $(r,function(i){if(Wt(i)){Wt(e)&&t.add("mid",Ys(i));return}if(En(i)){if(i.waypoints.length<3)return;var s=i.waypoints.slice(1,-1);$(s,function(o){t.add("mid",o)});return}t.add("mid",Ys(i))}),!Oe(e.x)||!Oe(e.y)||this._elementRegistry.get(e.id)&&t.add("mid",Ys(e)),t};za.prototype.getSnapTargets=function(t,e){return o6(e).filter(function(n){return!Zue(n)})};function Zue(t){return!!t.hidden}var XI=1500;function Af(t,e){e.invoke(za,this),t.on(["create.move","create.end"],XI,nde),t.on(["create.move","create.end","shape.move.move","shape.move.end"],XI,function(n){var r=n.context,i=r.canExecute,s=r.target,o=i&&(i==="attach"||i.attach);o&&!Vp(n)&&Jue(n,s)})}Ce(Af,za);Af.$inject=["eventBus","injector"];Af.prototype.initSnap=function(t){var e=za.prototype.initSnap.call(this,t),n=t.shape,r=!!this._elementRegistry.get(n.id);return $(n.outgoing,function(i){var s=i.waypoints[0];s=s.original||s,e.setSnapOrigin(i.id+"-docking",ZI(s,r,t))}),$(n.incoming,function(i){var s=i.waypoints[i.waypoints.length-1];s=s.original||s,e.setSnapOrigin(i.id+"-docking",ZI(s,r,t))}),T(n,"bpmn:Participant")&&e.setSnapLocations(["top-left","bottom-right","mid"]),e};Af.prototype.addSnapTargetPoints=function(t,e,n){za.prototype.addSnapTargetPoints.call(this,t,e,n);var r=this.getSnapTargets(e,n);$(r,function(s){(tde(s)||ede([e,s],"bpmn:TextAnnotation"))&&(t.add("top-left",i6(s)),t.add("bottom-right",s6(s)))});var i=this._elementRegistry;return $(e.incoming,function(s){if(i.get(e.id)){QI(r,s.source)||t.add("mid",xt(s.source));var o=s.waypoints[0];t.add(s.id+"-docking",o.original||o)}}),$(e.outgoing,function(s){if(i.get(e.id)){QI(r,s.target)||t.add("mid",xt(s.target));var o=s.waypoints[s.waypoints.length-1];t.add(s.id+"-docking",o.original||o)}}),T(n,"bpmn:SequenceFlow")&&(t=this.addSnapTargetPoints(t,e,n.parent)),t};Af.prototype.getSnapTargets=function(t,e){return za.prototype.getSnapTargets.call(this,t,e).filter(function(n){return!T(n,"bpmn:Lane")})};function Jue(t,e){var n=dt(e),r=R6(t,e),i=t.context,s=i.shape,o;s.parent?o={x:0,y:0}:o=xt(s),/top/.test(r)?ar(t,"y",n.top-o.y):/bottom/.test(r)&&ar(t,"y",n.bottom-o.y),/left/.test(r)?ar(t,"x",n.left-o.x):/right/.test(r)&&ar(t,"x",n.right-o.x)}function ede(t,e){return t.every(function(n){return T(n,e)})}function tde(t){return T(t,"bpmn:SubProcess")&&rn(t)?!0:T(t,"bpmn:Participant")}function nde(t){var e=t.context,n=e.createConstraints;if(n){var r=n.top,i=n.right,s=n.bottom,o=n.left;(o&&o>=t.x||i&&i<=t.x)&&ar(t,"x",t.x),(r&&r>=t.y||s&&s<=t.y)&&ar(t,"y",t.y)}}function QI(t,e){return t.indexOf(e)!==-1}function ZI(t,e,n){return e?{x:t.x-n.x,y:t.y-n.y}:{x:t.x,y:t.y}}var rde=1250;function Gv(t,e){var n=this;t.on(["resize.start"],function(r){n.initSnap(r)}),t.on(["resize.move","resize.end"],rde,function(r){var i=r.context,s=i.shape,o=s.parent,a=i.direction,l=i.snapContext;if(!(r.originalEvent&&Js(r.originalEvent))&&!Vp(r)){var c=l.pointsForTarget(o);c.initialized||(c=n.addSnapTargetPoints(c,s,o,a),c.initialized=!0),ode(a)&&ar(r,"x",r.x),ade(a)&&ar(r,"y",r.y),e.snap(r,c)}}),t.on(["resize.cleanup"],function(){e.hide()})}Gv.prototype.initSnap=function(t){var e=t.context,n=e.shape,r=e.direction,i=e.snapContext;i||(i=e.snapContext=new ou);var s=Kz(n,r);return i.setSnapOrigin("corner",{x:s.x-t.x,y:s.y-t.y}),i};Gv.prototype.addSnapTargetPoints=function(t,e,n,r){var i=this.getSnapTargets(e,n);return $(i,function(s){t.add("corner",s6(s)),t.add("corner",i6(s))}),t.add("corner",Kz(e,r)),t};Gv.$inject=["eventBus","snapping"];Gv.prototype.getSnapTargets=function(t,e){return o6(e).filter(function(n){return!ide(n,t)&&!En(n)&&!sde(n)&&!Wt(n)})};function Kz(t,e){var n=xt(t),r=dt(t),i={x:n.x,y:n.y};return e.indexOf("n")!==-1?i.y=r.top:e.indexOf("s")!==-1&&(i.y=r.bottom),e.indexOf("e")!==-1?i.x=r.right:e.indexOf("w")!==-1&&(i.x=r.left),i}function ide(t,e){return t.host===e}function sde(t){return!!t.hidden}function ode(t){return t==="n"||t==="s"}function ade(t){return t==="e"||t==="w"}var lde=7,cde=1e3;function au(t){this._canvas=t,this._asyncHide=bf(li(this.hide,this),cde)}au.$inject=["canvas"];au.prototype.snap=function(t,e){var n=t.context,r=n.snapContext,i=r.getSnapLocations(),s={x:Vp(t,"x"),y:Vp(t,"y")};$(i,function(o){var a=r.getSnapOrigin(o),l={x:t.x+a.x,y:t.y+a.y};if($(["x","y"],function(c){var d;s[c]||(d=e.snap(l,o,c,lde),d!==void 0&&(s[c]={value:d,originValue:d-a[c]}))}),s.x&&s.y)return!1}),this.showSnapLine("vertical",s.x&&s.x.value),this.showSnapLine("horizontal",s.y&&s.y.value),$(["x","y"],function(o){var a=s[o];Wn(a)&&ar(t,o,a.originValue)})};au.prototype._createLine=function(t){var e=this._canvas.getLayer("snap"),n=ee("path");return K(n,{d:"M0,0 L0,0"}),Ge(n).add("djs-snap-line"),re(e,n),{update:function(r){Oe(r)?t==="horizontal"?K(n,{d:"M-100000,"+r+" L+100000,"+r,display:""}):K(n,{d:"M "+r+",-100000 L "+r+", +100000",display:""}):K(n,{display:"none"})}}};au.prototype._createSnapLines=function(){this._snapLines={horizontal:this._createLine("horizontal"),vertical:this._createLine("vertical")}};au.prototype.showSnapLine=function(t,e){var n=this.getSnapLine(t);n&&n.update(e),this._asyncHide()};au.prototype.getSnapLine=function(t){return this._snapLines||this._createSnapLines(),this._snapLines[t]};au.prototype.hide=function(){$(this._snapLines,function(t){t.update()})};const ude={__init__:["createMoveSnapping","resizeSnapping","snapping"],createMoveSnapping:["type",za],resizeSnapping:["type",Gv],snapping:["type",au]},dde={__depends__:[ude],__init__:["connectSnapping","createMoveSnapping"],connectSnapping:["type",qz],createMoveSnapping:["type",Af]};var Yz=300;function yt(t,e,n,r){this._open=!1,this._results={},this._eventMaps=[],this._cachedRootElement=null,this._cachedSelection=null,this._cachedViewbox=null,this._canvas=t,this._eventBus=e,this._selection=n,this._translate=r,this._container=this._getBoxHtml(),this._searchInput=at(yt.INPUT_SELECTOR,this._container),this._resultsContainer=at(yt.RESULTS_CONTAINER_SELECTOR,this._container),this._canvas.getContainer().appendChild(this._container),e.on(["canvas.destroy","diagram.destroy","drag.init","elements.changed"],this.close,this)}yt.$inject=["canvas","eventBus","selection","translate"];yt.prototype._bindEvents=function(){var t=this;function e(n,r,i,s){t._eventMaps.push({el:n,type:i,listener:Zn.bind(n,r,i,s)})}e(document,"html","click",function(n){t.close(!1)}),e(this._container,yt.INPUT_SELECTOR,"click",function(n){n.stopPropagation(),n.delegateTarget.focus()}),e(this._container,yt.RESULT_SELECTOR,"mouseover",function(n){n.stopPropagation(),t._scrollToNode(n.delegateTarget),t._preselect(n.delegateTarget)}),e(this._container,yt.RESULT_SELECTOR,"click",function(n){n.stopPropagation(),t._select(n.delegateTarget)}),e(this._container,yt.INPUT_SELECTOR,"keydown",function(n){Lr("ArrowUp",n)&&n.preventDefault(),Lr("ArrowDown",n)&&n.preventDefault()}),e(this._container,yt.INPUT_SELECTOR,"keyup",function(n){if(Lr("Escape",n))return t.close();if(Lr("Enter",n)){var r=t._getCurrentResult();return r?t._select(r):t.close(!1)}if(Lr("ArrowUp",n))return t._scrollToDirection(!0);if(Lr("ArrowDown",n))return t._scrollToDirection();Lr(["ArrowLeft","ArrowRight"],n)||t._search(n.delegateTarget.value)})};yt.prototype._unbindEvents=function(){this._eventMaps.forEach(function(t){Zn.unbind(t.el,t.type,t.listener)})};yt.prototype._search=function(t){var e=this;if(this._clearResults(),!!t.trim()){var n=this._searchProvider.find(t);if(n=n.filter(function(i){return!e._canvas.getRootElements().includes(i.element)}),!n.length){this._selection.select(null);return}n.forEach(function(i){var s=i.element.id,o=e._createResultNode(i,s);e._results[s]={element:i.element,node:o}});var r=at(yt.RESULT_SELECTOR,this._resultsContainer);this._scrollToNode(r),this._preselect(r)}};yt.prototype._scrollToDirection=function(t){var e=this._getCurrentResult();if(e){var n=t?e.previousElementSibling:e.nextElementSibling;n&&(this._scrollToNode(n),this._preselect(n))}};yt.prototype._scrollToNode=function(t){if(!(!t||t===this._getCurrentResult())){var e=t.offsetTop,n=this._resultsContainer.scrollTop,r=e-this._resultsContainer.clientHeight+t.clientHeight;e<n?this._resultsContainer.scrollTop=e:n<r&&(this._resultsContainer.scrollTop=r)}};yt.prototype._clearResults=function(){xf(this._resultsContainer),this._results={},this._eventBus.fire("searchPad.cleared")};yt.prototype._getCurrentResult=function(){return at(yt.RESULT_SELECTED_SELECTOR,this._resultsContainer)};yt.prototype._createResultNode=function(t,e){var n=bt(yt.RESULT_HTML);return t.primaryTokens.length>0&&JI(n,t.primaryTokens,yt.RESULT_PRIMARY_HTML),JI(n,t.secondaryTokens,yt.RESULT_SECONDARY_HTML),vn(n,yt.RESULT_ID_ATTRIBUTE,e),this._resultsContainer.appendChild(n),n};yt.prototype.registerProvider=function(t){this._searchProvider=t};yt.prototype.open=function(){if(!this._searchProvider)throw new Error("no search provider registered");this.isOpen()||(this._cachedRootElement=this._canvas.getRootElement(),this._cachedSelection=this._selection.get(),this._cachedViewbox=this._canvas.viewbox(),this._selection.select(null),this._bindEvents(),this._open=!0,vt(this._canvas.getContainer()).add("djs-search-open"),vt(this._container).add("open"),this._searchInput.focus(),this._eventBus.fire("searchPad.opened"))};yt.prototype.close=function(t=!0){this.isOpen()&&(t&&(this._cachedRootElement&&this._canvas.setRootElement(this._cachedRootElement),this._cachedSelection&&this._selection.select(this._cachedSelection),this._cachedViewbox&&this._canvas.viewbox(this._cachedViewbox),this._eventBus.fire("searchPad.restored")),this._cachedRootElement=null,this._cachedSelection=null,this._cachedViewbox=null,this._unbindEvents(),this._open=!1,vt(this._canvas.getContainer()).remove("djs-search-open"),vt(this._container).remove("open"),this._clearResults(),this._searchInput.value="",this._searchInput.blur(),this._eventBus.fire("searchPad.closed"),this._canvas.restoreFocus())};yt.prototype.toggle=function(){this.isOpen()?this.close():this.open()};yt.prototype.isOpen=function(){return this._open};yt.prototype._preselect=function(t){var e=this._getCurrentResult();if(t!==e){e&&vt(e).remove(yt.RESULT_SELECTED_CLASS);var n=vn(t,yt.RESULT_ID_ATTRIBUTE),r=this._results[n].element;vt(t).add(yt.RESULT_SELECTED_CLASS),this._canvas.scrollToElement(r,{top:Yz}),this._selection.select(r),this._eventBus.fire("searchPad.preselected",r)}};yt.prototype._select=function(t){var e=vn(t,yt.RESULT_ID_ATTRIBUTE),n=this._results[e].element;this._cachedSelection=null,this._cachedViewbox=null,this.close(!1),this._canvas.scrollToElement(n,{top:Yz}),this._selection.select(n),this._eventBus.fire("searchPad.selected",n)};yt.prototype._getBoxHtml=function(){const t=bt(yt.BOX_HTML),e=at(yt.INPUT_SELECTOR,t);return e&&e.setAttribute("aria-label",this._translate("Search in diagram")),t};function JI(t,e,n){var r=hde(e),i=bt(n);i.innerHTML=r,t.appendChild(i)}function hde(t){var e="";return t.forEach(function(n){var r=kX(n.value||n.matched||n.normal),i=n.match||n.matched;i?e+='<b class="'+yt.RESULT_HIGHLIGHT_CLASS+'">'+r+"</b>":e+=r}),e!==""?e:null}yt.CONTAINER_SELECTOR=".djs-search-container";yt.INPUT_SELECTOR=".djs-search-input input";yt.RESULTS_CONTAINER_SELECTOR=".djs-search-results";yt.RESULT_SELECTOR=".djs-search-result";yt.RESULT_SELECTED_CLASS="djs-search-result-selected";yt.RESULT_SELECTED_SELECTOR="."+yt.RESULT_SELECTED_CLASS;yt.RESULT_ID_ATTRIBUTE="data-result-id";yt.RESULT_HIGHLIGHT_CLASS="djs-search-highlight";yt.BOX_HTML=`<div class="djs-search-container djs-scrollable">
  <div class="djs-search-input">
    <svg class="djs-search-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M9.0325 8.5H9.625L13.3675 12.25L12.25 13.3675L8.5 9.625V9.0325L8.2975 8.8225C7.4425 9.5575 6.3325 10 5.125 10C2.4325 10 0.25 7.8175 0.25 5.125C0.25 2.4325 2.4325 0.25 5.125 0.25C7.8175 0.25 10 2.4325 10 5.125C10 6.3325 9.5575 7.4425 8.8225 8.2975L9.0325 8.5ZM1.75 5.125C1.75 6.9925 3.2575 8.5 5.125 8.5C6.9925 8.5 8.5 6.9925 8.5 5.125C8.5 3.2575 6.9925 1.75 5.125 1.75C3.2575 1.75 1.75 3.2575 1.75 5.125Z" fill="#22242A"/>
    </svg>
    <input type="text" spellcheck="false" />
  </div>
  <div class="djs-search-results" />
</div>`;yt.RESULT_HTML='<div class="djs-search-result"></div>';yt.RESULT_PRIMARY_HTML='<div class="djs-search-result-primary"></div>';yt.RESULT_SECONDARY_HTML='<p class="djs-search-result-secondary"></p>';const pde={__depends__:[XB,zB,Ma],searchPad:["type",yt]};function BP(t,e,n,r){this._elementRegistry=t,this._canvas=n,this._search=r,e.registerProvider(this)}BP.$inject=["elementRegistry","searchPad","canvas","search"];BP.prototype.find=function(t){var e=this._canvas.getRootElements(),n=this._elementRegistry.filter(function(r){return!Wt(r)&&!e.includes(r)});return this._search(n.map(r=>({element:r,label:Td(r),id:r.id})),t,{keys:["label","id"]}).map(fde)};function fde(t){const{item:{element:e},tokens:n}=t;return{element:e,primaryTokens:n.label,secondaryTokens:n.id}}const mde={__depends__:[pde,LF],__init__:["bpmnSearch"],bpmnSearch:["type",BP]},gde="M44.7648 11.3263L36.9892 2.64074C36.0451 1.58628 34.5651 0.988708 33.1904 0.988708H5.98667C3.22688 0.988708 0.989624 3.34892 0.989624 6.26039V55.0235C0.989624 57.9349 3.22688 60.2952 5.98667 60.2952H40.966C43.7257 60.2952 45.963 57.9349 45.963 55.0235V14.9459C45.963 13.5998 45.6407 12.3048 44.7648 11.3263Z",vde="M1.03845 48.1347C1.03845 49.3511 1.07295 50.758 1.38342 52.064C1.69949 53.3938 2.32428 54.7154 3.56383 55.6428C6.02533 57.4841 10.1161 58.7685 14.8212 59.6067C19.5772 60.4538 25.1388 60.8738 30.6831 60.8738C36.2276 60.8738 41.7891 60.4538 46.545 59.6067C51.2504 58.7687 55.3412 57.4842 57.8028 55.6429C59.0424 54.7156 59.6673 53.3938 59.9834 52.064C60.2938 50.7579 60.3285 49.351 60.3285 48.1344V13.8415C60.3285 12.6249 60.2938 11.218 59.9834 9.91171C59.6673 8.58194 59.0423 7.2602 57.8027 6.33294C55.341 4.49168 51.2503 3.20723 46.545 2.36914C41.7891 1.522 36.2276 1.10204 30.6831 1.10205C25.1388 1.10206 19.5772 1.52206 14.8213 2.36923C10.1162 3.20734 6.02543 4.49183 3.5639 6.33314C2.32433 7.26038 1.69951 8.58206 1.38343 9.91181C1.07295 11.2179 1.03845 12.6247 1.03845 13.8411V48.1347Z",yde={width:36,height:50},xde={width:50,height:50};function eD(t,e,n){return ee("path",{d:t,strokeWidth:2,transform:`translate(${e.x}, ${e.y})`,...n})}const xc=5;function d_(t,e){this._styles=e,t.registerProvider(this)}d_.$inject=["outline","styles"];d_.prototype.getOutline=function(t){const e=this._styles.cls("djs-outline",["no-fill"]);var n;if(!Wt(t))return T(t,"bpmn:Gateway")?(n=ee("rect"),B(n.style,{"transform-box":"fill-box",transform:"rotate(45deg)","transform-origin":"center"}),K(n,B({x:2,y:2,rx:4,width:t.width-4,height:t.height-4},e))):Lt(t,["bpmn:Task","bpmn:SubProcess","bpmn:Group","bpmn:CallActivity"])?(n=ee("rect"),K(n,B({x:-xc,y:-xc,rx:14,width:t.width+xc*2,height:t.height+xc*2},e))):T(t,"bpmn:EndEvent")?(n=ee("circle"),K(n,B({cx:t.width/2,cy:t.height/2,r:t.width/2+xc+1},e))):T(t,"bpmn:Event")?(n=ee("circle"),K(n,B({cx:t.width/2,cy:t.height/2,r:t.width/2+xc},e))):T(t,"bpmn:DataObjectReference")&&tD(t,"bpmn:DataObjectReference")?n=eD(gde,{x:-6,y:-6},e):T(t,"bpmn:DataStoreReference")&&tD(t,"bpmn:DataStoreReference")&&(n=eD(vde,{x:-6,y:-6},e)),n};d_.prototype.updateOutline=function(t,e){if(!Wt(t))return Lt(t,["bpmn:SubProcess","bpmn:Group"])?(K(e,{width:t.width+xc*2,height:t.height+xc*2}),!0):!!Lt(t,["bpmn:Event","bpmn:Gateway","bpmn:DataStoreReference","bpmn:DataObjectReference"])};function tD(t,e){var n;return e==="bpmn:DataObjectReference"?n=yde:e==="bpmn:DataStoreReference"&&(n=xde),t.width===n.width&&t.height===n.height}const bde={__depends__:[Mz],__init__:["outlineProvider"],outlineProvider:["type",d_]};var wde='<?xml version="1.0" encoding="UTF-8"?><bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" targetNamespace="http://bpmn.io/schema/bpmn" id="Definitions_1"><bpmn:process id="Process_1" isExecutable="false"><bpmn:startEvent id="StartEvent_1"/></bpmn:process><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1"><bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"><dc:Bounds height="36.0" width="36.0" x="173.0" y="102.0"/></bpmndi:BPMNShape></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>';function eo(t){Sv.call(this,t)}Ce(eo,Sv);eo.Viewer=gv;eo.NavigatedViewer=Bg;eo.prototype.createDiagram=function(){return this.importXML(wde)};eo.prototype._interactionModules=[hF,gF,xF];eo.prototype._modelingModules=[yie,S2,zie,Die,ase,T2,pse,xce,Q6,qw,Ece,jce,Uce,qce,Wce,Qce,cue,wz,gue,kue,Mue,Bue,Az,dde,mde,bde];eo.prototype._modules=[].concat(gv.prototype._modules,eo.prototype._interactionModules,eo.prototype._modelingModules);const _de=100,Ede=60;class Sde extends PX{constructor(n,r,i){super(n,5e3);hm(this,"bpmnRenderer");hm(this,"styles");hm(this,"_createDefs",!1);hm(this,"isPidMode",!1);this.bpmnRenderer=r,this.styles=i||{},this._createDefs=!1,this.isPidMode=!1,n.on("import.done",()=>{var o,a;const s=(o=r==null?void 0:r.get)==null?void 0:o.call(r,"canvas",!1);if(s){s.getRootElement();const l=(a=r==null?void 0:r.get)==null?void 0:a.call(r,"elementRegistry",!1);if(l){const d=l.getAll().some(h=>{const p=h.businessObject;if(!p)return!1;const f=p.$attrs||{};return!!(f["pid:symbol"]||f["pid:type"]||f["pid:category"])});this.isPidMode=d}}}),n.on("canvas.viewbox.changed",({element:s})=>{})}canRender(n){var d,h;const r=n.businessObject;if(!r||n.type==="label"||(d=n.id)!=null&&d.includes("_label")||(h=n.id)!=null&&h.includes("_di"))return!1;if(!this.isPidMode){const p=r.$attrs||{};return!!(p["pid:symbol"]||p["pid:type"]||p["pid:category"])}const i=r.name||"",s=(n.type||"").toLowerCase(),o=r.$attrs||{},a=!!(o["pid:symbol"]||o["pid:type"]||o["pid:category"]),l=s.includes("task")||s.includes("exclusivegateway")||s.includes("dataobjectreference")||s.includes("subprocess")||s.includes("startevent"),c=s.includes("sequenceflow")||s.includes("messageflow");return!!(a||l&&i||c)}drawShape(n,r){const i=r.businessObject,s=(i==null?void 0:i.$attrs)||{};let o=s["pid:symbol"]||"unknown";if(s["pid:category"],o==="unknown"&&this.isPidMode){const d=((i==null?void 0:i.name)||"").toLowerCase(),h=r.type||"";d.includes("tank")||d.includes("vessel")||d.includes("drum")?o="tank":d.includes("pump")?o="pump":d.includes("filter")?o="filter":d.includes("valve")?o=h.includes("Gateway")?"valve_control":"valve_gate":d.includes("transmitter")||d.includes("transducer")?d.includes("level")?o="transmitter_level":d.includes("flow")?o="transmitter_flow":d.includes("pressure")?o="transmitter_pressure":o="transmitter_level":d.includes("controller")?o="controller_pid":d.includes("analyzer")?o="analyzer":(d.includes("exchanger")||d.includes("heater")||d.includes("cooler"))&&(o="heat_exchanger"),o.includes("transmitter")||o.includes("analyzer")}this._ensureDefs(n);const a=ee("g");K(a,{class:"pid-renderer-group"}),re(n,a),setTimeout(()=>{Array.from(n.children).forEach(d=>{if(d!==a&&d.tagName==="g"){const h=d.querySelector(".djs-visual")||d;h&&!h.classList.contains("pid-renderer-group")&&h.setAttribute("style","display: none !important;")}})},0);const l=r.width&&r.width>0?r.width:_de,c=r.height&&r.height>0?r.height:Ede;switch(o){case"tank":case"mixing_tank":case"storage_tank":this._drawTank(a,l,c);break;case"pump":case"pump_centrifugal":this._drawPump(a,l,c);break;case"filter":case"separator":this._drawFilter(a,l,c);break;case"heat_exchanger":case"condenser":this._drawHeatExchanger(a,l,c);break;case"reactor":this._drawRectWithDoubleLine(a,l,c);break;case"valve_control":case"valve_gate":case"valve_globe":case"valve_ball":case"valve_butterfly":case"valve_check":case"valve_pressure_relief":case"valve_solenoid":case"valve_diaphragm":case"valve_manual":this._drawValve(a,l,c,o);break;case"transmitter_temp":case"transmitter_pressure":case"transmitter_flow":case"transmitter_level":case"transmitter_analyzer":case"indicator_temp":case"indicator_pressure":case"indicator_flow":case"indicator_level":case"flow_meter":case"pressure_gauge":this._drawInstrument(a,l,c,o);break;case"controller_pid":case"controller_plc":case"controller_dcs":case"controller_local":case"controller_remote":case"controller_manual":this._drawController(a,l,c,o);break;case"actuator_electric":case"actuator_pneumatic":case"actuator_hydraulic":case"motor":case"fan":this._drawActuator(a,l,c,o);break;case"junction":case"tee_connection":case"analyzer_chamber":case"relay":case"control_panel":case"display":case"instrument_bubble":this._drawSmallSymbol(a,l,c,o);break;default:if(this.isPidMode)this._drawRoundedRect(a,l,c,{fill:"#e8f4f8",stroke:"#333",rx:8});else return this.bpmnRenderer.drawShape(n,r)}if(i&&i.name){const d=ee("text");K(d,{x:l/2,y:c+14,"text-anchor":"middle","font-family":"Arial, Helvetica, sans-serif","font-size":"12px",fill:"#222","font-weight":"normal"}),d.textContent=i.name,re(a,d)}return a}drawConnection(n,r){const i=r.businessObject,s=(i==null?void 0:i.$attrs)&&i.$attrs["pid:category"]||"process",o=(i==null?void 0:i.$attrs)&&i.$attrs["pid:style"]||"",a=s==="signal"?"#999":s==="electrical"?"#666":"#000",l=o==="dashed"||s==="signal"?"4 3":s==="electrical"?"2 2":null;this._ensureDefs(n);const c=ee("path");if(r.waypoints&&r.waypoints.length>0){const d=r.waypoints.map((h,p)=>p===0?`M ${h.x} ${h.y}`:`L ${h.x} ${h.y}`).join(" ");K(c,{d})}else K(c,{d:"M0 0 L10 10"});return K(c,{stroke:a,"stroke-width":1.5,fill:"none"}),l&&K(c,{"stroke-dasharray":l}),s==="process"?K(c,{"marker-end":"url(#pid-arrow)"}):K(c,{"marker-end":"url(#pid-arrow-small)"}),re(n,c),c}_drawRoundedRect(n,r,i,s={}){const o=ee("rect");return K(o,{x:0,y:0,width:r,height:i,rx:s.rx||10,ry:s.rx||10,fill:s.fill||"#b3d9ff",stroke:s.stroke||"#333","stroke-width":s.strokeWidth||2}),re(n,o),o}_drawRectWithDoubleLine(n,r,i){this._drawRoundedRect(n,r,i,{fill:"#fff",stroke:"#333",rx:4,strokeWidth:2});const s=ee("rect");K(s,{x:6,y:6,width:r-12,height:i-12,rx:3,stroke:"#333","stroke-width":1,fill:"none"}),re(n,s)}_drawPump(n,r,i){const s=Math.min(r,i)*.35,o=s+8,a=i/2,l=ee("circle");K(l,{cx:o,cy:a,r:s,stroke:"#333","stroke-width":2,fill:"#e6f2ff"}),re(n,l);const c=ee("polygon"),d=o+s*.2,h=a-8,p=a+8;K(c,{points:`${d},${a} ${d+22},${h} ${d+22},${p}`,fill:"#333"}),re(n,c)}_drawTank(n,r,i){const s=r*.15,o=i*.15,a=ee("rect");K(a,{x:s,y:o,width:r-2*s,height:i-2*o,fill:"#b3d9ff",stroke:"#333","stroke-width":2}),re(n,a);const l=ee("ellipse");K(l,{cx:r/2,cy:o,rx:s,ry:o,fill:"#b3d9ff",stroke:"#333","stroke-width":2}),re(n,l);const c=ee("ellipse");K(c,{cx:r/2,cy:i-o,rx:s,ry:o*.7,fill:"#b3d9ff",stroke:"#333","stroke-width":2}),re(n,c);const d=ee("line");K(d,{x1:s+5,y1:i*.6,x2:r-s-5,y2:i*.6,stroke:"#666","stroke-width":1,"stroke-dasharray":"3 3"}),re(n,d)}_drawFilter(n,r,i){const s=ee("rect");K(s,{x:0,y:0,width:r,height:i,rx:6,fill:"#eaf7ea",stroke:"#333","stroke-width":2}),re(n,s);const o=5,a=r/(o+1);for(let l=1;l<=o;l++){const c=a*l,d=ee("line");K(d,{x1:c-8,y1:8,x2:c+8,y2:i-8,stroke:"#333","stroke-width":1.5}),re(n,d)}}_drawHeatExchanger(n,r,i){const s=Math.min(r,i)*.22,o=s+8,a=r-s-8,l=i/2,c=ee("circle");K(c,{cx:o,cy:l,r:s,stroke:"#333","stroke-width":1.5,fill:"#fff"}),re(n,c);const d=ee("circle");K(d,{cx:a,cy:l,r:s,stroke:"#333","stroke-width":1.5,fill:"#fff"}),re(n,d);const h=ee("line");K(h,{x1:o+s,y1:l,x2:a-s,y2:l,stroke:"#333","stroke-width":1.2}),re(n,h)}_drawValve(n,r,i,s){const o=Math.min(r,i)*.6,a=r/2,l=i/2,c=o/2,d=`${a},${l-c} ${a+c},${l} ${a},${l+c} ${a-c},${l}`,h=ee("polygon");if(K(h,{points:d,stroke:"#000","stroke-width":2,fill:"none"}),re(n,h),s==="valve_control"){const p=ee("line");K(p,{x1:a-c*.6,y1:l-c*.6,x2:a+c*.6,y2:l+c*.6,stroke:"#000","stroke-width":2}),re(n,p);const f=ee("line");K(f,{x1:a+c*.6,y1:l-c*.6,x2:a-c*.6,y2:l+c*.6,stroke:"#000","stroke-width":2}),re(n,f)}else if(s==="valve_check"){const p=ee("path");K(p,{d:`M ${a-c*.4} ${l} q ${c*.4} ${-c*.4} ${c*.8} 0`,stroke:"#000","stroke-width":1.8,fill:"none"}),re(n,p)}else if(s==="valve_gate"){const p=ee("line");K(p,{x1:a,y1:l-c,x2:a,y2:l+c,stroke:"#000","stroke-width":1.6}),re(n,p)}else{const p=ee("circle");K(p,{cx:a,cy:l,r:Math.max(3,c*.25),fill:"#000"}),re(n,p)}}_drawInstrument(n,r,i,s){const o=Math.min(20,Math.min(r,i)*.25),a=o+4,l=i/2,c=ee("circle");if(K(c,{cx:a,cy:l,r:o,stroke:"#333","stroke-width":1.2,fill:"#fff"}),re(n,c),s==="transmitter_analyzer"){const d=ee("rect");K(d,{x:a-o/2,y:l-o/2,width:o,height:o,rx:2,stroke:"#333","stroke-width":1,fill:"#fff"}),re(n,d)}else if(s==="flow_meter"){const d=ee("line");K(d,{x1:a-o+2,y1:l,x2:a+o-2,y2:l,stroke:"#333","stroke-width":1.2}),re(n,d)}else if(s==="pressure_gauge"){const d=ee("line");K(d,{x1:a,y1:l,x2:a+o*.6,y2:l-o*.4,stroke:"#333","stroke-width":1.2}),re(n,d)}}_drawController(n,r,i,s){const o=ee("rect");K(o,{x:0,y:0,width:r,height:i,rx:8,stroke:"#333","stroke-width":1.6,fill:"#f9f9f9"}),re(n,o);const a=r/2-18,l=i/2;for(let c=0;c<3;c++){const d=ee("line");K(d,{x1:a+c*12,y1:l-8,x2:a+c*12,y2:l+8,stroke:"#333","stroke-width":1}),re(n,d)}}_drawActuator(n,r,i,s){if(s==="motor"){const o=r/2,a=i/2,l=Math.min(r,i)*.28,c=ee("circle");K(c,{cx:o,cy:a,r:l,stroke:"#333","stroke-width":1.6,fill:"#fff"}),re(n,c);const d=ee("text");K(d,{x:o,y:a+5,"text-anchor":"middle","font-size":"12px",fill:"#333"}),d.textContent="M",re(n,d)}else s==="actuator_pneumatic"?this._drawRoundedRect(n,r*.8,i*.5,{fill:"#fff",stroke:"#333",rx:6}):this._drawSmallSymbol(n,r,i,s)}_drawSmallSymbol(n,r,i,s){const o=r/2,a=i/2;if(s==="junction"||s==="tee_connection"){const l=ee("circle");K(l,{cx:o,cy:a,r:4,fill:"#333"}),re(n,l)}else if(s==="analyzer_chamber"){const l=ee("rect");K(l,{x:o-12,y:a-10,width:24,height:20,rx:4,stroke:"#333",fill:"#fff"}),re(n,l)}else{const l=ee("circle");K(l,{cx:o,cy:a,r:8,stroke:"#333",fill:"#fff"}),re(n,l)}}_ensureDefs(n){let r=n;for(;r&&r.nodeName&&r.nodeName.toLowerCase()!=="svg";)r=r.parentNode;if(!r||this._createDefs)return;const i=ee("defs"),s=ee("marker");K(s,{id:"pid-arrow",markerWidth:10,markerHeight:10,refX:8,refY:3.5,orient:"auto",markerUnits:"strokeWidth"});const o=ee("path");K(o,{d:"M0,0 L8,3.5 L0,7 Z",fill:"#000"}),re(s,o),re(i,s);const a=ee("marker");K(a,{id:"pid-arrow-small",markerWidth:8,markerHeight:8,refX:6,refY:3,orient:"auto",markerUnits:"strokeWidth"});const l=ee("path");K(l,{d:"M0,0 L6,3 L0,6 Z",fill:"#666"}),re(a,l),re(i,a),re(r,i),this._createDefs=!0}}const Cde={__init__:["pidRenderer"],pidRenderer:["type",["eventBus","bpmnRenderer",Sde]]},$u=QY,Mu=ZY,jde=_.forwardRef(({className:t,inset:e,children:n,...r},i)=>u.jsxs(jB,{ref:i,className:Se("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",e&&"pl-8",t),...r,children:[n,u.jsx(Ag,{className:"ml-auto h-4 w-4"})]}));jde.displayName=jB.displayName;const kde=_.forwardRef(({className:t,...e},n)=>u.jsx(kB,{ref:n,className:Se("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...e}));kde.displayName=kB.displayName;const mc=_.forwardRef(({className:t,sideOffset:e=4,...n},r)=>u.jsx(XY,{children:u.jsx(PB,{ref:r,sideOffset:e,className:Se("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})}));mc.displayName=PB.displayName;const jn=_.forwardRef(({className:t,inset:e,...n},r)=>u.jsx(TB,{ref:r,className:Se("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e&&"pl-8",t),...n}));jn.displayName=TB.displayName;const Pde=_.forwardRef(({className:t,children:e,checked:n,...r},i)=>u.jsxs(NB,{ref:i,className:Se("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),checked:n,...r,children:[u.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:u.jsx(OB,{children:u.jsx(ns,{className:"h-4 w-4"})})}),e]}));Pde.displayName=NB.displayName;const Tde=_.forwardRef(({className:t,children:e,...n},r)=>u.jsxs(RB,{ref:r,className:Se("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),...n,children:[u.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:u.jsx(OB,{children:u.jsx(ZJ,{className:"h-2 w-2 fill-current"})})}),e]}));Tde.displayName=RB.displayName;const Rb=_.forwardRef(({className:t,inset:e,...n},r)=>u.jsx(AB,{ref:r,className:Se("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",t),...n}));Rb.displayName=AB.displayName;const Kh=_.forwardRef(({className:t,...e},n)=>u.jsx(IB,{ref:n,className:Se("-mx-1 my-1 h-px bg-muted",t),...e}));Kh.displayName=IB.displayName;var h_="Collapsible",[Nde,Xz]=Tl(h_),[Ode,FP]=Nde(h_),Qz=_.forwardRef((t,e)=>{const{__scopeCollapsible:n,open:r,defaultOpen:i,disabled:s,onOpenChange:o,...a}=t,[l,c]=Mc({prop:r,defaultProp:i??!1,onChange:o,caller:h_});return u.jsx(Ode,{scope:n,disabled:s,contentId:vf(),open:l,onOpenToggle:_.useCallback(()=>c(d=>!d),[c]),children:u.jsx(Yt.div,{"data-state":HP(l),"data-disabled":s?"":void 0,...a,ref:e})})});Qz.displayName=h_;var Zz="CollapsibleTrigger",Jz=_.forwardRef((t,e)=>{const{__scopeCollapsible:n,...r}=t,i=FP(Zz,n);return u.jsx(Yt.button,{type:"button","aria-controls":i.contentId,"aria-expanded":i.open||!1,"data-state":HP(i.open),"data-disabled":i.disabled?"":void 0,disabled:i.disabled,...r,ref:e,onClick:Pt(t.onClick,i.onOpenToggle)})});Jz.displayName=Zz;var zP="CollapsibleContent",e8=_.forwardRef((t,e)=>{const{forceMount:n,...r}=t,i=FP(zP,t.__scopeCollapsible);return u.jsx(Gc,{present:n||i.open,children:({present:s})=>u.jsx(Rde,{...r,ref:e,present:s})})});e8.displayName=zP;var Rde=_.forwardRef((t,e)=>{const{__scopeCollapsible:n,present:r,children:i,...s}=t,o=FP(zP,n),[a,l]=_.useState(r),c=_.useRef(null),d=Mn(e,c),h=_.useRef(0),p=h.current,f=_.useRef(0),m=f.current,g=o.open||a,v=_.useRef(g),b=_.useRef(void 0);return _.useEffect(()=>{const x=requestAnimationFrame(()=>v.current=!1);return()=>cancelAnimationFrame(x)},[]),as(()=>{const x=c.current;if(x){b.current=b.current||{transitionDuration:x.style.transitionDuration,animationName:x.style.animationName},x.style.transitionDuration="0s",x.style.animationName="none";const y=x.getBoundingClientRect();h.current=y.height,f.current=y.width,v.current||(x.style.transitionDuration=b.current.transitionDuration,x.style.animationName=b.current.animationName),l(r)}},[o.open,r]),u.jsx(Yt.div,{"data-state":HP(o.open),"data-disabled":o.disabled?"":void 0,id:o.contentId,hidden:!g,...s,ref:d,style:{"--radix-collapsible-content-height":p?`${p}px`:void 0,"--radix-collapsible-content-width":m?`${m}px`:void 0,...t.style},children:g&&i})});function HP(t){return t?"open":"closed"}var Ade=Qz,Ide=Jz,Dde=e8,Go="Accordion",$de=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[UP,Mde,Lde]=xk(Go),[p_]=Tl(Go,[Lde,Xz]),VP=Xz(),t8=be.forwardRef((t,e)=>{const{type:n,...r}=t,i=r,s=r;return u.jsx(UP.Provider,{scope:t.__scopeAccordion,children:n==="multiple"?u.jsx(Hde,{...s,ref:e}):u.jsx(zde,{...i,ref:e})})});t8.displayName=Go;var[n8,Bde]=p_(Go),[r8,Fde]=p_(Go,{collapsible:!1}),zde=be.forwardRef((t,e)=>{const{value:n,defaultValue:r,onValueChange:i=()=>{},collapsible:s=!1,...o}=t,[a,l]=Mc({prop:n,defaultProp:r??"",onChange:i,caller:Go});return u.jsx(n8,{scope:t.__scopeAccordion,value:be.useMemo(()=>a?[a]:[],[a]),onItemOpen:l,onItemClose:be.useCallback(()=>s&&l(""),[s,l]),children:u.jsx(r8,{scope:t.__scopeAccordion,collapsible:s,children:u.jsx(i8,{...o,ref:e})})})}),Hde=be.forwardRef((t,e)=>{const{value:n,defaultValue:r,onValueChange:i=()=>{},...s}=t,[o,a]=Mc({prop:n,defaultProp:r??[],onChange:i,caller:Go}),l=be.useCallback(d=>a((h=[])=>[...h,d]),[a]),c=be.useCallback(d=>a((h=[])=>h.filter(p=>p!==d)),[a]);return u.jsx(n8,{scope:t.__scopeAccordion,value:o,onItemOpen:l,onItemClose:c,children:u.jsx(r8,{scope:t.__scopeAccordion,collapsible:!0,children:u.jsx(i8,{...s,ref:e})})})}),[Ude,f_]=p_(Go),i8=be.forwardRef((t,e)=>{const{__scopeAccordion:n,disabled:r,dir:i,orientation:s="vertical",...o}=t,a=be.useRef(null),l=Mn(a,e),c=Mde(n),h=uw(i)==="ltr",p=Pt(t.onKeyDown,f=>{var C;if(!$de.includes(f.key))return;const m=f.target,g=c().filter(P=>{var R;return!((R=P.ref.current)!=null&&R.disabled)}),v=g.findIndex(P=>P.ref.current===m),b=g.length;if(v===-1)return;f.preventDefault();let x=v;const y=0,w=b-1,E=()=>{x=v+1,x>w&&(x=y)},S=()=>{x=v-1,x<y&&(x=w)};switch(f.key){case"Home":x=y;break;case"End":x=w;break;case"ArrowRight":s==="horizontal"&&(h?E():S());break;case"ArrowDown":s==="vertical"&&E();break;case"ArrowLeft":s==="horizontal"&&(h?S():E());break;case"ArrowUp":s==="vertical"&&S();break}const j=x%b;(C=g[j].ref.current)==null||C.focus()});return u.jsx(Ude,{scope:n,disabled:r,direction:i,orientation:s,children:u.jsx(UP.Slot,{scope:n,children:u.jsx(Yt.div,{...o,"data-orientation":s,ref:l,onKeyDown:r?void 0:p})})})}),w0="AccordionItem",[Vde,qP]=p_(w0),s8=be.forwardRef((t,e)=>{const{__scopeAccordion:n,value:r,...i}=t,s=f_(w0,n),o=Bde(w0,n),a=VP(n),l=vf(),c=r&&o.value.includes(r)||!1,d=s.disabled||t.disabled;return u.jsx(Vde,{scope:n,open:c,disabled:d,triggerId:l,children:u.jsx(Ade,{"data-orientation":s.orientation,"data-state":d8(c),...a,...i,ref:e,disabled:d,open:c,onOpenChange:h=>{h?o.onItemOpen(r):o.onItemClose(r)}})})});s8.displayName=w0;var o8="AccordionHeader",a8=be.forwardRef((t,e)=>{const{__scopeAccordion:n,...r}=t,i=f_(Go,n),s=qP(o8,n);return u.jsx(Yt.h3,{"data-orientation":i.orientation,"data-state":d8(s.open),"data-disabled":s.disabled?"":void 0,...r,ref:e})});a8.displayName=o8;var AC="AccordionTrigger",l8=be.forwardRef((t,e)=>{const{__scopeAccordion:n,...r}=t,i=f_(Go,n),s=qP(AC,n),o=Fde(AC,n),a=VP(n);return u.jsx(UP.ItemSlot,{scope:n,children:u.jsx(Ide,{"aria-disabled":s.open&&!o.collapsible||void 0,"data-orientation":i.orientation,id:s.triggerId,...a,...r,ref:e})})});l8.displayName=AC;var c8="AccordionContent",u8=be.forwardRef((t,e)=>{const{__scopeAccordion:n,...r}=t,i=f_(Go,n),s=qP(c8,n),o=VP(n);return u.jsx(Dde,{role:"region","aria-labelledby":s.triggerId,"data-orientation":i.orientation,...o,...r,ref:e,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...t.style}})});u8.displayName=c8;function d8(t){return t?"open":"closed"}var qde=t8,Wde=s8,Gde=a8,h8=l8,p8=u8;const IC=qde,Zh=_.forwardRef(({className:t,...e},n)=>u.jsx(Wde,{ref:n,className:Se("border-b",t),...e}));Zh.displayName="AccordionItem";const Jh=_.forwardRef(({className:t,children:e,...n},r)=>u.jsx(Gde,{className:"flex",children:u.jsxs(h8,{ref:r,className:Se("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...n,children:[e,u.jsx(vs,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));Jh.displayName=h8.displayName;const ep=_.forwardRef(({className:t,children:e,...n},r)=>u.jsx(p8,{ref:r,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:u.jsx("div",{className:Se("pb-4 pt-0",t),children:e})}));ep.displayName=p8.displayName;const f8=_.forwardRef(({...t},e)=>u.jsx("nav",{ref:e,"aria-label":"breadcrumb",...t}));f8.displayName="Breadcrumb";const m8=_.forwardRef(({className:t,...e},n)=>u.jsx("ol",{ref:n,className:Se("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",t),...e}));m8.displayName="BreadcrumbList";const Ab=_.forwardRef(({className:t,...e},n)=>u.jsx("li",{ref:n,className:Se("inline-flex items-center gap-1.5",t),...e}));Ab.displayName="BreadcrumbItem";const DC=_.forwardRef(({asChild:t,className:e,...n},r)=>{const i=t?R4:"a";return u.jsx(i,{ref:r,className:Se("transition-colors hover:text-foreground",e),...n})});DC.displayName="BreadcrumbLink";const g8=_.forwardRef(({className:t,...e},n)=>u.jsx("span",{ref:n,role:"link","aria-disabled":"true","aria-current":"page",className:Se("font-normal text-foreground",t),...e}));g8.displayName="BreadcrumbPage";const $C=({children:t,className:e,...n})=>u.jsx("li",{role:"presentation","aria-hidden":"true",className:Se("[&>svg]:size-3.5",e),...n,children:t??u.jsx(Ag,{})});$C.displayName="BreadcrumbSeparator";function v8(t){const e=_.useRef({value:t,previous:t});return _.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var m_="Switch",[Kde]=Tl(m_),[Yde,Xde]=Kde(m_),y8=_.forwardRef((t,e)=>{const{__scopeSwitch:n,name:r,checked:i,defaultChecked:s,required:o,disabled:a,value:l="on",onCheckedChange:c,form:d,...h}=t,[p,f]=_.useState(null),m=Mn(e,y=>f(y)),g=_.useRef(!1),v=p?d||!!p.closest("form"):!0,[b,x]=Mc({prop:i,defaultProp:s??!1,onChange:c,caller:m_});return u.jsxs(Yde,{scope:n,checked:b,disabled:a,children:[u.jsx(Yt.button,{type:"button",role:"switch","aria-checked":b,"aria-required":o,"data-state":_8(b),"data-disabled":a?"":void 0,disabled:a,value:l,...h,ref:m,onClick:Pt(t.onClick,y=>{x(w=>!w),v&&(g.current=y.isPropagationStopped(),g.current||y.stopPropagation())})}),v&&u.jsx(w8,{control:p,bubbles:!g.current,name:r,value:l,checked:b,required:o,disabled:a,form:d,style:{transform:"translateX(-100%)"}})]})});y8.displayName=m_;var x8="SwitchThumb",b8=_.forwardRef((t,e)=>{const{__scopeSwitch:n,...r}=t,i=Xde(x8,n);return u.jsx(Yt.span,{"data-state":_8(i.checked),"data-disabled":i.disabled?"":void 0,...r,ref:e})});b8.displayName=x8;var Qde="SwitchBubbleInput",w8=_.forwardRef(({__scopeSwitch:t,control:e,checked:n,bubbles:r=!0,...i},s)=>{const o=_.useRef(null),a=Mn(o,s),l=v8(n),c=JY(e);return _.useEffect(()=>{const d=o.current;if(!d)return;const h=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(h,"checked").set;if(l!==n&&f){const m=new Event("click",{bubbles:r});f.call(d,n),d.dispatchEvent(m)}},[l,n,r]),u.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...i,tabIndex:-1,ref:a,style:{...i.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});w8.displayName=Qde;function _8(t){return t?"checked":"unchecked"}var E8=y8,Zde=b8;const vl=_.forwardRef(({className:t,...e},n)=>u.jsx(E8,{className:Se("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",t),...e,ref:n,children:u.jsx(Zde,{className:Se("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));vl.displayName=E8.displayName;var Jde=Symbol("radix.slottable");function ehe(t){const e=({children:n})=>u.jsx(u.Fragment,{children:n});return e.displayName=`${t}.Slottable`,e.__radixId=Jde,e}var S8="AlertDialog",[the]=Tl(S8,[DB]),$l=DB(),C8=t=>{const{__scopeAlertDialog:e,...n}=t,r=$l(e);return u.jsx(yk,{...r,...n,modal:!0})};C8.displayName=S8;var nhe="AlertDialogTrigger",rhe=_.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...r}=t,i=$l(n);return u.jsx(EB,{...i,...r,ref:e})});rhe.displayName=nhe;var ihe="AlertDialogPortal",j8=t=>{const{__scopeAlertDialog:e,...n}=t,r=$l(e);return u.jsx(vk,{...r,...n})};j8.displayName=ihe;var she="AlertDialogOverlay",k8=_.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...r}=t,i=$l(n);return u.jsx(hv,{...i,...r,ref:e})});k8.displayName=she;var gp="AlertDialogContent",[ohe,ahe]=the(gp),lhe=ehe("AlertDialogContent"),P8=_.forwardRef((t,e)=>{const{__scopeAlertDialog:n,children:r,...i}=t,s=$l(n),o=_.useRef(null),a=Mn(e,o),l=_.useRef(null);return u.jsx(eX,{contentName:gp,titleName:T8,docsSlug:"alert-dialog",children:u.jsx(ohe,{scope:n,cancelRef:l,children:u.jsxs(pv,{role:"alertdialog",...s,...i,ref:a,onOpenAutoFocus:Pt(i.onOpenAutoFocus,c=>{var d;c.preventDefault(),(d=l.current)==null||d.focus({preventScroll:!0})}),onPointerDownOutside:c=>c.preventDefault(),onInteractOutside:c=>c.preventDefault(),children:[u.jsx(lhe,{children:r}),u.jsx(uhe,{contentRef:o})]})})})});P8.displayName=gp;var T8="AlertDialogTitle",N8=_.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...r}=t,i=$l(n);return u.jsx(fv,{...i,...r,ref:e})});N8.displayName=T8;var O8="AlertDialogDescription",R8=_.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...r}=t,i=$l(n);return u.jsx(mv,{...i,...r,ref:e})});R8.displayName=O8;var che="AlertDialogAction",A8=_.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...r}=t,i=$l(n);return u.jsx(cw,{...i,...r,ref:e})});A8.displayName=che;var I8="AlertDialogCancel",D8=_.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...r}=t,{cancelRef:i}=ahe(I8,n),s=$l(n),o=Mn(e,i);return u.jsx(cw,{...s,...r,ref:o})});D8.displayName=I8;var uhe=({contentRef:t})=>{const e=`\`${gp}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${gp}\` by passing a \`${O8}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${gp}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return _.useEffect(()=>{var r;document.getElementById((r=t.current)==null?void 0:r.getAttribute("aria-describedby"))||console.warn(e)},[e,t]),null},dhe=C8,hhe=j8,$8=k8,M8=P8,L8=A8,B8=D8,F8=N8,z8=R8;const WP=dhe,phe=hhe,H8=_.forwardRef(({className:t,...e},n)=>u.jsx($8,{className:Se("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e,ref:n}));H8.displayName=$8.displayName;const g_=_.forwardRef(({className:t,...e},n)=>u.jsxs(phe,{children:[u.jsx(H8,{}),u.jsx(M8,{ref:n,className:Se("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...e})]}));g_.displayName=M8.displayName;const v_=({className:t,...e})=>u.jsx("div",{className:Se("flex flex-col space-y-2 text-center sm:text-left",t),...e});v_.displayName="AlertDialogHeader";const y_=({className:t,...e})=>u.jsx("div",{className:Se("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e});y_.displayName="AlertDialogFooter";const x_=_.forwardRef(({className:t,...e},n)=>u.jsx(F8,{ref:n,className:Se("text-lg font-semibold",t),...e}));x_.displayName=F8.displayName;const b_=_.forwardRef(({className:t,...e},n)=>u.jsx(z8,{ref:n,className:Se("text-sm text-muted-foreground",t),...e}));b_.displayName=z8.displayName;const w_=_.forwardRef(({className:t,...e},n)=>u.jsx(L8,{ref:n,className:Se(Hk(),t),...e}));w_.displayName=L8.displayName;const __=_.forwardRef(({className:t,...e},n)=>u.jsx(B8,{ref:n,className:Se(Hk({variant:"outline"}),"mt-2 sm:mt-0",t),...e}));__.displayName=B8.displayName;const fhe=t=>{if(!t)return"";const e=[];let n=t;for(;n&&n.nodeType===1;){const r=n.tagName.toLowerCase();let i=1,s=!1;if(n.parentNode){const o=n.parentNode.childNodes;let a=0;for(let l=0;l<o.length;l++){const c=o[l];c.nodeType===1&&c.tagName===n.tagName&&(a+=1,c===n?(i=a,a>1&&(s=!0)):s=!0)}}e.unshift(s?`${r}[${i}]`:r),n=n.parentElement}return`/${e.join("/")}`},nD=(t,e=280)=>{if(!t)return;const n=t.replace(/\s+/g," ").trim();if(n)return n.length>e?`${n.slice(0,e)}...`:n},wE=async t=>{const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(r)).map(s=>s.toString(16).padStart(2,"0")).join("")},mhe=t=>{try{const n=new DOMParser().parseFromString(t,"application/xml");if(n.getElementsByTagName("parsererror").length>0)return{taskCount:0,decisionPoints:0,parallelBranches:0,errorHandlers:0,eventTypes:[],estimatedPaths:1};const i=n.querySelectorAll("task, userTask, serviceTask, manualTask, sendTask, receiveTask, scriptTask, businessRuleTask, callActivity").length,s=n.querySelectorAll("exclusiveGateway, parallelGateway, inclusiveGateway, eventBasedGateway"),o=s.length,l=n.querySelectorAll("parallelGateway").length,d=n.querySelectorAll("boundaryEvent errorEventDefinition, intermediateCatchEvent errorEventDefinition").length,h=[];n.querySelectorAll("startEvent, intermediateCatchEvent, intermediateThrowEvent, endEvent, boundaryEvent").forEach(m=>{m.querySelectorAll("messageEventDefinition, timerEventDefinition, errorEventDefinition, escalationEventDefinition, signalEventDefinition, conditionalEventDefinition").forEach(v=>{const b=v.tagName.replace("EventDefinition","").toLowerCase();b&&!h.includes(b)&&h.push(b)})});let f=1;return s.forEach(m=>{const g=m.tagName.toLowerCase();if(g.includes("exclusive"))f*=2;else if(g.includes("parallel")){const v=m.querySelectorAll("outgoing").length;f*=Math.max(2,v)}else g.includes("inclusive")&&(f*=2)}),{taskCount:i,decisionPoints:o,parallelBranches:l,errorHandlers:d,eventTypes:h.length>0?h:["none"],estimatedPaths:Math.max(1,f)}}catch(e){return console.error("Failed to calculate metrics:",e),{taskCount:0,decisionPoints:0,parallelBranches:0,errorHandlers:0,eventTypes:[],estimatedPaths:1}}},ghe=(t,e)=>{try{const r=new DOMParser().parseFromString(t,"application/xml");if(r.getElementsByTagName("parsererror").length>0)return e==="pid"?"Instrumentation and equipment interactions.":"Business process from start to finish.";const i=["bpmn:task","bpmn:userTask","bpmn:serviceTask","bpmn:manualTask","bpmn:sendTask","bpmn:receiveTask","bpmn:scriptTask","bpmn:businessRuleTask","bpmn:callActivity","task","userTask","serviceTask","manualTask","sendTask","receiveTask","scriptTask","businessRuleTask","callActivity"],s=[];if(i.forEach(d=>{const h=r.getElementsByTagName(d);for(let p=0;p<h.length;p++){const f=h[p].getAttribute("name");f&&!s.includes(f)&&s.push(f)}}),!s.length)return e==="pid"?"Instrumentation and equipment interactions.":"Business process from start to finish.";const o=20,a=s.length>o?s.slice(0,o):s,l=s.length>o?", and more.":".";return`${e==="pid"?"P&ID workflow covering: ":"Process steps include: "}${a.join(", ")}${l}`}catch(n){return console.error("Failed to extract process summary:",n),e==="pid"?"Instrumentation and equipment interactions.":"Business process from start to finish."}},Cm=[{id:"core-linear",title:"Core Linear Flow",description:"Straight-through execution with only essential activities.",complexity:"basic",instructions:{bpmn:"Generate the most streamlined BPMN possible for the process summary, keeping only critical tasks and a single happy path.",pid:"Focus on the principal equipment path and core instrumentation, omitting secondary loops or optional devices."}},{id:"human-centric",title:"Human-Centric Collaboration",description:"Highlights manual approvals and team handoffs.",complexity:"intermediate",instructions:{bpmn:"Emphasize manual approvals, include at least two swimlanes, and show review loops that require people to coordinate.",pid:"Highlight manual valves, operator checkpoints, and instrumentation that requires human acknowledgement before continuing."}},{id:"automation-lean",title:"Automation Lean",description:"Switches repetitive work to automated service steps.",complexity:"intermediate",instructions:{bpmn:"Transform repetitive or high-volume tasks into service tasks with system integrations and automated escalations.",pid:"Show controllers and transmitters automating monitoring tasks, including signal lines that close the loop automatically."}},{id:"parallel-efficiency",title:"Parallel Efficiency",description:"Optimizes throughput with parallel branches and event handling.",complexity:"advanced",instructions:{bpmn:"Introduce parallel gateways to split workload, use event-based gateways for exceptions, and add a compensation or rollback path.",pid:"Model redundant equipment paths in parallel with automated switchovers and interlock signals connecting the branches."}},{id:"compliance-audit",title:"Compliance & Audit Ready",description:"Adds control checkpoints, logging, and audit artefacts.",complexity:"advanced",instructions:{bpmn:"Layer in compliance checks, logging activities, and escalation paths. Attach data objects for evidence and audit trails.",pid:"Add monitoring instrumentation, safety valves, bypass lines, and annotations for regulatory checkpoints and alarms."}},{id:"experience-journey",title:"Customer Experience Journey",description:"Maps personas, SLAs, and service touchpoints end to end.",complexity:"intermediate",instructions:{bpmn:"Introduce swimlanes for customer-facing roles, note SLA timers, and highlight feedback or survey capture points along the path.",pid:"Call out operator interfaces, HMI panels, and alarm acknowledgements that connect process equipment to customer-impacting metrics."}},{id:"resilient-recovery",title:"Resilient Recovery Blueprint",description:"Builds failover branches, compensations, and escalation playbooks.",complexity:"advanced",instructions:{bpmn:"Layer event subprocesses for incidents, model compensation tasks, and show escalation to support teams with clear rollback steps.",pid:"Add redundancy loops, relief paths, and interlocks that trigger automated shutdown, including operator guidance annotations."}}],rD=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2),Lu=async(t,e,n="#ffffff")=>{const r=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),i=URL.createObjectURL(r);try{const s=new Image;s.crossOrigin="anonymous";const o=new Promise((h,p)=>{s.onload=()=>h(),s.onerror=f=>p(f)});s.src=i,await o;const a=document.createElement("canvas");a.width=s.naturalWidth||s.width||1200,a.height=s.naturalHeight||s.height||800;const l=a.getContext("2d");if(!l)throw new Error("Unable to create 2D canvas context");l.fillStyle=n,l.fillRect(0,0,a.width,a.height),l.drawImage(s,0,0);const c=a.toDataURL(e);return await(await fetch(c)).blob()}finally{URL.revokeObjectURL(i)}},tl=(t,e)=>{const n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)},U8=t=>{try{const n=new DOMParser().parseFromString(t,"application/xml");if(n.getElementsByTagName("parsererror").length>0)return{elementCount:0,complexity:"simple"};const r=n.querySelectorAll("task, userTask, serviceTask, manualTask, sendTask, receiveTask, scriptTask, businessRuleTask, callActivity"),i=n.querySelectorAll("exclusiveGateway, parallelGateway, inclusiveGateway, eventBasedGateway"),s=n.querySelectorAll("startEvent, intermediateCatchEvent, intermediateThrowEvent, endEvent, boundaryEvent"),o=n.querySelectorAll("sequenceFlow, messageFlow"),a=n.querySelectorAll("subProcess, callActivity"),l=r.length+i.length+s.length+o.length+a.length;let c;return l<=20?c="simple":l<=50?c="intermediate":l<=100?c="complex":c="very-complex",{elementCount:l,complexity:c}}catch(e){return console.error("Failed to calculate complexity:",e),{elementCount:0,complexity:"simple"}}},V8=async(t,e,n)=>Promise.race([t,new Promise((r,i)=>setTimeout(()=>i(new Error(n)),e))]),il=async(t,e=5e3)=>{const n=document.createElement("div");n.style.position="fixed",n.style.left="-99999px",n.style.top="-99999px",n.style.width="1200px",n.style.height="800px",document.body.appendChild(n);try{const r=(async()=>{const s=new eo({container:n});await s.importXML(t);const{svg:o}=await s.saveSVG();return s.destroy(),o})(),i=await V8(r,e,"SVG rendering timed out");return document.body.removeChild(n),i}catch(r){throw n.parentNode&&document.body.removeChild(n),r}},vhe=async(t,e=5e3)=>{const n=document.createElement("div");n.style.position="fixed",n.style.left="-99999px",n.style.top="-99999px",n.style.width="2000px",n.style.height="1500px",document.body.appendChild(n);try{const r=(async()=>{const s=new eo({container:n});await s.importXML(t),await new Promise(a=>setTimeout(a,800));const{svg:o}=await s.saveSVG();return s.destroy(),o})(),i=await V8(r,e,"Canvas rendering timed out");return document.body.removeChild(n),i}catch(r){throw n.parentNode&&document.body.removeChild(n),r}},yhe=async(t,e)=>{try{return null}catch(n){return console.error("Server preview request failed:",n),null}},ax=(t,e)=>{try{const r=new DOMParser().parseFromString(t,"application/xml");if(r.getElementsByTagName("parsererror").length>0)throw new Error("Invalid XML");const i=Array.from(r.querySelectorAll("task, userTask, serviceTask")).slice(0,10),s=i.map(m=>m.getAttribute("name")||"Task").filter(Boolean),o=r.querySelectorAll("startEvent"),a=r.querySelectorAll("endEvent"),l=r.querySelectorAll("exclusiveGateway, parallelGateway, inclusiveGateway"),c=600,d=Math.max(400,s.length*60+100);let h=`<svg width="${c}" height="${d}" xmlns="http://www.w3.org/2000/svg" style="background: white;">
      <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
          <polygon points="0 0, 10 3, 0 6" fill="#1976d2" />
        </marker>
        <style>
          .task-box { fill: #e3f2fd; stroke: #1976d2; stroke-width: 2; }
          .start-end { fill: #c8e6c9; stroke: #388e3c; stroke-width: 2; }
          .gateway { fill: #fff3e0; stroke: #f57c00; stroke-width: 2; }
          .text { font-family: Arial, sans-serif; font-size: 12px; fill: #333; }
          .title { font-size: 14px; font-weight: bold; fill: #1976d2; }
        </style>
      </defs>
      <text x="${c/2}" y="25" text-anchor="middle" class="title">${e}</text>
      <text x="${c/2}" y="45" text-anchor="middle" class="text" style="font-size: 10px; fill: #666;">Simplified Preview</text>
    `;o.length>0&&(h+=`<circle cx="50" cy="80" r="15" class="start-end" />
              <text x="50" y="85" text-anchor="middle" class="text" style="font-size: 10px;">Start</text>`);let p=120;s.forEach((m,g)=>{const b=m.length>25?m.substring(0,22)+"...":m;h+=`<rect x="90" y="${p-15}" width="120" height="30" rx="5" class="task-box" />
              <text x="150" y="${p+2}" text-anchor="middle" class="text">${b}</text>`,g<s.length-1&&(h+=`<line x1="150" y1="${p+15}" x2="150" y2="${p+45}" stroke="#1976d2" stroke-width="2" marker-end="url(#arrowhead)" />`),p+=60}),a.length>0&&(h+=`<circle cx="150" cy="${p}" r="15" class="start-end" />
              <text x="150" y="${p+5}" text-anchor="middle" class="text" style="font-size: 10px;">End</text>`),l.length>0&&(h+=`<text x="${c-100}" y="80" class="text" style="font-size: 10px; fill: #f57c00;">${l.length} Gateway${l.length>1?"s":""}</text>`);const f=i.length+l.length+o.length+a.length;return h+=`<text x="${c/2}" y="${d-20}" text-anchor="middle" class="text" style="font-size: 10px; fill: #666;">${f} elements total</text>`,h+="</svg>",h}catch{return`<svg width="400" height="200" xmlns="http://www.w3.org/2000/svg" style="background: white;">
      <text x="200" y="100" text-anchor="middle" font-family="Arial" font-size="14" fill="#666">${e}</text>
      <text x="200" y="120" text-anchor="middle" font-family="Arial" font-size="12" fill="#999">Diagram Preview</text>
    </svg>`}};function xhe(t,e,n){return new Promise(r=>{const i=setTimeout(()=>{r({data:null,error:new Error(`Function call timed out after ${n/1e3} seconds`)})},n);he.functions.invoke(t,e).then(s=>{clearTimeout(i),r(s)}).catch(s=>{clearTimeout(i),r({data:null,error:s})})})}const _0=new Map,bhe=5*60*1e3,whe=t=>{const e=_0.get(t);return e&&Date.now()-e.timestamp<bhe?e.svg:(e&&_0.delete(t),null)},_he=(t,e)=>{_0.set(t,{svg:e,timestamp:Date.now()})},Ehe=(t,e)=>{const n=t.slice(0,100)+e;return btoa(n).replace(/[^a-zA-Z0-9]/g,"")},iD=({xml:t,title:e,onRetry:n,onDownloadAvailable:r})=>{const[i,s]=_.useState(null),[o,a]=_.useState(!0),[l,c]=_.useState(null),[d,h]=_.useState(null),[p,f]=_.useState(0),[m,g]=_.useState("svg");return _.useEffect(()=>{let v=!0;const b=U8(t),x=Ehe(t,e),y=whe(x);if(y){s(y),a(!1),r&&r(!0);return}return(async()=>{a(!0),c(null),h(null),g("svg");try{let E=null,S=null;try{g("svg"),E=await il(t,5e3),console.log(` SVG render successful for ${e}`)}catch(j){S=j,console.warn(` SVG render failed for ${e}:`,j);try{g("canvas"),E=await vhe(t,5e3),console.log(` Canvas render successful for ${e}`)}catch(C){if(S=C,console.warn(` Canvas render failed for ${e}:`,C),b.complexity==="complex"||b.complexity==="very-complex"){g("server");try{const P=await yhe(t,e);if(P)E=P,console.log(` Server preview successful for ${e}`);else throw new Error("Server preview not available")}catch(P){S=P,console.warn(` Server preview failed for ${e}:`,P)}}if(!E){g("svg");try{E=ax(t,e),console.log(` Simplified preview generated for ${e}`)}catch(P){console.error(` Even simplified preview failed for ${e}:`,P),E=ax(t,e)}}}}if(v)if(E)s(E),_he(x,E),g("svg"),r&&r(!0);else{const j=ax(t,e);s(j),r&&r(!0)}}catch(E){if(v)try{const S=ax(t,e);s(S),r&&r(!0)}catch(S){console.error(`Even simplified preview failed for ${e}:`,S);const j=`<svg width="400" height="200" xmlns="http://www.w3.org/2000/svg" style="background: white;">
              <text x="200" y="100" text-anchor="middle" font-family="Arial" font-size="14" fill="#666">${e}</text>
              <text x="200" y="120" text-anchor="middle" font-family="Arial" font-size="12" fill="#999">Diagram Preview</text>
            </svg>`;s(j),r&&r(!0)}console.error(`Failed to render preview for ${e}:`,E)}finally{v&&a(!1)}})(),()=>{v=!1}},[t,e,p,r]),u.jsx("div",{className:"w-full h-full flex items-center justify-center overflow-hidden",style:{backgroundColor:"#ffffff"},children:o?u.jsxs("div",{className:"flex flex-col items-center gap-2",children:[u.jsx(Vr,{className:"h-8 w-8 animate-spin text-muted-foreground"}),m==="server"&&u.jsx("p",{className:"text-xs text-muted-foreground",children:"Generating server preview..."})]}):i?u.jsx("img",{src:`data:image/svg+xml;utf8,${encodeURIComponent(i)}`,alt:`${e} preview`,className:"h-full w-full object-contain"}):null})},GP=({xml:t,onSave:e,diagramType:n="bpmn",onRefine:r})=>{var fO,mO,gO;Ns();const i=_.useRef(null),s=_.useRef(null),[o,a]=_.useState(!1),[l,c]=_.useState(!1),[d,h]=_.useState(null),[p,f]=_.useState(!1),[m,g]=_.useState(!0),[v,b]=_.useState(!1),[x,y]=_.useState(!1),[w,E]=_.useState([]),[S,j]=_.useState(!1),[C,P]=_.useState([]),[R,N]=_.useState(!1),[I,M]=_.useState(null),[W,ce]=_.useState({completed:0,total:0}),[se,ve]=_.useState(new Map),[pt,je]=_.useState(5),[lt,Nt]=_.useState(0),Ae=_.useRef(null),[Qe,ze]=_.useState(null),[Ot,Zt]=_.useState([]),[me,oe]=_.useState(!1),[pe,ne]=_.useState(null),[Te,de]=_.useState(null),Ie=_.useRef(!0),qe=_.useRef(!1),[_t,Ht]=_.useState([]),[on,te]=_.useState(!1),[Be,xe]=_.useState(null),[ct,ft]=_.useState(!1),nt=_.useRef([]),fe=_.useRef(null),Ye=_.useMemo(()=>ghe(t,n),[t,n]),In=_.useCallback(k=>{const F=k.metrics||{parallelBranches:0,errorHandlers:0},z=k.complexity,V=[],q=[],U=[];return z==="basic"?(V.push("Simple and easy to understand"),V.push("Fast to implement and maintain"),V.push("Low complexity reduces errors"),q.push("Limited flexibility for complex scenarios"),q.push("No error handling or recovery paths"),q.push("Cannot model parallel or conditional flows"),U.push("Simple, linear processes"),U.push("Quick prototyping"),U.push("Training and documentation")):z==="intermediate"?(V.push("Balanced complexity and clarity"),V.push("Includes decision points and parallel flows"),V.push("Human and system interaction points"),F.errorHandlers>0&&V.push("Basic error handling included"),F.parallelBranches>0&&V.push("Optimized for efficiency"),q.push("May lack advanced error recovery"),q.push("Limited compliance checkpoints"),U.push("Standard business processes"),U.push("Process optimization"),U.push("Team collaboration workflows")):z==="advanced"&&(V.push("Comprehensive error handling and recovery"),V.push("Multiple execution paths"),V.push("Compliance and audit ready"),V.push("External system integration"),F.errorHandlers>1&&V.push("Robust error recovery mechanisms"),F.parallelBranches>2&&V.push("Highly optimized parallel execution"),q.push("Higher implementation complexity"),q.push("Requires more maintenance"),q.push("Steeper learning curve"),U.push("Enterprise-grade processes"),U.push("Compliance-critical workflows"),U.push("Complex multi-system integrations"),U.push("High-availability systems")),{strengths:V,weaknesses:q,useCases:U}},[]),wr=_.useMemo(()=>{var F;if(!C.length)return null;const k=C.map(z=>{let V=0;const q=z.metrics||{taskCount:0,decisionPoints:0,parallelBranches:0,errorHandlers:0,estimatedPaths:1};return z.complexity==="intermediate"?V+=15:z.complexity==="basic"?V+=8:V+=5,q.taskCount>=3&&q.taskCount<=12?V+=8:q.taskCount>12&&q.taskCount<=20?V+=5:q.taskCount>0&&(V+=2),q.decisionPoints>=1&&q.decisionPoints<=3?V+=8:q.decisionPoints>3&&(V+=4),q.parallelBranches>0&&q.parallelBranches<=2?V+=6:q.parallelBranches>2&&(V+=3),q.errorHandlers>0&&(V+=5),q.errorHandlers>1&&(V+=2),q.estimatedPaths>=2&&q.estimatedPaths<=5?V+=4:q.estimatedPaths>5&&(V+=2),q.taskCount>25&&(V-=5),q.taskCount<2&&(V-=3),{model:z,score:V}});return k.sort((z,V)=>V.score-z.score),((F=k[0])==null?void 0:F.model)||C[0]},[C]),Jt=_.useMemo(()=>{if(!C.length)return null;if(Qe){const k=C.find(F=>F.id===Qe);if(k)return k}return C[0]},[C,Qe]),Zo=_.useCallback(async()=>{if(s.current)try{const k=await s.current.saveXML({format:!0});if(k.xml)return k.xml}catch(k){console.error("Failed to capture current XML snapshot:",k)}return t},[t]),Yi=_.useCallback(async()=>{if(p){j(!0);try{const{data:k,error:F}=await he.from("user_profiles").select("user_id,email,created_at,last_login");if(F)throw F;const{data:z,error:V}=await he.from("user_roles").select("user_id, role");if(V)throw V;const q=new Map;(z??[]).forEach(({user_id:Z,role:we})=>{const Ee=q.get(Z)??[];q.set(Z,[...Ee,we])});const U=(k??[]).map(({user_id:Z,email:we,created_at:Ee,last_login:Xt})=>({userId:Z,email:we,roles:q.get(Z)??["user"],createdAt:Ee,lastLogin:Xt}));E(U)}catch(k){console.error("Failed to load collaborators:",k),L.error("Unable to load collaborators right now")}finally{j(!1)}}},[p]),Jo=_.useCallback(k=>{nt.current=[...nt.current,k],Ht(nt.current.slice(-50))},[]),Ds=_.useCallback(async k=>{if(!(!d||nt.current.length===0))try{const F=await Zo(),{error:z}=await he.from("bpmn_generations").insert({user_id:d.id,input_type:"log",input_description:`system-use:${pe??"unknown"}:${Date.now()}`,generated_bpmn_xml:F,alternative_models:JSON.parse(JSON.stringify([{events:nt.current,source:"system-tracking",capturedAt:new Date().toISOString()}]))});if(z)throw z;nt.current=[],Ht([]),k!=null&&k.silent||L.success("System usage log saved")}catch(F){console.error("Failed to persist system activities:",F),k!=null&&k.silent||L.error("Could not save system activity log")}},[d,pe,Zo]),Su=_.useCallback(()=>{var z;fe.current&&fe.current();const k=nD(((z=document.body)==null?void 0:z.innerText)??"");Jo({id:rD(),type:"visit",timestamp:new Date().toISOString(),details:{url:window.location.href,title:document.title,contentPreview:k,referrer:document.referrer||void 0}});const F=V=>{var U;const q=V.target;q&&Jo({id:rD(),type:"click",timestamp:new Date().toISOString(),details:{url:window.location.href,text:((U=q.innerText)==null?void 0:U.trim().slice(0,120))||void 0,tag:q.tagName.toLowerCase(),xpath:fhe(q),contentPreview:nD(q.textContent)}})};document.addEventListener("click",F,!0),fe.current=()=>{document.removeEventListener("click",F,!0)}},[Jo]),ea=_.useCallback(async k=>{fe.current&&(fe.current(),fe.current=null),await Ds(k),te(!1)},[Ds]),fh=_.useCallback(k=>{if(!p){L.error("Only Process Managers can change editing lock");return}b(k),pe&&localStorage.setItem(`bpmn-lock:${pe}`,k?"locked":"unlocked"),L.success(k?"Collaborators are now in view-only mode":"Collaborators can edit this diagram")},[pe,p]),ta=_.useCallback(async k=>{if(p){if(k===(d==null?void 0:d.id)){L.info("You already have Process Manager rights.");return}try{const{error:F}=await he.from("user_roles").insert({user_id:k,role:"admin"});if(F){if(F.code==="23505"){L.info("User already has Process Manager rights.");return}throw F}L.success("Process Manager access granted"),Yi()}catch(F){console.error("Failed to grant access:",F),L.error("Unable to grant access")}}},[d==null?void 0:d.id,p,Yi]),nm=_.useCallback(async k=>{if(p){if(k===(d==null?void 0:d.id)){L.error("You cannot remove your own Process Manager rights.");return}try{const{error:F}=await he.from("user_roles").delete().match({user_id:k,role:"admin"});if(F)throw F;L.success("Process Manager access revoked"),Yi()}catch(F){console.error("Failed to revoke access:",F),L.error("Unable to revoke access")}}},[d==null?void 0:d.id,p,Yi]),na=_.useCallback(async()=>{oe(!0);try{let k=he.from("bpmn_generations").select("id, created_at, input_description, input_type, alternative_models, generated_bpmn_xml, user_id").order("created_at",{ascending:!1}).limit(p?25:10);!p&&d&&(k=k.eq("user_id",d.id));const{data:F,error:z}=await k;if(z)throw z;Zt(F??[])}catch(k){console.error("Failed to load log history:",k),L.error("Unable to load BPMN history right now")}finally{oe(!1)}},[d,p]),ra=_.useCallback(async(k=!1)=>{var F;if(!d){L.error("Please sign in to open Modelling Agent Mode");return}M(null),N(!0),P([]),ze(null),xe(null),ft(!1);try{const z=await Zo(),V=pe??await wE(z);if(pe||ne(V),!k&&!qe.current){const{data:Q,error:Ke}=await he.from("bpmn_generations").select("id, alternative_models, created_at").eq("user_id",d.id).eq("input_description",`modelling-agent:${V}`).not("alternative_models","is",null).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(Ke&&Ke.code!=="PGRST116"&&console.warn("Error checking cache:",Ke),Q!=null&&Q.alternative_models){const mt=Q.alternative_models;if(Array.isArray(mt)&&mt.length>0){console.log(`[Cache] Found ${mt.length} cached alternatives`),P(mt),qe.current=!0,N(!1);return}}}const U=(Q=>{const Ke=Cm.filter(Ut=>Ut.complexity==="basic"),mt=Cm.filter(Ut=>Ut.complexity==="intermediate"),wn=Cm.filter(Ut=>Ut.complexity==="advanced"),Tn=[];if(Q===3)Ke.length>0&&Tn.push(Ke[0]),mt.length>0&&Tn.push(mt[0]),wn.length>0&&Tn.push(wn[0]);else if(Q===5){Ke.length>0&&Tn.push(Ke[0]);for(let Ut=0;Ut<Math.min(2,mt.length);Ut++)Tn.push(mt[Ut]);for(let Ut=0;Ut<Math.min(2,wn.length);Ut++)Tn.push(wn[Ut])}else if(Q===7){Ke.length>0&&Tn.push(Ke[0]);for(let Ut=0;Ut<Math.min(3,mt.length);Ut++)Tn.push(mt[Ut]);for(let Ut=0;Ut<Math.min(3,wn.length);Ut++)Tn.push(wn[Ut])}if(Tn.length<Q){const Ut=new Set(Tn.map(Zi=>Zi.id)),hs=Cm.filter(Zi=>!Ut.has(Zi.id));Tn.push(...hs.slice(0,Q-Tn.length))}return Tn.slice(0,Q)})(pt);if(!U.length)throw new Error("No variant definitions available for generation.");const Z=U.length;ce({completed:0,total:Z,current:void 0});const we=new Map;U.forEach(Q=>{we.set(Q.id,"queued")}),ve(we);const Ee=[];let Xt=0;const tn=async(Q,Ke)=>{var Ut,hs,Zi,Xa;const mt=Date.now();let wn,Tn=0;try{ve(er=>{const Nn=new Map(er);return Nn.set(Q.id,"generating"),Nn}),ce({completed:Xt,total:Z,current:Q.title});const Jn=n==="pid"?Q.instructions.pid:Q.instructions.bpmn,zs={basic:{maxElements:12,maxTasks:6,maxBranches:0,maxDecisionPoints:0,maxSubprocesses:0,maxDepth:1,description:"Minimal, straight-line flow with only essential activities"},intermediate:{maxElements:25,maxTasks:12,maxBranches:2,maxDecisionPoints:1,maxSubprocesses:1,maxDepth:2,description:"Balanced with some parallelism and decision points"},advanced:{maxElements:45,maxTasks:20,maxBranches:4,maxDecisionPoints:3,maxSubprocesses:2,maxDepth:3,description:"Complex with error handling, parallel flows, and subprocesses"}},Ti=zs[Q.complexity]||zs.intermediate,Ni=((er,Nn)=>er.complexity==="basic"?`
CRITICAL: Generate a BEGINNER-LEVEL BPMN diagram - SIMPLE, LINEAR SEQUENCE ONLY.

MODE: BEGINNER
The complexity of the diagram must align with Beginner mode:
- Use ONLY basic tasks and events in a linear sequence
- AVOID branches, parallel flows, or advanced notations

MANDATORY STRUCTURE FOR BEGINNER TIER:
1. Start Event  Basic Task 1  Basic Task 2  Basic Task 3  ...  End Event
2. Use only simple <task> or <userTask> elements (no serviceTask, no manualTask)
3. Use only <startEvent> and <endEvent> (no intermediate events)
4. NO gateways (no XOR, AND, OR, or Inclusive gateways)
5. NO parallel branches
6. NO decision points
7. NO subprocesses
8. NO loops or backflows
9. NO pools or lanes
10. NO boundary events
11. NO BPMN artifacts (data objects, annotations, groups)
12. Simple linear sequence only
13. Maximum ${Ti.maxTasks} tasks total
14. Each task flows directly to the next task

EXAMPLE STRUCTURE:
<startEvent>  <task name="Task 1">  <task name="Task 2">  <task name="Task 3">  <endEvent>

DO NOT include:
- Any gateways (exclusiveGateway, parallelGateway, inclusiveGateway, eventBasedGateway)
- Any subprocesses (subProcess, callActivity)
- Any boundary events (boundaryEvent)
- Any intermediate events (intermediateCatchEvent, intermediateThrowEvent)
- Any loops or cycles
- Any pools or lanes
- Any BPMN artifacts (dataObject, dataStore, annotation, group)
- Any advanced notations

Generate ONLY a simple, linear sequential flow with basic tasks and events.`:er.complexity==="intermediate"?er.id==="automation-lean"?`
AUTOMATION LEAN: Transform repetitive/high-volume tasks into automated service tasks.

CRITICAL TRANSFORMATION:
- Identify repetitive, routine, or high-volume tasks in the process
- Convert these tasks to <serviceTask> elements (automated system tasks)
- Add system integrations: name service tasks with integration context (e.g., "Automated Data Validation", "System Notification", "Auto-Process Payment")
- Include automated escalations: use intermediate events or boundary events for automated error handling
- Keep userTask only for tasks requiring human judgment or approval
- Use 1-2 exclusiveGateway for decision points (automated routing)
- Include 1+ serviceTask for each repetitive task pattern identified
- 8-12 tasks total (mix of userTask and serviceTask)
- 2-3 execution paths

STRUCTURE: startEvent  [automated service tasks]  [decision gateways]  [user tasks for approvals]  endEvent
Focus on automation: maximize serviceTask usage for repetitive work.`:er.id==="human-centric"?`
HUMAN-CENTRIC COLLABORATION: Emphasize manual approvals and team coordination.

REQUIREMENTS:
- 2+ swimlanes (pools or lanes) representing different roles/departments
- Multiple userTask elements for manual work
- 1-2 exclusiveGateway for approval decisions
- Review loops: show tasks that require human review/approval before continuing
- Include intermediate events for notifications/handoffs between people
- 1 subprocess OR 1 intermediate event (message/timer/signal) for coordination
- 8-12 tasks total (mostly userTask)
- 2-3 execution paths showing different approval outcomes

STRUCTURE: startEvent  [swimlanes with user tasks]  [approval gateways]  [review loops]  endEvent
Focus on human collaboration: show handoffs, approvals, and coordination.`:er.id==="parallel-efficiency"?`
PARALLEL EFFICIENCY: Maximize concurrent execution of independent activities.

REQUIREMENTS:
- 1-2 parallelGateway pairs (AND split + AND join) for concurrent flows
- Identify tasks that can run simultaneously (no dependencies)
- Group independent tasks into parallel branches
- Use exclusiveGateway for decisions (1-2 decision points)
- Mix of userTask and serviceTask
- 1 subprocess OR 1 intermediate event for coordination
- 8-12 tasks total
- 2-3 parallel branches with 2-4 tasks each

STRUCTURE: startEvent  [parallelGateway split]  [concurrent branches]  [parallelGateway join]  endEvent
Focus on parallelism: maximize tasks running simultaneously.`:`
INTERMEDIATE BPMN: Include structure with decisions and parallel flows.

REQUIREMENTS:
- 1-2 exclusiveGateway (decision points) with 2-3 paths each
- 1 parallelGateway (AND) OR 1 subProcess
- Mix of userTask (human) and serviceTask (system)
- 1 subprocess OR 1 intermediate event (message/timer/signal)
- 8-12 tasks total
- 2-3 execution paths

STRUCTURE: startEvent  [gateways/subprocesses]  endEvent with decision branches and optional parallel flows.`:er.complexity==="advanced"?`
ADVANCED BPMN: Complex structure with error handling, compliance, and integration.

REQUIREMENTS:
- 2-3 gateways (XOR/Inclusive/Event-based) creating multiple paths
- 2-4 parallelGateway pairs (split + join)
- 1-2 subProcess elements
- 1+ boundaryEvent (error/escalation/timer) attached to task/subprocess
- 1+ recovery path (compensation/rollback/retry)
- 1+ compliance checkpoint (task/subprocess with "Compliance"/"Audit"/"Validation" in name)
- 1+ serviceTask for external system integration
- 2+ pools OR 2+ lanes
- 2+ BPMN artifacts (dataObject/dataStore/annotation/group)
- 15-20 tasks total
- 4+ execution paths

STRUCTURE: Complex routing with gateways, parallel flows, error handling, compliance checkpoints, and external integrations.`:"")(Q,Jn),Za=Q.complexity==="basic"?"BASIC: Simple sequential flow only. NO gateways, NO subprocesses, NO branching.":Q.complexity==="intermediate"?"INTERMEDIATE: Must include 1+ gateway OR 1+ subprocess. Show structure and organization.":"ADVANCED: Must include 2-3 gateways, 2-4 parallel branches, 1-2 subprocesses, error handling, 4+ paths.";wn=`VARIANT: ${Q.title} (${Q.complexity.toUpperCase()})
Description: ${Q.description}

Process: ${Ye}

${Ni}

Constraints: Max ${Ti.maxElements} elements, ${Ti.maxTasks} tasks, ${Ti.maxBranches} branches, ${Ti.maxDecisionPoints} decisions, ${Ti.maxSubprocesses} subprocesses.

${Za}

Generate valid BPMN 2.0 XML matching the ${Q.complexity.toUpperCase()} tier. Include mandatory structures. Return ONLY XML, no markdown.

Seed: ${Date.now()}-${Math.random().toString(36).substring(7)}`,Tn=wn.length;const la=Ni.length,ca=(Ye==null?void 0:Ye.length)||0;console.group(`[Modelling Agent] Generating variant: ${Q.title} (${Q.complexity})`),console.log("Variant Details:",{id:Q.id,title:Q.title,complexity:Q.complexity,description:Q.description,index:Ke}),console.log("Prompt Metrics:",{totalLength:Tn,variantSpecificLength:la,processSummaryLength:ca,baseInstructionsLength:Jn.length,estimatedTokens:Math.ceil(Tn/4)}),console.log("Constraints:",Ti),console.log("Prompt Structure:",{hasVariantSpecific:la>0,hasProcessSummary:ca>0,hasBaseInstructions:Jn.length>0}),console.log(`Generating ${Q.title} with skipCache=true, modelingAgentMode=true`);const TY=Q.id==="automation-lean",N1=Q.complexity==="advanced"?12e4:Q.complexity==="intermediate"?TY?105e3:9e4:45e3,NY=Date.now(),{data:pr,error:ps}=await xhe("generate-bpmn",{body:{prompt:wn,diagramType:n,skipCache:!0,modelingAgentMode:!0}},N1),O1=Date.now()-NY;if(console.log("API Response:",{duration:`${O1}ms`,hasError:!!ps,hasData:!!pr,hasBpmnXml:!!(pr!=null&&pr.bpmnXml),errorMessage:ps==null?void 0:ps.message,responseKeys:pr?Object.keys(pr):[]}),ps){console.error(`[Modelling Agent] API Error for ${Q.title}:`,{error:ps.message,stack:ps instanceof Error?ps.stack:void 0,duration:`${O1}ms`,timeout:`${N1}ms`,isTimeout:(Ut=ps.message)==null?void 0:Ut.includes("timed out")});let er=ps.message;throw(hs=ps.message)!=null&&hs.includes("timed out")?er=`Request timed out after ${N1/1e3}s. ${Q.complexity==="advanced"?"Advanced variants require more processing time. ":Q.complexity==="intermediate"?"Intermediate variants may need additional time. ":""}Please try generating alternatives again, or generate them individually.`:(Zi=ps.message)!=null&&Zi.includes("rate limit")?er="API rate limit exceeded. Please wait a moment and try again. Generating multiple variants in parallel may hit rate limits.":(Xa=ps.message)!=null&&Xa.includes("429")&&(er="Too many requests. Please wait a moment and try again. Consider generating variants one at a time."),new Error(er)}if(!(pr!=null&&pr.bpmnXml))throw console.error(`[Modelling Agent] No BPMN XML returned for ${Q.title}:`,{data:pr,duration:`${O1}ms`,hasData:!!pr,dataKeys:pr?Object.keys(pr):[]}),new Error(`No BPMN XML returned for ${Q.title}. The AI model may not have generated valid output.`);const vO=pr.bpmnXml.length;console.log("BPMN XML Received:",{length:vO,estimatedTokens:Math.ceil(vO/4),startsWithXml:pr.bpmnXml.trim().startsWith("<?xml"),containsDefinitions:pr.bpmnXml.includes("<bpmn:definitions")||pr.bpmnXml.includes("<definitions")});const um=U8(pr.bpmnXml),fs=mhe(pr.bpmnXml),yO=Q.complexity,Ch=[],Hs=[],xO=Q.complexity==="advanced"?60:Q.complexity==="intermediate"?50:45;um.elementCount>xO&&Hs.push(`High element count (${um.elementCount} > ${xO}) - may affect rendering performance`);try{const Nn=new DOMParser().parseFromString(pr.bpmnXml,"application/xml");Nn.getElementsByTagName("parsererror").length>0&&Ch.push("Invalid XML structure"),Nn.querySelectorAll("sequenceFlow").forEach((D1,bO)=>{const DY=D1.getAttribute("sourceRef"),$Y=D1.getAttribute("targetRef");(!DY||!$Y)&&Ch.push(`Flow ${bO} missing sourceRef or targetRef`)});const dm=Nn.querySelectorAll("exclusiveGateway, parallelGateway, inclusiveGateway, eventBasedGateway"),Py=Nn.querySelectorAll("subProcess, callActivity"),RY=Nn.querySelectorAll("boundaryEvent"),q$e=Nn.querySelectorAll("parallelGateway"),W$e=Nn.querySelectorAll("userTask"),AY=Nn.querySelectorAll("serviceTask"),IY=Nn.querySelectorAll("intermediateCatchEvent, intermediateThrowEvent"),R1=Nn.querySelectorAll("participant"),A1=Nn.querySelectorAll("lane"),G$e=Nn.querySelectorAll("dataObject, dataObjectReference"),K$e=Nn.querySelectorAll("textAnnotation"),Y$e=Nn.querySelectorAll("group"),I1=Nn.querySelectorAll("dataObject, dataObjectReference, textAnnotation, group");Q.complexity==="basic"?(dm.length>0&&Hs.push(`BEGINNER tier should have no gateways, but found ${dm.length}`),Py.length>0&&Hs.push(`BEGINNER tier should have no subprocesses, but found ${Py.length}`),fs.decisionPoints>0&&Hs.push(`BEGINNER tier should have no decision points, but found ${fs.decisionPoints}`),(R1.length>1||A1.length>0)&&Hs.push(`BEGINNER tier should have no pools/lanes, but found ${R1.length} pools and ${A1.length} lanes`),I1.length>0&&Hs.push(`BEGINNER tier should have no BPMN artifacts, but found ${I1.length}`)):Q.complexity==="intermediate"?dm.length===0&&Py.length===0&&IY.length===0&&fs.parallelBranches===0&&Hs.push("INTERMEDIATE tier should have at least 1 gateway, subprocess, intermediate event, or parallel branch"):Q.complexity==="advanced"&&(dm.length>=1||Py.length>=1||fs.parallelBranches>=1||Hs.push("ADVANCED tier should have at least 1 gateway, subprocess, or parallel branch"),!(RY.length>0||I1.length>0||AY.length>0||R1.length>1||A1.length>1)&&dm.length<2&&Hs.push("ADVANCED tier should include advanced features (error handling, artifacts, integration, or multiple pools/lanes)"))}catch{Ch.push("XML parsing failed")}console.log("Validation Results:",{errors:Ch.length,warnings:Hs.length,elementCount:um.elementCount,complexity:um.complexity,metrics:{taskCount:fs.taskCount,decisionPoints:fs.decisionPoints,parallelBranches:fs.parallelBranches,errorHandlers:fs.errorHandlers,estimatedPaths:fs.estimatedPaths}}),Ch.length>0&&console.error(`[Modelling Agent] Validation errors for ${Q.title}:`,Ch),Hs.length>0&&(console.warn(`[Modelling Agent] Validation warnings for ${Q.title}:`,Hs),console.warn(`Generated structure: ${fs.decisionPoints} decision points, ${fs.parallelBranches} parallel branches, ${fs.taskCount} tasks`)),console.log(`[Model Generation] ${Q.title}: Variant complexity="${Q.complexity}", Assigned complexity="${yO}", Calculated complexity="${um.complexity}"`);const OY=Date.now()-mt;console.log(`[Modelling Agent] Successfully generated ${Q.title} in ${OY}ms`),console.groupEnd();const ky={id:`${Q.id}-${Date.now()}-${Ke}`,title:Q.title,description:Q.description,complexity:yO,xml:pr.bpmnXml,generatedAt:new Date().toISOString(),metrics:fs};return Ee.push(ky),Xt++,ve(er=>{const Nn=new Map(er);return Nn.set(Q.id,"completed"),Nn}),P([...Ee]),ce({completed:Xt,total:Z,current:void 0}),Qe||ze(ky.id),(async()=>{try{const er=[...Ee,ky],{data:Nn}=await he.from("bpmn_generations").select("id").eq("user_id",d.id).eq("input_description",`modelling-agent:${V}`).order("created_at",{ascending:!1}).limit(1).maybeSingle();Nn!=null&&Nn.id?await he.from("bpmn_generations").update({alternative_models:JSON.parse(JSON.stringify(er)),updated_at:new Date().toISOString()}).eq("id",Nn.id):await he.from("bpmn_generations").insert({user_id:d.id,input_type:"text",input_description:`modelling-agent:${V}`,generated_bpmn_xml:z,alternative_models:JSON.parse(JSON.stringify(er))}),console.log(`[Cache] Incrementally cached ${er.length} alternatives`)}catch(er){console.warn("Failed to cache alternatives incrementally:",er)}})(),ky}catch(Jn){Xt++;const zs=Date.now()-mt;return console.error(`[Modelling Agent] Failed to generate alternative "${Q.title}":`,{variant:{id:Q.id,title:Q.title,complexity:Q.complexity},error:{message:Jn instanceof Error?Jn.message:String(Jn),stack:Jn instanceof Error?Jn.stack:void 0,name:Jn instanceof Error?Jn.name:"Unknown"},duration:`${zs}ms`,promptLength:Tn,timestamp:new Date().toISOString()}),ve(Ti=>{const Qa=new Map(Ti);return Qa.set(Q.id,"failed"),Qa}),ce({completed:Xt,total:Z,current:void 0}),console.groupEnd(),(Xt===Z||Jn instanceof Error&&Jn.message.includes("rate limit"))&&L.error(`Could not generate: ${Q.title}`,{description:Jn instanceof Error?Jn.message:"An unknown error occurred. The AI model might be overloaded or the request may have timed out."}),null}},Rt=U.map((Q,Ke)=>tn(Q,Ke));if(console.log(`[Modelling Agent] Starting parallel generation of ${Z} variants`),console.log("[Modelling Agent] All variants will start generating simultaneously:",U.map(Q=>`${Q.title} (${Q.complexity})`).join(", ")),(await Promise.allSettled(Rt)).forEach((Q,Ke)=>{const mt=U[Ke];Q.status==="rejected"?console.error(`[Parallel Processing] Variant ${mt.title} (${mt.complexity}) failed:`,Q.reason):Q.status==="fulfilled"&&Q.value?console.log(`[Parallel Processing] Variant ${mt.title} (${mt.complexity}) succeeded`):Q.status==="fulfilled"&&!Q.value&&console.warn(`[Parallel Processing] Variant ${mt.title} (${mt.complexity}) returned null (failed silently)`)}),console.log(`[Modelling Agent] Generation complete: ${Ee.length} successful, ${Z-Ee.length} failed`),Ee.length<Z){const Q=U.filter(Ke=>!Ee.find(mt=>mt.title===Ke.title));console.warn("[Modelling Agent] Failed variants:",Q.map(Ke=>Ke.title))}if(ce({completed:Z,total:Z}),console.log(`[Modelling Agent] Final results: ${Ee.length} successful out of ${Z} total variants`),Ee.length<Z){const Q=Z-Ee.length,Ke=U.filter(mt=>!Ee.find(wn=>wn.title===mt.title));console.warn(`[Modelling Agent] ${Q} variants failed:`,Ke.map(mt=>`${mt.title} (${mt.complexity})`)),Ee.length>0&&L.warning(`${Ee.length} of ${Z} variants generated`,{description:Q>0?`${Q} variants failed to generate. Check console for details.`:void 0,duration:5e3})}if(!Ee.length){const Ke=`No alternative diagrams were produced. ${Z-Ee.length} of ${Z} generations failed. Check the browser console for detailed error messages.`;throw console.error(`[Modelling Agent] ${Ke}`),new Error(Ke)}P(Ee),ze(((F=Ee[0])==null?void 0:F.id)??null),qe.current=!0,console.log(`[Modelling Agent] Successfully generated ${Ee.length} variants:`,Ee.map(Q=>Q.title));try{const{data:Q}=await he.from("bpmn_generations").select("id").eq("user_id",d.id).eq("input_description",`modelling-agent:${V}`).order("created_at",{ascending:!1}).limit(1).maybeSingle();Q!=null&&Q.id?await he.from("bpmn_generations").update({alternative_models:JSON.parse(JSON.stringify(Ee)),updated_at:new Date().toISOString()}).eq("id",Q.id):await he.from("bpmn_generations").insert({user_id:d.id,input_type:"text",input_description:`modelling-agent:${V}`,generated_bpmn_xml:z,alternative_models:JSON.parse(JSON.stringify(Ee))}),console.log(`[Cache] Successfully cached ${Ee.length} alternatives`)}catch(Q){console.error("Failed to cache alternatives:",Q)}}catch(z){console.error("Failed to prepare alternative models:",z),M(z instanceof Error?z.message:"An unexpected error occurred while preparing alternatives.")}finally{N(!1),ce({completed:0,total:0})}},[d,pe,n,Ye,Zo,pt]),mh=_.useCallback(k=>{let F=k;return F=F.replace(/bpmns:/gi,"bpmn:"),F=F.replace(/bpmndi\:BPMNShape/gi,"bpmndi:BPMNShape"),F=F.replace(/bpmndi\:BPMNEdge/gi,"bpmndi:BPMNEdge"),F=F.replace(/<(\s*)di:waypoint\s+([^>]*?)>/gi,(z,V,q)=>z.trim().endsWith("/>")?z:`<${V}di:waypoint ${q}/>`),F=F.replace(/<(\s*)di:waypoint\s*>/gi,"<$1di:waypoint/>"),F=F.replace(/<\s*bpmn:flowNodeRef[^>]*>[\s\S]*?<\/\s*bpmn:flowNodeRef\s*>/gi,""),F=F.replace(/<\s*bpmns:flowNodeRef[^>]*>[\s\S]*?<\/\s*bpmns:flowNodeRef\s*>/gi,""),F=F.replace(/<\/\s*bpmn:flowNodeRef\s*>/gi,""),F=F.replace(/<\/\s*bpmns:flowNodeRef\s*>/gi,""),F=F.replace(/<\s*bpmn:flowNodeRef[^>]*\/?\s*>/gi,""),F=F.replace(/<\s*bpmns:flowNodeRef[^>]*\/?\s*>/gi,""),F=F.replace(/<\s*\/\?xml/gi,"<?xml"),F=F.replace(/&(?!(?:amp|lt|gt|quot|apos|#\d+|#x[0-9a-fA-F]+);)/g,"&amp;"),F=F.replace(/<\/\s*[^>]*:flowNodeRef[^>]*>/gi,""),F.trim()},[]),Cu=_.useCallback(async k=>{if(s.current)try{const F=mh(k.xml);await s.current.importXML(F);const z=s.current.get("canvas");try{const V=z.getViewbox();if(V){const q=V.scale??1,U=V.width??0,Z=V.height??0;isFinite(q)&&isFinite(U)&&isFinite(Z)&&U>0&&Z>0&&q>0&&z.zoom("fit-viewport")}}catch(V){console.warn("Zoom error, continuing:",V)}jy(V=>[...V,k.xml]),lm(V=>V+1),L.success(`${k.title} applied to the canvas`),ti(!1)}catch(F){console.error("Failed to apply alternative model:",F),L.error("Unable to apply this alternative diagram")}},[]),Gl=_.useCallback(k=>{const F=new Blob([k.xml],{type:"application/xml"}),z=URL.createObjectURL(F),V=document.createElement("a");V.href=z,V.download=`${k.title.replace(/\s+/g,"_").toLowerCase()}_${k.complexity}.bpmn`,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(z)},[]),Xi=_.useCallback(async k=>{if(s.current)try{await s.current.importXML(k.generated_bpmn_xml);const F=s.current.get("canvas");try{const z=F.getViewbox();z&&isFinite(z.scale)&&isFinite(z.width)&&isFinite(z.height)&&z.width>0&&z.height>0&&F.zoom("fit-viewport")}catch(z){console.warn("Zoom error, continuing:",z)}jy(z=>[...z,k.generated_bpmn_xml]),lm(z=>z+1),L.success("Historical diagram loaded"),ki(!1)}catch(F){console.error("Failed to load historical diagram:",F),L.error("Unable to load this historical snapshot")}},[]),rm=_.useCallback((k,F)=>{const z=new Blob([k],{type:"application/xml"}),V=URL.createObjectURL(z),q=document.createElement("a");q.href=V,q.download=F.endsWith(".bpmn")?F:`${F}.bpmn`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(V)},[]),[jt,en]=_.useState(!1),[Sn,fi]=_.useState(!1),[ei,ki]=_.useState(!1),[zr,ti]=_.useState(!1),[$s,Cy]=_.useState(!1),[gh,ia]=_.useState(null),[ju,Ms]=_.useState(!1),[Va,im]=_.useState(!1),[Kl,vh]=_.useState({x:0,y:0}),sm=typeof window<"u"?Math.min(700,window.innerHeight-300):600,[sa,Yl]=_.useState({width:280,height:sm}),[ku,yh]=_.useState(""),[It,Ls]=_.useState({quickDraw:!0,startEvents:!0,activities:!0,intermediateEvents:!1,endEvents:!1,gateways:!1,subprocesses:!0,pools:!0,dataObjects:!0,artifacts:!0}),Pu=_.useRef({x:0,y:0}),hr=_.useRef({width:0,height:0,x:0,y:0,clientX:0,clientY:0,edge:"",startLeft:0,startTop:0,startRight:0,startBottom:0}),mi=_.useRef(!1),[Xl,_o]=_.useState(!1),Cn=_.useRef(null),Qi=_.useRef(null),Bs=_.useRef({top:0,left:0}),[Fs,om]=_.useState(!0),[qa,Tu]=_.useState(!1),[gi,xh]=_.useState(!1),[Wa,Ql]=_.useState(!1),[Ga,Zl]=_.useState(!0),[Ka,oa]=_.useState(!1),[bh,Nu]=_.useState(!1),[Jl,wh]=_.useState(!1),[_h,Ou]=_.useState(!1),[O,A]=_.useState(!1),[H,X]=_.useState(!1),[ae,Fe]=_.useState([]),[ut,_r]=_.useState(null),[Er,ni]=_.useState({x:0,y:0}),[Pi,aa]=_.useState(!1),[oO,aO]=_.useState(!1),[lO,pY]=_.useState(!1),[am,lm]=_.useState(1),[ec,jy]=_.useState([t]),[cm,k1]=_.useState(null);_.useEffect(()=>{t&&ec.length===1&&ec[0]!==t&&(jy([t]),lm(1))},[t]),_.useEffect(()=>{let k=!0;return(async()=>{if(t)try{const z=await wE(t);if(!k)return;ne(z);const V=localStorage.getItem(`bpmn-lock:${z}`);V==="locked"?b(!0):V==="unlocked"&&b(!1)}catch(z){console.error("Failed to compute diagram fingerprint:",z)}})(),()=>{k=!1}},[t]),_.useEffect(()=>{let k=!0;return(async()=>{try{const{data:{user:z},error:V}=await he.auth.getUser();if(!k)return;if(V)throw V;if(h(z??null),!z){f(!1);return}const{data:q,error:U}=await he.from("user_roles").select("role").eq("user_id",z.id);if(U)throw U;const Z=(q==null?void 0:q.some(we=>we.role==="admin"))??!1;f(Z)}catch(z){console.error("Failed to load user/role info:",z),k&&(h(null),f(!1))}})(),()=>{k=!1}},[]),_.useEffect(()=>{g(p||!v)},[p,v]),_.useEffect(()=>{Ie.current=m},[m]),_.useEffect(()=>{qe.current=!1,P([])},[pe]),_.useEffect(()=>{C.length?ze(k=>k&&C.some(F=>F.id===k)?k:C[0].id):ze(null)},[C]),_.useEffect(()=>{x&&Yi()},[x,Yi]),_.useEffect(()=>()=>{fe.current&&fe.current(),nt.current.length>0&&Ds({silent:!0})},[Ds]),_.useEffect(()=>{zr&&ra()},[zr,ra]),_.useEffect(()=>{zr||(xe(null),ft(!1))},[zr]),_.useEffect(()=>{ei&&na()},[na,ei]),_.useEffect(()=>{if(!Te)return;let k;const F=async()=>{const{data:q,error:U}=await he.from("vision_bpmn_jobs").select("status, bpmn_xml, error_message").eq("id",Te).single();if(U){console.error("Error checking job status:",U);return}if(q.status==="completed"&&q.bpmn_xml){if(s.current)try{await s.current.importXML(q.bpmn_xml);const we=s.current.get("canvas");try{const Ee=we.getViewbox();Ee&&isFinite(Ee.scale)&&isFinite(Ee.width)&&isFinite(Ee.height)&&Ee.width>0&&Ee.height>0&&we.zoom("fit-viewport")}catch(Ee){console.warn("Zoom error, continuing:",Ee)}L.success("BPMN diagram generated from your image!",{description:"Process extracted and visualized successfully"})}catch(we){console.error("Failed to import BPMN:",we),L.error("Failed to load generated diagram")}const Z=document.getElementById("vision-upload");Z&&(Z.value=""),en(!1),ia(null),Ms(!1),de(null),k&&clearInterval(k)}else if(q.status==="failed"){const Z=q.error_message||"Processing failed. Please try again.";L.error("Vision AI processing failed",{description:Z});const we=document.getElementById("vision-upload");we&&(we.value=""),Ms(!1),ia(null),de(null),k&&clearInterval(k)}},z=he.channel(`vision-job-${Te}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"vision_bpmn_jobs",filter:`id=eq.${Te}`},q=>{const U=q.new;if(console.log(" Vision job status update:",U.status),U.status==="completed"&&U.bpmn_xml){s.current&&s.current.importXML(U.bpmn_xml).then(()=>{const we=s.current.get("canvas");try{const Ee=we.getViewbox();Ee&&isFinite(Ee.scale)&&isFinite(Ee.width)&&isFinite(Ee.height)&&Ee.width>0&&Ee.height>0&&we.zoom("fit-viewport")}catch(Ee){console.warn("Zoom error, continuing:",Ee)}L.success("BPMN diagram generated from your image!",{description:"Process extracted and visualized successfully"})}).catch(we=>{console.error("Failed to import BPMN:",we),L.error("Failed to load generated diagram")});const Z=document.getElementById("vision-upload");Z&&(Z.value=""),en(!1),ia(null),Ms(!1),de(null),k&&clearInterval(k)}else if(U.status==="failed"){const Z=U.error_message||"Processing failed. Please try again.";L.error("Vision AI processing failed",{description:Z});const we=document.getElementById("vision-upload");we&&(we.value=""),Ms(!1),ia(null),de(null),k&&clearInterval(k)}}).subscribe();k=window.setInterval(F,3e3),F();const V=window.setTimeout(()=>{k&&clearInterval(k),L.error("Processing timed out",{description:"Please try again or contact support"});const q=document.getElementById("vision-upload");q&&(q.value=""),Ms(!1),ia(null),de(null)},3e5);return()=>{clearTimeout(V),he.removeChannel(z),k&&clearInterval(k)}},[Te,n]),_.useEffect(()=>{if(!i.current||s.current)return;s.current=new eo({container:i.current,additionalModules:[{__init__:["paletteProvider"],paletteProvider:["value",{getPaletteEntries:()=>({})}]},Cde]}),n==="pid"&&(s.current.get("eventBus").once("canvas.init",()=>{var U;try{const Z=(U=s.current)==null?void 0:U.get("pidRenderer",!1);Z&&(Z.isPidMode=!0)}catch{}}),setTimeout(()=>{var U;try{const Z=(U=s.current)==null?void 0:U.get("pidRenderer",!1);Z&&(Z.isPidMode=!0)}catch{}},50));const k=s.current.get("eventBus");k.on("commandStack.changed",()=>{var U;const q=(U=s.current)==null?void 0:U.get("commandStack");q&&(a(q.canUndo()),c(q.canRedo()))});const F=q=>{if(s.current)try{const U=s.current.get("modeling"),we=s.current.get("elementRegistry").get(q);if(we)if(typeof U.toggleCollapse=="function")U.toggleCollapse(we);else{const Ee=we.businessObject,Xt=Ee==null?void 0:Ee.di,tn=(Xt==null?void 0:Xt.isExpanded)!==!1;U.updateProperties(we,{isExpanded:!tn})}}catch(U){console.error("Error toggling subprocess expansion:",U)}},z=q=>{const U=q.target;if(!U||!s.current)return;if(U.tagName==="circle"||U.tagName==="path"||U.classList.contains("djs-collapse-marker")||U.classList.contains("djs-expand-marker")||U.closest(".djs-collapse-marker")||U.closest(".djs-expand-marker")){const we=s.current.get("elementRegistry"),Ee=s.current.get("canvas"),Xt=we.filter(tn=>tn.type==="bpmn:SubProcess");for(const tn of Xt)if(tn.id){const Rt=Ee.getGraphics(tn);if(Rt){const st=Rt.getBoundingClientRect(),Q=q.clientX,Ke=q.clientY,mt=Q>=st.left&&Q<=st.right&&Ke>=st.bottom-30&&Ke<=st.bottom+10;if(Rt.contains(U)||mt){F(tn.id),q.stopPropagation(),q.preventDefault();return}}}}},V=i.current;return V&&V.addEventListener("click",z,!0),k.on("element.click",q=>{var Xt,tn,Rt,st,Q;const{element:U,originalEvent:Z,gfx:we}=q;if(U.type==="bpmn:SubProcess"&&U.id&&s.current)try{const Ke=s.current.get("canvas");if(we){const mt=we,wn=Z.target,Tn=wn&&(wn.tagName==="circle"||wn.tagName==="path"||((Xt=wn.classList)==null?void 0:Xt.contains("djs-collapse-marker"))||((tn=wn.classList)==null?void 0:tn.contains("djs-expand-marker"))||((Rt=wn.closest)==null?void 0:Rt.call(wn,".djs-collapse-marker"))||((st=wn.closest)==null?void 0:st.call(wn,".djs-expand-marker"))),Ut=mt.getBoundingClientRect(),hs=Z.clientX,Zi=Z.clientY,Xa=hs>=Ut.left&&hs<=Ut.right&&Zi>=Ut.bottom-40&&Zi<=Ut.bottom+10&&hs>=Ut.left+Ut.width*.4&&hs<=Ut.right-Ut.width*.4;if(Tn||Xa){F(U.id),Z.stopPropagation(),Z.preventDefault();return}}}catch(Ke){console.error("Error handling subprocess click:",Ke)}if(!Ie.current){aa(!1);return}if(U.type==="bpmn:Process"||U.waypoints){aa(!1);return}const Ee=(Q=i.current)==null?void 0:Q.getBoundingClientRect();Ee&&(ni({x:Z.clientX-Ee.left,y:Z.clientY-Ee.top}),_r(U),aa(!0))}),k.on("element.dblclick",q=>{const{element:U}=q;U.type==="bpmn:SubProcess"&&U.id&&F(U.id)}),k.on("interactionEvents.create",q=>{}),k.on("marker.click",q=>{const{element:U}=q;U.type==="bpmn:SubProcess"&&U.id&&F(U.id)}),k.on("shape.click",q=>{const{element:U,originalEvent:Z}=q;if(U.type==="bpmn:SubProcess"&&U.id&&Z){const we=Z.target;we&&(we.classList.contains("djs-collapse-marker")||we.closest(".djs-collapse-marker")||we.classList.contains("djs-expand-marker")||we.closest(".djs-expand-marker"))&&(F(U.id),Z.stopPropagation(),Z.preventDefault())}}),()=>{V&&V.removeEventListener("click",z,!0),s.current&&(s.current.destroy(),s.current=null)}},[]);const fY=k=>{if(n!=="pid")return k;let F=k;F.includes('xmlns:pid="http://pid.extensions/schema"')||(F=F.replace(/(<bpmn:definitions[^>]*>)/,`$1
  xmlns:pid="http://pid.extensions/schema"`));const z=(V,q)=>{const U=(V||"").toLowerCase();let Z="",we="",Ee="";return q.includes("task")||q.includes("Task")?U.includes("tank")||U.includes("vessel")||U.includes("drum")?(Z="equipment",we="tank",Ee="mechanical"):U.includes("pump")?(Z="equipment",we="pump",Ee="mechanical"):U.includes("filter")?(Z="equipment",we="filter",Ee="mechanical"):U.includes("exchanger")||U.includes("heater")||U.includes("cooler")?(Z="equipment",we="heat_exchanger",Ee="mechanical"):(Z="equipment",we="tank",Ee="mechanical"):q.includes("exclusiveGateway")||q.includes("Gateway")?U.includes("valve")?(Z="valve",we=U.includes("control")?"valve_control":"valve_gate",Ee="mechanical"):(Z="valve",we="valve_control",Ee="mechanical"):q.includes("dataObjectReference")||q.includes("DataObject")?U.includes("analyzer")?(Z="instrument",we="analyzer",Ee="control"):U.includes("transmitter")||U.includes("transducer")?(Z="instrument",U.includes("level")?we="transmitter_level":U.includes("flow")?we="transmitter_flow":U.includes("pressure")?we="transmitter_pressure":we="transmitter_level",Ee="control"):(Z="instrument",we="transmitter_level",Ee="control"):q.includes("subProcess")||q.includes("SubProcess")?(U.includes("controller"),Z="controller",we="controller_pid",Ee="control"):q.includes("sequenceFlow")||q.includes("SequenceFlow")?(Z="line",Ee="process"):(q.includes("messageFlow")||q.includes("MessageFlow"))&&(Z="line",Ee="signal"),Z&&we&&Ee?` pid:type="${Z}" pid:symbol="${we}" pid:category="${Ee}"`:""};return F=F.replace(/(<bpmn:task[^>]*name="([^"]*)")([^>]*>)/g,(V,q,U,Z)=>{if(V.includes("pid:type"))return V;const we=z(U,"task");return q+we+Z}),F=F.replace(/(<bpmn:exclusiveGateway[^>]*name="([^"]*)")([^>]*>)/g,(V,q,U,Z)=>{if(V.includes("pid:type"))return V;const we=z(U,"exclusiveGateway");return q+we+Z}),F=F.replace(/(<bpmn:dataObjectReference[^>]*name="([^"]*)")([^>]*>)/g,(V,q,U,Z)=>{if(V.includes("pid:type"))return V;const we=z(U,"dataObjectReference");return q+we+Z}),F=F.replace(/(<bpmn:subProcess[^>]*name="([^"]*)")([^>]*>)/g,(V,q,U,Z)=>{if(V.includes("pid:type"))return V;const we=z(U,"subProcess");return q+we+Z}),F=F.replace(/(<bpmn:sequenceFlow[^>]*)([^/]*>)/g,(V,q,U)=>{if(V.includes("pid:type"))return V;const Z=z("","sequenceFlow");return q+Z+U}),F=F.replace(/(<bpmn:messageFlow[^>]*)([^/]*>)/g,(V,q,U)=>{if(V.includes("pid:type"))return V;const Z=z("","messageFlow");return q+Z+U}),F};_.useEffect(()=>{var z;if(!s.current||!t)return;if(n==="pid")try{const V=(z=s.current)==null?void 0:z.get("pidRenderer",!1);V&&(V.isPidMode=!0)}catch{}const F=fY(t);s.current.importXML(F).then(()=>{var q;const V=s.current.get("canvas");try{const U=V.getViewbox();U&&isFinite(U.scale)&&isFinite(U.width)&&isFinite(U.height)&&U.width>0&&U.height>0&&V.zoom("fit-viewport")}catch(U){console.warn("Zoom error, continuing:",U)}if(k1(null),n==="pid"){try{const tn=(q=s.current)==null?void 0:q.get("pidRenderer",!1);tn&&(tn.isPidMode=!0,setTimeout(()=>{try{const Rt=s.current.get("elementRegistry"),st=s.current.get("draw",!1);Rt.getAll().forEach(Ke=>{if(st&&st.update)try{st.update(Ke)}catch{}})}catch{}},200))}catch{}const Z=s.current.get("elementRegistry").getAll();let we=0,Ee=0;const Xt=(tn,Rt)=>{const st=(tn||"").toLowerCase();let Q="",Ke="",mt="";return Rt.includes("task")||Rt.includes("Task")?st.includes("tank")||st.includes("vessel")||st.includes("drum")?(Q="equipment",Ke="tank",mt="mechanical"):st.includes("pump")?(Q="equipment",Ke="pump",mt="mechanical"):st.includes("filter")?(Q="equipment",Ke="filter",mt="mechanical"):st.includes("exchanger")||st.includes("heater")||st.includes("cooler")?(Q="equipment",Ke="heat_exchanger",mt="mechanical"):(Q="equipment",Ke="tank",mt="mechanical"):Rt.includes("exclusiveGateway")||Rt.includes("Gateway")?(Q="valve",Ke=st.includes("control")?"valve_control":"valve_gate",mt="mechanical"):Rt.includes("dataObjectReference")||Rt.includes("DataObject")?(Q="instrument",st.includes("analyzer")?Ke="analyzer":st.includes("transmitter")||st.includes("transducer")?st.includes("level")?Ke="transmitter_level":st.includes("flow")?Ke="transmitter_flow":st.includes("pressure")?Ke="transmitter_pressure":Ke="transmitter_level":Ke="transmitter_level",mt="control"):Rt.includes("subProcess")||Rt.includes("SubProcess")?(Q="controller",Ke="controller_pid",mt="control"):Rt.includes("sequenceFlow")||Rt.includes("SequenceFlow")?(Q="line",mt="process"):(Rt.includes("messageFlow")||Rt.includes("MessageFlow"))&&(Q="line",mt="signal"),{type:Q,symbol:Ke,category:mt}};Z.forEach(tn=>{const Rt=tn.businessObject;if(!Rt)return;if(Rt.$attrs||(Rt.$attrs={}),Object.keys(Rt.$attrs).filter(Q=>Q.startsWith("pid:")).length>0)we++;else{const Q=Xt(Rt.name||"",tn.type||"");Q.type&&Q.symbol&&Q.category&&(Rt.$attrs["pid:type"]=Q.type,Rt.$attrs["pid:symbol"]=Q.symbol,Rt.$attrs["pid:category"]=Q.category,Ee++)}}),(Ee>0||we>0)&&setTimeout(()=>{try{const tn=s.current.get("canvas"),Rt=F;s.current.importXML(Rt).then(()=>{try{const st=tn.getViewbox();st&&isFinite(st.scale)&&isFinite(st.width)&&isFinite(st.height)&&st.width>0&&st.height>0&&tn.zoom("fit-viewport")}catch(st){console.warn("Zoom error, continuing:",st)}setTimeout(()=>{var mt;const st=s.current.get("elementRegistry"),Q=s.current.get("graphicsFactory"),Ke=(mt=s.current)==null?void 0:mt.get("pidRenderer",!1);Ke&&(Ke.isPidMode=!0),Q&&st&&st.getAll().forEach(wn=>{try{const Tn=st.getGraphics(wn.id);Tn&&Q.update&&Q.update(wn,Tn)}catch{}})},200)}).catch(st=>{})}catch{}},500)}}).catch(V=>{console.error("Error rendering diagram:",V);const q=V.message||"Failed to load diagram";k1(`Generation failed (Reason: ${q}). Try simplified prompt.`),n==="pid"?L.error("Generation failed (Reason: token limit). Try simplified prompt."):L.error("Failed to load BPMN diagram")})},[t,n]);const mY=async()=>{if(!m){L.error("Editing is locked by the Process Manager");return}if(s.current)try{const k=await s.current.saveXML({format:!0});if(k.xml){const F=am+1;lm(F);const z=[...ec,k.xml];if(jy(z),e&&e(k.xml),d)try{const q=pe??await wE(k.xml);await he.from("bpmn_generations").insert({user_id:d.id,input_type:"text",input_description:`manual-save:${q}`,generated_bpmn_xml:k.xml})}catch(q){console.error("Failed to log manual save:",q)}const V=n==="bpmn"?"BPMN":"P&ID";L.success("Diagram saved to workspace",{description:`Saved as version v${F}`})}}catch(k){console.error("Error saving diagram:",k),L.error("Failed to save diagram")}},P1=async k=>{if(s.current)try{if((await s.current.saveXML({format:!0})).xml){const z=`PID_v${am}.${k}`;L.success(`Exported to ${z}`,{description:"Export functionality ready"})}}catch(F){console.error("Error exporting P&ID:",F),L.error("Failed to export diagram")}},gY=k=>{if(!m){L.error("Editing is locked by the Process Manager");return}k>=0&&k<ec.length&&(lm(k+1),e&&s.current&&s.current.importXML(ec[k]).then(()=>{const F=s.current.get("canvas");try{const z=F.getViewbox();z&&isFinite(z.scale)&&isFinite(z.width)&&isFinite(z.height)&&z.width>0&&z.height>0&&F.zoom("fit-viewport")}catch(z){console.warn("Zoom error, continuing:",z)}}))},cO=()=>{if(!m){L.error("Editing is locked by the Process Manager");return}if(!s.current)return;const k=s.current.get("commandStack");k.canUndo()&&k.undo()},uO=()=>{if(!m){L.error("Editing is locked by the Process Manager");return}if(!s.current)return;const k=s.current.get("commandStack");k.canRedo()&&k.redo()},vY=()=>{if(!m){L.error("Editing is locked by the Process Manager");return}if(!s.current)return;const k=s.current.get("modeling"),F=s.current.get("elementRegistry"),V=s.current.get("canvas").getRootElement(),q=F.filter(U=>U.id!==V.id&&U.parent===V);k.removeElements(q),L.success("Canvas cleared!")},yY=_.useCallback(()=>{if(!m){L.error("Editing is locked by the Process Manager");return}const k=document.createElement("input");k.type="file",k.accept=".bpmn,.xml",k.onchange=async F=>{var V;const z=(V=F.target.files)==null?void 0:V[0];if(!(!z||!s.current))try{const q=await z.text();if(new DOMParser().parseFromString(q,"text/xml").querySelector("parsererror")){L.error("Invalid XML file");return}if(!q.includes("bpmn:")&&!q.includes("bpmn2:")&&!q.includes("bpmndi:")){L.error("File does not appear to be a valid BPMN diagram");return}await s.current.importXML(q);const Ee=s.current.get("canvas");try{const Xt=Ee.getViewbox();if(Xt){const tn=Xt.scale??1,Rt=Xt.width??0,st=Xt.height??0;isFinite(tn)&&isFinite(Rt)&&isFinite(st)&&Rt>0&&st>0&&tn>0&&Ee.zoom("fit-viewport")}}catch(Xt){console.warn("Zoom error, continuing:",Xt)}L.success("Diagram imported successfully")}catch(q){console.error("Import error:",q),L.error("Failed to import diagram")}},k.click()},[m]),Eh=_.useCallback(async(k="bpmn")=>{if(!s.current)return;const V=`${n==="bpmn"?"BPMN":"P&ID"}_v${am}.${k==="jpeg"?"jpeg":k}`;try{if(k==="bpmn"||k==="xml"){const{xml:q}=await s.current.saveXML({format:!0}),U=new Blob([q],{type:"application/xml"});tl(U,V),L.success(`Exported ${V}`)}else{const{svg:q}=await s.current.saveSVG();if(k==="svg"){const U=new Blob([q],{type:"image/svg+xml"});tl(U,V),L.success(`Exported ${V}`)}else{const we=await Lu(q,k==="png"?"image/png":"image/jpeg",k==="png"?"rgba(255,255,255,0)":"#ffffff");tl(we,V),L.success(`Exported ${V}`)}}}catch(q){console.error("Export error:",q),L.error("Failed to export diagram")}},[n,am]),Sh=_.useCallback(k=>{if(!s.current)return!1;try{const F=s.current.get("canvas");if(typeof k=="number"&&(!isFinite(k)||k<=0))return console.warn("Invalid zoom value:",k),!1;if(k==="fit-viewport"){const z=F.getViewbox();if(z){const V=z.scale??1,q=z.width??0,U=z.height??0;if(!isFinite(V)||!isFinite(q)||!isFinite(U)||q<=0||U<=0||V<=0)return console.warn("Invalid viewbox values, skipping zoom:",z),!1}}return F.zoom(k),!0}catch(F){return console.error("Error applying zoom:",F),!1}},[]),dO=_.useCallback(()=>{if(s.current)try{const F=s.current.get("canvas").getViewbox();if(F&&isFinite(F.scale)&&F.scale>0){const z=Math.min(F.scale*1.2,3);isFinite(z)&&z>0&&Sh(z)}}catch(k){console.error("Error zooming in:",k)}},[Sh]),hO=_.useCallback(()=>{if(s.current)try{const F=s.current.get("canvas").getViewbox();if(F&&isFinite(F.scale)&&F.scale>0){const z=Math.max(F.scale/1.2,.2);isFinite(z)&&z>0&&Sh(z)}}catch(k){console.error("Error zooming out:",k)}},[Sh]),T1=_.useCallback(()=>{Sh("fit-viewport")},[Sh]),xY=_.useCallback(()=>{var k;if(document.fullscreenElement)document.exitFullscreen().then(()=>{Ql(!1)}).catch(()=>{L.error("Failed to exit fullscreen mode")});else{const F=document.querySelector(".bpmn-viewer-root");F?F.requestFullscreen().then(()=>{Ql(!0),Zl(!0)}).catch(()=>{L.error("Failed to enter fullscreen mode")}):(k=i.current)==null||k.requestFullscreen().then(()=>{Ql(!0),Zl(!0)}).catch(()=>{L.error("Failed to enter fullscreen mode")})}},[]),bY=_.useCallback(()=>{if(s.current)try{const k=s.current.get("grid",!1);if(k)Tu(!qa),k.setVisible(!qa);else{Tu(!qa);const F=i.current;if(F){const z=F.querySelector(".djs-container");z&&(qa?z.style.backgroundImage="none":(z.style.backgroundImage="linear-gradient(rgba(0, 0, 0, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 0, 0, 0.1) 1px, transparent 1px)",z.style.backgroundSize="20px 20px"))}}}catch(k){console.error("Error toggling grid:",k)}},[qa]),wY=_.useCallback(()=>{xh(!gi),L.info(`Ruler ${gi?"disabled":"enabled"}`)},[gi]),pO=_.useCallback(()=>{if(!s.current)return;const k=[];try{const z=s.current.get("elementRegistry").getAll(),V=z.filter(U=>{var Z;return(Z=U.type)==null?void 0:Z.includes("StartEvent")}),q=z.filter(U=>{var Z;return(Z=U.type)==null?void 0:Z.includes("EndEvent")});V.length===0&&k.push({message:"No start event found. A BPMN diagram must have at least one start event."}),q.length===0&&k.push({message:"No end event found. A BPMN diagram should have at least one end event."}),z.forEach(U=>{var Z,we;(Z=U.type)!=null&&Z.includes("Task")&&!((we=U.businessObject)!=null&&we.name)&&k.push({message:`Task "${U.id}" has no name`,elementId:U.id})}),z.forEach(U=>{U.type&&!U.type.includes("Event")&&U.type.includes("Gateway")}),Fe(k),X(!0),k.length===0?L.success("Validation passed! No issues found."):L.warning(`Found ${k.length} validation issue(s)`)}catch(F){console.error("Validation error:",F),L.error("Failed to validate diagram")}},[]),_Y=_.useCallback(()=>{if(s.current){oa(!Ka);try{const k=s.current.get("canvas");Ka?(k.isActive("hand-tool")&&k.toggle("hand-tool"),L.info("Pan mode deactivated.")):(k.toggle("hand-tool"),L.info("Pan mode activated. Click and drag to move the canvas."))}catch(k){console.error("Error toggling pan mode:",k)}}},[Ka]),EY=_.useCallback(k=>{if(!(!s.current||!k.trim()))try{const F=s.current.get("elementRegistry"),z=s.current.get("canvas"),V=F.getAll(),q=k.toLowerCase(),U=V.filter(Z=>{var tn,Rt,st,Q;const we=((Rt=(tn=Z.businessObject)==null?void 0:tn.name)==null?void 0:Rt.toLowerCase())||"",Ee=((st=Z.id)==null?void 0:st.toLowerCase())||"",Xt=((Q=Z.type)==null?void 0:Q.toLowerCase())||"";return we.includes(q)||Ee.includes(q)||Xt.includes(q)});if(U.length>0){const Z=U[0];try{z.zoom(Z),L.success(`Found ${U.length} element(s) matching "${k}"`)}catch(we){console.warn("Zoom to element error:",we),L.success(`Found ${U.length} element(s) matching "${k}"`)}}else L.info(`No elements found matching "${k}"`)}catch(F){console.error("Search error:",F)}},[]),SY=async k=>{var z;if(!m){L.error("Editing is locked by the Process Manager"),k.target.value="";return}const F=(z=k.target.files)==null?void 0:z[0];if(!F){k.target.value="";return}if(!F.type.startsWith("image/")){L.error("Please upload an image file"),k.target.value="";return}ia(F),Ms(!0);try{const{data:{user:V},error:q}=await he.auth.getUser();if(q||!V){L.error("Please log in to use Vision Modelling AI"),Ms(!1),ia(null),k.target.value="";return}let U=F;const{shouldCompressImage:Z,compressImage:we}=await pp(async()=>{const{shouldCompressImage:Ke,compressImage:mt}=await Promise.resolve().then(()=>sC);return{shouldCompressImage:Ke,compressImage:mt}},void 0);if(Z(F))try{U=await we(F)}catch(Ke){console.warn("Image compression failed, using original:",Ke)}const{fileToBase64:Ee}=await pp(async()=>{const{fileToBase64:Ke}=await Promise.resolve().then(()=>sC);return{fileToBase64:Ke}},void 0),Xt=await Ee(U,!1),tn=`data:${U.type};base64,${Xt}`;L.info("Uploading image for analysis...");const{invokeFunction:Rt}=await pp(async()=>{const{invokeFunction:Ke}=await Promise.resolve().then(()=>c2);return{invokeFunction:Ke}},void 0),{data:st,error:Q}=await Rt("vision-to-bpmn",{imageBase64:tn,diagramType:n},{deduplicate:!0});if(Q)throw Q;if(st!=null&&st.jobId)de(st.jobId),L.info("Processing started",{description:"Your image is being analyzed. This may take a moment..."});else throw new Error("No job ID received from server")}catch(V){console.error("Vision processing error:",V);const q=V instanceof Error?V.message:"Failed to process image. Please try again.";L.error("Failed to process image",{description:q}),Ms(!1),ia(null),k.target.value=""}},CY=async k=>{var z;const F=(z=k.target.files)==null?void 0:z[0];if(F){if(!d){L.error("Please sign in to archive logs");return}Ms(!0);try{const V=await F.text(),q=await Zo(),{error:U}=await he.from("bpmn_generations").insert({user_id:d.id,input_type:"log",input_description:`log-import:${F.name}`,generated_bpmn_xml:q,alternative_models:[{event:"log_import",fileName:F.name,size:F.size,preview:V.slice(0,1e3),importedAt:new Date().toISOString()}]});if(U)throw U;L.success("Log file imported successfully"),await na(),ki(!1)}catch(V){console.error("Log import error:",V),L.error("Failed to import log file")}finally{Ms(!1),k.target.value=""}}},jY=()=>{L.success("QR code generated! Share with collaborators.")},ds=_.useCallback(k=>{if(!m){L.error("Editing is locked by the Process Manager"),aa(!1);return}if(!s.current||!ut)return;s.current.get("modeling");const F=s.current.get("bpmnReplace");try{let z=k,V;switch(k){case"start-event":z="bpmn:StartEvent";break;case"start-timer-event":z="bpmn:StartEvent",V="bpmn:TimerEventDefinition";break;case"start-message-event":z="bpmn:StartEvent",V="bpmn:MessageEventDefinition";break;case"intermediate-event":z="bpmn:IntermediateThrowEvent";break;case"intermediate-timer-event":z="bpmn:IntermediateCatchEvent",V="bpmn:TimerEventDefinition";break;case"end-event":z="bpmn:EndEvent";break;case"end-message-event":z="bpmn:EndEvent",V="bpmn:MessageEventDefinition";break;case"task":z="bpmn:Task";break;case"user-task":z="bpmn:UserTask";break;case"service-task":z="bpmn:ServiceTask";break;case"manual-task":z="bpmn:ManualTask";break;case"xor-gateway":z="bpmn:ExclusiveGateway";break;case"and-gateway":z="bpmn:ParallelGateway";break;case"or-gateway":z="bpmn:InclusiveGateway";break;default:k.startsWith("bpmn:")&&(z=k)}F.replaceElement(ut,{type:z,eventDefinitionType:V}),L.success("Element changed successfully!"),aa(!1)}catch(z){console.error("Error changing element:",z),L.error("Failed to change element type")}},[m,ut]),kY=_.useCallback((k,F)=>{if(!m){L.error("Editing is locked by the Process Manager"),aa(!1);return}if(!(!s.current||!ut))try{s.current.get("modeling").setColor([ut],{fill:k,stroke:k}),L.success(`Applied ${F} color`),aa(!1)}catch(z){console.error("Error applying color:",z),L.error("Failed to apply color")}},[m,ut]),PY=[{name:"Bottleneck",color:"#FF5252",label:"Bottleneck (Red)"},{name:"Optimization",color:"#4CAF50",label:"Optimization (Green)"},{name:"Warning",color:"#FFC107",label:"Warning (Yellow)"},{name:"Standard",color:"#2196F3",label:"Standard (Blue)"},{name:"Inactive",color:"#9E9E9E",label:"Inactive (Gray)"},{name:"Special",color:"#9C27B0",label:"Special (Purple)"},{name:"Remove",color:"none",label:"Remove Color"}],Et=_.useCallback(k=>{if(!m){L.error("Editing is locked by the Process Manager");return}if(!s.current)return;const F=s.current.get("modeling"),z=s.current.get("elementFactory"),q=s.current.get("canvas").getRootElement();let U;const Z={x:300,y:200};switch(k){case"start-event":U=z.createShape({type:"bpmn:StartEvent"});break;case"start-timer-event":U=z.createShape({type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"});break;case"start-message-event":U=z.createShape({type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"});break;case"start-signal-event":U=z.createShape({type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"});break;case"start-conditional-event":U=z.createShape({type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"});break;case"intermediate-event":U=z.createShape({type:"bpmn:IntermediateThrowEvent"});break;case"intermediate-timer-event":U=z.createShape({type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:TimerEventDefinition"});break;case"intermediate-message-event":U=z.createShape({type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:MessageEventDefinition"});break;case"intermediate-signal-event":U=z.createShape({type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:SignalEventDefinition"});break;case"end-event":U=z.createShape({type:"bpmn:EndEvent"});break;case"end-message-event":U=z.createShape({type:"bpmn:EndEvent",eventDefinitionType:"bpmn:MessageEventDefinition"});break;case"end-error-event":U=z.createShape({type:"bpmn:EndEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"});break;case"end-terminate-event":U=z.createShape({type:"bpmn:EndEvent",eventDefinitionType:"bpmn:TerminateEventDefinition"});break;case"task":U=z.createShape({type:"bpmn:Task"});break;case"user-task":U=z.createShape({type:"bpmn:UserTask"});break;case"service-task":U=z.createShape({type:"bpmn:ServiceTask"});break;case"manual-task":U=z.createShape({type:"bpmn:ManualTask"});break;case"script-task":U=z.createShape({type:"bpmn:ScriptTask"});break;case"send-task":U=z.createShape({type:"bpmn:SendTask"});break;case"receive-task":U=z.createShape({type:"bpmn:ReceiveTask"});break;case"business-rule-task":U=z.createShape({type:"bpmn:BusinessRuleTask"});break;case"call-activity":U=z.createShape({type:"bpmn:CallActivity"});break;case"xor-gateway":U=z.createShape({type:"bpmn:ExclusiveGateway"});break;case"and-gateway":U=z.createShape({type:"bpmn:ParallelGateway"});break;case"or-gateway":U=z.createShape({type:"bpmn:InclusiveGateway"});break;case"event-gateway":U=z.createShape({type:"bpmn:EventBasedGateway"});break;case"complex-gateway":U=z.createShape({type:"bpmn:ComplexGateway"});break;case"subprocess":U=z.createShape({type:"bpmn:SubProcess",isExpanded:!0});break;case"collapsed-subprocess":U=z.createShape({type:"bpmn:SubProcess",isExpanded:!1});break;case"event-subprocess":U=z.createShape({type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0});break;case"transaction":U=z.createShape({type:"bpmn:Transaction",isExpanded:!0});break;case"participant":U=z.createShape({type:"bpmn:Participant"});break;case"data-object":U=z.createShape({type:"bpmn:DataObjectReference"});break;case"data-store":U=z.createShape({type:"bpmn:DataStoreReference"});break;case"data-input":U=z.createShape({type:"bpmn:DataInput"});break;case"data-output":U=z.createShape({type:"bpmn:DataOutput"});break;case"text-annotation":U=z.createShape({type:"bpmn:TextAnnotation"});break;case"group":U=z.createShape({type:"bpmn:Group"});break;default:return}U&&(F.createShape(U,Z,q),L.success("Element added to canvas!"))},[m]);_.useEffect(()=>{const k=F=>{const z=F.target;Pi&&!z.closest(".context-menu")&&aa(!1)};return Pi&&document.addEventListener("click",k),()=>{document.removeEventListener("click",k)}},[Pi]),_.useEffect(()=>{const k=()=>{Ql(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",k),()=>document.removeEventListener("fullscreenchange",k)},[]),_.useEffect(()=>{const k=()=>{if(Cn.current){const z=Cn.current.getBoundingClientRect();Bs.current={top:z.top,left:z.left}}};k(),window.addEventListener("scroll",k,!0),window.addEventListener("resize",k);const F=Cn.current;return F&&F.addEventListener("scroll",k),()=>{window.removeEventListener("scroll",k,!0),window.removeEventListener("resize",k),F&&F.removeEventListener("scroll",k)}},[Va]),_.useEffect(()=>{if(!Va)return;const k=()=>{if(Cn.current){const z=Cn.current.offsetHeight-140;z>400&&Yl(V=>V.height>z||V.height<400?{...V,height:Math.max(400,Math.min(700,z))}:V)}};return k(),window.addEventListener("resize",k),()=>{window.removeEventListener("resize",k)}},[Va]);const tc=_.useCallback((k,F)=>{if(F.preventDefault(),F.stopPropagation(),!Qi.current||!Cn.current)return;mi.current=!0,_o(!0);const V=Cn.current.getBoundingClientRect(),q=Qi.current.getBoundingClientRect(),U=q.left-V.left,Z=q.top-V.top,we=q.right-V.left,Ee=q.bottom-V.top,Xt=q.width,tn=q.height;hr.current={width:Xt,height:tn,x:U,y:Z,clientX:F.clientX,clientY:F.clientY,edge:k,startLeft:U,startTop:Z,startRight:we,startBottom:Ee};const Rt=Q=>{if(Q.preventDefault(),!Cn.current||!Qi.current)return;const Ke=Cn.current,mt=Ke.getBoundingClientRect(),wn=Q.clientX-mt.left,Tn=Q.clientY-mt.top,Ut=200,hs=300,Zi=Ke.offsetWidth,Xa=Ke.offsetHeight;let Jn=hr.current.width,zs=hr.current.height,Ti=hr.current.startLeft,Qa=hr.current.startTop;const Ni=hr.current.edge;if(Ni==="right"||Ni==="top-right"||Ni==="bottom-right"){const Za=Math.min(Zi,wn),la=hr.current.startLeft+Ut;Jn=Math.max(la,Math.min(Zi,Za))-hr.current.startLeft,Ti=hr.current.startLeft}else if(Ni==="left"||Ni==="top-left"||Ni==="bottom-left"){const Za=Math.max(0,wn),la=hr.current.startRight-Ut,ca=Math.max(0,Math.min(la,Za));Jn=hr.current.startRight-ca,Ti=ca}if(Ni==="bottom"||Ni==="bottom-left"||Ni==="bottom-right"){const Za=Math.min(Xa,Tn),la=hr.current.startTop+hs;zs=Math.max(la,Math.min(Xa,Za))-hr.current.startTop,Qa=hr.current.startTop}else if(Ni==="top"||Ni==="top-left"||Ni==="top-right"){const Za=Math.max(0,Tn),la=hr.current.startBottom-hs,ca=Math.max(0,Math.min(la,Za));zs=hr.current.startBottom-ca,Qa=ca}Ti+Jn>Zi&&(Jn=Zi-Ti),Qa+zs>Xa&&(zs=Xa-Qa),Jn=Math.max(Ut,Jn),zs=Math.max(hs,zs),Yl({width:Jn,height:zs}),vh({x:Ti,y:Qa})},st=()=>{mi.current=!1,_o(!1),document.removeEventListener("mousemove",Rt),document.removeEventListener("mouseup",st),document.body.style.cursor="",document.body.style.userSelect=""};document.body.style.cursor=k.includes("left")&&k.includes("top")?"nwse-resize":k.includes("right")&&k.includes("top")||k.includes("left")&&k.includes("bottom")?"nesw-resize":k.includes("right")&&k.includes("bottom")?"nwse-resize":k==="left"||k==="right"?"ew-resize":"ns-resize",document.body.style.userSelect="none",document.addEventListener("mousemove",Rt),document.addEventListener("mouseup",st)},[]),Ya=n==="pid";return u.jsxs(u.Fragment,{children:[u.jsx("style",{children:`
        .shape-repository-scroll::-webkit-scrollbar {
          width: 8px;
        }
        .shape-repository-scroll::-webkit-scrollbar-track {
          background: transparent;
        }
        .shape-repository-scroll::-webkit-scrollbar-thumb {
          background-color: rgba(0, 0, 0, 0.5);
          border-radius: 4px;
        }
        .shape-repository-scroll::-webkit-scrollbar-thumb:hover {
          background-color: rgba(0, 0, 0, 0.7);
        }
      `}),u.jsxs("div",{className:"bpmn-viewer-root flex flex-col h-[calc(100vh-8rem)] bg-background",children:[u.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b bg-background",children:[u.jsx("div",{className:"flex items-center gap-3",children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(YS,{className:"h-5 w-5 text-primary"}),u.jsx("span",{className:"font-bold text-lg",children:"PROSSMIND"}),u.jsx("span",{className:"text-sm text-muted-foreground font-normal",children:"DESIGN"})]})}),u.jsx("div",{className:"flex-1 flex justify-center",children:u.jsx(f8,{children:u.jsxs(m8,{children:[u.jsx(Ab,{children:u.jsx(DC,{asChild:!0,children:u.jsx("a",{href:"/",className:"text-sm hover:text-primary",children:"Workspaces"})})}),u.jsx($C,{}),u.jsx(Ab,{children:u.jsx(DC,{className:"text-sm hover:text-primary",children:"Generated default"})}),u.jsx($C,{}),u.jsx(Ab,{children:u.jsx(g8,{className:`text-sm font-medium ${Ya?"text-engineering-green":"text-primary"}`,children:Ya?"* P&ID":"* BPMN"})})]})})}),u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsx("a",{href:"/",className:"text-sm hover:text-primary",children:"Overview"}),u.jsx("a",{href:"/",className:"text-sm hover:text-primary",children:"Models"}),u.jsx("a",{href:"/",className:"text-sm hover:text-primary font-medium",children:"Editing"}),u.jsx(G,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 rounded-full",children:u.jsx(Dg,{className:"h-4 w-4"})})]})]}),(Ga||!Wa)&&u.jsxs("div",{className:`flex items-center gap-0.5 px-1 py-1 border-b bg-muted/30 overflow-x-auto ${Ya?"border-engineering-green/20":"border-border"}`,children:[u.jsxs("div",{className:"flex items-center gap-0.5 shrink-0",children:[u.jsx(G,{variant:"ghost",size:"sm",onClick:mY,className:"h-7 w-7 p-0 shrink-0",title:"Save",disabled:!m,children:u.jsx(q4,{className:"h-3.5 w-3.5"})}),u.jsx(G,{variant:"ghost",size:"sm",onClick:yY,className:"h-7 w-7 p-0 shrink-0",title:"Upload/Import",disabled:!m,children:u.jsx(bb,{className:"h-3.5 w-3.5"})}),u.jsxs($u,{children:[u.jsx(Mu,{asChild:!0,children:u.jsx(G,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 shrink-0",title:"Download/Export",children:u.jsx(Ip,{className:"h-3.5 w-3.5"})})}),u.jsxs(mc,{align:"start",children:[u.jsxs(jn,{onClick:()=>Eh("bpmn"),children:[u.jsx(rR,{className:"h-4 w-4 mr-2"}),"Export as .bpmn"]}),u.jsxs(jn,{onClick:()=>Eh("xml"),children:[u.jsx(nr,{className:"h-4 w-4 mr-2"}),"Export as .xml"]}),u.jsxs(jn,{onClick:()=>Eh("svg"),children:[u.jsx(ts,{className:"h-4 w-4 mr-2"}),"Export as .svg"]}),u.jsxs(jn,{onClick:()=>Eh("png"),children:[u.jsx(ts,{className:"h-4 w-4 mr-2"}),"Export as .png"]}),u.jsxs(jn,{onClick:()=>Eh("jpeg"),children:[u.jsx(ts,{className:"h-4 w-4 mr-2"}),"Export as .jpeg"]}),u.jsxs(jn,{onClick:()=>Eh("jpg"),children:[u.jsx(ts,{className:"h-4 w-4 mr-2"}),"Export as .jpg"]})]})]}),u.jsx("div",{className:"h-5 w-px bg-border mx-0.5 shrink-0"}),u.jsx(G,{variant:"ghost",size:"sm",onClick:cO,className:"h-7 w-7 p-0 shrink-0",title:"Undo",disabled:!o||!m,children:u.jsx(eC,{className:"h-3.5 w-3.5"})}),u.jsx(G,{variant:"ghost",size:"sm",onClick:uO,className:"h-7 w-7 p-0 shrink-0",title:"Redo",disabled:!l||!m,children:u.jsx(JS,{className:"h-3.5 w-3.5"})}),u.jsx("div",{className:"h-5 w-px bg-border mx-0.5 shrink-0"}),u.jsxs($u,{children:[u.jsx(Mu,{asChild:!0,children:u.jsx(G,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 shrink-0",title:"Zoom Controls",children:u.jsx(wb,{className:"h-3.5 w-3.5"})})}),u.jsxs(mc,{align:"start",children:[u.jsxs(jn,{onClick:dO,children:[u.jsx(wb,{className:"h-4 w-4 mr-2"}),"Zoom In"]}),u.jsxs(jn,{onClick:hO,children:[u.jsx(tC,{className:"h-4 w-4 mr-2"}),"Zoom Out"]}),u.jsxs(jn,{onClick:T1,children:[u.jsx(xb,{className:"h-4 w-4 mr-2"}),"Fit to Screen"]})]})]}),u.jsx(G,{variant:Wa?"default":"ghost",size:"sm",onClick:xY,className:"h-7 w-7 p-0 shrink-0",title:"Fullscreen Mode",children:Wa?u.jsx(hee,{className:"h-3.5 w-3.5"}):u.jsx(cee,{className:"h-3.5 w-3.5"})}),u.jsx("div",{className:"h-5 w-px bg-border mx-0.5 shrink-0"}),u.jsx(G,{variant:qa?"default":"ghost",size:"sm",onClick:bY,className:"h-7 w-7 p-0 shrink-0",title:"Toggle Grid",children:u.jsx(nee,{className:"h-3.5 w-3.5"})}),u.jsx(G,{variant:gi?"default":"ghost",size:"sm",onClick:wY,className:"h-7 w-7 p-0 shrink-0",title:"Toggle Ruler",children:u.jsx(xee,{className:"h-3.5 w-3.5"})}),u.jsx(G,{variant:Va?"default":"ghost",size:"sm",onClick:()=>im(!Va),className:"h-7 w-7 p-0 shrink-0",title:"Toggle Elements Palette",children:u.jsx(mee,{className:"h-3.5 w-3.5"})}),u.jsx(G,{variant:"ghost",size:"sm",onClick:T1,className:"h-7 w-7 p-0 shrink-0",title:"Fit Diagram to Screen",children:u.jsx(xb,{className:"h-3.5 w-3.5"})}),u.jsx(G,{variant:"ghost",size:"sm",onClick:pO,className:"h-7 w-7 p-0 shrink-0",title:"Validate Model",children:u.jsx(By,{className:"h-3.5 w-3.5"})}),u.jsx("div",{className:"h-5 w-px bg-border mx-0.5 shrink-0"}),u.jsx(G,{variant:"ghost",size:"sm",onClick:vY,className:"h-7 w-7 p-0 shrink-0",title:"Clear canvas",disabled:!m,children:u.jsx(wv,{className:"h-3.5 w-3.5"})}),u.jsx("div",{className:"h-5 w-px bg-border mx-0.5 shrink-0"}),Wa&&u.jsxs(u.Fragment,{children:[u.jsx(G,{variant:"ghost",size:"sm",onClick:()=>Zl(!Ga),className:"h-7 w-7 p-0 shrink-0",title:Ga?"Hide Toolbar":"Show Toolbar",children:Ga?u.jsx(mm,{className:"h-3.5 w-3.5"}):u.jsx(mm,{className:"h-3.5 w-3.5 rotate-180"})}),u.jsx("div",{className:"h-5 w-px bg-border mx-0.5 shrink-0"})]}),u.jsxs($u,{children:[u.jsx(Mu,{asChild:!0,children:u.jsxs(G,{variant:"outline",size:"sm",className:"gap-1.5 h-7 px-2 shrink-0",children:[u.jsx(jee,{className:"h-3.5 w-3.5"}),u.jsx("span",{className:"text-xs",children:"Tools"})]})}),u.jsxs(mc,{align:"start",className:"w-64",children:[u.jsx(Rb,{children:Ya?"Advanced P&ID Tools":"Advanced BPMN Tools"}),u.jsx(Kh,{}),r&&u.jsxs(u.Fragment,{children:[u.jsx(jn,{onClick:()=>{if(!m){L.error("Editing is locked by the Process Manager");return}r()},children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(yd,{className:"h-4 w-4"}),u.jsxs("div",{className:"flex flex-col gap-1",children:[u.jsx("span",{className:"font-medium",children:"Refine Diagram"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"AI-powered diagram refinement"})]})]})}),u.jsx(Kh,{})]}),u.jsx(jn,{onClick:()=>ti(!0),children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(hp,{className:"h-4 w-4"}),u.jsxs("div",{className:"flex flex-col gap-1",children:[u.jsx("span",{className:"font-medium",children:"Modelling Agent Mode"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"Review 5-7 AI-generated alternatives"})]})]})}),u.jsx(jn,{onClick:()=>ki(!0),children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Y1,{className:"h-4 w-4"}),u.jsxs("div",{className:"flex flex-col gap-1",children:[u.jsx("span",{className:"font-medium",children:"Log Agent"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"Review BPMN audit history"})]})]})}),u.jsx(jn,{onClick:()=>en(!0),children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(bb,{className:"h-4 w-4"}),u.jsxs("div",{className:"flex flex-col gap-1",children:[u.jsx("span",{className:"font-medium",children:"Vision Modelling AI"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"Sketch to diagram"})]})]})}),u.jsx(Kh,{}),u.jsx(jn,{onClick:()=>fi(!0),children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(oR,{className:"h-4 w-4"}),u.jsxs("div",{className:"flex flex-col gap-1",children:[u.jsx("span",{className:"font-medium",children:"Share via QR Code"}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"Invite collaborators"})]})]})})]})]}),r&&u.jsxs(G,{variant:"outline",size:"sm",className:"gap-1.5 h-7 px-2 shrink-0",onClick:()=>{if(!m){L.error("Editing is locked by the Process Manager");return}r()},title:"Refine diagram with AI",disabled:!m,children:[u.jsx(yd,{className:"h-3.5 w-3.5"}),u.jsx("span",{className:"text-xs",children:"Refine"})]}),u.jsx(Bn,{variant:m?p?"default":"secondary":"outline",className:"ml-1 shrink-0 text-xs",children:p?"Process Manager":m?"Editor mode":"View only"})]}),u.jsx("div",{className:"flex-1 flex justify-center min-w-0 shrink",children:u.jsxs("div",{className:"flex items-center gap-1 bg-background rounded-md border border-border p-0.5",children:[u.jsxs("div",{className:"px-2 py-0.5 bg-primary text-primary-foreground rounded text-xs font-medium flex items-center gap-1.5",children:[Ya?"P&ID":"BPMN",u.jsx(G,{variant:"ghost",size:"sm",className:"h-3.5 w-3.5 p-0 hover:bg-primary-foreground/20",onClick:()=>{},children:u.jsx(xa,{className:"h-2.5 w-2.5"})})]}),u.jsx(G,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",title:"New Tab",children:u.jsx(Qh,{className:"h-3 w-3"})})]})}),u.jsx("div",{className:"flex items-center gap-1 shrink-0",children:u.jsxs("div",{className:"relative",children:[u.jsx(Ig,{className:"absolute left-1.5 top-1/2 transform -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"}),u.jsx(zn,{placeholder:"Q Quick Search...",className:"pl-7 pr-7 h-7 w-40 text-xs",onKeyDown:k=>{k.key==="Enter"&&EY(k.currentTarget.value)}}),u.jsx("kbd",{className:"absolute right-1.5 top-1/2 transform -translate-y-1/2 pointer-events-none inline-flex h-3.5 select-none items-center gap-0.5 rounded border bg-muted px-1 font-mono text-[9px] font-medium text-muted-foreground opacity-100",children:"K"})]})})]}),u.jsxs("div",{ref:Cn,className:"flex flex-1 relative",style:{position:"relative",isolation:"isolate",overflow:"auto"},children:[Va&&u.jsxs(Re.div,{ref:Qi,className:"absolute z-50 bg-white border border-border rounded-lg shadow-lg flex flex-col",style:{position:"absolute",left:0,top:0,width:`${sa.width}px`,height:`${sa.height}px`,minWidth:"240px",minHeight:"400px",maxWidth:Cn.current?`${Cn.current.offsetWidth-Kl.x}px`:"none",maxHeight:Cn.current?`${Cn.current.offsetHeight-Kl.y}px`:"none",display:"flex",flexDirection:"column",willChange:"transform"},drag:!Xl,dragMomentum:!1,dragElastic:0,dragConstraints:Cn,dragPropagation:!1,dragListener:!0,onDragStart:(k,F)=>{var q;if(mi.current||k.target.closest(".resize-handle"))return!1;const V=(q=k.originalEvent)==null?void 0:q.target;if(V!=null&&V.closest(".resize-handle"))return!1;Pu.current={...Kl}},onDrag:(k,F)=>{if(!Cn.current||!Qi.current)return;const z=Cn.current,V=Qi.current,q=V.offsetWidth,U=V.offsetHeight,Z=Math.max(0,z.offsetWidth-q),we=Math.max(0,z.offsetHeight-U),Ee=Math.max(0,Math.min(Z,Pu.current.x+F.offset.x)),Xt=Math.max(0,Math.min(we,Pu.current.y+F.offset.y));vh({x:Ee,y:Xt})},onDragEnd:(k,F)=>{if(!Cn.current||!Qi.current)return;const z=Cn.current,V=Qi.current,q=V.offsetWidth,U=V.offsetHeight,Z=Math.max(0,z.offsetWidth-q),we=Math.max(0,z.offsetHeight-U),Ee=Math.max(0,Math.min(Z,Pu.current.x+F.offset.x)),Xt=Math.max(0,Math.min(we,Pu.current.y+F.offset.y));vh({x:Ee,y:Xt})},initial:!1,animate:{x:Kl.x,y:Kl.y},children:[u.jsxs("div",{className:"p-3 border-b border-border bg-white rounded-t-lg",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx("span",{className:"font-semibold text-sm text-foreground",children:"Shape repository"}),u.jsx(G,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>im(!1),children:u.jsx(xa,{className:"h-4 w-4"})})]}),u.jsxs("div",{className:"relative",children:[u.jsx(Ig,{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"}),u.jsx(zn,{placeholder:"Enter text to filter",value:ku,onChange:k=>yh(k.target.value),className:"pl-8 pr-8 h-8 text-xs"}),u.jsx(oee,{className:"absolute right-2.5 top-1/2 transform -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"})]})]}),u.jsx("div",{className:"flex-1 bg-white overflow-y-auto shape-repository-scroll",style:{minHeight:0,scrollbarWidth:"thin",scrollbarColor:"rgba(0, 0, 0, 0.5) transparent"},children:u.jsxs("div",{className:"p-2 space-y-1",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsxs("button",{onClick:()=>Ls({...It,quickDraw:!It.quickDraw}),className:"w-full flex items-center justify-between px-2 py-1.5 text-xs font-semibold text-foreground hover:bg-accent rounded transition-colors",children:[u.jsx("span",{children:"Quick draw"}),It.quickDraw?u.jsx(jo,{className:"h-3.5 w-3.5"}):u.jsx(vs,{className:"h-3.5 w-3.5"})]}),It.quickDraw&&u.jsxs("div",{className:"grid grid-cols-3 gap-1.5 px-2 pb-2",children:[u.jsxs("div",{onClick:()=>Et("start-event"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Start event",children:[u.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-green-600"}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Start event"})]}),u.jsxs("div",{onClick:()=>Et("user-task"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"User task",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-foreground rounded flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"User task"})]}),u.jsxs("div",{onClick:()=>Et("user-task"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Case task",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-foreground rounded flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Case task"})]}),u.jsxs("div",{onClick:()=>Et("service-task"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Service task",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-foreground rounded flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Service task"})]}),u.jsxs("div",{onClick:()=>Et("collapsed-subprocess"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Subprocess",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-foreground rounded flex items-center justify-center",children:u.jsx("div",{className:"w-3 h-0.5 bg-foreground"})}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Subpro..."})]}),u.jsxs("div",{onClick:()=>Et("call-activity"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Call activity",children:[u.jsx("div",{className:"w-8 h-8 border-4 border-foreground rounded"}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Call activity"})]}),u.jsxs("div",{onClick:()=>Et("xor-gateway"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Exclusive gateway",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-amber-600 transform rotate-45 flex items-center justify-center",children:u.jsx("span",{className:"transform -rotate-45 text-xs font-bold",children:"X"})}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Exclusive gateway"})]}),u.jsxs("div",{onClick:()=>Et("intermediate-timer-event"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Timer boundary event",children:[u.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-blue-600 flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Timer boundary event"})]}),u.jsxs("div",{onClick:()=>Et("end-event"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"End event",children:[u.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-red-600"}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"End event"})]}),u.jsxs("div",{onClick:()=>Et("participant"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Pool",children:[u.jsx("div",{className:"w-10 h-8 border-2 border-foreground rounded",children:u.jsx("div",{className:"w-1 h-full bg-foreground"})}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Pool"})]}),u.jsxs("div",{onClick:()=>Et("participant"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Lane",children:[u.jsx("div",{className:"w-10 h-8 border-2 border-foreground rounded"}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Lane"})]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("button",{onClick:()=>Ls({...It,startEvents:!It.startEvents}),className:"w-full flex items-center justify-between px-2 py-1.5 text-xs font-semibold text-foreground hover:bg-accent rounded transition-colors",children:[u.jsx("span",{children:"Start events"}),It.startEvents?u.jsx(jo,{className:"h-3.5 w-3.5"}):u.jsx(vs,{className:"h-3.5 w-3.5"})]}),It.startEvents&&u.jsxs("div",{className:"grid grid-cols-3 gap-1.5 px-2 pb-2",children:[u.jsxs("div",{onClick:()=>Et("start-event"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Start event",children:[u.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-green-600"}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Start event"})]}),u.jsxs("div",{onClick:()=>Et("start-timer-event"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Timer start event",children:[u.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-green-600 flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Timer start event"})]}),u.jsxs("div",{onClick:()=>Et("start-message-event"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Message start event",children:[u.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-green-600 flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Message start event"})]}),u.jsxs("div",{onClick:()=>Et("start-signal-event"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Signal start event",children:[u.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-green-600 flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Signal start event"})]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("button",{onClick:()=>Ls({...It,activities:!It.activities}),className:"w-full flex items-center justify-between px-2 py-1.5 text-xs font-semibold text-foreground hover:bg-accent rounded transition-colors",children:[u.jsx("span",{children:"Activities"}),It.activities?u.jsx(jo,{className:"h-3.5 w-3.5"}):u.jsx(vs,{className:"h-3.5 w-3.5"})]}),It.activities&&u.jsxs("div",{className:"grid grid-cols-3 gap-1.5 px-2 pb-2",children:[u.jsxs("div",{onClick:()=>Et("user-task"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"User task",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-foreground rounded flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"User task"})]}),u.jsxs("div",{onClick:()=>Et("user-task"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Case task",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-foreground rounded flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Case task"})]}),u.jsxs("div",{onClick:()=>Et("service-task"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Service task",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-foreground rounded flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Service task"})]}),u.jsxs("div",{onClick:()=>Et("script-task"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Script task",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-foreground rounded flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Script task"})]}),u.jsxs("div",{onClick:()=>Et("business-rule-task"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Business rule task",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-foreground rounded flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Business rule task"})]}),u.jsxs("div",{onClick:()=>Et("receive-task"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Receive task",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-foreground rounded flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Receive task"})]}),u.jsxs("div",{onClick:()=>Et("manual-task"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Manual task",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-foreground rounded flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Manual task"})]}),u.jsxs("div",{onClick:()=>Et("send-task"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Email task",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-foreground rounded flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Email task"})]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("button",{onClick:()=>Ls({...It,gateways:!It.gateways}),className:"w-full flex items-center justify-between px-2 py-1.5 text-xs font-semibold text-foreground hover:bg-accent rounded transition-colors",children:[u.jsx("span",{children:"Gateways"}),It.gateways?u.jsx(jo,{className:"h-3.5 w-3.5"}):u.jsx(vs,{className:"h-3.5 w-3.5"})]}),It.gateways&&u.jsxs("div",{className:"grid grid-cols-3 gap-1.5 px-2 pb-2",children:[u.jsxs("div",{onClick:()=>Et("xor-gateway"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Exclusive gateway",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-amber-600 transform rotate-45 flex items-center justify-center",children:u.jsx("span",{className:"transform -rotate-45 text-xs font-bold",children:"X"})}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Exclusive gateway"})]}),u.jsxs("div",{onClick:()=>Et("and-gateway"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Parallel gateway",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-purple-600 transform rotate-45 flex items-center justify-center",children:u.jsx("span",{className:"transform -rotate-45 text-xs font-bold",children:"+"})}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Parallel gateway"})]}),u.jsxs("div",{onClick:()=>Et("or-gateway"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Inclusive gateway",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-indigo-600 transform rotate-45 flex items-center justify-center",children:u.jsx("span",{className:"transform -rotate-45 text-xs font-bold",children:"O"})}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Inclusive gateway"})]}),u.jsxs("div",{onClick:()=>Et("event-gateway"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Event-based gateway",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-cyan-600 transform rotate-45 flex items-center justify-center",children:u.jsx("span",{className:"transform -rotate-45 text-xs",children:""})}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Event-based gateway"})]}),u.jsxs("div",{onClick:()=>Et("complex-gateway"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Complex gateway",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-pink-600 transform rotate-45 flex items-center justify-center",children:u.jsx("span",{className:"transform -rotate-45 text-xs font-bold",children:"*"})}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Complex gateway"})]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("button",{onClick:()=>Ls({...It,intermediateEvents:!It.intermediateEvents}),className:"w-full flex items-center justify-between px-2 py-1.5 text-xs font-semibold text-foreground hover:bg-accent rounded transition-colors",children:[u.jsx("span",{children:"Intermediate events"}),It.intermediateEvents?u.jsx(jo,{className:"h-3.5 w-3.5"}):u.jsx(vs,{className:"h-3.5 w-3.5"})]}),It.intermediateEvents&&u.jsxs("div",{className:"grid grid-cols-3 gap-1.5 px-2 pb-2",children:[u.jsxs("div",{onClick:()=>Et("intermediate-event"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Intermediate event",children:[u.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-blue-600"}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Intermediate event"})]}),u.jsxs("div",{onClick:()=>Et("intermediate-timer-event"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Timer event",children:[u.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-blue-600 flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Timer event"})]}),u.jsxs("div",{onClick:()=>Et("intermediate-message-event"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Message event",children:[u.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-blue-600 flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Message event"})]}),u.jsxs("div",{onClick:()=>Et("intermediate-signal-event"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Signal event",children:[u.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-blue-600 flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Signal event"})]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("button",{onClick:()=>Ls({...It,endEvents:!It.endEvents}),className:"w-full flex items-center justify-between px-2 py-1.5 text-xs font-semibold text-foreground hover:bg-accent rounded transition-colors",children:[u.jsx("span",{children:"End events"}),It.endEvents?u.jsx(jo,{className:"h-3.5 w-3.5"}):u.jsx(vs,{className:"h-3.5 w-3.5"})]}),It.endEvents&&u.jsxs("div",{className:"grid grid-cols-3 gap-1.5 px-2 pb-2",children:[u.jsxs("div",{onClick:()=>Et("end-event"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"End event",children:[u.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-red-600"}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"End event"})]}),u.jsxs("div",{onClick:()=>Et("end-message-event"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Message end event",children:[u.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-red-600 flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Message end event"})]}),u.jsxs("div",{onClick:()=>Et("end-error-event"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Error end event",children:[u.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-red-600 flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Error end event"})]}),u.jsxs("div",{onClick:()=>Et("end-terminate-event"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Terminate end event",children:[u.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-red-600 flex items-center justify-center text-xs",children:""}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Terminate end event"})]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("button",{onClick:()=>Ls({...It,subprocesses:!It.subprocesses}),className:"w-full flex items-center justify-between px-2 py-1.5 text-xs font-semibold text-foreground hover:bg-accent rounded transition-colors",children:[u.jsx("span",{children:"Subprocesses"}),It.subprocesses?u.jsx(jo,{className:"h-3.5 w-3.5"}):u.jsx(vs,{className:"h-3.5 w-3.5"})]}),It.subprocesses&&u.jsxs("div",{className:"grid grid-cols-3 gap-1.5 px-2 pb-2",children:[u.jsxs("div",{onClick:()=>Et("subprocess"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Subprocess",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-foreground rounded flex items-center justify-center text-xs",children:"+"}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Subprocess"})]}),u.jsxs("div",{onClick:()=>Et("collapsed-subprocess"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Collapsed subprocess",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-foreground rounded flex items-center justify-center",children:u.jsx("div",{className:"w-3 h-0.5 bg-foreground"})}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Collapsed subprocess"})]}),u.jsxs("div",{onClick:()=>Et("event-subprocess"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Event subprocess",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-dashed border-foreground rounded flex items-center justify-center text-xs",children:"+"}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Event subprocess"})]}),u.jsxs("div",{onClick:()=>Et("transaction"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Transaction",children:[u.jsx("div",{className:"w-8 h-8 border-4 border-double border-foreground rounded"}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Transaction"})]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("button",{onClick:()=>Ls({...It,pools:!It.pools}),className:"w-full flex items-center justify-between px-2 py-1.5 text-xs font-semibold text-foreground hover:bg-accent rounded transition-colors",children:[u.jsx("span",{children:"Pools & Lanes"}),It.pools?u.jsx(jo,{className:"h-3.5 w-3.5"}):u.jsx(vs,{className:"h-3.5 w-3.5"})]}),It.pools&&u.jsxs("div",{className:"grid grid-cols-3 gap-1.5 px-2 pb-2",children:[u.jsxs("div",{onClick:()=>Et("participant"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Pool",children:[u.jsx("div",{className:"w-10 h-8 border-2 border-foreground rounded",children:u.jsx("div",{className:"w-1 h-full bg-foreground"})}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Pool"})]}),u.jsxs("div",{onClick:()=>Et("participant"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Lane",children:[u.jsx("div",{className:"w-10 h-8 border-2 border-foreground rounded"}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Lane"})]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("button",{onClick:()=>Ls({...It,dataObjects:!It.dataObjects}),className:"w-full flex items-center justify-between px-2 py-1.5 text-xs font-semibold text-foreground hover:bg-accent rounded transition-colors",children:[u.jsx("span",{children:"Data Objects"}),It.dataObjects?u.jsx(jo,{className:"h-3.5 w-3.5"}):u.jsx(vs,{className:"h-3.5 w-3.5"})]}),It.dataObjects&&u.jsxs("div",{className:"grid grid-cols-3 gap-1.5 px-2 pb-2",children:[u.jsxs("div",{onClick:()=>Et("data-object"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Data object",children:[u.jsx("div",{className:"w-7 h-8 border-2 border-foreground",style:{clipPath:"polygon(0 10%, 70% 10%, 100% 0, 100% 100%, 0 100%)"}}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Data object"})]}),u.jsxs("div",{onClick:()=>Et("data-store"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Data store",children:[u.jsx("div",{className:"w-8 h-7 border-2 border-foreground rounded-sm"}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Data store"})]}),u.jsxs("div",{onClick:()=>Et("data-input"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Data input",children:[u.jsx("div",{className:"w-7 h-8 border-2 border-foreground",style:{clipPath:"polygon(0 10%, 70% 10%, 100% 0, 100% 100%, 0 100%)"},children:u.jsx("div",{className:"text-[8px] mt-2 ml-1",children:""})}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Data input"})]}),u.jsxs("div",{onClick:()=>Et("data-output"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Data output",children:[u.jsx("div",{className:"w-7 h-8 border-2 border-foreground",style:{clipPath:"polygon(0 10%, 70% 10%, 100% 0, 100% 100%, 0 100%)"},children:u.jsx("div",{className:"text-[8px] mt-2 ml-1",children:""})}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Data output"})]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("button",{onClick:()=>Ls({...It,artifacts:!It.artifacts}),className:"w-full flex items-center justify-between px-2 py-1.5 text-xs font-semibold text-foreground hover:bg-accent rounded transition-colors",children:[u.jsx("span",{children:"Artifacts"}),It.artifacts?u.jsx(jo,{className:"h-3.5 w-3.5"}):u.jsx(vs,{className:"h-3.5 w-3.5"})]}),It.artifacts&&u.jsxs("div",{className:"grid grid-cols-3 gap-1.5 px-2 pb-2",children:[u.jsxs("div",{onClick:()=>Et("text-annotation"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Text annotation",children:[u.jsx("div",{className:"w-8 h-7 border-l-2 border-t-2 border-b-2 border-foreground"}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Text annotation"})]}),u.jsxs("div",{onClick:()=>Et("group"),className:"flex flex-col items-center gap-1 p-2 hover:bg-accent rounded cursor-pointer transition-colors",title:"Group",children:[u.jsx("div",{className:"w-8 h-8 border-2 border-dashed border-foreground rounded"}),u.jsx("span",{className:"text-[10px] text-center leading-tight",children:"Group"})]})]})]})]})}),u.jsxs("div",{className:"border-t border-border p-2 flex items-center justify-center gap-1 bg-white rounded-b-lg",children:[u.jsx(G,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:dO,title:"Zoom In",children:u.jsx(wb,{className:"h-3.5 w-3.5"})}),u.jsx(G,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:hO,title:"Zoom Out",children:u.jsx(tC,{className:"h-3.5 w-3.5"})}),u.jsx(G,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:T1,title:"Fit to Screen",children:u.jsx(xb,{className:"h-3.5 w-3.5"})}),u.jsx(G,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>Ou(!0),title:"Settings",children:u.jsx(t0,{className:"h-3.5 w-3.5"})})]}),u.jsx("div",{className:"resize-handle absolute left-0 top-0 bottom-0 w-4 cursor-ew-resize hover:bg-primary/70 active:bg-primary z-[60] transition-colors",onMouseDown:k=>{k.preventDefault(),k.stopPropagation(),tc("left",k)},style:{touchAction:"none",pointerEvents:"auto"},title:"Resize from left"}),u.jsx("div",{className:"resize-handle absolute right-0 top-0 bottom-0 w-4 cursor-ew-resize hover:bg-primary/70 active:bg-primary z-[60] transition-colors",onMouseDown:k=>{k.preventDefault(),k.stopPropagation(),tc("right",k)},style:{touchAction:"none",pointerEvents:"auto"},title:"Resize from right"}),u.jsx("div",{className:"resize-handle absolute top-0 left-0 right-0 h-4 cursor-ns-resize hover:bg-primary/70 active:bg-primary z-[60] transition-colors",onMouseDown:k=>{k.preventDefault(),k.stopPropagation(),tc("top",k)},style:{touchAction:"none",pointerEvents:"auto"},title:"Resize from top"}),u.jsx("div",{className:"resize-handle absolute bottom-0 left-0 right-0 h-4 cursor-ns-resize hover:bg-primary/70 active:bg-primary z-[60] transition-colors",onMouseDown:k=>{k.preventDefault(),k.stopPropagation(),tc("bottom",k)},style:{touchAction:"none",pointerEvents:"auto"},title:"Resize from bottom"}),u.jsx("div",{className:"resize-handle absolute top-0 left-0 w-8 h-8 cursor-nwse-resize hover:bg-primary/70 active:bg-primary z-[60] rounded-tl-lg transition-colors",onMouseDown:k=>{k.preventDefault(),k.stopPropagation(),tc("top-left",k)},style:{touchAction:"none",pointerEvents:"auto"},title:"Resize from top-left"}),u.jsx("div",{className:"resize-handle absolute top-0 right-0 w-8 h-8 cursor-nesw-resize hover:bg-primary/70 active:bg-primary z-[60] rounded-tr-lg transition-colors",onMouseDown:k=>{k.preventDefault(),k.stopPropagation(),tc("top-right",k)},style:{touchAction:"none",pointerEvents:"auto"},title:"Resize from top-right"}),u.jsx("div",{className:"resize-handle absolute bottom-0 left-0 w-8 h-8 cursor-nesw-resize hover:bg-primary/70 active:bg-primary z-[60] rounded-bl-lg transition-colors",onMouseDown:k=>{k.preventDefault(),k.stopPropagation(),tc("bottom-left",k)},style:{touchAction:"none",pointerEvents:"auto"},title:"Resize from bottom-left"}),u.jsx("div",{className:"resize-handle absolute bottom-0 right-0 w-8 h-8 cursor-nwse-resize hover:bg-primary/70 active:bg-primary z-[60] rounded-br-lg transition-colors",onMouseDown:k=>{k.preventDefault(),k.stopPropagation(),tc("bottom-right",k)},style:{touchAction:"none",pointerEvents:"auto"},title:"Resize from bottom-right"})]}),u.jsxs("div",{className:"flex-1 relative flex flex-col overflow-hidden",children:[Wa&&!Ga&&u.jsx("div",{className:"absolute top-4 left-4 z-40",children:u.jsx(G,{variant:"default",size:"sm",onClick:()=>Zl(!0),className:"h-8 w-8 p-0 shadow-lg",title:"Show Toolbar",children:u.jsx(mm,{className:"h-4 w-4 rotate-180"})})}),u.jsxs("div",{className:"absolute top-4 right-4 z-40 flex items-center gap-2 bg-background/95 backdrop-blur-sm border border-border rounded-lg shadow-lg p-2",children:[u.jsx(G,{variant:"ghost",size:"sm",onClick:cO,disabled:!m||!o,title:"Undo (Ctrl+Z)",className:"h-8 w-8 p-0",children:u.jsx(eC,{className:"h-4 w-4"})}),u.jsx(G,{variant:"ghost",size:"sm",onClick:uO,disabled:!m||!l,title:"Redo (Ctrl+Y)",className:"h-8 w-8 p-0",children:u.jsx(JS,{className:"h-4 w-4"})}),u.jsx("div",{className:"h-6 w-px bg-border mx-1"}),u.jsxs("span",{className:"text-xs text-muted-foreground px-2",children:["v",am,ec.length>1&&u.jsxs($u,{children:[u.jsx(Mu,{asChild:!0,children:u.jsxs("button",{className:"ml-1 text-primary hover:underline",children:[" v",ec.length]})}),u.jsx(mc,{children:ec.map((k,F)=>u.jsxs(jn,{onClick:()=>gY(F),children:["Version ",F+1]},F))})]})]})]}),cm&&u.jsx("div",{className:"w-full h-full bg-muted/50 border border-destructive/20 rounded-lg flex flex-col items-center justify-center p-8",children:u.jsxs("div",{className:"text-center space-y-4 max-w-md",children:[u.jsx("div",{className:"w-16 h-16 rounded-full bg-destructive/10 flex items-center justify-center mx-auto",children:u.jsx(xa,{className:"h-8 w-8 text-destructive"})}),u.jsx("h3",{className:"text-lg font-semibold",children:"Generation Failed"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:cm}),u.jsx(G,{onClick:()=>k1(null),variant:"outline",children:"Retry with Simplified Prompt"})]})}),u.jsx("div",{ref:i,style:{backgroundColor:"#ffffff",width:"100%",height:"100%",position:"relative"},className:`w-full h-full border rounded-lg shadow-sm ${cm?"hidden":""} ${Ya?"border-engineering-green/30":"border-border"}`}),Ya&&oO&&u.jsxs("div",{className:"absolute top-16 right-4 w-80 bg-background border border-engineering-green/20 rounded-lg shadow-lg z-40 max-h-[600px] overflow-y-auto",children:[u.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between",children:[u.jsxs("h4",{className:"font-semibold text-sm flex items-center gap-2",children:[u.jsx(iR,{className:"h-4 w-4 text-engineering-green"}),"ISA S5.1 Symbols"]}),u.jsx(G,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>aO(!1),children:u.jsx(xa,{className:"h-4 w-4"})})]}),u.jsxs("div",{className:"p-4 space-y-4",children:[u.jsxs(IC,{type:"single",collapsible:!0,children:[u.jsxs(Zh,{value:"equipment",children:[u.jsx(Jh,{className:"text-sm",children:"Equipment"}),u.jsxs(ep,{className:"text-xs space-y-2",children:[u.jsxs("div",{children:[u.jsx("strong",{children:"TK-xxx:"})," Storage Tank"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"P-xxx:"})," Pump"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"V-xxx:"})," Pressure Vessel"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"E-xxx:"})," Heat Exchanger"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"R-xxx:"})," Reactor"]})]})]}),u.jsxs(Zh,{value:"valves",children:[u.jsx(Jh,{className:"text-sm",children:"Valves"}),u.jsxs(ep,{className:"text-xs space-y-2",children:[u.jsxs("div",{children:[u.jsx("strong",{children:"FCV-xxx:"})," Flow Control Valve"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"TCV-xxx:"})," Temperature Control Valve"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"PCV-xxx:"})," Pressure Control Valve"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"PSV-xxx:"})," Pressure Safety Valve"]})]})]}),u.jsxs(Zh,{value:"instruments",children:[u.jsx(Jh,{className:"text-sm",children:"Instruments"}),u.jsxs(ep,{className:"text-xs space-y-2",children:[u.jsxs("div",{children:[u.jsx("strong",{children:"FI:"})," Flow Indicator"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"TI:"})," Temperature Indicator"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"PI:"})," Pressure Indicator"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"LI:"})," Level Indicator"]})]})]})]}),u.jsx(IC,{type:"single",collapsible:!0,children:u.jsxs(Zh,{value:"advanced",children:[u.jsx(Jh,{className:"text-sm",onClick:()=>pY(!lO),children:"Show Advanced Symbols"}),lO&&u.jsxs(ep,{className:"text-xs space-y-2",children:[u.jsxs("div",{children:[u.jsx("strong",{children:"FIC:"})," Flow Indicating Controller"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"TIC:"})," Temperature Indicating Controller"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"PIC:"})," Pressure Indicating Controller"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"LIC:"})," Level Indicating Controller"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"Line Ratings:"})," 150# = ASME B16.5 Class 150"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"Line Ratings:"})," 300# = ASME B16.5 Class 300"]})]})]})})]})]}),Ya&&!cm&&u.jsx("div",{className:"absolute bottom-8 right-8 z-30",children:u.jsxs($u,{children:[u.jsx(Mu,{asChild:!0,children:u.jsxs(G,{className:"shadow-lg hover:shadow-xl bg-engineering-green hover:bg-engineering-green/90",children:["Export ",u.jsx(rR,{className:"ml-2 h-4 w-4"})]})}),u.jsxs(mc,{align:"end",children:[u.jsx(jn,{onClick:()=>P1("svg"),children:"Export as SVG"}),u.jsx(jn,{onClick:()=>P1("pdf"),children:"Export as PDF"}),u.jsx(jn,{onClick:()=>P1("dwg"),children:"Export as DWG"})]})]})}),Ya&&!oO&&!cm&&u.jsxs(G,{variant:"outline",size:"sm",className:"absolute top-16 right-4 z-30 bg-background/95 backdrop-blur-sm border-engineering-green/20 hover:bg-engineering-green/10",onClick:()=>aO(!0),children:[u.jsx(iR,{className:"h-4 w-4 mr-2 text-engineering-green"}),"Show Legend"]})]}),Fs&&u.jsxs("div",{className:"w-12 border-l border-border bg-muted/30 flex flex-col items-center py-2 gap-2",children:[u.jsx(G,{variant:bh?"default":"ghost",size:"sm",className:"h-9 w-9 p-0",title:"Diagram Overview",onClick:()=>Nu(!bh),children:u.jsx(nr,{className:"h-4 w-4"})}),u.jsx(G,{variant:Jl?"default":"ghost",size:"sm",className:"h-9 w-9 p-0",title:"Participants / Pools & Lanes",onClick:()=>wh(!Jl),children:u.jsx(n0,{className:"h-4 w-4"})}),u.jsx(G,{variant:_h?"default":"ghost",size:"sm",className:"h-9 w-9 p-0",title:"Execution Settings",onClick:()=>Ou(!_h),children:u.jsx(t0,{className:"h-4 w-4"})}),u.jsx(G,{variant:H?"default":"ghost",size:"sm",className:"h-9 w-9 p-0",title:"Check Model / Validate",onClick:pO,children:u.jsx(ns,{className:"h-4 w-4"})}),u.jsx(G,{variant:"ghost",size:"sm",className:"h-9 w-9 p-0",title:"User / Role Panel",onClick:()=>L.info("User/Role panel - coming soon"),children:u.jsx(n0,{className:"h-4 w-4"})}),u.jsx(G,{variant:O?"default":"ghost",size:"sm",className:"h-9 w-9 p-0",title:"Element Documentation",onClick:()=>A(!O),children:u.jsx(nr,{className:"h-4 w-4"})}),u.jsx(G,{variant:Ka?"default":"ghost",size:"sm",className:"h-9 w-9 p-0",title:"Pan / Navigate Tool",onClick:_Y,children:u.jsx(ree,{className:"h-4 w-4"})}),u.jsx(G,{variant:"ghost",size:"sm",className:"h-9 w-9 p-0",title:"Search",onClick:()=>{const k=document.querySelector('input[placeholder*="Quick Search"]');k&&k.focus()},children:u.jsx(eee,{className:"h-4 w-4"})}),u.jsx("div",{className:"flex-1"}),u.jsx(G,{variant:"ghost",size:"sm",className:"h-9 w-9 p-0",onClick:()=>om(!1),title:"Collapse Sidebar",children:u.jsx(mm,{className:"h-4 w-4"})})]}),!Fs&&u.jsx("div",{className:"w-8 border-l border-border bg-muted/30 flex items-center justify-center",children:u.jsx(G,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>om(!0),title:"Expand Sidebar",children:u.jsx(mm,{className:"h-4 w-4 rotate-180"})})})]}),Pi&&ut&&u.jsxs("div",{className:"context-menu absolute bg-background border border-border rounded-lg shadow-lg z-50 p-3",style:{left:`${Er.x}px`,top:`${Er.y}px`,maxWidth:"280px"},children:[u.jsxs("div",{className:"flex items-center justify-between mb-2 pb-2 border-b",children:[u.jsx("span",{className:"text-xs font-semibold",children:"Change to:"}),u.jsx(G,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0",onClick:()=>aa(!1),children:u.jsx(xa,{className:"h-3 w-3"})})]}),u.jsxs("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:[(((fO=ut.type)==null?void 0:fO.includes("Event"))||ut.type==="bpmn:StartEvent"||ut.type==="bpmn:EndEvent")&&u.jsxs("div",{className:"space-y-1",children:[u.jsx("p",{className:"text-[10px] font-bold text-muted-foreground",children:"EVENTS"}),u.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[u.jsxs("button",{onClick:()=>ds("start-event"),className:"flex flex-col items-center gap-1 p-1.5 hover:bg-accent rounded text-xs",title:"Start Event",children:[u.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-green-600"}),u.jsx("span",{className:"text-[8px]",children:"Start"})]}),u.jsxs("button",{onClick:()=>ds("intermediate-event"),className:"flex flex-col items-center gap-1 p-1.5 hover:bg-accent rounded text-xs",title:"Intermediate",children:[u.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-blue-600"}),u.jsx("span",{className:"text-[8px]",children:"Inter."})]}),u.jsxs("button",{onClick:()=>ds("end-event"),className:"flex flex-col items-center gap-1 p-1.5 hover:bg-accent rounded text-xs",title:"End Event",children:[u.jsx("div",{className:"w-6 h-6 rounded-full border-4 border-red-600"}),u.jsx("span",{className:"text-[8px]",children:"End"})]})]})]}),((mO=ut.type)==null?void 0:mO.includes("Task"))&&u.jsxs("div",{className:"space-y-1",children:[u.jsx("p",{className:"text-[10px] font-bold text-muted-foreground",children:"TASKS"}),u.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[u.jsxs("button",{onClick:()=>ds("task"),className:"flex flex-col items-center gap-1 p-1.5 hover:bg-accent rounded",title:"Task",children:[u.jsx("div",{className:"w-6 h-6 border-2 border-foreground rounded"}),u.jsx("span",{className:"text-[8px]",children:"Task"})]}),u.jsxs("button",{onClick:()=>ds("user-task"),className:"flex flex-col items-center gap-1 p-1.5 hover:bg-accent rounded",title:"User Task",children:[u.jsx("div",{className:"w-6 h-6 border-2 border-foreground rounded flex items-center justify-center text-[10px]",children:""}),u.jsx("span",{className:"text-[8px]",children:"User"})]}),u.jsxs("button",{onClick:()=>ds("service-task"),className:"flex flex-col items-center gap-1 p-1.5 hover:bg-accent rounded",title:"Service",children:[u.jsx("div",{className:"w-6 h-6 border-2 border-foreground rounded flex items-center justify-center text-[10px]",children:""}),u.jsx("span",{className:"text-[8px]",children:"Service"})]}),u.jsxs("button",{onClick:()=>ds("manual-task"),className:"flex flex-col items-center gap-1 p-1.5 hover:bg-accent rounded",title:"Manual",children:[u.jsx("div",{className:"w-6 h-6 border-2 border-foreground rounded flex items-center justify-center text-[10px]",children:""}),u.jsx("span",{className:"text-[8px]",children:"Manual"})]})]})]}),((gO=ut.type)==null?void 0:gO.includes("Gateway"))&&u.jsxs("div",{className:"space-y-1",children:[u.jsx("p",{className:"text-[10px] font-bold text-muted-foreground",children:"GATEWAYS"}),u.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[u.jsxs("button",{onClick:()=>ds("xor-gateway"),className:"flex flex-col items-center gap-1 p-1.5 hover:bg-accent rounded",title:"XOR",children:[u.jsx("div",{className:"w-6 h-6 border-2 border-amber-600 transform rotate-45 flex items-center justify-center",children:u.jsx("span",{className:"transform -rotate-45 text-[10px] font-bold",children:"X"})}),u.jsx("span",{className:"text-[8px]",children:"XOR"})]}),u.jsxs("button",{onClick:()=>ds("and-gateway"),className:"flex flex-col items-center gap-1 p-1.5 hover:bg-accent rounded",title:"AND",children:[u.jsx("div",{className:"w-6 h-6 border-2 border-purple-600 transform rotate-45 flex items-center justify-center",children:u.jsx("span",{className:"transform -rotate-45 text-[10px] font-bold",children:"+"})}),u.jsx("span",{className:"text-[8px]",children:"AND"})]}),u.jsxs("button",{onClick:()=>ds("or-gateway"),className:"flex flex-col items-center gap-1 p-1.5 hover:bg-accent rounded",title:"OR",children:[u.jsx("div",{className:"w-6 h-6 border-2 border-indigo-600 transform rotate-45 flex items-center justify-center",children:u.jsx("span",{className:"transform -rotate-45 text-[10px] font-bold",children:"O"})}),u.jsx("span",{className:"text-[8px]",children:"OR"})]})]})]}),u.jsxs("div",{className:"pt-2 border-t space-y-1",children:[u.jsx("p",{className:"text-[10px] font-bold text-muted-foreground",children:"CAMUNDA COLORS"}),u.jsx("div",{className:"grid grid-cols-3 gap-1",children:PY.map(k=>u.jsxs("button",{onClick:()=>{var F;if(k.color==="none")try{const z=(F=s.current)==null?void 0:F.get("modeling");z&&ut&&(z.setColor([ut],{fill:void 0,stroke:void 0}),L.success("Color removed"),aa(!1))}catch(z){console.error("Error removing color:",z),L.error("Failed to remove color")}else kY(k.color,k.label)},className:"flex flex-col items-center gap-1 p-1.5 hover:bg-accent rounded transition-colors",title:k.label,children:[k.color==="none"?u.jsx("div",{className:"w-6 h-6 border-2 border-dashed border-foreground rounded flex items-center justify-center",children:u.jsx(xa,{className:"h-3 w-3"})}):u.jsx("div",{className:"w-6 h-6 rounded border-2 border-border",style:{backgroundColor:k.color}}),u.jsx("span",{className:"text-[8px] text-center leading-tight",children:k.name})]},k.name))})]}),u.jsxs("div",{className:"pt-2 border-t space-y-1",children:[u.jsx("p",{className:"text-[10px] font-bold text-muted-foreground",children:"CHANGE TO"}),u.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[u.jsxs("button",{onClick:()=>ds("task"),className:"flex flex-col items-center gap-1 p-1.5 hover:bg-accent rounded",title:"Task",children:[u.jsx("div",{className:"w-6 h-6 border-2 border-foreground rounded"}),u.jsx("span",{className:"text-[8px]",children:"Task"})]}),u.jsxs("button",{onClick:()=>ds("start-event"),className:"flex flex-col items-center gap-1 p-1.5 hover:bg-accent rounded",title:"Event",children:[u.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-green-600"}),u.jsx("span",{className:"text-[8px]",children:"Event"})]}),u.jsxs("button",{onClick:()=>ds("xor-gateway"),className:"flex flex-col items-center gap-1 p-1.5 hover:bg-accent rounded",title:"Gateway",children:[u.jsx("div",{className:"w-6 h-6 border-2 border-amber-600 transform rotate-45"}),u.jsx("span",{className:"text-[8px]",children:"Gateway"})]})]})]})]})]}),u.jsx(Ur,{open:jt,onOpenChange:en,children:u.jsxs(Ar,{children:[u.jsxs(Ir,{children:[u.jsx(Dr,{children:"Vision Modelling AI - Process from Images"}),u.jsxs($r,{children:["Upload images containing process information:",u.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Handwritten notes"})," - sketches and text"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Whiteboard diagrams"})," - flow drawings and ideas"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Process sketches"})," - rough workflow designs"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Meeting notes"})," - captured process discussions"]})]}),u.jsx("p",{className:"mt-2 text-sm",children:"AI will extract text, analyze the content, and generate a professional BPMN diagram."})]})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-8 text-center",children:[u.jsx(bb,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),u.jsxs(Vt,{htmlFor:"vision-upload",className:"cursor-pointer",children:[u.jsx("span",{className:"text-sm font-medium",children:"Click to upload image"}),u.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"PNG, JPG - handwritten or printed content"})]}),u.jsx(zn,{id:"vision-upload",type:"file",accept:"image/*",className:"hidden",onChange:SY,disabled:ju})]}),gh&&u.jsx("div",{className:"text-center text-sm",children:u.jsxs("p",{className:"text-foreground",children:["Selected: ",u.jsx("strong",{children:gh.name})]})}),ju&&u.jsx("div",{className:"text-center space-y-2",children:u.jsxs("div",{className:"text-sm text-muted-foreground",children:[u.jsx("p",{className:"font-medium",children:"Processing your image with AI..."}),u.jsx("p",{className:"text-xs mt-1",children:" Extracting text and analyzing content"}),u.jsx("p",{className:"text-xs",children:" Understanding process flow"}),u.jsx("p",{className:"text-xs",children:" Generating BPMN diagram"})]})})]})]})}),u.jsx(WP,{open:ct,onOpenChange:k=>{ft(k),k||xe(null)},children:u.jsxs(g_,{children:[u.jsxs(v_,{children:[u.jsx(x_,{children:"Apply this alternative diagram?"}),u.jsx(b_,{children:"The current canvas will be replaced with the selected alternative. You can always undo or regenerate additional options."})]}),Be?u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{className:"flex items-start justify-between gap-2",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-medium",children:Be.title}),u.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Be.description})]}),u.jsx(Bn,{variant:Be.complexity==="advanced"?"default":"secondary",children:Be.complexity.toUpperCase()})]}),u.jsx(vc,{className:"h-40 border rounded-md bg-muted/30",children:u.jsxs("pre",{className:"text-[11px] leading-4 p-3 whitespace-pre-wrap",children:[Be.xml.slice(0,1600),Be.xml.length>1600?`...

(Preview truncated)`:""]})})]}):u.jsx("p",{className:"text-sm text-muted-foreground",children:"Select an alternative to preview and apply it."}),u.jsxs(y_,{children:[u.jsx(__,{children:"Not now"}),u.jsx(w_,{disabled:!Be,onClick:async()=>{Be&&(await Cu(Be),xe(null),ft(!1))},children:"Apply diagram"})]})]})}),u.jsx(Ur,{open:Sn,onOpenChange:fi,children:u.jsxs(Ar,{children:[u.jsxs(Ir,{children:[u.jsx(Dr,{children:"Share via QR Code"}),u.jsx($r,{children:"Generate a QR code to invite collaborators with view or edit permissions"})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"border rounded-lg p-8 text-center bg-muted/30",children:[u.jsx(oR,{className:"h-32 w-32 mx-auto mb-4"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"QR Code will appear here"})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx(G,{onClick:jY,className:"flex-1",children:"Generate QR Code"}),u.jsx(G,{variant:"outline",className:"flex-1",children:"Set Permissions"})]})]})]})}),u.jsx(Ur,{open:ei,onOpenChange:k=>{ki(k)},children:u.jsxs(Ar,{className:"max-w-xl",children:[u.jsxs(Ir,{children:[u.jsx(Dr,{children:"Log Agent"}),u.jsx($r,{children:"Store and audit BPMN diagram history for compliance, recovery, and review"})]}),u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-8 text-center bg-muted/30",children:[u.jsx(Y1,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),u.jsxs(Vt,{htmlFor:"log-upload",className:"cursor-pointer flex flex-col gap-1",children:[u.jsx("span",{className:"text-sm font-medium",children:"Click to upload log file"}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"CSV, JSON, TXT, or LOG format"})]}),u.jsx(zn,{id:"log-upload",type:"file",accept:".csv,.json,.txt,.log",className:"hidden",onChange:CY,disabled:ju})]}),ju&&u.jsx("div",{className:"text-center text-sm text-muted-foreground",children:"Analyzing log file..."}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Y1,{className:"h-4 w-4 text-muted-foreground"}),u.jsx("p",{className:"text-sm font-medium",children:"Audit trail"})]}),u.jsxs(Bn,{variant:"outline",children:[Ot.length," snapshots"]})]}),u.jsx(vc,{className:"max-h-64 border rounded-md",children:u.jsx("div",{className:"divide-y",children:me?u.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"Loading audit trail..."}):Ot.length?Ot.map(k=>{const F=Array.isArray(k.alternative_models)?k.alternative_models[0]:void 0,z=F&&typeof F=="object"&&typeof F.preview=="string"?F.preview:void 0;return u.jsxs("div",{className:"p-4 flex flex-col gap-3",children:[u.jsxs("div",{className:"flex items-start justify-between gap-3",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-medium",children:k.input_description??"Manual save"}),u.jsx("p",{className:"text-xs text-muted-foreground",children:k.created_at?new Date(k.created_at).toLocaleString():"Timestamp unavailable"}),k.input_type&&u.jsx(Bn,{variant:"secondary",className:"mt-1 uppercase tracking-wide",children:k.input_type.replace(/[_-]/g," ")})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs($u,{children:[u.jsx(Mu,{asChild:!0,children:u.jsx(G,{size:"sm",variant:"outline",children:"Download as"})}),u.jsxs(mc,{align:"end",className:"w-44",children:[u.jsx(Rb,{children:"Choose format"}),u.jsx(Kh,{}),u.jsx(jn,{onClick:()=>rm(k.generated_bpmn_xml,k.input_description??"diagram-log"),children:"BPMN (.bpmn)"}),u.jsx(jn,{onClick:async()=>{try{const V=await il(k.generated_bpmn_xml),q=new Blob([V],{type:"image/svg+xml"});tl(q,`${k.input_description??"diagram-log"}.svg`)}catch{L.error("Failed to export SVG")}},children:"SVG (.svg)"}),u.jsx(jn,{onClick:async()=>{try{const V=await il(k.generated_bpmn_xml),q=await Lu(V,"image/png");tl(q,`${k.input_description??"diagram-log"}.png`)}catch{L.error("Failed to export PNG")}},children:"PNG (.png)"}),u.jsx(jn,{onClick:async()=>{try{const V=await il(k.generated_bpmn_xml),q=await Lu(V,"image/jpeg","#ffffff");tl(q,`${k.input_description??"diagram-log"}.jpg`)}catch{L.error("Failed to export JPG")}},children:"JPG (.jpg)"}),u.jsx(jn,{onClick:async()=>{try{const V=await il(k.generated_bpmn_xml),q=await Lu(V,"image/png","#ffffff"),U=URL.createObjectURL(q),Z=window.open("","_blank");Z?(Z.document.write(`<html><head><title>${k.input_description??"diagram-log"}</title></head><body style="margin:0"><img src="${U}" style="width:100%;height:auto"/></body></html>`),Z.document.close(),setTimeout(()=>{try{Z.focus(),Z.print()}catch{}},300)):L.info("Popup blocked. Enable popups to save as PDF.")}catch{L.error("Failed to prepare PDF. Use 'Print to PDF' from the opened image.")}},children:"PDF (via Print)"})]})]}),u.jsx(G,{size:"sm",onClick:()=>Xi(k),children:"Load"})]})]}),z&&u.jsx("pre",{className:"text-xs bg-muted/60 border rounded-md p-3 whitespace-pre-wrap max-h-32 overflow-auto",children:z})]},k.id)}):u.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"No historical logs archived yet."})})})]})]})]})}),u.jsx(Ur,{open:zr,onOpenChange:k=>{ti(k),k||M(null)},children:u.jsxs(Ar,{className:"max-w-[95vw] max-h-[95vh] w-[90vw] h-[90vh] overflow-hidden flex flex-col p-0",style:{maxWidth:"1400px",maxHeight:"900px",width:"90vw",height:"90vh",minWidth:"900px",minHeight:"650px"},children:[u.jsxs(Ir,{className:"px-6 pt-6 pb-4 flex-shrink-0 border-b",children:[u.jsx(Dr,{children:"Modelling Agent Mode"}),u.jsx($r,{children:"Compare 5-7 AI-generated BPMN variations, from streamlined to advanced, and apply the best fit"})]}),u.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden px-6 pb-6 space-y-6",style:{minHeight:0,scrollBehavior:"smooth"},children:[u.jsx("div",{className:"space-y-4",children:u.jsxs("div",{children:[u.jsx("label",{className:"text-sm font-medium text-foreground mb-3 block",children:"How many alternative diagrams would you like to generate?"}),u.jsx("div",{className:"flex gap-4",children:[3,5,7].map(k=>u.jsxs("label",{className:`flex items-center gap-2 cursor-pointer ${R?"opacity-50 cursor-not-allowed":""}`,children:[u.jsx("input",{type:"radio",name:"alternativeCount",value:k,checked:pt===k,onChange:()=>{R||je(k)},disabled:R,className:"w-4 h-4 text-primary focus:ring-2 focus:ring-primary focus:ring-offset-2","aria-label":`Generate ${k} alternatives`}),u.jsx("span",{className:"text-sm font-medium",children:k}),k===5&&u.jsx(Bn,{variant:"secondary",className:"text-[10px]",children:"Recommended"})]},k))}),u.jsxs("div",{className:"mt-3 space-y-1 text-xs text-muted-foreground",children:[u.jsxs("p",{children:[" ",u.jsx("strong",{children:"3 alternatives:"})," Quick comparison (fastest)"]}),u.jsxs("p",{children:[" ",u.jsx("strong",{children:"5 alternatives:"})," Comprehensive options (recommended)"]}),u.jsxs("p",{children:[" ",u.jsx("strong",{children:"7 alternatives:"})," Maximum variety (slowest)"]})]})]})}),R?u.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-8",children:[u.jsx(Vr,{className:"h-8 w-8 animate-spin text-primary"}),u.jsxs("div",{className:"space-y-4 text-center w-full max-w-md",children:[u.jsxs("p",{className:"text-sm font-medium",children:["Generating ",W.total||pt," alternative ",n==="pid"?"P&ID":"BPMN"," models in parallel..."]}),W.total>0&&u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[u.jsxs("span",{children:["Progress: ",W.completed," / ",W.total]}),u.jsxs("span",{children:[W.total?Math.round(W.completed/W.total*100):0,"%"]})]}),u.jsx("div",{className:"w-full h-2 bg-muted rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${W.total?Math.min(100,W.completed/W.total*100):0}%`}})}),u.jsx("div",{className:"space-y-1.5 text-left border rounded-lg p-3 bg-muted/30 max-h-64 overflow-y-auto",children:Cm.slice(0,W.total).map(k=>{var V;const F=se.get(k.id)||"queued",z=W.current===k.title;return u.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[F==="completed"&&u.jsx(ns,{className:"h-3.5 w-3.5 text-green-600 dark:text-green-400 flex-shrink-0"}),F==="generating"&&u.jsx(Vr,{className:"h-3.5 w-3.5 animate-spin text-primary flex-shrink-0"}),F==="failed"&&u.jsx(By,{className:"h-3.5 w-3.5 text-destructive flex-shrink-0"}),F==="queued"&&u.jsx("div",{className:"h-3.5 w-3.5 rounded-full border-2 border-muted-foreground/30 flex-shrink-0"}),u.jsxs("span",{className:`flex-1 ${z?"font-medium text-primary":""} ${F==="failed"?"text-destructive":""}`,children:[k.title,F==="failed"&&" (generation failed)",F==="completed"&&((V=C.find(q=>q.title===k.title))==null?void 0:V.previewFailed)&&" (preview unavailable)"]})]},k.id)})})]}),C.length>0&&u.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400",children:[" ",C.length," model",C.length!==1?"s":""," ready"]})]})]}):I?u.jsxs("div",{className:"border border-destructive/30 bg-destructive/10 rounded-lg p-4 space-y-3",children:[u.jsx("p",{className:"text-sm text-destructive font-medium",children:"Unable to prepare alternatives"}),u.jsx("p",{className:"text-xs text-destructive/80",children:I}),u.jsx(G,{size:"sm",variant:"outline",onClick:()=>ra(!0),children:"Retry"})]}):C.length?u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"grid gap-6 md:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[u.jsx("div",{className:"space-y-4",children:Jt?u.jsxs("div",{className:"border rounded-lg p-5 space-y-4 bg-muted/40",children:[u.jsxs("div",{className:"flex items-start justify-between gap-3",children:[u.jsxs("div",{className:"space-y-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(hp,{className:"h-4 w-4 text-primary"}),u.jsx("h4",{className:"text-base font-semibold",children:Jt.title})]}),u.jsx("p",{className:"text-xs text-muted-foreground",children:Jt.description})]}),u.jsx(Bn,{variant:Jt.complexity==="advanced"?"default":"secondary",children:Jt.complexity.toUpperCase()})]}),Jt.generatedAt&&u.jsxs("p",{className:"text-[11px] text-muted-foreground",children:["Generated ",new Date(Jt.generatedAt).toLocaleString()]}),wr&&wr.id===Jt.id&&u.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gradient-to-r from-primary/10 to-primary/5 border-2 border-primary/30 rounded-lg shadow-sm",children:[u.jsx("span",{className:"text-2xl",children:""}),u.jsxs("div",{className:"flex-1",children:[u.jsx("p",{className:"text-sm font-semibold text-primary",children:"Recommended Variant"}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Best balance of complexity, clarity, and functionality"})]})]}),Jt.metrics&&u.jsxs("div",{className:"space-y-3",children:[u.jsx("p",{className:"text-xs font-semibold text-foreground uppercase tracking-wide",children:"Key Performance Indicators"}),u.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[u.jsxs("div",{className:"flex flex-col p-3 bg-background border rounded-lg",children:[u.jsx("span",{className:"text-xs text-muted-foreground mb-1",children:"Number of Tasks"}),u.jsx("span",{className:"text-lg font-bold text-foreground",children:Jt.metrics.taskCount})]}),u.jsxs("div",{className:"flex flex-col p-3 bg-background border rounded-lg",children:[u.jsx("span",{className:"text-xs text-muted-foreground mb-1",children:"Decision Points"}),u.jsx("span",{className:"text-lg font-bold text-foreground",children:Jt.metrics.decisionPoints})]}),u.jsxs("div",{className:"flex flex-col p-3 bg-background border rounded-lg",children:[u.jsx("span",{className:"text-xs text-muted-foreground mb-1",children:"Parallel Branches"}),u.jsx("span",{className:"text-lg font-bold text-foreground",children:Jt.metrics.parallelBranches})]}),u.jsxs("div",{className:"flex flex-col p-3 bg-background border rounded-lg",children:[u.jsx("span",{className:"text-xs text-muted-foreground mb-1",children:"Error Handlers"}),u.jsx("span",{className:"text-lg font-bold text-foreground",children:Jt.metrics.errorHandlers})]}),u.jsxs("div",{className:"col-span-2 flex flex-col p-3 bg-background border rounded-lg",children:[u.jsx("span",{className:"text-xs text-muted-foreground mb-1",children:"Estimated Execution Paths"}),u.jsx("span",{className:"text-lg font-bold text-foreground",children:Jt.metrics.estimatedPaths})]})]})]}),(()=>{const k=In(Jt);return u.jsxs("div",{className:"space-y-3 border-t pt-4",children:[u.jsx("p",{className:"text-xs font-semibold text-foreground uppercase tracking-wide",children:"Variant Analysis"}),u.jsxs("div",{className:"grid md:grid-cols-3 gap-3 text-xs",children:[u.jsxs("div",{children:[u.jsxs("p",{className:"font-semibold text-green-600 dark:text-green-400 mb-2 flex items-center gap-1",children:[u.jsx("span",{children:""})," Strengths"]}),u.jsx("ul",{className:"space-y-1 text-muted-foreground",children:k.strengths.map((F,z)=>u.jsxs("li",{className:"flex items-start gap-1",children:[u.jsx("span",{className:"text-green-500 mt-0.5",children:""}),u.jsx("span",{children:F})]},z))})]}),u.jsxs("div",{children:[u.jsxs("p",{className:"font-semibold text-amber-600 dark:text-amber-400 mb-2 flex items-center gap-1",children:[u.jsx("span",{children:""})," Weaknesses"]}),u.jsx("ul",{className:"space-y-1 text-muted-foreground",children:k.weaknesses.map((F,z)=>u.jsxs("li",{className:"flex items-start gap-1",children:[u.jsx("span",{className:"text-amber-500 mt-0.5",children:""}),u.jsx("span",{children:F})]},z))})]}),u.jsxs("div",{children:[u.jsxs("p",{className:"font-semibold text-blue-600 dark:text-blue-400 mb-2 flex items-center gap-1",children:[u.jsx("span",{children:""})," Best Use Cases"]}),u.jsx("ul",{className:"space-y-1 text-muted-foreground",children:k.useCases.map((F,z)=>u.jsxs("li",{className:"flex items-start gap-1",children:[u.jsx("span",{className:"text-blue-500 mt-0.5",children:""}),u.jsx("span",{children:F})]},z))})]})]})]})})(),u.jsxs("div",{className:"space-y-2",children:[u.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase",children:"Diagram Preview"}),u.jsx("div",{className:"h-64 border rounded-md",style:{backgroundColor:"#ffffff"},"data-preview-container":!0,children:u.jsx(iD,{xml:Jt.xml,title:Jt.title,onRetry:()=>{ze(Jt.id)},onDownloadAvailable:k=>{k||P(F=>F.map(z=>z.id===Jt.id?{...z,previewFailed:!0}:z))}})})]}),u.jsx("div",{className:"flex justify-between items-center gap-2 pt-2 border-t",children:u.jsxs("div",{className:"flex gap-2",children:[u.jsxs(G,{size:"sm",variant:"outline",onClick:()=>{const k=document.querySelector("[data-preview-container]");k==null||k.scrollIntoView({behavior:"smooth",block:"center"})},className:"flex items-center gap-2",children:[u.jsx(Ia,{className:"h-4 w-4"}),"Preview"]}),u.jsxs($u,{children:[u.jsx(Mu,{asChild:!0,children:u.jsxs(G,{size:"sm",variant:"outline",className:"flex items-center gap-2",children:[u.jsx(Ip,{className:"h-4 w-4"}),"Download"]})}),u.jsxs(mc,{align:"end",className:"w-44",children:[u.jsx(Rb,{children:"Choose format"}),u.jsx(Kh,{}),u.jsx(jn,{onClick:()=>Gl(Jt),children:"BPMN (.bpmn)"}),u.jsx(jn,{onClick:async()=>{try{const k=await il(Jt.xml),F=new Blob([k],{type:"image/svg+xml"});tl(F,`${Jt.title}.svg`)}catch{L.error("Failed to export SVG")}},children:"SVG (.svg)"}),u.jsx(jn,{onClick:async()=>{try{const k=await il(Jt.xml),F=await Lu(k,"image/png");tl(F,`${Jt.title}.png`)}catch{L.error("Failed to export PNG")}},children:"PNG (.png)"}),u.jsx(jn,{onClick:async()=>{try{const k=await il(Jt.xml),F=await Lu(k,"image/jpeg","#ffffff");tl(F,`${Jt.title}.jpg`)}catch{L.error("Failed to export JPG")}},children:"JPG (.jpg)"}),u.jsx(jn,{onClick:async()=>{try{const k=await il(Jt.xml),F=await Lu(k,"image/png","#ffffff"),z=URL.createObjectURL(F),V=window.open("","_blank");V?(V.document.write(`<html><head><title>${Jt.title}</title></head><body style="margin:0"><img src="${z}" style="width:100%;height:auto"/></body></html>`),V.document.close(),setTimeout(()=>{try{V.focus(),V.print()}catch{}},300)):L.info("Popup blocked. Enable popups to save as PDF.")}catch{L.error("Failed to prepare PDF. Use 'Print to PDF' from the opened image.")}},children:"PDF (via Print)"})]})]}),u.jsxs(G,{size:"sm",onClick:()=>{Jt&&Cu(Jt)},className:"flex items-center gap-2",children:[u.jsx(ns,{className:"h-4 w-4"}),"Apply"]})]})})]}):u.jsx("div",{className:"border rounded-lg p-6 text-center text-sm text-muted-foreground bg-muted/30",children:"Select an alternative from the list to preview and apply it."})}),u.jsxs("div",{className:"border rounded-lg p-3 bg-background/70 flex flex-col",style:{minHeight:"300px",maxHeight:"calc(100vh - 250px)"},children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsxs("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:["Alternatives (",C.length,")"]}),u.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Click to preview & confirm"})]}),C.length>3&&u.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[u.jsx("div",{className:"flex-1 h-1.5 bg-muted rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-primary transition-all duration-200",style:{width:`${lt}%`}})}),u.jsxs("span",{className:"text-[10px] text-muted-foreground min-w-[35px] text-right",children:[Math.round(lt),"%"]})]}),u.jsxs(vc,{className:"flex-1 pr-2 alternatives-panel-scroll",style:{scrollbarWidth:"thin",scrollbarColor:"rgba(52, 152, 219, 0.6) rgba(255, 255, 255, 0.05)",minHeight:"300px",maxHeight:"calc(100vh - 350px)"},onScroll:k=>{const F=k.target,{scrollTop:z,scrollHeight:V,clientHeight:q}=F,U=V>q?z/(V-q)*100:0;Nt(Math.min(100,Math.max(0,U)))},children:[u.jsx("style",{children:`
                        .alternatives-panel-scroll::-webkit-scrollbar {
                          width: 10px;
                          height: 10px;
                        }
                        .alternatives-panel-scroll::-webkit-scrollbar-track {
                          background: rgba(255, 255, 255, 0.05);
                          border-radius: 10px;
                          margin: 5px 0;
                        }
                        .alternatives-panel-scroll::-webkit-scrollbar-thumb {
                          background: rgba(52, 152, 219, 0.6);
                          border-radius: 10px;
                          border: 2px solid transparent;
                          background-clip: padding-box;
                        }
                        .alternatives-panel-scroll::-webkit-scrollbar-thumb:hover {
                          background: rgba(52, 152, 219, 0.9);
                          background-clip: padding-box;
                        }
                        @media (max-width: 1200px) {
                          .alternatives-panel-scroll {
                            max-height: calc(100vh - 200px) !important;
                          }
                        }
                        @media (max-width: 768px) {
                          .alternatives-panel-scroll {
                            max-height: calc(100vh - 150px) !important;
                          }
                        }
                      `}),u.jsx("div",{ref:Ae,className:"space-y-3",style:{scrollBehavior:"smooth"},children:C.map((k,F)=>{const z=k.id===Qe;return u.jsxs("button",{type:"button",onClick:()=>ze(k.id),className:`w-full text-left border rounded-lg p-3 transition-all focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 flex-shrink-0 ${z?"border-primary bg-primary/10 shadow-lg":"border-border hover:shadow-md"}`,style:{minHeight:"280px",maxHeight:"none",display:"flex",flexDirection:"column"},children:[u.jsxs("div",{className:"flex items-start justify-between gap-2",children:[u.jsxs("div",{className:"space-y-1 flex-1 min-w-0",children:[u.jsx("p",{className:"text-sm font-medium truncate",children:k.title}),u.jsx(Bn,{variant:k.complexity==="advanced"?"default":k.complexity==="intermediate"?"secondary":"outline",className:"text-[10px] mt-1",children:k.complexity==="basic"?"BASIC":k.complexity==="intermediate"?"INTERMEDIATE":"ADVANCED"})]}),z&&u.jsx(ns,{className:"h-5 w-5 text-primary flex-shrink-0"})]}),u.jsx("div",{className:"mt-2 rounded-md border overflow-hidden",style:{backgroundColor:"#ffffff",minHeight:"128px",maxHeight:"200px",height:"auto"},children:u.jsx(iD,{xml:k.xml,title:k.title,onDownloadAvailable:V=>{V||P(q=>q.map(U=>U.id===k.id?{...U,previewFailed:!0}:U))}})}),k.metrics&&u.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-1.5 text-[10px]",children:[u.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-muted/50 rounded",children:[u.jsx("span",{className:"text-muted-foreground",children:"Tasks:"}),u.jsx("span",{className:"font-semibold",children:k.metrics.taskCount})]}),u.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-muted/50 rounded",children:[u.jsx("span",{className:"text-muted-foreground",children:"Decisions:"}),u.jsx("span",{className:"font-semibold",children:k.metrics.decisionPoints})]}),u.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-muted/50 rounded",children:[u.jsx("span",{className:"text-muted-foreground",children:"Parallel:"}),u.jsx("span",{className:"font-semibold",children:k.metrics.parallelBranches})]}),u.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-muted/50 rounded",children:[u.jsx("span",{className:"text-muted-foreground",children:"Errors:"}),u.jsx("span",{className:"font-semibold",children:k.metrics.errorHandlers})]})]}),wr&&wr.id===k.id&&u.jsxs("div",{className:"mt-2 flex items-center gap-1.5 px-2 py-1 bg-primary/10 border border-primary/20 rounded text-[10px] text-primary",children:[u.jsx("span",{children:""}),u.jsx("span",{className:"font-semibold",children:"Recommended"})]}),k.previewFailed&&u.jsxs("div",{className:"mt-1 flex items-center gap-1 text-[10px] text-yellow-600 dark:text-yellow-500",children:[u.jsx(By,{className:"h-3 w-3"}),u.jsx("span",{children:"Preview unavailable"})]})]},k.id)})})]}),C.length>3&&u.jsxs("div",{className:"flex items-center justify-between mt-2 pt-2 border-t border-border",children:[u.jsx(G,{size:"sm",variant:"ghost",className:"h-7 text-xs",onClick:()=>{var k;(k=Ae.current)==null||k.scrollTo({top:0,behavior:"smooth"})},disabled:lt===0,children:" Top"}),u.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[C.length," alternative",C.length!==1?"s":""]}),u.jsx(G,{size:"sm",variant:"ghost",className:"h-7 text-xs",onClick:()=>{Ae.current&&Ae.current.scrollTo({top:Ae.current.scrollHeight,behavior:"smooth"})},disabled:lt>=99,children:"Bottom "})]})]})]}),u.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[u.jsx("span",{className:"text-xs text-muted-foreground",children:"Compare variants side by side, then apply the one that fits your requirements."}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx(G,{size:"sm",variant:"outline",onClick:()=>{_0.clear(),P(k=>k.map(F=>({...F}))),L.info("Refreshing all previews...")},disabled:R,title:"Refresh all alternative previews",children:"Refresh All"}),u.jsx(G,{size:"sm",variant:"outline",onClick:()=>{confirm("This will replace current alternatives with a new set. Continue?")&&ra(!0)},disabled:R,title:"Generate a new set of alternative BPMN models with the same input",children:"Regenerate all variations"})]})]})]}):u.jsxs("div",{className:"border rounded-lg p-6 text-center bg-muted/40",children:[u.jsx(hp,{className:"h-16 w-16 mx-auto mb-4 text-primary"}),u.jsx("p",{className:"text-sm font-medium mb-2",children:"Preparing alternatives"}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"We will analyze the current diagram and assemble 5-7 tailored variations, from core flow to advanced designs."}),u.jsx(G,{className:"mt-4",onClick:()=>ra(!0),disabled:R,children:"Generate alternatives"})]})]})]})}),u.jsx(Ur,{open:$s,onOpenChange:k=>{Cy(k)},children:u.jsxs(Ar,{className:"max-w-xl",children:[u.jsxs(Ir,{children:[u.jsx(Dr,{children:"System Use Modelling"}),u.jsx($r,{children:"Capture visits, clicks, and on-page context to generate BPMN models from real usage"})]}),u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"border rounded-lg p-4 bg-muted/40 flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(YS,{className:"h-10 w-10 text-primary"}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-semibold",children:"Detailed Behavior Tracking"}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Log page visits, clicked elements, and page copy for downstream mining."})]})]}),u.jsx(Bn,{variant:on?"default":"outline",children:on?"Active":"Paused"})]}),u.jsx("div",{className:"flex flex-wrap gap-2",children:on?u.jsxs(u.Fragment,{children:[u.jsx(G,{variant:"destructive",className:"flex-1",onClick:()=>void ea(),children:"Stop Tracking"}),u.jsx(G,{variant:"outline",className:"flex-1",onClick:()=>void Ds(),disabled:_t.length===0,children:"Save Snapshot"})]}):u.jsx(G,{className:"flex-1",onClick:()=>{if(!d){L.error("Please sign in to enable tracking");return}te(!0),Su(),L.success("System tracking enabled  capturing visits, clicks, and page context.")},children:"Enable Tracking"})}),u.jsxs("div",{children:[u.jsxs("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:["Tracked activity (",_t.length,")"]}),u.jsx(vc,{className:"max-h-60 border rounded-md",children:u.jsx("div",{className:"divide-y",children:_t.length?_t.map(k=>u.jsxs("div",{className:"flex items-start gap-3 p-3",children:[k.type==="visit"?u.jsx(qk,{className:"h-4 w-4 mt-1 text-primary"}):u.jsx(fee,{className:"h-4 w-4 mt-1 text-primary"}),u.jsxs("div",{className:"space-y-1",children:[u.jsx("p",{className:"text-sm font-medium",children:k.type==="visit"?"Visited page":"User click"}),u.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(k.timestamp).toLocaleString()}),k.details.url&&u.jsx("p",{className:"text-xs break-all",children:k.details.url}),k.details.title&&u.jsxs("p",{className:"text-xs text-muted-foreground",children:["Title: ",k.details.title]}),k.details.text&&u.jsxs("p",{className:"text-xs text-muted-foreground",children:['"',k.details.text,'"']}),k.details.contentPreview&&u.jsxs("p",{className:"text-xs text-muted-foreground",children:["Preview: ",k.details.contentPreview]}),k.details.tag&&u.jsxs("p",{className:"text-[11px] text-muted-foreground",children:["Element: ",k.details.tag,k.details.xpath?`  ${k.details.xpath}`:""]}),k.details.referrer&&u.jsxs("p",{className:"text-[11px] text-muted-foreground",children:["Referrer: ",k.details.referrer]})]})]},k.id)):u.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"No activity captured yet. Enable tracking to begin logging interactions."})})})]})]})]})}),u.jsx(Ur,{open:x,onOpenChange:k=>{if(k&&!p){L.error("Process Manager rights required");return}y(k)},children:u.jsxs(Ar,{className:"max-w-2xl",children:[u.jsxs(Ir,{children:[u.jsx(Dr,{children:"Process Manager Console"}),u.jsx($r,{children:"Exercise full editing control, lock or unlock the canvas, and grant or revoke collaborator rights."})]}),p?u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"border rounded-lg p-4 flex items-center justify-between bg-muted/40",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-medium",children:"Editing lock"}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"When locked, collaborators can only view the diagram."})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Bn,{variant:v?"default":"outline",children:v?"Locked":"Unlocked"}),u.jsx(vl,{id:"editing-lock",checked:v,onCheckedChange:k=>fh(k)})]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(_ee,{className:"h-4 w-4 text-primary"}),u.jsx("p",{className:"text-sm font-medium",children:"Collaborators"})]}),u.jsx(Bn,{variant:"outline",children:w.length})]}),u.jsx(vc,{className:"max-h-72 border rounded-md",children:u.jsx("div",{className:"divide-y",children:S?u.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"Loading collaborators..."}):w.length?w.map(k=>{const F=k.roles.includes("admin");return u.jsxs("div",{className:"p-4 flex items-start justify-between gap-3",children:[u.jsxs("div",{className:"space-y-1",children:[u.jsxs("p",{className:"text-sm font-medium flex items-center gap-2",children:[k.email,k.userId===(d==null?void 0:d.id)&&u.jsx(Bn,{variant:"outline",children:"You"})]}),u.jsx("p",{className:"text-xs text-muted-foreground",children:F?"Process Manager":"Collaborator"}),u.jsxs("p",{className:"text-[11px] text-muted-foreground",children:["Last active:"," ",k.lastLogin?new Date(k.lastLogin).toLocaleString():"No activity recorded"]})]}),k.userId!==(d==null?void 0:d.id)&&(F?u.jsx(G,{variant:"outline",size:"sm",onClick:()=>nm(k.userId),children:"Remove access"}):u.jsx(G,{size:"sm",onClick:()=>ta(k.userId),children:"Grant access"}))]},k.userId)}):u.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"No collaborators found."})})})]})]}):u.jsxs("div",{className:"border rounded-lg p-6 text-center bg-muted/40 space-y-2",children:[u.jsx("p",{className:"text-sm font-medium",children:"View-only access"}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"You do not have Process Manager permissions. Please contact an administrator to update access rights."})]})]})}),bh&&u.jsx(Ur,{open:bh,onOpenChange:Nu,children:u.jsxs(Ar,{className:"max-w-2xl",children:[u.jsxs(Ir,{children:[u.jsx(Dr,{children:"Diagram Overview"}),u.jsx($r,{children:"Edit process properties and metadata"})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx(Vt,{children:"Process Name"}),u.jsx(zn,{placeholder:"Enter process name"})]}),u.jsxs("div",{children:[u.jsx(Vt,{children:"Process ID"}),u.jsx(zn,{placeholder:"process-id"})]}),u.jsxs("div",{children:[u.jsx(Vt,{children:"Description"}),u.jsx($i,{placeholder:"Enter process description",rows:4})]}),u.jsxs("div",{className:"flex justify-end gap-2",children:[u.jsx(G,{variant:"outline",onClick:()=>Nu(!1),children:"Cancel"}),u.jsx(G,{onClick:()=>{L.success("Properties saved"),Nu(!1)},children:"Save"})]})]})]})}),Jl&&u.jsx(Ur,{open:Jl,onOpenChange:wh,children:u.jsxs(Ar,{className:"max-w-2xl",children:[u.jsxs(Ir,{children:[u.jsx(Dr,{children:"Participants / Pools & Lanes"}),u.jsx($r,{children:"Manage collaboration elements"})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsx("div",{className:"text-sm text-muted-foreground",children:"Manage pools, lanes, and participant assignments for your BPMN diagram."}),u.jsx(G,{onClick:()=>L.info("Add participant functionality - coming soon"),children:"Add Participant"}),u.jsx("div",{className:"flex justify-end gap-2",children:u.jsx(G,{variant:"outline",onClick:()=>wh(!1),children:"Close"})})]})]})}),_h&&u.jsx(Ur,{open:_h,onOpenChange:Ou,children:u.jsxs(Ar,{className:"max-w-2xl",children:[u.jsxs(Ir,{children:[u.jsx(Dr,{children:"Execution Settings"}),u.jsx($r,{children:"Configure process engine options and metadata"})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx(Vt,{children:"Process Version"}),u.jsx(zn,{type:"number",defaultValue:"1"})]}),u.jsxs("div",{children:[u.jsx(Vt,{children:"Process Namespace"}),u.jsx(zn,{placeholder:"http://example.org/bpmn"})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(vl,{id:"executable"}),u.jsx(Vt,{htmlFor:"executable",children:"Executable Process"})]}),u.jsxs("div",{className:"flex justify-end gap-2",children:[u.jsx(G,{variant:"outline",onClick:()=>Ou(!1),children:"Cancel"}),u.jsx(G,{onClick:()=>{L.success("Settings saved"),Ou(!1)},children:"Save"})]})]})]})}),O&&u.jsx(Ur,{open:O,onOpenChange:A,children:u.jsxs(Ar,{className:"max-w-2xl",children:[u.jsxs(Ir,{children:[u.jsx(Dr,{children:"Element Documentation"}),u.jsx($r,{children:"Add documentation for the selected element"})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsxs(Vt,{children:["Element: ",(ut==null?void 0:ut.id)||"None selected"]}),u.jsx($i,{placeholder:"Enter element documentation",rows:6})]}),u.jsxs("div",{className:"flex justify-end gap-2",children:[u.jsx(G,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),u.jsx(G,{onClick:()=>{L.success("Documentation saved"),A(!1)},children:"Save"})]})]})]})}),H&&u.jsx(Ur,{open:H,onOpenChange:X,children:u.jsxs(Ar,{className:"max-w-2xl",children:[u.jsxs(Ir,{children:[u.jsx(Dr,{children:"Validation Results"}),u.jsx($r,{children:"BPMN structural validation issues"})]}),u.jsxs("div",{className:"space-y-4",children:[ae.length===0?u.jsxs("div",{className:"text-center py-8 text-green-600",children:[u.jsx(ns,{className:"h-12 w-12 mx-auto mb-2"}),u.jsx("p",{className:"font-semibold",children:"No validation issues found!"})]}):u.jsx(vc,{className:"h-[400px]",children:u.jsx("div",{className:"space-y-2",children:ae.map((k,F)=>u.jsx("div",{className:"p-3 border border-destructive/20 rounded-lg bg-destructive/5",children:u.jsxs("div",{className:"flex items-start gap-2",children:[u.jsx(By,{className:"h-4 w-4 text-destructive mt-0.5"}),u.jsxs("div",{className:"flex-1",children:[u.jsx("p",{className:"text-sm font-medium",children:k.message}),k.elementId&&u.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Element ID: ",k.elementId]})]})]})},F))})}),u.jsx("div",{className:"flex justify-end gap-2",children:u.jsx(G,{variant:"outline",onClick:()=>X(!1),children:"Close"})})]})]})})]})]})};var E0="__fn",q8=1e3,She=Array.prototype.slice;function Wi(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}Wi.prototype.on=function(t,e,n,r){if(t=ke(t)?t:[t],Bt(e)&&(r=n,n=e,e=q8),!Oe(e))throw new Error("priority must be a number");var i=n;r&&(i=li(n,r),i[E0]=n[E0]||n);var s=this;t.forEach(function(o){s._addListener(o,{priority:e,callback:i,next:null})})};Wi.prototype.once=function(t,e,n,r){var i=this;if(Bt(e)&&(r=n,n=e,e=q8),!Oe(e))throw new Error("priority must be a number");function s(){s.__isTomb=!0;var o=n.apply(r,arguments);return i.off(t,s),o}s[E0]=n,this.on(t,e,s)};Wi.prototype.off=function(t,e){t=ke(t)?t:[t];var n=this;t.forEach(function(r){n._removeListener(r,e)})};Wi.prototype.createEvent=function(t){var e=new Kv;return e.init(t),e};Wi.prototype.fire=function(t,e){var n,r,i,s;if(s=She.call(arguments),typeof t=="object"&&(e=t,t=e.type),!t)throw new Error("no event type specified");if(r=this._listeners[t],!!r){e instanceof Kv?n=e:n=this.createEvent(e),s[0]=n;var o=n.type;t!==o&&(n.type=t);try{i=this._invokeListeners(n,s,r)}finally{t!==o&&(n.type=o)}return i===void 0&&n.defaultPrevented&&(i=!1),i}};Wi.prototype.handleError=function(t){return this.fire("error",{error:t})===!1};Wi.prototype._destroy=function(){this._listeners={}};Wi.prototype._invokeListeners=function(t,e,n){for(var r;n&&!t.cancelBubble;)r=this._invokeListener(t,e,n),n=n.next;return r};Wi.prototype._invokeListener=function(t,e,n){var r;if(n.callback.__isTomb)return r;try{r=Che(n.callback,e),r!==void 0&&(t.returnValue=r,t.stopPropagation()),r===!1&&t.preventDefault()}catch(i){if(!this.handleError(i))throw console.error("unhandled error in event listener",i),i}return r};Wi.prototype._addListener=function(t,e){var n=this._getListeners(t),r;if(!n){this._setListeners(t,e);return}for(;n;){if(n.priority<e.priority){e.next=n,r?r.next=e:this._setListeners(t,e);return}r=n,n=n.next}r.next=e};Wi.prototype._getListeners=function(t){return this._listeners[t]};Wi.prototype._setListeners=function(t,e){this._listeners[t]=e};Wi.prototype._removeListener=function(t,e){var n=this._getListeners(t),r,i,s;if(!e){this._setListeners(t,null);return}for(;n;)r=n.next,s=n.callback,(s===e||s[E0]===e)&&(i?i.next=r:this._setListeners(t,r)),i=n,n=r};function Kv(){}Kv.prototype.stopPropagation=function(){this.cancelBubble=!0};Kv.prototype.preventDefault=function(){this.defaultPrevented=!0};Kv.prototype.init=function(t){B(this,t||{})};function Che(t,e){return t.apply(null,e)}var E_=Object.prototype.toString,jhe=Object.prototype.hasOwnProperty;function khe(t){return t===void 0}function W8(t){return E_.call(t)==="[object Array]"}function Phe(t){return E_.call(t)==="[object Object]"}function The(t){var e=E_.call(t);return e==="[object Function]"||e==="[object AsyncFunction]"||e==="[object GeneratorFunction]"||e==="[object AsyncGeneratorFunction]"||e==="[object Proxy]"}function Qd(t){return E_.call(t)==="[object String]"}function G8(t,e){return jhe.call(t,e)}function sD(t,e){e=K8(e);var n;return Rn(t,function(r,i){if(e(r,i))return n=r,!1}),n}function Nhe(t,e){e=K8(e);var n=W8(t)?-1:void 0;return Rn(t,function(r,i){if(e(r,i))return n=i,!1}),n}function KP(t,e){var n=[];return Rn(t,function(r,i){e(r,i)&&n.push(r)}),n}function Rn(t,e){var n,r;if(!khe(t)){var i=W8(t)?Rhe:Ohe;for(var s in t)if(G8(t,s)&&(n=t[s],r=e(n,i(s)),r===!1))return n}}function K8(t){return The(t)?t:function(e){return e===t}}function Ohe(t){return t}function Rhe(t){return Number(t)}function Kp(t,e){return t.bind(e)}function MC(){return MC=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},MC.apply(this,arguments)}function kr(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return MC.apply(void 0,[t].concat(n))}function Ahe(t,e){var n={},r=Object(t);return Rn(e,function(i){i in r&&(n[i]=t[i])}),n}function YP(){}YP.prototype.get=function(t){return this.$model.properties.get(this,t)};YP.prototype.set=function(t,e){this.$model.properties.set(this,t,e)};function Y8(t,e){this.model=t,this.properties=e}Y8.prototype.createType=function(t){var e=this.model,n=this.properties,r=Object.create(YP.prototype);Rn(t.properties,function(o){!o.isMany&&o.default!==void 0&&(r[o.name]=o.default)}),n.defineModel(r,e),n.defineDescriptor(r,t);var i=t.ns.name;function s(o){n.define(this,"$type",{value:i,enumerable:!0}),n.define(this,"$attrs",{value:{}}),n.define(this,"$parent",{writable:!0}),Rn(o,Kp(function(a,l){this.set(l,a)},this))}return s.prototype=r,s.hasType=r.$instanceOf=this.model.hasType,n.defineModel(s,e),n.defineDescriptor(s,t),s};var Ihe={String:!0,Boolean:!0,Integer:!0,Real:!0,Element:!0},X8={String:function(t){return t},Boolean:function(t){return t==="true"},Integer:function(t){return parseInt(t,10)},Real:function(t){return parseFloat(t)}};function XP(t,e){var n=X8[t];return n?n(e):e}function LC(t){return!!Ihe[t]}function Q8(t){return!!X8[t]}function zi(t,e){var n=t.split(/:/),r,i;if(n.length===1)r=t,i=e;else if(n.length===2)r=n[1],i=n[0];else throw new Error("expected <prefix:localName> or <localName>, got "+t);return t=(i?i+":":"")+r,{name:t,prefix:i,localName:r}}function go(t){this.ns=t,this.name=t.name,this.allTypes=[],this.allTypesByName={},this.properties=[],this.propertiesByName={}}go.prototype.build=function(){return Ahe(this,["ns","name","allTypes","allTypesByName","properties","propertiesByName","bodyProperty","idProperty"])};go.prototype.addProperty=function(t,e,n){typeof e=="boolean"&&(n=e,e=void 0),this.addNamedProperty(t,n!==!1);var r=this.properties;e!==void 0?r.splice(e,0,t):r.push(t)};go.prototype.replaceProperty=function(t,e,n){var r=t.ns,i=this.properties,s=this.propertiesByName,o=t.name!==e.name;if(t.isId){if(!e.isId)throw new Error("property <"+e.ns.name+"> must be id property to refine <"+t.ns.name+">");this.setIdProperty(e,!1)}if(t.isBody){if(!e.isBody)throw new Error("property <"+e.ns.name+"> must be body property to refine <"+t.ns.name+">");this.setBodyProperty(e,!1)}var a=i.indexOf(t);if(a===-1)throw new Error("property <"+r.name+"> not found in property list");i.splice(a,1),this.addProperty(e,n?void 0:a,o),s[r.name]=s[r.localName]=e};go.prototype.redefineProperty=function(t,e,n){var r=t.ns.prefix,i=e.split("#"),s=zi(i[0],r),o=zi(i[1],s.prefix).name,a=this.propertiesByName[o];if(a)this.replaceProperty(a,t,n);else throw new Error("refined property <"+o+"> not found");delete t.redefines};go.prototype.addNamedProperty=function(t,e){var n=t.ns,r=this.propertiesByName;e&&(this.assertNotDefined(t,n.name),this.assertNotDefined(t,n.localName)),r[n.name]=r[n.localName]=t};go.prototype.removeNamedProperty=function(t){var e=t.ns,n=this.propertiesByName;delete n[e.name],delete n[e.localName]};go.prototype.setBodyProperty=function(t,e){if(e&&this.bodyProperty)throw new Error("body property defined multiple times (<"+this.bodyProperty.ns.name+">, <"+t.ns.name+">)");this.bodyProperty=t};go.prototype.setIdProperty=function(t,e){if(e&&this.idProperty)throw new Error("id property defined multiple times (<"+this.idProperty.ns.name+">, <"+t.ns.name+">)");this.idProperty=t};go.prototype.assertNotDefined=function(t,e){var n=t.name,r=this.propertiesByName[n];if(r)throw new Error("property <"+n+"> already defined; override of <"+r.definedBy.ns.name+"#"+r.ns.name+"> by <"+t.definedBy.ns.name+"#"+t.ns.name+"> not allowed without redefines")};go.prototype.hasProperty=function(t){return this.propertiesByName[t]};go.prototype.addTrait=function(t,e){var n=this.allTypesByName,r=this.allTypes,i=t.name;i in n||(Rn(t.properties,Kp(function(s){s=kr({},s,{name:s.ns.localName,inherited:e}),Object.defineProperty(s,"definedBy",{value:t});var o=s.replaces,a=s.redefines;o||a?this.redefineProperty(s,o||a,o):(s.isBody&&this.setBodyProperty(s),s.isId&&this.setIdProperty(s),this.addProperty(s))},this)),r.push(t),n[i]=t)};function lu(t,e){this.packageMap={},this.typeMap={},this.packages=[],this.properties=e,Rn(t,Kp(this.registerPackage,this))}lu.prototype.getPackage=function(t){return this.packageMap[t]};lu.prototype.getPackages=function(){return this.packages};lu.prototype.registerPackage=function(t){t=kr({},t);var e=this.packageMap;oD(e,t,"prefix"),oD(e,t,"uri"),Rn(t.types,Kp(function(n){this.registerType(n,t)},this)),e[t.uri]=e[t.prefix]=t,this.packages.push(t)};lu.prototype.registerType=function(t,e){t=kr({},t,{superClass:(t.superClass||[]).slice(),extends:(t.extends||[]).slice(),properties:(t.properties||[]).slice(),meta:kr(t.meta||{})});var n=zi(t.name,e.prefix),r=n.name,i={};Rn(t.properties,Kp(function(s){var o=zi(s.name,n.prefix),a=o.name;LC(s.type)||(s.type=zi(s.type,o.prefix).name),kr(s,{ns:o,name:a}),i[a]=s},this)),kr(t,{ns:n,name:r,propertiesByName:i}),Rn(t.extends,Kp(function(s){var o=this.typeMap[s];o.traits=o.traits||[],o.traits.push(r)},this)),this.definePackage(t,e),this.typeMap[r]=t};lu.prototype.mapTypes=function(t,e,n){var r=LC(t.name)?{name:t.name}:this.typeMap[t.name],i=this;function s(a){return o(a,!0)}function o(a,l){var c=zi(a,LC(a)?"":t.prefix);i.mapTypes(c,e,l)}if(!r)throw new Error("unknown type <"+t.name+">");Rn(r.superClass,n?s:o),e(r,!n),Rn(r.traits,s)};lu.prototype.getEffectiveDescriptor=function(t){var e=zi(t),n=new go(e);this.mapTypes(e,function(i,s){n.addTrait(i,s)});var r=n.build();return this.definePackage(r,r.allTypes[r.allTypes.length-1].$pkg),r};lu.prototype.definePackage=function(t,e){this.properties.define(t,"$pkg",{value:e})};function oD(t,e,n){var r=e[n];if(r in t)throw new Error("package with "+n+" <"+r+"> already defined")}function If(t){this.model=t}If.prototype.set=function(t,e,n){if(!Qd(e)||!e.length)throw new TypeError("property name must be a non-empty string");var r=this.model.getPropertyDescriptor(t,e),i=r&&r.name;Dhe(n)?r?delete t[i]:delete t.$attrs[e]:r?i in t?t[i]=n:Z8(t,r,n):t.$attrs[e]=n};If.prototype.get=function(t,e){var n=this.model.getPropertyDescriptor(t,e);if(!n)return t.$attrs[e];var r=n.name;return!t[r]&&n.isMany&&Z8(t,n,[]),t[r]};If.prototype.define=function(t,e,n){if(!n.writable){var r=n.value;n=kr({},n,{get:function(){return r}}),delete n.value}Object.defineProperty(t,e,n)};If.prototype.defineDescriptor=function(t,e){this.define(t,"$descriptor",{value:e})};If.prototype.defineModel=function(t,e){this.define(t,"$model",{value:e})};function Dhe(t){return typeof t>"u"}function Z8(t,e,n){Object.defineProperty(t,e.name,{enumerable:!e.isReference,writable:!0,value:n,configurable:!0})}function vo(t){this.properties=new If(this),this.factory=new Y8(this,this.properties),this.registry=new lu(t,this.properties),this.typeCache={}}vo.prototype.create=function(t,e){var n=this.getType(t);if(!n)throw new Error("unknown type <"+t+">");return new n(e)};vo.prototype.getType=function(t){var e=this.typeCache,n=Qd(t)?t:t.ns.name,r=e[n];return r||(t=this.registry.getEffectiveDescriptor(n),r=e[n]=this.factory.createType(t)),r};vo.prototype.createAny=function(t,e,n){var r=zi(t),i={$type:t,$instanceOf:function(o){return o===this.$type}},s={name:t,isGeneric:!0,ns:{prefix:r.prefix,localName:r.localName,uri:e}};return this.properties.defineDescriptor(i,s),this.properties.defineModel(i,this),this.properties.define(i,"$parent",{enumerable:!1,writable:!0}),this.properties.define(i,"$instanceOf",{enumerable:!1,writable:!0}),Rn(n,function(o,a){Phe(o)&&o.value!==void 0?i[o.name]=o.value:i[a]=o}),i};vo.prototype.getPackage=function(t){return this.registry.getPackage(t)};vo.prototype.getPackages=function(){return this.registry.getPackages()};vo.prototype.getElementDescriptor=function(t){return t.$descriptor};vo.prototype.hasType=function(t,e){e===void 0&&(e=t,t=this);var n=t.$model.getElementDescriptor(t);return e in n.allTypesByName};vo.prototype.getPropertyDescriptor=function(t,e){return this.getElementDescriptor(t).propertiesByName[e]};vo.prototype.getTypeDescriptor=function(t){return this.registry.typeMap[t]};var aD=String.fromCharCode,$he=Object.prototype.hasOwnProperty,Mhe=/&#(\d+);|&#x([0-9a-f]+);|&(\w+);/ig,hg={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'};Object.keys(hg).forEach(function(t){hg[t.toUpperCase()]=hg[t]});function Lhe(t,e,n,r){return r?$he.call(hg,r)?hg[r]:"&"+r+";":aD(e||parseInt(n,16))}function Bu(t){return t.length>3&&t.indexOf("&")!==-1?t.replace(Mhe,Lhe):t}var Bhe="http://www.w3.org/2001/XMLSchema-instance",Fhe="xsi",lD="xsi:type",cD="non-whitespace outside of root node";function Mh(t){return new Error(t)}function uD(t){return"missing namespace for prefix <"+t+">"}function lx(t){return{get:t,enumerable:!0}}function zhe(t){var e={},n;for(n in t)e[n]=t[n];return e}function BC(t){return t+"$uri"}function Hhe(t){var e={},n,r;for(n in t)r=t[n],e[r]=r,e[BC(r)]=n;return e}function dD(){return{line:0,column:0}}function Uhe(t){throw t}function J8(t){if(!this)return new J8(t);var e=t&&t.proxy,n,r,i,s,o=Uhe,a,l,c,d,h=dD,p=!1,f=!1,m=null,g=!1,v;function b(w){w instanceof Error||(w=Mh(w)),m=w,o(w,h)}function x(w){a&&(w instanceof Error||(w=Mh(w)),a(w,h))}this.on=function(w,E){if(typeof E!="function")throw Mh("required args <name, cb>");switch(w){case"openTag":r=E;break;case"text":n=E;break;case"closeTag":i=E;break;case"error":o=E;break;case"warn":a=E;break;case"cdata":s=E;break;case"attention":d=E;break;case"question":c=E;break;case"comment":l=E;break;default:throw Mh("unsupported event: "+w)}return this},this.ns=function(w){if(typeof w>"u"&&(w={}),typeof w!="object")throw Mh("required args <nsMap={}>");var E={},S;for(S in w)E[S]=w[S];return E[Bhe]=Fhe,f=!0,v=E,this},this.parse=function(w){if(typeof w!="string")throw Mh("required args <xml=string>");return m=null,y(w),h=dD,g=!1,m},this.stop=function(){g=!0};function y(w){var E=f?[]:null,S=f?Hhe(v):null,j,C=[],P=0,R=!1,N=!1,I=0,M=0,W,ce,se,ve,pt,je,lt,Nt,Ae,Qe="",ze=0,Ot;function Zt(){if(Ot!==null)return Ot;var oe,pe,ne,Te=f&&S.xmlns,de=f&&p?[]:null,Ie=ze,qe=Qe,_t=qe.length,Ht,on,te,Be,xe,ct={},ft={},nt,fe,Ye;e:for(;Ie<_t;Ie++)if(nt=!1,fe=qe.charCodeAt(Ie),!(fe===32||fe<14&&fe>8)){for((fe<65||fe>122||fe>90&&fe<97)&&fe!==95&&fe!==58&&(x("illegal first char attribute name"),nt=!0),Ye=Ie+1;Ye<_t;Ye++)if(fe=qe.charCodeAt(Ye),!(fe>96&&fe<123||fe>64&&fe<91||fe>47&&fe<59||fe===46||fe===45||fe===95)){if(fe===32||fe<14&&fe>8){x("missing attribute value"),Ie=Ye;continue e}if(fe===61)break;x("illegal attribute name char"),nt=!0}if(xe=qe.substring(Ie,Ye),xe==="xmlns:xmlns"&&(x("illegal declaration of xmlns"),nt=!0),fe=qe.charCodeAt(Ye+1),fe===34)Ye=qe.indexOf('"',Ie=Ye+2),Ye===-1&&(Ye=qe.indexOf("'",Ie),Ye!==-1&&(x("attribute value quote missmatch"),nt=!0));else if(fe===39)Ye=qe.indexOf("'",Ie=Ye+2),Ye===-1&&(Ye=qe.indexOf('"',Ie),Ye!==-1&&(x("attribute value quote missmatch"),nt=!0));else for(x("missing attribute value quotes"),nt=!0,Ye=Ye+1;Ye<_t&&(fe=qe.charCodeAt(Ye+1),!(fe===32||fe<14&&fe>8));Ye++);for(Ye===-1&&(x("missing closing quotes"),Ye=_t,nt=!0),nt||(te=qe.substring(Ie,Ye)),Ie=Ye;Ye+1<_t&&(fe=qe.charCodeAt(Ye+1),!(fe===32||fe<14&&fe>8));Ye++)Ie===Ye&&(x("illegal character after attribute end"),nt=!0);if(Ie=Ye+1,nt)continue e;if(xe in ft){x("attribute <"+xe+"> already defined");continue}if(ft[xe]=!0,!f){ct[xe]=te;continue}if(p){if(on=xe==="xmlns"?"xmlns":xe.charCodeAt(0)===120&&xe.substr(0,6)==="xmlns:"?xe.substr(6):null,on!==null){if(oe=Bu(te),pe=BC(on),Be=v[oe],!Be){if(on==="xmlns"||pe in S&&S[pe]!==oe)do Be="ns"+P++;while(typeof S[Be]<"u");else Be=on;v[oe]=Be}S[on]!==Be&&(Ht||(S=zhe(S),Ht=!0),S[on]=Be,on==="xmlns"&&(S[BC(Be)]=oe,Te=Be),S[pe]=oe),ct[xe]=te;continue}de.push(xe,te);continue}if(fe=xe.indexOf(":"),fe===-1){ct[xe]=te;continue}if(!(ne=S[xe.substring(0,fe)])){x(uD(xe.substring(0,fe)));continue}xe=Te===ne?xe.substr(fe+1):ne+xe.substr(fe),xe===lD&&(fe=te.indexOf(":"),fe!==-1?(ne=te.substring(0,fe),ne=S[ne]||ne,te=ne+te.substring(fe)):te=Te+":"+te),ct[xe]=te}if(p)for(Ie=0,_t=de.length;Ie<_t;Ie++){if(xe=de[Ie++],te=de[Ie],fe=xe.indexOf(":"),fe!==-1){if(!(ne=S[xe.substring(0,fe)])){x(uD(xe.substring(0,fe)));continue}xe=Te===ne?xe.substr(fe+1):ne+xe.substr(fe),xe===lD&&(fe=te.indexOf(":"),fe!==-1?(ne=te.substring(0,fe),ne=S[ne]||ne,te=ne+te.substring(fe)):te=Te+":"+te)}ct[xe]=te}return Ot=ct}function me(){for(var oe=/(\r\n|\r|\n)/g,pe=0,ne=0,Te=0,de=M,Ie,qe;I>=Te&&(Ie=oe.exec(w),!(!Ie||(de=Ie[0].length+Ie.index,de>I)));)pe+=1,Te=de;return I==-1?(ne=de,qe=w.substring(M)):M===0?qe=w.substring(M,I):(ne=I-Te,qe=M==-1?w.substring(I):w.substring(I,M+1)),{data:qe,line:pe,column:ne}}for(h=me,e&&(Ae=Object.create({},{name:lx(function(){return lt}),originalName:lx(function(){return Nt}),attrs:lx(Zt),ns:lx(function(){return S})}));M!==-1;){if(w.charCodeAt(M)===60?I=M:I=w.indexOf("<",M),I===-1){if(C.length)return b("unexpected end of file");if(M===0)return b("missing start tag");M<w.length&&w.substring(M).trim()&&x(cD);return}if(M!==I){if(C.length){if(n&&(n(w.substring(M,I),Bu,h),g))return}else if(w.substring(M,I).trim()&&(x(cD),g))return}if(ve=w.charCodeAt(I+1),ve===33){if(se=w.charCodeAt(I+2),se===91&&w.substr(I+3,6)==="CDATA["){if(M=w.indexOf("]]>",I),M===-1)return b("unclosed cdata");if(s&&(s(w.substring(I+9,M),h),g))return;M+=3;continue}if(se===45&&w.charCodeAt(I+3)===45){if(M=w.indexOf("-->",I),M===-1)return b("unclosed comment");if(l&&(l(w.substring(I+4,M),Bu,h),g))return;M+=3;continue}}if(ve===63){if(M=w.indexOf("?>",I),M===-1)return b("unclosed question");if(c&&(c(w.substring(I,M+2),h),g))return;M+=2;continue}for(W=I+1;;W++){if(pt=w.charCodeAt(W),isNaN(pt))return M=-1,b("unclosed tag");if(pt===34)se=w.indexOf('"',W+1),W=se!==-1?se:W;else if(pt===39)se=w.indexOf("'",W+1),W=se!==-1?se:W;else if(pt===62){M=W;break}}if(ve===33){if(d&&(d(w.substring(I,M+1),Bu,h),g))return;M+=1;continue}if(Ot={},ve===47){if(R=!1,N=!0,!C.length)return b("missing open tag");if(W=lt=C.pop(),se=I+2+W.length,w.substring(I+2,se)!==W)return b("closing tag mismatch");for(;se<M;se++)if(ve=w.charCodeAt(se),!(ve===32||ve>8&&ve<14))return b("close tag")}else{if(w.charCodeAt(M-1)===47?(W=lt=w.substring(I+1,M-1),R=!0,N=!0):(W=lt=w.substring(I+1,M),R=!0,N=!1),!(ve>96&&ve<123||ve>64&&ve<91||ve===95||ve===58))return b("illegal first char nodeName");for(se=1,ce=W.length;se<ce;se++)if(ve=W.charCodeAt(se),!(ve>96&&ve<123||ve>64&&ve<91||ve>47&&ve<59||ve===45||ve===95||ve==46)){if(ve===32||ve<14&&ve>8){lt=W.substring(0,se),Ot=null;break}return b("invalid nodeName")}N||C.push(lt)}if(f){if(j=S,R&&(N||E.push(j),Ot===null&&(p=W.indexOf("xmlns",se)!==-1)&&(ze=se,Qe=W,Zt(),p=!1)),Nt=lt,ve=lt.indexOf(":"),ve!==-1){if(je=S[lt.substring(0,ve)],!je)return b("missing namespace on <"+Nt+">");lt=lt.substr(ve+1)}else je=S.xmlns;je&&(lt=je+":"+lt)}if(R&&(ze=se,Qe=W,r&&(e?r(Ae,Bu,N,h):r(lt,Zt,Bu,N,h),g)))return;if(N){if(i&&(i(e?Ae:lt,Bu,R,h),g))return;f&&(R?S=j:S=E.pop())}M+=1}}}function eH(t){return t.xml&&t.xml.tagAlias==="lowerCase"}var Vhe={xsi:"http://www.w3.org/2001/XMLSchema-instance",xml:"http://www.w3.org/XML/1998/namespace"},S_="xsi:type";function tH(t){return t.xml&&t.xml.serialize}function nH(t){return tH(t)===S_}function qhe(t){return tH(t)==="property"}function Whe(t){return t.charAt(0).toUpperCase()+t.slice(1)}function rH(t,e){return eH(e)?t.prefix+":"+Whe(t.localName):t.name}function Ghe(t,e){var n=t.name,r=t.localName,i=e.xml&&e.xml.typePrefix;return i&&r.indexOf(i)===0?t.prefix+":"+r.slice(i.length):n}function Khe(t,e){var n=zi(t),r=e.getPackage(n.prefix);return Ghe(n,r)}function Fc(t){return new Error(t)}function yl(t){return t.$descriptor}function Yhe(t){kr(this,t),this.elementsById={},this.references=[],this.warnings=[],this.addReference=function(e){this.references.push(e)},this.addElement=function(e){if(!e)throw Fc("expected element");var n=this.elementsById,r=yl(e),i=r.idProperty,s;if(i&&(s=e.get(i.name),s)){if(!/^([a-z][\w-.]*:)?[a-z_][\w-.]*$/i.test(s))throw new Error("illegal ID <"+s+">");if(n[s])throw Fc("duplicate ID <"+s+">");n[s]=e}},this.addWarning=function(e){this.warnings.push(e)}}function Yv(){}Yv.prototype.handleEnd=function(){};Yv.prototype.handleText=function(){};Yv.prototype.handleNode=function(){};function QP(){}QP.prototype=Object.create(Yv.prototype);QP.prototype.handleNode=function(){return this};function Df(){}Df.prototype=Object.create(Yv.prototype);Df.prototype.handleText=function(t){this.body=(this.body||"")+t};function Xv(t,e){this.property=t,this.context=e}Xv.prototype=Object.create(Df.prototype);Xv.prototype.handleNode=function(t){if(this.element)throw Fc("expected no sub nodes");return this.element=this.createReference(t),this};Xv.prototype.handleEnd=function(){this.element.id=this.body};Xv.prototype.createReference=function(t){return{property:this.property.ns.name,id:""}};function ZP(t,e){this.element=e,this.propertyDesc=t}ZP.prototype=Object.create(Df.prototype);ZP.prototype.handleEnd=function(){var t=this.body||"",e=this.element,n=this.propertyDesc;t=XP(n.type,t),n.isMany?e.get(n.name).push(t):e.set(n.name,t)};function C_(){}C_.prototype=Object.create(Df.prototype);C_.prototype.handleNode=function(t){var e=this,n=this.element;return n?e=this.handleChild(t):(n=this.element=this.createElement(t),this.context.addElement(n)),e};function Si(t,e,n){this.model=t,this.type=t.getType(e),this.context=n}Si.prototype=Object.create(C_.prototype);Si.prototype.addReference=function(t){this.context.addReference(t)};Si.prototype.handleText=function(t){var e=this.element,n=yl(e),r=n.bodyProperty;if(!r)throw Fc("unexpected body text <"+t+">");Df.prototype.handleText.call(this,t)};Si.prototype.handleEnd=function(){var t=this.body,e=this.element,n=yl(e),r=n.bodyProperty;r&&t!==void 0&&(t=XP(r.type,t),e.set(r.name,t))};Si.prototype.createElement=function(t){var e=t.attributes,n=this.type,r=yl(n),i=this.context,s=new n({}),o=this.model,a;return Rn(e,function(l,c){var d=r.propertiesByName[c],h;d&&d.isReference?d.isMany?(h=l.split(" "),Rn(h,function(p){i.addReference({element:s,property:d.ns.name,id:p})})):i.addReference({element:s,property:d.ns.name,id:l}):(d?l=XP(d.type,l):c!=="xmlns"&&(a=zi(c,r.ns.prefix),o.getPackage(a.prefix)&&i.addWarning({message:"unknown attribute <"+c+">",element:s,property:c,value:l})),s.set(c,l))}),s};Si.prototype.getPropertyForNode=function(t){var e=t.name,n=zi(e),r=this.type,i=this.model,s=yl(r),o=n.name,a=s.propertiesByName[o],l,c;if(a&&!a.isAttr)return nH(a)&&(l=t.attributes[S_],l)?(l=Khe(l,i),c=i.getType(l),kr({},a,{effectiveType:yl(c).name})):a;var d=i.getPackage(n.prefix);if(d){if(l=rH(n,d),c=i.getType(l),a=sD(s.properties,function(h){return!h.isVirtual&&!h.isReference&&!h.isAttribute&&c.hasType(h.type)}),a)return kr({},a,{effectiveType:yl(c).name})}else if(a=sD(s.properties,function(h){return!h.isReference&&!h.isAttribute&&h.type==="Element"}),a)return a;throw Fc("unrecognized element <"+n.name+">")};Si.prototype.toString=function(){return"ElementDescriptor["+yl(this.type).name+"]"};Si.prototype.valueHandler=function(t,e){return new ZP(t,e)};Si.prototype.referenceHandler=function(t){return new Xv(t,this.context)};Si.prototype.handler=function(t){return t==="Element"?new Yp(this.model,t,this.context):new Si(this.model,t,this.context)};Si.prototype.handleChild=function(t){var e,n,r,i;if(e=this.getPropertyForNode(t),r=this.element,n=e.effectiveType||e.type,Q8(n))return this.valueHandler(e,r);e.isReference?i=this.referenceHandler(e).handleNode(t):i=this.handler(n).handleNode(t);var s=i.element;return s!==void 0&&(e.isMany?r.get(e.name).push(s):r.set(e.name,s),e.isReference?(kr(s,{element:r}),this.context.addReference(s)):s.$parent=r),i};function JP(t,e,n){Si.call(this,t,e,n)}JP.prototype=Object.create(Si.prototype);JP.prototype.createElement=function(t){var e=t.name,n=zi(e),r=this.model,i=this.type,s=r.getPackage(n.prefix),o=s&&rH(n,s)||e;if(!i.hasType(o))throw Fc("unexpected element <"+t.originalName+">");return Si.prototype.createElement.call(this,t)};function Yp(t,e,n){this.model=t,this.context=n}Yp.prototype=Object.create(C_.prototype);Yp.prototype.createElement=function(t){var e=t.name,n=zi(e),r=n.prefix,i=t.ns[r+"$uri"],s=t.attributes;return this.model.createAny(e,i,s)};Yp.prototype.handleChild=function(t){var e=new Yp(this.model,"Element",this.context).handleNode(t),n=this.element,r=e.element,i;return r!==void 0&&(i=n.$children=n.$children||[],i.push(r),r.$parent=n),e};Yp.prototype.handleEnd=function(){this.body&&(this.element.$body=this.body)};function eT(t){t instanceof vo&&(t={model:t}),kr(this,{lax:!1},t)}eT.prototype.fromXML=function(t,e,n){var r=e.rootHandler;e instanceof Si?(r=e,e={}):typeof e=="string"?(r=this.handler(e),e={}):typeof r=="string"&&(r=this.handler(r));var i=this.model,s=this.lax,o=new Yhe(kr({},e,{rootHandler:r})),a=new J8({proxy:!0}),l=Xhe();r.context=o,l.push(r);function c(E,S,j){var C=S(),P=C.line,R=C.column,N=C.data;N.charAt(0)==="<"&&N.indexOf(" ")!==-1&&(N=N.slice(0,N.indexOf(" "))+">");var I="unparsable content "+(N?N+" ":"")+`detected
	line: `+P+`
	column: `+R+`
	nested error: `+E.message;if(j)return o.addWarning({message:I,error:E}),!0;throw Fc(I)}function d(E,S){return c(E,S,!0)}function h(){var E=o.elementsById,S=o.references,j,C;for(j=0;C=S[j];j++){var P=C.element,R=E[C.id],N=yl(P).propertiesByName[C.property];if(R||o.addWarning({message:"unresolved reference <"+C.id+">",element:C.element,property:C.property,value:C.id}),N.isMany){var I=P.get(N.name),M=I.indexOf(C);M===-1&&(M=I.length),R?I[M]=R:I.splice(M,1)}else P.set(N.name,R)}}function p(){l.pop().handleEnd()}var f=/^<\?xml /i,m=/ encoding="([^"]+)"/i,g=/^utf-8$/i;function v(E){if(f.test(E)){var S=m.exec(E),j=S&&S[1];!j||g.test(j)||o.addWarning({message:"unsupported document encoding <"+j+">, falling back to UTF-8"})}}function b(E,S){var j=l.peek();try{l.push(j.handleNode(E))}catch(C){c(C,S,s)&&l.push(new QP)}}function x(E,S){try{l.peek().handleText(E)}catch(j){d(j,S)}}function y(E,S){E.trim()&&x(E,S)}var w=i.getPackages().reduce(function(E,S){return E[S.uri]=S.prefix,E},{"http://www.w3.org/XML/1998/namespace":"xml"});return a.ns(w).on("openTag",function(E,S,j,C){var P=E.attrs||{},R=Object.keys(P).reduce(function(I,M){var W=S(P[M]);return I[M]=W,I},{}),N={name:E.name,originalName:E.originalName,attributes:R,ns:E.ns};b(N,C)}).on("question",v).on("closeTag",p).on("cdata",x).on("text",function(E,S,j){y(S(E),j)}).on("error",c).on("warn",d),new Promise(function(E,S){var j;try{a.parse(t),h()}catch(I){j=I}var C=r.element;!j&&!C&&(j=Fc("failed to parse document as <"+r.type.$descriptor.name+">"));var P=o.warnings,R=o.references,N=o.elementsById;return j?(j.warnings=P,S(j)):E({rootElement:C,elementsById:N,references:R,warnings:P})})};eT.prototype.handler=function(t){return new JP(this.model,t)};function Xhe(){var t=[];return Object.defineProperty(t,"peek",{value:function(){return this[this.length-1]}}),t}var Qhe=`<?xml version="1.0" encoding="UTF-8"?>
`,Zhe=/<|>|'|"|&|\n\r|\n/g,iH=/<|>|&/g;function Jhe(t){var e={},n={},r={},i=[],s=[];this.byUri=function(o){return n[o]||t&&t.byUri(o)},this.add=function(o,a){n[o.uri]=o,a?i.push(o):s.push(o),this.mapPrefix(o.prefix,o.uri)},this.uriByPrefix=function(o){return e[o||"xmlns"]},this.mapPrefix=function(o,a){e[o||"xmlns"]=a},this.getNSKey=function(o){return o.prefix!==void 0?o.uri+"|"+o.prefix:o.uri},this.logUsed=function(o){var a=o.uri,l=this.getNSKey(o);r[l]=this.byUri(a),t&&t.logUsed(o)},this.getUsed=function(o){function a(d){var h=l.getNSKey(d);return r[h]}var l=this,c=[].concat(i,s);return c.filter(a)}}function epe(t){return t.charAt(0).toLowerCase()+t.slice(1)}function tpe(t,e){return eH(e)?epe(t):t}function sH(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}function oH(t){return Qd(t)?t:(t.prefix?t.prefix+":":"")+t.localName}function npe(t){return t.getUsed().filter(function(e){return e.prefix!=="xml"}).map(function(e){var n="xmlns"+(e.prefix?":"+e.prefix:"");return{name:n,value:e.uri}})}function rpe(t,e){return e.isGeneric?kr({localName:e.ns.localName},t):kr({localName:tpe(e.ns.localName,e.$pkg)},t)}function ipe(t,e){return kr({localName:e.ns.localName},t)}function spe(t){var e=t.$descriptor;return KP(e.properties,function(n){var r=n.name;if(n.isVirtual||!G8(t,r))return!1;var i=t[r];return i===n.default||i===null?!1:n.isMany?i.length:!0})}var ope={"\n":"#10","\n\r":"#10",'"':"#34","'":"#39","<":"#60",">":"#62","&":"#38"},ape={"<":"lt",">":"gt","&":"amp"};function aH(t,e,n){return t=Qd(t)?t:""+t,t.replace(e,function(r){return"&"+n[r]+";"})}function lpe(t){return aH(t,Zhe,ope)}function cpe(t){return aH(t,iH,ape)}function upe(t){return KP(t,function(e){return e.isAttr})}function dpe(t){return KP(t,function(e){return!e.isAttr})}function tT(t){this.tagName=t}tT.prototype.build=function(t){return this.element=t,this};tT.prototype.serializeTo=function(t){t.appendIndent().append("<"+this.tagName+">"+this.element.id+"</"+this.tagName+">").appendNewLine()};function Id(){}Id.prototype.serializeValue=Id.prototype.serializeTo=function(t){t.append(this.escape?cpe(this.value):this.value)};Id.prototype.build=function(t,e){return this.value=e,t.type==="String"&&e.search(iH)!==-1&&(this.escape=!0),this};function nT(t){this.tagName=t}sH(nT,Id);nT.prototype.serializeTo=function(t){t.appendIndent().append("<"+this.tagName+">"),this.serializeValue(t),t.append("</"+this.tagName+">").appendNewLine()};function qn(t,e){this.body=[],this.attrs=[],this.parent=t,this.propertyDescriptor=e}qn.prototype.build=function(t){this.element=t;var e=t.$descriptor,n=this.propertyDescriptor,r,i,s=e.isGeneric;return s?r=this.parseGeneric(t):r=this.parseNsAttributes(t),n?this.ns=this.nsPropertyTagName(n):this.ns=this.nsTagName(e),this.tagName=this.addTagName(this.ns),s||(i=spe(t),this.parseAttributes(upe(i)),this.parseContainments(dpe(i))),this.parseGenericAttributes(t,r),this};qn.prototype.nsTagName=function(t){var e=this.logNamespaceUsed(t.ns);return rpe(e,t)};qn.prototype.nsPropertyTagName=function(t){var e=this.logNamespaceUsed(t.ns);return ipe(e,t)};qn.prototype.isLocalNs=function(t){return t.uri===this.ns.uri};qn.prototype.nsAttributeName=function(t){var e;if(Qd(t)?e=zi(t):e=t.ns,t.inherited)return{localName:e.localName};var n=this.logNamespaceUsed(e);return this.getNamespaces().logUsed(n),this.isLocalNs(n)?{localName:e.localName}:kr({localName:e.localName},n)};qn.prototype.parseGeneric=function(t){var e=this,n=this.body,r=[];return Rn(t,function(i,s){var o;s==="$body"?n.push(new Id().build({type:"String"},i)):s==="$children"?Rn(i,function(a){n.push(new qn(e).build(a))}):s.indexOf("$")!==0&&(o=e.parseNsAttribute(t,s,i),o&&r.push({name:s,value:i}))}),r};qn.prototype.parseNsAttribute=function(t,e,n){var r=t.$model,i=zi(e),s;if(i.prefix==="xmlns"&&(s={prefix:i.localName,uri:n}),!i.prefix&&i.localName==="xmlns"&&(s={uri:n}),!s)return{name:e,value:n};if(r&&r.getPackage(n))this.logNamespace(s,!0,!0);else{var o=this.logNamespaceUsed(s,!0);this.getNamespaces().logUsed(o)}};qn.prototype.parseNsAttributes=function(t,e){var n=this,r=t.$attrs,i=[];return Rn(r,function(s,o){var a=n.parseNsAttribute(t,o,s);a&&i.push(a)}),i};qn.prototype.parseGenericAttributes=function(t,e){var n=this;Rn(e,function(r){if(r.name!==S_)try{n.addAttribute(n.nsAttributeName(r.name),r.value)}catch(i){console.warn("missing namespace information for ",r.name,"=",r.value,"on",t,i)}})};qn.prototype.parseContainments=function(t){var e=this,n=this.body,r=this.element;Rn(t,function(i){var s=r.get(i.name),o=i.isReference,a=i.isMany;if(a||(s=[s]),i.isBody)n.push(new Id().build(i,s[0]));else if(Q8(i.type))Rn(s,function(d){n.push(new nT(e.addTagName(e.nsPropertyTagName(i))).build(i,d))});else if(o)Rn(s,function(d){n.push(new tT(e.addTagName(e.nsPropertyTagName(i))).build(d))});else{var l=nH(i),c=qhe(i);Rn(s,function(d){var h;l?h=new j_(e,i):c?h=new qn(e,i):h=new qn(e),n.push(h.build(d))})}})};qn.prototype.getNamespaces=function(t){var e=this.namespaces,n=this.parent,r;return e||(r=n&&n.getNamespaces(),t||!r?this.namespaces=e=new Jhe(r):e=r),e};qn.prototype.logNamespace=function(t,e,n){var r=this.getNamespaces(n),i=t.uri,s=t.prefix,o=r.byUri(i);return(!o||n)&&r.add(t,e),r.mapPrefix(s,i),t};qn.prototype.logNamespaceUsed=function(t,e){var n=this.element,r=n.$model,i=this.getNamespaces(e),s=t.prefix,o=t.uri,a,l,c;if(!s&&!o)return{localName:t.localName};if(c=Vhe[s]||r&&(r.getPackage(s)||{}).uri,o=o||c||i.uriByPrefix(s),!o)throw new Error("no namespace uri given for prefix <"+s+">");if(t=i.byUri(o),!t){for(a=s,l=1;i.uriByPrefix(a);)a=s+"_"+l++;t=this.logNamespace({prefix:a,uri:o},c===o)}return s&&i.mapPrefix(s,o),t};qn.prototype.parseAttributes=function(t){var e=this,n=this.element;Rn(t,function(r){var i=n.get(r.name);if(r.isReference)if(!r.isMany)i=i.id;else{var s=[];Rn(i,function(o){s.push(o.id)}),i=s.join(" ")}e.addAttribute(e.nsAttributeName(r),i)})};qn.prototype.addTagName=function(t){var e=this.logNamespaceUsed(t);return this.getNamespaces().logUsed(e),oH(t)};qn.prototype.addAttribute=function(t,e){var n=this.attrs;Qd(e)&&(e=lpe(e));var r=Nhe(n,function(s){return s.name.localName===t.localName&&s.name.uri===t.uri&&s.name.prefix===t.prefix}),i={name:t,value:e};r!==-1?n.splice(r,1,i):n.push(i)};qn.prototype.serializeAttributes=function(t){var e=this.attrs,n=this.namespaces;n&&(e=npe(n).concat(e)),Rn(e,function(r){t.append(" ").append(oH(r.name)).append('="').append(r.value).append('"')})};qn.prototype.serializeTo=function(t){var e=this.body[0],n=e&&e.constructor!==Id;t.appendIndent().append("<"+this.tagName),this.serializeAttributes(t),t.append(e?">":" />"),e&&(n&&t.appendNewLine().indent(),Rn(this.body,function(r){r.serializeTo(t)}),n&&t.unindent().appendIndent(),t.append("</"+this.tagName+">")),t.appendNewLine()};function j_(t,e){qn.call(this,t,e)}sH(j_,qn);j_.prototype.parseNsAttributes=function(t){var e=qn.prototype.parseNsAttributes.call(this,t),n=t.$descriptor;if(n.name===this.propertyDescriptor.type)return e;var r=this.typeNs=this.nsTagName(n);this.getNamespaces().logUsed(this.typeNs);var i=t.$model.getPackage(r.uri),s=i.xml&&i.xml.typePrefix||"";return this.addAttribute(this.nsAttributeName(S_),(r.prefix?r.prefix+":":"")+s+n.ns.localName),e};j_.prototype.isLocalNs=function(t){return t.uri===(this.typeNs||this.ns).uri};function hpe(){this.value="",this.write=function(t){this.value+=t}}function ppe(t,e){var n=[""];this.append=function(r){return t.write(r),this},this.appendNewLine=function(){return e&&t.write(`
`),this},this.appendIndent=function(){return e&&t.write(n.join("  ")),this},this.indent=function(){return n.push(""),this},this.unindent=function(){return n.pop(),this}}function fpe(t){t=kr({format:!1,preamble:!0},t||{});function e(n,r){var i=r||new hpe,s=new ppe(i,t.format);if(t.preamble&&s.append(Qhe),new qn().build(n).serializeTo(s),!r)return i.value}return{toXML:e}}function k_(t,e){vo.call(this,t,e)}k_.prototype=Object.create(vo.prototype);k_.prototype.fromXML=function(t,e,n){Qd(e)||(n=e,e="dmn:Definitions");var r=new eT(kr({model:this,lax:!0},n)),i=r.handler(e);return r.fromXML(t,i)};k_.prototype.toXML=function(t,e){var n=new fpe(e);return new Promise(function(r,i){try{var s=n.toXML(t);return r({xml:s})}catch(o){return i(o)}})};var mpe="DC",gpe="dc",vpe="http://www.omg.org/spec/DMN/20180521/DC/",ype=[{name:"Dimension",properties:[{name:"width",isAttr:!0,type:"Real"},{name:"height",isAttr:!0,type:"Real"}]},{name:"Bounds",properties:[{name:"height",isAttr:!0,type:"Real"},{name:"width",isAttr:!0,type:"Real"},{name:"x",isAttr:!0,type:"Real"},{name:"y",isAttr:!0,type:"Real"}]},{name:"Point",properties:[{name:"x",isAttr:!0,type:"Real"},{name:"y",isAttr:!0,type:"Real"}]},{name:"Color",properties:[{name:"red",type:"UML_Standard_Profile.mdzip:eee_1045467100323_917313_65"},{name:"green",type:"UML_Standard_Profile.mdzip:eee_1045467100323_917313_65"},{name:"blue",type:"UML_Standard_Profile.mdzip:eee_1045467100323_917313_65"}]}],xpe=[],bpe=[{name:"AlignmentKind",literalValues:[{name:"start"},{name:"center"},{name:"end"}]}],wpe={name:mpe,prefix:gpe,uri:vpe,types:ype,associations:xpe,enumerations:bpe},_pe="DI",Epe="di",Spe="http://www.omg.org/spec/DMN/20180521/DI/",Cpe=[{name:"DiagramElement",isAbstract:!0,properties:[{name:"extension",type:"Extension"},{name:"id",isAttr:!0,isId:!0,type:"String"},{name:"style",isReference:!0,type:"Style",xml:{serialize:"property"}},{name:"sharedStyle",isReference:!0,isVirtual:!0,type:"Style"}]},{name:"Diagram",superClass:["DiagramElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"documentation",isAttr:!0,type:"String"},{name:"resolution",isAttr:!0,type:"Real"}]},{name:"Shape",isAbstract:!0,properties:[{name:"bounds",type:"dc:Bounds"}],superClass:["DiagramElement"]},{name:"Edge",isAbstract:!0,properties:[{name:"waypoint",type:"dc:Point",isMany:!0,xml:{serialize:"property"}}],superClass:["DiagramElement"]},{name:"Style",isAbstract:!0,properties:[{name:"id",isAttr:!0,isId:!0,type:"String"}]},{name:"Extension",properties:[{name:"values",isMany:!0,type:"Element"}]}],jpe=[],kpe=[],Ppe={tagAlias:"lowerCase"},Tpe={name:_pe,prefix:Epe,uri:Spe,types:Cpe,associations:jpe,enumerations:kpe,xml:Ppe},Npe="DMN",Ope="dmn",Rpe="https://www.omg.org/spec/DMN/20191111/MODEL/",Ape=[{name:"AuthorityRequirement",superClass:["DMNElement"],properties:[{name:"requiredAuthority",type:"DMNElementReference",xml:{serialize:"property"}},{name:"requiredDecision",type:"DMNElementReference",xml:{serialize:"property"}},{name:"requiredInput",type:"DMNElementReference",xml:{serialize:"property"}}]},{name:"ItemDefinition",superClass:["NamedElement"],properties:[{name:"typeRef",type:"String"},{name:"allowedValues",type:"UnaryTests",xml:{serialize:"property"}},{name:"typeLanguage",type:"String",isAttr:!0},{name:"itemComponent",type:"ItemDefinition",isMany:!0,xml:{serialize:"property"}},{name:"functionItem",type:"FunctionItem"},{name:"isCollection",isAttr:!0,type:"Boolean"}]},{name:"Definitions",superClass:["NamedElement"],properties:[{name:"import",type:"Import",isMany:!0},{name:"itemDefinition",type:"ItemDefinition",isMany:!0},{name:"drgElement",type:"DRGElement",isMany:!0},{name:"artifact",type:"Artifact",isMany:!0},{name:"elementCollection",type:"ElementCollection",isMany:!0},{name:"businessContextElement",type:"BusinessContextElement",isMany:!0},{name:"namespace",type:"String",isAttr:!0},{name:"expressionLanguage",type:"String",isAttr:!0},{name:"typeLanguage",type:"String",isAttr:!0},{name:"exporter",isAttr:!0,type:"String"},{name:"exporterVersion",isAttr:!0,type:"String"},{name:"dmnDI",type:"dmndi:DMNDI"}]},{name:"KnowledgeSource",superClass:["DRGElement"],properties:[{name:"authorityRequirement",type:"AuthorityRequirement",isMany:!0},{name:"type",type:"String"},{name:"owner",type:"DMNElementReference",xml:{serialize:"property"}},{name:"locationURI",type:"String",isAttr:!0}]},{name:"DecisionRule",superClass:["DMNElement"],properties:[{name:"inputEntry",type:"UnaryTests",isMany:!0,xml:{serialize:"property"}},{name:"outputEntry",type:"LiteralExpression",isMany:!0,xml:{serialize:"property"}},{name:"annotationEntry",type:"RuleAnnotation",isMany:!0,xml:{serialize:"property"}}]},{name:"Expression",isAbstract:!0,superClass:["DMNElement"],properties:[{name:"typeRef",isAttr:!0,type:"String"}]},{name:"InformationItem",superClass:["NamedElement"],properties:[{name:"typeRef",isAttr:!0,type:"String"}]},{name:"Decision",superClass:["DRGElement"],properties:[{name:"question",type:"String",xml:{serialize:"property"}},{name:"allowedAnswers",type:"String",xml:{serialize:"property"}},{name:"variable",type:"InformationItem",xml:{serialize:"property"}},{name:"informationRequirement",type:"InformationRequirement",isMany:!0},{name:"knowledgeRequirement",type:"KnowledgeRequirement",isMany:!0},{name:"authorityRequirement",type:"AuthorityRequirement",isMany:!0},{name:"supportedObjective",isMany:!0,type:"DMNElementReference",xml:{serialize:"property"}},{name:"impactedPerformanceIndicator",type:"DMNElementReference",isMany:!0,xml:{serialize:"property"}},{name:"decisionMaker",type:"DMNElementReference",isMany:!0,xml:{serialize:"property"}},{name:"decisionOwner",type:"DMNElementReference",isMany:!0,xml:{serialize:"property"}},{name:"usingProcess",isMany:!0,type:"DMNElementReference",xml:{serialize:"property"}},{name:"usingTask",isMany:!0,type:"DMNElementReference",xml:{serialize:"property"}},{name:"decisionLogic",type:"Expression"}]},{name:"Invocation",superClass:["Expression"],properties:[{name:"calledFunction",type:"Expression"},{name:"binding",type:"Binding",isMany:!0}]},{name:"OrganisationalUnit",superClass:["BusinessContextElement"],properties:[{name:"decisionMade",type:"Decision",isReference:!0,isMany:!0},{name:"decisionOwned",type:"Decision",isReference:!0,isMany:!0}]},{name:"Import",superClass:["NamedElement"],properties:[{name:"importType",type:"String",isAttr:!0},{name:"locationURI",type:"String",isAttr:!0},{name:"namespace",type:"String",isAttr:!0}]},{name:"InformationRequirement",superClass:["DMNElement"],properties:[{name:"requiredDecision",type:"DMNElementReference",xml:{serialize:"property"}},{name:"requiredInput",type:"DMNElementReference",xml:{serialize:"property"}}]},{name:"ElementCollection",superClass:["NamedElement"],properties:[{name:"drgElement",type:"DMNElementReference",isMany:!0,xml:{serialize:"property"}}]},{name:"DRGElement",isAbstract:!0,superClass:["NamedElement"],properties:[]},{name:"InputData",superClass:["DRGElement"],properties:[{name:"variable",type:"InformationItem",xml:{serialize:"property"}}]},{name:"DMNElement",isAbstract:!0,properties:[{name:"description",type:"String"},{name:"extensionElements",type:"ExtensionElements"},{name:"id",type:"String",isAttr:!0,isId:!0},{name:"extensionAttribute",type:"ExtensionAttribute",isMany:!0},{name:"label",isAttr:!0,type:"String"}]},{name:"InputClause",superClass:["DMNElement"],properties:[{name:"inputExpression",type:"LiteralExpression",xml:{serialize:"property"}},{name:"inputValues",type:"UnaryTests",xml:{serialize:"property"}}]},{name:"DecisionTable",superClass:["Expression"],properties:[{name:"input",type:"InputClause",isMany:!0,xml:{serialize:"property"}},{name:"output",type:"OutputClause",isMany:!0,xml:{serialize:"property"}},{name:"annotation",type:"RuleAnnotationClause",isMany:!0,xml:{serialize:"property"}},{name:"rule",type:"DecisionRule",isMany:!0,xml:{serialize:"property"}},{name:"hitPolicy",type:"HitPolicy",isAttr:!0,default:"UNIQUE"},{name:"aggregation",type:"BuiltinAggregator",isAttr:!0},{name:"preferredOrientation",type:"DecisionTableOrientation",isAttr:!0},{name:"outputLabel",isAttr:!0,type:"String"}]},{name:"LiteralExpression",superClass:["Expression"],properties:[{name:"expressionLanguage",type:"String",isAttr:!0},{name:"text",type:"String"},{name:"importedValues",type:"ImportedValues"}]},{name:"Binding",properties:[{name:"parameter",type:"InformationItem",xml:{serialize:"property"}},{name:"bindingFormula",type:"Expression"}]},{name:"KnowledgeRequirement",superClass:["DMNElement"],properties:[{name:"requiredKnowledge",type:"DMNElementReference",xml:{serialize:"property"}}]},{name:"BusinessKnowledgeModel",superClass:["Invocable"],properties:[{name:"encapsulatedLogic",type:"FunctionDefinition",xml:{serialize:"property"}},{name:"knowledgeRequirement",type:"KnowledgeRequirement",isMany:!0},{name:"authorityRequirement",type:"AuthorityRequirement",isMany:!0}]},{name:"BusinessContextElement",isAbstract:!0,superClass:["NamedElement"],properties:[{name:"URI",type:"String",isAttr:!0}]},{name:"PerformanceIndicator",superClass:["BusinessContextElement"],properties:[{name:"impactingDecision",type:"DMNElementReference",isMany:!0,xml:{serialize:"property"}}]},{name:"FunctionDefinition",superClass:["Expression"],properties:[{name:"formalParameter",type:"InformationItem",isMany:!0,xml:{serialize:"property"}},{name:"body",type:"Expression"},{name:"kind",type:"FunctionKind",isAttr:!0}]},{name:"Context",superClass:["Expression"],properties:[{name:"contextEntry",type:"ContextEntry",isMany:!0}]},{name:"ContextEntry",superClass:["DMNElement"],properties:[{name:"variable",type:"InformationItem",xml:{serialize:"property"}},{name:"value",type:"Expression"}]},{name:"List",superClass:["Expression"],properties:[{name:"elements",isMany:!0,type:"Expression"}]},{name:"Relation",superClass:["Expression"],properties:[{name:"column",type:"InformationItem",isMany:!0,xml:{serialize:"property"}},{name:"row",type:"List",isMany:!0,xml:{serialize:"property"}}]},{name:"OutputClause",superClass:["DMNElement"],properties:[{name:"outputValues",type:"UnaryTests",xml:{serialize:"property"}},{name:"defaultOutputEntry",type:"LiteralExpression",xml:{serialize:"property"}},{name:"name",isAttr:!0,type:"String"},{name:"typeRef",isAttr:!0,type:"String"}]},{name:"UnaryTests",superClass:["Expression"],properties:[{name:"text",type:"String"},{name:"expressionLanguage",type:"String",isAttr:!0}]},{name:"NamedElement",isAbstract:!0,superClass:["DMNElement"],properties:[{name:"name",isAttr:!0,type:"String"}]},{name:"ImportedValues",superClass:["Import"],properties:[{name:"importedElement",type:"String"},{name:"expressionLanguage",type:"String",isAttr:!0}]},{name:"DecisionService",superClass:["Invocable"],properties:[{name:"outputDecision",type:"DMNElementReference",isMany:!0,xml:{serialize:"property"}},{name:"encapsulatedDecision",type:"DMNElementReference",isMany:!0,xml:{serialize:"property"}},{name:"inputDecision",type:"DMNElementReference",isMany:!0,xml:{serialize:"property"}},{name:"inputData",type:"DMNElementReference",isMany:!0,xml:{serialize:"property"}}]},{name:"ExtensionElements",properties:[{name:"values",type:"Element",isMany:!0}]},{name:"ExtensionAttribute",properties:[{name:"value",type:"Element"},{name:"valueRef",type:"Element",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Element",isAbstract:!0,properties:[{name:"extensionAttribute",type:"ExtensionAttribute",isAttr:!0,isReference:!0},{name:"elements",type:"ExtensionElements",isAttr:!0,isReference:!0}]},{name:"Artifact",isAbstract:!0,superClass:["DMNElement"],properties:[]},{name:"Association",superClass:["Artifact"],properties:[{name:"sourceRef",type:"DMNElementReference",xml:{serialize:"property"}},{name:"targetRef",type:"DMNElementReference",xml:{serialize:"property"}},{name:"associationDirection",type:"AssociationDirection",isAttr:!0}]},{name:"TextAnnotation",superClass:["Artifact"],properties:[{name:"text",type:"String"},{name:"textFormat",isAttr:!0,type:"String",default:"text/plain"}]},{name:"RuleAnnotationClause",properties:[{name:"name",isAttr:!0,type:"String"}]},{name:"RuleAnnotation",properties:[{name:"text",type:"String"}]},{name:"Invocable",isAbstract:!0,superClass:["DRGElement"],properties:[{name:"variable",type:"InformationItem",xml:{serialize:"property"}}]},{name:"Group",superClass:["Artifact"],properties:[{name:"name",isAttr:!0,type:"String"}]},{name:"FunctionItem",superClass:["DMNElement"],properties:[{name:"parameters",isMany:!0,type:"InformationItem",xml:{serialize:"property"}},{name:"outputTypeRef",isAttr:!0,type:"String"}]},{name:"DMNElementReference",properties:[{isAttr:!0,name:"href",type:"String"}]}],Ipe=[{name:"HitPolicy",literalValues:[{name:"UNIQUE"},{name:"FIRST"},{name:"PRIORITY"},{name:"ANY"},{name:"COLLECT"},{name:"RULE ORDER"},{name:"OUTPUT ORDER"}]},{name:"BuiltinAggregator",literalValues:[{name:"SUM"},{name:"COUNT"},{name:"MIN"},{name:"MAX"}]},{name:"DecisionTableOrientation",literalValues:[{name:"Rule-as-Row"},{name:"Rule-as-Column"},{name:"CrossTable"}]},{name:"AssociationDirection",literalValues:[{name:"None"},{name:"One"},{name:"Both"}]},{name:"FunctionKind",literalValues:[{name:"FEEL"},{name:"Java"},{name:"PMML"}]}],Dpe=[],$pe={tagAlias:"lowerCase"},Mpe={name:Npe,prefix:Ope,uri:Rpe,types:Ape,enumerations:Ipe,associations:Dpe,xml:$pe},Lpe="DMNDI",Bpe="dmndi",Fpe="https://www.omg.org/spec/DMN/20191111/DMNDI/",zpe=[{name:"DMNDI",properties:[{name:"diagrams",type:"DMNDiagram",isMany:!0},{name:"styles",type:"DMNStyle",isMany:!0}]},{name:"DMNStyle",superClass:["di:Style"],properties:[{name:"fillColor",type:"dc:Color",isAttr:!0},{name:"strokeColor",type:"dc:Color",isAttr:!0},{name:"fontColor",type:"dc:Color",isAttr:!0},{name:"fontSize",isAttr:!0,type:"Real"},{name:"fontFamily",isAttr:!0,type:"String"},{name:"fontItalic",isAttr:!0,type:"Boolean"},{name:"fontBold",isAttr:!0,type:"Boolean"},{name:"fontUnderline",isAttr:!0,type:"Boolean"},{name:"fontStrikeThrough",isAttr:!0,type:"Boolean"},{name:"labelHorizontalAlignment",type:"dc:AlignmentKind",isAttr:!0},{name:"labelVerticalAlignment",type:"dc:AlignmentKind",isAttr:!0}]},{name:"DMNDiagram",superClass:["di:Diagram"],properties:[{name:"dmnElementRef",type:"dmn:DMNElement",isAttr:!0,isReference:!0},{name:"size",type:"Size"},{name:"localStyle",type:"DMNStyle",isVirtual:!0},{name:"sharedStyle",type:"DMNStyle",isVirtual:!0,isReference:!0,redefines:"di:DiagramElement#sharedStyle"},{name:"diagramElements",type:"DMNDiagramElement",isMany:!0}]},{name:"DMNDiagramElement",isAbstract:!0,superClass:["di:DiagramElement"],properties:[{name:"dmnElementRef",type:"dmn:DMNElement",isAttr:!0,isReference:!0},{name:"sharedStyle",type:"DMNStyle",isVirtual:!0,isReference:!0,redefines:"di:DiagramElement#sharedStyle"},{name:"localStyle",type:"DMNStyle",isVirtual:!0},{name:"label",type:"DMNLabel"}]},{name:"DMNLabel",superClass:["di:Shape"],properties:[{name:"text",type:"Text"}]},{name:"DMNShape",superClass:["di:Shape","DMNDiagramElement"],properties:[{name:"isListedInputData",isAttr:!0,type:"Boolean"},{name:"decisionServiceDividerLine",type:"DMNDecisionServiceDividerLine"},{name:"isCollapsed",isAttr:!0,type:"Boolean"}]},{name:"DMNEdge",superClass:["di:Edge","DMNDiagramElement"],properties:[{name:"sourceElement",type:"DMNDiagramElement",isAttr:!0,isReference:!0},{name:"targetElement",type:"DMNDiagramElement",isAttr:!0,isReference:!0}]},{name:"DMNDecisionServiceDividerLine",superClass:["di:Edge"]},{name:"Text",properties:[{name:"text",isBody:!0,type:"String"}]},{name:"Size",superClass:["dc:Dimension"]}],Hpe=[],Upe=[],Vpe={name:Lpe,prefix:Bpe,uri:Fpe,types:zpe,associations:Hpe,enumerations:Upe},qpe="bpmn.io DI for DMN",Wpe="http://bpmn.io/schema/dmn/biodi/2.0",Gpe="biodi",Kpe={tagAlias:"lowerCase"},Ype=[{name:"DecisionTable",isAbstract:!0,extends:["dmn:DecisionTable"],properties:[{name:"annotationsWidth",isAttr:!0,type:"Integer"}]},{name:"OutputClause",isAbstract:!0,extends:["dmn:OutputClause"],properties:[{name:"width",isAttr:!0,type:"Integer"}]},{name:"InputClause",isAbstract:!0,extends:["dmn:InputClause"],properties:[{name:"width",isAttr:!0,type:"Integer"}]}],Xpe={name:qpe,uri:Wpe,prefix:Gpe,xml:Kpe,types:Ype},Qpe={dc:wpe,di:Tpe,dmn:Mpe,dmndi:Vpe,biodi:Xpe};function Zpe(t,e){var n=kr({},Qpe,t);return new k_(n,e)}function Ib(t){return function(){if(!window.Promise)throw new Error("Promises is not supported in this environment. Please polyfill Promise.");var e=arguments.length;if(e>=1&&Bt(arguments[e-1])){var n=arguments[e-1];console.warn(new Error("Passing callbacks to "+Jpe(t.name)+" is deprecated and will be removed in a future major release. Please switch to promises: https://bpmn.io/l/moving-to-promises.html"));var r=Array.prototype.slice.call(arguments,0,-1);t.apply(this,r).then(function(i){var s=Object.keys(i)[0];return n(null,i[s])},function(i){return n(i,i.warnings)})}else return t.apply(this,arguments)}}function Jpe(t){return t.replace("bound ","")}function hD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function _E(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?hD(Object(n),!0).forEach(function(r){lH(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):hD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function lH(t,e,n){return e=efe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function efe(t){var e=tfe(t,"string");return typeof e=="symbol"?e:String(e)}function tfe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var nfe={width:"100%",height:"100%",position:"relative"};class rfe{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};lH(this,"_viewsChanged",()=>{this._emit("views.changed",{views:this._views,activeView:this._activeView})}),this._eventBus=new Wi,this._viewsChanged=bf(this._viewsChanged,0),this._views=[],this._viewers={},this.open=Ib(this.open.bind(this)),this.importXML=Ib(this.importXML.bind(this)),this.saveXML=Ib(this.saveXML.bind(this)),this._init(e)}importXML(e,n){var r=this;return n=n||{open:!0},new Promise(function(s,o){var a=r._activeView;r._clear().then(()=>{e=r._emit("import.parse.start",{xml:e})||e;var l;r._moddle.fromXML(e,"dmn:Definitions").then(c=>{var d=c.rootElement,h=c.references,p=c.elementsById;if(l=c.warnings,d=r._emit("import.parse.complete",i({error:null,definitions:d,elementsById:p,references:h,warnings:l}))||d,r._setDefinitions(d),!n.open){r._emit("import.done",{error:null,warnings:l}),s({warnings:l});return}var f=r._getInitialView(r._views,a);if(!f){var m=new Error("no displayable contents");return r._emit("import.done",{error:m,warnings:l}),m.warnings=l,o(m)}r.open(f).then(g=>({warnings:g.warnings})).catch(g=>({error:g,warnings:g.warnings})).then(g=>{var v=[].concat(l,g.warnings);r._emit("import.done",{error:g.error,warnings:v}),g.error?(g.error.warnings=v,o(g.error)):s({warnings:v})})}).catch(c=>(l=c.warnings,c=ife(c,e)||sfe(c)||c,r._emit("import.parse.complete",i({error:c,warnings:l})),r._emit("import.done",{error:c,warnings:l}),c.warnings=l,o(c)))}).catch(l=>(r._emit("import.done",{error:l,warnings:[]}),l.warnings=[],o(l)))});function i(s){var o=r._eventBus.createEvent(s);return Object.defineProperty(o,"context",{enumerable:!0,get:function(){return console.warn(new Error("import.parse.complete <context> is deprecated and will be removed in future library versions")),{warnings:s.warnings,references:s.references,elementsById:s.elementsById}}}),o}}getDefinitions(){return this._definitions}getActiveView(){return this._activeView}getActiveViewer(){var e=this.getActiveView();return e&&this._getViewer(e)}getView(e){return this._views.filter(function(n){return n.element===e})[0]}getViews(){return this._views}saveXML(e){var n=this;e=e||{};var r=this._definitions;return new Promise(function(i,s){if(!r){s(new Error("no definitions loaded"));return}r=n._emit("saveXML.start",{definitions:r})||r,n._moddle.toXML(r,e).then(function(o){var a=o.xml;return a=n._emit("saveXML.serialized",{xml:a})||a,{xml:a}}).catch(o=>({error:o})).then(o=>{n._emit("saveXML.done",o),o.error?s(o.error):i({xml:o.xml})})})}on(){this._eventBus.on(...arguments)}off(){this._eventBus.off(...arguments)}once(){this._eventBus.once(...arguments)}attachTo(e){e.get&&e.constructor.prototype.jquery&&(e=e.get(0)),typeof e=="string"&&(e=at(e)),e.appendChild(this._container),this._emit("attach",{})}detach(){this._emit("detach",{}),Nr(this._container)}destroy(){Object.keys(this._viewers).forEach(e=>{var n=this._viewers[e];mD(n,"destroy")}),Nr(this._container)}_init(e){this._options=e,this._moddle=this._createModdle(e),this._viewers={},this._views=[];var n=bt('<div class="dmn-js-parent"></div>'),r=B({},nfe,e);B(n.style,{width:pD(r.width),height:pD(r.height),position:r.position}),this._container=n,e.container&&this.attachTo(e.container)}_clear(){return this._switchView(null)}open(e){return this._switchView(e)}_setDefinitions(e){this._definitions=e,this._updateViews()}_updateViews(){var e=this._definitions;if(!e){this._views=[],this._switchView(null);return}for(var n=this._getViewProviders(),r=[e,...e.drgElement||[]],i=this._views,s=[],o=0,a=r;o<a.length;o++){var l=a[o],c=Tt(n,function(g){return typeof g.opens=="string"?g.opens===l.$type:g.opens(l)});if(c){var d={element:l,id:l.id,name:l.name,type:c.id};s.push(d)}}var h=this._activeView,p;if(h&&(p=Tt(s,function(g){return cx(h,g)})||this._getInitialView(s),!p)){this._switchView(null);return}var f=!cx(h,p)||fD(h,p),m=i.length!==s.length||!Zs(s,function(g){return Tt(i,function(v){return cx(v,g)&&!fD(v,g)})});this._activeView=p,this._views=s,(f||m)&&this._viewsChanged()}_getInitialView(e,n){var r;return n&&(r=Tt(e,function(i){return cx(i,n)})||Tt(e,function(i){return i.type===n})),r||e[0]}_switchView(e){var n=this;return new Promise(function(r,i){var s=(d,h)=>{n._viewsChanged(),d?i(d):r(h)},o=n.getActiveView(),a,l=e&&n._getViewer(e),c=e&&e.element;if(o&&(a=n._getViewer(o),a!==l&&(mD(a,"clear"),a.detach())),n._activeView=e,l){a!==l&&l.attachTo(n._container),n._emit("import.render.start",{view:e,element:c}),l.open(c).then(d=>{n._emit("import.render.complete",{view:e,error:null,warnings:d.warnings}),s(null,d)}).catch(d=>{n._emit("import.render.complete",{view:e,error:d,warnings:d.warnings}),s(d,null)});return}s()})}_getViewer(e){var n=e.type,r=this._viewers[n];return r||(r=this._viewers[n]=this._createViewer(e.type),this._emit("viewer.created",{type:n,viewer:r})),r}_createViewer(e){var n=Tt(this._getViewProviders(),function(o){return o.id===e});if(!n)throw new Error("no provider for view type <"+e+">");var r=n.constructor,i=this._options[e]||{},s=this._options.common||{};return new r(_E(_E(_E({},s),i),{},{additionalModules:[...i.additionalModules||[],{_parent:["value",this],moddle:["value",this._moddle]}]}))}_emit(){return this._eventBus.fire(...arguments)}_createModdle(e){return new Zpe(e.moddleExtensions)}_getViewProviders(){return[]}}function pD(t){return t+(Oe(t)?"px":"")}function ife(t,e){if(t.message!=="failed to parse document as <dmn:Definitions>")return null;var n=e.indexOf('"http://www.omg.org/spec/DMN/20151101/dmn.xsd"')!==-1&&"1.1"||e.indexOf('"http://www.omg.org/spec/DMN/20180521/MODEL/"')!==-1&&"1.2";return n?(t=new Error("unsupported DMN "+n+" file detected; only DMN 1.3 files can be opened"),console.error("Cannot open what looks like a DMN "+n+" diagram. Please refer to https://bpmn.io/l/dmn-compatibility.html to learn how to make the toolkit compatible with older DMN files",t),t):null}function sfe(t){var e=/unparsable content <([^>]+)> detected([\s\S]*)$/,n=e.exec(t.message);return n?(t.message="unparsable content <"+n[1]+"> detected; this may indicate an invalid DMN 1.3 diagram file"+n[2],t):null}function cx(t,e){return an(t)?an(e)?t.element===e.element||t.id===e.id:!1:!an(e)}function fD(t,e){return!t||!e||t.name!==e.name}function mD(t,e){Bt(t[e])&&t[e]()}function Y(t,e){var n=jl(t);return n&&typeof n.$instanceOf=="function"&&n.$instanceOf(e)}function cn(t){return Y(t,"dmn:InputClause")}function Xr(t){return Y(t,"dmn:OutputClause")}function jl(t){return t&&t.businessObject||t}function ofe(t){return jl(t).name}function Hi(t,e){return Yc(e,function(n){return Y(t,n)})}class afe extends rfe{_init(e){super._init(e),this.on("import.parse.complete",n=>{n.error||this._collectIds(n.definitions,n.elementsById)}),this.on("destroy",()=>{this._moddle.ids.clear()}),this.on("viewer.created",n=>{var r=n.viewer;r.on("elements.changed",i=>{var s=i.elements,o=s.some(function(a){return Hi(a,["dmn:Decision","dmn:Definitions"])});o&&this._updateViews()})})}_collectIds(e,n){var r=e.$model,i=r.ids,s;i.clear();for(s in n)i.claim(s,n[s])}_createModdle(e){var n=super._createModdle(e);return n.ids=new wk([32,36,1]),n}}var lfe=1e3;function Fo(t,e){var n=this;e=e||lfe,t.on(["render.shape","render.connection"],e,function(r,i){var s=r.type,o=i.element,a=i.gfx,l=i.attrs;if(n.canRender(o))return s==="render.shape"?n.drawShape(a,o,l):n.drawConnection(a,o,l)}),t.on(["render.getShapePath","render.getConnectionPath"],e,function(r,i){if(n.canRender(i))return r.type==="render.getShapePath"?n.getShapePath(i):n.getConnectionPath(i)})}Fo.prototype.canRender=function(t){};Fo.prototype.drawShape=function(t,e){};Fo.prototype.drawConnection=function(t,e){};Fo.prototype.getShapePath=function(t){};Fo.prototype.getConnectionPath=function(t){};function rT(t){return t.flat().join(",").replace(/,?([A-z]),?/g,"$1")}function cfe(t){return["M",t.x,t.y]}function EE(t){return["L",t.x,t.y]}function ufe(t,e,n){return["C",t.x,t.y,e.x,e.y,n.x,n.y]}function dfe(t,e){const n=t.length,r=[cfe(t[0])];for(let i=1;i<n;i++){const s=t[i-1],o=t[i],a=t[i+1];if(!a||!e){r.push(EE(o));continue}const l=Math.min(e,FC(o.x-s.x,o.y-s.y),FC(a.x-o.x,a.y-o.y));if(!l){r.push(EE(o));continue}const c=ux(o,s,l),d=ux(o,s,l*.5),h=ux(o,a,l),p=ux(o,a,l*.5);r.push(EE(c)),r.push(ufe(d,p,h))}return r}function ux(t,e,n){const r=e.x-t.x,i=e.y-t.y,s=FC(r,i),o=n/s;return{x:t.x+r*o,y:t.y+i*o}}function FC(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}function P_(t,e,n){Oe(e)&&(n=e,e=null),e||(e={});const r=ee("path",e);return Oe(n)&&(r.dataset.cornerRadius=String(n)),cH(r,t)}function cH(t,e){const n=parseInt(t.dataset.cornerRadius,10)||0;return K(t,{d:rT(dfe(e,n))}),t}function hfe(t){return ht(t,function(e){return!Tt(t,function(n){return n!==e&&uH(e,n)})})}function uH(t,e){if(e){if(t===e)return e;if(t.parent)return uH(t.parent,e)}}function gD(t,e,n){var r=!0;return t.push(e),r}function iT(t,e,n){n=n||0,ke(t)||(t=[t]),$(t,function(r,i){var s=e(r,i,n);ke(s)&&s.length&&iT(s,e,n+1)})}function pfe(t,e,n){var r=[],i=[];return iT(t,function(s,o,a){gD(r,s);var l=s.children;if(l&&gD(i,l))return l}),r}function ffe(t,e){return pfe(t)}function mfe(t,e,n){Pk(e)&&(e=!0),Wn(e)&&(n=e,e=!0),n=n||{};var r=jm(n.allShapes),i=jm(n.allConnections),s=jm(n.enclosedElements),o=jm(n.enclosedConnections),a=jm(n.topLevel,e&&Kc(t,function(d){return d.id}));function l(d){a[d.source.id]&&a[d.target.id]&&(a[d.id]=[d]),r[d.source.id]&&r[d.target.id]&&(o[d.id]=s[d.id]=d),i[d.id]=d}function c(d){if(s[d.id]=d,d.waypoints)o[d.id]=i[d.id]=d;else return r[d.id]=d,$(d.incoming,l),$(d.outgoing,l),d.children}return iT(t,c),{allShapes:r,allConnections:i,topLevel:a,enclosedConnections:o,enclosedElements:s}}function Ps(t,e){e=!!e,ke(t)||(t=[t]);var n,r,i,s;return $(t,function(o){var a=o;o.waypoints&&!e&&(a=Ps(o.waypoints,!0));var l=a.x,c=a.y,d=a.height||0,h=a.width||0;(l<n||n===void 0)&&(n=l),(c<r||r===void 0)&&(r=c),(l+h>i||i===void 0)&&(i=l+h),(c+d>s||s===void 0)&&(s=c+d)}),{x:n,y:r,height:s-r,width:i-n}}function gfe(t,e){var n={};return $(t,function(r){var i=r;i.waypoints&&(i=Ps(i)),!Oe(e.y)&&i.x>e.x&&(n[r.id]=r),!Oe(e.x)&&i.y>e.y&&(n[r.id]=r),i.x>e.x&&i.y>e.y&&(Oe(e.width)&&Oe(e.height)&&i.width+i.x<e.width+e.x&&i.height+i.y<e.height+e.y||!Oe(e.width)||!Oe(e.height))&&(n[r.id]=r)}),n}function dH(t){return"waypoints"in t?"connection":"x"in t?"shape":"root"}function hH(t){return!!(t&&t.isFrame)}function jm(t,e){return B({},t||{},e||{})}var vfe=1;function cu(t,e){Fo.call(this,t,vfe),this.CONNECTION_STYLE=e.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=e.style({fill:"white",stroke:"fuchsia",strokeWidth:2}),this.FRAME_STYLE=e.style(["no-fill"],{stroke:"fuchsia",strokeDasharray:4,strokeWidth:2})}Ce(cu,Fo);cu.prototype.canRender=function(){return!0};cu.prototype.drawShape=function(e,n,r){var i=ee("rect");return K(i,{x:0,y:0,width:n.width||0,height:n.height||0}),hH(n)?K(i,B({},this.FRAME_STYLE,r||{})):K(i,B({},this.SHAPE_STYLE,r||{})),re(e,i),i};cu.prototype.drawConnection=function(e,n,r){var i=P_(n.waypoints,B({},this.CONNECTION_STYLE,r||{}));return re(e,i),i};cu.prototype.getShapePath=function(e){var n=e.x,r=e.y,i=e.width,s=e.height,o=[["M",n,r],["l",i,0],["l",0,s],["l",-i,0],["z"]];return rT(o)};cu.prototype.getConnectionPath=function(e){var n=e.waypoints,r,i,s=[];for(r=0;i=n[r];r++)i=i.original||i,s.push([r===0?"M":"L",i.x,i.y]);return rT(s)};cu.$inject=["eventBus","styles"];function yfe(){var t={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},e=this;this.cls=function(n,r,i){var s=this.style(r,i);return B(s,{class:n})},this.style=function(n,r){!ke(n)&&!r&&(r=n,n=[]);var i=xr(n,function(s,o){return B(s,t[o]||{})},{});return r?B(i,r):i},this.computeStyle=function(n,r,i){return ke(r)||(i=r,r=[]),e.style(r||[],B({},i,n||{}))}}const xfe={__init__:["defaultRenderer"],defaultRenderer:["type",cu],styles:["type",yfe]};function Zd(t,e){if(!t||!e)return-1;var n=t.indexOf(e);return n!==-1&&t.splice(n,1),n}function Ml(t,e,n){if(!(!t||!e)){typeof n!="number"&&(n=-1);var r=t.indexOf(e);if(r!==-1){if(r===n)return;if(n!==-1)t.splice(r,1);else return}n!==-1?t.splice(n,0,e):t.push(e)}}function pH(t,e){return!t||!e?-1:t.indexOf(e)}function T_(t,e){return!t||!e?-1:Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function fH(t,e,n,r){if(typeof r>"u"&&(r=5),!t||!e||!n)return!1;var i=(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x),s=T_(t,e);return Math.abs(i/s)<=r}var bfe=2;function tp(t,e){var n=Array.from(arguments).flat();const r={x:"v",y:"h"};for(const[i,s]of Object.entries(r))if(wfe(i,n))return s;return!1}function wfe(t,e){const n=e[0];return Zs(e,function(r){return Math.abs(n[t]-r[t])<=bfe})}function zC(t,e){return{x:Math.round(t.x+(e.x-t.x)/2),y:Math.round(t.y+(e.y-t.y)/2)}}function Mi(t){return Wn(t)&&Do(t,"waypoints")}function Xp(t){return Wn(t)&&Do(t,"labelTarget")}function _fe(t){return{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(t.width),height:Math.round(t.height)}}function pg(t){return{x:Math.round(t.x),y:Math.round(t.y)}}function kt(t){return{top:t.y,right:t.x+(t.width||0),bottom:t.y+(t.height||0),left:t.x}}function mH(t){return{x:t.left,y:t.top,width:t.right-t.left,height:t.bottom-t.top}}function Efe(t){return pg({x:t.x+(t.width||0)/2,y:t.y+(t.height||0)/2})}function Sfe(t){for(var e=t.waypoints,n=e.reduce(function(c,d,h){var p=e[h-1];if(p){var f=c[c.length-1],m=f&&f.endLength||0,g=kfe(p,d);c.push({start:p,end:d,startLength:m,endLength:m+g,length:g})}return c},[]),r=n.reduce(function(c,d){return c+d.length},0),i=r/2,s=0,o=n[s];o.endLength<i;)o=n[++s];var a=(i-o.startLength)/o.length,l={x:o.start.x+(o.end.x-o.start.x)*a,y:o.start.y+(o.end.y-o.start.y)*a};return l}function fn(t){return Mi(t)?Sfe(t):Efe(t)}function Ss(t,e,n){n=n||0,Wn(n)||(n={x:n,y:n});var r=kt(t),i=kt(e),s=r.bottom+n.y<=i.top,o=r.left-n.x>=i.right,a=r.top-n.y>=i.bottom,l=r.right+n.x<=i.left,c=s?"top":a?"bottom":null,d=l?"left":o?"right":null;return d&&c?c+"-"+d:d||c||"intersect"}function HC(t,e,n){var r=Cfe(t,e);return r.length===1||r.length===2&&T_(r[0],r[1])<1?pg(r[0]):r.length>1?(r=Ei(r,function(i){var s=Math.floor(i.t2*100)||1;return s=100-s,s=(s<10?"0":"")+s,i.segment2+"#"+s}),pg(r[n?0:r.length-1])):null}function Cfe(t,e){return Ck(t,e)}function jfe(t){t=t.slice();for(var e=0,n,r,i;t[e];)n=t[e],r=t[e-1],i=t[e+1],T_(n,i)===0||fH(r,i,n)?t.splice(e,1):e++;return t}function kfe(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Db(t,e){return Math.round(t*e)/e}function vD(t){return Oe(t)?t+"px":t}function Pfe(t){for(;t.parent;)t=t.parent;return t}function Tfe(t){t=B({},{width:"100%",height:"100%"},t);const e=t.container||document.body,n=document.createElement("div");return n.setAttribute("class","djs-container djs-parent"),La(n,{position:"relative",overflow:"hidden",width:vD(t.width),height:vD(t.height)}),e.appendChild(n),n}function gH(t,e,n){const r=ee("g");Ge(r).add(e);const i=n!==void 0?n:t.childNodes.length-1;return t.insertBefore(r,t.childNodes[i]||null),r}const Nfe="base",vH=0,Ofe=1,Rfe={shape:["x","y","width","height"],connection:["waypoints"]};function wt(t,e,n,r){this._eventBus=e,this._elementRegistry=r,this._graphicsFactory=n,this._rootsIdx=0,this._layers={},this._planes=[],this._rootElement=null,this._init(t||{})}wt.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"];wt.prototype._init=function(t){const e=this._eventBus,n=this._container=Tfe(t),r=this._svg=ee("svg");K(r,{width:"100%",height:"100%"}),re(n,r);const i=this._viewport=gH(r,"viewport");t.deferUpdate&&(this._viewboxChanged=bf(li(this._viewboxChanged,this),300)),e.on("diagram.init",()=>{e.fire("canvas.init",{svg:r,viewport:i})}),e.on(["shape.added","connection.added","shape.removed","connection.removed","elements.changed","root.set"],()=>{delete this._cachedViewbox}),e.on("diagram.destroy",500,this._destroy,this),e.on("diagram.clear",500,this._clear,this)};wt.prototype._destroy=function(){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});const t=this._container.parentNode;t&&t.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._planes,delete this._rootElement,delete this._viewport};wt.prototype._clear=function(){this._elementRegistry.getAll().forEach(e=>{const n=dH(e);n==="root"?this.removeRootElement(e):this._removeElement(e,n)}),this._planes=[],this._rootElement=null,delete this._cachedViewbox};wt.prototype.getDefaultLayer=function(){return this.getLayer(Nfe,vH)};wt.prototype.getLayer=function(t,e){if(!t)throw new Error("must specify a name");let n=this._layers[t];if(n||(n=this._layers[t]=this._createLayer(t,e)),typeof e<"u"&&n.index!==e)throw new Error("layer <"+t+"> already created at index <"+e+">");return n.group};wt.prototype._getChildIndex=function(t){return xr(this._layers,function(e,n){return n.visible&&t>=n.index&&e++,e},0)};wt.prototype._createLayer=function(t,e){typeof e>"u"&&(e=Ofe);const n=this._getChildIndex(e);return{group:gH(this._viewport,"layer-"+t,n),index:e,visible:!0}};wt.prototype.showLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=this._viewport,r=e.group,i=e.index;if(e.visible)return r;const s=this._getChildIndex(i);return n.insertBefore(r,n.childNodes[s]||null),e.visible=!0,r};wt.prototype.hideLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=e.group;return e.visible&&(un(n),e.visible=!1),n};wt.prototype._removeLayer=function(t){const e=this._layers[t];e&&(delete this._layers[t],un(e.group))};wt.prototype.getActiveLayer=function(){const t=this._findPlaneForRoot(this.getRootElement());return t?t.layer:null};wt.prototype.findRoot=function(t){return typeof t=="string"&&(t=this._elementRegistry.get(t)),t?(this._findPlaneForRoot(Pfe(t))||{}).rootElement:void 0};wt.prototype.getRootElements=function(){return this._planes.map(function(t){return t.rootElement})};wt.prototype._findPlaneForRoot=function(t){return Tt(this._planes,function(e){return e.rootElement===t})};wt.prototype.getContainer=function(){return this._container};wt.prototype._updateMarker=function(t,e,n){let r;t.id||(t=this._elementRegistry.get(t)),r=this._elementRegistry._elements[t.id],r&&($([r.gfx,r.secondaryGfx],function(i){i&&(n?Ge(i).add(e):Ge(i).remove(e))}),this._eventBus.fire("element.marker.update",{element:t,gfx:r.gfx,marker:e,add:!!n}))};wt.prototype.addMarker=function(t,e){this._updateMarker(t,e,!0)};wt.prototype.removeMarker=function(t,e){this._updateMarker(t,e,!1)};wt.prototype.hasMarker=function(t,e){t.id||(t=this._elementRegistry.get(t));const n=this.getGraphics(t);return Ge(n).has(e)};wt.prototype.toggleMarker=function(t,e){this.hasMarker(t,e)?this.removeMarker(t,e):this.addMarker(t,e)};wt.prototype.getRootElement=function(){const t=this._rootElement;return t||this._planes.length?t:this.setRootElement(this.addRootElement(null))};wt.prototype.addRootElement=function(t){const e=this._rootsIdx++;t||(t={id:"__implicitroot_"+e,children:[],isImplicit:!0});const n=t.layer="root-"+e;this._ensureValid("root",t);const r=this.getLayer(n,vH);return this.hideLayer(n),this._addRoot(t,r),this._planes.push({rootElement:t,layer:r}),t};wt.prototype.removeRootElement=function(t){if(typeof t=="string"&&(t=this._elementRegistry.get(t)),!!this._findPlaneForRoot(t))return this._removeRoot(t),this._removeLayer(t.layer),this._planes=this._planes.filter(function(n){return n.rootElement!==t}),this._rootElement===t&&(this._rootElement=null),t};wt.prototype.setRootElement=function(t){if(t===this._rootElement)return;let e;if(!t)throw new Error("rootElement required");return e=this._findPlaneForRoot(t),e||(t=this.addRootElement(t)),this._setRoot(t),t};wt.prototype._removeRoot=function(t){const e=this._elementRegistry,n=this._eventBus;n.fire("root.remove",{element:t}),n.fire("root.removed",{element:t}),e.remove(t)};wt.prototype._addRoot=function(t,e){const n=this._elementRegistry,r=this._eventBus;r.fire("root.add",{element:t}),n.add(t,e),r.fire("root.added",{element:t,gfx:e})};wt.prototype._setRoot=function(t,e){const n=this._rootElement;n&&(this._elementRegistry.updateGraphics(n,null,!0),this.hideLayer(n.layer)),t&&(e||(e=this._findPlaneForRoot(t).layer),this._elementRegistry.updateGraphics(t,this._svg,!0),this.showLayer(t.layer)),this._rootElement=t,this._eventBus.fire("root.set",{element:t})};wt.prototype._ensureValid=function(t,e){if(!e.id)throw new Error("element must have an id");if(this._elementRegistry.get(e.id))throw new Error("element <"+e.id+"> already exists");const n=Rfe[t];if(!Zs(n,function(i){return typeof e[i]<"u"}))throw new Error("must supply { "+n.join(", ")+" } with "+t)};wt.prototype._setParent=function(t,e,n){Ml(e.children,t,n),t.parent=e};wt.prototype._addElement=function(t,e,n,r){n=n||this.getRootElement();const i=this._eventBus,s=this._graphicsFactory;this._ensureValid(t,e),i.fire(t+".add",{element:e,parent:n}),this._setParent(e,n,r);const o=s.create(t,e,r);return this._elementRegistry.add(e,o),s.update(t,e,o),i.fire(t+".added",{element:e,gfx:o}),e};wt.prototype.addShape=function(t,e,n){return this._addElement("shape",t,e,n)};wt.prototype.addConnection=function(t,e,n){return this._addElement("connection",t,e,n)};wt.prototype._removeElement=function(t,e){const n=this._elementRegistry,r=this._graphicsFactory,i=this._eventBus;if(t=n.get(t.id||t),!!t)return i.fire(e+".remove",{element:t}),r.remove(t),Zd(t.parent&&t.parent.children,t),t.parent=null,i.fire(e+".removed",{element:t}),n.remove(t),t};wt.prototype.removeShape=function(t){return this._removeElement(t,"shape")};wt.prototype.removeConnection=function(t){return this._removeElement(t,"connection")};wt.prototype.getGraphics=function(t,e){return this._elementRegistry.getGraphics(t,e)};wt.prototype._changeViewbox=function(t){this._eventBus.fire("canvas.viewbox.changing"),t.apply(this),this._cachedViewbox=null,this._viewboxChanged()};wt.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})};wt.prototype.viewbox=function(t){if(t===void 0&&this._cachedViewbox)return this._cachedViewbox;const e=this._viewport,n=this.getSize();let r,i,s,o,a,l,c;if(t)this._changeViewbox(function(){a=Math.min(n.width/t.width,n.height/t.height);const d=this._svg.createSVGMatrix().scale(a).translate(-t.x,-t.y);Tg(e,d)});else return s=this._rootElement?this.getActiveLayer():null,r=s&&s.getBBox()||{},o=Tg(e),i=o?o.matrix:TX(),a=Db(i.a,1e3),l=Db(-i.e||0,1e3),c=Db(-i.f||0,1e3),t=this._cachedViewbox={x:l?l/a:0,y:c?c/a:0,width:n.width/a,height:n.height/a,scale:a,inner:{width:r.width||0,height:r.height||0,x:r.x||0,y:r.y||0},outer:n},t;return t};wt.prototype.scroll=function(t){const e=this._viewport;let n=e.getCTM();return t&&this._changeViewbox(function(){t=B({dx:0,dy:0},t||{}),n=this._svg.createSVGMatrix().translate(t.dx,t.dy).multiply(n),yH(e,n)}),{x:n.e,y:n.f}};wt.prototype.scrollToElement=function(t,e){let n=100;typeof t=="string"&&(t=this._elementRegistry.get(t));const r=this.findRoot(t);if(r!==this.getRootElement()&&this.setRootElement(r),r===t)return;e||(e={}),typeof e=="number"&&(n=e),e={top:e.top||n,right:e.right||n,bottom:e.bottom||n,left:e.left||n};const i=Ps(t),s=kt(i),o=this.viewbox(),a=this.zoom();let l,c;o.y+=e.top/a,o.x+=e.left/a,o.width-=(e.right+e.left)/a,o.height-=(e.bottom+e.top)/a;const d=kt(o);if(!(i.width<o.width&&i.height<o.height))l=i.x-o.x,c=i.y-o.y;else{const p=Math.max(0,s.right-d.right),f=Math.min(0,s.left-d.left),m=Math.max(0,s.bottom-d.bottom),g=Math.min(0,s.top-d.top);l=p||f,c=m||g}this.scroll({dx:-l*a,dy:-c*a})};wt.prototype.zoom=function(t,e){if(!t)return this.viewbox(t).scale;if(t==="fit-viewport")return this._fitViewport(e);let n,r;return this._changeViewbox(function(){typeof e!="object"&&(n=this.viewbox().outer,e={x:n.width/2,y:n.height/2}),r=this._setZoom(t,e)}),Db(r.a,1e3)};function yH(t,e){const n="matrix("+e.a+","+e.b+","+e.c+","+e.d+","+e.e+","+e.f+")";t.setAttribute("transform",n)}wt.prototype._fitViewport=function(t){const e=this.viewbox(),n=e.outer,r=e.inner;let i,s;return r.x>=0&&r.y>=0&&r.x+r.width<=n.width&&r.y+r.height<=n.height&&!t?s={x:0,y:0,width:Math.max(r.width+r.x,n.width),height:Math.max(r.height+r.y,n.height)}:(i=Math.min(1,n.width/r.width,n.height/r.height),s={x:r.x+(t?r.width/2-n.width/i/2:0),y:r.y+(t?r.height/2-n.height/i/2:0),width:n.width/i,height:n.height/i}),this.viewbox(s),this.viewbox(!1).scale};wt.prototype._setZoom=function(t,e){const n=this._svg,r=this._viewport,i=n.createSVGMatrix(),s=n.createSVGPoint();let o,a,l,c,d;l=r.getCTM();const h=l.a;return e?(o=B(s,e),a=o.matrixTransform(l.inverse()),c=i.translate(a.x,a.y).scale(1/h*t).translate(-a.x,-a.y),d=l.multiply(c)):d=i.scale(t),yH(this._viewport,d),d};wt.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}};wt.prototype.getAbsoluteBBox=function(t){const e=this.viewbox();let n;t.waypoints?n=this.getGraphics(t).getBBox():n=t;const r=n.x*e.scale-e.x*e.scale,i=n.y*e.scale-e.y*e.scale,s=n.width*e.scale,o=n.height*e.scale;return{x:r,y:i,width:s,height:o}};wt.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")};var Qp="data-element-id";function Rs(t){this._elements={},this._eventBus=t}Rs.$inject=["eventBus"];Rs.prototype.add=function(t,e,n){var r=t.id;this._validateId(r),K(e,Qp,r),n&&K(n,Qp,r),this._elements[r]={element:t,gfx:e,secondaryGfx:n}};Rs.prototype.remove=function(t){var e=this._elements,n=t.id||t,r=n&&e[n];r&&(K(r.gfx,Qp,""),r.secondaryGfx&&K(r.secondaryGfx,Qp,""),delete e[n])};Rs.prototype.updateId=function(t,e){this._validateId(e),typeof t=="string"&&(t=this.get(t)),this._eventBus.fire("element.updateId",{element:t,newId:e});var n=this.getGraphics(t),r=this.getGraphics(t,!0);this.remove(t),t.id=e,this.add(t,n,r)};Rs.prototype.updateGraphics=function(t,e,n){var r=t.id||t,i=this._elements[r];return n?i.secondaryGfx=e:i.gfx=e,e&&K(e,Qp,r),e};Rs.prototype.get=function(t){var e;typeof t=="string"?e=t:e=t&&K(t,Qp);var n=this._elements[e];return n&&n.element};Rs.prototype.filter=function(t){var e=[];return this.forEach(function(n,r){t(n,r)&&e.push(n)}),e};Rs.prototype.find=function(t){for(var e=this._elements,n=Object.keys(e),r=0;r<n.length;r++){var i=n[r],s=e[i],o=s.element,a=s.gfx;if(t(o,a))return o}};Rs.prototype.getAll=function(){return this.filter(function(t){return t})};Rs.prototype.forEach=function(t){var e=this._elements;Object.keys(e).forEach(function(n){var r=e[n],i=r.element,s=r.gfx;return t(i,s)})};Rs.prototype.getGraphics=function(t,e){var n=t.id||t,r=this._elements[n];return r&&(e?r.secondaryGfx:r.gfx)};Rs.prototype._validateId=function(t){if(!t)throw new Error("element must have an id");if(this._elements[t])throw new Error("element with id "+t+" already added")};var sT=new wf({name:"children",enumerable:!0,collection:!0},{name:"parent"}),xH=new wf({name:"labels",enumerable:!0,collection:!0},{name:"labelTarget"}),yD=new wf({name:"attachers",collection:!0},{name:"host"}),bH=new wf({name:"outgoing",collection:!0},{name:"source"}),wH=new wf({name:"incoming",collection:!0},{name:"target"});function $f(){Object.defineProperty(this,"businessObject",{writable:!0}),Object.defineProperty(this,"label",{get:function(){return this.labels[0]},set:function(t){var e=this.label,n=this.labels;!t&&e?n.remove(e):n.add(t,0)}}),sT.bind(this,"parent"),xH.bind(this,"labels"),bH.bind(this,"outgoing"),wH.bind(this,"incoming")}function Qv(){$f.call(this),sT.bind(this,"children"),yD.bind(this,"host"),yD.bind(this,"attachers")}Ce(Qv,$f);function _H(){$f.call(this),sT.bind(this,"children")}Ce(_H,Qv);function EH(){Qv.call(this),xH.bind(this,"labelTarget")}Ce(EH,Qv);function SH(){$f.call(this),bH.bind(this,"source"),wH.bind(this,"target")}Ce(SH,$f);var Afe={connection:SH,shape:Qv,label:EH,root:_H};function Ife(t,e){var n=Afe[t];if(!n)throw new Error("unknown type: <"+t+">");return B(new n,e)}function Dfe(t){return t instanceof $f}function Ll(){this._uid=12}Ll.prototype.createRoot=function(t){return this.create("root",t)};Ll.prototype.createLabel=function(t){return this.create("label",t)};Ll.prototype.createShape=function(t){return this.create("shape",t)};Ll.prototype.createConnection=function(t){return this.create("connection",t)};Ll.prototype.create=function(t,e){return e=B({},e||{}),e.id||(e.id=t+"_"+this._uid++),Ife(t,e)};var S0="__fn",CH=1e3,$fe=Array.prototype.slice;function us(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}us.prototype.on=function(t,e,n,r){if(t=ke(t)?t:[t],Bt(e)&&(r=n,n=e,e=CH),!Oe(e))throw new Error("priority must be a number");var i=n;r&&(i=li(n,r),i[S0]=n[S0]||n);var s=this;t.forEach(function(o){s._addListener(o,{priority:e,callback:i,next:null})})};us.prototype.once=function(t,e,n,r){var i=this;if(Bt(e)&&(r=n,n=e,e=CH),!Oe(e))throw new Error("priority must be a number");function s(){s.__isTomb=!0;var o=n.apply(r,arguments);return i.off(t,s),o}s[S0]=n,this.on(t,e,s)};us.prototype.off=function(t,e){t=ke(t)?t:[t];var n=this;t.forEach(function(r){n._removeListener(r,e)})};us.prototype.createEvent=function(t){var e=new Zv;return e.init(t),e};us.prototype.fire=function(t,e){var n,r,i,s;if(s=$fe.call(arguments),typeof t=="object"&&(e=t,t=e.type),!t)throw new Error("no event type specified");if(r=this._listeners[t],!!r){e instanceof Zv?n=e:n=this.createEvent(e),s[0]=n;var o=n.type;t!==o&&(n.type=t);try{i=this._invokeListeners(n,s,r)}finally{t!==o&&(n.type=o)}return i===void 0&&n.defaultPrevented&&(i=!1),i}};us.prototype.handleError=function(t){return this.fire("error",{error:t})===!1};us.prototype._destroy=function(){this._listeners={}};us.prototype._invokeListeners=function(t,e,n){for(var r;n&&!t.cancelBubble;)r=this._invokeListener(t,e,n),n=n.next;return r};us.prototype._invokeListener=function(t,e,n){var r;if(n.callback.__isTomb)return r;try{r=Mfe(n.callback,e),r!==void 0&&(t.returnValue=r,t.stopPropagation()),r===!1&&t.preventDefault()}catch(i){if(!this.handleError(i))throw console.error("unhandled error in event listener",i),i}return r};us.prototype._addListener=function(t,e){var n=this._getListeners(t),r;if(!n){this._setListeners(t,e);return}for(;n;){if(n.priority<e.priority){e.next=n,r?r.next=e:this._setListeners(t,e);return}r=n,n=n.next}r.next=e};us.prototype._getListeners=function(t){return this._listeners[t]};us.prototype._setListeners=function(t,e){this._listeners[t]=e};us.prototype._removeListener=function(t,e){var n=this._getListeners(t),r,i,s;if(!e){this._setListeners(t,null);return}for(;n;)r=n.next,s=n.callback,(s===e||s[S0]===e)&&(i?i.next=r:this._setListeners(t,r)),i=n,n=r};function Zv(){}Zv.prototype.stopPropagation=function(){this.cancelBubble=!0};Zv.prototype.preventDefault=function(){this.defaultPrevented=!0};Zv.prototype.init=function(t){B(this,t||{})};function Mfe(t,e){return t.apply(null,e)}function C0(t){return t.childNodes[0]}function Lfe(t){return t.parentNode.childNodes[1]}function Bfe(t,e,n,r,i){var s=tg();s.setTranslate(e,n);var o=tg();o.setRotate(0,0,0);var a=tg();a.setScale(1,1),Tg(t,[s,o,a])}function Ta(t,e,n){var r=tg();r.setTranslate(e,n),Tg(t,r)}function Ffe(t,e){var n=tg();n.setRotate(e,0,0),Tg(t,n)}function As(t,e){this._eventBus=t,this._elementRegistry=e}As.$inject=["eventBus","elementRegistry"];As.prototype._getChildrenContainer=function(t){var e=this._elementRegistry.getGraphics(t),n;return t.parent?(n=Lfe(e),n||(n=ee("g"),Ge(n).add("djs-children"),re(e.parentNode,n))):n=e,n};As.prototype._clear=function(t){var e=C0(t);return xf(e),e};As.prototype._createContainer=function(t,e,n,r){var i=ee("g");Ge(i).add("djs-group"),typeof n<"u"?jH(i,e,e.childNodes[n]):re(e,i);var s=ee("g");Ge(s).add("djs-element"),Ge(s).add("djs-"+t),r&&Ge(s).add("djs-frame"),re(i,s);var o=ee("g");return Ge(o).add("djs-visual"),re(s,o),s};As.prototype.create=function(t,e,n){var r=this._getChildrenContainer(e.parent);return this._createContainer(t,r,n,hH(e))};As.prototype.updateContainments=function(t){var e=this,n=this._elementRegistry,r;r=xr(t,function(i,s){return s.parent&&(i[s.parent.id]=s.parent),i},{}),$(r,function(i){var s=i.children;if(s){var o=e._getChildrenContainer(i);$(s.slice().reverse(),function(a){var l=n.getGraphics(a);jH(l.parentNode,o)})}})};As.prototype.drawShape=function(t,e,n={}){var r=this._eventBus;return r.fire("render.shape",{gfx:t,element:e,attrs:n})};As.prototype.getShapePath=function(t){var e=this._eventBus;return e.fire("render.getShapePath",t)};As.prototype.drawConnection=function(t,e,n={}){var r=this._eventBus;return r.fire("render.connection",{gfx:t,element:e,attrs:n})};As.prototype.getConnectionPath=function(t){var e=this._eventBus;return e.fire("render.getConnectionPath",t)};As.prototype.update=function(t,e,n){if(e.parent){var r=this._clear(n);if(t==="shape")this.drawShape(r,e),Ta(n,e.x,e.y);else if(t==="connection")this.drawConnection(r,e);else throw new Error("unknown type: "+t);e.hidden?K(n,"display","none"):K(n,"display","block")}};As.prototype.remove=function(t){var e=this._elementRegistry.getGraphics(t);un(e.parentNode)};function jH(t,e,n){var r=n||e.firstChild;t!==r&&e.insertBefore(t,r)}const zfe={__depends__:[xfe],__init__:["canvas"],canvas:["type",wt],elementRegistry:["type",Rs],elementFactory:["type",Ll],eventBus:["type",us],graphicsFactory:["type",As]};function Hfe(t){var e=new Rk(t);return e.init(),e}function Ufe(t){t=t||{};var e={config:["value",t]},n=[e,zfe].concat(t.modules||[]);return Hfe(n)}function Jv(t,e){this._injector=e=e||Ufe(t),this.get=e.get,this.invoke=e.invoke,this.get("eventBus").fire("diagram.init")}Jv.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")};Jv.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")};var Vfe=new wf({name:"dmnElementRef",enumerable:!0},{name:"di",configurable:!0});function qfe(t,e){var n=[];function r(b){var x=b.gfx;if(x)throw new Error("already rendered "+b.id);return t.element(b)}function i(b){return t.root(b)}function s(b){try{var x=b.di&&r(b);return x}catch(y){v(y.message,{element:b,error:y})}}function o(b,x){var y=b.dmnDI;if(!y)throw new Error("no dmndi:DMNDI");var w=y.diagrams||[];if(x&&w.indexOf(x)===-1)throw new Error("diagram not part of dmndi:DMNDI");if(!x&&w&&w.length&&(x=w[0]),!x)throw new Error("no diagram to display");b.di=x,h(x),i(b),a(b.get("drgElement")),l(b.get("artifact")),g()}function a(b){$(b,function(x){s(x),d(x)})}function l(b){$(b,function(x){Y(x,"dmn:Association")?c(x):s(x)})}function c(b){m(function(){s(b)})}function d(b){$(["informationRequirement","knowledgeRequirement","authorityRequirement"],function(x){$(b[x],function(y){m(function(){s(y)})})})}function h(b){$(b.diagramElements,p)}function p(b){f(b)}function f(b){var x=b.dmnElementRef;x?x.di?v("multiple DI elements defined for element",{element:x}):(Vfe.bind(x,"di"),x.di=b):v("no DMN element referenced in element",{element:b})}function m(b){n.push(b)}function g(){$(n,function(b){b()})}function v(b,x){t.error(b,x)}return{handleDefinitions:o}}function Wfe(t,e,n){var r=t.get("drdImporter"),i=t.get("eventBus"),s,o=[];function a(l){var c={root:function(p){return r.root(p)},element:function(p,f){return r.add(p,f)},error:function(p,f){o.push({message:p,context:f})}},d=new qfe(c);d.handleDefinitions(l)}i.fire("import.start",{definitions:e});try{a(e)}catch(l){s=l}i.fire("import.done",{error:s,warnings:o}),n(s,o)}var oT="$NO_OP",Gfe="a runtime error occured! Use Inferno in development environment to find the error.",j0=Array.isArray;function aT(t){var e=typeof t;return e==="string"||e==="number"}function Qt(t){return k0(t)||Un(t)}function zc(t){return Un(t)||t===!1||Kfe(t)||k0(t)}function Kt(t){return typeof t=="function"}function Zp(t){return typeof t=="string"}function UC(t){return typeof t=="number"}function Un(t){return t===null}function Kfe(t){return t===!0}function k0(t){return t===void 0}function Yfe(t){throw t||(t=Gfe),new Error("Inferno Error: "+t)}function Vg(t,e){var n={};if(t)for(var r in t)n[r]=t[r];if(e)for(var i in e)n[i]=e[i];return n}var fg="$";function lT(t,e,n,r,i,s,o,a){return{childFlags:t,children:e,className:n,dom:null,flags:r,key:i===void 0?null:i,parentVNode:null,props:s===void 0?null:s,ref:o===void 0?null:o,type:a}}function D(t,e,n,r,i,s,o,a){var l=i===void 0?1:i,c=lT(l,r,n,t,o,s,a,e);return l===0&&TH(c,c.children),c}function Pe(t,e,n,r,i){(t&2)>0&&(t=e.prototype&&Kt(e.prototype.render)?4:8);var s=e.defaultProps;if(!Qt(s)){n||(n={});for(var o in s)k0(n[o])&&(n[o]=s[o])}if((t&8)>0){var a=e.defaultHooks;if(!Qt(a))if(!i)i=a;else for(var l in a)k0(i[l])&&(i[l]=a[l])}var c=lT(1,null,null,t,r,n,i,e),d=$o.createVNode;return Kt(d)&&d(c),c}function Vn(t,e){return lT(1,Qt(t)?"":t,null,16,e,null,null,null)}function qg(t){var e=t.props;if(e){var n=t.flags;n&481&&(e.children!==void 0&&Qt(t.children)&&TH(t,e.children),e.className!==void 0&&(t.className=e.className||null,e.className=void 0)),e.key!==void 0&&(t.key=e.key,e.key=void 0),e.ref!==void 0&&(n&8?t.ref=Vg(t.ref,e.ref):t.ref=e.ref,e.ref=void 0)}return t}function yi(t){var e,n=t.flags;if(n&14){var r,i=t.props;if(!Un(i)){r={};for(var s in i)r[s]=i[s]}e=Pe(n,t.type,r,t.key,t.ref)}else n&481?e=D(n,t.type,t.className,t.children,t.childFlags,t.props,t.key,t.ref):n&16?e=Vn(t.children,t.key):n&1024&&(e=t);return e}function kH(){return Vn("",null)}function PH(t,e,n,r){for(var i=t.length;n<i;n++){var s=t[n];if(!zc(s)){var o=r+fg+n;if(j0(s))PH(s,e,0,o);else{if(aT(s))s=Vn(s,o);else{var a=s.key,l=Zp(a)&&a[0]===fg;(!Un(s.dom)||l)&&(s=yi(s)),Un(a)||l?s.key=o:s.key=r+a}e.push(s)}}}}function TH(t,e){var n,r=1;if(zc(e))n=e;else if(Zp(e))r=2,n=Vn(e);else if(UC(e))r=2,n=Vn(e+"");else if(j0(e)){var i=e.length;if(i===0)n=null,r=1;else{(Object.isFrozen(e)||e.$===!0)&&(e=e.slice()),r=8;for(var s=0;s<i;s++){var o=e[s];if(zc(o)||j0(o)){n=n||e.slice(0,s),PH(e,n,s,"");break}else if(aT(o))n=n||e.slice(0,s),n.push(Vn(o,fg+s));else{var a=o.key,l=Un(o.dom),c=Un(a),d=!c&&Zp(a)&&a[0]===fg;!l||c||d?(n=n||e.slice(0,s),(!l||d)&&(o=yi(o)),(c||d)&&(o.key=fg+s),n.push(o)):n&&n.push(o)}}n=n||e,n.$=!0}}else n=e,Un(e.dom)||(n=yi(e)),r=2;return t.children=n,t.childFlags=r,t}var $o={afterRender:null,beforeRender:null,createVNode:null,renderComplete:null},Fu="http://www.w3.org/1999/xlink",SE="http://www.w3.org/XML/1998/namespace",Xfe="http://www.w3.org/2000/svg",xD={"xlink:actuate":Fu,"xlink:arcrole":Fu,"xlink:href":Fu,"xlink:role":Fu,"xlink:show":Fu,"xlink:title":Fu,"xlink:type":Fu,"xml:base":SE,"xml:lang":SE,"xml:space":SE},Kr={},Da=[];function N_(t,e){t.appendChild(e)}function dx(t,e,n){Qt(n)?N_(t,e):t.insertBefore(e,n)}function Qfe(t,e){return e?document.createElementNS(Xfe,t):document.createElement(t)}function cT(t,e,n){t.replaceChild(e,n)}function Zfe(t,e){t.removeChild(e)}function uT(t){for(var e;(e=t.shift())!==void 0;)e()}var hx={},CE={};function NH(t,e,n){var r=hx[t],i=n.$EV;e?(r||(CE[t]=nme(t),hx[t]=0),i||(i=n.$EV={}),i[t]||hx[t]++,i[t]=e):i&&i[t]&&(hx[t]--,r===1&&(document.removeEventListener(OH(t),CE[t]),CE[t]=null),i[t]=e)}function Jfe(t){return Kt(t.composedPath)?t.composedPath()[0]:t.target}function eme(t,e,n,r){for(var i=Jfe(t);!Un(i);){if(e&&i.disabled)return;var s=i.$EV;if(s){var o=s[n];if(o&&(r.dom=i,o.event?o.event(o.data,t):o(t),t.cancelBubble))return}i=i.parentNode}}function OH(t){return t.substr(2).toLowerCase()}function tme(){this.cancelBubble=!0,this.immediatePropagationStopped||this.stopImmediatePropagation()}function nme(t){var e=function(r){var i=r.type,s=i==="click"||i==="dblclick";if(s&&r.button!==0)return r.stopPropagation(),!1;r.stopPropagation=tme;var o={dom:document};Object.defineProperty(r,"currentTarget",{configurable:!0,get:function(){return o.dom}}),eme(r,s,t,o)};return document.addEventListener(OH(t),e),e}function RH(t,e){var n=document.createElement("i");return n.innerHTML=e,n.innerHTML===t.innerHTML}function rme(t,e){return!!(e&&e.dangerouslySetInnerHTML&&e.dangerouslySetInnerHTML.__html&&RH(t,e.dangerouslySetInnerHTML.__html))}function bD(t,e,n){if(t[e]){var r=t[e];r.event?r.event(r.data,n):r(n)}else{var i=e.toLowerCase();t[i]&&t[i](n)}}function ey(t,e){var n=function(i){i.stopPropagation();var s=this.$V;if(s){var o=s.props||Kr,a=s.dom;if(Zp(t))bD(o,t,i);else for(var l=0;l<t.length;l++)bD(o,t[l],i);if(Kt(e)){var c=this.$V,d=c.props||Kr;e(d,a,!1,c)}}};return Object.defineProperty(n,"wrapped",{configurable:!1,enumerable:!1,value:!0,writable:!1}),n}function dT(t){return t==="checkbox"||t==="radio"}var ime=ey("onInput",hT),sme=ey(["onClick","onChange"],hT);function AH(t){t.stopPropagation()}AH.wrapped=!0;function ome(t,e){dT(e.type)?(t.onchange=sme,t.onclick=AH):t.oninput=ime}function hT(t,e){var n=t.type,r=t.value,i=t.checked,s=t.multiple,o=t.defaultValue,a=!Qt(r);n&&n!==e.type&&e.setAttribute("type",n),!Qt(s)&&s!==e.multiple&&(e.multiple=s),!Qt(o)&&!a&&(e.defaultValue=o+""),dT(n)?(a&&(e.value=r),Qt(i)||(e.checked=i)):a&&e.value!==r?(e.defaultValue=r,e.value=r):Qt(i)||(e.checked=i)}function wD(t,e){var n=t.type;if(n==="optgroup"){var r=t.children,i=t.childFlags;if(i&12)for(var s=0,o=r.length;s<o;s++)jE(r[s],e);else i===2&&jE(r,e)}else jE(t,e)}function jE(t,e){var n=t.props||Kr,r=t.dom;r.value=n.value,j0(e)&&e.indexOf(n.value)!==-1||n.value===e?r.selected=!0:(!Qt(e)||!Qt(n.selected))&&(r.selected=n.selected||!1)}var ame=ey("onChange",IH);function lme(t){t.onchange=ame}function IH(t,e,n,r){var i=!!t.multiple;!Qt(t.multiple)&&i!==e.multiple&&(e.multiple=i);var s=r.childFlags;if(!(s&1)){var o=r.children,a=t.value;if(n&&Qt(a)&&(a=t.defaultValue),s&12)for(var l=0,c=o.length;l<c;l++)wD(o[l],a);else s===2&&wD(o,a)}}var cme=ey("onInput",DH),ume=ey("onChange");function dme(t,e){t.oninput=cme,e.onChange&&(t.onchange=ume)}function DH(t,e,n){var r=t.value,i=e.value;if(Qt(r)){if(n){var s=t.defaultValue;!Qt(s)&&s!==i&&(e.defaultValue=s,e.value=s)}}else i!==r&&(e.defaultValue=r,e.value=r)}function $H(t,e,n,r,i,s){t&64?hT(r,n):t&256?IH(r,n,i,e):t&128&&DH(r,n,i),s&&(n.$V=e)}function hme(t,e,n){t&64?ome(e,n):t&256?lme(e):t&128&&dme(e,n)}function MH(t){return t.type&&dT(t.type)?!Qt(t.checked):!Qt(t.value)}function Ws(t,e){wd(t),e&&t.dom&&(Zfe(e,t.dom),t.dom=null)}function wd(t){var e=t.flags;if(e&481){var n=t.ref,r=t.props;Kt(n)&&n(null);var i=t.children,s=t.childFlags;if(s&12?pT(i):s===2&&wd(i),!Un(r))for(var o in r)switch(o){case"onClick":case"onDblClick":case"onFocusIn":case"onFocusOut":case"onKeyDown":case"onKeyPress":case"onKeyUp":case"onMouseDown":case"onMouseMove":case"onMouseUp":case"onSubmit":case"onTouchEnd":case"onTouchMove":case"onTouchStart":NH(o,null,t.dom);break}}else{var a=t.children;if(a)if(e&14){var l=t.ref;e&4?(Kt(a.componentWillUnmount)&&a.componentWillUnmount(),Kt(l)&&l(null),a.$UN=!0,a.$LI&&wd(a.$LI)):(!Qt(l)&&Kt(l.onComponentWillUnmount)&&l.onComponentWillUnmount(t.dom,t.props||Kr),wd(a))}else e&1024&&Ws(a,t.type)}}function pT(t){for(var e=0,n=t.length;e<n;e++)wd(t[e])}function $b(t,e){pT(e),t.textContent=""}function pme(t,e){return function(n){t(e.data,n)}}function fme(t,e,n){var r=t.toLowerCase();if(!Kt(e)&&!Qt(e)){var i=e.event;i&&Kt(i)&&(n[r]=pme(i,e))}else{var s=n[r];(!s||!s.wrapped)&&(n[r]=e)}}function _D(t,e){switch(t){case"animationIterationCount":case"borderImageOutset":case"borderImageSlice":case"borderImageWidth":case"boxFlex":case"boxFlexGroup":case"boxOrdinalGroup":case"columnCount":case"fillOpacity":case"flex":case"flexGrow":case"flexNegative":case"flexOrder":case"flexPositive":case"flexShrink":case"floodOpacity":case"fontWeight":case"gridColumn":case"gridRow":case"lineClamp":case"lineHeight":case"opacity":case"order":case"orphans":case"stopOpacity":case"strokeDasharray":case"strokeDashoffset":case"strokeMiterlimit":case"strokeOpacity":case"strokeWidth":case"tabSize":case"widows":case"zIndex":case"zoom":return e;default:return e+"px"}}function mme(t,e,n){var r=n.style,i,s;if(Zp(e)){r.cssText=e;return}if(!Qt(t)&&!Zp(t)){for(i in e)s=e[i],s!==t[i]&&(r[i]=UC(s)?_D(i,s):s);for(i in t)Qt(e[i])&&(r[i]="")}else for(i in e)s=e[i],r[i]=UC(s)?_D(i,s):s}function VC(t,e,n,r,i,s,o){switch(t){case"onClick":case"onDblClick":case"onFocusIn":case"onFocusOut":case"onKeyDown":case"onKeyPress":case"onKeyUp":case"onMouseDown":case"onMouseMove":case"onMouseUp":case"onSubmit":case"onTouchEnd":case"onTouchMove":case"onTouchStart":NH(t,n,r);break;case"children":case"childrenType":case"className":case"defaultValue":case"key":case"multiple":case"ref":break;case"autoFocus":r.autofocus=!!n;break;case"allowfullscreen":case"autoplay":case"capture":case"checked":case"controls":case"default":case"disabled":case"hidden":case"indeterminate":case"loop":case"muted":case"novalidate":case"open":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"selected":r[t]=!!n;break;case"defaultChecked":case"value":case"volume":if(s&&t==="value")return;var a=Qt(n)?"":n;r[t]!==a&&(r[t]=a);break;case"dangerouslySetInnerHTML":var l=e&&e.__html||"",c=n&&n.__html||"";l!==c&&!Qt(c)&&!RH(r,c)&&(Un(o)||(o.childFlags&12?pT(o.children):o.childFlags===2&&wd(o.children),o.children=null,o.childFlags=1),r.innerHTML=c);break;default:t[0]==="o"&&t[1]==="n"?fme(t,n,r):Qt(n)?r.removeAttribute(t):t==="style"?mme(e,n,r):i&&xD[t]?r.setAttributeNS(xD[t],t,n):r.setAttribute(t,n);break}}function LH(t,e,n,r,i){var s=!1,o=(e&448)>0;o&&(s=MH(n),s&&hme(e,r,n));for(var a in n)VC(a,null,n[a],r,i,s,null);o&&$H(e,t,r,n,!0,s)}function BH(t,e,n,r){var i=new e(n,r);if(t.children=i,i.$V=t,i.$BS=!1,i.context=r,i.props===Kr&&(i.props=n),i.$UN=!1,Kt(i.componentWillMount)){if(i.$BR=!0,i.componentWillMount(),i.$PSS){var s=i.state,o=i.$PS;if(Un(s))i.state=o;else for(var a in o)s[a]=o[a];i.$PSS=!1,i.$PS=null}i.$BR=!1}Kt($o.beforeRender)&&$o.beforeRender(i);var l=ty(i.render(n,i.state,r),t),c;return Kt(i.getChildContext)&&(c=i.getChildContext()),Qt(c)?i.$CX=r:i.$CX=Vg(r,c),Kt($o.afterRender)&&$o.afterRender(i),i.$LI=l,i}function ty(t,e){return zc(t)?t=kH():aT(t)?t=Vn(t,null):(t.dom&&(t=yi(t)),t.flags&14&&(t.parentVNode=e)),t}function Ui(t,e,n,r){var i=t.flags;if(i&481)return FH(t,e,n,r);if(i&14)return gme(t,e,n,r,(i&4)>0);if(i&512||i&16)return qC(t,e);if(i&1024)return Ui(t.children,t.type,n,!1),t.dom=qC(kH(),e)}function qC(t,e){var n=t.dom=document.createTextNode(t.children);return Un(e)||N_(e,n),n}function FH(t,e,n,r){var i=t.flags,s=t.children,o=t.props,a=t.className,l=t.ref,c=t.childFlags;r=r||(i&32)>0;var d=Qfe(t.type,r);if(t.dom=d,!Qt(a)&&a!==""&&(r?d.setAttribute("class",a):d.className=a),Un(e)||N_(e,d),!(c&1)){var h=r===!0&&t.type!=="foreignObject";c===2?Ui(s,d,n,h):c&12&&mg(s,d,n,h)}return Un(o)||LH(t,i,o,d,r),Kt(l)&&fT(d,l),d}function mg(t,e,n,r){for(var i=0,s=t.length;i<s;i++){var o=t[i];Un(o.dom)||(t[i]=o=yi(o)),Ui(o,e,n,r)}}function gme(t,e,n,r,i){var s,o=t.type,a=t.props||Kr,l=t.ref;if(i){var c=BH(t,o,a,n);t.dom=s=Ui(c.$LI,null,c.$CX,r),zH(t,l,c),c.$UPD=!1}else{var d=ty(o(a,n),t);t.children=d,t.dom=s=Ui(d,null,n,r),HH(a,l,s)}return Un(e)||N_(e,s),s}function vme(t){return function(){t.$UPD=!0,t.componentDidMount(),t.$UPD=!1}}function zH(t,e,n){Kt(e)&&e(n),Kt(n.componentDidMount)&&Da.push(vme(n))}function yme(t,e,n){return function(){return t.onComponentDidMount(e,n)}}function HH(t,e,n){Qt(e)||(Kt(e.onComponentWillMount)&&e.onComponentWillMount(t),Kt(e.onComponentDidMount)&&Da.push(yme(e,n,t)))}function fT(t,e){Da.push(function(){return e(t)})}function xme(t,e,n,r,i){var s=t.type,o=t.ref,a=t.props||Kr;if(i){var l=BH(t,s,a,n),c=l.$LI;Wg(c,e,l.$CX,r),t.dom=c.dom,zH(t,o,l),l.$UPD=!1}else{var d=ty(s(a,n),t);Wg(d,e,n,r),t.children=d,t.dom=d.dom,HH(a,o,e)}}function bme(t,e,n,r){var i=t.children,s=t.props,o=t.className,a=t.flags,l=t.ref;if(r=r||(a&32)>0,e.nodeType!==1||e.tagName.toLowerCase()!==t.type){var c=FH(t,null,n,r);t.dom=c,cT(e.parentNode,c,e)}else{t.dom=e;var d=e.firstChild,h=t.childFlags;if(h&1)!Un(e.firstChild)&&!rme(e,s)&&(e.textContent="",a&448&&(e.defaultValue=""));else{for(var p=null;d;)p=d.nextSibling,d.nodeType===8&&(d.data==="!"?e.replaceChild(document.createTextNode(""),d):e.removeChild(d)),d=p;if(d=e.firstChild,h===2)Un(d)?Ui(i,e,n,r):(p=d.nextSibling,Wg(i,d,n,r),d=p);else if(h&12)for(var f=0,m=i.length;f<m;f++){var g=i[f];Un(d)?Ui(g,e,n,r):(p=d.nextSibling,Wg(g,d,n,r),d=p)}for(;d;)p=d.nextSibling,e.removeChild(d),d=p}Un(s)||LH(t,a,s,e,r),Qt(o)?e.className!==""&&e.removeAttribute("class"):r?e.setAttribute("class",o):e.className=o,Kt(l)&&fT(e,l)}}function wme(t,e){if(e.nodeType!==3){var n=qC(t,null);t.dom=n,cT(e.parentNode,n,e)}else{var r=t.children;e.nodeValue!==r&&(e.nodeValue=r),t.dom=e}}function Wg(t,e,n,r){var i=t.flags;i&14?xme(t,e,n,r,(i&4)>0):i&481?bme(t,e,n,r):i&16?wme(t,e):i&512?t.dom=e:Yfe()}function _me(t,e,n){var r=e.firstChild;if(!Un(r))for(zc(t)||Wg(t,r,Kr,!1),r=e.firstChild;r=r.nextSibling;)e.removeChild(r);Da.length>0&&uT(Da),e.$V=t,Kt(n)&&n()}function mT(t,e,n,r,i){wd(t),cT(n,Ui(e,null,r,i),t.dom)}function hl(t,e,n,r,i){var s=e.flags|0;t.flags!==s||s&2048?mT(t,e,n,r,i):s&481?Cme(t,e,n,r,i,s):s&14?jme(t,e,n,r,i,(s&4)>0):s&16?kme(t,e):s&512?e.dom=t.dom:Sme(t,e,r)}function Eme(t,e){t.textContent!==e.children&&(t.textContent=e.children)}function Sme(t,e,n){var r=t.type,i=e.type,s=e.children;if(UH(t.childFlags,e.childFlags,t.children,s,r,n,!1),e.dom=t.dom,r!==i&&!zc(s)){var o=s.dom;r.removeChild(o),i.appendChild(o)}}function Cme(t,e,n,r,i,s){var o=e.type;if(t.type!==o)mT(t,e,n,r,i);else{var a=t.dom,l=t.props,c=e.props,d=!1,h=!1,p;if(e.dom=a,i=i||(s&32)>0,l!==c){var f=l||Kr;if(p=c||Kr,p!==Kr){d=(s&448)>0,d&&(h=MH(p));for(var m in p){var g=f[m],v=p[m];g!==v&&VC(m,g,v,a,i,h,t)}}if(f!==Kr)for(var b in f)!p.hasOwnProperty(b)&&!Qt(f[b])&&VC(b,f[b],null,a,i,h,t)}var x=t.children,y=e.children,w=e.ref,E=t.className,S=e.className;s&4096?Eme(a,y):UH(t.childFlags,e.childFlags,x,y,a,r,i&&o!=="foreignObject"),d&&$H(s,e,a,p,!1,h),E!==S&&(Qt(S)?a.removeAttribute("class"):i?a.setAttribute("class",S):a.className=S),Kt(w)&&t.ref!==w&&fT(a,w)}}function UH(t,e,n,r,i,s,o){switch(t){case 2:switch(e){case 2:hl(n,r,i,s,o);break;case 1:Ws(n,i);break;default:Ws(n,i),mg(r,i,s,o);break}break;case 1:switch(e){case 2:Ui(r,i,s,o);break;case 1:break;default:mg(r,i,s,o);break}break;default:if(e&12){var a=n.length,l=r.length;a===0?l>0&&mg(r,i,s,o):l===0?$b(i,n):e===8&&t===8?Tme(n,r,i,s,o,a,l):Pme(n,r,i,s,o,a,l)}else e===1?$b(i,n):e===2&&($b(i,n),Ui(r,i,s,o));break}}function VH(t,e,n,r,i,s,o,a,l){var c=t.state,d=t.props;n.children=t;var h;if(!t.$UN){if(d!==r||r===Kr){if(!l&&Kt(t.componentWillReceiveProps)){if(t.$BR=!0,t.componentWillReceiveProps(r,s),t.$UN)return;t.$BR=!1}t.$PSS&&(e=Vg(e,t.$PS),t.$PSS=!1,t.$PS=null)}var p=!!t.shouldComponentUpdate;if(a||!p||p&&t.shouldComponentUpdate(r,e,s)){Kt(t.componentWillUpdate)&&(t.$BS=!0,t.componentWillUpdate(r,e,s),t.$BS=!1),t.props=r,t.state=e,t.context=s,Kt($o.beforeRender)&&$o.beforeRender(t),h=t.render(r,e,s),Kt($o.afterRender)&&$o.afterRender(t);var f=h!==oT,m;if(Kt(t.getChildContext)&&(m=t.getChildContext()),Qt(m)?m=s:m=Vg(s,m),t.$CX=m,f){var g=t.$LI,v=ty(h,n);hl(g,v,i,m,o),t.$LI=v,Kt(t.componentDidUpdate)&&t.componentDidUpdate(d,c)}}else t.props=r,t.state=e,t.context=s;n.dom=t.$LI.dom}}function jme(t,e,n,r,i,s){var o=e.type,a=t.key,l=e.key;if(t.type!==o||a!==l)mT(t,e,n,r,i);else{var c=e.props||Kr;if(s){var d=t.children;d.$UPD=!0,d.$V=e,VH(d,d.state,e,c,n,r,i,!1,!1),d.$UPD=!1}else{var h=!0,p=t.props,f=e.ref,m=!Qt(f),g=t.children;if(e.dom=t.dom,e.children=g,m&&Kt(f.onComponentShouldUpdate)&&(h=f.onComponentShouldUpdate(p,c)),h!==!1){m&&Kt(f.onComponentWillUpdate)&&f.onComponentWillUpdate(p,c);var v=o(c,r);v!==oT&&(v=ty(v,e),hl(g,v,n,r,i),e.children=v,e.dom=v.dom,m&&Kt(f.onComponentDidUpdate)&&f.onComponentDidUpdate(p,c))}else g.flags&14&&(g.parentVNode=e)}}}function kme(t,e){var n=e.children,r=t.dom;n!==t.children&&(r.nodeValue=n),e.dom=r}function Pme(t,e,n,r,i,s,o){for(var a=s>o?o:s,l=0,c,d;l<a;l++)c=e[l],d=t[l],c.dom&&(c=e[l]=yi(c)),hl(d,c,n,r,i),t[l]=c;if(s<o)for(l=a;l<o;l++)c=e[l],c.dom&&(c=e[l]=yi(c)),Ui(c,n,r,i);else if(s>o)for(l=a;l<s;l++)Ws(t[l],n)}function Tme(t,e,n,r,i,s,o){var a=s-1,l=o-1,c,d=0,h=t[d],p=e[d],f;e:{for(;h.key===p.key;){if(p.dom&&(e[d]=p=yi(p)),hl(h,p,n,r,i),t[d]=p,d++,d>a||d>l)break e;h=t[d],p=e[d]}for(h=t[a],p=e[l];h.key===p.key;){if(p.dom&&(e[l]=p=yi(p)),hl(h,p,n,r,i),t[a]=p,a--,l--,d>a||d>l)break e;h=t[a],p=e[l]}}if(d>a){if(d<=l){f=l+1;for(var m=f<o?e[f].dom:null;d<=l;)p=e[d],p.dom&&(e[d]=p=yi(p)),d++,dx(n,Ui(p,null,r,i),m)}}else if(d>l)for(;d<=a;)Ws(t[d++],n);else{var g=d,v=d,b=a-d+1,x=l-d+1,y=[];for(c=0;c<x;c++)y.push(0);var w=b===s,E=!1,S=0,j=0;if(o<4||(b|x)<32)for(c=g;c<=a;c++)if(h=t[c],j<x){for(d=v;d<=l;d++)if(p=e[d],h.key===p.key){if(y[d-v]=c+1,w)for(w=!1;c>g;)Ws(t[g++],n);S>d?E=!0:S=d,p.dom&&(e[d]=p=yi(p)),hl(h,p,n,r,i),j++;break}!w&&d>l&&Ws(h,n)}else w||Ws(h,n);else{var C={};for(c=v;c<=l;c++)C[e[c].key]=c;for(c=g;c<=a;c++)if(h=t[c],j<x)if(d=C[h.key],d!==void 0){if(w)for(w=!1;c>g;)Ws(t[g++],n);p=e[d],y[d-v]=c+1,S>d?E=!0:S=d,p.dom&&(e[d]=p=yi(p)),hl(h,p,n,r,i),j++}else w||Ws(h,n);else w||Ws(h,n)}if(w)$b(n,t),mg(e,n,r,i);else if(E){var P=Nme(y);for(d=P.length-1,c=x-1;c>=0;c--)y[c]===0?(S=c+v,p=e[S],p.dom&&(e[S]=p=yi(p)),f=S+1,dx(n,Ui(p,null,r,i),f<o?e[f].dom:null)):d<0||c!==P[d]?(S=c+v,p=e[S],f=S+1,dx(n,p.dom,f<o?e[f].dom:null)):d--}else if(j!==x)for(c=x-1;c>=0;c--)y[c]===0&&(S=c+v,p=e[S],p.dom&&(e[S]=p=yi(p)),f=S+1,dx(n,Ui(p,null,r,i),f<o?e[f].dom:null))}}function Nme(t){var e=t.slice(),n=[0],r,i,s,o,a,l=t.length;for(r=0;r<l;r++){var c=t[r];if(c!==0){if(i=n[n.length-1],t[i]<c){e[r]=i,n.push(r);continue}for(s=0,o=n.length-1;s<o;)a=(s+o)/2|0,t[n[a]]<c?s=a+1:o=a;c<t[n[s]]&&(s>0&&(e[r]=n[s-1]),n[s]=r)}}for(s=n.length,o=n[s-1];s-- >0;)n[s]=o,o=e[o];return n}function P0(t,e,n){if(t!==oT){var r=e.$V;if(Qt(r)?zc(t)||(t.dom&&(t=yi(t)),Un(e.firstChild)?(Ui(t,e,Kr,!1),e.$V=t):_me(t,e),r=t):Qt(t)?(Ws(r,e),e.$V=null):(t.dom&&(t=yi(t)),hl(r,t,e,Kr,!1),r=e.$V=t),Da.length>0&&uT(Da),Kt(n)&&n(),Kt($o.renderComplete)&&$o.renderComplete(r),r&&r.flags&14)return r.children}}function Ome(t,e){return D(1024,e,null,t,0,null,zc(t)?null:t.key,null)}var ED=typeof Promise>"u"?null:Promise.resolve(),Rme=typeof requestAnimationFrame>"u"?setTimeout:requestAnimationFrame.bind(window);function Ame(t){return ED?ED.then(t):Rme(t)}function SD(t,e,n,r){Kt(e)&&(e=e(t.state,t.props,t.context));var i=t.$PS;if(Qt(i))t.$PS=e;else for(var s in e)i[s]=e[s];if(!t.$PSS&&!t.$BR)if(!t.$UPD)t.$PSS=!0,t.$UPD=!0,qH(t,r,n),t.$UPD=!1;else{var o=t.$QU;Un(o)&&(o=t.$QU=[],Ame(Ime(t,o))),Kt(n)&&o.push(n)}else t.$PSS=!0,t.$BR&&Kt(n)&&Da.push(n.bind(t))}function Ime(t,e){return function(){t.$QU=null,t.$UPD=!0,qH(t,!1,function(){for(var n=0,r=e.length;n<r;n++)e[n].call(t)}),t.$UPD=!1}}function qH(t,e,n){if(!t.$UN){if(e||!t.$BR){t.$PSS=!1;var r=t.$PS,i=t.state,s=Vg(i,r),o=t.props,a=t.context;t.$PS=null;var l=t.$V,c=t.$LI,d=c.dom&&c.dom.parentNode;if(VH(t,s,l,o,d,a,(l.flags&32)>0,e,!0),t.$UN)return;if(!(t.$LI.flags&1024))for(var h=t.$LI.dom;!Un(l=l.parentVNode);)(l.flags&14)>0&&(l.dom=h);Da.length>0&&uT(Da)}else t.state=t.$PS,t.$PS=null;Kt(n)&&n.call(t)}}var Ve=function(){function t(n,r){this.state=null,this.props=void 0,this.context=void 0,this.refs=void 0,this.$BR=!1,this.$BS=!0,this.$PSS=!1,this.$PS=null,this.$LI=null,this.$V=null,this.$UN=!1,this.$CX=null,this.$UPD=!0,this.$QU=null,this.props=n||Kr,this.context=r||Kr}var e=t.prototype;return e.forceUpdate=function(r){this.$UN||SD(this,{},r,!0)},e.setState=function(r,i){if(!this.$UN)if(!this.$BS)SD(this,r,i,!1);else return},e.render=function(r,i,s){},t}();Ve.defaultProps=void 0;var WH='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14.02 5.57" width="53" height="21" style="vertical-align:middle"><path fill="#000000" d="M1.88.92v.14c0 .41-.13.68-.4.8.33.14.46.44.46.86v.33c0 .61-.33.95-.95.95H0V0h.95c.65 0 .93.3.93.92zM.63.57v1.06h.24c.24 0 .38-.1.38-.43V.98c0-.28-.1-.4-.32-.4zm0 1.63v1.22h.36c.2 0 .32-.1.32-.39v-.35c0-.37-.12-.48-.4-.48H.63zM4.18.99v.52c0 .64-.31.98-.94.98h-.3V4h-.62V0h.92c.63 0 .94.35.94.99zM2.94.57v1.35h.3c.2 0 .3-.09.3-.37v-.6c0-.29-.1-.38-.3-.38h-.3zm2.89 2.27L6.25 0h.88v4h-.6V1.12L6.1 3.99h-.6l-.46-2.82v2.82h-.55V0h.87zM8.14 1.1V4h-.56V0h.79L9 2.4V0h.56v4h-.64zm2.49 2.29v.6h-.6v-.6zM12.12 1c0-.63.33-1 .95-1 .61 0 .95.37.95 1v2.04c0 .64-.34 1-.95 1-.62 0-.95-.37-.95-1zm.62 2.08c0 .28.13.39.33.39s.32-.1.32-.4V.98c0-.29-.12-.4-.32-.4s-.33.11-.33.4z"/><path fill="#000000" d="M0 4.53h14.02v1.04H0zM11.08 0h.63v.62h-.63zm.63 4V1h-.63v2.98z"/></svg>';function GH(t){var e='<a href="http://bpmn.io" target="_blank" class="bjs-powered-by" title="Powered by bpmn.io" style="position: absolute; bottom: 15px; right: 15px; z-index: 100;">'+WH+"</a>",n=bt(e);t.appendChild(n),ie.bind(n,"click",function(r){Bme(),r.preventDefault()})}class KH extends Ve{constructor(e,n){super(e,n),this.node=null}componentDidMount(){GH(this.node)}render(){return D(1,"div",null,null,1,null,null,e=>this.node=e)}}function gT(t){return t.join(";")}var Dme=gT(["z-index: 1001","position: fixed","top: 0","left: 0","right: 0","bottom: 0"]),$me=gT(["width: 100%","height: 100%","background: rgba(40,40,40,0.2)"]),Mme=gT(["position: absolute","left: 50%","top: 40%","transform: translate(-50%)","width: 260px","padding: 10px","background: white","box-shadow: 0 1px 4px rgba(0,0,0,0.3)","font-family: Helvetica, Arial, sans-serif","font-size: 14px","display: flex","line-height: 1.3"]),Lme='<div class="bjs-powered-by-lightbox" style="'+Dme+'"><div class="backdrop" style="'+$me+'"></div><div class="notice" style="'+Mme+'"><a href="https://bpmn.io" target="_blank" rel="noopener" style="margin: 15px 20px 15px 10px; align-self: center;">'+WH+'</a><span>Web-based tooling for BPMN, DMN and CMMN diagrams powered by <a href="https://bpmn.io" target="_blank" rel="noopener">bpmn.io</a>.</span></div></div>',km;function Bme(){km||(km=bt(Lme),Zn.bind(km,".backdrop","click",function(t){document.body.removeChild(km)})),document.body.appendChild(km)}var Fme=new wk,px="hsl(225, 10%, 15%)";function vT(t,e,n,r,i,s){Fo.call(this,e);var o=Fme.next(),a=r.computeStyle,l={},c=t&&t.defaultFillColor||"white",d=t&&t.defaultStrokeColor||px,h=t&&t.defaultLabelColor;function p(j,C,P){var R=j+"-"+jD(C)+"-"+jD(P)+"-"+o;return l[R]||m(R,j,C,P),"url(#"+R+")"}function f(j,C){var P=B({strokeWidth:1,strokeLinecap:"round",strokeDasharray:"none"},C.attrs),R=C.ref||{x:0,y:0},N=C.scale||1;P.strokeDasharray==="none"&&(P.strokeDasharray=[1e4,1]);var I=ee("marker");K(C.element,P),re(I,C.element),K(I,{id:j,viewBox:"0 0 20 20",refX:R.x,refY:R.y,markerWidth:20*N,markerHeight:20*N,orient:"auto"});var M=at("defs",s._svg);M||(M=ee("defs"),re(s._svg,M)),re(M,I),l[j]=I}function m(j,C,P,R){if(C==="association-start"){var N=ee("path");K(N,{d:"M 11 5 L 1 10 L 11 15"}),f(j,{element:N,attrs:{fill:"none",stroke:R,strokeWidth:1.5},ref:{x:1,y:10},scale:.5})}else if(C==="association-end"){var I=ee("path");K(I,{d:"M 1 5 L 11 10 L 1 15"}),f(j,{element:I,attrs:{fill:"none",stroke:R,strokeWidth:1.5},ref:{x:12,y:10},scale:.5})}else if(C==="information-requirement-end"){var M=ee("path");K(M,{d:"M 1 5 L 11 10 L 1 15 Z"}),f(j,{element:M,attrs:{fill:R,stroke:"none"},ref:{x:11,y:10},scale:1})}else if(C==="knowledge-requirement-end"){var W=ee("path");K(W,{d:"M 1 3 L 11 10 L 1 17"}),f(j,{element:W,attrs:{fill:"none",stroke:R,strokeWidth:2},ref:{x:11,y:10},scale:.8})}else if(C==="authority-requirement-end"){var ce=ee("circle");K(ce,{cx:3,cy:3,r:3}),f(j,{element:ce,attrs:{fill:R,stroke:"none"},ref:{x:3,y:3},scale:.9})}}function g(j,C,P,R,N,I){Wn(N)&&(I=N,N=0),N=N||0,I=a(I,{stroke:px,strokeWidth:2,fill:"white"});var M=ee("rect");return K(M,{x:N,y:N,width:C-N*2,height:P-N*2,rx:R,ry:R}),K(M,I),re(j,M),M}function v(j,C,P){var R=i.createText(C||"",P);return vn(R,"class","djs-label"),re(j,R),R}function b(j,C,P,R){var N=ofe(C);return R=B({box:C,align:P,padding:5,style:{fill:kD(C,h,d)}},R),v(j,N,R)}function x(j,C,P){P=a(P,["no-fill"],{strokeWidth:2,stroke:px});var R=ee("path");return K(R,{d:C}),K(R,P),re(j,R),R}var y={"dmn:Decision":function(C,P){var R=g(C,P.width,P.height,0,{stroke:pa(P,d),fill:cc(P,c)});return b(C,P,"center-middle"),R},"dmn:KnowledgeSource":function(C,P){var R=n.getScaledPath("KNOWLEDGE_SOURCE",{xScaleFactor:1.021,yScaleFactor:1,containerWidth:P.width,containerHeight:P.height,position:{mx:0,my:.075}}),N=x(C,R,{strokeWidth:2,fill:cc(P,c),stroke:pa(P,d)});return b(C,P,"center-middle"),N},"dmn:BusinessKnowledgeModel":function(C,P){var R=n.getScaledPath("BUSINESS_KNOWLEDGE_MODEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:P.width,containerHeight:P.height,position:{mx:0,my:.3}}),N=x(C,R,{strokeWidth:2,fill:cc(P,c),stroke:pa(P,d)});return b(C,P,"center-middle"),N},"dmn:InputData":function(C,P){var R=g(C,P.width,P.height,22,{stroke:pa(P,d),fill:cc(P,c)});return b(C,P,"center-middle"),R},"dmn:TextAnnotation":function(C,P){var R={fill:"none",stroke:"none"},N=g(C,P.width,P.height,0,0,R),I=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:P.width,containerHeight:P.height,position:{mx:0,my:0}});x(C,I,{stroke:pa(P,d)});var M=CD(P).text||"";return v(C,M,{style:{fill:kD(P,h,d)},box:P,align:"left-top",padding:5}),N},"dmn:Association":function(C,P){var R=CD(P),N=cc(P,c),I=pa(P,d),M={stroke:I,strokeDasharray:"0.5, 5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"};return(R.associationDirection==="One"||R.associationDirection==="Both")&&(M.markerEnd=p("association-end",N,I)),R.associationDirection==="Both"&&(M.markerStart=p("association-start",N,I)),S(C,P.waypoints,M)},"dmn:InformationRequirement":function(C,P){var R=cc(P,c),N=pa(P,d),I={stroke:N,strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round",markerEnd:p("information-requirement-end",R,N)};return S(C,P.waypoints,I)},"dmn:KnowledgeRequirement":function(C,P){var R=cc(P,c),N=pa(P,d),I={stroke:N,strokeWidth:1,strokeDasharray:5,strokeLinecap:"round",strokeLinejoin:"round",markerEnd:p("knowledge-requirement-end",R,N)};return S(C,P.waypoints,I)},"dmn:AuthorityRequirement":function(C,P){var R=cc(P,c),N=pa(P,d),I={stroke:N,strokeWidth:1.5,strokeDasharray:5,strokeLinecap:"round",strokeLinejoin:"round",markerEnd:p("authority-requirement-end",R,N)};return S(C,P.waypoints,I)}};function w(j,C){var P=y[C.type];return P?P(j,C):Fo.prototype.drawShape.apply(this,[j,C])}function E(j,C){var P=C.type,R=y[P];return R?R(j,C):Fo.prototype.drawConnection.apply(this,[j,C])}function S(j,C,P){P=a(P,["no-fill"],{stroke:px,strokeWidth:2,fill:"none"});var R=P_(C,P);return re(j,R),R}this.canRender=function(j){return Y(j,"dmn:DMNElement")||Y(j,"dmn:InformationRequirement")||Y(j,"dmn:KnowledgeRequirement")||Y(j,"dmn:AuthorityRequirement")},this.drawShape=w,this.drawConnection=E}Ce(vT,Fo);vT.$inject=["config.drdRenderer","eventBus","pathMap","styles","textRenderer","canvas"];function CD(t){return t.businessObject}function jD(t){return t.replace(/[^0-9a-zA-z]+/g,"_")}function pa(t,e){return e}function cc(t,e){return e}function kD(t,e,n){return e||pa(t,n)}var zme=0,Hme={width:150,height:50};function Ume(t){var e=t.split("-");return{horizontal:e[0]||"center",vertical:e[1]||"top"}}function Vme(t){return Wn(t)?B({top:0,left:0,right:0,bottom:0},t):{top:t,left:t,right:t,bottom:t}}function qme(t,e){e.textContent=t;var n;try{var r,i=t==="";return e.textContent=i?"dummy":t,n=e.getBBox(),r={width:n.width+n.x*2,height:n.height},i&&(r.width=0),r}catch{return{width:0,height:0}}}function Wme(t,e,n){for(var r=t.shift(),i=r,s;;){if(s=qme(i,n),s.width=i?s.width:0,i===" "||i===""||s.width<Math.round(e)||i.length<2)return Gme(t,i,r,s);i=Yme(i,s.width,e)}}function Gme(t,e,n,r){if(e.length<n.length){var i=n.slice(e.length).trim();t.unshift(i)}return{width:r.width,height:r.height,text:e}}var PD="";function Kme(t,e){var n=t.split(/(\s|-|\u00AD)/g),r,i=[],s=0;if(n.length>1)for(;r=n.shift();)if(r.length+s<e)i.push(r),s+=r.length;else{(r==="-"||r===PD)&&i.pop();break}var o=i[i.length-1];return o&&o===PD&&(i[i.length-1]="-"),i.join("")}function Yme(t,e,n){var r=Math.max(t.length*(n/e),1),i=Kme(t,r);return i||(i=t.slice(0,Math.max(Math.round(r-1),1))),i}function Xme(){var t=document.getElementById("helper-svg");return t||(t=ee("svg"),K(t,{id:"helper-svg"}),La(t,{visibility:"hidden",position:"fixed",width:0,height:0}),document.body.appendChild(t)),t}function O_(t){this._config=B({},{size:Hme,padding:zme,style:{},align:"center-top"},t||{})}O_.prototype.createText=function(t,e){return this.layoutText(t,e).element};O_.prototype.getDimensions=function(t,e){return this.layoutText(t,e).dimensions};O_.prototype.layoutText=function(t,e){var n=B({},this._config.size,e.box),r=B({},this._config.style,e.style),i=Ume(e.align||this._config.align),s=Vme(e.padding!==void 0?e.padding:this._config.padding),o=e.fitBox||!1,a=Qme(r),l=t.split(/\u00AD?\r?\n/),c=[],d=n.width-s.left-s.right,h=ee("text");K(h,{x:0,y:0}),K(h,r);var p=Xme();for(re(p,h);l.length;)c.push(Wme(l,d,h));i.vertical==="middle"&&(s.top=s.bottom=0);var f=xr(c,function(x,y,w){return x+(a||y.height)},0)+s.top+s.bottom,m=xr(c,function(x,y,w){return y.width>x?y.width:x},0),g=s.top;i.vertical==="middle"&&(g+=(n.height-f)/2),g-=(a||c[0].height)/4;var v=ee("text");K(v,r),$(c,function(x){var y;switch(g+=a||x.height,i.horizontal){case"left":y=s.left;break;case"right":y=(o?m:d)-s.right-x.width;break;default:y=Math.max(((o?m:d)-x.width)/2+s.left,0)}var w=ee("tspan");K(w,{x:y,y:g}),w.textContent=x.text,re(v,w)}),un(h);var b={width:m,height:f};return{dimensions:b,element:v}};function Qme(t){if("fontSize"in t&&"lineHeight"in t)return t.lineHeight*parseInt(t.fontSize,10)}var Zme=12,Jme=1.2,ege=30;function YH(t){var e=B({fontFamily:"Arial, sans-serif",fontSize:Zme,fontWeight:"normal",lineHeight:Jme},t&&t.defaultStyle||{}),n=parseInt(e.fontSize,10)-1,r=B({},e,{fontSize:n},t&&t.externalStyle||{}),i=new O_({style:e});this.getExternalLabelBounds=function(s,o){var a=i.getDimensions(o,{box:{width:90,height:30,x:s.width/2+s.x,y:s.height/2+s.y},style:r});return{x:Math.round(s.x+s.width/2-a.width/2),y:Math.round(s.y),width:Math.ceil(a.width),height:Math.ceil(a.height)}},this.getTextAnnotationBounds=function(s,o){var a=i.getDimensions(o,{box:s,style:e,align:"left-top",padding:5});return{x:s.x,y:s.y,width:s.width,height:Math.max(ege,Math.round(a.height))}},this.createText=function(s,o){return i.createText(s,o||{})},this.getDefaultStyle=function(){return e},this.getExternalStyle=function(){return r}}YH.$inject=["config.textRenderer"];function tge(){this.pathMap={KNOWLEDGE_SOURCE:{d:"m {mx},{my} l 0,{e.y0} c {e.x0},{e.y1} {e.x1},-{e.y2} {e.x2},-{e.y3} c {e.x3},-{e.y4} {e.x4},{e.y5} {e.x5},{e.y6} l 0,-{e.y7}z",width:100,height:65,widthElements:[29.8,48.4,67.2,12.2,19.8,30.8],heightElements:[55.3,19.7,4.2,6.7,2.3,1.6,6.2,54.6]},BUSINESS_KNOWLEDGE_MODEL:{d:"m {mx},{my} l {e.x0},-{e.y0} l {e.x1},0 l 0,{e.y1} l -{e.x2},{e.y2} l -{e.x3},0z",width:125,height:45,widthElements:[13.8,109.2,13.8,109.1],heightElements:[13.2,29.8,13.2]},TEXT_ANNOTATION:{d:"m {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0",width:10,height:30,widthElements:[10],heightElements:[30]}},this.getRawPath=function(e){return this.pathMap[e].d},this.getScaledPath=function(e,n){var r=this.pathMap[e],i,s;n.abspos?(i=n.abspos.x,s=n.abspos.y):(i=n.containerWidth*n.position.mx,s=n.containerHeight*n.position.my);var o={};if(n.position){for(var a=n.containerHeight/r.height*n.yScaleFactor,l=n.containerWidth/r.width*n.xScaleFactor,c=0;c<r.heightElements.length;c++)o["y"+c]=r.heightElements[c]*a;for(var d=0;d<r.widthElements.length;d++)o["x"+d]=r.widthElements[d]*l}var h=sge(r.d,{mx:i,my:s,e:o});return h}}var nge=/\{([^{}]+)\}/g,rge=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g;function ige(t,e,n){var r=n;return e.replace(rge,function(i,s,o,a,l){s=s||a,r&&(s in r&&(r=r[s]),typeof r=="function"&&l&&(r=r()))}),r=(r==null||r==n?t:r)+"",r}function sge(t,e){return String(t).replace(nge,function(n,r){return ige(n,r,e)})}const oge={__init__:["drdRenderer"],drdRenderer:["type",vT],textRenderer:["type",YH],pathMap:["type",tge]};function Jd(t,e,n,r){this._eventBus=t,this._canvas=e,this._elementRegistry=r,this._elementFactory=n}Jd.$inject=["eventBus","canvas","elementFactory","elementRegistry"];Jd.prototype.root=function(t){var e=this._elementFactory.createRoot(WC(t));return this._canvas.setRootElement(e),e};Jd.prototype.add=function(t){var e=this._elementFactory,n=this._canvas,r=this._eventBus,i=t.di,s,o,a,l,c,d;if(i.$instanceOf("dmndi:DMNShape"))d=i.bounds,c=WC(t,{x:Math.round(d.x),y:Math.round(d.y),width:Math.round(d.width),height:Math.round(d.height)}),s=e.createShape(c),n.addShape(s),r.fire("drdElement.added",{element:s,di:i});else if(i.$instanceOf("dmndi:DMNEdge"))o=age(i),a=this._getSource(t),l=this._getTarget(t),a&&l&&(c=WC(t,{hidden:!1,source:a,target:l,waypoints:o}),s=e.createConnection(c),n.addConnection(s),r.fire("drdElement.added",{element:s,di:i}));else throw new Error("unknown di for element "+t.id);return s};Jd.prototype._getSource=function(t){var e,n;if(Y(t,"dmn:Association")?n=t.sourceRef:Y(t,"dmn:InformationRequirement")?n=t.requiredDecision||t.requiredInput:Y(t,"dmn:KnowledgeRequirement")?n=t.requiredKnowledge:Y(t,"dmn:AuthorityRequirement")&&(n=t.requiredDecision||t.requiredInput||t.requiredAuthority),n&&(e=n.href),e)return this._getShape(XH(e))};Jd.prototype._getTarget=function(t){return Y(t,"dmn:Association")?t.targetRef&&this._getShape(XH(t.targetRef.href)):this._getShape(t.$parent.id)};Jd.prototype._getShape=function(t){return this._elementRegistry.get(t)};function WC(t,e){return B({id:t.id,type:t.$type,businessObject:t},e)}function age(t){var e=t.waypoint;if(e)return yr(e,function(n){var r={x:n.x,y:n.y};return B({original:r},r)})}function XH(t){return t.split("#").pop()}const lge={drdImporter:["type",Jd]},cge={__depends__:[oge,lge]};function uge(t,e){return e=e||{},t.replace(/{([^}]+)}/g,function(n,r){return e[r]||"{"+r+"}"})}const ny={translate:["value",uge]};function TD(t){!t||typeof t.stopPropagation!="function"||t.stopPropagation()}function Mf(t){return t.originalEvent||t.srcEvent}function kE(t){TD(t),TD(Mf(t))}function Hc(t){return t.pointers&&t.pointers.length&&(t=t.pointers[0]),t.touches&&t.touches.length&&(t=t.touches[0]),t?{x:t.clientX,y:t.clientY}:null}function QH(){return/mac/i.test(navigator.platform)}function ZH(t,e){return(Mf(t)||t).button===e}function uu(t){return ZH(t,0)}function dge(t){return ZH(t,1)}function T0(t){var e=Mf(t)||t;return uu(t)?QH()?e.metaKey:e.ctrlKey:!1}function JH(t){var e=Mf(t)||t;return uu(t)&&e.shiftKey}function hge(t){return!0}function fx(t){return uu(t)||dge(t)}var ND=500;function eU(t,e,n){var r=this;function i(C,P,R){if(!a(C,P)){var N,I,M;R?I=e.getGraphics(R):(N=P.delegateTarget||P.target,N&&(I=N,R=e.get(I))),!(!I||!R)&&(M=t.fire(C,{element:R,gfx:I,originalEvent:P}),M===!1&&(P.stopPropagation(),P.preventDefault()))}}var s={};function o(C){return s[C]}function a(C,P){var R=c[C]||uu;return!R(P)}var l={click:"element.click",contextmenu:"element.contextmenu",dblclick:"element.dblclick",mousedown:"element.mousedown",mousemove:"element.mousemove",mouseover:"element.hover",mouseout:"element.out",mouseup:"element.mouseup"},c={"element.contextmenu":hge,"element.mousedown":fx,"element.mouseup":fx,"element.click":fx,"element.dblclick":fx};function d(C,P,R){var N=l[C];if(!N)throw new Error("unmapped DOM event name <"+C+">");return i(N,P,R)}var h="svg, .djs-element";function p(C,P,R,N){var I=s[R]=function(M){i(R,M)};N&&(c[R]=N),I.$delegate=Zn.bind(C,h,P,I)}function f(C,P,R){var N=o(R);N&&Zn.unbind(C,P,N.$delegate)}function m(C){$(l,function(P,R){p(C,R,P)})}function g(C){$(l,function(P,R){f(C,R,P)})}t.on("canvas.destroy",function(C){g(C.svg)}),t.on("canvas.init",function(C){m(C.svg)}),t.on(["shape.added","connection.added"],function(C){var P=C.element,R=C.gfx;t.fire("interactionEvents.createHit",{element:P,gfx:R})}),t.on(["shape.changed","connection.changed"],ND,function(C){var P=C.element,R=C.gfx;t.fire("interactionEvents.updateHit",{element:P,gfx:R})}),t.on("interactionEvents.createHit",ND,function(C){var P=C.element,R=C.gfx;r.createDefaultHit(P,R)}),t.on("interactionEvents.updateHit",function(C){var P=C.element,R=C.gfx;r.updateDefaultHit(P,R)});var v=E("djs-hit djs-hit-stroke"),b=E("djs-hit djs-hit-click-stroke"),x=E("djs-hit djs-hit-all"),y=E("djs-hit djs-hit-no-move"),w={all:x,"click-stroke":b,stroke:v,"no-move":y};function E(C,P){return P=B({stroke:"white",strokeWidth:15},P||{}),n.cls(C,["no-fill","no-border"],P)}function S(C,P){var R=w[P];if(!R)throw new Error("invalid hit type <"+P+">");return K(C,R),C}function j(C,P){re(C,P)}this.removeHits=function(C){var P=zo(".djs-hit",C);$(P,un)},this.createDefaultHit=function(C,P){var R=C.waypoints,N=C.isFrame,I;return R?this.createWaypointsHit(P,R):(I=N?"stroke":"all",this.createBoxHit(P,I,{width:C.width,height:C.height}))},this.createWaypointsHit=function(C,P){var R=P_(P);return S(R,"stroke"),j(C,R),R},this.createBoxHit=function(C,P,R){R=B({x:0,y:0},R);var N=ee("rect");return S(N,P),K(N,R),j(C,N),N},this.updateDefaultHit=function(C,P){var R=at(".djs-hit",P);if(R)return C.waypoints?cH(R,C.waypoints):K(R,{width:C.width,height:C.height}),R},this.fire=i,this.triggerMouseEvent=d,this.mouseHandler=o,this.registerEvent=p,this.unregisterEvent=f}eU.$inject=["eventBus","elementRegistry","styles"];const ry={__init__:["interactionEvents"],interactionEvents:["type",eU]};var pge=500,fge=1e3;function eh(t,e){this._eventBus=t,this.offset=5;var n=e.cls("djs-outline",["no-fill"]),r=this;function i(s){var o=ee("rect");return K(o,B({x:0,y:0,rx:4,width:100,height:100},n)),o}t.on(["shape.added","shape.changed"],pge,function(s){var o=s.element,a=s.gfx,l=at(".djs-outline",a);l||(l=r.getOutline(o)||i(),re(a,l)),r.updateShapeOutline(l,o)}),t.on(["connection.added","connection.changed"],function(s){var o=s.element,a=s.gfx,l=at(".djs-outline",a);l||(l=i(),re(a,l)),r.updateConnectionOutline(l,o)})}eh.prototype.updateShapeOutline=function(t,e){var n=!1,r=this._getProviders();r.length&&$(r,function(i){n=n||i.updateOutline(e,t)}),n||K(t,{x:-this.offset,y:-this.offset,width:e.width+this.offset*2,height:e.height+this.offset*2})};eh.prototype.updateConnectionOutline=function(t,e){var n=Ps(e);K(t,{x:n.x-this.offset,y:n.y-this.offset,width:n.width+this.offset*2,height:n.height+this.offset*2})};eh.prototype.registerProvider=function(t,e){e||(e=t,t=fge),this._eventBus.on("outline.getProviders",t,function(n){n.providers.push(e)})};eh.prototype._getProviders=function(){var t=this._eventBus.createEvent({type:"outline.getProviders",providers:[]});return this._eventBus.fire(t),t.providers};eh.prototype.getOutline=function(t){var e,n=this._getProviders();return $(n,function(r){Bt(r.getOutline)&&(e=e||r.getOutline(t))}),e};eh.$inject=["eventBus","styles","elementRegistry"];const yT={__init__:["outline"],outline:["type",eh]};function Lf(t,e){this._eventBus=t,this._canvas=e,this._selectedElements=[];var n=this;t.on(["shape.remove","connection.remove"],function(r){var i=r.element;n.deselect(i)}),t.on(["diagram.clear","root.set"],function(r){n.select(null)})}Lf.$inject=["eventBus","canvas"];Lf.prototype.deselect=function(t){var e=this._selectedElements,n=e.indexOf(t);if(n!==-1){var r=e.slice();e.splice(n,1),this._eventBus.fire("selection.changed",{oldSelection:r,newSelection:e})}};Lf.prototype.get=function(){return this._selectedElements};Lf.prototype.isSelected=function(t){return this._selectedElements.indexOf(t)!==-1};Lf.prototype.select=function(t,e){var n=this._selectedElements,r=n.slice();ke(t)||(t=t?[t]:[]);var i=this._canvas,s=i.getRootElement();t=t.filter(function(o){var a=i.findRoot(o);return s===a}),e?$(t,function(o){n.indexOf(o)===-1&&n.push(o)}):this._selectedElements=n=t.slice(),this._eventBus.fire("selection.changed",{oldSelection:r,newSelection:n})};var OD="hover",RD="selected",mx=6;function xT(t,e,n){this._canvas=t;var r=this;this._multiSelectionBox=null;function i(o,a){t.addMarker(o,a)}function s(o,a){t.removeMarker(o,a)}e.on("element.hover",function(o){i(o.element,OD)}),e.on("element.out",function(o){s(o.element,OD)}),e.on("selection.changed",function(o){function a(h){s(h,RD)}function l(h){i(h,RD)}var c=o.oldSelection,d=o.newSelection;$(c,function(h){d.indexOf(h)===-1&&a(h)}),$(d,function(h){c.indexOf(h)===-1&&l(h)}),r._updateSelectionOutline(d)}),e.on("element.changed",function(o){n.isSelected(o.element)&&r._updateSelectionOutline(n.get())})}xT.$inject=["canvas","eventBus","selection"];xT.prototype._updateSelectionOutline=function(t){var e=this._canvas.getLayer("selectionOutline");Hd(e);var n=t.length>1,r=this._canvas.getContainer();if(Ge(r)[n?"add":"remove"]("djs-multi-select"),!!n){var i=mge(Ps(t)),s=ee("rect");K(s,B({rx:3},i)),Ge(s).add("djs-selection-outline"),re(e,s)}};function mge(t){return{x:t.x-mx,y:t.y-mx,width:t.width+mx*2,height:t.height+mx*2}}function tU(t,e,n,r){t.on("create.end",500,function(i){var s=i.context,o=s.canExecute,a=s.elements,l=s.hints||{},c=l.autoSelect;if(o){if(c===!1)return;ke(c)?e.select(c):e.select(a.filter(gge))}}),t.on("connect.end",500,function(i){var s=i.context,o=s.connection;o&&e.select(o)}),t.on("shape.move.end",500,function(i){var s=i.previousSelection||[],o=r.get(i.context.shape.id),a=Tt(s,function(l){return o.id===l.id});a||e.select(o)}),t.on("element.click",function(i){if(uu(i)){var s=i.element;s===n.getRootElement()&&(s=null);var o=e.isSelected(s),a=e.get().length>1,l=T0(i)||JH(i);if(o&&a)return l?e.deselect(s):e.select(s);o?e.deselect(s):e.select(s,l)}})}tU.$inject=["eventBus","selection","canvas","elementRegistry"];function gge(t){return!t.hidden}const Ha={__init__:["selectionVisuals","selectionBehavior"],__depends__:[ry,yT],selection:["type",Lf],selectionVisuals:["type",xT],selectionBehavior:["type",tU]};function nU(t){this._counter=0,this._prefix=(t?t+"-":"")+Math.floor(Math.random()*1e9)+"-"}nU.prototype.next=function(){return this._prefix+ ++this._counter};var vge=new nU("ov"),yge=500;function Fr(t,e,n,r){this._eventBus=e,this._canvas=n,this._elementRegistry=r,this._ids=vge,this._overlayDefaults=B({show:null,scale:!0},t&&t.defaults),this._overlays={},this._overlayContainers=[],this._overlayRoot=xge(n.getContainer()),this._init()}Fr.$inject=["config.overlays","eventBus","canvas","elementRegistry"];Fr.prototype.get=function(t){if(Fi(t)&&(t={id:t}),Fi(t.element)&&(t.element=this._elementRegistry.get(t.element)),t.element){var e=this._getOverlayContainer(t.element,!0);return e?t.type?ht(e.overlays,Cs({type:t.type})):e.overlays.slice():[]}else return t.type?ht(this._overlays,Cs({type:t.type})):t.id?this._overlays[t.id]:null};Fr.prototype.add=function(t,e,n){if(Wn(e)&&(n=e,e=null),t.id||(t=this._elementRegistry.get(t)),!n.position)throw new Error("must specifiy overlay position");if(!n.html)throw new Error("must specifiy overlay html");if(!t)throw new Error("invalid element specified");var r=this._ids.next();return n=B({},this._overlayDefaults,n,{id:r,type:e,element:t,html:n.html}),this._addOverlay(n),r};Fr.prototype.remove=function(t){var e=this.get(t)||[];ke(e)||(e=[e]);var n=this;$(e,function(r){var i=n._getOverlayContainer(r.element,!0);if(r&&(Nr(r.html),Nr(r.htmlContainer),delete r.htmlContainer,delete r.element,delete n._overlays[r.id]),i){var s=i.overlays.indexOf(r);s!==-1&&i.overlays.splice(s,1)}})};Fr.prototype.isShown=function(){return this._overlayRoot.style.display!=="none"};Fr.prototype.show=function(){R_(this._overlayRoot)};Fr.prototype.hide=function(){R_(this._overlayRoot,!1)};Fr.prototype.clear=function(){this._overlays={},this._overlayContainers=[],xf(this._overlayRoot)};Fr.prototype._updateOverlayContainer=function(t){var e=t.element,n=t.html,r=e.x,i=e.y;if(e.waypoints){var s=Ps(e);r=s.x,i=s.y}rU(n,r,i),vn(t.html,"data-container-id",e.id)};Fr.prototype._updateOverlay=function(t){var e=t.position,n=t.htmlContainer,r=t.element,i=e.left,s=e.top;if(e.right!==void 0){var o;r.waypoints?o=Ps(r).width:o=r.width,i=e.right*-1+o}if(e.bottom!==void 0){var a;r.waypoints?a=Ps(r).height:a=r.height,s=e.bottom*-1+a}rU(n,i||0,s||0),this._updateOverlayVisibilty(t,this._canvas.viewbox())};Fr.prototype._createOverlayContainer=function(t){var e=bt('<div class="djs-overlays" />');La(e,{position:"absolute"}),this._overlayRoot.appendChild(e);var n={html:e,element:t,overlays:[]};return this._updateOverlayContainer(n),this._overlayContainers.push(n),n};Fr.prototype._updateRoot=function(t){var e=t.scale||1,n="matrix("+[e,0,0,e,-1*t.x*e,-1*t.y*e].join(",")+")";iU(this._overlayRoot,n)};Fr.prototype._getOverlayContainer=function(t,e){var n=Tt(this._overlayContainers,function(r){return r.element===t});return!n&&!e?this._createOverlayContainer(t):n};Fr.prototype._addOverlay=function(t){var e=t.id,n=t.element,r=t.html,i,s;r.get&&r.constructor.prototype.jquery&&(r=r.get(0)),Fi(r)&&(r=bt(r)),s=this._getOverlayContainer(n),i=bt('<div class="djs-overlay" data-overlay-id="'+e+'">'),La(i,{position:"absolute"}),i.appendChild(r),t.type&&vt(i).add("djs-overlay-"+t.type);var o=this._canvas.findRoot(n),a=this._canvas.getRootElement();R_(i,o===a),t.htmlContainer=i,s.overlays.push(t),s.html.appendChild(i),this._overlays[e]=t,this._updateOverlay(t),this._updateOverlayVisibilty(t,this._canvas.viewbox())};Fr.prototype._updateOverlayVisibilty=function(t,e){var n=t.show,r=this._canvas.findRoot(t.element),i=n&&n.minZoom,s=n&&n.maxZoom,o=t.htmlContainer,a=this._canvas.getRootElement(),l=!0;(r!==a||n&&(an(i)&&i>e.scale||an(s)&&s<e.scale))&&(l=!1),R_(o,l),this._updateOverlayScale(t,e)};Fr.prototype._updateOverlayScale=function(t,e){var n=t.scale,r,i,s=t.htmlContainer,o,a="";n!==!0&&(n===!1?(r=1,i=1):(r=n.min,i=n.max),an(r)&&e.scale<r&&(o=(1/e.scale||1)*r),an(i)&&e.scale>i&&(o=(1/e.scale||1)*i)),an(o)&&(a="scale("+o+","+o+")"),iU(s,a)};Fr.prototype._updateOverlaysVisibilty=function(t){var e=this;$(this._overlays,function(n){e._updateOverlayVisibilty(n,t)})};Fr.prototype._init=function(){var t=this._eventBus,e=this;function n(r){e._updateRoot(r),e._updateOverlaysVisibilty(r),e.show()}t.on("canvas.viewbox.changing",function(r){e.hide()}),t.on("canvas.viewbox.changed",function(r){n(r.viewbox)}),t.on(["shape.remove","connection.remove"],function(r){var i=r.element,s=e.get({element:i});$(s,function(l){e.remove(l.id)});var o=e._getOverlayContainer(i);if(o){Nr(o.html);var a=e._overlayContainers.indexOf(o);a!==-1&&e._overlayContainers.splice(a,1)}}),t.on("element.changed",yge,function(r){var i=r.element,s=e._getOverlayContainer(i,!0);s&&($(s.overlays,function(o){e._updateOverlay(o)}),e._updateOverlayContainer(s))}),t.on("element.marker.update",function(r){var i=e._getOverlayContainer(r.element,!0);i&&vt(i.html)[r.add?"add":"remove"](r.marker)}),t.on("root.set",function(){e._updateOverlaysVisibilty(e._canvas.viewbox())}),t.on("diagram.clear",this.clear,this)};function xge(t){var e=bt('<div class="djs-overlay-container" />');return La(e,{position:"absolute",width:0,height:0}),t.insertBefore(e,t.firstChild),e}function rU(t,e,n){La(t,{left:e+"px",top:n+"px"})}function R_(t,e){t.style.display=e===!1?"none":""}function iU(t,e){t.style["transform-origin"]="top left",["","-ms-","-webkit-"].forEach(function(n){t.style[n+"transform"]=e})}const A_={__init__:["overlays"],overlays:["type",Fr]};function I_(t,e,n){this._eventBus=t,this._canvas=e,this._translate=n,t.on("diagram.init",function(){this._init()},this),t.on("import.done",function(r){r.error||this.update()},this),this.HTML_MARKUP='<div class="dmn-definitions"><div class="dmn-definitions-name" title="'+this._translate("Definition name")+'" spellcheck="false"></div><div class="dmn-definitions-id" title="'+this._translate("Definition ID")+'" spellcheck="false"></div></div>'}I_.$inject=["eventBus","canvas","translate"];I_.prototype._init=function(){var t=this._canvas,e=this._eventBus,n=t.getContainer(),r=this._container=bt(this.HTML_MARKUP);n.appendChild(r),this.nameElement=at(".dmn-definitions-name",this._container),this.idElement=at(".dmn-definitions-id",this._container),Zn.bind(r,".dmn-definitions-name, .dmn-definitions-id","mousedown",function(i){i.stopPropagation()}),e.fire("definitionIdView.create",{html:r})};I_.prototype.update=function(){var t=this._canvas.getRootElement().businessObject;this.nameElement.textContent=t.name,this.idElement.textContent=t.id};function bT(t,e){function n(r,i){var s=e.getContainer();vt(s).toggle(r,i)}t.on("palette.create",function(){n("with-palette",!0)}),t.on("palette.changed",function(r){n("with-palette-two-column",r.twoColumn)})}bT.$inject=["eventBus","canvas"];const wT={__depends__:[ny],__init__:["definitionPropertiesView","definitionPropertiesPaletteAdapter"],definitionPropertiesView:["type",I_],definitionPropertiesPaletteAdapter:["type",bT]};var AD=[{className:"dmn-icon-decision-table",matches:function(e){var n=e.businessObject;return Y(n,"dmn:Decision")&&Y(n.decisionLogic,"dmn:DecisionTable")}},{className:"dmn-icon-literal-expression",matches:function(e){var n=e.businessObject;return Y(n,"dmn:Decision")&&Y(n.decisionLogic,"dmn:LiteralExpression")}}];class sU{constructor(e,n,r,i){this._injector=e,this._eventBus=n,this._overlays=r,this._config=i||{enabled:!0},n.on(["shape.added"],s=>{for(var o=s.element,a=0;a<AD.length;a++){var l=AD[a],c=l.matches,d=l.className,h=c&&c(o);h&&this.addOverlay(o,d)}})}addOverlay(e,n){var r=this._config.enabled!==!1,i=bt(`
      <div class="drill-down-overlay">
        `.concat(r?'<button type="button" class="'.concat(n,'"></button>'):'<span class="'.concat(n,'"></span>'),`
      </div>
    `)),s=this._overlays.add(e,{position:{top:2,left:2},html:i});r&&(vt(i).add("interactive"),this.bindEventListener(e,i,s))}bindEventListener(e,n,r){var i=this._overlays,s=this._eventBus,o=i._overlayRoot;Zn.bind(o,'[data-overlay-id="'+r+'"]',"click",()=>{var a=s.fire("drillDown.click",{element:e});a!==!1&&this.drillDown(e)})}drillDown(e){var n=this._injector.get("_parent",!1);if(!n)return!1;var r=n.getView(e.businessObject);return r?(n.open(r),!0):!1}}sU.$inject=["injector","eventBus","overlays","config.drillDown"];const bge={__depends__:[A_],__init__:["drillDown"],drillDown:["type",sU]};var wge=["additionalModules","canvas"];function ID(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function gx(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ID(Object(n),!0).forEach(function(r){_ge(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ID(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function _ge(t,e,n){return e=Ege(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ege(t){var e=Sge(t,"string");return typeof e=="symbol"?e:String(e)}function Sge(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Cge(t,e){if(t==null)return{};var n=jge(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function jge(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function Gi(t){this._container=this._createContainer(),GH(this._container),this._init(this._container,t)}Ce(Gi,Jv);Gi.prototype.saveSVG=Ib(function(t){var e=this;return new Promise(function(n){var r=e.get("canvas"),i=r.getActiveLayer(),s=at("defs",r._svg),o=NX(i),a=s&&s.outerHTML||"",l=i.getBBox(),c=`<?xml version="1.0" encoding="utf-8"?>
<!-- created with dmn-js / http://bpmn.io -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="`+l.width+'" height="'+l.height+'" viewBox="'+l.x+" "+l.y+" "+l.width+" "+l.height+'" version="1.1">'+a+o+"</svg>";n({svg:c})})});Gi.prototype.getModules=function(){return this._modules};Gi.prototype.destroy=function(){Jv.prototype.destroy.call(this),Nr(this._container)};Gi.prototype.on=function(t,e,n,r){return this.get("eventBus").on(t,e,n,r)};Gi.prototype.off=function(t,e){this.get("eventBus").off(t,e)};Gi.prototype._init=function(t,e){var n=e.additionalModules,r=e.canvas,i=Cge(e,wge),s=e.modules||this.getModules(),o=[{drd:["value",this]}],a=[...o,...s,...n||[]],l=gx(gx({},i),{},{canvas:gx(gx({},r),{},{container:t}),modules:a});Jv.call(this,l),e&&e.container&&this.attachTo(e.container)};Gi.prototype._emit=function(t,e){return this.get("eventBus").fire(t,e)};Gi.prototype._createContainer=function(){return bt('<div class="dmn-drd-container"></div>')};Gi.prototype.open=function(t){var e=this;return new Promise((n,r)=>{var i;try{return e._definitions&&e.clear(),e._definitions=t,Wfe(e,t,function(s,o){s?(s.warnings=o||[],r(s)):n({warnings:o||[]})})}catch(s){i=s}i?(i.warnings=i.warnings||[],r(i)):n({warnings:[]})})};Gi.prototype.attachTo=function(t){if(!t)throw new Error("parentNode required");this.detach();var e=this._container;t.appendChild(e),this._emit("attach",{}),this.get("canvas").resized()};Gi.prototype.detach=function(){var t=this._container,e=t.parentNode;e&&(this._emit("detach",{}),e.removeChild(t))};Gi.prototype._modules=[cge,ny,Ha,A_,wT,bge];function DD(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function vp(t,e){return{x:t.x-e.x,y:t.y-e.y}}function GC(t){return Math.log(t)/Math.log(10)}function oU(t,e){var n=GC(t.min),r=GC(t.max),i=Math.abs(n)+Math.abs(r);return i/e}function kge(t,e){return Math.max(t.min,Math.min(t.max,e))}var Pge=Math.sign||function(t){return t>=0?1:-1},_T={min:.2,max:4},aU=10,Tge=.1,Nge=.75;function Ua(t,e,n){t=t||{},this._enabled=!1,this._canvas=n,this._container=n._container,this._handleWheel=li(this._handleWheel,this),this._totalDelta=0,this._scale=t.scale||Nge;var r=this;e.on("canvas.init",function(i){r._init(t.enabled!==!1)})}Ua.$inject=["config.zoomScroll","eventBus","canvas"];Ua.prototype.scroll=function(e){this._canvas.scroll(e)};Ua.prototype.reset=function(){this._canvas.zoom("fit-viewport")};Ua.prototype.zoom=function(e,n){var r=oU(_T,aU*2);this._totalDelta+=e,Math.abs(this._totalDelta)>Tge&&(this._zoom(e,n,r),this._totalDelta=0)};Ua.prototype._handleWheel=function(e){if(!ur(e.target,".djs-scrollable",!0)){var n=this._container;e.preventDefault();var r=e.ctrlKey||QH()&&e.metaKey,i=e.shiftKey,s=-1*this._scale,o;if(r?s*=e.deltaMode===0?.02:.32:s*=e.deltaMode===0?1:16,r){var a=n.getBoundingClientRect(),l={x:e.clientX-a.left,y:e.clientY-a.top};o=Math.sqrt(Math.pow(e.deltaY,2)+Math.pow(e.deltaX,2))*Pge(e.deltaY)*s,this.zoom(o,l)}else i?o={dx:s*e.deltaY,dy:0}:o={dx:s*e.deltaX,dy:s*e.deltaY},this.scroll(o)}};Ua.prototype.stepZoom=function(e,n){var r=oU(_T,aU);this._zoom(e,n,r)};Ua.prototype._zoom=function(t,e,n){var r=this._canvas,i=t>0?1:-1,s=GC(r.zoom()),o=Math.round(s/n)*n;o+=n*i;var a=Math.pow(10,o);r.zoom(kge(_T,a),e)};Ua.prototype.toggle=function(e){var n=this._container,r=this._handleWheel,i=this._enabled;return typeof e>"u"&&(e=!i),i!==e&&ie[e?"bind":"unbind"](n,"wheel",r,!1),this._enabled=e,e};Ua.prototype._init=function(t){this.toggle(t)};const Oge={__init__:["zoomScroll"],zoomScroll:["type",Ua]};var Rge=/^djs-cursor-.*$/;function ET(t){var e=vt(document.body);e.removeMatching(Rge),t&&e.add("djs-cursor-"+t)}function lU(){ET(null)}var Age=5e3;function cU(t,e){e=e||"element.click";function n(){return!1}return t.once(e,Age,n),function(){t.off(e,n)}}var Ige=15;function uU(t,e){var n;t.on("element.mousedown",500,function(o){return s(o.originalEvent)});function r(o){var a=n.start,l=n.button,c=Hc(o),d=vp(c,a);if(!n.dragging&&Dge(d)>Ige&&(n.dragging=!0,l===0&&cU(t),ET("grab")),n.dragging){var h=n.last||n.start;d=vp(c,h),e.scroll({dx:d.x,dy:d.y}),n.last=c}o.preventDefault()}function i(o){ie.unbind(document,"mousemove",r),ie.unbind(document,"mouseup",i),n=null,lU()}function s(o){if(!ur(o.target,".djs-draggable")){var a=o.button;if(!(a>=2||o.ctrlKey||o.shiftKey||o.altKey))return n={button:a,start:Hc(o)},ie.bind(document,"mousemove",r),ie.bind(document,"mouseup",i),!0}}this.isActive=function(){return!!n}}uU.$inject=["eventBus","canvas"];function Dge(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}const $ge={__init__:["moveCanvas"],moveCanvas:["type",uU]};var dU={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,i){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,c=Math.abs,d=Date.now;function h(O,A,H){return setTimeout(y(O,H),A)}function p(O,A,H){return Array.isArray(O)?(f(O,H[A],H),!0):!1}function f(O,A,H){var X;if(O)if(O.forEach)O.forEach(A,H);else if(O.length!==i)for(X=0;X<O.length;)A.call(H,O[X],X,O),X++;else for(X in O)O.hasOwnProperty(X)&&A.call(H,O[X],X,O)}function m(O,A,H){var X="DEPRECATED METHOD: "+A+`
`+H+` AT 
`;return function(){var ae=new Error("get-stack-trace"),Fe=ae&&ae.stack?ae.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ut=e.console&&(e.console.warn||e.console.log);return ut&&ut.call(e.console,X,Fe),O.apply(this,arguments)}}var g;typeof Object.assign!="function"?g=function(A){if(A===i||A===null)throw new TypeError("Cannot convert undefined or null to object");for(var H=Object(A),X=1;X<arguments.length;X++){var ae=arguments[X];if(ae!==i&&ae!==null)for(var Fe in ae)ae.hasOwnProperty(Fe)&&(H[Fe]=ae[Fe])}return H}:g=Object.assign;var v=m(function(A,H,X){for(var ae=Object.keys(H),Fe=0;Fe<ae.length;)(!X||X&&A[ae[Fe]]===i)&&(A[ae[Fe]]=H[ae[Fe]]),Fe++;return A},"extend","Use `assign`."),b=m(function(A,H){return v(A,H,!0)},"merge","Use `assign`.");function x(O,A,H){var X=A.prototype,ae;ae=O.prototype=Object.create(X),ae.constructor=O,ae._super=X,H&&g(ae,H)}function y(O,A){return function(){return O.apply(A,arguments)}}function w(O,A){return typeof O==a?O.apply(A&&A[0]||i,A):O}function E(O,A){return O===i?A:O}function S(O,A,H){f(R(A),function(X){O.addEventListener(X,H,!1)})}function j(O,A,H){f(R(A),function(X){O.removeEventListener(X,H,!1)})}function C(O,A){for(;O;){if(O==A)return!0;O=O.parentNode}return!1}function P(O,A){return O.indexOf(A)>-1}function R(O){return O.trim().split(/\s+/g)}function N(O,A,H){if(O.indexOf&&!H)return O.indexOf(A);for(var X=0;X<O.length;){if(H&&O[X][H]==A||!H&&O[X]===A)return X;X++}return-1}function I(O){return Array.prototype.slice.call(O,0)}function M(O,A,H){for(var X=[],ae=[],Fe=0;Fe<O.length;){var ut=O[Fe][A];N(ae,ut)<0&&X.push(O[Fe]),ae[Fe]=ut,Fe++}return X=X.sort(function(Er,ni){return Er[A]>ni[A]}),X}function W(O,A){for(var H,X,ae=A[0].toUpperCase()+A.slice(1),Fe=0;Fe<s.length;){if(H=s[Fe],X=H?H+ae:A,X in O)return X;Fe++}return i}var ce=1;function se(){return ce++}function ve(O){var A=O.ownerDocument||O;return A.defaultView||A.parentWindow||e}var pt=/mobile|tablet|ip(ad|hone|od)|android/i,je="ontouchstart"in e,lt=W(e,"PointerEvent")!==i,Nt=je&&pt.test(navigator.userAgent),Ae="touch",Qe="pen",ze="mouse",Ot="kinect",Zt=25,me=1,oe=2,pe=4,ne=8,Te=1,de=2,Ie=4,qe=8,_t=16,Ht=de|Ie,on=qe|_t,te=Ht|on,Be=["x","y"],xe=["clientX","clientY"];function ct(O,A){var H=this;this.manager=O,this.callback=A,this.element=O.element,this.target=O.options.inputTarget,this.domHandler=function(X){w(O.options.enable,[O])&&H.handler(X)},this.init()}ct.prototype={handler:function(){},init:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(ve(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&j(this.element,this.evEl,this.domHandler),this.evTarget&&j(this.target,this.evTarget,this.domHandler),this.evWin&&j(ve(this.element),this.evWin,this.domHandler)}};function ft(O){var A,H=O.options.inputClass;return H?A=H:lt?A=Xi:Nt?A=zr:je?A=gh:A=na,new A(O,nt)}function nt(O,A,H){var X=H.pointers.length,ae=H.changedPointers.length,Fe=A&me&&X-ae===0,ut=A&(pe|ne)&&X-ae===0;H.isFirst=!!Fe,H.isFinal=!!ut,Fe&&(O.session={}),H.eventType=A,fe(O,H),O.emit("hammer.input",H),O.recognize(H),O.session.prevInput=H}function fe(O,A){var H=O.session,X=A.pointers,ae=X.length;H.firstInput||(H.firstInput=wr(A)),ae>1&&!H.firstMultiple?H.firstMultiple=wr(A):ae===1&&(H.firstMultiple=!1);var Fe=H.firstInput,ut=H.firstMultiple,_r=ut?ut.center:Fe.center,Er=A.center=Jt(X);A.timeStamp=d(),A.deltaTime=A.timeStamp-Fe.timeStamp,A.angle=Ds(_r,Er),A.distance=Jo(_r,Er),Ye(H,A),A.offsetDirection=Yi(A.deltaX,A.deltaY);var ni=Zo(A.deltaTime,A.deltaX,A.deltaY);A.overallVelocityX=ni.x,A.overallVelocityY=ni.y,A.overallVelocity=c(ni.x)>c(ni.y)?ni.x:ni.y,A.scale=ut?ea(ut.pointers,X):1,A.rotation=ut?Su(ut.pointers,X):0,A.maxPointers=H.prevInput?A.pointers.length>H.prevInput.maxPointers?A.pointers.length:H.prevInput.maxPointers:A.pointers.length,In(H,A);var Pi=O.element;C(A.srcEvent.target,Pi)&&(Pi=A.srcEvent.target),A.target=Pi}function Ye(O,A){var H=A.center,X=O.offsetDelta||{},ae=O.prevDelta||{},Fe=O.prevInput||{};(A.eventType===me||Fe.eventType===pe)&&(ae=O.prevDelta={x:Fe.deltaX||0,y:Fe.deltaY||0},X=O.offsetDelta={x:H.x,y:H.y}),A.deltaX=ae.x+(H.x-X.x),A.deltaY=ae.y+(H.y-X.y)}function In(O,A){var H=O.lastInterval||A,X=A.timeStamp-H.timeStamp,ae,Fe,ut,_r;if(A.eventType!=ne&&(X>Zt||H.velocity===i)){var Er=A.deltaX-H.deltaX,ni=A.deltaY-H.deltaY,Pi=Zo(X,Er,ni);Fe=Pi.x,ut=Pi.y,ae=c(Pi.x)>c(Pi.y)?Pi.x:Pi.y,_r=Yi(Er,ni),O.lastInterval=A}else ae=H.velocity,Fe=H.velocityX,ut=H.velocityY,_r=H.direction;A.velocity=ae,A.velocityX=Fe,A.velocityY=ut,A.direction=_r}function wr(O){for(var A=[],H=0;H<O.pointers.length;)A[H]={clientX:l(O.pointers[H].clientX),clientY:l(O.pointers[H].clientY)},H++;return{timeStamp:d(),pointers:A,center:Jt(A),deltaX:O.deltaX,deltaY:O.deltaY}}function Jt(O){var A=O.length;if(A===1)return{x:l(O[0].clientX),y:l(O[0].clientY)};for(var H=0,X=0,ae=0;ae<A;)H+=O[ae].clientX,X+=O[ae].clientY,ae++;return{x:l(H/A),y:l(X/A)}}function Zo(O,A,H){return{x:A/O||0,y:H/O||0}}function Yi(O,A){return O===A?Te:c(O)>=c(A)?O<0?de:Ie:A<0?qe:_t}function Jo(O,A,H){H||(H=Be);var X=A[H[0]]-O[H[0]],ae=A[H[1]]-O[H[1]];return Math.sqrt(X*X+ae*ae)}function Ds(O,A,H){H||(H=Be);var X=A[H[0]]-O[H[0]],ae=A[H[1]]-O[H[1]];return Math.atan2(ae,X)*180/Math.PI}function Su(O,A){return Ds(A[1],A[0],xe)+Ds(O[1],O[0],xe)}function ea(O,A){return Jo(A[0],A[1],xe)/Jo(O[0],O[1],xe)}var fh={mousedown:me,mousemove:oe,mouseup:pe},ta="mousedown",nm="mousemove mouseup";function na(){this.evEl=ta,this.evWin=nm,this.pressed=!1,ct.apply(this,arguments)}x(na,ct,{handler:function(A){var H=fh[A.type];H&me&&A.button===0&&(this.pressed=!0),H&oe&&A.which!==1&&(H=pe),this.pressed&&(H&pe&&(this.pressed=!1),this.callback(this.manager,H,{pointers:[A],changedPointers:[A],pointerType:ze,srcEvent:A}))}});var ra={pointerdown:me,pointermove:oe,pointerup:pe,pointercancel:ne,pointerout:ne},mh={2:Ae,3:Qe,4:ze,5:Ot},Cu="pointerdown",Gl="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Cu="MSPointerDown",Gl="MSPointerMove MSPointerUp MSPointerCancel");function Xi(){this.evEl=Cu,this.evWin=Gl,ct.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}x(Xi,ct,{handler:function(A){var H=this.store,X=!1,ae=A.type.toLowerCase().replace("ms",""),Fe=ra[ae],ut=mh[A.pointerType]||A.pointerType,_r=ut==Ae,Er=N(H,A.pointerId,"pointerId");Fe&me&&(A.button===0||_r)?Er<0&&(H.push(A),Er=H.length-1):Fe&(pe|ne)&&(X=!0),!(Er<0)&&(H[Er]=A,this.callback(this.manager,Fe,{pointers:H,changedPointers:[A],pointerType:ut,srcEvent:A}),X&&H.splice(Er,1))}});var rm={touchstart:me,touchmove:oe,touchend:pe,touchcancel:ne},jt="touchstart",en="touchstart touchmove touchend touchcancel";function Sn(){this.evTarget=jt,this.evWin=en,this.started=!1,ct.apply(this,arguments)}x(Sn,ct,{handler:function(A){var H=rm[A.type];if(H===me&&(this.started=!0),!!this.started){var X=fi.call(this,A,H);H&(pe|ne)&&X[0].length-X[1].length===0&&(this.started=!1),this.callback(this.manager,H,{pointers:X[0],changedPointers:X[1],pointerType:Ae,srcEvent:A})}}});function fi(O,A){var H=I(O.touches),X=I(O.changedTouches);return A&(pe|ne)&&(H=M(H.concat(X),"identifier")),[H,X]}var ei={touchstart:me,touchmove:oe,touchend:pe,touchcancel:ne},ki="touchstart touchmove touchend touchcancel";function zr(){this.evTarget=ki,this.targetIds={},ct.apply(this,arguments)}x(zr,ct,{handler:function(A){var H=ei[A.type],X=ti.call(this,A,H);X&&this.callback(this.manager,H,{pointers:X[0],changedPointers:X[1],pointerType:Ae,srcEvent:A})}});function ti(O,A){var H=I(O.touches),X=this.targetIds;if(A&(me|oe)&&H.length===1)return X[H[0].identifier]=!0,[H,H];var ae,Fe,ut=I(O.changedTouches),_r=[],Er=this.target;if(Fe=H.filter(function(ni){return C(ni.target,Er)}),A===me)for(ae=0;ae<Fe.length;)X[Fe[ae].identifier]=!0,ae++;for(ae=0;ae<ut.length;)X[ut[ae].identifier]&&_r.push(ut[ae]),A&(pe|ne)&&delete X[ut[ae].identifier],ae++;if(_r.length)return[M(Fe.concat(_r),"identifier"),_r]}var $s=2500,Cy=25;function gh(){ct.apply(this,arguments);var O=y(this.handler,this);this.touch=new zr(this.manager,O),this.mouse=new na(this.manager,O),this.primaryTouch=null,this.lastTouches=[]}x(gh,ct,{handler:function(A,H,X){var ae=X.pointerType==Ae,Fe=X.pointerType==ze;if(!(Fe&&X.sourceCapabilities&&X.sourceCapabilities.firesTouchEvents)){if(ae)ia.call(this,H,X);else if(Fe&&Ms.call(this,X))return;this.callback(A,H,X)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ia(O,A){O&me?(this.primaryTouch=A.changedPointers[0].identifier,ju.call(this,A)):O&(pe|ne)&&ju.call(this,A)}function ju(O){var A=O.changedPointers[0];if(A.identifier===this.primaryTouch){var H={x:A.clientX,y:A.clientY};this.lastTouches.push(H);var X=this.lastTouches,ae=function(){var Fe=X.indexOf(H);Fe>-1&&X.splice(Fe,1)};setTimeout(ae,$s)}}function Ms(O){for(var A=O.srcEvent.clientX,H=O.srcEvent.clientY,X=0;X<this.lastTouches.length;X++){var ae=this.lastTouches[X],Fe=Math.abs(A-ae.x),ut=Math.abs(H-ae.y);if(Fe<=Cy&&ut<=Cy)return!0}return!1}var Va=W(o.style,"touchAction"),im=Va!==i,Kl="compute",vh="auto",sm="manipulation",sa="none",Yl="pan-x",ku="pan-y",yh=Pu();function It(O,A){this.manager=O,this.set(A)}It.prototype={set:function(O){O==Kl&&(O=this.compute()),im&&this.manager.element.style&&yh[O]&&(this.manager.element.style[Va]=O),this.actions=O.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var O=[];return f(this.manager.recognizers,function(A){w(A.options.enable,[A])&&(O=O.concat(A.getTouchAction()))}),Ls(O.join(" "))},preventDefaults:function(O){var A=O.srcEvent,H=O.offsetDirection;if(this.manager.session.prevented){A.preventDefault();return}var X=this.actions,ae=P(X,sa)&&!yh[sa],Fe=P(X,ku)&&!yh[ku],ut=P(X,Yl)&&!yh[Yl];if(ae){var _r=O.pointers.length===1,Er=O.distance<2,ni=O.deltaTime<250;if(_r&&Er&&ni)return}if(!(ut&&Fe)&&(ae||Fe&&H&Ht||ut&&H&on))return this.preventSrc(A)},preventSrc:function(O){this.manager.session.prevented=!0,O.preventDefault()}};function Ls(O){if(P(O,sa))return sa;var A=P(O,Yl),H=P(O,ku);return A&&H?sa:A||H?A?Yl:ku:P(O,sm)?sm:vh}function Pu(){if(!im)return!1;var O={},A=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(H){O[H]=A?e.CSS.supports("touch-action",H):!0}),O}var hr=1,mi=2,Xl=4,_o=8,Cn=_o,Qi=16,Bs=32;function Fs(O){this.options=g({},this.defaults,O||{}),this.id=se(),this.manager=null,this.options.enable=E(this.options.enable,!0),this.state=hr,this.simultaneous={},this.requireFail=[]}Fs.prototype={defaults:{},set:function(O){return g(this.options,O),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(O){if(p(O,"recognizeWith",this))return this;var A=this.simultaneous;return O=Tu(O,this),A[O.id]||(A[O.id]=O,O.recognizeWith(this)),this},dropRecognizeWith:function(O){return p(O,"dropRecognizeWith",this)?this:(O=Tu(O,this),delete this.simultaneous[O.id],this)},requireFailure:function(O){if(p(O,"requireFailure",this))return this;var A=this.requireFail;return O=Tu(O,this),N(A,O)===-1&&(A.push(O),O.requireFailure(this)),this},dropRequireFailure:function(O){if(p(O,"dropRequireFailure",this))return this;O=Tu(O,this);var A=N(this.requireFail,O);return A>-1&&this.requireFail.splice(A,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(O){return!!this.simultaneous[O.id]},emit:function(O){var A=this,H=this.state;function X(ae){A.manager.emit(ae,O)}H<_o&&X(A.options.event+om(H)),X(A.options.event),O.additionalEvent&&X(O.additionalEvent),H>=_o&&X(A.options.event+om(H))},tryEmit:function(O){if(this.canEmit())return this.emit(O);this.state=Bs},canEmit:function(){for(var O=0;O<this.requireFail.length;){if(!(this.requireFail[O].state&(Bs|hr)))return!1;O++}return!0},recognize:function(O){var A=g({},O);if(!w(this.options.enable,[this,A])){this.reset(),this.state=Bs;return}this.state&(Cn|Qi|Bs)&&(this.state=hr),this.state=this.process(A),this.state&(mi|Xl|_o|Qi)&&this.tryEmit(A)},process:function(O){},getTouchAction:function(){},reset:function(){}};function om(O){return O&Qi?"cancel":O&_o?"end":O&Xl?"move":O&mi?"start":""}function qa(O){return O==_t?"down":O==qe?"up":O==de?"left":O==Ie?"right":""}function Tu(O,A){var H=A.manager;return H?H.get(O):O}function gi(){Fs.apply(this,arguments)}x(gi,Fs,{defaults:{pointers:1},attrTest:function(O){var A=this.options.pointers;return A===0||O.pointers.length===A},process:function(O){var A=this.state,H=O.eventType,X=A&(mi|Xl),ae=this.attrTest(O);return X&&(H&ne||!ae)?A|Qi:X||ae?H&pe?A|_o:A&mi?A|Xl:mi:Bs}});function xh(){gi.apply(this,arguments),this.pX=null,this.pY=null}x(xh,gi,{defaults:{event:"pan",threshold:10,pointers:1,direction:te},getTouchAction:function(){var O=this.options.direction,A=[];return O&Ht&&A.push(ku),O&on&&A.push(Yl),A},directionTest:function(O){var A=this.options,H=!0,X=O.distance,ae=O.direction,Fe=O.deltaX,ut=O.deltaY;return ae&A.direction||(A.direction&Ht?(ae=Fe===0?Te:Fe<0?de:Ie,H=Fe!=this.pX,X=Math.abs(O.deltaX)):(ae=ut===0?Te:ut<0?qe:_t,H=ut!=this.pY,X=Math.abs(O.deltaY))),O.direction=ae,H&&X>A.threshold&&ae&A.direction},attrTest:function(O){return gi.prototype.attrTest.call(this,O)&&(this.state&mi||!(this.state&mi)&&this.directionTest(O))},emit:function(O){this.pX=O.deltaX,this.pY=O.deltaY;var A=qa(O.direction);A&&(O.additionalEvent=this.options.event+A),this._super.emit.call(this,O)}});function Wa(){gi.apply(this,arguments)}x(Wa,gi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[sa]},attrTest:function(O){return this._super.attrTest.call(this,O)&&(Math.abs(O.scale-1)>this.options.threshold||this.state&mi)},emit:function(O){if(O.scale!==1){var A=O.scale<1?"in":"out";O.additionalEvent=this.options.event+A}this._super.emit.call(this,O)}});function Ql(){Fs.apply(this,arguments),this._timer=null,this._input=null}x(Ql,Fs,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[vh]},process:function(O){var A=this.options,H=O.pointers.length===A.pointers,X=O.distance<A.threshold,ae=O.deltaTime>A.time;if(this._input=O,!X||!H||O.eventType&(pe|ne)&&!ae)this.reset();else if(O.eventType&me)this.reset(),this._timer=h(function(){this.state=Cn,this.tryEmit()},A.time,this);else if(O.eventType&pe)return Cn;return Bs},reset:function(){clearTimeout(this._timer)},emit:function(O){this.state===Cn&&(O&&O.eventType&pe?this.manager.emit(this.options.event+"up",O):(this._input.timeStamp=d(),this.manager.emit(this.options.event,this._input)))}});function Ga(){gi.apply(this,arguments)}x(Ga,gi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[sa]},attrTest:function(O){return this._super.attrTest.call(this,O)&&(Math.abs(O.rotation)>this.options.threshold||this.state&mi)}});function Zl(){gi.apply(this,arguments)}x(Zl,gi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ht|on,pointers:1},getTouchAction:function(){return xh.prototype.getTouchAction.call(this)},attrTest:function(O){var A=this.options.direction,H;return A&(Ht|on)?H=O.overallVelocity:A&Ht?H=O.overallVelocityX:A&on&&(H=O.overallVelocityY),this._super.attrTest.call(this,O)&&A&O.offsetDirection&&O.distance>this.options.threshold&&O.maxPointers==this.options.pointers&&c(H)>this.options.velocity&&O.eventType&pe},emit:function(O){var A=qa(O.offsetDirection);A&&this.manager.emit(this.options.event+A,O),this.manager.emit(this.options.event,O)}});function Ka(){Fs.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}x(Ka,Fs,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[sm]},process:function(O){var A=this.options,H=O.pointers.length===A.pointers,X=O.distance<A.threshold,ae=O.deltaTime<A.time;if(this.reset(),O.eventType&me&&this.count===0)return this.failTimeout();if(X&&ae&&H){if(O.eventType!=pe)return this.failTimeout();var Fe=this.pTime?O.timeStamp-this.pTime<A.interval:!0,ut=!this.pCenter||Jo(this.pCenter,O.center)<A.posThreshold;this.pTime=O.timeStamp,this.pCenter=O.center,!ut||!Fe?this.count=1:this.count+=1,this._input=O;var _r=this.count%A.taps;if(_r===0)return this.hasRequireFailures()?(this._timer=h(function(){this.state=Cn,this.tryEmit()},A.interval,this),mi):Cn}return Bs},failTimeout:function(){return this._timer=h(function(){this.state=Bs},this.options.interval,this),Bs},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Cn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function oa(O,A){return A=A||{},A.recognizers=E(A.recognizers,oa.defaults.preset),new Jl(O,A)}oa.VERSION="2.0.7",oa.defaults={domEvents:!1,touchAction:Kl,enable:!0,inputTarget:null,inputClass:null,preset:[[Ga,{enable:!1}],[Wa,{enable:!1},["rotate"]],[Zl,{direction:Ht}],[xh,{direction:Ht},["swipe"]],[Ka],[Ka,{event:"doubletap",taps:2},["tap"]],[Ql]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var bh=1,Nu=2;function Jl(O,A){this.options=g({},oa.defaults,A||{}),this.options.inputTarget=this.options.inputTarget||O,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=O,this.input=ft(this),this.touchAction=new It(this,this.options.touchAction),wh(this,!0),f(this.options.recognizers,function(H){var X=this.add(new H[0](H[1]));H[2]&&X.recognizeWith(H[2]),H[3]&&X.requireFailure(H[3])},this)}Jl.prototype={set:function(O){return g(this.options,O),O.touchAction&&this.touchAction.update(),O.inputTarget&&(this.input.destroy(),this.input.target=O.inputTarget,this.input.init()),this},stop:function(O){this.session.stopped=O?Nu:bh},recognize:function(O){var A=this.session;if(!A.stopped){this.touchAction.preventDefaults(O);var H,X=this.recognizers,ae=A.curRecognizer;(!ae||ae&&ae.state&Cn)&&(ae=A.curRecognizer=null);for(var Fe=0;Fe<X.length;)H=X[Fe],A.stopped!==Nu&&(!ae||H==ae||H.canRecognizeWith(ae))?H.recognize(O):H.reset(),!ae&&H.state&(mi|Xl|_o)&&(ae=A.curRecognizer=H),Fe++}},get:function(O){if(O instanceof Fs)return O;for(var A=this.recognizers,H=0;H<A.length;H++)if(A[H].options.event==O)return A[H];return null},add:function(O){if(p(O,"add",this))return this;var A=this.get(O.options.event);return A&&this.remove(A),this.recognizers.push(O),O.manager=this,this.touchAction.update(),O},remove:function(O){if(p(O,"remove",this))return this;if(O=this.get(O),O){var A=this.recognizers,H=N(A,O);H!==-1&&(A.splice(H,1),this.touchAction.update())}return this},on:function(O,A){if(O!==i&&A!==i){var H=this.handlers;return f(R(O),function(X){H[X]=H[X]||[],H[X].push(A)}),this}},off:function(O,A){if(O!==i){var H=this.handlers;return f(R(O),function(X){A?H[X]&&H[X].splice(N(H[X],A),1):delete H[X]}),this}},emit:function(O,A){this.options.domEvents&&_h(O,A);var H=this.handlers[O]&&this.handlers[O].slice();if(!(!H||!H.length)){A.type=O,A.preventDefault=function(){A.srcEvent.preventDefault()};for(var X=0;X<H.length;)H[X](A),X++}},destroy:function(){this.element&&wh(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function wh(O,A){var H=O.element;if(H.style){var X;f(O.options.cssProps,function(ae,Fe){X=W(H.style,Fe),A?(O.oldCssProps[X]=H.style[X],H.style[X]=ae):H.style[X]=O.oldCssProps[X]||""}),A||(O.oldCssProps={})}}function _h(O,A){var H=n.createEvent("Event");H.initEvent(O,!0,!0),H.gesture=A,A.target.dispatchEvent(H)}g(oa,{INPUT_START:me,INPUT_MOVE:oe,INPUT_END:pe,INPUT_CANCEL:ne,STATE_POSSIBLE:hr,STATE_BEGAN:mi,STATE_CHANGED:Xl,STATE_ENDED:_o,STATE_RECOGNIZED:Cn,STATE_CANCELLED:Qi,STATE_FAILED:Bs,DIRECTION_NONE:Te,DIRECTION_LEFT:de,DIRECTION_RIGHT:Ie,DIRECTION_UP:qe,DIRECTION_DOWN:_t,DIRECTION_HORIZONTAL:Ht,DIRECTION_VERTICAL:on,DIRECTION_ALL:te,Manager:Jl,Input:ct,TouchAction:It,TouchInput:zr,MouseInput:na,PointerEventInput:Xi,TouchMouseInput:gh,SingleTouchInput:Sn,Recognizer:Fs,AttrRecognizer:gi,Tap:Ka,Pan:xh,Swipe:Zl,Pinch:Wa,Rotate:Ga,Press:Ql,on:S,off:j,each:f,merge:b,extend:v,assign:g,inherit:x,bindFn:y,prefixed:W});var Ou=typeof e<"u"?e:typeof self<"u"?self:{};Ou.Hammer=oa,t.exports?t.exports=oa:e[r]=oa})(window,document,"Hammer")})(dU);var Mge=dU.exports;const zu=aw(Mge);var Lge=.2,Bge=4,$D=["mousedown","mouseup","mouseover","mouseout","click","dblclick"];function vx(t,e){return e.get(t,!1)}function KC(t){t.preventDefault(),typeof t.stopPropagation=="function"?t.stopPropagation():t.srcEvent&&typeof t.srcEvent.stopPropagation=="function"&&t.srcEvent.stopPropagation(),typeof t.stopImmediatePropagation=="function"&&t.stopImmediatePropagation()}function PE(t){function e(c){$($D,function(d){ie.bind(t,d,KC,!0)})}function n(c){setTimeout(function(){$($D,function(d){ie.unbind(t,d,KC,!0)})},500)}ie.bind(t,"touchstart",e,!0),ie.bind(t,"touchend",n,!0),ie.bind(t,"touchcancel",n,!0);var r=new zu.Manager(t,{inputClass:zu.TouchInput,recognizers:[],domEvents:!0}),i=new zu.Tap,s=new zu.Pan({threshold:10}),o=new zu.Press,a=new zu.Pinch,l=new zu.Tap({event:"doubletap",taps:2});return a.requireFailure(s),a.requireFailure(o),r.add([s,o,a,l,i]),r.reset=function(c){var d=this.recognizers,h=this.session;h.stopped||(r.stop(c),setTimeout(function(){var p,f;for(p=0;f=d[p];p++)f.reset(),f.state=8;h.curRecognizer=null},0))},r.on("hammer.input",function(c){c.srcEvent.defaultPrevented&&r.reset(!0)}),r}function hU(t,e,n,r,i){var s=vx("dragging",t),o=vx("move",t),a=vx("contextPad",t),l=vx("palette",t),c;function d(f,m){return function(g){var v=h(g.target),b=v&&r.get(v);return m&&(g.srcEvent.button=m),i.fire(f,g,b)}}function h(f){var m=ur(f,"svg, .djs-element",!0);return m}function p(f){c=PE(f);function m(b){var x=0,y=0;function w(S){var j=S.deltaX-x,C=S.deltaY-y;e.scroll({dx:j,dy:C}),x=S.deltaX,y=S.deltaY}function E(S){c.off("panmove",w),c.off("panend",E),c.off("pancancel",E)}c.on("panmove",w),c.on("panend",E),c.on("pancancel",E)}function g(b){var x=h(b.target),y=x&&r.get(x);if(o&&e.getRootElement()!==y)return o.start(b,y,!0);m()}function v(b){var x=e.zoom(),y=b.center;function w(S){var j=1-(1-S.scale)/1.5,C=Math.max(Lge,Math.min(Bge,j*x));e.zoom(C,y),KC(S)}function E(S){c.off("pinchmove",w),c.off("pinchend",E),c.off("pinchcancel",E),c.reset(!0)}c.on("pinchmove",w),c.on("pinchend",E),c.on("pinchcancel",E)}c.on("tap",d("element.click")),c.on("doubletap",d("element.dblclick",1)),c.on("panstart",g),c.on("press",g),c.on("pinchstart",v)}s&&n.on("drag.move",function(f){var m=f.originalEvent;if(!(!m||m instanceof MouseEvent)){var g=Hc(m),v=document.elementFromPoint(g.x,g.y),b=h(v),x=b&&r.get(b);x!==f.hover&&(f.hover&&s.out(f),x&&(s.hover({element:x,gfx:b}),f.hover=x,f.hoverGfx=b))}}),a&&n.on("contextPad.create",function(f){var m=f.pad.html,g=PE(m);g.on("panstart",function(v){a.trigger("dragstart",v,!0)}),g.on("press",function(v){a.trigger("dragstart",v,!0)}),g.on("tap",function(v){a.trigger("click",v)})}),l&&n.on("palette.create",function(f){var m=f.container,g=PE(m);g.on("panstart",function(v){l.trigger("dragstart",v,!0)}),g.on("press",function(v){l.trigger("dragstart",v,!0)}),g.on("tap",function(v){l.trigger("click",v)})}),n.on("canvas.init",function(f){p(f.svg)})}hU.$inject=["injector","canvas","eventBus","elementRegistry","interactionEvents","touchFix"];function ST(t){var e=this;t.on("canvas.init",function(n){e.addBBoxMarker(n.svg)})}ST.$inject=["eventBus"];ST.prototype.addBBoxMarker=function(t){var e={fill:"none",class:"outer-bound-marker"},n=ee("rect");K(n,{x:-1e4,y:1e4,width:10,height:10}),K(n,e),re(t,n);var r=ee("rect");K(r,{x:1e4,y:1e4,width:10,height:10}),K(r,e),re(t,r)};const Fge={__depends__:[ry],__init__:["touchInteractionEvents"],touchInteractionEvents:["type",hU],touchFix:["type",ST]},zge={__depends__:[Fge]};function CT(t){return CSS.escape(t)}var Hge={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function MD(t){return t=""+t,t&&t.replace(/[&<>"']/g,function(e){return Hge[e]})}var Uge=["c","C"],Vge=["v","V"],qge=["y","Y"],pU=["z","Z"];function Wge(t){return t.ctrlKey||t.metaKey||t.shiftKey||t.altKey}function to(t){return t.altKey?!1:t.ctrlKey||t.metaKey}function Br(t,e){return t=ke(t)?t:[t],t.indexOf(e.key)!==-1||t.indexOf(e.code)!==-1}function jT(t){return t.shiftKey}function Gge(t){return to(t)&&Br(Uge,t)}function Kge(t){return to(t)&&Br(Vge,t)}function Yge(t){return to(t)&&!jT(t)&&Br(pU,t)}function Xge(t){return to(t)&&(Br(qge,t)||Br(pU,t)&&jT(t))}function gt(t,e,n,r){this._open=!1,this._results=[],this._eventMaps=[],this._canvas=t,this._eventBus=e,this._overlays=n,this._selection=r,this._container=bt(gt.BOX_HTML),this._searchInput=at(gt.INPUT_SELECTOR,this._container),this._resultsContainer=at(gt.RESULTS_CONTAINER_SELECTOR,this._container),this._canvas.getContainer().appendChild(this._container),e.on(["canvas.destroy","diagram.destroy"],this.close,this)}gt.$inject=["canvas","eventBus","overlays","selection"];gt.prototype._bindEvents=function(){var t=this;function e(n,r,i,s){t._eventMaps.push({el:n,type:i,listener:Zn.bind(n,r,i,s)})}e(document,"html","click",function(n){t.close()}),e(this._container,gt.INPUT_SELECTOR,"click",function(n){n.stopPropagation(),n.delegateTarget.focus()}),e(this._container,gt.RESULT_SELECTOR,"mouseover",function(n){n.stopPropagation(),t._scrollToNode(n.delegateTarget),t._preselect(n.delegateTarget)}),e(this._container,gt.RESULT_SELECTOR,"click",function(n){n.stopPropagation(),t._select(n.delegateTarget)}),e(this._container,gt.INPUT_SELECTOR,"keydown",function(n){Br("ArrowUp",n)&&n.preventDefault(),Br("ArrowDown",n)&&n.preventDefault()}),e(this._container,gt.INPUT_SELECTOR,"keyup",function(n){if(Br("Escape",n))return t.close();if(Br("Enter",n)){var r=t._getCurrentResult();return r?t._select(r):t.close()}if(Br("ArrowUp",n))return t._scrollToDirection(!0);if(Br("ArrowDown",n))return t._scrollToDirection();Br(["ArrowLeft","ArrowRight"],n)||t._search(n.delegateTarget.value)})};gt.prototype._unbindEvents=function(){this._eventMaps.forEach(function(t){Zn.unbind(t.el,t.type,t.listener)})};gt.prototype._search=function(t){var e=this;if(this._clearResults(),!(!t||t==="")){var n=this._searchProvider.find(t);if(n.length){n.forEach(function(i){var s=i.element.id,o=e._createResultNode(i,s);e._results[s]={element:i.element,node:o}});var r=at(gt.RESULT_SELECTOR,this._resultsContainer);this._scrollToNode(r),this._preselect(r)}}};gt.prototype._scrollToDirection=function(t){var e=this._getCurrentResult();if(e){var n=t?e.previousElementSibling:e.nextElementSibling;n&&(this._scrollToNode(n),this._preselect(n))}};gt.prototype._scrollToNode=function(t){if(!(!t||t===this._getCurrentResult())){var e=t.offsetTop,n=this._resultsContainer.scrollTop,r=e-this._resultsContainer.clientHeight+t.clientHeight;e<n?this._resultsContainer.scrollTop=e:n<r&&(this._resultsContainer.scrollTop=r)}};gt.prototype._clearResults=function(){xf(this._resultsContainer),this._results=[],this._resetOverlay(),this._eventBus.fire("searchPad.cleared")};gt.prototype._getCurrentResult=function(){return at(gt.RESULT_SELECTED_SELECTOR,this._resultsContainer)};gt.prototype._createResultNode=function(t,e){var n=bt(gt.RESULT_HTML);return t.primaryTokens.length>0&&LD(n,t.primaryTokens,gt.RESULT_PRIMARY_HTML),LD(n,t.secondaryTokens,gt.RESULT_SECONDARY_HTML),vn(n,gt.RESULT_ID_ATTRIBUTE,e),this._resultsContainer.appendChild(n),n};gt.prototype.registerProvider=function(t){this._searchProvider=t};gt.prototype.open=function(){if(!this._searchProvider)throw new Error("no search provider registered");this.isOpen()||(this._bindEvents(),this._open=!0,vt(this._container).add("open"),this._searchInput.focus(),this._eventBus.fire("searchPad.opened"))};gt.prototype.close=function(){this.isOpen()&&(this._unbindEvents(),this._open=!1,vt(this._container).remove("open"),this._clearResults(),this._searchInput.value="",this._searchInput.blur(),this._resetOverlay(),this._eventBus.fire("searchPad.closed"))};gt.prototype.toggle=function(){this.isOpen()?this.close():this.open()};gt.prototype.isOpen=function(){return this._open};gt.prototype._preselect=function(t){var e=this._getCurrentResult();if(t!==e){e&&vt(e).remove(gt.RESULT_SELECTED_CLASS);var n=vn(t,gt.RESULT_ID_ATTRIBUTE),r=this._results[n].element;vt(t).add(gt.RESULT_SELECTED_CLASS),this._resetOverlay(r),this._canvas.scrollToElement(r,{top:400}),this._selection.select(r),this._eventBus.fire("searchPad.preselected",r)}};gt.prototype._select=function(t){var e=vn(t,gt.RESULT_ID_ATTRIBUTE),n=this._results[e].element;this.close(),this._resetOverlay(),this._canvas.scrollToElement(n,{top:400}),this._selection.select(n),this._eventBus.fire("searchPad.selected",n)};gt.prototype._resetOverlay=function(t){if(this._overlayId&&this._overlays.remove(this._overlayId),t){var e=Ps(t),n=Qge(e);this._overlayId=this._overlays.add(t,n)}};function Qge(t){var e=6,n=t.width+e*2,r=t.height+e*2,i={width:n+"px",height:r+"px"},s=bt('<div class="'+gt.OVERLAY_CLASS+'"></div>');return La(s,i),{position:{bottom:r-e,right:n-e},show:!0,html:s}}function LD(t,e,n){var r=Zge(e),i=bt(n);i.innerHTML=r,t.appendChild(i)}function Zge(t){var e="";return t.forEach(function(n){n.matched?e+='<strong class="'+gt.RESULT_HIGHLIGHT_CLASS+'">'+MD(n.matched)+"</strong>":e+=MD(n.normal)}),e!==""?e:null}gt.CONTAINER_SELECTOR=".djs-search-container";gt.INPUT_SELECTOR=".djs-search-input input";gt.RESULTS_CONTAINER_SELECTOR=".djs-search-results";gt.RESULT_SELECTOR=".djs-search-result";gt.RESULT_SELECTED_CLASS="djs-search-result-selected";gt.RESULT_SELECTED_SELECTOR="."+gt.RESULT_SELECTED_CLASS;gt.RESULT_ID_ATTRIBUTE="data-result-id";gt.RESULT_HIGHLIGHT_CLASS="djs-search-highlight";gt.OVERLAY_CLASS="djs-search-overlay";gt.BOX_HTML='<div class="djs-search-container djs-draggable djs-scrollable"><div class="djs-search-input"><input type="text"/></div><div class="djs-search-results"></div></div>';gt.RESULT_HTML='<div class="djs-search-result"></div>';gt.RESULT_PRIMARY_HTML='<div class="djs-search-result-primary"></div>';gt.RESULT_SECONDARY_HTML='<p class="djs-search-result-secondary"></p>';const Jge={__depends__:[A_,Ha],searchPad:["type",gt]};function fU(t){if(Y(t,"dmn:Decision")||Y(t,"dmn:BusinessKnowledgeModel")||Y(t,"dmn:InputData")||Y(t,"dmn:KnowledgeSource"))return"name";if(Y(t,"dmn:TextAnnotation"))return"text"}function N0(t){var e=t.businessObject,n=fU(e);if(n)return e[n]||""}function eve(t,e,n){var r=t.businessObject,i=fU(r);return i&&(r[i]=e),n&&(t.hidden=!e),t}function kT(t,e,n){this._elementRegistry=t,this._canvas=n,e.registerProvider(this)}kT.$inject=["elementRegistry","searchPad","canvas"];kT.prototype.find=function(t){var e=this._canvas.getRootElement(),n=this._elementRegistry.filter(function(r){return!r.labelTarget});return n=ht(n,function(r){return r!==e}),n=yr(n,function(r){return{primaryTokens:FD(N0(r),t),secondaryTokens:FD(r.id,t),element:r}}),n=ht(n,function(r){return BD(r.primaryTokens)||BD(r.secondaryTokens)}),n=Ei(n,function(r){return N0(r.element)+r.element.id}),n};function BD(t){var e=ht(t,function(n){return!!n.matched});return e.length>0}function FD(t,e){var n=[],r=t;if(!t)return n;t=t.toLowerCase(),e=e.toLowerCase();var i=t.indexOf(e);return i>-1?(i!==0&&n.push({normal:r.substr(0,i)}),n.push({matched:r.substr(i,e.length)}),e.length+i<t.length&&n.push({normal:r.substr(e.length+i,t.length)})):n.push({normal:r}),n}const tve={__depends__:[Jge],__init__:["dmnSearch"],dmnSearch:["type",kT]};function _d(t){Gi.call(this,t)}Ce(_d,Gi);_d.prototype._navigationModules=[Oge,$ge,zge,tve];_d.prototype._modules=[].concat(_d.prototype._modules,_d.prototype._navigationModules);function TE(t){return t&&t[t.length-1]}function zD(t){return t.y}function HD(t){return t.x}var nve={left:HD,center:HD,right:function(t){return t.x+t.width},top:zD,middle:zD,bottom:function(t){return t.y+t.height}};function Bf(t,e){this._modeling=t,this._rules=e}Bf.$inject=["modeling","rules"];Bf.prototype._getOrientationDetails=function(t){var e=["top","bottom","middle"],n="x",r="width";return e.indexOf(t)!==-1&&(n="y",r="height"),{axis:n,dimension:r}};Bf.prototype._isType=function(t,e){return e.indexOf(t)!==-1};Bf.prototype._alignmentPosition=function(t,e){var n=this._getOrientationDetails(t),r=n.axis,i=n.dimension,s={},o={},a=!1,l,c,d;function h(p,f){return Math.round((p[r]+f[r]+f[i])/2)}if(this._isType(t,["left","top"]))s[t]=e[0][r];else if(this._isType(t,["right","bottom"]))d=TE(e),s[t]=d[r]+d[i];else if(this._isType(t,["center","middle"])){if($(e,function(p){var f=p[r]+Math.round(p[i]/2);o[f]?o[f].elements.push(p):o[f]={elements:[p],center:f}}),l=Ei(o,function(p){return p.elements.length>1&&(a=!0),p.elements.length}),a)return s[t]=TE(l).center,s;c=e[0],e=Ei(e,function(p){return p[r]+p[i]}),d=TE(e),s[t]=h(c,d)}return s};Bf.prototype.trigger=function(t,e){var n=this._modeling,r,i=ht(t,function(l){return!(l.waypoints||l.host||l.labelTarget)});if(r=this._rules.allowed("elements.align",{elements:i}),ke(r)&&(i=r),!(i.length<2||!r)){var s=nve[e],o=Ei(i,s),a=this._alignmentPosition(e,o);n.alignElements(o,a)}};const rve={__init__:["alignElements"],alignElements:["type",Bf]};var ive=10,mU=50,sve=250;function gU(t,e,n,r){for(var i;i=ave(t,n,e);)n=r(e,n,i);return n}function ove(t){return function(e,n,r){var i={x:n.x,y:n.y};return["x","y"].forEach(function(s){var o=t[s];if(o){var a=s==="x"?"width":"height",l=o.margin,c=o.minDistance;l<0?i[s]=Math.min(r[s]+l-e[a]/2,n[s]-c+l):i[s]=Math.max(r[s]+r[a]+l+e[a]/2,n[s]+c+l)}}),i}}function ave(t,e,n){var r={x:e.x-n.width/2,y:e.y-n.height/2,width:n.width,height:n.height},i=cve(t);return Tt(i,function(s){if(s===n)return!1;var o=Ss(s,r,ive);return o==="intersect"})}function lve(t,e){e||(e={});function n(m){return m.source===t?1:-1}var r=e.defaultDistance||mU,i=e.direction||"e",s=e.filter,o=e.getWeight||n,a=e.maxDistance||sve,l=e.reference||"start";s||(s=hve);function c(m,g){return i==="n"?l==="start"?kt(m).top-kt(g).bottom:l==="center"?kt(m).top-fn(g).y:kt(m).top-kt(g).top:i==="w"?l==="start"?kt(m).left-kt(g).right:l==="center"?kt(m).left-fn(g).x:kt(m).left-kt(g).left:i==="s"?l==="start"?kt(g).top-kt(m).bottom:l==="center"?fn(g).y-kt(m).bottom:kt(g).bottom-kt(m).bottom:l==="start"?kt(g).left-kt(m).right:l==="center"?fn(g).x-kt(m).right:kt(g).right-kt(m).right}var d=t.incoming.filter(s).map(function(m){var g=o(m),v=g<0?c(m.source,t):c(t,m.source);return{id:m.source.id,distance:v,weight:g}}),h=t.outgoing.filter(s).map(function(m){var g=o(m),v=g>0?c(t,m.target):c(m.target,t);return{id:m.target.id,distance:v,weight:g}}),p=d.concat(h).reduce(function(m,g){return m[g.id+"__weight_"+g.weight]=g,m},{}),f=xr(p,function(m,g){var v=g.distance,b=g.weight;return v<0||v>a||(m[String(v)]||(m[String(v)]=0),m[String(v)]+=1*b,(!m.distance||m[m.distance]<m[String(v)])&&(m.distance=v)),m},{});return f.distance||r}function cve(t){var e=NE(t);return t.host&&(e=e.concat(NE(t.host))),t.attachers&&(e=e.concat(t.attachers.reduce(function(n,r){return n.concat(NE(r))},[]))),e}function NE(t){return dve(t).concat(uve(t))}function uve(t){return t.incoming.map(function(e){return e.source})}function dve(t){return t.outgoing.map(function(e){return e.target})}function hve(){return!0}var pve=100;function vU(t,e,n){t.on("autoPlace",pve,function(r){var i=r.shape,s=r.source;return fve(s,i)}),t.on("autoPlace.end",function(r){n.scrollToElement(r.shape)}),this.append=function(r,i,s){t.fire("autoPlace.start",{source:r,shape:i});var o=t.fire("autoPlace",{source:r,shape:i}),a=e.appendShape(r,i,o,r.parent,s);return t.fire("autoPlace.end",{source:r,shape:a}),a}}vU.$inject=["eventBus","modeling","canvas"];function fve(t,e,n){n||(n={});var r=n.defaultDistance||mU,i=fn(t),s=kt(t);return{x:s.right+r+e.width/2,y:i.y}}function yU(t,e){t.on("autoPlace.end",500,function(n){e.select(n.shape)})}yU.$inject=["eventBus","selection"];const mve={__init__:["autoPlaceSelectionBehavior"],autoPlace:["type",vU],autoPlaceSelectionBehavior:["type",yU]};var gve={width:135,height:46},xU={width:180,height:80},vve={width:125,height:45},yve={width:100,height:63};function th(t){Ll.call(this),this._drdFactory=t}Ce(th,Ll);th.$inject=["drdFactory"];th.prototype.baseCreate=Ll.prototype.create;th.prototype.create=function(t,e){return this.createDrdElement(t,e)};th.prototype.createDrdElement=function(t,e){var n=this._drdFactory,r;e=e||{};var i=e.businessObject;if(!i){if(!e.type)throw new Error("no shape type specified");i=n.create(e.type)}return i.di||(t==="connection"?i.di=n.createDiEdge(i,[]):t==="shape"&&(i.di=n.createDiShape(i,{}))),r=this._getDefaultSize(i),e=B({businessObject:i,id:i.id},r,e),this.baseCreate(t,e)};th.prototype._getDefaultSize=function(t){return Y(t,"dmn:BusinessKnowledgeModel")?gve:Y(t,"dmn:Decision")?xU:Y(t,"dmn:InputData")?vve:Y(t,"dmn:KnowledgeSource")?yve:{width:100,height:80}};var OE="left",UD="right",yx=60,VD=xU.width;function xve(t,e){if(Y(e,"dmn:TextAnnotation"))return bve(t,e);if(Y(e,"dmn:DRGElement"))return wve(t,e)}function bve(t,e){var n=kt(t),r={x:n.right+e.width/2,y:n.top-50-e.height/2},i={y:{margin:-30,minDistance:20}};return gU(t,e,r,ove(i))}function wve(t,e){var n=kt(t),r=fn(t);function i(a){return a.target===t?1:-1}var s=lve(t,{defaultDistance:180,direction:"s",getWeight:i,filter:_ve,reference:"center"}),o={x:r.x,y:n.bottom+s};return gU(t,e,o,Eve(t))}function _ve(t){return!Y(t,"dmn:Association")}function qD(t,e){return Math.abs(e.x-t.x)}function Eve(t){var e=fn(t),n,r;return function(i,s,o){var a;return n?(s.x<e.x?n=o:r=o,qD(e,fn(n))<qD(e,fn(r))?a=OE:a=UD):(n=o,r=o,fn(o).x-e.x>0?a=OE:a=UD),a===OE?{x:Math.min(fn(n).x-VD-yx,kt(n).left-yx-i.width/2),y:s.y}:{x:Math.max(fn(r).x+VD+yx,kt(r).right+yx+i.width/2),y:s.y}}}function bU(t){t.on("autoPlace",function(e){var n=e.shape,r=e.source;return xve(r,n)})}bU.$inject=["eventBus"];const Sve={__depends__:[mve],__init__:["dmnAutoPlace"],dmnAutoPlace:["type",bU]};var WD=1500;function wU(t,e,n){var r=this,i=n.get("dragging",!1);function s(o){if(!o.hover){var a=o.originalEvent,l=r._findTargetGfx(a),c=l&&t.get(l);l&&c&&(o.stopPropagation(),i.hover({element:c,gfx:l}),i.move(a))}}i&&e.on("drag.start",function(o){e.once("drag.move",WD,function(a){s(a)})}),function(){var o,a;e.on("element.hover",function(l){o=l.gfx,a=l.element}),e.on("element.hover",WD,function(l){a&&e.fire("element.out",{element:a,gfx:o})}),e.on("element.out",function(){o=null,a=null})}(),this._findTargetGfx=function(o){var a,l;if(o instanceof MouseEvent)return a=Hc(o),l=document.elementFromPoint(a.x,a.y),Cve(l)}}wU.$inject=["elementRegistry","eventBus","injector"];function Cve(t){return ur(t,"svg, .djs-element",!0)}const jve={__init__:["hoverFix"],hoverFix:["type",wU]};var Lh=Math.round,GD="djs-drag-active";function Hu(t){t.preventDefault()}function kve(t){return typeof TouchEvent<"u"&&t instanceof TouchEvent}function Pve(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}function _U(t,e,n,r){var i={threshold:5,trapClick:!0},s;function o(y){var w=e.viewbox(),E=e._container.getBoundingClientRect();return{x:w.x+(y.x-E.left)/w.scale,y:w.y+(y.y-E.top)/w.scale}}function a(y,w){w=w||s;var E=t.createEvent(B({},w.payload,w.data,{isTouch:w.isTouch}));return t.fire("drag."+y,E)===!1?!1:t.fire(w.prefix+"."+y,E)}function l(y){var w=y.filter(function(E){return r.get(E.id)});w.length&&n.select(w)}function c(y,w){var E=s.payload,S=s.displacement,j=s.globalStart,C=Hc(y),P=vp(C,j),R=s.localStart,N=o(C),I=vp(N,R);if(!s.active&&(w||Pve(P)>s.threshold)){if(B(E,{x:Lh(R.x+S.x),y:Lh(R.y+S.y),dx:0,dy:0},{originalEvent:y}),a("start")===!1)return v();s.active=!0,s.keepSelection||(E.previousSelection=n.get(),n.select(null)),s.cursor&&ET(s.cursor),e.addMarker(e.getRootElement(),GD)}kE(y),s.active&&(B(E,{x:Lh(N.x+S.x),y:Lh(N.y+S.y),dx:Lh(I.x),dy:Lh(I.y)},{originalEvent:y}),a("move"))}function d(y){var w,E=!0;s.active&&(y&&(s.payload.originalEvent=y,kE(y)),E=a("end")),E===!1&&a("rejected"),w=b(E!==!0),a("ended",w)}function h(y){Br("Escape",y)&&(Hu(y),v())}function p(y){var w;s.active&&(w=cU(t),setTimeout(w,400),Hu(y)),d(y)}function f(y){c(y)}function m(y){var w=s.payload;w.hoverGfx=y.gfx,w.hover=y.element,a("hover")}function g(y){a("out");var w=s.payload;w.hoverGfx=null,w.hover=null}function v(y){var w;if(s){var E=s.active;E&&a("cancel"),w=b(y),E&&a("canceled",w)}}function b(y){var w,E;a("cleanup"),lU(),s.trapClick?E=p:E=d,ie.unbind(document,"mousemove",c),ie.unbind(document,"dragstart",Hu),ie.unbind(document,"selectstart",Hu),ie.unbind(document,"mousedown",E,!0),ie.unbind(document,"mouseup",E,!0),ie.unbind(document,"keyup",h),ie.unbind(document,"touchstart",f,!0),ie.unbind(document,"touchcancel",v,!0),ie.unbind(document,"touchmove",c,!0),ie.unbind(document,"touchend",d,!0),t.off("element.hover",m),t.off("element.out",g),e.removeMarker(e.getRootElement(),GD);var S=s.payload.previousSelection;return y!==!1&&S&&!n.get().length&&l(S),w=s,s=null,w}function x(y,w,E,S){s&&v(!1),typeof w=="string"&&(S=E,E=w,w=null),S=B({},i,S||{});var j=S.data||{},C,P,R,N,I;S.trapClick?N=p:N=d,y?(C=Mf(y)||y,P=Hc(y),kE(y),C.type==="dragstart"&&Hu(C)):(C=null,P={x:0,y:0}),R=o(P),w||(w=R),I=kve(C),s=B({prefix:E,data:j,payload:{},globalStart:P,displacement:vp(w,R),localStart:R,isTouch:I},S),S.manual||(I?(ie.bind(document,"touchstart",f,!0),ie.bind(document,"touchcancel",v,!0),ie.bind(document,"touchmove",c,!0),ie.bind(document,"touchend",d,!0)):(ie.bind(document,"mousemove",c),ie.bind(document,"dragstart",Hu),ie.bind(document,"selectstart",Hu),ie.bind(document,"mousedown",N,!0),ie.bind(document,"mouseup",N,!0)),ie.bind(document,"keyup",h),t.on("element.hover",m),t.on("element.out",g)),a("init"),S.autoActivate&&c(y,!0)}t.on("diagram.destroy",v),this.init=x,this.move=c,this.hover=m,this.out=g,this.end=d,this.cancel=v,this.context=function(){return s},this.setOptions=function(y){B(i,y)}}_U.$inject=["eventBus","canvas","selection","elementRegistry"];const nh={__depends__:[jve,Ha],dragging:["type",_U]};function Ff(t,e,n){this._canvas=n,this._opts=B({scrollThresholdIn:[20,20,20,20],scrollThresholdOut:[0,0,0,0],scrollRepeatTimeout:15,scrollStep:10},t);var r=this;e.on("drag.move",function(i){var s=r._toBorderPoint(i);r.startScroll(s)}),e.on(["drag.cleanup"],function(){r.stopScroll()})}Ff.$inject=["config.autoScroll","eventBus","canvas"];Ff.prototype.startScroll=function(t){var e=this._canvas,n=this._opts,r=this,i=e.getContainer().getBoundingClientRect(),s=[t.x,t.y,i.width-t.x,i.height-t.y];this.stopScroll();for(var o=0,a=0,l=0;l<4;l++)Tve(s[l],n.scrollThresholdOut[l],n.scrollThresholdIn[l])&&(l===0?o=n.scrollStep:l==1?a=n.scrollStep:l==2?o=-n.scrollStep:l==3&&(a=-n.scrollStep));(o!==0||a!==0)&&(e.scroll({dx:o,dy:a}),this._scrolling=setTimeout(function(){r.startScroll(t)},n.scrollRepeatTimeout))};function Tve(t,e,n){return e<t&&t<n}Ff.prototype.stopScroll=function(){clearTimeout(this._scrolling)};Ff.prototype.setOptions=function(t){this._opts=B({},this._opts,t)};Ff.prototype._toBorderPoint=function(t){var e=this._canvas._container.getBoundingClientRect(),n=Hc(t.originalEvent);return{x:n.x-e.left,y:n.y-e.top}};const Nve={__depends__:[nh],__init__:["autoScroll"],autoScroll:["type",Ff]};function PT(t){this._commandStack=t.get("commandStack",!1)}PT.$inject=["injector"];PT.prototype.allowed=function(t,e){var n=!0,r=this._commandStack;return r&&(n=r.canExecute(t,e)),n===void 0?!0:n};const zf={__init__:["rules"],rules:["type",PT]};var xx=Math.round,Ove=Math.max;function Rve(t,e){var n=t.x,r=t.y;return[["M",n,r],["m",0,-e],["a",e,e,0,1,1,0,2*e],["a",e,e,0,1,1,0,-2*e],["z"]]}function Ave(t){var e=[];return t.forEach(function(n,r){e.push([r===0?"M":"L",n.x,n.y])}),e}var EU=10;function Ive(t,e){var n,r;for(n=0;r=t[n];n++)if(T_(r,e)<=EU)return{point:t[n],bendpoint:!0,index:n};return null}function Dve(t,e){var n=Ck(Rve(e,EU),Ave(t)),r=n[0],i=n[n.length-1],s;return r?r!==i?r.segment2!==i.segment2?(s=Ove(r.segment2,i.segment2)-1,{point:t[s],bendpoint:!0,index:s}):{point:{x:xx(r.x+i.x)/2,y:xx(r.y+i.y)/2},index:r.segment2}:{point:{x:xx(r.x),y:xx(r.y)},index:r.segment2}:null}function $ve(t,e){return Ive(t,e)||Dve(t,e)}function Mve(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}function Lve(t,e,n){var r=[{n:t[0]-n[0],lambda:e[0]},{n:t[1]-n[1],lambda:e[1]}],i=r[0].n*e[0]+r[1].n*e[1],s=r[0].lambda*e[0]+r[1].lambda*e[1];return-i/s}function SU(t,e){var n=e[0],r=e[1],i={x:r.x-n.x,y:r.y-n.y},s=Lve([n.x,n.y],[i.x,i.y],[t.x,t.y]);return{x:n.x+s*i.x,y:n.y+s*i.y}}function Bve(t,e){var n=SU(t,e),r={x:n.x-t.x,y:n.y-t.y};return Mve(r)}var CU="djs-bendpoint",jU="djs-segment-dragger";function Fve(t,e){var n=Hc(e),r=t._container.getBoundingClientRect(),i;i={x:r.left,y:r.top};var s=t.viewbox();return{x:s.x+(n.x-i.x)/s.scale,y:s.y+(n.y-i.y)/s.scale}}function YC(t,e,n){var r=Fve(t,n),i=$ve(e,r);return i}function XC(t,e){var n=ee("g");Ge(n).add(CU),re(t,n);var r=ee("circle");K(r,{cx:0,cy:0,r:4}),Ge(r).add("djs-visual"),re(n,r);var i=ee("circle");return K(i,{cx:0,cy:0,r:10}),Ge(i).add("djs-hit"),re(n,i),e&&Ge(n).add(e),n}function zve(t,e,n,r){var i=ee("g");re(t,i);var s=18,o=6,a=11,l=Uve(e,n,r),c=o+a,d=ee("rect");K(d,{x:-s/2,y:-o/2,width:s,height:o}),Ge(d).add("djs-visual"),re(i,d);var h=ee("rect");return K(h,{x:-l/2,y:-c/2,width:l,height:c}),Ge(h).add("djs-hit"),re(i,h),Ffe(i,r==="v"?90:0),i}function kU(t,e,n){var r=ee("g"),i=zC(e,n),s=tp(e,n);return re(t,r),zve(r,e,n,s),Ge(r).add(jU),Ge(r).add(s==="h"?"horizontal":"vertical"),Ta(r,i.x,i.y),r}function QC(t){return Math.abs(Math.round(t*2/3))}function Hve(t,e){var n=Vve(t,e);return SU(t,n)}function Uve(t,e,n){var r=e.x-t.x,i=e.y-t.y;return QC(n==="h"?r:i)}function Vve(t,e){for(var n=e.waypoints,r=1/0,i,s=0;s<n.length-1;s++){var o=n[s],a=n[s+1],l=Bve(t,[o,a]);l<r&&(r=l,i=s)}return[n[i],n[i+1]]}function PU(t,e,n,r,i){function s(y,w,E){var S=y.index,j=y.point,C,P,R,N,I,M;return S<=0||y.bendpoint?!1:(C=w[S-1],P=w[S],R=zC(C,P),N=tp(C,P),I=Math.abs(j.x-R.x),M=Math.abs(j.y-R.y),N&&I<=E&&M<=E)}function o(y,w){var E=y.waypoints,S,j,C,P;return w.index<=0||w.bendpoint||(S={start:E[w.index-1],end:E[w.index]},j=tp(S.start,S.end),!j)?null:(j==="h"?C=S.end.x-S.start.x:C=S.end.y-S.start.y,P=QC(C)/2,P)}function a(y,w){var E=w.waypoints,S=YC(e,E,y),j;if(S)return j=o(w,S),s(S,E,j)?i.start(y,w,S.index):r.start(y,w,S.index,!S.bendpoint),!0}function l(y,w,E){ie.bind(y,w,function(S){n.triggerMouseEvent(w,S,E),S.stopPropagation()})}function c(y,w){var E=e.getLayer("overlays"),S=at('.djs-bendpoints[data-element-id="'+CT(y.id)+'"]',E);return!S&&w&&(S=ee("g"),K(S,{"data-element-id":y.id}),Ge(S).add("djs-bendpoints"),re(E,S),l(S,"mousedown",y),l(S,"click",y),l(S,"dblclick",y)),S}function d(y,w){return at('.djs-segment-dragger[data-segment-idx="'+y+'"]',w)}function h(y,w){w.waypoints.forEach(function(E,S){var j=XC(y);re(y,j),Ta(j,E.x,E.y)}),XC(y,"floating")}function p(y,w){for(var E=w.waypoints,S,j,C,P=1;P<E.length;P++)S=E[P-1],j=E[P],tp(S,j)&&(C=kU(y,S,j),K(C,{"data-segment-idx":P}),l(C,"mousemove",w))}function f(y){$(zo("."+CU,y),function(w){un(w)})}function m(y){$(zo("."+jU,y),function(w){un(w)})}function g(y){var w=c(y);return w||(w=c(y,!0),h(w,y),p(w,y)),w}function v(y){var w=c(y);w&&(m(w),f(w),p(w,y),h(w,y))}function b(y,w){var E=at(".floating",y),S=w.point;E&&Ta(E,S.x,S.y)}function x(y,w,E){var S=d(w.index,y),j=E[w.index-1],C=E[w.index],P=w.point,R=zC(j,C),N=tp(j,C),I,M;S&&(I=qve(S),M={x:P.x-R.x,y:P.y-R.y},N==="v"&&(M={x:M.y,y:M.x}),Ta(I,M.x,M.y))}t.on("connection.changed",function(y){v(y.element)}),t.on("connection.remove",function(y){var w=c(y.element);w&&un(w)}),t.on("element.marker.update",function(y){var w=y.element,E;w.waypoints&&(E=g(w),y.add?Ge(E).add(y.marker):Ge(E).remove(y.marker))}),t.on("element.mousemove",function(y){var w=y.element,E=w.waypoints,S,j;if(E){if(S=c(w,!0),j=YC(e,E,y.originalEvent),!j)return;b(S,j),j.bendpoint||x(S,j,E)}}),t.on("element.mousedown",function(y){if(uu(y)){var w=y.originalEvent,E=y.element;if(E.waypoints)return a(w,E)}}),t.on("selection.changed",function(y){var w=y.newSelection,E=w[0];E&&E.waypoints&&g(E)}),t.on("element.hover",function(y){var w=y.element;w.waypoints&&(g(w),n.registerEvent(y.gfx,"mousemove","element.mousemove"))}),t.on("element.out",function(y){n.unregisterEvent(y.gfx,"mousemove","element.mousemove")}),t.on("element.updateId",function(y){var w=y.element,E=y.newId;if(w.waypoints){var S=c(w);S&&K(S,{"data-element-id":E})}}),this.addHandles=g,this.updateHandles=v,this.getBendpointsContainer=c,this.getSegmentDragger=d}PU.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"];function qve(t){return at(".djs-visual",t)}var KD=Math.round,Yu="reconnectStart",Xu="reconnectEnd",Pm="updateWaypoints";function TT(t,e,n,r,i,s){this._injector=t,this.start=function(o,a,l,c){var d=n.getGraphics(a),h=a.source,p=a.target,f=a.waypoints,m;!c&&l===0?m=Yu:!c&&l===f.length-1?m=Xu:m=Pm;var g=m===Pm?"connection.updateWaypoints":"connection.reconnect",v=i.allowed(g,{connection:a,source:h,target:p});v===!1&&(v=i.allowed(g,{connection:a,source:p,target:h})),v!==!1&&r.init(o,"bendpoint.move",{data:{connection:a,connectionGfx:d,context:{allowed:v,bendpointIndex:l,connection:a,source:h,target:p,insert:c,type:m}}})},e.on("bendpoint.move.hover",function(o){var a=o.context,l=a.connection,c=l.source,d=l.target,h=o.hover,p=a.type;a.hover=h;var f;if(h){var m=p===Pm?"connection.updateWaypoints":"connection.reconnect";if(f=a.allowed=i.allowed(m,{connection:l,source:p===Yu?h:c,target:p===Xu?h:d}),f){a.source=p===Yu?h:c,a.target=p===Xu?h:d;return}f===!1&&(f=a.allowed=i.allowed(m,{connection:l,source:p===Xu?h:d,target:p===Yu?h:c})),f&&(a.source=p===Xu?h:d,a.target=p===Yu?h:c)}}),e.on(["bendpoint.move.out","bendpoint.move.cleanup"],function(o){var a=o.context,l=a.type;a.hover=null,a.source=null,a.target=null,l!==Pm&&(a.allowed=!1)}),e.on("bendpoint.move.end",function(o){var a=o.context,l=a.allowed,c=a.bendpointIndex,d=a.connection,h=a.insert,p=d.waypoints.slice(),f=a.source,m=a.target,g=a.type,v=a.hints||{},b={x:KD(o.x),y:KD(o.y)};if(!l)return!1;g===Pm?(h?p.splice(c,0,b):p[c]=b,v.bendpointMove={insert:h,bendpointIndex:c},p=this.cropWaypoints(d,p),s.updateWaypoints(d,jfe(p),v)):(g===Yu?(v.docking="source",O0(a)&&(v.docking="target",v.newWaypoints=p.reverse())):g===Xu&&(v.docking="target",O0(a)&&(v.docking="source",v.newWaypoints=p.reverse())),s.reconnect(d,f,m,b,v))},this)}TT.$inject=["injector","eventBus","canvas","dragging","rules","modeling"];TT.prototype.cropWaypoints=function(t,e){var n=this._injector.get("connectionDocking",!1);if(!n)return e;var r=t.waypoints;return t.waypoints=e,t.waypoints=n.getCroppedWaypoints(t),e=t.waypoints,t.waypoints=r,e};function O0(t){var e=t.hover,n=t.source,r=t.target,i=t.type;if(i===Yu)return e&&r&&e===r&&n!==r;if(i===Xu)return e&&n&&e===n&&n!==r}var Wve="reconnectStart",Gve="reconnectEnd",YD="updateWaypoints",Tm="connect-ok",bx="connect-not-ok",XD="connect-hover",QD="djs-updating",ZD="djs-dragging",JD=1100;function TU(t,e,n,r){this._injector=e;var i=e.get("connectionPreview",!1);n.on("bendpoint.move.start",function(s){var o=s.context,a=o.bendpointIndex,l=o.connection,c=o.insert,d=l.waypoints,h=d.slice();o.waypoints=d,c&&h.splice(a,0,{x:s.x,y:s.y}),l.waypoints=h;var p=o.draggerGfx=XC(r.getLayer("overlays"));Ge(p).add("djs-dragging"),r.addMarker(l,ZD),r.addMarker(l,QD)}),n.on("bendpoint.move.hover",function(s){var o=s.context,a=o.allowed,l=o.hover,c=o.type;if(l){if(r.addMarker(l,XD),c===YD)return;a?(r.removeMarker(l,bx),r.addMarker(l,Tm)):a===!1&&(r.removeMarker(l,Tm),r.addMarker(l,bx))}}),n.on(["bendpoint.move.out","bendpoint.move.cleanup"],JD,function(s){var o=s.context,a=o.hover,l=o.target;a&&(r.removeMarker(a,XD),r.removeMarker(a,l?Tm:bx))}),n.on("bendpoint.move.move",function(s){var o=s.context,a=o.allowed,l=o.bendpointIndex,c=o.draggerGfx,d=o.hover,h=o.type,p=o.connection,f=p.source,m=p.target,g=p.waypoints.slice(),v={x:s.x,y:s.y},b=o.hints||{},x={};i&&(b.connectionStart&&(x.connectionStart=b.connectionStart),b.connectionEnd&&(x.connectionEnd=b.connectionEnd),h===Wve?O0(o)?(x.connectionEnd=x.connectionEnd||v,x.source=m,x.target=d||f,g=g.reverse()):(x.connectionStart=x.connectionStart||v,x.source=d||f,x.target=m):h===Gve?O0(o)?(x.connectionStart=x.connectionStart||v,x.source=d||m,x.target=f,g=g.reverse()):(x.connectionEnd=x.connectionEnd||v,x.source=f,x.target=d||m):(x.noCropping=!0,x.noLayout=!0,g[l]=v),h===YD&&(g=t.cropWaypoints(p,g)),x.waypoints=g,i.drawPreview(o,a,x)),Ta(c,s.x,s.y)},this),n.on(["bendpoint.move.end","bendpoint.move.cancel"],JD,function(s){var o=s.context,a=o.connection,l=o.draggerGfx,c=o.hover,d=o.target,h=o.waypoints;a.waypoints=h,un(l),r.removeMarker(a,QD),r.removeMarker(a,ZD),c&&(r.removeMarker(c,Tm),r.removeMarker(c,d?Tm:bx)),i&&i.cleanUp(o)})}TU.$inject=["bendpointMove","injector","eventBus","canvas"];var e$="connect-hover",t$="djs-updating";function n$(t,e,n){return NT(t,e,t[e]+n)}function NT(t,e,n){return{x:e==="x"?n:t.x,y:e==="y"?n:t.y}}function Kve(t,e,n,r){var i=Math.max(e[r],n[r]),s=Math.min(e[r],n[r]),o=20,a=Math.min(Math.max(s+o,t[r]),i-o);return NT(e,r,a)}function NU(t){return t==="x"?"y":"x"}function r$(t,e,n){var r,i;return t.original?t.original:(r=fn(e),i=NU(n),NT(t,i,r[i]))}function OU(t,e,n,r,i,s){var o=t.get("connectionDocking",!1);this.start=function(h,p,f){var m,g=n.getGraphics(p),v=f-1,b=f,x=p.waypoints,y=x[v],w=x[b],E=YC(n,x,h),S,j,C;S=tp(y,w),S&&(j=S==="v"?"x":"y",v===0&&(y=r$(y,p.source,j)),b===x.length-1&&(w=r$(w,p.target,j)),E?C=E.point:C={x:(y.x+w.x)/2,y:(y.y+w.y)/2},m={connection:p,segmentStartIndex:v,segmentEndIndex:b,segmentStart:y,segmentEnd:w,axis:j,dragPosition:C},r.init(h,C,"connectionSegment.move",{cursor:j==="x"?"resize-ew":"resize-ns",data:{connection:p,connectionGfx:g,context:m}}))};function a(h,p){if(!o)return p;var f=h.waypoints,m;return h.waypoints=p,m=o.getCroppedWaypoints(h),h.waypoints=f,m}function l(h){i.update("connection",h.connection,h.connectionGfx)}function c(h,p,f){var m=h.newWaypoints,g=h.segmentStartIndex+p,v=m[g],b=h.segmentEndIndex+p,x=m[b],y=NU(h.axis),w=Kve(f,v,x,y);Ta(h.draggerGfx,w.x,w.y)}function d(h,p){var f=0,m=h.filter(function(g,v){return fH(h[v-1],h[v+1],g)?(f=v<=p?f-1:f,!1):!0});return{waypoints:m,segmentOffset:f}}e.on("connectionSegment.move.start",function(h){var p=h.context,f=h.connection,m=n.getLayer("overlays");p.originalWaypoints=f.waypoints.slice(),p.draggerGfx=kU(m,p.segmentStart,p.segmentEnd),Ge(p.draggerGfx).add("djs-dragging"),n.addMarker(f,t$)}),e.on("connectionSegment.move.move",function(h){var p=h.context,f=p.connection,m=p.segmentStartIndex,g=p.segmentEndIndex,v=p.segmentStart,b=p.segmentEnd,x=p.axis,y=p.originalWaypoints.slice(),w=n$(v,x,h["d"+x]),E=n$(b,x,h["d"+x]),S=y.length,j=0;y[m]=w,y[g]=E;var C,P;m<2&&(C=Ss(f.source,w),m===1?C==="intersect"&&(y.shift(),y[0]=w,j--):C!=="intersect"&&(y.unshift(v),j++)),g>S-3&&(P=Ss(f.target,E),g===S-2?P==="intersect"&&(y.pop(),y[y.length-1]=E):P!=="intersect"&&y.push(b)),p.newWaypoints=f.waypoints=a(f,y),c(p,j,h),p.newSegmentStartIndex=m+j,l(h)}),e.on("connectionSegment.move.hover",function(h){h.context.hover=h.hover,n.addMarker(h.hover,e$)}),e.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],function(h){var p=h.context.hover;p&&n.removeMarker(p,e$)}),e.on("connectionSegment.move.cleanup",function(h){var p=h.context,f=p.connection;p.draggerGfx&&un(p.draggerGfx),n.removeMarker(f,t$)}),e.on(["connectionSegment.move.cancel","connectionSegment.move.end"],function(h){var p=h.context,f=p.connection;f.waypoints=p.originalWaypoints,l(h)}),e.on("connectionSegment.move.end",function(h){var p=h.context,f=p.connection,m=p.newWaypoints,g=p.newSegmentStartIndex;m=m.map(function(E){return{original:E.original,x:Math.round(E.x),y:Math.round(E.y)}});var v=d(m,g),b=v.waypoints,x=a(f,b),y=v.segmentOffset,w={segmentMove:{segmentStartIndex:p.segmentStartIndex,newSegmentStartIndex:g+y}};s.updateWaypoints(f,x,w)})}OU.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","modeling"];var Yve=Math.abs,i$=Math.round;function Xve(t,e,n){n=n===void 0?10:n;var r,i;for(r=0;r<e.length;r++)if(i=e[r],Yve(i-t)<=n)return i}function Qve(t){return{x:t.x,y:t.y}}function Zve(t){return{x:t.x+t.width,y:t.y+t.height}}function yp(t,e){return!t||isNaN(t.x)||isNaN(t.y)?e:{x:i$(t.x+t.width/2),y:i$(t.y+t.height/2)}}function Gg(t,e){var n=t.snapped;return n?typeof e=="string"?n[e]:n.x&&n.y:!1}function ba(t,e,n){if(typeof e!="string")throw new Error("axis must be in [x, y]");if(typeof n!="number"&&n!==!1)throw new Error("value must be Number or false");var r,i=t[e],s=t.snapped=t.snapped||{};return n===!1?s[e]=!1:(s[e]=!0,r=n-i,t[e]+=r,t["d"+e]+=r),i}function RU(t){return t.children||[]}var Jve=Math.abs,s$=Math.round,RE=10;function AU(t){function e(s,o){if(ke(s)){for(var a=s.length;a--;)if(Jve(s[a]-o)<=RE)return s[a]}else{s=+s;var l=o%s;if(l<RE)return o-l;if(l>s-RE)return o-l+s}return o}function n(s,o){if(s.waypoints)return Hve(o,s);if(s.width)return{x:s$(s.width/2+s.x),y:s$(s.height/2+s.y)}}function r(s){var o=s.context,a=o.snapPoints,l=o.connection,c=l.waypoints,d=o.segmentStart,h=o.segmentStartIndex,p=o.segmentEnd,f=o.segmentEndIndex,m=o.axis;if(a)return a;var g=[c[h-1],d,p,c[f+1]];return h<2&&g.unshift(n(l.source,s)),f>c.length-3&&g.unshift(n(l.target,s)),o.snapPoints=a={horizontal:[],vertical:[]},$(g,function(v){v&&(v=v.original||v,m==="y"&&a.horizontal.push(v.y),m==="x"&&a.vertical.push(v.x))}),a}t.on("connectionSegment.move.move",1500,function(s){var o=r(s),a=s.x,l=s.y,c,d;if(o){c=e(o.vertical,a),d=e(o.horizontal,l);var h=a-c,p=l-d;B(s,{dx:s.dx-h,dy:s.dy-p,x:c,y:d}),(h||o.vertical.indexOf(a)!==-1)&&ba(s,"x",c),(p||o.horizontal.indexOf(l)!==-1)&&ba(s,"y",d)}});function i(s){var o=s.snapPoints,a=s.connection.waypoints,l=s.bendpointIndex;if(o)return o;var c=[a[l-1],a[l+1]];return s.snapPoints=o={horizontal:[],vertical:[]},$(c,function(d){d&&(d=d.original||d,o.horizontal.push(d.y),o.vertical.push(d.x))}),o}t.on(["connect.hover","connect.move","connect.end"],1500,function(s){var o=s.context,a=o.hover,l=a&&n(a,s);!Mi(a)||!l||!l.x||!l.y||(ba(s,"x",l.x),ba(s,"y",l.y))}),t.on(["bendpoint.move.move","bendpoint.move.end"],1500,function(s){var o=s.context,a=i(o),l=o.hover,c=l&&n(l,s),d=s.x,h=s.y,p,f;if(a){p=e(c?a.vertical.concat([c.x]):a.vertical,d),f=e(c?a.horizontal.concat([c.y]):a.horizontal,h);var m=d-p,g=h-f;B(s,{dx:s.dx-m,dy:s.dy-g,x:s.x-m,y:s.y-g}),(m||a.vertical.indexOf(d)!==-1)&&ba(s,"x",p),(g||a.horizontal.indexOf(h)!==-1)&&ba(s,"y",f)}})}AU.$inject=["eventBus"];const eye={__depends__:[nh,zf],__init__:["bendpoints","bendpointSnapping","bendpointMovePreview"],bendpoints:["type",PU],bendpointMove:["type",TT],bendpointMovePreview:["type",TU],connectionSegmentMove:["type",OU],bendpointSnapping:["type",AU]};var wx=".entry",tye=1e3,o$=12,nye=300;function Ki(t,e,n,r){this._canvas=t,this._eventBus=n,this._overlays=r;var i=an(e&&e.scale)?e.scale:{min:1,max:1.5};this._overlaysConfig={scale:i},this._current=null,this._init()}Ki.$inject=["canvas","config.contextPad","eventBus","overlays"];Ki.prototype._init=function(){var t=this;this._eventBus.on("selection.changed",function(e){var n=e.newSelection,r=n.length?n.length===1?n[0]:n:null;r?t.open(r,!0):t.close()}),this._eventBus.on("elements.changed",function(e){var n=e.elements,r=t._current;if(r){var i=r.target,s=Yc(ke(i)?i:[i],function(o){return IU(n,o)});s&&t.open(i,!0)}})};Ki.prototype.registerProvider=function(t,e){e||(e=t,t=tye),this._eventBus.on("contextPad.getProviders",t,function(n){n.providers.push(e)})};Ki.prototype.getEntries=function(t){var e=this._getProviders(),n=ke(t)?"getMultiElementContextPadEntries":"getContextPadEntries",r={};return $(e,function(i){if(Bt(i[n])){var s=i[n](t);Bt(s)?r=s(r):$(s,function(o,a){r[a]=o})}}),r};Ki.prototype.trigger=function(t,e,n){var r,i,s=e.delegateTarget||e.target;return s?(r=vn(s,"data-action"),i=e.originalEvent||e,t==="mouseover"?this._timeout=setTimeout(()=>{this._mouseout=this.triggerEntry(r,"hover",i,n)},nye):t==="mouseout"&&(clearTimeout(this._timeout),this._mouseout&&(this._mouseout(),this._mouseout=null)),this.triggerEntry(r,t,i,n)):e.preventDefault()};Ki.prototype.triggerEntry=function(t,e,n,r){if(this.isShown()){var i=this._current.target,s=this._current.entries,o=s[t];if(o){var a=o.action;if(this._eventBus.fire("contextPad.trigger",{entry:o,event:n})!==!1){if(Bt(a)){if(e==="click")return a(n,i,r)}else if(a[e])return a[e](n,i,r);n.preventDefault()}}}};Ki.prototype.open=function(t,e){!e&&this.isOpen(t)||(this.close(),this._updateAndOpen(t))};Ki.prototype._getProviders=function(){var t=this._eventBus.createEvent({type:"contextPad.getProviders",providers:[]});return this._eventBus.fire(t),t.providers};Ki.prototype._updateAndOpen=function(t){var e=this.getEntries(t),n=this.getPad(t),r=n.html,i;$(e,function(s,o){var a=s.group||"default",l=bt(s.html||'<div class="entry" draggable="true"></div>'),c;vn(l,"data-action",o),c=at("[data-group="+CT(a)+"]",r),c||(c=bt('<div class="group"></div>'),vn(c,"data-group",a),r.appendChild(c)),c.appendChild(l),s.className&&rye(l,s.className),s.title&&vn(l,"title",s.title),s.imageUrl&&(i=bt("<img>"),vn(i,"src",s.imageUrl),i.style.width="100%",i.style.height="100%",l.appendChild(i))}),vt(r).add("open"),this._current={target:t,entries:e,pad:n},this._eventBus.fire("contextPad.open",{current:this._current})};Ki.prototype.getPad=function(t){if(this.isOpen())return this._current.pad;var e=this,n=this._overlays,r=bt('<div class="djs-context-pad"></div>'),i=this._getPosition(t),s=B({html:r},this._overlaysConfig,i);Zn.bind(r,wx,"click",function(l){e.trigger("click",l)}),Zn.bind(r,wx,"dragstart",function(l){e.trigger("dragstart",l)}),Zn.bind(r,wx,"mouseover",function(l){e.trigger("mouseover",l)}),Zn.bind(r,wx,"mouseout",function(l){e.trigger("mouseout",l)}),ie.bind(r,"mousedown",function(l){l.stopPropagation()});var o=this._canvas.getRootElement();this._overlayId=n.add(o,"context-pad",s);var a=n.get(this._overlayId);return this._eventBus.fire("contextPad.create",{target:t,pad:a}),a};Ki.prototype.close=function(){this.isOpen()&&(clearTimeout(this._timeout),this._overlays.remove(this._overlayId),this._overlayId=null,this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)};Ki.prototype.isOpen=function(t){var e=this._current;if(!e)return!1;if(!t)return!0;var n=e.target;return ke(t)!==ke(n)?!1:ke(t)?t.length===n.length&&Zs(t,function(r){return IU(n,r)}):n===t};Ki.prototype.isShown=function(){return this.isOpen()&&this._overlays.isShown()};Ki.prototype._getPosition=function(t){t=Mi(t)?iye(t):t;var e=ke(t)?t:[t],n=Ps(e);return{position:{left:n.x+n.width+o$,top:n.y-o$/2}}};function rye(t,e){var n=vt(t);e=ke(e)?e:e.split(/\s+/g),e.forEach(function(r){n.add(r)})}function IU(t,e){return t.indexOf(e)!==-1}function iye(t){return t.waypoints[t.waypoints.length-1]}const sye={__depends__:[ry,A_],contextPad:["type",Ki]};function DU(t,e,n,r){function i(o,a){return r.allowed("connection.create",{source:o,target:a})}function s(o,a){return i(a,o)}t.on("connect.hover",function(o){var a=o.context,l=a.start,c=o.hover,d;if(a.hover=c,d=a.canExecute=i(l,c),!jg(d)){if(d!==!1){a.source=l,a.target=c;return}d=a.canExecute=s(l,c),!jg(d)&&d!==!1&&(a.source=c,a.target=l)}}),t.on(["connect.out","connect.cleanup"],function(o){var a=o.context;a.hover=null,a.source=null,a.target=null,a.canExecute=!1}),t.on("connect.end",function(o){var a=o.context,l=a.canExecute,c=a.connectionStart,d={x:o.x,y:o.y},h=a.source,p=a.target;if(!l)return!1;var f=null,m={connectionStart:ZC(a)?d:c,connectionEnd:ZC(a)?c:d};Wn(l)&&(f=l),a.connection=n.connect(h,p,f,m)}),this.start=function(o,a,l,c){Wn(l)||(c=l,l=fn(a)),e.init(o,"connect",{autoActivate:c,data:{shape:a,context:{start:a,connectionStart:l}}})}}DU.$inject=["eventBus","dragging","modeling","rules"];function ZC(t){var e=t.hover,n=t.source,r=t.target;return e&&n&&e===n&&n!==r}var oye=1100,aye=900,a$="connect-ok",l$="connect-not-ok";function $U(t,e,n){var r=t.get("connectionPreview",!1);r&&e.on("connect.move",function(i){var s=i.context,o=s.canExecute,a=s.hover,l=s.source,c=s.start,d=s.startPosition,h=s.target,p=s.connectionStart||d,f=s.connectionEnd||{x:i.x,y:i.y},m=p,g=f;ZC(s)&&(m=f,g=p),r.drawPreview(s,o,{source:l||c,target:h||a,connectionStart:m,connectionEnd:g})}),e.on("connect.hover",aye,function(i){var s=i.context,o=i.hover,a=s.canExecute;a!==null&&n.addMarker(o,a?a$:l$)}),e.on(["connect.out","connect.cleanup"],oye,function(i){var s=i.hover;s&&(n.removeMarker(s,a$),n.removeMarker(s,l$))}),r&&e.on("connect.cleanup",function(i){r.cleanUp(i.context)})}$U.$inject=["injector","eventBus","canvas"];const lye={__depends__:[Ha,zf,nh],__init__:["connectPreview"],connect:["type",DU],connectPreview:["type",$U]};var cye=["marker-start","marker-mid","marker-end"],uye=["circle","ellipse","line","path","polygon","polyline","path","rect"];function du(t,e,n,r){this._elementRegistry=t,this._canvas=n,this._styles=r,this._clonedMarkers={};var i=this;e.on("drag.cleanup",function(){i.cleanUp()})}du.$inject=["elementRegistry","eventBus","canvas","styles"];du.prototype.cleanUp=function(){var t=this;$(t._clonedMarkers,function(e){un(e)}),t._clonedMarkers={}};du.prototype.getGfx=function(t){return this._elementRegistry.getGraphics(t)};du.prototype.addDragger=function(t,e,n,r="djs-dragger"){n=n||this.getGfx(t);var i=pw(n),s=n.getBoundingClientRect();return this._cloneMarkers(C0(i),r),K(i,this._styles.cls(r,[],{x:s.top,y:s.left})),re(e,i),K(i,"data-preview-support-element-id",t.id),i};du.prototype.addFrame=function(t,e){var n=ee("rect",{class:"djs-resize-overlay",width:t.width,height:t.height,x:t.x,y:t.y});return re(e,n),K(n,"data-preview-support-element-id",t.id),n};du.prototype._cloneMarkers=function(t,e="djs-dragger"){var n=this;if(t.childNodes)for(var r=0;r<t.childNodes.length;r++)n._cloneMarkers(t.childNodes[r],e);fye(t)&&cye.forEach(function(i){if(K(t,i)){var s=dye(t,i,n._canvas.getContainer());n._cloneMarker(t,s,i,e)}})};du.prototype._cloneMarker=function(t,e,n,r="djs-dragger"){var i=e.id+"-"+r,s=this._clonedMarkers[i];if(!s){s=pw(e);var o=i+"-clone";s.id=o,Ge(s).add(r),this._clonedMarkers[i]=s;var a=at("defs",this._canvas._svg);a||(a=ee("defs"),re(this._canvas._svg,a)),re(a,s)}var l=pye(this._clonedMarkers[i].id);K(t,n,l)};function dye(t,e,n){var r=hye(K(t,e));return at("marker#"+r,n||document)}function hye(t){return t.match(/url\(['"]?#([^'"]*)['"]?\)/)[1]}function pye(t){return"url(#"+t+")"}function fye(t){return uye.indexOf(t.nodeName)!==-1}const OT={__init__:["previewSupport"],previewSupport:["type",du]};var mye="drop-ok",c$="drop-not-ok",u$="attach-ok",d$="new-parent",h$="create",gye=2e3;function MU(t,e,n,r,i){function s(l,c,d,h,p){if(!c)return!1;l=ht(l,function(x){var y=x.labelTarget;return!x.parent&&!(Xp(x)&&l.indexOf(y)!==-1)});var f=Tt(l,function(x){return!Mi(x)}),m=!1,g=!1,v=!1;f$(l)&&(m=i.allowed("shape.attach",{position:d,shape:f,target:c})),m||(f$(l)?v=i.allowed("shape.create",{position:d,shape:f,source:h,target:c}):v=i.allowed("elements.create",{elements:l,position:d,target:c}));var b=p.connectionTarget;return v||m?(f&&h&&(g=i.allowed("connection.create",{source:b===h?f:h,target:b===h?h:f,hints:{targetParent:c,targetAttach:m}})),{attach:m,connect:g}):v===null||m===null?null:!1}function o(l,c){[u$,mye,c$,d$].forEach(function(d){d===c?t.addMarker(l,d):t.removeMarker(l,d)})}n.on(["create.move","create.hover"],function(l){var c=l.context,d=c.elements,h=l.hover,p=c.source,f=c.hints||{};if(!h){c.canExecute=!1,c.target=null;return}p$(l);var m={x:l.x,y:l.y},g=c.canExecute=h&&s(d,h,m,p,f);h&&g!==null&&(c.target=h,g&&g.attach?o(h,u$):o(h,g?d$:c$))}),n.on(["create.end","create.out","create.cleanup"],function(l){var c=l.hover;c&&o(c,null)}),n.on("create.end",function(l){var c=l.context,d=c.source,h=c.shape,p=c.elements,f=c.target,m=c.canExecute,g=m&&m.attach,v=m&&m.connect,b=c.hints||{};if(m===!1||!f)return!1;p$(l);var x={x:l.x,y:l.y};v?h=r.appendShape(d,h,x,f,{attach:g,connection:v===!0?{}:v,connectionTarget:b.connectionTarget}):(p=r.createElements(p,x,f,B({},b,{attach:g})),h=Tt(p,function(y){return!Mi(y)})),B(c,{elements:p,shape:h}),B(l,{elements:p,shape:h})});function a(){var l=e.context();l&&l.prefix===h$&&e.cancel()}n.on("create.init",function(){n.on("elements.changed",a),n.once(["create.cancel","create.end"],gye,function(){n.off("elements.changed",a)})}),this.start=function(l,c,d){ke(c)||(c=[c]);var h=Tt(c,function(m){return!Mi(m)});if(h){d=B({elements:c,hints:{},shape:h},d||{}),$(c,function(m){Oe(m.x)||(m.x=0),Oe(m.y)||(m.y=0)});var p=ht(c,function(m){return!m.hidden}),f=Ps(p);$(c,function(m){Mi(m)&&(m.waypoints=yr(m.waypoints,function(g){return{x:g.x-f.x-f.width/2,y:g.y-f.y-f.height/2}})),B(m,{x:m.x-f.x-f.width/2,y:m.y-f.y-f.height/2})}),e.init(l,h$,{cursor:"grabbing",autoActivate:!0,data:{shape:h,elements:c,context:d}})}}}MU.$inject=["canvas","dragging","eventBus","modeling","rules"];function p$(t){var e=t.context,n=e.createConstraints;n&&(n.left&&(t.x=Math.max(t.x,n.left)),n.right&&(t.x=Math.min(t.x,n.right)),n.top&&(t.y=Math.max(t.y,n.top)),n.bottom&&(t.y=Math.min(t.y,n.bottom)))}function f$(t){return t&&t.length===1&&!Mi(t[0])}var vye=750;function LU(t,e,n,r,i){function s(o){var a=ee("g");K(a,i.cls("djs-drag-group",["no-events"]));var l=ee("g");return o.forEach(function(c){var d;c.hidden||(c.waypoints?(d=n._createContainer("connection",l),n.drawConnection(C0(d),c)):(d=n._createContainer("shape",l),n.drawShape(C0(d),c),Ta(d,c.x,c.y)),r.addDragger(c,a,d))}),a}e.on("create.move",vye,function(o){var a=o.hover,l=o.context,c=l.elements,d=l.dragGroup;d||(d=l.dragGroup=s(c));var h;a?(d.parentNode||(h=t.getActiveLayer(),re(h,d)),Ta(d,o.x,o.y)):un(d)}),e.on("create.cleanup",function(o){var a=o.context,l=a.dragGroup;l&&un(l)})}LU.$inject=["canvas","eventBus","graphicsFactory","previewSupport","styles"];const BU={__depends__:[nh,OT,zf,Ha],__init__:["create","createPreview"],create:["type",MU],createPreview:["type",LU]};function yye(t){const{entry:e,selected:n,onMouseEnter:r,onMouseLeave:i,onAction:s}=t;return Dt`
    <li
      class=${Aa("entry",{selected:n})}
      data-id=${e.id}
      title=${e.title||e.label}
      onClick=${s}
      onMouseEnter=${r}
      onMouseLeave=${i}
      onDragStart=${o=>s(o,e,"dragstart")}
      draggable=${!0}
    >
      <div class="djs-popup-entry-content">
        <span
          class=${Aa("djs-popup-entry-name",e.className)}
        >
          ${e.imageUrl&&Dt`<img class="djs-popup-entry-icon" src=${e.imageUrl} alt="" />`||e.imageHtml&&Dt`<div class="djs-popup-entry-icon" dangerouslySetInnerHTML=${{__html:e.imageHtml}} />`}

          ${e.label?Dt`
            <span class="djs-popup-label">
              ${e.label}
            </span>
          `:null}
        </span>
        ${e.description&&Dt`
          <span
            class="djs-popup-entry-description"
            title=${e.description}
          >
            ${e.description}
          </span>
        `}
      </div>
      ${e.documentationRef&&Dt`
        <div class="djs-popup-entry-docs">
          <a
            href="${e.documentationRef}"
            onClick=${o=>o.stopPropagation()}
            title="Open element documentation"
            target="_blank"
            rel="noopener"
          >
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M10.6368 10.6375V5.91761H11.9995V10.6382C11.9995 10.9973 11.8623 11.3141 11.5878 11.5885C11.3134 11.863 10.9966 12.0002 10.6375 12.0002H1.36266C0.982345 12.0002 0.660159 11.8681 0.396102 11.6041C0.132044 11.34 1.52588e-05 11.0178 1.52588e-05 10.6375V1.36267C1.52588e-05 0.98236 0.132044 0.660173 0.396102 0.396116C0.660159 0.132058 0.982345 2.95639e-05 1.36266 2.95639e-05H5.91624V1.36267H1.36266V10.6375H10.6368ZM12 0H7.2794L7.27873 1.36197H9.68701L3.06507 7.98391L4.01541 8.93425L10.6373 2.31231V4.72059H12V0Z" fill="#818798"/>
            </svg>
          </a>
        </div>
      `}
    </li>
  `}function xye(t){const{selectedEntry:e,setSelectedEntry:n,entries:r,...i}=t,s=Cv(),o=ml(()=>bye(r),[r]);return Ad(()=>{const a=s.current;if(!a)return;const l=a.querySelector(".selected");l&&wye(l)},[e]),Dt`
    <div class="djs-popup-results" ref=${s}>
      ${o.map(a=>Dt`
        ${a.name&&Dt`
          <div key=${a.id} class="entry-header" title=${a.name}>
            ${a.name}
          </div>
        `}
        <ul class="djs-popup-group" data-group=${a.id}>
          ${a.entries.map(l=>Dt`
            <${yye}
              key=${l.id}
              entry=${l}
              selected=${l===e}
              onMouseEnter=${()=>n(l)}
              onMouseLeave=${()=>n(null)}
              ...${i}
            />
          `)}
        </ul>
      `)}
    </div>
  `}function bye(t){const e=[],n=s=>e.find(o=>s.id===o.id),r=s=>!!n(s),i=s=>typeof s=="string"?{id:s}:s;return t.forEach(s=>{const o=s.group?i(s.group):{id:"default"};r(o)?n(o).entries.push(s):e.push({...o,entries:[s]})}),e}function wye(t){typeof t.scrollIntoViewIfNeeded=="function"?t.scrollIntoViewIfNeeded():t.scrollIntoView({scrollMode:"if-needed",block:"nearest"})}function _ye(t){const{onClose:e,onSelect:n,className:r,headerEntries:i,position:s,title:o,width:a,scale:l,search:c,entries:d,onOpened:h,onClosed:p}=t,f=ml(()=>an(c)?d.length>5:!1,[c,d]),m=Cv(),[g,v]=fp(""),b=Io((N,I)=>{if(!f)return N;const M=W=>{if(!I)return(W.rank||0)>=0;if(W.searchable===!1)return!1;const ce=[W.description||"",W.label||"",W.search||""].join("---").toLowerCase();return I.toLowerCase().split(/\s/g).every(se=>ce.includes(se))};return N.filter(M)},[f]),[x,y]=fp(b(d,g)),[w,E]=fp(x[0]),S=Io(N=>{(!w||!N.includes(w))&&E(N[0]),y(N)},[w,y,E]);mp(()=>{S(b(d,g))},[g,d]),mp(()=>{const N=I=>{if(I.key==="Escape")return I.preventDefault(),e()};return document.documentElement.addEventListener("keydown",N),()=>{document.documentElement.removeEventListener("keydown",N)}},[]),Ad(()=>{m.current&&m.current.focus()},[]);const j=Io(N=>{let M=x.indexOf(w)+N;M<0&&(M=x.length-1),M>=x.length&&(M=0),E(x[M])},[x,w,E]),C=Io(N=>{if(N.key==="Enter"&&w)return n(N,w);if(N.key==="ArrowUp"||N.key==="Tab"&&N.shiftKey)return j(-1),N.preventDefault();if(N.key==="ArrowDown"||N.key==="Tab")return j(1),N.preventDefault()},[n,e,w,j]),P=Io(N=>{zd(N.target,"input")&&v(()=>N.target.value)},[v]);mp(()=>(h(),()=>{p()}),[]);const R=ml(()=>o||i.length>0,[o,i]);return Dt`
    <${m$}
      onClose=${e}
      onKeyup=${P}
      onKeydown=${C}
      className=${r}
      position=${s}
      width=${a}
      scale=${l}
    >
      ${R&&Dt`
        <div class="djs-popup-header">
          <h3 class="djs-popup-title" title=${o}>${o}</h3>
          ${i.map(N=>Dt`
            <span
              class=${Sye(N,N===w)}
              onClick=${I=>n(I,N)}
              title=${N.title||N.label}
              data-id=${N.id}
              onMouseEnter=${()=>E(N)}
              onMouseLeave=${()=>E(null)}
            >
            ${N.imageUrl&&Dt`<img class="djs-popup-entry-icon" src=${N.imageUrl} alt="" />`||N.imageHtml&&Dt`<div class="djs-popup-entry-icon" dangerouslySetInnerHTML=${{__html:N.imageHtml}} />`}

              ${N.label?Dt`
                <span class="djs-popup-label">${N.label}</span>
              `:null}
            </span>
          `)}
        </div>
      `}
      ${d.length>0&&Dt`
        <div class="djs-popup-body">

          ${f&&Dt`
          <div class="djs-popup-search">
            <svg class="djs-popup-search-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.0325 8.5H9.625L13.3675 12.25L12.25 13.3675L8.5 9.625V9.0325L8.2975 8.8225C7.4425 9.5575 6.3325 10 5.125 10C2.4325 10 0.25 7.8175 0.25 5.125C0.25 2.4325 2.4325 0.25 5.125 0.25C7.8175 0.25 10 2.4325 10 5.125C10 6.3325 9.5575 7.4425 8.8225 8.2975L9.0325 8.5ZM1.75 5.125C1.75 6.9925 3.2575 8.5 5.125 8.5C6.9925 8.5 8.5 6.9925 8.5 5.125C8.5 3.2575 6.9925 1.75 5.125 1.75C3.2575 1.75 1.75 3.2575 1.75 5.125Z" fill="#22242A"/>
            </svg>
            <input
                ref=${m}
                type="text"
              />
          </div>
          `}

          <${xye}
            entries=${x}
            selectedEntry=${w}
            setSelectedEntry=${E}
            onAction=${n}
          />
        </div>
        ${x.length===0&&Dt`
          <div class="djs-popup-no-results">No matching entries found.</div>
        `}
      `}
    </${m$}>
  `}function m$(t){const{onClose:e,onKeydown:n,onKeyup:r,className:i,children:s,position:o}=t,a=Cv(),l=Io(c=>{ur(c.target,".djs-popup",!0)||e()},[e]);return Ad(()=>{if(typeof o!="function")return;const c=a.current,d=o(c);c.style.left=`${d.x}px`,c.style.top=`${d.y}px`},[a.current,o]),Ad(()=>{a.current&&a.current.focus()},[]),Dt`
    <div
      class="djs-popup-backdrop"
      onClick=${l}
    >
      <div
        class=${Aa("djs-popup",i)}
        style=${Eye(t)}
        onKeydown=${n}
        onKeyup=${r}
        ref=${a}
        tabIndex="-1"
      >
        ${s}
      </div>
    </div>
  `}function Eye(t){return{transform:`scale(${t.scale})`,width:`${t.width}px`}}function Sye(t,e){return Aa("entry",t.className,t.active?"active":"",t.disabled?"disabled":"",e?"selected":"")}var Cye="data-id",FU=["contextPad.close","canvas.viewbox.changing","commandStack.changed"],jye=1e3;function rr(t,e,n){this._eventBus=e,this._canvas=n,this._current=null;var r=an(t&&t.scale)?t.scale:{min:1,max:1.5};this._config={scale:r},e.on("diagram.destroy",()=>{this.close()}),e.on("element.changed",i=>{const s=this.isOpen()&&this._current.target;i.element===s&&this._render()})}rr.$inject=["config.popupMenu","eventBus","canvas"];rr.prototype._render=function(){const{position:t,className:e,entries:n,headerEntries:r,options:i}=this._current,s=Object.entries(n).map(([h,p])=>({id:h,...p})),o=Object.entries(r).map(([h,p])=>({id:h,...p})),a=t&&(h=>this._ensureVisible(h,t)),l=this._updateScale(this._current.container);Nw(Dt`
      <${_ye}
        onClose=${h=>this.close(h)}
        onSelect=${(h,p,f)=>this.trigger(h,p,f)}
        position=${a}
        className=${e}
        entries=${s}
        headerEntries=${o}
        scale=${l}
        onOpened=${this._onOpened.bind(this)}
        onClosed=${this._onClosed.bind(this)}
        ...${{...i}}
      />
    `,this._current.container)};rr.prototype.open=function(t,e,n,r){if(!t)throw new Error("target is missing");if(!e)throw new Error("providers for <"+e+"> not found");if(!n)throw new Error("position is missing");this.isOpen()&&this.close();const{entries:i,headerEntries:s}=this._getContext(t,e);this._current={position:n,className:e,target:t,entries:i,headerEntries:s,container:this._createContainer({provider:e}),options:r},this._emit("open"),this._bindAutoClose(),this._render()};rr.prototype._getContext=function(t,e){const n=this._getProviders(e);if(!n||!n.length)throw new Error("provider for <"+e+"> not found");const r=this._getEntries(t,n),i=this._getHeaderEntries(t,n);return{entries:r,headerEntries:i,empty:!(Object.keys(r).length||Object.keys(i).length)}};rr.prototype.close=function(){this.isOpen()&&(this._emit("close"),this.reset(),this._current=null)};rr.prototype.reset=function(){const t=this._current.container;Nw(null,t),Nr(t)};rr.prototype._emit=function(t,e){this._eventBus.fire(`popupMenu.${t}`,e)};rr.prototype._onOpened=function(){this._emit("opened")};rr.prototype._onClosed=function(){this._emit("closed")};rr.prototype._createContainer=function(t){var e=this._canvas,n=e.getContainer();const r=bt(`<div class="djs-popup-parent djs-scrollable" data-popup=${t.provider}></div>`);return n.appendChild(r),r};rr.prototype._bindAutoClose=function(){this._eventBus.once(FU,this.close,this)};rr.prototype._unbindAutoClose=function(){this._eventBus.off(FU,this.close,this)};rr.prototype._updateScale=function(){var t=this._canvas.zoom(),e=this._config.scale,n,r,i=t;return e!==!0&&(e===!1?(n=1,r=1):(n=e.min,r=e.max),an(n)&&t<n&&(i=n),an(r)&&t>r&&(i=r)),i};rr.prototype._ensureVisible=function(t,e){var n=document.documentElement.getBoundingClientRect(),r=t.getBoundingClientRect(),i={},s=e.x,o=e.y;return e.x+r.width>n.width&&(i.x=!0),e.y+r.height>n.height&&(i.y=!0),i.x&&i.y?(s=e.x-r.width,o=e.y-r.height):i.x?(s=e.x-r.width,o=e.y):i.y&&e.y<r.height?(s=e.x,o=10):i.y&&(s=e.x,o=e.y-r.height),e.y<n.top&&(o=e.y+r.height),{x:s,y:o}};rr.prototype.isEmpty=function(t,e){if(!t)throw new Error("target is missing");if(!e)throw new Error("provider ID is missing");const n=this._getProviders(e);return!n||!n.length?!0:this._getContext(t,e).empty};rr.prototype.registerProvider=function(t,e,n){n||(n=e,e=jye),this._eventBus.on("popupMenu.getProviders."+t,e,function(r){r.providers.push(n)})};rr.prototype._getProviders=function(t){var e=this._eventBus.createEvent({type:"popupMenu.getProviders."+t,providers:[]});return this._eventBus.fire(e),e.providers};rr.prototype._getEntries=function(t,e){var n={};return $(e,function(r){if(!r.getPopupMenuEntries){$(r.getEntries(t),function(s){var o=s.id;if(!o)throw new Error("entry ID is missing");n[o]=oo(s,["id"])});return}var i=r.getPopupMenuEntries(t);Bt(i)?n=i(n):$(i,function(s,o){n[o]=s})}),n};rr.prototype._getHeaderEntries=function(t,e){var n={};return $(e,function(r){if(!r.getPopupMenuHeaderEntries){if(!r.getHeaderEntries)return;$(r.getHeaderEntries(t),function(s){var o=s.id;if(!o)throw new Error("entry ID is missing");n[o]=oo(s,["id"])});return}var i=r.getPopupMenuHeaderEntries(t);Bt(i)?n=i(n):$(i,function(s,o){n[o]=s})}),n};rr.prototype.isOpen=function(){return!!this._current};rr.prototype.trigger=function(t,e,n="click"){if(t.preventDefault(),!e){let i=ur(t.delegateTarget||t.target,".entry",!0),s=vn(i,Cye);e={id:s,...this._getEntry(s)}}const r=e.action;if(this._emit("trigger",{entry:e,event:t})!==!1){if(Bt(r)){if(n==="click")return r(t,e)}else if(r[n])return r[n](t,e)}};rr.prototype._getEntry=function(t){var e=this._current.entries[t]||this._current.headerEntries[t];if(!e)throw new Error("entry not found");return e};const kye={__init__:["popupMenu"],popupMenu:["type",rr]};var g$=Math.round;function RT(t,e){this._modeling=t,this._eventBus=e}RT.$inject=["modeling","eventBus"];RT.prototype.replaceElement=function(t,e,n){if(t.waypoints)return null;var r=this._modeling,i=this._eventBus;i.fire("replace.start",{element:t,attrs:e,hints:n});var s=e.width||t.width,o=e.height||t.height,a=e.x||t.x,l=e.y||t.y,c=g$(a+s/2),d=g$(l+o/2),h=r.replaceShape(t,B({},e,{x:c,y:d,width:s,height:o}),n);return i.fire("replace.end",{element:t,newElement:h,hints:n}),h};function zU(t,e){e.on("replace.end",500,function(n){const{newElement:r,hints:i={}}=n;i.select!==!1&&t.select(r)})}zU.$inject=["selection","eventBus"];const Pye={__init__:["replace","replaceSelectionBehavior"],replaceSelectionBehavior:["type",zU],replace:["type",RT]};function HU(t,e,n,r){function i(s,o,a){a=a||{};var l=o.type,c=s.businessObject,d=t.create(l),h={type:l,businessObject:d};if(h.width=s.width,h.height=s.height,d.name=c.name,o.table){var p=t.create("dmn:DecisionTable");d.decisionLogic=p,p.$parent=d;var f=t.create("dmn:OutputClause");f.typeRef="string",f.$parent=p,p.output=[f];var m=t.create("dmn:InputClause");m.$parent=p;var g=t.create("dmn:LiteralExpression",{typeRef:"string"});m.inputExpression=g,g.$parent=m,p.input=[m]}return o.expression&&(d.decisionLogic=t.create("dmn:LiteralExpression"),d.variable=t.create("dmn:InformationItem")),e.replaceElement(s,h,a)}this.replaceElement=i}HU.$inject=["drdFactory","replace","selection","modeling"];const Tye={__depends__:[Pye,Ha],drdReplace:["type",HU]},Nye={DECISION:[{label:"Empty",actionName:"replace-with-empty-decision",className:"dmn-icon-clear",target:{type:"dmn:Decision",table:!1,expression:!1}},{label:"Decision table",actionName:"replace-with-decision-table",className:"dmn-icon-decision-table",target:{type:"dmn:Decision",table:!0,expression:!1}},{label:"Literal expression",actionName:"replace-with-literal-expression",className:"dmn-icon-literal-expression",target:{type:"dmn:Decision",table:!1,expression:!0}}]};function rh(t,e,n,r,i,s){this._popupMenu=t,this._modeling=e,this._moddle=n,this._drdReplace=r,this._rules=i,this._translate=s,this.register()}rh.$inject=["popupMenu","modeling","moddle","drdReplace","rules","translate"];rh.prototype.register=function(){this._popupMenu.registerProvider("dmn-replace",this)};rh.prototype.getEntries=function(t){var e=t.businessObject,n=this._rules;if(!n.allowed("shape.replace",{element:t}))return[];if(Y(e,"dmn:Decision")){var r=ht(Nye.DECISION,function(i){var s=i.actionName==="replace-with-empty-decision"&&e.decisionLogic,o=i.actionName==="replace-with-decision-table"&&!Y(e.decisionLogic,"dmn:DecisionTable"),a=i.actionName==="replace-with-literal-expression"&&!Y(e.decisionLogic,"dmn:LiteralExpression");return s||o||a});return this._createEntries(t,r)}return[]};rh.prototype._createEntries=function(t,e){var n=[],r=this;return $(e,function(i){var s=r._createMenuEntry(i,t);n.push(s)}),n};rh.prototype._createMenuEntry=function(t,e,n){var r=this._drdReplace.replaceElement,i=this._translate,s=function(){return r(e,t.target)};n=n||s;var o={label:i(t.label),className:t.className,id:t.actionName,action:n};return o};rh.prototype.getHeaderEntries=function(t){return[]};const Oye={__depends__:[ny,kye,Tye],__init__:["replaceMenuProvider"],replaceMenuProvider:["type",rh]};function AT(t,e,n,r,i,s,o,a,l,c,d,h){d=d||{},e.registerProvider(this),this._contextPad=e,this._modeling=n,this._elementFactory=r,this._connect=i,this._create=s,this._rules=o,this._popupMenu=a,this._canvas=l,this._translate=c,d.autoPlace!==!1&&(this._autoPlace=h.get("autoPlace",!1)),t.on("create.end",250,function(p){var f=p.context.shape;if(T0(p)){var m=e.getEntries(f);m.replace&&m.replace.action.click(p,f)}})}AT.$inject=["eventBus","contextPad","modeling","elementFactory","connect","create","rules","popupMenu","canvas","translate","config.contextPad","injector"];AT.prototype.getContextPadEntries=function(t){var e=this._modeling,n=this._elementFactory,r=this._connect,i=this._create,s=this._popupMenu,o=this._canvas,a=this._contextPad,l=this._rules,c=this._translate,d=this._autoPlace,h={};if(t.type==="label")return h;var p=t.businessObject;function f(x,y,w){r.start(x,y,w)}function m(x){e.removeElements([t])}function g(x){var y=5,w=o.getContainer(),E=a.getPad(x).html,S=w.getBoundingClientRect(),j=E.getBoundingClientRect(),C=j.top-S.top,P=j.left-S.left,R={x:P,y:C+j.height+y};return R}function v(x,y,w,E){function S(C,P){var R=n.createShape(B({type:x},E));i.start(C,R,{source:P,hints:{connectionTarget:P}})}var j=d?function(C,P){var R=n.createShape(B({type:x},E));d.append(P,R,{connectionTarget:P})}:S;return{group:"model",className:y,title:w,action:{dragstart:S,click:j}}}Y(p,"dmn:Decision")&&B(h,{"append.decision":v("dmn:Decision","dmn-icon-decision",c("Append decision"))}),Hi(p,["dmn:BusinessKnowledgeModel","dmn:Decision","dmn:KnowledgeSource"])&&B(h,{"append.knowledge-source":v("dmn:KnowledgeSource","dmn-icon-knowledge-source",c("Append knowledge source"))}),Hi(p,["dmn:BusinessKnowledgeModel","dmn:Decision"])&&B(h,{"append.business-knowledge-model":v("dmn:BusinessKnowledgeModel","dmn-icon-business-knowledge",c("Append business knowledge model"))}),Hi(p,["dmn:Decision","dmn:KnowledgeSource"])&&B(h,{"append.input-data":v("dmn:InputData","dmn-icon-input-data",c("Append input data"))}),Y(p,"dmn:DRGElement")&&B(h,{"append.text-annotation":v("dmn:TextAnnotation","dmn-icon-text-annotation",c("Add text annotation")),connect:{group:"connect",className:"dmn-icon-connection-multi",title:c("Connect to other element"),action:{click:f,dragstart:f}}}),Y(p,"dmn:TextAnnotation")&&B(h,{connect:{group:"connect",className:"dmn-icon-connection-multi",title:c("Connect to other element"),action:{click:f,dragstart:f}}}),s.isEmpty(t,"dmn-replace")||B(h,{replace:{group:"edit",className:"dmn-icon-screw-wrench",title:c("Change type"),action:{click:function(y,w){var E=B(g(w),{cursor:{x:y.x,y:y.y}});s.open(w,"dmn-replace",E)}}}});var b=l.allowed("elements.delete",{elements:[t]});return ke(b)&&(b=b[0]===t),b&&B(h,{delete:{group:"edit",className:"dmn-icon-trash",title:c("Delete"),action:{click:m}}}),h};const Rye={__depends__:[ny,sye,Ha,lye,BU,Oye],__init__:["contextPadProvider"],contextPadProvider:["type",AT]};var Aye="djs-dragger";function Bl(t,e,n,r){this._canvas=e,this._graphicsFactory=n,this._elementFactory=r,this._connectionDocking=t.get("connectionDocking",!1),this._layouter=t.get("layouter",!1)}Bl.$inject=["injector","canvas","graphicsFactory","elementFactory"];Bl.prototype.drawPreview=function(t,e,n){n=n||{};var r=t.connectionPreviewGfx,i=t.getConnection,s=n.source,o=n.target,a=n.waypoints,l=n.connectionStart,c=n.connectionEnd,d=n.noLayout,h=n.noCropping,p=n.noNoop,f,m=this;if(r||(r=t.connectionPreviewGfx=this.createConnectionPreviewGfx()),Hd(r),i||(i=t.getConnection=Iye(function(g,v,b){return m.getConnection(g,v,b)})),e&&(f=i(e,s,o)),!f){!p&&this.drawNoopPreview(r,n);return}f.waypoints=a||[],this._layouter&&!d&&(f.waypoints=this._layouter.layoutConnection(f,{source:s,target:o,connectionStart:l,connectionEnd:c,waypoints:n.waypoints||f.waypoints})),(!f.waypoints||!f.waypoints.length)&&(f.waypoints=[s?fn(s):l,o?fn(o):c]),this._connectionDocking&&(s||o)&&!h&&(f.waypoints=this._connectionDocking.getCroppedWaypoints(f,s,o)),this._graphicsFactory.drawConnection(r,f,{stroke:"var(--element-dragger-color)"})};Bl.prototype.drawNoopPreview=function(t,e){var n=e.source,r=e.target,i=e.connectionStart||fn(n),s=e.connectionEnd||fn(r),o=this.cropWaypoints(i,s,n,r),a=this.createNoopConnection(o[0],o[1]);re(t,a)};Bl.prototype.cropWaypoints=function(t,e,n,r){var i=this._graphicsFactory,s=n&&i.getShapePath(n),o=r&&i.getShapePath(r),a=i.getConnectionPath({waypoints:[t,e]});return t=n&&HC(s,a,!0)||t,e=r&&HC(o,a,!1)||e,[t,e]};Bl.prototype.cleanUp=function(t){t&&t.connectionPreviewGfx&&un(t.connectionPreviewGfx)};Bl.prototype.getConnection=function(t){var e=Dye(t);return this._elementFactory.createConnection(e)};Bl.prototype.createConnectionPreviewGfx=function(){var t=ee("g");return K(t,{pointerEvents:"none"}),Ge(t).add(Aye),re(this._canvas.getActiveLayer(),t),t};Bl.prototype.createNoopConnection=function(t,e){return P_([t,e],{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"})};function Iye(t){var e={};return function(n){var r=JSON.stringify(n),i=e[r];return i||(i=e[r]=t.apply(null,arguments)),i}}function Dye(t){return Wn(t)?t:{}}const $ye={__init__:["connectionPreview"],connectionPreview:["type",Bl]};var Mye=/\s/,Lye=/^([a-z][\w-.]*:)?[a-z_][\w-.]*$/i,Bye=/^[a-z_][\w-.]*$/i,Fye=/\$\{([^}]*)\}/g;function zye(t,e){var n=t.$model.ids.assigned(e),r=n&&n!==t;return e?r?"Element must have unique ID.":Hye(e):"Element must have ID."}function Hye(t){if(t=Vye(t),Uye(t))return"Id must not contain spaces.";if(!Bye.test(t))return Lye.test(t)?"Id must not contain prefix.":"Id must be a valid QName."}function Uye(t){return Mye.test(t)}function Vye(t){return t.replace(Fye,"$1")}var qye=300;function Hf(t,e,n,r,i){this._eventBus=t,this._modeling=e,this._canvas=n,this._definitionPropertiesView=r,this._translate=i,t.on("definitionIdView.create",function(s){this._container=s.html;var o=at(".dmn-definitions-name",this._container),a=at(".dmn-definitions-id",this._container);this._setup(o,"name"),this._setup(a,"id")},this)}Hf.$inject=["eventBus","modeling","canvas","definitionPropertiesView","translate"];Hf.prototype.update=function(t,e){var n=this._canvas.getRootElement(),r={};if(r[t]=e,t==="id"){var i=zye(jl(n),e);if(i){this._addErrorMessage(i);return}this._clearErrorMessage()}this._modeling.updateProperties(n,r)};Hf.prototype._setup=function(t,e){var n=this;t.setAttribute("contenteditable",!0),t.addEventListener("input",bf(function(r){var i=r.target.value||r.target.textContent;n.update(e,i.trim())},qye)),t.addEventListener("keydown",function(r){r.keyCode===13&&(t.blur(),window.getSelection().removeAllRanges())}),t.addEventListener("blur",function(){n._clearErrorMessage(),n._definitionPropertiesView.update()})};Hf.prototype._addErrorMessage=function(t){var e='<span class="dmn-definitions-error-message">'+this._translate(t)+"</span>",n=at(".dmn-definitions-id",this._container);this._clearErrorMessage(),vt(n).add("dmn-definitions-error"),n.parentElement.appendChild(bt(e))};Hf.prototype._clearErrorMessage=function(){var t=at(".dmn-definitions-id",this._container);if(vt(t).has("dmn-definitions-error")){vt(t).remove("dmn-definitions-error");var e=at(".dmn-definitions-error-message",this._container);t.parentNode.removeChild(e)}};const Wye={__depends__:[wT],__init__:["definitionPropertiesEdit","definitionPropertiesPaletteAdapter"],definitionPropertiesEdit:["type",Hf],definitionPropertiesPaletteAdapter:["type",bT]};var Gye={horizontal:["x","width"],vertical:["y","height"]},v$=5;function Fl(t,e){this._modeling=t,this._filters=[],this.registerFilter(function(n){var r=e.allowed("elements.distribute",{elements:n});return ke(r)?r:r?n:[]})}Fl.$inject=["modeling","rules"];Fl.prototype.registerFilter=function(t){if(typeof t!="function")throw new Error("the filter has to be a function");this._filters.push(t)};Fl.prototype.trigger=function(t,e){var n=this._modeling,r,i;if(!(t.length<3)&&(this._setOrientation(e),i=this._filterElements(t),r=this._createGroups(i),!(r.length<=2)))return n.distributeElements(r,this._axis,this._dimension),r};Fl.prototype._filterElements=function(t){var e=this._filters,n=this._axis,r=this._dimension,i=[].concat(t);return e.length?($(e,function(s){i=s(i,n,r)}),i):t};Fl.prototype._createGroups=function(t){var e=[],n=this,r=this._axis,i=this._dimension;if(!r)throw new Error('must have a defined "axis" and "dimension"');var s=Ei(t,r);return $(s,function(o,a){var l=n._findRange(o,r,i),c,d=e[e.length-1];d&&n._hasIntersection(d.range,l)?e[e.length-1].elements.push(o):(c={range:l,elements:[o]},e.push(c))}),e};Fl.prototype._setOrientation=function(t){var e=Gye[t];this._axis=e[0],this._dimension=e[1]};Fl.prototype._hasIntersection=function(t,e){return Math.max(t.min,t.max)>=Math.min(e.min,e.max)&&Math.min(t.min,t.max)<=Math.max(e.min,e.max)};Fl.prototype._findRange=function(t){var e=t[this._axis],n=t[this._dimension];return{min:e+v$,max:e+n-v$}};const Kye={__init__:["distributeElements"],distributeElements:["type",Fl]};function UU(t){t.registerFilter(function(e){return ht(e,function(n){var r=Hi(n,["dmn:AuthorityRequirement","dmn:InformationRequirement","dmn:KnowledgeRequirement","dmn:Association","dmn:TextAnnotation"]);return!(n.labelTarget||r)})})}UU.$inject=["distributeElements"];const Yye={__depends__:[Kye],__init__:["drdDistributeElements"],drdDistributeElements:["type",UU]};var VU="is not a registered action",Xye="is already registered";function yo(t,e){this._actions={};var n=this;t.on("diagram.init",function(){n._registerDefaultActions(e),t.fire("editorActions.init",{editorActions:n})})}yo.$inject=["eventBus","injector"];yo.prototype._registerDefaultActions=function(t){var e=t.get("commandStack",!1),n=t.get("modeling",!1),r=t.get("selection",!1),i=t.get("zoomScroll",!1),s=t.get("copyPaste",!1),o=t.get("canvas",!1),a=t.get("rules",!1),l=t.get("keyboardMove",!1),c=t.get("keyboardMoveSelection",!1);e&&(this.register("undo",function(){e.undo()}),this.register("redo",function(){e.redo()})),s&&r&&this.register("copy",function(){var d=r.get();if(d.length)return s.copy(d)}),s&&this.register("paste",function(){s.paste()}),i&&this.register("stepZoom",function(d){i.stepZoom(d.value)}),o&&this.register("zoom",function(d){o.zoom(d.value)}),n&&r&&a&&this.register("removeSelection",function(){var d=r.get();if(d.length){var h=a.allowed("elements.delete",{elements:d}),p;h!==!1&&(ke(h)?p=h:p=d,p.length&&n.removeElements(p.slice()))}}),l&&this.register("moveCanvas",function(d){l.moveCanvas(d)}),c&&this.register("moveSelection",function(d){c.moveSelection(d.direction,d.accelerated)})};yo.prototype.trigger=function(t,e){if(!this._actions[t])throw IT(t,VU);return this._actions[t](e)};yo.prototype.register=function(t,e){var n=this;if(typeof t=="string")return this._registerAction(t,e);$(t,function(r,i){n._registerAction(i,r)})};yo.prototype._registerAction=function(t,e){if(this.isRegistered(t))throw IT(t,Xye);this._actions[t]=e};yo.prototype.unregister=function(t){if(!this.isRegistered(t))throw IT(t,VU);this._actions[t]=void 0};yo.prototype.getActions=function(){return Object.keys(this._actions)};yo.prototype.isRegistered=function(t){return!!this._actions[t]};function IT(t,e){return new Error(t+" "+e)}const Qye={__init__:["editorActions"],editorActions:["type",yo]};function D_(t){t.invoke(yo,this)}Ce(D_,yo);D_.$inject=["injector"];D_.prototype._registerDefaultActions=function(t){yo.prototype._registerDefaultActions.call(this,t);var e=t.get("canvas",!1),n=t.get("elementRegistry",!1),r=t.get("selection",!1),i=t.get("lassoTool",!1),s=t.get("handTool",!1),o=t.get("directEditing",!1),a=t.get("distributeElements",!1),l=t.get("alignElements",!1),c=t.get("searchPad",!1);e&&n&&r&&this._registerAction("selectElements",function(){var d=e.getRootElement(),h=n.filter(function(p){return p!==d});return r.select(h),h}),r&&a&&this._registerAction("distributeElements",function(d){var h=r.get(),p=d.type;h.length>2&&a.trigger(h,p)}),r&&l&&this._registerAction("alignElements",function(d){var h=r.get(),p=d.type;h.length>1&&l.trigger(h,p)}),i&&this._registerAction("lassoTool",function(){i.toggle()}),s&&this._registerAction("handTool",function(){s.toggle()}),r&&o&&this._registerAction("directEditing",function(){var d=r.get();d.length&&o.activate(d[0])}),r&&c&&this._registerAction("find",function(){c.toggle()})};const Zye={__depends__:[Qye],editorActions:["type",D_]};function qU(t){return t.dmnDI&&t.dmnDI.diagrams&&t.dmnDI.diagrams[0]}function WU(t,e,n,r){function i(s){var o=s.dmnDI;o||(o=t.create("dmndi:DMNDI"),s.set("dmnDI",o));var a=t.create("dmndi:DMNDiagram");o.set("diagrams",[a]);var l=0;$(s.get("drgElement"),function(c){if(Y(c,"dmn:Decision")){var d=e._getDefaultSize(c),h=t.createDiShape(c,{x:150+l*30,y:150+l*30,width:d.width,height:d.height});r.updateDiParent(h,a),l++}})}n.on("import.start",s=>{var o=s.definitions;qU(o)||i(o)})}WU.$inject=["drdFactory","elementFactory","eventBus","drdUpdater"];const Jye={__init__:["diGenerator"],diGenerator:["type",WU]};var Mb=10;function AE(t,e,n){return n||(n="round"),Math[n](t/e)*e}var exe=1200,txe=800;function hu(t,e,n){var r=!n||n.active!==!1;this._eventBus=e;var i=this;e.on("diagram.init",txe,function(){i.setActive(r)}),e.on(["create.move","create.end","bendpoint.move.move","bendpoint.move.end","connect.move","connect.end","connectionSegment.move.move","connectionSegment.move.end","resize.move","resize.end","shape.move.move","shape.move.end"],exe,function(s){var o=s.originalEvent;if(!(!i.active||o&&to(o))){var a=s.context,l=a.gridSnappingContext;l||(l=a.gridSnappingContext={}),["x","y"].forEach(function(c){var d={},h=rxe(s,c,t);h&&(d.offset=h);var p=nxe(s,c);p&&B(d,p),Gg(s,c)||i.snapEvent(s,c,d)})}})}hu.prototype.snapEvent=function(t,e,n){var r=this.snapValue(t[e],n);ba(t,e,r)};hu.prototype.getGridSpacing=function(){return Mb};hu.prototype.snapValue=function(t,e){var n=0;e&&e.offset&&(n=e.offset),t+=n,t=AE(t,Mb);var r,i;return e&&e.min&&(r=e.min,Oe(r)&&(r=AE(r+n,Mb,"ceil"),t=Math.max(t,r))),e&&e.max&&(i=e.max,Oe(i)&&(i=AE(i+n,Mb,"floor"),t=Math.min(t,i))),t-=n,t};hu.prototype.isActive=function(){return this.active};hu.prototype.setActive=function(t){this.active=t,this._eventBus.fire("gridSnapping.toggle",{active:t})};hu.prototype.toggleActive=function(){this.setActive(!this.active)};hu.$inject=["elementRegistry","eventBus","config.gridSnapping"];function nxe(t,e){var n=t.context,r=n.createConstraints,i=n.resizeConstraints||{},s=n.gridSnappingContext,o=s.snapConstraints;if(o&&o[e])return o[e];o||(o=s.snapConstraints={}),o[e]||(o[e]={});var a=n.direction;r&&(Lb(e)?(o.x.min=r.left,o.x.max=r.right):(o.y.min=r.top,o.y.max=r.bottom));var l=i.min,c=i.max;return l&&(Lb(e)?x$(a)?o.x.max=l.left:o.x.min=l.right:y$(a)?o.y.max=l.top:o.y.min=l.bottom),c&&(Lb(e)?x$(a)?o.x.min=c.left:o.x.max=c.right:y$(a)?o.y.min=c.top:o.y.max=c.bottom),o[e]}function rxe(t,e,n){var r=t.context,i=t.shape,s=r.gridSnappingContext,o=s.snapLocation,a=s.snapOffset;return a&&Oe(a[e])||(a||(a=s.snapOffset={}),Oe(a[e])||(a[e]=0),!i)||(n.get(i.id)||(Lb(e)?a[e]+=i[e]+i.width/2:a[e]+=i[e]+i.height/2),!o)||(e==="x"?/left/.test(o)?a[e]-=i.width/2:/right/.test(o)&&(a[e]+=i.width/2):/top/.test(o)?a[e]-=i.height/2:/bottom/.test(o)&&(a[e]+=i.height/2)),a[e]}function Lb(t){return t==="x"}function y$(t){return t.indexOf("n")!==-1}function x$(t){return t.indexOf("w")!==-1}var ixe=1e3;function Yn(t){this._eventBus=t}Yn.$inject=["eventBus"];function sxe(t,e){return function(n){return t.call(e||null,n.context,n.command,n)}}Yn.prototype.on=function(t,e,n,r,i,s){if((Bt(e)||Oe(e))&&(s=i,i=r,r=n,n=e,e=null),Bt(n)&&(s=i,i=r,r=n,n=ixe),Wn(i)&&(s=i,i=!1),!Bt(r))throw new Error("handlerFn must be a function");ke(t)||(t=[t]);var o=this._eventBus;$(t,function(a){var l=["commandStack",a,e].filter(function(c){return c}).join(".");o.on(l,n,i?sxe(r,s):r,s)})};Yn.prototype.canExecute=zl("canExecute");Yn.prototype.preExecute=zl("preExecute");Yn.prototype.preExecuted=zl("preExecuted");Yn.prototype.execute=zl("execute");Yn.prototype.executed=zl("executed");Yn.prototype.postExecute=zl("postExecute");Yn.prototype.postExecuted=zl("postExecuted");Yn.prototype.revert=zl("revert");Yn.prototype.reverted=zl("reverted");function zl(t){return function(n,r,i,s,o){(Bt(n)||Oe(n))&&(o=s,s=i,i=r,r=n,n=null),this.on(n,t,r,i,s,o)}}function ih(t,e){Yn.call(this,t),this._gridSnapping=e;var n=this;this.preExecute("shape.resize",function(r){var i=r.context,s=i.hints||{},o=s.autoResize;if(o){var a=i.shape,l=i.newBounds;Fi(o)?i.newBounds=n.snapComplex(l,o):i.newBounds=n.snapSimple(a,l)}})}ih.$inject=["eventBus","gridSnapping","modeling"];Ce(ih,Yn);ih.prototype.snapSimple=function(t,e){var n=this._gridSnapping;return e.width=n.snapValue(e.width,{min:e.width}),e.height=n.snapValue(e.height,{min:e.height}),e.x=t.x+t.width/2-e.width/2,e.y=t.y+t.height/2-e.height/2,e};ih.prototype.snapComplex=function(t,e){return/w|e/.test(e)&&(t=this.snapHorizontally(t,e)),/n|s/.test(e)&&(t=this.snapVertically(t,e)),t};ih.prototype.snapHorizontally=function(t,e){var n=this._gridSnapping,r=/w/.test(e),i=/e/.test(e),s={};return s.width=n.snapValue(t.width,{min:t.width}),i&&(r?(s.x=n.snapValue(t.x,{max:t.x}),s.width+=n.snapValue(t.x-s.x,{min:t.x-s.x})):t.x=t.x+t.width-s.width),B(t,s),t};ih.prototype.snapVertically=function(t,e){var n=this._gridSnapping,r=/n/.test(e),i=/s/.test(e),s={};return s.height=n.snapValue(t.height,{min:t.height}),r&&(i?(s.y=n.snapValue(t.y,{max:t.y}),s.height+=n.snapValue(t.y-s.y,{min:t.y-s.y})):t.y=t.y+t.height-s.height),B(t,s),t};var oxe=2e3;function GU(t,e){t.on(["spaceTool.move","spaceTool.end"],oxe,function(n){var r=n.context;if(r.initialized){var i=r.axis,s;i==="x"?(s=e.snapValue(n.dx),n.x=n.x+s-n.dx,n.dx=s):(s=e.snapValue(n.dy),n.y=n.y+s-n.dy,n.dy=s)}})}GU.$inject=["eventBus","gridSnapping"];const axe={__init__:["gridSnappingResizeBehavior","gridSnappingSpaceToolBehavior"],gridSnappingResizeBehavior:["type",ih],gridSnappingSpaceToolBehavior:["type",GU]},lxe={__depends__:[axe],__init__:["gridSnapping"],gridSnapping:["type",hu]};var $_="keyboard.keydown",cxe="keyboard.keyup",b$="input-handle-modified-keys",uxe=1e3;function Jr(t,e){var n=this;this._config=t||{},this._eventBus=e,this._keydownHandler=this._keydownHandler.bind(this),this._keyupHandler=this._keyupHandler.bind(this),e.on("diagram.destroy",function(){n._fire("destroy"),n.unbind()}),e.on("diagram.init",function(){n._fire("init")}),e.on("attach",function(){t&&t.bindTo&&n.bind(t.bindTo)}),e.on("detach",function(){n.unbind()})}Jr.$inject=["config.keyboard","eventBus"];Jr.prototype._keydownHandler=function(t){this._keyHandler(t,$_)};Jr.prototype._keyupHandler=function(t){this._keyHandler(t,cxe)};Jr.prototype._keyHandler=function(t,e){var n;if(!this._isEventIgnored(t)){var r={keyEvent:t};n=this._eventBus.fire(e||$_,r),n&&t.preventDefault()}};Jr.prototype._isEventIgnored=function(t){return t.defaultPrevented?!0:dxe(t.target)&&this._isModifiedKeyIgnored(t)};Jr.prototype._isModifiedKeyIgnored=function(t){if(!to(t))return!0;var e=this._getAllowedModifiers(t.target);return e.indexOf(t.key)===-1};Jr.prototype._getAllowedModifiers=function(t){var e=ur(t,"["+b$+"]",!0);return!e||this._node&&!this._node.contains(e)?[]:e.getAttribute(b$).split(",")};Jr.prototype.bind=function(t){this.unbind(),this._node=t,ie.bind(t,"keydown",this._keydownHandler),ie.bind(t,"keyup",this._keyupHandler),this._fire("bind")};Jr.prototype.getBinding=function(){return this._node};Jr.prototype.unbind=function(){var t=this._node;t&&(this._fire("unbind"),ie.unbind(t,"keydown",this._keydownHandler),ie.unbind(t,"keyup",this._keyupHandler)),this._node=null};Jr.prototype._fire=function(t){this._eventBus.fire("keyboard."+t,{node:this._node})};Jr.prototype.addListener=function(t,e,n){Bt(t)&&(n=e,e=t,t=uxe),this._eventBus.on(n||$_,t,e)};Jr.prototype.removeListener=function(t,e){this._eventBus.off(e||$_,t)};Jr.prototype.hasModifier=Wge;Jr.prototype.isCmd=to;Jr.prototype.isShift=jT;Jr.prototype.isKey=Br;function dxe(t){return t&&(zd(t,"input, textarea")||t.contentEditable==="true")}var hxe=500;function Uf(t,e){var n=this;t.on("editorActions.init",hxe,function(r){var i=r.editorActions;n.registerBindings(e,i)})}Uf.$inject=["eventBus","keyboard"];Uf.prototype.registerBindings=function(t,e){function n(r,i){e.isRegistered(r)&&t.addListener(i)}n("undo",function(r){var i=r.keyEvent;if(Yge(i))return e.trigger("undo"),!0}),n("redo",function(r){var i=r.keyEvent;if(Xge(i))return e.trigger("redo"),!0}),n("copy",function(r){var i=r.keyEvent;if(Gge(i))return e.trigger("copy"),!0}),n("paste",function(r){var i=r.keyEvent;if(Kge(i))return e.trigger("paste"),!0}),n("stepZoom",function(r){var i=r.keyEvent;if(Br(["+","Add","="],i)&&to(i))return e.trigger("stepZoom",{value:1}),!0}),n("stepZoom",function(r){var i=r.keyEvent;if(Br(["-","Subtract"],i)&&to(i))return e.trigger("stepZoom",{value:-1}),!0}),n("zoom",function(r){var i=r.keyEvent;if(Br("0",i)&&to(i))return e.trigger("zoom",{value:1}),!0}),n("removeSelection",function(r){var i=r.keyEvent;if(Br(["Backspace","Delete","Del"],i))return e.trigger("removeSelection"),!0})};const DT={__init__:["keyboard","keyboardBindings"],keyboard:["type",Jr],keyboardBindings:["type",Uf]};function M_(t){t.invoke(Uf,this)}Ce(M_,Uf);M_.$inject=["injector"];M_.prototype.registerBindings=function(t,e){Uf.prototype.registerBindings.call(this,t,e);function n(r,i){e.isRegistered(r)&&t.addListener(i)}n("selectElements",function(r){var i=r.keyEvent;if(t.isKey(["a","A"],i)&&t.isCmd(i))return e.trigger("selectElements"),!0}),n("lassoTool",function(r){var i=r.keyEvent;if(!t.hasModifier(i)&&t.isKey(["l","L"],i))return e.trigger("lassoTool"),!0}),n("handTool",function(r){var i=r.keyEvent;if(!t.hasModifier(i)&&t.isKey(["h","H"],i))return e.trigger("handTool"),!0}),n("directEditing",function(r){var i=r.keyEvent;if(!t.hasModifier(i)&&t.isKey(["e","E"],i))return e.trigger("directEditing"),!0}),n("find",function(r){var i=r.keyEvent;if(t.isKey(["f","F"],i)&&t.isCmd(i))return e.trigger("find"),!0})};const pxe={__depends__:[DT],__init__:["keyboardBindings"],keyboardBindings:["type",M_]};var fxe={moveSpeed:50,moveSpeedAccelerated:200};function KU(t,e,n){var r=this;this._config=B({},fxe,t||{}),e.addListener(i);function i(s){var o=s.keyEvent,a=r._config;if(e.isCmd(o)&&e.isKey(["ArrowLeft","Left","ArrowUp","Up","ArrowDown","Down","ArrowRight","Right"],o)){var l=e.isShift(o)?a.moveSpeedAccelerated:a.moveSpeed,c;switch(o.key){case"ArrowLeft":case"Left":c="left";break;case"ArrowUp":case"Up":c="up";break;case"ArrowRight":case"Right":c="right";break;case"ArrowDown":case"Down":c="down";break}return r.moveCanvas({speed:l,direction:c}),!0}}this.moveCanvas=function(s){var o=0,a=0,l=s.speed,c=l/Math.min(Math.sqrt(n.viewbox().scale),1);switch(s.direction){case"left":o=c;break;case"up":a=c;break;case"right":o=-c;break;case"down":a=-c;break}n.scroll({dx:o,dy:a})}}KU.$inject=["config.keyboardMove","keyboard","canvas"];const mxe={__depends__:[DT],__init__:["keyboardMove"],keyboardMove:["type",KU]};var gxe={moveSpeed:1,moveSpeedAccelerated:10},vxe=1500,w$="left",_$="up",E$="right",S$="down",yxe={ArrowLeft:w$,Left:w$,ArrowUp:_$,Up:_$,ArrowRight:E$,Right:E$,ArrowDown:S$,Down:S$},xxe={left:function(t){return{x:-t,y:0}},up:function(t){return{x:0,y:-t}},right:function(t){return{x:t,y:0}},down:function(t){return{x:0,y:t}}};function YU(t,e,n,r,i){var s=this;this._config=B({},gxe,t||{}),e.addListener(vxe,function(o){var a=o.keyEvent,l=yxe[a.key];if(l&&!e.isCmd(a)){var c=e.isShift(a);return s.moveSelection(l,c),!0}}),this.moveSelection=function(o,a){var l=i.get();if(l.length){var c=this._config[a?"moveSpeedAccelerated":"moveSpeed"],d=xxe[o](c),h=r.allowed("elements.move",{shapes:l});h&&n.moveElements(l,d)}}}YU.$inject=["config.keyboardMoveSelection","keyboard","modeling","rules","selection"];const bxe={__depends__:[DT,Ha],__init__:["keyboardMoveSelection"],keyboardMoveSelection:["type",YU]};function Xn(t,e){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[],trigger:null},this._injector=e,this._eventBus=t,this._uid=1,t.on(["diagram.destroy","diagram.clear"],function(){this.clear(!1)},this)}Xn.$inject=["eventBus","injector"];Xn.prototype.execute=function(t,e){if(!t)throw new Error("command required");this._currentExecution.trigger="execute";const n={command:t,context:e};this._pushAction(n),this._internalExecute(n),this._popAction()};Xn.prototype.canExecute=function(t,e){const n={command:t,context:e},r=this._getHandler(t);let i=this._fire(t,"canExecute",n);if(i===void 0){if(!r)return!1;r.canExecute&&(i=r.canExecute(e))}return i};Xn.prototype.clear=function(t){this._stack.length=0,this._stackIdx=-1,t!==!1&&this._fire("changed",{trigger:"clear"})};Xn.prototype.undo=function(){let t=this._getUndoAction(),e;if(t){for(this._currentExecution.trigger="undo",this._pushAction(t);t&&(this._internalUndo(t),e=this._getUndoAction(),!(!e||e.id!==t.id));)t=e;this._popAction()}};Xn.prototype.redo=function(){let t=this._getRedoAction(),e;if(t){for(this._currentExecution.trigger="redo",this._pushAction(t);t&&(this._internalExecute(t,!0),e=this._getRedoAction(),!(!e||e.id!==t.id));)t=e;this._popAction()}};Xn.prototype.register=function(t,e){this._setHandler(t,e)};Xn.prototype.registerHandler=function(t,e){if(!t||!e)throw new Error("command and handlerCls must be defined");const n=this._injector.instantiate(e);this.register(t,n)};Xn.prototype.canUndo=function(){return!!this._getUndoAction()};Xn.prototype.canRedo=function(){return!!this._getRedoAction()};Xn.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]};Xn.prototype._getUndoAction=function(){return this._stack[this._stackIdx]};Xn.prototype._internalUndo=function(t){const e=t.command,n=t.context,r=this._getHandler(e);this._atomicDo(()=>{this._fire(e,"revert",t),r.revert&&this._markDirty(r.revert(n)),this._revertedAction(t),this._fire(e,"reverted",t)})};Xn.prototype._fire=function(t,e,n){arguments.length<3&&(n=e,e=null);const r=e?[t+"."+e,e]:[t];let i;n=this._eventBus.createEvent(n);for(const s of r)if(i=this._eventBus.fire("commandStack."+s,n),n.cancelBubble)break;return i};Xn.prototype._createId=function(){return this._uid++};Xn.prototype._atomicDo=function(t){const e=this._currentExecution;e.atomic=!0;try{t()}finally{e.atomic=!1}};Xn.prototype._internalExecute=function(t,e){const n=t.command,r=t.context,i=this._getHandler(n);if(!i)throw new Error("no command handler registered for <"+n+">");this._pushAction(t),e||(this._fire(n,"preExecute",t),i.preExecute&&i.preExecute(r),this._fire(n,"preExecuted",t)),this._atomicDo(()=>{this._fire(n,"execute",t),i.execute&&this._markDirty(i.execute(r)),this._executedAction(t,e),this._fire(n,"executed",t)}),e||(this._fire(n,"postExecute",t),i.postExecute&&i.postExecute(r),this._fire(n,"postExecuted",t)),this._popAction()};Xn.prototype._pushAction=function(t){const e=this._currentExecution,n=e.actions,r=n[0];if(e.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+t.command+")");t.id||(t.id=r&&r.id||this._createId()),n.push(t)};Xn.prototype._popAction=function(){const t=this._currentExecution,e=t.trigger,n=t.actions,r=t.dirty;n.pop(),n.length||(this._eventBus.fire("elements.changed",{elements:Tk("id",r.reverse())}),r.length=0,this._fire("changed",{trigger:e}),t.trigger=null)};Xn.prototype._markDirty=function(t){const e=this._currentExecution;t&&(t=ke(t)?t:[t],e.dirty=e.dirty.concat(t))};Xn.prototype._executedAction=function(t,e){const n=++this._stackIdx;e||this._stack.splice(n,this._stack.length,t)};Xn.prototype._revertedAction=function(t){this._stackIdx--};Xn.prototype._getHandler=function(t){return this._handlerMap[t]};Xn.prototype._setHandler=function(t,e){if(!t||!e)throw new Error("command and handler required");if(this._handlerMap[t])throw new Error("overriding handler for command <"+t+">");this._handlerMap[t]=e};const XU={commandStack:["type",Xn]};function QU(t,e,n,r){t.on("element.changed",function(i){var s=i.element;(s.parent||s===e.getRootElement())&&(i.gfx=n.getGraphics(s)),i.gfx&&t.fire(dH(s)+".changed",i)}),t.on("elements.changed",function(i){var s=i.elements;s.forEach(function(o){t.fire("element.changed",{element:o})}),r.updateContainments(s)}),t.on("shape.changed",function(i){r.update("shape",i.element,i.gfx)}),t.on("connection.changed",function(i){r.update("connection",i.element,i.gfx)})}QU.$inject=["eventBus","canvas","elementRegistry","graphicsFactory"];const ZU={__init__:["changeSupport"],changeSupport:["type",QU]};var C$=Math.min,j$=Math.max;function IE(t){t.preventDefault()}function gg(t){t.stopPropagation()}function wxe(t){return t.nodeType===Node.TEXT_NODE}function _xe(t){return[].slice.call(t)}function Ko(t){this.container=t.container,this.parent=bt('<div class="djs-direct-editing-parent"><div class="djs-direct-editing-content" contenteditable="true"></div></div>'),this.content=at("[contenteditable]",this.parent),this.keyHandler=t.keyHandler||function(){},this.resizeHandler=t.resizeHandler||function(){},this.autoResize=li(this.autoResize,this),this.handlePaste=li(this.handlePaste,this)}Ko.prototype.create=function(t,e,n,r){var i=this,s=this.parent,o=this.content,a=this.container;r=this.options=r||{},e=this.style=e||{};var l=ui(e,["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);B(s.style,{width:t.width+"px",height:t.height+"px",maxWidth:t.maxWidth+"px",maxHeight:t.maxHeight+"px",minWidth:t.minWidth+"px",minHeight:t.minHeight+"px",left:t.x+"px",top:t.y+"px",backgroundColor:"#ffffff",position:"absolute",overflow:"visible",border:"1px solid #ccc",boxSizing:"border-box",wordWrap:"normal",textAlign:"center",outline:"none"},l);var c=ui(e,["fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return B(o.style,{boxSizing:"border-box",width:"100%",outline:"none",wordWrap:"break-word"},c),r.centerVertically&&B(o.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},c),o.innerText=n,ie.bind(o,"keydown",this.keyHandler),ie.bind(o,"mousedown",gg),ie.bind(o,"paste",i.handlePaste),r.autoResize&&ie.bind(o,"input",this.autoResize),r.resizable&&this.resizable(e),a.appendChild(s),this.setSelection(o.lastChild,o.lastChild&&o.lastChild.length),s};Ko.prototype.handlePaste=function(t){var e=this.options,n=this.style;t.preventDefault();var r;if(t.clipboardData?r=t.clipboardData.getData("text/plain"):r=window.clipboardData.getData("Text"),this.insertText(r),e.autoResize){var i=this.autoResize(n);i&&this.resizeHandler(i)}};Ko.prototype.insertText=function(t){t=Exe(t);var e=document.execCommand("insertText",!1,t);e||this._insertTextIE(t)};Ko.prototype._insertTextIE=function(t){var e=this.getSelection(),n=e.startContainer,r=e.endContainer,i=e.startOffset,s=e.endOffset,o=e.commonAncestorContainer,a=_xe(o.childNodes),l,c;if(wxe(o)){var d=n.textContent;n.textContent=d.substring(0,i)+t+d.substring(s),l=n,c=i+t.length}else if(n===this.content&&r===this.content){var h=document.createTextNode(t);this.content.insertBefore(h,a[i]),l=h,c=h.textContent.length}else{var p=a.indexOf(n),f=a.indexOf(r);a.forEach(function(m,g){g===p?m.textContent=n.textContent.substring(0,i)+t+r.textContent.substring(s):g>p&&g<=f&&Nr(m)}),l=n,c=i+t.length}l&&c!==void 0&&setTimeout(function(){self.setSelection(l,c)})};Ko.prototype.autoResize=function(){var t=this.parent,e=this.content,n=parseInt(this.style.fontSize)||12;if(e.scrollHeight>t.offsetHeight||e.scrollHeight<t.offsetHeight-n){var r=t.getBoundingClientRect(),i=e.scrollHeight;t.style.height=i+"px",this.resizeHandler({width:r.width,height:r.height,dx:0,dy:i-r.height})}};Ko.prototype.resizable=function(){var t=this,e=this.parent,n=this.resizeHandle,r=parseInt(this.style.minWidth)||0,i=parseInt(this.style.minHeight)||0,s=parseInt(this.style.maxWidth)||1/0,o=parseInt(this.style.maxHeight)||1/0;if(!n){n=this.resizeHandle=bt('<div class="djs-direct-editing-resize-handle"></div>');var a,l,c,d,h=function(m){IE(m),gg(m),a=m.clientX,l=m.clientY;var g=e.getBoundingClientRect();c=g.width,d=g.height,ie.bind(document,"mousemove",p),ie.bind(document,"mouseup",f)},p=function(m){IE(m),gg(m);var g=C$(j$(c+m.clientX-a,r),s),v=C$(j$(d+m.clientY-l,i),o);e.style.width=g+"px",e.style.height=v+"px",t.resizeHandler({width:c,height:d,dx:m.clientX-a,dy:m.clientY-l})},f=function(m){IE(m),gg(m),ie.unbind(document,"mousemove",p,!1),ie.unbind(document,"mouseup",f,!1)};ie.bind(n,"mousedown",h)}B(n.style,{position:"absolute",bottom:"0px",right:"0px",cursor:"nwse-resize",width:"0",height:"0",borderTop:(parseInt(this.style.fontSize)/4||3)+"px solid transparent",borderRight:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderBottom:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderLeft:(parseInt(this.style.fontSize)/4||3)+"px solid transparent"}),e.appendChild(n)};Ko.prototype.destroy=function(){var t=this.parent,e=this.content,n=this.resizeHandle;e.innerText="",t.removeAttribute("style"),e.removeAttribute("style"),ie.unbind(e,"keydown",this.keyHandler),ie.unbind(e,"mousedown",gg),ie.unbind(e,"input",this.autoResize),ie.unbind(e,"paste",this.handlePaste),n&&(n.removeAttribute("style"),Nr(n)),Nr(t)};Ko.prototype.getValue=function(){return this.content.innerText.trim()};Ko.prototype.getSelection=function(){var t=window.getSelection(),e=t.getRangeAt(0);return e};Ko.prototype.setSelection=function(t,e){var n=document.createRange();t===null?n.selectNodeContents(this.content):(n.setStart(t,e),n.setEnd(t,e));var r=window.getSelection();r.removeAllRanges(),r.addRange(n)};function Exe(t){return t.replace(/\r\n|\r|\n/g,`
`)}function xo(t,e){this._eventBus=t,this._providers=[],this._textbox=new Ko({container:e.getContainer(),keyHandler:li(this._handleKey,this),resizeHandler:li(this._handleResize,this)})}xo.$inject=["eventBus","canvas"];xo.prototype.registerProvider=function(t){this._providers.push(t)};xo.prototype.isActive=function(t){return!!(this._active&&(!t||this._active.element===t))};xo.prototype.cancel=function(){this._active&&(this._fire("cancel"),this.close())};xo.prototype._fire=function(t,e){this._eventBus.fire("directEditing."+t,e||{active:this._active})};xo.prototype.close=function(){this._textbox.destroy(),this._fire("deactivate"),this._active=null,this.resizable=void 0};xo.prototype.complete=function(){var t=this._active;if(t){var e,n=t.context.bounds,r=this.$textbox.getBoundingClientRect(),i=this.getValue(),s=t.context.text;(i!==s||r.height!==n.height||r.width!==n.width)&&(e=this._textbox.container.getBoundingClientRect(),t.provider.update(t.element,i,t.context.text,{x:r.left-e.left,y:r.top-e.top,width:r.width,height:r.height})),this._fire("complete"),this.close()}};xo.prototype.getValue=function(){return this._textbox.getValue()};xo.prototype._handleKey=function(t){t.stopPropagation();var e=t.keyCode||t.charCode;if(e===27)return t.preventDefault(),this.cancel();if(e===13&&!t.shiftKey)return t.preventDefault(),this.complete()};xo.prototype._handleResize=function(t){this._fire("resize",t)};xo.prototype.activate=function(t){this.isActive()&&this.cancel();var e,n=Tt(this._providers,function(r){return(e=r.activate(t))?r:null});return e&&(this.$textbox=this._textbox.create(e.bounds,e.style,e.text,e.options),this._active={element:t,context:e,provider:n},e.options&&e.options.resizable&&(this.resizable=!0),this._fire("activate")),!!e};const Sxe={__depends__:[ry],__init__:["directEditing"],directEditing:["type",xo]};function iy(t,e,n,r,i){this._canvas=t,this._modeling=r,this._textRenderer=i,e.registerProvider(this),n.on("element.dblclick",function(s){e.activate(s.element)}),n.on(["autoPlace.start","canvas.viewbox.changing","drag.init","drillDown.click","element.mousedown","popupMenu.open","selection.changed"],function(){e.complete()}),n.on(["commandStack.changed"],function(){e.cancel()}),n.on("create.end",500,function(s){var o=s.shape;(Y(o,"dmn:Decision")||Y(o,"dmn:InputData")||Y(o,"dmn:BusinessKnowledgeModel")||Y(o,"dmn:KnowledgeSource")||Y(o,"dmn:TextAnnotation"))&&e.activate(o)}),n.on("autoPlace.end",500,function(s){e.activate(s.shape)})}iy.$inject=["canvas","directEditing","eventBus","modeling","textRenderer"];iy.prototype.activate=function(t){var e=N0(t);if(an(e)){var n={text:e},r=this.getEditingBBox(t);B(n,r);var i={};return Y(t,"dmn:DRGElement")&&B(i,{centerVertically:!0}),Y(t,"dmn:TextAnnotation")&&B(i,{resizable:!0}),B(n,{options:i}),n}};iy.prototype.getEditingBBox=function(t){var e=this._canvas,n=t.label||t,r=e.getAbsoluteBBox(n),i={x:r.x,y:r.y},s=e.zoom(),o=this._textRenderer.getDefaultStyle(),a=o.fontSize*s,l=o.lineHeight,c={fontFamily:this._textRenderer.getDefaultStyle().fontFamily,fontWeight:this._textRenderer.getDefaultStyle().fontWeight};return Y(t,"dmn:DRGElement")&&(B(i,{width:r.width,height:r.height}),B(c,{fontSize:a+"px",lineHeight:l,paddingTop:7*s+"px",paddingBottom:7*s+"px",paddingLeft:5*s+"px",paddingRight:5*s+"px"})),Y(t,"dmn:TextAnnotation")&&(B(i,{width:r.width,height:r.height,minWidth:30*s,minHeight:10*s}),B(c,{textAlign:"left",paddingTop:5*s+"px",paddingBottom:7*s+"px",paddingLeft:7*s+"px",paddingRight:5*s+"px",fontSize:a+"px",lineHeight:l})),{bounds:i,style:c}};iy.prototype.update=function(t,e,n,r){var i,s;Y(t,"dmn:TextAnnotation")&&(s=this._canvas.getAbsoluteBBox(t),i={x:t.x,y:t.y,width:t.width/s.width*r.width,height:t.height/s.height*r.height}),Cxe(e)&&(e=null),this._modeling.updateLabel(t,e,i)};function Cxe(t){return!t||!t.trim()}const jxe={__depends__:[XU,ZU,Sxe],__init__:["labelEditingProvider"],labelEditingProvider:["type",iy]};function $T(t,e){e.invoke(Yn,this),this.preExecute("connection.create",function(n){var r=n.connection,i=r.businessObject,s=n.source,o=n.target,a,l,c;Y(r,"dmn:Association")?(l=i.sourceRef=t.create("dmn:DMNElementReference",{href:"#"+s.id}),l.$parent=i,c=i.targetRef=t.create("dmn:DMNElementReference",{href:"#"+o.id}),c.$parent=i):(a=i["required"+kxe(s)]=t.create("dmn:DMNElementReference",{href:"#"+s.id}),a.$parent=i)},!0)}$T.$inject=["drdFactory","injector"];Ce($T,Yn);function kxe(t){if(Y(t,"dmn:BusinessKnowledgeModel"))return"Knowledge";if(Y(t,"dmn:Decision"))return"Decision";if(Y(t,"dmn:InputData"))return"Input";if(Y(t,"dmn:KnowledgeSource"))return"Authority"}var Pxe=500;function MT(t,e,n,r){t.invoke(Yn,this),this.preExecute(["connection.create","connection.reconnect"],function(s){var o=s.connection,a=s.newSource||s.source,l=s.newTarget||s.target;if(!(Y(o,"dmn:InformationRequirement")&&!r.allowed("connection.connect",{connection:o,source:a,target:l}))&&Y(o,"dmn:InformationRequirement")){var c=Ss(a,l);s.hints||(s.hints={}),B(s.hints,Txe(a,l,c))}},!0);function i(s,o,a){o||(o=s.incoming.filter(function(c){return Y(c,"dmn:InformationRequirement")}));var l={};a?l[a]=o:l=Oxe(s,o),$(l,function(c,d){c=Rxe(c,d);var h=Nxe(c,s,d);c.forEach((p,f)=>{var m=h[f].start,g=h[f].end,v=e.layoutConnection(p,{connectionStart:m,connectionEnd:g});n.updateWaypoints(p,v)})})}this.postExecuted(["connection.create","connection.delete","connection.reconnect"],function(s){var o=s.connection,a=o.source||s.source,l=o.target||s.target;if(Y(o,"dmn:InformationRequirement")){var c=Ss(a,l),d=l.incoming.filter(h=>{var p=Ss(h.source,h.target);return Y(h,"dmn:InformationRequirement")&&k$(p,c)});d.length&&i(l,d,c)}},!0),this.preExecute("connection.reconnect",function(s){var o=s.connection,a=o.source,l=o.target;if(Y(o,"dmn:InformationRequirement")){var c=Ss(a,l),d=l.incoming.filter(h=>{var p=Ss(h.source,h.target);return h!==o&&Y(h,"dmn:InformationRequirement")&&k$(p,c)});d.length&&i(l,d,c)}},!0),this.postExecuted("elements.move",Pxe,function(s){var o=s.shapes,a=s.closure,l=a.enclosedConnections;o.forEach(function(c){if(Hi(c,["dmn:Decision","dmn:InputData"])){var d=c.incoming.filter(function(h){return Y(h,"dmn:InformationRequirement")&&!l[h.id]});d.length&&i(c,d),c.outgoing.forEach(function(h){!Y(h,"dmn:InformationRequirement")||l[h.id]||i(h.target)})}})},!0)}MT.$inject=["injector","layouter","modeling","rules"];Ce(MT,Yn);function Txe(t,e,n){var r=fn(t),i=fn(e);return n.includes("bottom")?(r.y=t.y,i.y=e.y+e.height):n.includes("top")?(r.y=t.y+t.height,i.y=e.y):n.includes("right")?(r.x=t.x,i.x=e.x+e.width):(r.x=t.x+t.width,i.x=e.x),{connectionStart:r,connectionEnd:i}}function Nxe(t,e,n){return t.map(function(r,i){var s=r.source,o=fn(s),a=kt(s),l=kt(e),c=t.length;return n.includes("bottom")?{start:{x:o.x,y:a.top},end:{x:l.left+e.width/(c+1)*(i+1),y:l.bottom}}:n.includes("top")?{start:{x:o.x,y:a.bottom},end:{x:l.left+e.width/(c+1)*(i+1),y:l.top}}:n.includes("right")?{start:{x:a.left,y:o.y},end:{x:l.right,y:l.top+e.height/(c+1)*(i+1)}}:{start:{x:a.right,y:o.y},end:{x:l.left,y:l.top+e.height/(c+1)*(i+1)}}})}function Oxe(t,e){var n={};return e.forEach(function(r){var i=Ss(r.source,t).split("-").shift();n[i]||(n[i]=[]),n[i].push(r)}),n}function k$(t,e){return t&&e&&t.split("-").shift()===e.split("-").shift()}function Rxe(t,e){var n;return e.includes("top")||e.includes("bottom")?n="x":n="y",t.sort(function(r,i){return fn(r.source)[n]-fn(i.source)[n]})}function LT(t,e,n){t.invoke(Yn,this),this.preExecute("connection.reconnect",function(r){var i=r.connection,s=r.newSource||i.source,o=r.newTarget||i.target,a=i.waypoints.slice(),l=n.allowed("connection.reconnect",{connection:i,source:s,target:o});!l||l.type===i.type||(r.connection=e.connect(s,o,{type:l.type,waypoints:a}),e.removeConnection(i))},!0)}Ce(LT,Yn);LT.$inject=["injector","modeling","rules"];function BT(t,e,n){Yn.call(this,t),this._modeling=e,this.postExecuted(["shape.replace"],1500,function(r){var i=r.context,s=i.oldShape,o=i.newShape;e.unclaimId(s.businessObject.id,s.businessObject),e.updateProperties(o,{id:s.id}),n.select(o)})}Ce(BT,Yn);BT.$inject=["eventBus","modeling","selection"];var Axe=1e3;function bo(t){this._eventBus=t}bo.$inject=["eventBus"];function Ixe(t,e){return function(n){return t.call(e||null,n.context,n.command,n)}}bo.prototype.on=function(t,e,n,r,i,s){if((Bt(e)||Oe(e))&&(s=i,i=r,r=n,n=e,e=null),Bt(n)&&(s=i,i=r,r=n,n=Axe),Wn(i)&&(s=i,i=!1),!Bt(r))throw new Error("handlerFn must be a function");ke(t)||(t=[t]);var o=this._eventBus;$(t,function(a){var l=["commandStack",a,e].filter(function(c){return c}).join(".");o.on(l,n,i?Ixe(r,s):r,s)})};bo.prototype.canExecute=Hl("canExecute");bo.prototype.preExecute=Hl("preExecute");bo.prototype.preExecuted=Hl("preExecuted");bo.prototype.execute=Hl("execute");bo.prototype.executed=Hl("executed");bo.prototype.postExecute=Hl("postExecute");bo.prototype.postExecuted=Hl("postExecuted");bo.prototype.revert=Hl("revert");bo.prototype.reverted=Hl("reverted");function Hl(t){return function(n,r,i,s,o){(Bt(n)||Oe(n))&&(o=s,s=i,i=r,r=n,n=null),this.on(n,t,r,i,s,o)}}var P$="id";class L_ extends bo{constructor(e){super(e),this.executed("element.updateProperties",this.updateIds.bind(this))}updateIds(e){var n=e.context,r=n.element,i=n.oldProperties,s=n.properties,o=jl(r);if(!this.shouldSkipUpdate(o,i,s)){var a=$xe(o),l=a.get("drgElement");l.forEach(d=>{Mxe(d,i.id,s.id)});var c=a.get("artifact");c.forEach(d=>{Lxe(d,i.id,s.id)})}}shouldSkipUpdate(e,n,r){return!Dxe(n,r)||!Y(e,"dmn:DRGElement")&&!Y(e,"dmn:TextAnnotation")}}L_.$inject=["eventBus"];function Dxe(t,e){return P$ in t&&P$ in e}function $xe(t){for(var e=t;!Y(e,"dmn:Definitions");)e=e.$parent;return e}function Mxe(t,e,n){var r={authorityRequirement:()=>{t.authorityRequirement.forEach(i=>{var s=i.requiredAuthority,o=i.requiredDecision,a=i.requiredInput;s&&s.href==="#".concat(e)&&(s.href="#".concat(n)),o&&o.href==="#".concat(e)&&(o.href="#".concat(n)),a&&a.href==="#".concat(e)&&(a.href="#".concat(n))})},informationRequirement:()=>{t.informationRequirement.forEach(i=>{var s=i.requiredDecision,o=i.requiredInput;s&&s.href==="#".concat(e)&&(s.href="#".concat(n)),o&&o.href==="#".concat(e)&&(o.href="#".concat(n))})},knowledgeRequirement:()=>{t.knowledgeRequirement.forEach(i=>{var s=i.requiredKnowledge;s&&s.href==="#".concat(e)&&(s.href="#".concat(n))})}};$(r,(i,s)=>{t[s]&&i()})}function Lxe(t,e,n){var r={sourceRef:()=>{var i=t.sourceRef;i.href==="#".concat(e)&&(i.href="#".concat(n))},targetRef:()=>{var i=t.targetRef;i.href==="#".concat(e)&&(i.href="#".concat(n))}};$(r,(i,s)=>{t[s]&&i()})}const Bxe={__init__:["createConnectionBehavior","idChangeBehavior","layoutConnectionBehavior","replaceConnectionBehavior","replaceElementBehavior"],createConnectionBehavior:["type",$T],idChangeBehavior:["type",L_],layoutConnectionBehavior:["type",MT],replaceConnectionBehavior:["type",LT],replaceElementBehavior:["type",BT]};function Vf(t){Yn.call(this,t),this.init()}Vf.$inject=["eventBus"];Ce(Vf,Yn);Vf.prototype.addRule=function(t,e,n){var r=this;typeof t=="string"&&(t=[t]),t.forEach(function(i){r.canExecute(i,e,function(s,o,a){return n(s)},!0)})};Vf.prototype.init=function(){};function sh(t){t.invoke(Vf,this)}Ce(sh,Vf);sh.$inject=["injector"];sh.prototype.init=function(){this.addRule("connection.create",function(t){var e=t.source,n=t.target;return JC(e,n)}),this.addRule("connection.reconnect",function(t){t.connection;var e=t.source,n=t.target;return JC(e,n)}),this.addRule("connection.updateWaypoints",function(t){var e=t.connection;return{type:e.type,businessObject:e.businessObject}}),this.addRule("elements.move",function(t){var e=t.target,n=t.shapes;return t.position,eV(n,e)}),this.addRule("shape.create",function(t){var e=t.shape,n=t.target;return JU(e,n)}),this.addRule("shape.resize",function(t){var e=t.shape;return Y(e,"dmn:TextAnnotation")})};sh.prototype.canConnect=JC;sh.prototype.canCreate=JU;sh.prototype.canMove=eV;function JC(t,e){if(!t||T$(t)||!e||T$(e))return null;if(t===e)return!1;if(Y(t,"dmn:BusinessKnowledgeModel")&&Hi(e,["dmn:BusinessKnowledgeModel","dmn:Decision"]))return{type:"dmn:KnowledgeRequirement"};if(Y(t,"dmn:Decision")){if(Y(e,"dmn:Decision"))return{type:"dmn:InformationRequirement"};if(Y(e,"dmn:KnowledgeSource"))return{type:"dmn:AuthorityRequirement"}}if(Y(t,"dmn:Definitions")||Y(e,"dmn:Definitions"))return!1;if(Y(t,"dmn:InputData")){if(Y(e,"dmn:Decision"))return{type:"dmn:InformationRequirement"};if(Y(e,"dmn:KnowledgeSource"))return{type:"dmn:AuthorityRequirement"}}return Y(t,"dmn:KnowledgeSource")&&Hi(e,["dmn:BusinessKnowledgeModel","dmn:Decision","dmn:KnowledgeSource"])?{type:"dmn:AuthorityRequirement"}:Y(t,"dmn:TextAnnotation")&&!Y(e,"dmn:TextAnnotation")||!Y(t,"dmn:TextAnnotation")&&Y(e,"dmn:TextAnnotation")?{type:"dmn:Association"}:!1}function JU(t,e){return Hi(t,["dmn:BusinessKnowledgeModel","dmn:Decision","dmn:InputData","dmn:KnowledgeSource","dmn:TextAnnotation"])&&Y(e,"dmn:Definitions")}function eV(t,e){return ke(t)||(t=[t]),!!(!e||Zs(t,function(n){return Hi(n,["dmn:BusinessKnowledgeModel","dmn:Decision","dmn:InputData","dmn:KnowledgeSource","dmn:TextAnnotation","dmn:InformationRequirement","dmn:AuthorityRequirement","dmn:KnowledgeRequirement","dmn:Association"])})&&Y(e,"dmn:Definitions"))}function T$(t){return!!t.labelTarget}const Fxe={__depends__:[zf],__init__:["drdRules"],drdRules:["type",sh]};function Yo(t){this._model=t}Yo.$inject=["moddle"];Yo.prototype._needsId=function(t){return Hi(t,["dmn:Artifact","dmn:DMNElement","dmn:DRGElement","dmndi:DMNDiagram","dmndi:DMNDiagramElement"])};Yo.prototype._ensureId=function(t){var e=(t.$type||"").replace(/^[^:]*:/g,"")+"_";!t.id&&this._needsId(t)&&(t.id=this._model.ids.nextPrefixed(e,t))};Yo.prototype.create=function(t,e){var n=this._model.create(t,e||{});return this._ensureId(n),n};Yo.prototype.createDiShape=function(t,e,n){return this.create("dmndi:DMNShape",B({dmnElementRef:t,bounds:this.createDiBounds(e)},n))};Yo.prototype.createDiBounds=function(t){return this.create("dc:Bounds",t)};Yo.prototype.createDiEdge=function(t,e,n){return this.create("dmndi:DMNEdge",{dmnElementRef:t,waypoint:this.createDiWaypoints(e)},n)};Yo.prototype.createDiWaypoints=function(t){var e=this;return t.map(function(n){return e.createDiWaypoint(n)})};Yo.prototype.createDiWaypoint=function(t){return this.create("dc:Point",ui(t,["x","y"]))};Yo.prototype.createExtensionElements=function(){return this.create("dmn:ExtensionElements",{values:[]})};function pu(t,e,n,r,i){i.invoke(Yn,this),this._definitionPropertiesView=e,this._drdFactory=n,this._drdRules=r;var s=this;function o(h){var p=h.connection,f=h.cropped;f||(p.waypoints=t.getCroppedWaypoints(p),h.cropped=!0)}this.executed(["connection.create","connection.layout"],o,!0),this.reverted(["connection.layout"],function(h){delete h.cropped},!0);function a(h){var p=h.connection,f=h.parent,m=h.shape;p&&!Y(p,"dmn:Association")&&(f=p.target),s.updateParent(m||p,f)}function l(h){var p=h.connection,f=h.shape,m=h.parent||h.newParent;p&&!Y(p,"dmn:Association")&&(m=p.target),s.updateParent(f||p,m)}this.executed(["connection.create","connection.delete","connection.move","shape.create","shape.delete"],a,!0),this.reverted(["connection.create","connection.delete","connection.move","shape.create","shape.delete"],l,!0);function c(h){var p=h.shape;(Y(p,"dmn:DRGElement")||Y(p,"dmn:TextAnnotation"))&&s.updateBounds(p)}this.executed(["shape.create","shape.move","shape.resize"],c,!0),this.reverted(["shape.create","shape.move","shape.resize"],c,!0);function d(h){s.updateConnectionWaypoints(h)}this.executed(["connection.create","connection.layout","connection.move","connection.updateWaypoints"],d,!0),this.reverted(["connection.create","connection.layout","connection.move","connection.updateWaypoints"],d,!0),this.executed("connection.create",function(h){var p=h.connection,f=p.businessObject,m=h.target,g=m.businessObject;Y(p,"dmn:Association")?a(h):s.updateSemanticParent(f,g)},!0),this.reverted("connection.create",function(h){l(h)},!0),this.executed("connection.reconnect",function(h){var p=h.connection,f=p.businessObject,m=h.newTarget,g=m.businessObject;Y(f,"dmn:Association")||s.updateSemanticParent(f,g)},!0),this.reverted("connection.reconnect",function(h){var p=h.connection,f=p.businessObject,m=h.oldTarget,g=m.businessObject;Y(f,"dmn:Association")||s.updateSemanticParent(f,g)},!0),this.executed("element.updateProperties",function(h){e.update()},!0),this.reverted("element.updateProperties",function(h){e.update()},!0)}Ce(pu,Yn);pu.$inject=["connectionDocking","definitionPropertiesView","drdFactory","drdRules","injector"];pu.prototype.updateBounds=function(t){var e=t.businessObject,n=e.di.bounds;B(n,{x:t.x,y:t.y,width:t.width,height:t.height})};pu.prototype.updateConnectionWaypoints=function(t){var e=this._drdFactory,n=t.connection,r=n.businessObject,i=r.di;i.waypoint=e.createDiWaypoints(n.waypoints).map(function(s){return s.$parent=i,s})};pu.prototype.updateParent=function(t,e){var n=t.parent;!Y(t,"dmn:DRGElement")&&!Y(t,"dmn:Artifact")&&(n=e);var r=t.businessObject,i=n&&n.businessObject;this.updateSemanticParent(r,i),this.updateDiParent(r.di,i&&i.di)};pu.prototype.updateSemanticParent=function(t,e){var n,r;t.$parent!==e&&(Y(t,"dmn:DRGElement")?r="drgElement":Y(t,"dmn:Artifact")?r="artifact":Y(t,"dmn:InformationRequirement")?r="informationRequirement":Y(t,"dmn:AuthorityRequirement")?r="authorityRequirement":Y(t,"dmn:KnowledgeRequirement")&&(r="knowledgeRequirement"),t.$parent&&(n=t.$parent.get(r),Zd(n,t)),e?(n=e.get(r),n&&(n.push(t),t.$parent=e)):t.$parent=null)};pu.prototype.updateDiParent=function(t,e){if(t.$parent!==e)if(Hi(t,["dmndi:DMNEdge","dmndi:DMNShape"])){for(var n=e||t;!Y(n,"dmndi:DMNDiagram");)n=n.$parent;var r=n.get("diagramElements");e?(t.$parent=n,Ml(r,t)):(t.$parent=null,Zd(r,t))}else throw new Error("unsupported")};function B_(t,e){this._modeling=t,this._canvas=e}B_.$inject=["modeling","canvas"];B_.prototype.preExecute=function(t){var e=this._modeling,n=t.elements,r=t.alignment;$(n,function(i){var s={x:0,y:0};an(r.left)?s.x=r.left-i.x:an(r.right)?s.x=r.right-i.width-i.x:an(r.center)?s.x=r.center-Math.round(i.width/2)-i.x:an(r.top)?s.y=r.top-i.y:an(r.bottom)?s.y=r.bottom-i.height-i.y:an(r.middle)&&(s.y=r.middle-Math.round(i.height/2)-i.y),e.moveElements([i],s,i.parent)})};B_.prototype.postExecute=function(t){};function F_(t){this._modeling=t}F_.$inject=["modeling"];F_.prototype.preExecute=function(t){var e=t.source;if(!e)throw new Error("source required");var n=t.target||e.parent,r=t.shape,i=t.hints||{};r=t.shape=this._modeling.createShape(r,t.position,n,{attach:i.attach}),t.shape=r};F_.prototype.postExecute=function(t){var e=t.hints||{};zxe(t.source,t.shape)||(e.connectionTarget===t.source?this._modeling.connect(t.shape,t.source,t.connection):this._modeling.connect(t.source,t.shape,t.connection))};function zxe(t,e){return Yc(t.outgoing,function(n){return n.target===e})}function z_(t,e){this._canvas=t,this._layouter=e}z_.$inject=["canvas","layouter"];z_.prototype.execute=function(t){var e=t.connection,n=t.source,r=t.target,i=t.parent,s=t.parentIndex,o=t.hints;if(!n||!r)throw new Error("source and target required");if(!i)throw new Error("parent required");return e.source=n,e.target=r,e.waypoints||(e.waypoints=this._layouter.layoutConnection(e,o)),this._canvas.addConnection(e,i,s),e};z_.prototype.revert=function(t){var e=t.connection;return this._canvas.removeConnection(e),e.source=null,e.target=null,e};var _x=Math.round;function FT(t){this._modeling=t}FT.$inject=["modeling"];FT.prototype.preExecute=function(t){var e=t.elements,n=t.parent,r=t.parentIndex,i=t.position,s=t.hints,o=this._modeling;$(e,function(h){Oe(h.x)||(h.x=0),Oe(h.y)||(h.y=0)});var a=ht(e,function(h){return!h.hidden}),l=Ps(a);$(e,function(h){Mi(h)&&(h.waypoints=yr(h.waypoints,function(p){return{x:_x(p.x-l.x-l.width/2+i.x),y:_x(p.y-l.y-l.height/2+i.y)}})),B(h,{x:_x(h.x-l.x-l.width/2+i.x),y:_x(h.y-l.y-l.height/2+i.y)})});var c=hfe(e),d={};$(e,function(h){if(Mi(h)){d[h.id]=Oe(r)?o.createConnection(d[h.source.id],d[h.target.id],r,h,h.parent||n,s):o.createConnection(d[h.source.id],d[h.target.id],h,h.parent||n,s);return}var p=B({},s);c.indexOf(h)===-1&&(p.autoResize=!1),Xp(h)&&(p=oo(p,["attach"])),d[h.id]=Oe(r)?o.createShape(h,ui(h,["x","y","width","height"]),h.parent||n,r,p):o.createShape(h,ui(h,["x","y","width","height"]),h.parent||n,p)}),t.elements=yf(d)};var N$=Math.round;function fu(t){this._canvas=t}fu.$inject=["canvas"];fu.prototype.execute=function(t){var e=t.shape,n=t.position,r=t.parent,i=t.parentIndex;if(!r)throw new Error("parent required");if(!n)throw new Error("position required");return n.width!==void 0?B(e,n):B(e,{x:n.x-N$(e.width/2),y:n.y-N$(e.height/2)}),this._canvas.addShape(e,r,i),e};fu.prototype.revert=function(t){var e=t.shape;return this._canvas.removeShape(e),e};function sy(t){fu.call(this,t)}Ce(sy,fu);sy.$inject=["canvas"];var Hxe=fu.prototype.execute;sy.prototype.execute=function(t){var e=t.shape;return Vxe(e),e.labelTarget=t.labelTarget,Hxe.call(this,t)};var Uxe=fu.prototype.revert;sy.prototype.revert=function(t){return t.shape.labelTarget=null,Uxe.call(this,t)};function Vxe(t){["width","height"].forEach(function(e){typeof t[e]>"u"&&(t[e]=0)})}function vg(t,e){if(typeof e!="function")throw new Error("removeFn iterator must be a function");if(t){for(var n;n=t[0];)e(n);return t}}function oy(t,e){this._canvas=t,this._modeling=e}oy.$inject=["canvas","modeling"];oy.prototype.preExecute=function(t){var e=this._modeling,n=t.connection;vg(n.incoming,function(r){e.removeConnection(r,{nested:!0})}),vg(n.outgoing,function(r){e.removeConnection(r,{nested:!0})})};oy.prototype.execute=function(t){var e=t.connection,n=e.parent;return t.parent=n,t.parentIndex=pH(n.children,e),t.source=e.source,t.target=e.target,this._canvas.removeConnection(e),e.source=null,e.target=null,e};oy.prototype.revert=function(t){var e=t.connection,n=t.parent,r=t.parentIndex;return e.source=t.source,e.target=t.target,Ml(n.children,e,r),this._canvas.addConnection(e,n),e};function zT(t,e){this._modeling=t,this._elementRegistry=e}zT.$inject=["modeling","elementRegistry"];zT.prototype.postExecute=function(t){var e=this._modeling,n=this._elementRegistry,r=t.elements;$(r,function(i){n.get(i.id)&&(i.waypoints?e.removeConnection(i):e.removeShape(i))})};function ay(t,e){this._canvas=t,this._modeling=e}ay.$inject=["canvas","modeling"];ay.prototype.preExecute=function(t){var e=this._modeling,n=t.shape;vg(n.incoming,function(r){e.removeConnection(r,{nested:!0})}),vg(n.outgoing,function(r){e.removeConnection(r,{nested:!0})}),vg(n.children,function(r){Mi(r)?e.removeConnection(r,{nested:!0}):e.removeShape(r,{nested:!0})})};ay.prototype.execute=function(t){var e=this._canvas,n=t.shape,r=n.parent;return t.oldParent=r,t.oldParentIndex=pH(r.children,n),e.removeShape(n),n};ay.prototype.revert=function(t){var e=this._canvas,n=t.shape,r=t.oldParent,i=t.oldParentIndex;return Ml(r.children,n,i),e.addShape(n,r),n};function H_(t){this._modeling=t}H_.$inject=["modeling"];var O$={x:"y",y:"x"};H_.prototype.preExecute=function(t){var e=this._modeling,n=t.groups,r=t.axis,i=t.dimension;function s(v,b){v.range.min=Math.min(b[r],v.range.min),v.range.max=Math.max(b[r]+b[i],v.range.max)}function o(v){return v[r]+v[i]/2}function a(v){return v.length-1}function l(v){return v.max-v.min}function c(v,b){var x={y:0};x[r]=v-o(b),x[r]&&(x[O$[r]]=0,e.moveElements([b],x,b.parent))}var d=n[0],h=a(n),p=n[h],f,m,g=0;$(n,function(v,b){var x,y,w;if(v.elements.length<2){b&&b!==n.length-1&&(s(v,v.elements[0]),g+=l(v.range));return}x=Ei(v.elements,r),y=x[0],b===h&&(y=x[a(x)]),w=o(y),v.range=null,$(x,function(E){if(c(w,E),v.range===null){v.range={min:E[r],max:E[r]+E[i]};return}s(v,E)}),b&&b!==n.length-1&&(g+=l(v.range))}),m=Math.abs(p.range.min-d.range.max),f=Math.round((m-g)/(n.length-1)),!(f<n.length-1)&&$(n,function(v,b){var x={},y;v===d||v===p||(y=n[b-1],v.range.max=0,$(v.elements,function(w,E){x[O$[r]]=0,x[r]=y.range.max-w[r]+f,v.range.min!==w[r]&&(x[r]+=w[r]-v.range.min),x[r]&&e.moveElements([w],x,w.parent),v.range.max=Math.max(w[r]+w[i],E?v.range.max:0)}))})};H_.prototype.postExecute=function(t){};function U_(t,e){this._layouter=t,this._canvas=e}U_.$inject=["layouter","canvas"];U_.prototype.execute=function(t){var e=t.connection,n=e.waypoints;return B(t,{oldWaypoints:n}),e.waypoints=this._layouter.layoutConnection(e,t.hints),e};U_.prototype.revert=function(t){var e=t.connection;return e.waypoints=t.oldWaypoints,e};function HT(){}HT.prototype.execute=function(t){var e=t.connection,n=t.delta,r=t.newParent||e.parent,i=t.newParentIndex,s=e.parent;return t.oldParent=s,t.oldParentIndex=Zd(s.children,e),Ml(r.children,e,i),e.parent=r,$(e.waypoints,function(o){o.x+=n.x,o.y+=n.y,o.original&&(o.original.x+=n.x,o.original.y+=n.y)}),e};HT.prototype.revert=function(t){var e=t.connection,n=e.parent,r=t.oldParent,i=t.oldParentIndex,s=t.delta;return Zd(n.children,e),Ml(r.children,e,i),e.parent=r,$(e.waypoints,function(o){o.x-=s.x,o.y-=s.y,o.original&&(o.original.x-=s.x,o.original.y-=s.y)}),e};function V_(t,e,n){var r=DD(e),i=DD(n),s=vp(t,r),o={x:s.x*(n.width/e.width),y:s.y*(n.height/e.height)};return pg({x:i.x+o.x,y:i.y+o.y})}function UT(t,e,n){var r=q_(t),i=nV(r,e),s=r[0];return i.length?i[i.length-1]:V_(s.original||s,n,e)}function VT(t,e,n){var r=q_(t),i=nV(r,e),s=r[r.length-1];return i.length?i[0]:V_(s.original||s,n,e)}function qT(t,e,n){var r=q_(t),i=tV(e,n),s=r[0];return V_(s.original||s,i,e)}function WT(t,e,n){var r=q_(t),i=tV(e,n),s=r[r.length-1];return V_(s.original||s,i,e)}function tV(t,e){return{x:t.x-e.x,y:t.y-e.y,width:t.width,height:t.height}}function q_(t){var e=t.waypoints;if(!e.length)throw new Error("connection#"+t.id+": no waypoints");return e}function nV(t,e){var n=yr(t,Wxe);return ht(n,function(r){return qxe(r,e)})}function qxe(t,e){return Ss(e,t,1)==="intersect"}function Wxe(t){return t.original||t}function GT(){this.allShapes={},this.allConnections={},this.enclosedElements={},this.enclosedConnections={},this.topLevel={}}GT.prototype.add=function(t,e){return this.addAll([t],e)};GT.prototype.addAll=function(t,e){var n=mfe(t,!!e,this);return B(this,n),this};function ly(t){this._modeling=t}ly.prototype.moveRecursive=function(t,e,n){return t?this.moveClosure(this.getClosure(t),e,n):[]};ly.prototype.moveClosure=function(t,e,n,r,i){var s=this._modeling,o=t.allShapes,a=t.allConnections,l=t.enclosedConnections,c=t.topLevel,d=!1;i&&i.parent===n&&(d=!0),$(o,function(h){s.moveShape(h,e,c[h.id]&&!d&&n,{recurse:!1,layout:!1})}),$(a,function(h){var p=!!o[h.source.id],f=!!o[h.target.id];l[h.id]&&p&&f?s.moveConnection(h,e,c[h.id]&&!d&&n):s.layoutConnection(h,{connectionStart:p&&qT(h,h.source,e),connectionEnd:f&&WT(h,h.target,e)})})};ly.prototype.getClosure=function(t){return new GT().addAll(t,!0)};function W_(t){this._helper=new ly(t)}W_.$inject=["modeling"];W_.prototype.preExecute=function(t){t.closure=this._helper.getClosure(t.shapes)};W_.prototype.postExecute=function(t){var e=t.hints,n;e&&e.primaryShape&&(n=e.primaryShape,e.oldParent=n.parent),this._helper.moveClosure(t.closure,t.delta,t.newParent,t.newHost,n)};function oh(t){this._modeling=t,this._helper=new ly(t)}oh.$inject=["modeling"];oh.prototype.execute=function(t){var e=t.shape,n=t.delta,r=t.newParent||e.parent,i=t.newParentIndex,s=e.parent;return t.oldBounds=ui(e,["x","y","width","height"]),t.oldParent=s,t.oldParentIndex=Zd(s.children,e),Ml(r.children,e,i),B(e,{parent:r,x:e.x+n.x,y:e.y+n.y}),e};oh.prototype.postExecute=function(t){var e=t.shape,n=t.delta,r=t.hints,i=this._modeling;r.layout!==!1&&($(e.incoming,function(s){i.layoutConnection(s,{connectionEnd:WT(s,e,n)})}),$(e.outgoing,function(s){i.layoutConnection(s,{connectionStart:qT(s,e,n)})})),r.recurse!==!1&&this.moveChildren(t)};oh.prototype.revert=function(t){var e=t.shape,n=t.oldParent,r=t.oldParentIndex,i=t.delta;return Ml(n.children,e,r),B(e,{parent:n,x:e.x-i.x,y:e.y-i.y}),e};oh.prototype.moveChildren=function(t){var e=t.delta,n=t.shape;this._helper.moveRecursive(n.children,e,null)};oh.prototype.getNewParent=function(t){return t.newParent||t.shape.parent};function cy(t){this._modeling=t}cy.$inject=["modeling"];cy.prototype.execute=function(t){var e=t.newSource,n=t.newTarget,r=t.connection,i=t.dockingOrPoints;if(!e&&!n)throw new Error("newSource or newTarget required");return ke(i)&&(t.oldWaypoints=r.waypoints,r.waypoints=i),e&&(t.oldSource=r.source,r.source=e),n&&(t.oldTarget=r.target,r.target=n),r};cy.prototype.postExecute=function(t){var e=t.connection,n=t.newSource,r=t.newTarget,i=t.dockingOrPoints,s=t.hints||{},o={};s.connectionStart&&(o.connectionStart=s.connectionStart),s.connectionEnd&&(o.connectionEnd=s.connectionEnd),s.layoutConnection!==!1&&(n&&(!r||s.docking==="source")&&(o.connectionStart=o.connectionStart||R$(ke(i)?i[0]:i)),r&&(!n||s.docking==="target")&&(o.connectionEnd=o.connectionEnd||R$(ke(i)?i[i.length-1]:i)),s.newWaypoints&&(o.waypoints=s.newWaypoints),this._modeling.layoutConnection(e,o))};cy.prototype.revert=function(t){var e=t.oldSource,n=t.oldTarget,r=t.oldWaypoints,i=t.connection;return e&&(i.source=e),n&&(i.target=n),r&&(i.waypoints=r),i};function R$(t){return t.original||t}function Ul(t,e){this._modeling=t,this._rules=e}Ul.$inject=["modeling","rules"];Ul.prototype.preExecute=function(t){var e=this,n=this._modeling,r=this._rules,i=t.oldShape,s=t.newData,o=t.hints||{},a;function l(m,g,v){return r.allowed("connection.reconnect",{connection:v,source:m,target:g})}var c={x:s.x,y:s.y},d={x:i.x,y:i.y,width:i.width,height:i.height};a=t.newShape=t.newShape||e.createShape(s,c,i.parent,o),i.host&&n.updateAttachment(a,i.host);var h;o.moveChildren!==!1&&(h=i.children.slice(),n.moveElements(h,{x:0,y:0},a,o));var p=i.incoming.slice(),f=i.outgoing.slice();$(p,function(m){var g=m.source,v=l(g,a,m);v&&e.reconnectEnd(m,a,VT(m,a,d),o)}),$(f,function(m){var g=m.target,v=l(a,g,m);v&&e.reconnectStart(m,a,UT(m,a,d),o)})};Ul.prototype.postExecute=function(t){var e=t.oldShape;this._modeling.removeShape(e)};Ul.prototype.execute=function(t){};Ul.prototype.revert=function(t){};Ul.prototype.createShape=function(t,e,n,r){return this._modeling.createShape(t,e,n,r)};Ul.prototype.reconnectStart=function(t,e,n,r){this._modeling.reconnectStart(t,e,n,r)};Ul.prototype.reconnectEnd=function(t,e,n,r){this._modeling.reconnectEnd(t,e,n,r)};function uy(t){this._modeling=t}uy.$inject=["modeling"];uy.prototype.execute=function(t){var e=t.shape,n=t.newBounds,r=t.minBounds;if(n.x===void 0||n.y===void 0||n.width===void 0||n.height===void 0)throw new Error("newBounds must have {x, y, width, height} properties");if(r&&(n.width<r.width||n.height<r.height))throw new Error("width and height cannot be less than minimum height and width");if(!r&&n.width<10||n.height<10)throw new Error("width and height cannot be less than 10px");return t.oldBounds={width:e.width,height:e.height,x:e.x,y:e.y},B(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e};uy.prototype.postExecute=function(t){var e=this._modeling,n=t.shape,r=t.oldBounds,i=t.hints||{};i.layout!==!1&&($(n.incoming,function(s){e.layoutConnection(s,{connectionEnd:VT(s,n,r)})}),$(n.outgoing,function(s){e.layoutConnection(s,{connectionStart:UT(s,n,r)})}))};uy.prototype.revert=function(t){var e=t.shape,n=t.oldBounds;return B(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e};function Gxe(t,e){var n=[];return $(t.concat(e),function(r){var i=r.incoming,s=r.outgoing;$(i.concat(s),function(o){var a=o.source,l=o.target;(Nm(t,a)||Nm(t,l)||Nm(e,a)||Nm(e,l))&&(Nm(n,o)||n.push(o))})}),n}function Nm(t,e){return t.indexOf(e)!==-1}function Kxe(t,e,n){var r=t.x,i=t.y,s=t.width,o=t.height,a=n.x,l=n.y;switch(e){case"n":return{x:r,y:i+l,width:s,height:o-l};case"s":return{x:r,y:i,width:s,height:o+l};case"w":return{x:r+a,y:i,width:s-a,height:o};case"e":return{x:r,y:i,width:s+a,height:o};default:throw new Error("unknown direction: "+e)}}function mu(t){this._modeling=t}mu.$inject=["modeling"];mu.prototype.preExecute=function(t){var e=t.delta,n=t.direction,r=t.movingShapes,i=t.resizingShapes,s=t.start,o={};this.moveShapes(r,e),$(i,function(a){o[a.id]=Xxe(a)}),this.resizeShapes(i,e,n),this.updateConnectionWaypoints(Gxe(r,i),e,n,s,r,i,o)};mu.prototype.execute=function(){};mu.prototype.revert=function(){};mu.prototype.moveShapes=function(t,e){var n=this;$(t,function(r){n._modeling.moveShape(r,e,null,{autoResize:!1,layout:!1,recurse:!1})})};mu.prototype.resizeShapes=function(t,e,n){var r=this;$(t,function(i){var s=Kxe(i,n,e);r._modeling.resizeShape(i,s,null,{attachSupport:!1,autoResize:!1,layout:!1})})};mu.prototype.updateConnectionWaypoints=function(t,e,n,r,i,s,o){var a=this,l=i.concat(s);$(t,function(c){var d=c.source,h=c.target,p=Yxe(c),f=rV(n),m={};uc(l,d)&&uc(l,h)?(p=yr(p,function(g){return I$(g,r,n)&&(g[f]=g[f]+e[f]),g.original&&I$(g.original,r,n)&&(g.original[f]=g.original[f]+e[f]),g}),a._modeling.updateWaypoints(c,p,{labelBehavior:!1})):(uc(l,d)||uc(l,h))&&(uc(i,d)?m.connectionStart=qT(c,d,e):uc(i,h)?m.connectionEnd=WT(c,h,e):uc(s,d)?m.connectionStart=UT(c,d,o[d.id]):uc(s,h)&&(m.connectionEnd=VT(c,h,o[h.id])),a._modeling.layoutConnection(c,m))})};function A$(t){return B({},t)}function Yxe(t){return yr(t.waypoints,function(e){return e=A$(e),e.original&&(e.original=A$(e.original)),e})}function rV(t){switch(t){case"n":return"y";case"w":return"x";case"s":return"y";case"e":return"x"}}function I$(t,e,n){var r=rV(n);if(/e|s/.test(n))return t[r]>e;if(/n|w/.test(n))return t[r]<e}function uc(t,e){return t.indexOf(e)!==-1}function Xxe(t){return{x:t.x,y:t.y,height:t.height,width:t.width}}function G_(t){this._modeling=t}G_.$inject=["modeling"];G_.prototype.execute=function(t){var e=t.shape,n=e.children;t.oldChildrenVisibility=iV(n),e.collapsed=!e.collapsed;var r=sV(n,e.collapsed);return[e].concat(r)};G_.prototype.revert=function(t){var e=t.shape,n=t.oldChildrenVisibility,r=e.children,i=oV(r,n);return e.collapsed=!e.collapsed,[e].concat(i)};function iV(t){var e={};return $(t,function(n){e[n.id]=n.hidden,n.children&&(e=B({},e,iV(n.children)))}),e}function sV(t,e){var n=[];return $(t,function(r){r.hidden=e,n=n.concat(r),r.children&&(n=n.concat(sV(r.children,r.collapsed||e)))}),n}function oV(t,e){var n=[];return $(t,function(r){r.hidden=e[r.id],n=n.concat(r),r.children&&(n=n.concat(oV(r.children,e)))}),n}function K_(t){this._modeling=t}K_.$inject=["modeling"];K_.prototype.execute=function(t){var e=t.shape,n=t.newHost,r=e.host;return t.oldHost=r,t.attacherIdx=aV(r,e),lV(n,e),e.host=n,e};K_.prototype.revert=function(t){var e=t.shape,n=t.newHost,r=t.oldHost,i=t.attacherIdx;return e.host=r,aV(n,e),lV(r,e,i),e};function aV(t,e){return Zd(t&&t.attachers,e)}function lV(t,e,n){if(t){var r=t.attachers;r||(t.attachers=r=[]),Ml(r,e,n)}}function KT(){}KT.prototype.execute=function(t){var e=t.connection,n=t.newWaypoints;return t.oldWaypoints=e.waypoints,e.waypoints=n,e};KT.prototype.revert=function(t){var e=t.connection,n=t.oldWaypoints;return e.waypoints=n,e};function bn(t,e,n){this._eventBus=t,this._elementFactory=e,this._commandStack=n;var r=this;t.on("diagram.init",function(){r.registerHandlers(n)})}bn.$inject=["eventBus","elementFactory","commandStack"];bn.prototype.getHandlers=function(){return{"shape.append":F_,"shape.create":fu,"shape.delete":ay,"shape.move":oh,"shape.resize":uy,"shape.replace":Ul,"shape.toggleCollapse":G_,spaceTool:mu,"label.create":sy,"connection.create":z_,"connection.delete":oy,"connection.move":HT,"connection.layout":U_,"connection.updateWaypoints":KT,"connection.reconnect":cy,"elements.create":FT,"elements.move":W_,"elements.delete":zT,"elements.distribute":H_,"elements.align":B_,"element.updateAttachment":K_}};bn.prototype.registerHandlers=function(t){$(this.getHandlers(),function(e,n){t.registerHandler(n,e)})};bn.prototype.moveShape=function(t,e,n,r,i){typeof r=="object"&&(i=r,r=null);var s={shape:t,delta:e,newParent:n,newParentIndex:r,hints:i||{}};this._commandStack.execute("shape.move",s)};bn.prototype.updateAttachment=function(t,e){var n={shape:t,newHost:e};this._commandStack.execute("element.updateAttachment",n)};bn.prototype.moveElements=function(t,e,n,r){r=r||{};var i=r.attach,s=n,o;i===!0?(o=n,s=n.parent):i===!1&&(o=null);var a={shapes:t,delta:e,newParent:s,newHost:o,hints:r};this._commandStack.execute("elements.move",a)};bn.prototype.moveConnection=function(t,e,n,r,i){typeof r=="object"&&(i=r,r=void 0);var s={connection:t,delta:e,newParent:n,newParentIndex:r,hints:i||{}};this._commandStack.execute("connection.move",s)};bn.prototype.layoutConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.layout",n)};bn.prototype.createConnection=function(t,e,n,r,i,s){typeof n=="object"&&(s=i,i=r,r=n,n=void 0),r=this._create("connection",r);var o={source:t,target:e,parent:i,parentIndex:n,connection:r,hints:s};return this._commandStack.execute("connection.create",o),o.connection};bn.prototype.createShape=function(t,e,n,r,i){typeof r!="number"&&(i=r,r=void 0),i=i||{};var s=i.attach,o,a;t=this._create("shape",t),s?(o=n.parent,a=n):o=n;var l={position:e,shape:t,parent:o,parentIndex:r,host:a,hints:i};return this._commandStack.execute("shape.create",l),l.shape};bn.prototype.createElements=function(t,e,n,r,i){ke(t)||(t=[t]),typeof r!="number"&&(i=r,r=void 0),i=i||{};var s={position:e,elements:t,parent:n,parentIndex:r,hints:i};return this._commandStack.execute("elements.create",s),s.elements};bn.prototype.createLabel=function(t,e,n,r){n=this._create("label",n);var i={labelTarget:t,position:e,parent:r||t.parent,shape:n};return this._commandStack.execute("label.create",i),i.shape};bn.prototype.appendShape=function(t,e,n,r,i){i=i||{},e=this._create("shape",e);var s={source:t,position:n,target:r,shape:e,connection:i.connection,connectionParent:i.connectionParent,hints:i};return this._commandStack.execute("shape.append",s),s.shape};bn.prototype.removeElements=function(t){var e={elements:t};this._commandStack.execute("elements.delete",e)};bn.prototype.distributeElements=function(t,e,n){var r={groups:t,axis:e,dimension:n};this._commandStack.execute("elements.distribute",r)};bn.prototype.removeShape=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.delete",n)};bn.prototype.removeConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.delete",n)};bn.prototype.replaceShape=function(t,e,n){var r={oldShape:t,newData:e,hints:n||{}};return this._commandStack.execute("shape.replace",r),r.newShape};bn.prototype.alignElements=function(t,e){var n={elements:t,alignment:e};this._commandStack.execute("elements.align",n)};bn.prototype.resizeShape=function(t,e,n,r){var i={shape:t,newBounds:e,minBounds:n,hints:r};this._commandStack.execute("shape.resize",i)};bn.prototype.createSpace=function(t,e,n,r,i){var s={delta:n,direction:r,movingShapes:t,resizingShapes:e,start:i};this._commandStack.execute("spaceTool",s)};bn.prototype.updateWaypoints=function(t,e,n){var r={connection:t,newWaypoints:e,hints:n||{}};this._commandStack.execute("connection.updateWaypoints",r)};bn.prototype.reconnect=function(t,e,n,r,i){var s={connection:t,newSource:e,newTarget:n,dockingOrPoints:r,hints:i||{}};this._commandStack.execute("connection.reconnect",s)};bn.prototype.reconnectStart=function(t,e,n,r){r||(r={}),this.reconnect(t,e,t.target,n,B(r,{docking:"source"}))};bn.prototype.reconnectEnd=function(t,e,n,r){r||(r={}),this.reconnect(t,t.source,e,n,B(r,{docking:"target"}))};bn.prototype.connect=function(t,e,n,r){return this.createConnection(t,e,n||{},t.parent,r)};bn.prototype._create=function(t,e){return Dfe(e)?e:this._elementFactory.create(t,e)};bn.prototype.toggleCollapse=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.toggleCollapse",n)};function Y_(t){this._moddle=t}Y_.$inject=["moddle"];Y_.prototype.execute=function(t){var e=this._moddle.ids,n=t.id,r=t.element,i=t.claiming;i?e.claim(n,r):e.unclaim(n)};Y_.prototype.revert=function(t){var e=this._moddle.ids,n=t.id,r=t.element,i=t.claiming;i?e.unclaim(n):e.claim(n,r)};function Qxe(){function t(r,i){var s=r.label||r,o=r.labelTarget||r;return eve(s,i,o!==s),[s,o]}function e(r){return r.oldLabel=N0(r.element),t(r.element,r.newLabel)}function n(r){return t(r.element,r.oldLabel)}this.execute=e,this.revert=n}var Zxe="name",xl="id";function X_(t,e){this._elementRegistry=t,this._moddle=e}X_.$inject=["elementRegistry","moddle"];X_.prototype.execute=function(t){var e=t.element,n=[e];if(!e)throw new Error("element required");var r=this._elementRegistry,i=this._moddle.ids,s=e.businessObject,o=t.properties,a=t.oldProperties||Jxe(s,Nd(o));return cV(o,s)&&(i.unclaim(s[xl]),r.updateId(e,o[xl]),i.claim(o[xl],s)),Zxe in o&&e.label&&n.push(e.label),uV(s,o),t.oldProperties=a,t.changed=n,n};X_.prototype.revert=function(t){var e=t.element,n=t.properties,r=t.oldProperties,i=e.businessObject,s=this._elementRegistry,o=this._moddle.ids;return uV(i,r),cV(n,i)&&(o.unclaim(n[xl]),s.updateId(e,r[xl]),o.claim(r[xl],i)),t.changed};function cV(t,e){return xl in t&&t[xl]!==e[xl]}function Jxe(t,e){return xr(e,function(n,r){return n[r]=t.get(r),n},{})}function uV(t,e){$(e,function(n,r){t.set(r,n)})}function Vl(t,e,n){this._canvas=t,this._drdRules=e,n.invoke(bn,this)}Ce(Vl,bn);Vl.$inject=["canvas","drdRules","injector"];Vl.prototype.claimId=function(t,e){this._commandStack.execute("id.updateClaim",{id:t,element:e,claiming:!0})};Vl.prototype.connect=function(t,e,n,r){var i=this._drdRules,s=this._canvas.getRootElement();return n||(n=i.canConnect(t,e)||{type:"dmn:Association"}),this.createConnection(t,e,n,s,r)};Vl.prototype.getHandlers=function(){var t=bn.prototype.getHandlers.call(this);return t["id.updateClaim"]=Y_,t["element.updateLabel"]=Qxe,t["element.updateProperties"]=X_,t};Vl.prototype.unclaimId=function(t,e){this._commandStack.execute("id.updateClaim",{id:t,element:e})};Vl.prototype.updateProperties=function(t,e){this._commandStack.execute("element.updateProperties",{element:t,properties:e})};Vl.prototype.updateLabel=function(t,e,n,r){this._commandStack.execute("element.updateLabel",{element:t,newLabel:e,newBounds:n,hints:r||{}})};function dV(){}dV.prototype.layoutConnection=function(t,e){return e=e||{},[e.connectionStart||fn(e.source||t.source),e.connectionEnd||fn(e.target||t.target)]};var Ex=20;function Q_(t){this._connectionDocking=t}Ce(Q_,dV);Q_.$inject=["connectionDocking"];Q_.prototype.layoutConnection=function(t,e){var n=this._connectionDocking;e||(e={});var r=e.source||t.source,i=e.target||t.target,s=e.waypoints||t.waypoints||[],o=e.connectionStart,a=e.connectionEnd,l=Ss(r,i);if(o||(o=D$(s[0],r)),a||(a=D$(s[s.length-1],i)),Y(t,"dmn:InformationRequirement")){s=[o,a];var c=n.getCroppedWaypoints(B({},t,{waypoints:s}),r,i);a=c.pop();var d={x:a.x,y:a.y};return l.includes("bottom")?d.y+=Ex:l.includes("top")?d.y-=Ex:l.includes("right")?d.x+=Ex:d.x-=Ex,s=c.concat([d,a]),s}return[o,a]};function D$(t,e){return t?t.original||t:fn(e)}function $$(t){return B({original:t.point.original||t.point},t.actual)}function gu(t,e){this._elementRegistry=t,this._graphicsFactory=e}gu.$inject=["elementRegistry","graphicsFactory"];gu.prototype.getCroppedWaypoints=function(t,e,n){e=e||t.source,n=n||t.target;var r=this.getDockingPoint(t,e,!0),i=this.getDockingPoint(t,n),s=t.waypoints.slice(r.idx+1,i.idx);return s.unshift($$(r)),s.push($$(i)),s};gu.prototype.getDockingPoint=function(t,e,n){var r=t.waypoints,i,s,o;return i=n?0:r.length-1,s=r[i],o=this._getIntersection(e,t,n),{point:s,actual:o||s,idx:i}};gu.prototype._getIntersection=function(t,e,n){var r=this._getShapePath(t),i=this._getConnectionPath(e);return HC(r,i,n)};gu.prototype._getConnectionPath=function(t){return this._graphicsFactory.getConnectionPath(t)};gu.prototype._getShapePath=function(t){return this._graphicsFactory.getShapePath(t)};gu.prototype._getGfx=function(t){return this._elementRegistry.getGraphics(t)};const ebe={__init__:["modeling","drdUpdater"],__depends__:[Bxe,Fxe,wT,XU,Ha,ZU],drdFactory:["type",Yo],drdUpdater:["type",pu],elementFactory:["type",th],modeling:["type",Vl],layouter:["type",Q_],connectionDocking:["type",gu]};var tbe=500,nbe=1250,rbe=1500,R0=Math.round;function ibe(t){return{x:t.x+R0(t.width/2),y:t.y+R0(t.height/2)}}function hV(t,e,n,r,i){function s(a,l,c,d){return i.allowed("elements.move",{shapes:a,delta:l,position:c,target:d})}t.on("shape.move.start",rbe,function(a){var l=a.context,c=a.shape,d=r.get().slice();d.indexOf(c)===-1&&(d=[c]),d=sbe(d),B(l,{shapes:d,validatedShapes:d,shape:c})}),t.on("shape.move.start",nbe,function(a){var l=a.context,c=l.validatedShapes,d;if(d=l.canExecute=s(c),!d)return!1}),t.on("shape.move.move",tbe,function(a){var l=a.context,c=l.validatedShapes,d=a.hover,h={x:a.dx,y:a.dy},p={x:a.x,y:a.y},f;if(f=s(c,h,p,d),l.delta=h,l.canExecute=f,f===null){l.target=null;return}l.target=d}),t.on("shape.move.end",function(a){var l=a.context,c=l.delta,d=l.canExecute,h=d==="attach",p=l.shapes;if(d===!1)return!1;c.x=R0(c.x),c.y=R0(c.y),!(c.x===0&&c.y===0)&&n.moveElements(p,c,l.target,{primaryShape:l.shape,attach:h})}),t.on("element.mousedown",function(a){if(uu(a)){var l=Mf(a);if(!l)throw new Error("must supply DOM mousedown event");return o(l,a.element)}});function o(a,l,c,d){if(Wn(c)&&(d=c,c=!1),!(l.waypoints||!l.parent)&&!Ge(a.target).has("djs-hit-no-move")){var h=ibe(l);return e.init(a,h,"shape.move",{cursor:"grabbing",autoActivate:c,data:{shape:l,context:d||{}}}),!0}}this.start=o}hV.$inject=["eventBus","dragging","modeling","selection","rules"];function sbe(t){var e=Kc(t,"id");return ht(t,function(n){for(;n=n.parent;)if(e[n.id])return!1;return!0})}var M$=499,DE="djs-dragging",L$="drop-ok",B$="drop-not-ok",F$="new-parent",z$="attach-ok";function pV(t,e,n,r){function i(l){var c=s(l),d=obe(c);return d}function s(l){var c=ffe(l),d=yr(c,function(h){return(h.incoming||[]).concat(h.outgoing||[])});return Cg(c.concat(d))}function o(l,c){[z$,L$,B$,F$].forEach(function(d){d===c?e.addMarker(l,d):e.removeMarker(l,d)})}function a(l,c,d){r.addDragger(c,l.dragGroup),d&&e.addMarker(c,DE),l.allDraggedElements?l.allDraggedElements.push(c):l.allDraggedElements=[c]}t.on("shape.move.start",M$,function(l){var c=l.context,d=c.shapes,h=c.allDraggedElements,p=i(d);if(!c.dragGroup){var f=ee("g");K(f,n.cls("djs-drag-group",["no-events"]));var m=e.getActiveLayer();re(m,f),c.dragGroup=f}p.forEach(function(g){r.addDragger(g,c.dragGroup)}),h?h=Cg([h,s(d)]):h=s(d),$(h,function(g){e.addMarker(g,DE)}),c.allDraggedElements=h,c.differentParents=abe(d)}),t.on("shape.move.move",M$,function(l){var c=l.context,d=c.dragGroup,h=c.target,p=c.shape.parent,f=c.canExecute;h&&(f==="attach"?o(h,z$):c.canExecute&&h&&h.id!==p.id?o(h,F$):o(h,c.canExecute?L$:B$)),Ta(d,l.dx,l.dy)}),t.on(["shape.move.out","shape.move.cleanup"],function(l){var c=l.context,d=c.target;d&&o(d,null)}),t.on("shape.move.cleanup",function(l){var c=l.context,d=c.allDraggedElements,h=c.dragGroup;$(d,function(p){e.removeMarker(p,DE)}),h&&un(h)}),this.makeDraggable=a}pV.$inject=["eventBus","canvas","styles","previewSupport"];function obe(t){var e=ht(t,function(n){return Mi(n)?Tt(t,Cs({id:n.source.id}))&&Tt(t,Cs({id:n.target.id})):!0});return e}function abe(t){return YB(Kc(t,function(e){return e.parent&&e.parent.id}))!==1}const lbe={__depends__:[ry,Ha,yT,zf,nh,OT],__init__:["move","movePreview"],move:["type",hV],movePreview:["type",pV]};function H$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function cbe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?H$(Object(n),!0).forEach(function(r){ube(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):H$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function ube(t,e,n){return e=dbe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function dbe(t){var e=hbe(t,"string");return typeof e=="symbol"?e:String(e)}function hbe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var pbe=`
M2.45221 16.0068L18.7175 1.74436L18.0615 0.996331L18.7175 1.74436C19.2646 1.26455 19.9676 
1 20.6953 1H140.926C142.583 1 143.926 2.34295 143.926 3.99967L143.93 37.5457C143.93 
38.3668 143.593 39.152 142.999 39.7183L143.689 40.4424L142.999 39.7183L127.299 
54.6723C126.741 55.2036 126 55.5 125.23 55.5H4.53787C2.88599 55.5 1.54491 54.1646 1.5379 
52.5127L1.43066 27.229L1.43065 27.2248L1.4301 18.2626C1.43005 
17.3986 1.80255 16.5765 2.45221 16.0068Z
`,fbe=`
M1.79494 63.0032L1.2941 63.6423L1.79493 63.0032C1.71778 62.9427 1.6428 62.8741 1.57288 
62.8L1.01736 63.3241L1.57288 62.8C1.20495 62.41 1 61.8941 1 61.3579V2.65067C1 1.74066 
1.73867 1.00345 2.64868 1.00526L108.006 1.2145C109.66 1.21778 111 2.55996 111 
4.21449V21.7015V61.6762C111 63.3188 109.679 64.656 108.037 64.676L107.06 64.6879C106.66 
64.6927 106.26 64.6165 105.89 64.4652C105.04 64.1176 104.222 63.78 103.43 
63.4531C93.4866 59.3517 87.6891 56.9603 76.3991 58.1057C71.7035 58.5821 66.8747 60.74 
61.5721 63.1744C61.3243 63.2881 61.0753 63.4026 60.825 63.5177C55.6712 65.8868 49.9696 
68.5077 43.2365 70.3468C31.101 73.6617 15.2135 73.5179 1.79494 63.0032Z
`,mbe={width:135,height:46},gbe={width:100,height:63};function U$(t,e,n){return ee("path",cbe({d:t,strokeWidth:2,transform:"translate(".concat(e.x,", ").concat(e.y,")")},n))}var Sx=5;function Z_(t,e){this._styles=e,t.registerProvider(this)}Z_.$inject=["outline","styles"];Z_.prototype.getOutline=function(t){var e=this._styles.cls("djs-outline",["no-fill"]),n;return Y(t,"dmn:InputData")?(n=ee("rect"),K(n,B({x:-Sx,y:-Sx,rx:27,width:t.width+Sx*2,height:t.height+Sx*2},e))):Y(t,"dmn:BusinessKnowledgeModel")&&V$(t,"dmn:BusinessKnowledgeModel")?n=U$(pbe,{x:-6,y:-6},e):Y(t,"dmn:KnowledgeSource")&&V$(t,"dmn:KnowledgeSource")&&(n=U$(fbe,{x:-6,y:-1.5},e)),n};Z_.prototype.updateOutline=function(t){return!!Hi(t,["dmn:InputData","dmn:BusinessKnowledgeModel","dmn:KnowledgeSource"])};function V$(t,e){var n;return e==="dmn:BusinessKnowledgeModel"?n=mbe:e==="dmn:KnowledgeSource"&&(n=gbe),t.width===n.width&&t.height===n.height}const vbe={__depends__:[yT],__init__:["outlineProvider"],outlineProvider:["type",Z_]};var fV=".djs-palette-toggle",mV=".entry",ybe=fV+", "+mV,ej="djs-palette-",xbe="shown",tj="open",q$="two-column",bbe=1e3;function cr(t,e){this._eventBus=t,this._canvas=e;var n=this;t.on("tool-manager.update",function(r){var i=r.tool;n.updateToolHighlight(i)}),t.on("i18n.changed",function(){n._update()}),t.on("diagram.init",function(){n._diagramInitialized=!0,n._rebuild()})}cr.$inject=["eventBus","canvas"];cr.prototype.registerProvider=function(t,e){e||(e=t,t=bbe),this._eventBus.on("palette.getProviders",t,function(n){n.providers.push(e)}),this._rebuild()};cr.prototype.getEntries=function(){var t=this._getProviders();return t.reduce(_be,{})};cr.prototype._rebuild=function(){if(this._diagramInitialized){var t=this._getProviders();t.length&&(this._container||this._init(),this._update())}};cr.prototype._init=function(){var t=this,e=this._eventBus,n=this._getParentContainer(),r=this._container=bt(cr.HTML_MARKUP);n.appendChild(r),vt(n).add(ej+xbe),Zn.bind(r,ybe,"click",function(i){var s=i.delegateTarget;if(zd(s,fV))return t.toggle();t.trigger("click",i)}),ie.bind(r,"mousedown",function(i){i.stopPropagation()}),Zn.bind(r,mV,"dragstart",function(i){t.trigger("dragstart",i)}),e.on("canvas.resized",this._layoutChanged,this),e.fire("palette.create",{container:r})};cr.prototype._getProviders=function(t){var e=this._eventBus.createEvent({type:"palette.getProviders",providers:[]});return this._eventBus.fire(e),e.providers};cr.prototype._toggleState=function(t){t=t||{};var e=this._getParentContainer(),n=this._container,r=this._eventBus,i,s=vt(n),o=vt(e);"twoColumn"in t?i=t.twoColumn:i=this._needsCollapse(e.clientHeight,this._entries||{}),s.toggle(q$,i),o.toggle(ej+q$,i),"open"in t&&(s.toggle(tj,t.open),o.toggle(ej+tj,t.open)),r.fire("palette.changed",{twoColumn:i,open:this.isOpen()})};cr.prototype._update=function(){var t=at(".djs-palette-entries",this._container),e=this._entries=this.getEntries();xf(t),$(e,function(n,r){var i=n.group||"default",s=at("[data-group="+CT(i)+"]",t);s||(s=bt('<div class="group"></div>'),vn(s,"data-group",i),t.appendChild(s));var o=n.html||(n.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),a=bt(o);if(s.appendChild(a),!n.separator&&(vn(a,"data-action",r),n.title&&vn(a,"title",n.title),n.className&&wbe(a,n.className),n.imageUrl)){var l=bt("<img>");vn(l,"src",n.imageUrl),a.appendChild(l)}}),this.open()};cr.prototype.trigger=function(t,e,n){var r,i,s=e.delegateTarget||e.target;return s?(r=vn(s,"data-action"),i=e.originalEvent||e,this.triggerEntry(r,t,i,n)):e.preventDefault()};cr.prototype.triggerEntry=function(t,e,n,r){var i=this._entries,s,o;if(s=i[t],!!s&&(o=s.action,this._eventBus.fire("palette.trigger",{entry:s,event:n})!==!1)){if(Bt(o)){if(e==="click")return o(n,r)}else if(o[e])return o[e](n,r);n.preventDefault()}};cr.prototype._layoutChanged=function(){this._toggleState({})};cr.prototype._needsCollapse=function(t,e){var n=50,r=Object.keys(e).length*46;return t<r+n};cr.prototype.close=function(){this._toggleState({open:!1,twoColumn:!1})};cr.prototype.open=function(){this._toggleState({open:!0})};cr.prototype.toggle=function(){this.isOpen()?this.close():this.open()};cr.prototype.isActiveTool=function(t){return t&&this._activeTool===t};cr.prototype.updateToolHighlight=function(t){var e,n;this._toolsContainer||(e=at(".djs-palette-entries",this._container),this._toolsContainer=at("[data-group=tools]",e)),n=this._toolsContainer,$(n.children,function(r){var i=r.getAttribute("data-action");if(i){var s=vt(r);i=i.replace("-tool",""),s.contains("entry")&&i===t?s.add("highlighted-entry"):s.remove("highlighted-entry")}})};cr.prototype.isOpen=function(){return vt(this._container).has(tj)};cr.prototype._getParentContainer=function(){return this._canvas.getContainer()};cr.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>';function wbe(t,e){var n=vt(t),r=ke(e)?e:e.split(/\s+/g);r.forEach(function(i){n.add(i)})}function _be(t,e){var n=e.getPaletteEntries();return Bt(n)?n(t):($(n,function(r,i){t[i]=r}),t)}const Ebe={__init__:["palette"],palette:["type",cr]};var Sbe=250;function ah(t,e){this._eventBus=t,this._dragging=e,this._tools=[],this._active=null}ah.$inject=["eventBus","dragging"];ah.prototype.registerTool=function(t,e){var n=this._tools;if(!e)throw new Error(`A tool has to be registered with it's "events"`);n.push(t),this.bindEvents(t,e)};ah.prototype.isActive=function(t){return t&&this._active===t};ah.prototype.length=function(t){return this._tools.length};ah.prototype.setActive=function(t){var e=this._eventBus;this._active!==t&&(this._active=t,e.fire("tool-manager.update",{tool:t}))};ah.prototype.bindEvents=function(t,e){var n=this._eventBus,r=this._dragging,i=[];n.on(e.tool+".init",function(s){var o=s.context;if(!o.reactivate&&this.isActive(t)){this.setActive(null),r.cancel();return}this.setActive(t)},this),$(e,function(s){i.push(s+".ended"),i.push(s+".canceled")}),n.on(i,Sbe,function(s){this._active&&(Cbe(s)||this.setActive(null))},this)};function Cbe(t){var e=t.originalEvent&&t.originalEvent.target;return e&&ur(e,'.group[data-group="tools"]')}const gV={__depends__:[nh],__init__:["toolManager"],toolManager:["type",ah]};function YT(t){var e=this;this._lastMoveEvent=null;function n(r){e._lastMoveEvent=r}t.on("canvas.init",function(r){var i=e._svg=r.svg;i.addEventListener("mousemove",n)}),t.on("canvas.destroy",function(){e._lastMouseEvent=null,e._svg.removeEventListener("mousemove",n)})}YT.$inject=["eventBus"];YT.prototype.getLastMoveEvent=function(){return this._lastMoveEvent||jbe(0,0)};function jbe(t,e){var n=document.createEvent("MouseEvent"),r=t,i=e,s=t,o=e;return n.initMouseEvent&&n.initMouseEvent("mousemove",!0,!0,window,0,r,i,s,o,!1,!1,!1,!1,0,null),n}const vV={__init__:["mouse"],mouse:["type",YT]};var yV="crosshair";function lh(t,e,n,r,i,s,o){this._selection=i,this._dragging=n,this._mouse=o;var a=this,l={create:function(c){var d=e.getActiveLayer(),h;h=c.frame=ee("rect"),K(h,{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),re(d,h)},update:function(c){var d=c.frame,h=c.bbox;K(d,{x:h.x,y:h.y,width:h.width,height:h.height})},remove:function(c){c.frame&&un(c.frame)}};s.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),t.on("lasso.selection.end",function(c){var d=c.originalEvent.target;!c.hover&&!(d instanceof SVGElement)||t.once("lasso.selection.ended",function(){a.activateLasso(c.originalEvent,!0)})}),t.on("lasso.end",function(c){var d=$E(c),h=r.filter(function(p){return p});a.select(h,d)}),t.on("lasso.start",function(c){var d=c.context;d.bbox=$E(c),l.create(d)}),t.on("lasso.move",function(c){var d=c.context;d.bbox=$E(c),l.update(d)}),t.on("lasso.cleanup",function(c){var d=c.context;l.remove(d)}),t.on("element.mousedown",1500,function(c){if(JH(c))return a.activateLasso(c.originalEvent),!0})}lh.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager","mouse"];lh.prototype.activateLasso=function(t,e){this._dragging.init(t,"lasso",{autoActivate:e,cursor:yV,data:{context:{}}})};lh.prototype.activateSelection=function(t,e){this._dragging.init(t,"lasso.selection",{trapClick:!1,autoActivate:e,cursor:yV,data:{context:{}}})};lh.prototype.select=function(t,e){var n=gfe(t,e);this._selection.select(yf(n))};lh.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateSelection(t,!!t)};lh.prototype.isActive=function(){var t=this._dragging.context();return t&&/^lasso/.test(t.prefix)};function $E(t){var e={x:t.x-t.dx,y:t.y-t.dy},n={x:t.x,y:t.y},r;return e.x<=n.x&&e.y<n.y||e.x<n.x&&e.y<=n.y?r={x:e.x,y:e.y,width:n.x-e.x,height:n.y-e.y}:e.x>=n.x&&e.y<n.y||e.x>n.x&&e.y<=n.y?r={x:n.x,y:e.y,width:e.x-n.x,height:n.y-e.y}:e.x<=n.x&&e.y>n.y||e.x<n.x&&e.y>=n.y?r={x:e.x,y:n.y,width:n.x-e.x,height:e.y-n.y}:e.x>=n.x&&e.y>n.y||e.x>n.x&&e.y>=n.y?r={x:n.x,y:n.y,width:e.x-n.x,height:e.y-n.y}:r={x:n.x,y:n.y,width:0,height:0},r}const kbe={__depends__:[gV,vV],__init__:["lassoTool"],lassoTool:["type",lh]};var ME=1500,xV="grab";function qf(t,e,n,r,i,s){this._dragging=n,this._mouse=s;var o=this,a=r.get("keyboard",!1);i.registerTool("hand",{tool:"hand",dragging:"hand.move"}),t.on("element.mousedown",ME,function(l){if(T0(l))return o.activateMove(l.originalEvent,!0),!1}),a&&a.addListener(ME,function(l){if(!(!W$(l.keyEvent)||o.isActive())){var c=o._mouse.getLastMoveEvent();o.activateMove(c,!!c)}},"keyboard.keydown"),a&&a.addListener(ME,function(l){!W$(l.keyEvent)||!o.isActive()||o.toggle()},"keyboard.keyup"),t.on("hand.end",function(l){var c=l.originalEvent.target;if(!l.hover&&!(c instanceof SVGElement))return!1;t.once("hand.ended",function(){o.activateMove(l.originalEvent,{reactivate:!0})})}),t.on("hand.move.move",function(l){var c=e.viewbox().scale;e.scroll({dx:l.dx*c,dy:l.dy*c})}),t.on("hand.move.end",function(l){var c=l.context,d=c.reactivate;return!T0(l)&&d&&t.once("hand.move.ended",function(h){o.activateHand(h.originalEvent,!0,!0)}),!1})}qf.$inject=["eventBus","canvas","dragging","injector","toolManager","mouse"];qf.prototype.activateMove=function(t,e,n){typeof e=="object"&&(n=e,e=!1),this._dragging.init(t,"hand.move",{autoActivate:e,cursor:xV,data:{context:n||{}}})};qf.prototype.activateHand=function(t,e,n){this._dragging.init(t,"hand",{trapClick:!1,autoActivate:e,cursor:xV,data:{context:{reactivate:n}}})};qf.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateHand(t,!!t)};qf.prototype.isActive=function(){var t=this._dragging.context();return t?/^(hand|hand\.move)$/.test(t.prefix):!1};function W$(t){return Br("Space",t)}const Pbe={__depends__:[gV,vV],__init__:["handTool"],handTool:["type",qf]};function XT(t,e,n,r,i,s){this._palette=t,this._create=e,this._elementFactory=n,this._handTool=r,this._lassoTool=i,this._translate=s,t.registerProvider(this)}XT.$inject=["palette","create","elementFactory","handTool","lassoTool","translate"];XT.prototype.getPaletteEntries=function(t){var e={},n=this._create,r=this._elementFactory,i=this._handTool,s=this._lassoTool,o=this._translate;function a(l,c,d,h,p){function f(m){var g=r.createShape(B({type:l},p));n.start(m,g)}return{group:c,className:d,title:h,action:{dragstart:f,click:f}}}return B(e,{"hand-tool":{group:"tools",className:"dmn-icon-hand-tool",title:o("Activate hand tool"),action:{click:function(c){i.activateHand(c)}}},"lasso-tool":{group:"tools",className:"dmn-icon-lasso-tool",title:o("Activate lasso tool"),action:{click:function(c){s.activateSelection(c)}}},"tool-separator":{group:"tools",separator:!0},"create.decision":a("dmn:Decision","drd","dmn-icon-decision",o("Create decision")),"create.input-data":a("dmn:InputData","drd","dmn-icon-input-data",o("Create input data")),"create.knowledge-source":a("dmn:KnowledgeSource","drd","dmn-icon-knowledge-source",o("Create knowledge source")),"create.business-knowledge-model":a("dmn:BusinessKnowledgeModel","drd","dmn-icon-business-knowledge",o("Create knowledge model"))}),e};const Tbe={__depends__:[ny,Ebe,BU,kbe,Pbe],__init__:["paletteProvider"],paletteProvider:["type",XT]};var A0=Math.max,I0=Math.min,Nbe=20;function Obe(t,e,n){var r=n.x,i=n.y,s={x:t.x,y:t.y,width:t.width,height:t.height};return e.indexOf("n")!==-1?(s.y=t.y+i,s.height=t.height-i):e.indexOf("s")!==-1&&(s.height=t.height+i),e.indexOf("e")!==-1?s.width=t.width+r:e.indexOf("w")!==-1&&(s.x=t.x+r,s.width=t.width-r),s}function Cx(t,e,n){var r=e[t],i=n.min&&n.min[t],s=n.max&&n.max[t];return Oe(i)&&(r=(/top|left/.test(t)?I0:A0)(r,i)),Oe(s)&&(r=(/top|left/.test(t)?A0:I0)(r,s)),r}function Rbe(t,e){if(!e)return t;var n=kt(t);return mH({top:Cx("top",n,e),right:Cx("right",n,e),bottom:Cx("bottom",n,e),left:Cx("left",n,e)})}function Abe(t,e,n,r){var i=kt(e),s={top:/n/.test(t)?i.bottom-n.height:i.top,left:/w/.test(t)?i.right-n.width:i.left,bottom:/s/.test(t)?i.top+n.height:i.bottom,right:/e/.test(t)?i.left+n.width:i.right},o=r?kt(r):s,a={top:I0(s.top,o.top),left:I0(s.left,o.left),bottom:A0(s.bottom,o.bottom),right:A0(s.right,o.right)};return mH(a)}function Om(t,e){return typeof t<"u"?t:Nbe}function Ibe(t,e){var n,r,i,s;return typeof e=="object"?(n=Om(e.left),r=Om(e.right),i=Om(e.top),s=Om(e.bottom)):n=r=i=s=Om(e),{x:t.x-n,y:t.y-i,width:t.width+n+r,height:t.height+i+s}}function Dbe(t){return!(t.waypoints||t.type==="label")}function $be(t,e){var n;if(t.length===void 0?n=ht(t.children,Dbe):n=t,n.length)return Ibe(Ps(n),e)}var G$=10;function dy(t,e,n,r){this._dragging=r,this._rules=e;var i=this;function s(l,c){var d=l.shape,h=l.direction,p=l.resizeConstraints,f;l.delta=c,f=Obe(d,h,c),l.newBounds=Rbe(f,p),l.canExecute=i.canResize(l)}function o(l){var c=l.resizeConstraints,d=l.minBounds;c===void 0&&(d===void 0&&(d=i.computeMinResizeBox(l)),l.resizeConstraints={min:kt(d)})}function a(l){var c=l.shape,d=l.canExecute,h=l.newBounds;if(d){if(h=_fe(h),!Mbe(c,h))return;n.resizeShape(c,h)}}t.on("resize.start",function(l){o(l.context)}),t.on("resize.move",function(l){var c={x:l.dx,y:l.dy};s(l.context,c)}),t.on("resize.end",function(l){a(l.context)})}dy.prototype.canResize=function(t){var e=this._rules,n=ui(t,["newBounds","shape","delta","direction"]);return e.allowed("shape.resize",n)};dy.prototype.activate=function(t,e,n){var r=this._dragging,i,s;if(typeof n=="string"&&(n={direction:n}),i=B({shape:e},n),s=i.direction,!s)throw new Error("must provide a direction (n|w|s|e|nw|se|ne|sw)");r.init(t,bV(e,s),"resize",{autoActivate:!0,cursor:Lbe(s),data:{shape:e,context:i}})};dy.prototype.computeMinResizeBox=function(t){var e=t.shape,n=t.direction,r,i;return r=t.minDimensions||{width:G$,height:G$},i=$be(e,t.childrenBoxPadding),Abe(n,e,r,i)};dy.$inject=["eventBus","rules","modeling","dragging"];function Mbe(t,e){return t.x!==e.x||t.y!==e.y||t.width!==e.width||t.height!==e.height}function bV(t,e){var n=fn(t),r=kt(t),i={x:n.x,y:n.y};return e.indexOf("n")!==-1?i.y=r.top:e.indexOf("s")!==-1&&(i.y=r.bottom),e.indexOf("e")!==-1?i.x=r.right:e.indexOf("w")!==-1&&(i.x=r.left),i}function Lbe(t){var e="resize-";return t==="n"||t==="s"?e+"ns":t==="e"||t==="w"?e+"ew":t==="nw"||t==="se"?e+"nwse":e+"nesw"}var K$="djs-resizing",Y$="resize-not-ok",Bbe=500;function wV(t,e,n){function r(s){var o=s.shape,a=s.newBounds,l=s.frame;l||(l=s.frame=n.addFrame(o,e.getActiveLayer()),e.addMarker(o,K$)),a.width>5&&K(l,{x:a.x,width:a.width}),a.height>5&&K(l,{y:a.y,height:a.height}),s.canExecute?Ge(l).remove(Y$):Ge(l).add(Y$)}function i(s){var o=s.shape,a=s.frame;a&&un(s.frame),e.removeMarker(o,K$)}t.on("resize.move",Bbe,function(s){r(s.context)}),t.on("resize.cleanup",function(s){i(s.context)})}wV.$inject=["eventBus","canvas","previewSupport"];var jx=-6,kx=8,Px=20,Rm="djs-resizer",Fbe=["n","w","s","e","nw","ne","se","sw"];function vu(t,e,n,r){this._resize=r,this._canvas=e;var i=this;t.on("selection.changed",function(s){var o=s.newSelection;i.removeResizers(),o.length===1&&$(o,li(i.addResizer,i))}),t.on("shape.changed",function(s){var o=s.element;n.isSelected(o)&&(i.removeResizers(),i.addResizer(o))})}vu.prototype.makeDraggable=function(t,e,n){var r=this._resize;function i(s){uu(s)&&r.activate(s,t,n)}ie.bind(e,"mousedown",i),ie.bind(e,"touchstart",i)};vu.prototype._createResizer=function(t,e,n,r){var i=this._getResizersParent(),s=zbe(r),o=ee("g");Ge(o).add(Rm),Ge(o).add(Rm+"-"+t.id),Ge(o).add(Rm+"-"+r),re(i,o);var a=ee("rect");K(a,{x:-kx/2+s.x,y:-kx/2+s.y,width:kx,height:kx}),Ge(a).add(Rm+"-visual"),re(o,a);var l=ee("rect");return K(l,{x:-Px/2+s.x,y:-Px/2+s.y,width:Px,height:Px}),Ge(l).add(Rm+"-hit"),re(o,l),Bfe(o,e,n),o};vu.prototype.createResizer=function(t,e){var n=bV(t,e),r=this._createResizer(t,n.x,n.y,e);this.makeDraggable(t,r,e)};vu.prototype.addResizer=function(t){var e=this;Mi(t)||!this._resize.canResize({shape:t})||$(Fbe,function(n){e.createResizer(t,n)})};vu.prototype.removeResizers=function(){var t=this._getResizersParent();Hd(t)};vu.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")};vu.$inject=["eventBus","canvas","selection","resize"];function zbe(t){var e={x:0,y:0};return t.indexOf("e")!==-1?e.x=-jx:t.indexOf("w")!==-1&&(e.x=jx),t.indexOf("s")!==-1?e.y=-jx:t.indexOf("n")!==-1&&(e.y=jx),e}const Hbe={__depends__:[zf,nh,OT],__init__:["resize","resizePreview","resizeHandles"],resize:["type",dy],resizePreview:["type",wV],resizeHandles:["type",vu]};var Ube="reconnectStart",Vbe="reconnectEnd",qbe=2e3;function _V(t){t.on(["bendpoint.move.move","bendpoint.move.end"],qbe,function(e){var n=e.context,r=n.allowed,i=n.hover,s=n.source,o=n.target,a=n.type;if(n.hints||(n.hints={}),delete n.hints.connectionStart,delete n.hints.connectionEnd,!(r&&r.type!=="dmn:InformationRequirement")&&!(!i||!Hi(i,["dmn:Decision","dmn:InputData"]))&&s!==o){var l=a===Ube||a===Vbe,c=Ss(s,o);l&&i===s?(Wbe(e,c),n.hints.connectionEnd=SV(o,c)):l&&i===o&&(n.hints.connectionStart=EV(s,c),Gbe(e,c))}})}_V.$inject=["eventBus"];function EV(t,e){var n=kt(t),r=fn(t);return e.includes("bottom")?r.y=n.top:e.includes("top")?r.y=n.bottom:e.includes("right")?r.x=n.left:r.x=n.right,r}function SV(t,e){var n=kt(t),r=fn(t);return e.includes("bottom")?r.y=n.bottom:e.includes("top")?r.y=n.top:e.includes("right")?r.x=n.right:r.x=n.left,r}function Wbe(t,e){var n=t.context,r=n.source,i=EV(r,e),s=t.x-i.x,o=t.y-i.y;t.x-=s,t.y-=o,t.dx-=s,t.dy-=o}function Gbe(t,e){var n=t.context,r=n.target,i=SV(r,e),s=0,o=0;e.includes("top")||e.includes("bottom")?o=t.y-i.y:s=t.x-i.x,t.x-=s,t.y-=o,t.dx-=s,t.dy-=o}var Kbe=250;function CV(t){t.on(["connect.hover","connect.move","connect.end"],Kbe,function(e){var n=e.context,r=n.canExecute,i=n.hover,s=n.source,o=n.target;if(r&&r.type==="dmn:InformationRequirement"){var a=Ss(s,o);n.connectionStart=fn(s),i===s?n.connectionEnd=fn(o):n.connectionEnd={x:e.x,y:e.y},a.includes("bottom")?(n.connectionStart.y=kt(s).top,n.connectionEnd.y=kt(o).bottom):a.includes("top")?(n.connectionStart.y=kt(s).bottom,n.connectionEnd.y=kt(o).top):a.includes("right")?(n.connectionStart.x=kt(s).left,n.connectionEnd.x=kt(o).right):(n.connectionStart.x=kt(s).right,n.connectionEnd.x=kt(o).left)}else delete n.connectionStart,delete n.connectionEnd})}CV.$inject=["eventBus"];function yu(){this._targets={},this._snapOrigins={},this._snapLocations=[],this._defaultSnaps={}}yu.prototype.getSnapOrigin=function(t){return this._snapOrigins[t]};yu.prototype.setSnapOrigin=function(t,e){this._snapOrigins[t]=e,this._snapLocations.indexOf(t)===-1&&this._snapLocations.push(t)};yu.prototype.addDefaultSnap=function(t,e){var n=this._defaultSnaps[t];n||(n=this._defaultSnaps[t]=[]),n.push(e)};yu.prototype.getSnapLocations=function(){return this._snapLocations};yu.prototype.setSnapLocations=function(t){this._snapLocations=t};yu.prototype.pointsForTarget=function(t){var e=t.id||t,n=this._targets[e];return n||(n=this._targets[e]=new J_,n.initDefaults(this._defaultSnaps)),n};function J_(){this._snapValues={}}J_.prototype.add=function(t,e){var n=this._snapValues[t];n||(n=this._snapValues[t]={x:[],y:[]}),n.x.indexOf(e.x)===-1&&n.x.push(e.x),n.y.indexOf(e.y)===-1&&n.y.push(e.y)};J_.prototype.snap=function(t,e,n,r){var i=this._snapValues[e];return i&&Xve(t[n],i[n],r)};J_.prototype.initDefaults=function(t){var e=this;$(t||{},function(n,r){$(n,function(i){e.add(r,i)})})};var Ybe=1250;function hy(t,e,n){var r=this;this._elementRegistry=t,e.on(["create.start","shape.move.start"],function(i){r.initSnap(i)}),e.on(["create.move","create.end","shape.move.move","shape.move.end"],Ybe,function(i){var s=i.context,o=s.shape,a=s.snapContext,l=s.target;if(!(i.originalEvent&&to(i.originalEvent))&&!(Gg(i)||!l)){var c=a.pointsForTarget(l);c.initialized||(c=r.addSnapTargetPoints(c,o,l),c.initialized=!0),n.snap(i,c)}}),e.on(["create.cleanup","shape.move.cleanup"],function(){n.hide()})}hy.$inject=["elementRegistry","eventBus","snapping"];hy.prototype.initSnap=function(t){var e=this._elementRegistry,n=t.context,r=n.shape,i=n.snapContext;i||(i=n.snapContext=new yu);var s;e.get(r.id)?s=yp(r,t):s={x:t.x+yp(r).x,y:t.y+yp(r).y};var o={x:s.x-r.width/2,y:s.y-r.height/2},a={x:s.x+r.width/2,y:s.y+r.height/2};return i.setSnapOrigin("mid",{x:s.x-t.x,y:s.y-t.y}),Xp(r)||(i.setSnapOrigin("top-left",{x:o.x-t.x,y:o.y-t.y}),i.setSnapOrigin("bottom-right",{x:a.x-t.x,y:a.y-t.y})),i};hy.prototype.addSnapTargetPoints=function(t,e,n){var r=this.getSnapTargets(e,n);return $(r,function(i){if(Xp(i)){Xp(e)&&t.add("mid",yp(i));return}if(Mi(i)){if(i.waypoints.length<3)return;var s=i.waypoints.slice(1,-1);$(s,function(o){t.add("mid",o)});return}t.add("mid",yp(i))}),!Oe(e.x)||!Oe(e.y)||this._elementRegistry.get(e.id)&&t.add("mid",yp(e)),t};hy.prototype.getSnapTargets=function(t,e){return RU(e).filter(function(n){return!Xbe(n)})};function Xbe(t){return!!t.hidden}var Qbe=1250;function py(t,e){var n=this;t.on(["resize.start"],function(r){n.initSnap(r)}),t.on(["resize.move","resize.end"],Qbe,function(r){var i=r.context,s=i.shape,o=s.parent,a=i.direction,l=i.snapContext;if(!(r.originalEvent&&to(r.originalEvent))&&!Gg(r)){var c=l.pointsForTarget(o);c.initialized||(c=n.addSnapTargetPoints(c,s,o,a),c.initialized=!0),e0e(a)&&ba(r,"x",r.x),t0e(a)&&ba(r,"y",r.y),e.snap(r,c)}}),t.on(["resize.cleanup"],function(){e.hide()})}py.prototype.initSnap=function(t){var e=t.context,n=e.shape,r=e.direction,i=e.snapContext;i||(i=e.snapContext=new yu);var s=jV(n,r);return i.setSnapOrigin("corner",{x:s.x-t.x,y:s.y-t.y}),i};py.prototype.addSnapTargetPoints=function(t,e,n,r){var i=this.getSnapTargets(e,n);return $(i,function(s){t.add("corner",Zve(s)),t.add("corner",Qve(s))}),t.add("corner",jV(e,r)),t};py.$inject=["eventBus","snapping"];py.prototype.getSnapTargets=function(t,e){return RU(e).filter(function(n){return!Zbe(n,t)&&!Mi(n)&&!Jbe(n)&&!Xp(n)})};function jV(t,e){var n=fn(t),r=kt(t),i={x:n.x,y:n.y};return e.indexOf("n")!==-1?i.y=r.top:e.indexOf("s")!==-1&&(i.y=r.bottom),e.indexOf("e")!==-1?i.x=r.right:e.indexOf("w")!==-1&&(i.x=r.left),i}function Zbe(t,e){return t.host===e}function Jbe(t){return!!t.hidden}function e0e(t){return t==="n"||t==="s"}function t0e(t){return t==="e"||t==="w"}var n0e=7,r0e=1e3;function xu(t){this._canvas=t,this._asyncHide=bf(li(this.hide,this),r0e)}xu.$inject=["canvas"];xu.prototype.snap=function(t,e){var n=t.context,r=n.snapContext,i=r.getSnapLocations(),s={x:Gg(t,"x"),y:Gg(t,"y")};$(i,function(o){var a=r.getSnapOrigin(o),l={x:t.x+a.x,y:t.y+a.y};if($(["x","y"],function(c){var d;s[c]||(d=e.snap(l,o,c,n0e),d!==void 0&&(s[c]={value:d,originValue:d-a[c]}))}),s.x&&s.y)return!1}),this.showSnapLine("vertical",s.x&&s.x.value),this.showSnapLine("horizontal",s.y&&s.y.value),$(["x","y"],function(o){var a=s[o];Wn(a)&&ba(t,o,a.originValue)})};xu.prototype._createLine=function(t){var e=this._canvas.getLayer("snap"),n=ee("path");return K(n,{d:"M0,0 L0,0"}),Ge(n).add("djs-snap-line"),re(e,n),{update:function(r){Oe(r)?t==="horizontal"?K(n,{d:"M-100000,"+r+" L+100000,"+r,display:""}):K(n,{d:"M "+r+",-100000 L "+r+", +100000",display:""}):K(n,{display:"none"})}}};xu.prototype._createSnapLines=function(){this._snapLines={horizontal:this._createLine("horizontal"),vertical:this._createLine("vertical")}};xu.prototype.showSnapLine=function(t,e){var n=this.getSnapLine(t);n&&n.update(e),this._asyncHide()};xu.prototype.getSnapLine=function(t){return this._snapLines||this._createSnapLines(),this._snapLines[t]};xu.prototype.hide=function(){$(this._snapLines,function(t){t.update()})};const i0e={__init__:["createMoveSnapping","resizeSnapping","snapping"],createMoveSnapping:["type",hy],resizeSnapping:["type",py],snapping:["type",xu]},s0e={__depends__:[i0e],__init__:["bendpointSnapping","connectSnapping"],bendpointSnapping:["type",_V],connectSnapping:["type",CV]};function xp(t){_d.call(this,t)}Ce(xp,_d);xp.prototype._modelingModules=[rve,Sve,Nve,eye,Rye,$ye,Wye,Yye,Zye,Jye,lxe,pxe,mxe,bxe,jxe,ebe,lbe,vbe,Tbe,Hbe,s0e];xp.prototype._modules=[].concat(xp.prototype._modules,xp.prototype._modelingModules);function o0e(t){const e={variables:[],rootElement:v0e(t)};for(let n=t;n;n=n.$parent)a0e(n,e);return e.variables}function a0e(t,e){ZT(t,"dmn:Decision")&&l0e(t,e)}function l0e(t,e){for(const n of t.get("informationRequirement"))c0e(n,e);for(const n of t.get("knowledgeRequirement"))f0e(n,e)}function c0e(t,e){const n=t.get("requiredInput");n&&u0e(n,e);const r=t.get("requiredDecision");r&&d0e(r,e)}function u0e(t,e){const n=QT(t,e.rootElement);if(!n)return;const r=n.get("name");r&&e.variables.push({name:r,origin:n})}function d0e(t,e){const n=QT(t,e.rootElement);if(!n)return;const r=n.get("name");if(!r)return;const i={name:r,origin:n},s=n.get("decisionLogic");s&&h0e(s,i),e.variables.push(i)}function h0e(t,e,n){if(ZT(t,"dmn:DecisionTable")){const r=t.get("output");p0e(r,e)}}function p0e(t,e,n){if(t.length===1){const i={...X$(t[0]),name:e.name};Object.assign(e,i);return}const r=t.map(X$);e.entries=r.filter(i=>!!i.name)}function X$(t){const e={name:t.name};return t.typeRef&&(e.detail=t.typeRef),e}function f0e(t,e){const n=t.get("requiredKnowledge");n&&m0e(n,e)}function m0e(t,e){const n=QT(t,e.rootElement);n&&ZT(n,"dmn:BusinessKnowledgeModel")&&g0e(n,e)}function g0e(t,e){const n=t.get("name");if(!n)return;const r={name:n,origin:t};e.variables.push(r)}function v0e(t){let e=t;for(;e.$parent;)e=e.$parent;return e}function QT(t,e){const n=t.get("href");if(!n||!n.startsWith("#"))return;const r=n.slice(1);return e.get("drgElement").find(s=>s.get("id")===r)}function ZT(t,e){return t.$instanceOf(e)}class kV{constructor(e){e.registerProvider(this)}getVariables(e,n){return e.concat(o0e(n))}}kV.$inject=["variableResolver"];class y0e{constructor(){this._providers=[]}registerProvider(e){this._providers.push(e)}getVariables(e){return this._providers.reduce((n,r)=>r.getVariables(n,e),[])}}const PV={__init__:["dmnVariableProvider"],dmnVariableProvider:["type",kV],variableResolver:["type",y0e]};class fy{constructor(e){B(this,e),kl(this,"businessObject",{writable:!0})}}let x0e=class extends fy{constructor(e){super(e),kl(this,"rows",{enumerable:!0,value:this.rows||[]}),kl(this,"cols",{enumerable:!0,value:this.cols||[]})}};class is extends fy{constructor(e){super(e),kl(this,"root",{writable:!0}),kl(this,"cells",{enumerable:!0,value:this.cells||[]})}}class ss extends fy{constructor(e){super(e),kl(this,"root",{writable:!0}),kl(this,"cells",{enumerable:!0,value:this.cells||[]})}}class e1 extends fy{constructor(e){super(e),kl(this,"row",{writable:!0}),kl(this,"col",{writable:!0})}}const b0e={root:x0e,row:is,col:ss,cell:e1};function w0e(t,e){const n=b0e[t];if(!n)throw new Error("unknown type "+t);return new n(e)}function kl(t,e,n){Object.defineProperty(t,e,n)}let TV=class{constructor(){this._uid=12}create(e,n={}){return n.id||(n.id=e+"_"+this._uid++),w0e(e,n)}createRoot(e){return this.create("root",e)}createRow(e){return this.create("row",e)}createCol(e){return this.create("col",e)}createCell(e){return this.create("cell",e)}},NV=class{constructor(e){this._eventBus=e,this._elements={},e.on("table.clear",this.clear.bind(this))}add(e,n){const{id:r}=e;this._elements[r]=e}remove(e){const n=e.id||e;delete this._elements[n]}get(e){return this._elements[e]}getAll(){return LE(this._elements)}forEach(e){LE(this._elements).forEach(n=>e(n))}filter(e){return LE(this._elements).filter(n=>e(n))}clear(){this._elements={}}updateId(e,n){this._validateId(n),typeof e=="string"&&(e=this.get(e)),this._eventBus.fire("element.updateId",{element:e,newId:n}),this.remove(e),e.id=n,this.add(e)}_validateId(e){if(!e)throw new Error("element must have an id");if(this._elements[e])throw new Error("element with id "+e+" already added")}};NV.$inject=["eventBus"];function LE(t){return Object.keys(t).map(function(e){return t[e]})}let OV=class{constructor(e){this._listeners={},e.on("elements.changed",({elements:n})=>{this.elementsChanged(n)}),e.on("root.remove",n=>{const r=n.root.id;this._listeners[r]&&e.once("root.add",i=>{const s=i.root.id;this.updateId(r,s)})}),e.on("element.updateId",({element:n,newId:r})=>{this.updateId(n.id,r)})}elementsChanged(e){const n={},r=e.length;for(let i=0;i<r;i++){const{id:s}=e[i];if(n[s])return;n[s]=!0;const o=this._listeners[s]&&this._listeners[s].length;if(o)for(let a=0;a<o;a++)this._listeners[s][a]&&this._listeners[s][a]()}}onElementsChanged(e,n){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e][this._listeners[e].length]=n}offElementsChanged(e,n){if(this._listeners[e])if(n){const r=this._listeners[e].indexOf(n);r!==-1&&this._listeners[e].splice(r,1)}else this._listeners[e].length=0}updateId(e,n){this._listeners[e]&&(this._listeners[n]=this._listeners[e],delete this._listeners[e])}};OV.$inject=["eventBus"];const _0e=1e3;let E0e=class{constructor(){this._listeners={}}getComponent(e,n){const r=this._listeners[e];if(!r)return;let i;for(let s=0;s<r.length&&(i=r[s].callback(n),!i);s++);return i}getComponents(e,n){const r=this._listeners[e],i=[];if(!r)return i;for(let s=0;s<r.length;s++){const o=r[s].callback(n);o&&i.push(o)}return i.length,i}onGetComponent(e,n,r){if(Bt(n)&&(r=n,n=_0e),!Oe(n))throw new Error("priority must be a number");const i=this._getListeners(e);let s,o;const a={priority:n,callback:r};for(o=0;s=i[o];o++)if(s.priority<n){i.splice(o,0,a);return}i.push(a)}offGetComponent(e,n){const r=this._getListeners(e);let i,s,o;if(n)for(o=r.length-1;i=r[o];o--)s=i.callback,s===n&&r.splice(o,1);else r.length=0}_getListeners(e){let n=this._listeners[e];return n||(this._listeners[e]=n=[]),n}};class S0e extends Ve{constructor(e){super(e);const n=this._injector=e.injector;this._sheet=n.get("sheet"),this._changeSupport=n.get("changeSupport"),this._components=n.get("components"),this._eventBus=n.get("eventBus");const r=n.get("throttle");this.onElementsChanged=this.onElementsChanged.bind(this),this.onScroll=r(this.onScroll.bind(this))}onElementsChanged(){this.forceUpdate()}onScroll(){this._eventBus.fire("sheet.scroll")}getChildContext(){return{changeSupport:this._changeSupport,components:this._components,injector:this._injector}}componentWillMount(){const{id:e}=this._sheet.getRoot();this._changeSupport.onElementsChanged(e,this.onElementsChanged)}componentWillUnmount(){const{id:e}=this._sheet.getRoot();this._changeSupport.offElementsChanged(e,this.onElementsChanged)}render(){const{rows:e,cols:n}=this._sheet.getRoot(),r=this._components.getComponents("table.before"),i=this._components.getComponents("table.after"),s=this._components.getComponent("table.head"),o=this._components.getComponent("table.body"),a=this._components.getComponent("table.foot");return D(1,"div","tjs-container",[r&&r.map((l,c)=>Pe(2,l,null,c)),D(1,"div","tjs-table-container",D(1,"table","tjs-table",[s&&Pe(2,s,{rows:e,cols:n}),o&&Pe(2,o,{rows:e,cols:n}),a&&Pe(2,a,{rows:e,cols:n})],0),2,{onScroll:this.onScroll}),i&&i.map((l,c)=>Pe(2,l,null,c))],0)}}let RV=class{constructor(e,n,r,i,s){const{container:o}=r;this._container=o,i.on("root.added",()=>{P0(Pe(2,S0e,{injector:s}),o)}),i.on("root.remove",()=>{P0(null,o)})}getContainer(){return this._container}};RV.$inject=["changeSupport","components","config.renderer","eventBus","injector"];const AV={__init__:["changeSupport","components","renderer"],changeSupport:["type",OV],components:["type",E0e],renderer:["type",RV]};class IV{constructor(e,n){this._elementRegistry=e,this._eventBus=n,this._root=null,n.on("table.clear",()=>{this.setRoot(null)})}setRoot(e){if(this._root){const n=this._root;this._eventBus.fire("root.remove",{root:n}),this._root=null,this._eventBus.fire("root.removed",{root:n})}e&&this._eventBus.fire("root.add",{root:e}),this._root=e,e&&this._eventBus.fire("root.added",{root:e})}getRoot(){return this._root||this.setRoot({id:"__implicitroot",rows:[],cols:[]}),this._root}addRow(e,n){const r=this.getRoot();if(r.cols.length!=e.cells.length)throw new Error("number of cells is not equal to number of cols");return typeof n>"u"&&(n=r.rows.length),Tx(n,r.rows,e),e.root=r,this._elementRegistry.add(e),e.cells.forEach((i,s)=>{this._elementRegistry.add(i),i.row=e,i.col=r.cols[s],Tx(n,r.cols[s].cells,i)}),this._eventBus.fire("row.add",{row:e}),e}removeRow(e){const n=this.getRoot();typeof e=="string"&&(e=this._elementRegistry.get(e));const r=n.rows.indexOf(e);r!==-1&&(Nx(r,n.rows),e.root=void 0,this._elementRegistry.remove(e),e.cells.forEach((i,s)=>{this._elementRegistry.remove(i),i.col=void 0,Nx(r,n.cols[s].cells)}),this._eventBus.fire("row.remove",{row:e}))}addCol(e,n){const r=this.getRoot();if(this._elementRegistry.add(e),r.rows.length!=e.cells.length)throw new Error("number of cells is not equal to number of rows");return typeof n>"u"&&(n=r.cols.length),Tx(n,r.cols,e),e.root=r,e.cells.forEach((i,s)=>{this._elementRegistry.add(i),i.col=e,i.row=r.rows[s],Tx(n,r.rows[s].cells,i)}),this._eventBus.fire("col.add",{col:e}),e}removeCol(e){const n=this.getRoot();typeof e=="string"&&(e=this._elementRegistry.get(e));const r=n.cols.indexOf(e);r!==-1&&(Nx(r,n.cols),e.root=void 0,this._elementRegistry.remove(e),e.cells.forEach((i,s)=>{this._elementRegistry.remove(i),i.row=void 0,Nx(r,n.rows[s].cells)}),this._eventBus.fire("col.remove",{col:e}))}resized(){this._eventBus.fire("sheet.resized")}}IV.$inject=["elementRegistry","eventBus"];function Tx(t,e,n){return e.splice(t,0,n)}function Nx(t,e){return e.splice(t,1)}function DV(t=!0){const e=typeof t=="number"?t:t?300:0;return e?n=>OX(n,e):n=>n}DV.$inject=["config.throttle"];const C0e={__depends__:[AV],__init__:["elementFactory","sheet"],elementFactory:["type",TV],elementRegistry:["type",NV],eventBus:["type",RX],sheet:["type",IV],throttle:["factory",DV]};class j0e{constructor(e={}){let{injector:n}=e;if(!n){let{modules:r,config:i}=this._init(e);n=k0e(i,r)}this.get=n.get,this.invoke=n.invoke,this.get("eventBus").fire("table.init"),this.get("eventBus").fire("diagram.init")}_init(e){let{modules:n,...r}=e;return{modules:n,config:r}}destroy(){const e=this.get("eventBus");e.fire("table.destroy"),e.fire("diagram.destroy")}clear(){const e=this.get("eventBus");e.fire("table.clear"),e.fire("diagram.clear")}}function k0e(t,e){const n=[{config:["value",t]},C0e].concat(e||[]),r=new Rk(n);return r.init(),r}function BE(t){if(!t)return"<null>";var e=t.id?' id="'.concat(t.id,'"'):"";return"<".concat(t.$type).concat(e," />")}function P0e(t,e){function n(l,c,d){var h=l.gfx;if(h)throw new Error("already rendered ".concat(BE(l)));return t.element(l,c,d)}function r(l){return t.table(l)}function i(l){l.id||(l.id="decision");var c=l.decisionLogic;if(c){if(!c.output)throw new Error("missing output for ".concat(BE(c)));var d=r(c);c.input&&s(c.input,d,c),s(c.output,d,c),o(c.rule,d,c)}else throw new Error("no table for ".concat(BE(l)))}function s(l,c,d){$(l,function(h){n(h,c,d)})}function o(l,c,d){$(l,function(h){n(h,c,d),a(h.inputEntry,h),a(h.outputEntry,h)})}function a(l,c,d){$(l,function(h){n(h,c,d)})}return{handleDecision:i}}function T0e(t,e,n){var r=t.get("tableImporter"),i=t.get("eventBus"),s=t.get("sheet");t.get("modeling",!1);var o,a=[];function l(c){var d={create(p,f,m,g){return r.create(p,f,m,g)},table(p){return r.add(p)},element(p,f,m){return r.add(p,f,m)},error(p,f){a.push({message:p,context:f})}},h=new P0e(d);h.handleDecision(c)}i.fire("import.render.start",{decision:e});try{l(e)}catch(c){o=c}i.fire("import.render.complete",{error:o,warnings:a}),i.fire("elements.changed",{elements:[s.getRoot()]}),n(o,a)}function N0e(t,e){return e=e||{},t.replace(/{([^}]+)}/g,function(n,r){return e[r]||"{"+r+"}"})}const $V={translate:["value",N0e]};function O0e(){return{elements:[],index:{}}}function Q$(t,e){const{elements:n,index:r}=t;return r[e]?t:{elements:[...n,e],index:{...r,[e]:!0}}}function R0e(t,e){return t.elements.join(e)}function JT(...t){let e=O0e();return t.forEach(function(n){const r=typeof n;r==="string"&&n.length>0?e=Q$(e,n):r==="object"&&n!==null&&Object.keys(n).forEach(function(i){n[i]&&(e=Q$(e,i))})}),R0e(e," ")}function hi(t){const e=t.constructor;return MV(e,t)}function MV(t,e){const n=t.$inject;if(!n)return;const{injector:r}=e.context,i=[...n,function(...s){for(const o in s){const a=n[o],l=s[o];e[a]=l}}];r.invoke(i)}function A0e(t,...e){return(function(...n){let r;return e.forEach(function(i){if(r=i.call(t,...n),typeof r<"u")return!1}),r}).bind(t)}function ch(t,e){Object.keys(e).forEach(function(n){if(n==="$inject"||n==="__init")return;const r=e[n];n==="constructor"&&r.call(t,t.props,t.context);const i=t[n];if(typeof i<"u"){if(typeof i!="function")throw new Error(`failed to mixin <${n}>: cannot combine with non-fn component value`);t[n]=A0e(t,i,r)}else t[n]=r.bind(t)}),"$inject"in e&&MV(e,t),"__init"in e&&e.__init.call(t,t.props,t.context)}const eN={getSelectionClasses(){const{selected:t,selectedSecondary:e,focussed:n}=this.state;return JT({selected:t,"selected-secondary":e,focussed:n})},selectionChanged(t){this.setState(t)},componentWillUpdate(t){t.elementId!==this.props.elementId&&this.updateSelectionSubscription(!1)},componentDidUpdate(t){t.elementId!==this.props.elementId&&this.updateSelectionSubscription(!0)},componentDidMount(){this.updateSelectionSubscription(!0)},componentWillUnmount(){this.updateSelectionSubscription(!1)},updateSelectionSubscription(t){const{elementId:e}=this.props;e&&e&&this.eventBus[t?"on":"off"](`selection.${e}.changed`,this.selectionChanged)}};eN.$inject=["eventBus"];class I0e extends Ve{constructor(e,n){super(e,n),ch(this,eN),hi(this)}getRenderProps(...e){const{className:n,elementId:r,coords:i,...s}=this.props,o={className:JT(...e,this.getSelectionClasses(),n)};return r&&(o["data-element-id"]=r),i&&(o["data-coords"]=i),{...o,...s}}}class Kg extends I0e{constructor(e,n){super(e,n),this.state={}}render(){const{children:e}=this.props,n=this.getRenderProps("cell");return qg(D(1,"td",null,e,0,{...n}))}}var D0e=["type","context"],$0e=["type","context"];function Z$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Ox(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Z$(Object(n),!0).forEach(function(r){M0e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Z$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function M0e(t,e,n){return e=L0e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function L0e(t){var e=B0e(t,"string");return typeof e=="symbol"?e:String(e)}function B0e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function J$(t,e){if(t==null)return{};var n=F0e(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function F0e(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}var Wf={slotFill(t,e){var n=t.type,r=t.context,i=J$(t,D0e),s=this.components.getComponent(n,r)||e;return s?qg(Pe(2,s,Ox(Ox({},r),i))):null},slotFills(t){var e=t.type,n=t.context,r=J$(t,$0e),i=this.components.getComponents(e,n);return i.map(s=>qg(Pe(2,s,Ox(Ox({},n),r))))}};Wf.$inject=["components"];function z0e(t,e,n){return e=H0e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function H0e(t){var e=U0e(t,"string");return typeof e=="symbol"?e:String(e)}function U0e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var eM=400;class tN extends Ve{constructor(e,n){super(e,n),z0e(this,"onElementsChanged",()=>{this.forceUpdate()}),ch(this,Wf),hi(this)}componentDidMount(){this.changeSupport.onElementsChanged(this.getRoot(),this.onElementsChanged)}componentWillUnmount(){this.changeSupport.offElementsChanged(this.getRoot(),this.onElementsChanged)}getRoot(){return this.sheet.getRoot()}render(){var e=this.getRoot(),n=e.businessObject.get("annotationsWidth"),r=(n||eM)+"px";return D(1,"th","annotation header",[this.slotFills({type:"cell-inner",context:{cellType:"annotations",col:this.sheet.getRoot(),minWidth:eM}}),this.translate("Annotations")],0,{style:{width:r}})}}tN.$inject=["changeSupport","sheet","translate"];function V0e(t){var e=t.row,n=e.businessObject,r=n.id,i=n.description;return Pe(2,Kg,{className:"annotation",elementId:r,children:i||"-"})}function LV(t){t.onGetComponent("cell",e=>{var n=e.cellType;if(n==="after-label-cells")return tN;if(n==="after-rule-cells")return V0e})}LV.$inject=["components"];const q0e={__init__:["annotationsProvider"],annotationsProvider:["type",LV]};function Am(t,e){return B({id:t.id,type:t.$type,businessObject:t},e)}class BV{constructor(e,n,r){this._elementFactory=e,this._eventBus=n,this._sheet=r}add(e){var n;if(Y(e,"dmn:DecisionTable"))n=this._elementFactory.createRoot(Am(e)),this._sheet.setRoot(n);else if(Y(e,"dmn:InputClause"))n=this._elementFactory.createCol(Am(e)),this._sheet.addCol(n);else if(Y(e,"dmn:OutputClause"))n=this._elementFactory.createCol(Am(e)),this._sheet.addCol(n);else if(Y(e,"dmn:DecisionRule")){e.inputEntry||(e.inputEntry=[]),e.outputEntry||(e.outputEntry=[]);var r=[...e.inputEntry,...e.outputEntry].map(i=>this._elementFactory.createCell(Am(i)));n=this._elementFactory.createRow(B(Am(e),{cells:r})),this._sheet.addRow(n)}return this._eventBus.fire("dmnElement.added",{element:n}),n}}BV.$inject=["elementFactory","eventBus","sheet"];const W0e={__depends__:[$V],tableImporter:["type",BV]},G0e={__depends__:[W0e,AV]};function K0e(t,e,n){return e=Y0e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Y0e(t){var e=X0e(t,"string");return typeof e=="symbol"?e:String(e)}function X0e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class Q0e extends Ve{constructor(e,n){super(e,n),K0e(this,"onElementsChanged",()=>{this.forceUpdate()}),ch(this,Wf),this._sheet=n.injector.get("sheet"),this._changeSupport=n.changeSupport}componentWillMount(){var e=this._sheet.getRoot();this._changeSupport.onElementsChanged(e.id,this.onElementsChanged)}componentWillUnmount(){var e=this._sheet.getRoot();this._changeSupport.offElementsChanged(e.id,this.onElementsChanged)}render(){var e=this._sheet.getRoot();if(!Y(e,"dmn:DMNElement"))return null;var n=jl(e),r=n.input,i=n.output;return D(1,"thead",null,D(1,"tr",null,[D(1,"th","index-column"),this.slotFills({type:"cell",context:{cellType:"before-label-cells"}}),r&&r.map((s,o)=>{var a=s.width||"192px";return this.slotFill({type:"cell",context:{cellType:"input-header",input:s,index:o,inputsLength:r.length,width:a},key:s.id},Z0e)}),i.map((s,o)=>this.slotFill({type:"cell",context:{cellType:"output-header",output:s,index:o,outputsLength:i.length},key:s.id},J0e)),this.slotFills({type:"cell",context:{cellType:"after-label-cells"}})],0),2)}}function Z0e(t,e){var n=t.input,r=t.className,i=t.index,s=n.label,o=n.inputExpression,a=n.inputValues,l=e.injector.get("translate"),c=(r||"")+" input-cell";return D(1,"th",c,[D(1,"div","clause",l(i===0?"When":"And"),0),s?D(1,"div","input-label",s,0,{title:l("Input label: ")+s}):D(1,"div","input-expression",o.text,0,{title:l("Input expression: ")+o.text}),D(1,"div","input-variable",a&&a.text||o.typeRef,0,{title:a&&a.text?l("Input values"):l("Input type")})],0,{"data-col-id":n.id},n.id)}function J0e(t,e){var n=t.output,r=t.className,i=t.index,s=n.label,o=n.name,a=n.outputValues,l=n.typeRef,c=e.injector.get("translate"),d=(r||"")+" output-cell";return D(1,"th",d,[D(1,"div","clause",c(i===0?"Then":"And"),0),s?D(1,"div","output-label",s,0,{title:c("Output label")}):D(1,"div","output-name",o,0,{title:c("Output name")}),D(1,"div","output-variable",a&&a.text||l,0,{title:a&&a.text?c("Output values"):c("Output type")})],0,null,n.id)}function FV(t){t.onGetComponent("table.head",()=>Q0e)}FV.$inject=["components"];const ewe={__init__:["decisionTableHeadProvider"],decisionTableHeadProvider:["type",FV]};let zV=class extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),hi(this)}render(){var e=this.sheet.getRoot();if(!Y(e,"dmn:DMNElement"))return null;var n=e.businessObject.$parent.name,r=this.components.getComponent("hit-policy")||twe;return D(1,"div","decision-table-properties",[D(1,"div","decision-table-name",n,0,{title:this._translate("Decision name: ")+n}),D(1,"div","decision-table-header-separator"),Pe(2,r)],4)}};zV.$inject=["sheet","components"];function twe(){return null}var nwe=500;let HV=class{constructor(e){e.onGetComponent("table.before",nwe,()=>zV)}};HV.$inject=["components"];const rwe={__init__:["decisionTableProperties"],decisionTableProperties:["type",HV]};class iwe extends Ve{render(){var e=this.props,n=e.row,r=e.rowIndex,i=this.context.components,s=i.getComponents("cell-inner",{cellType:"rule-index",row:n,rowIndex:r});return D(1,"td","rule-index",[s&&s.map(o=>Pe(2,o,{row:n,rowIndex:r})),r+1],0,{"data-element-id":n.id,"data-row-id":n.id})}}class UV{constructor(e){e.onGetComponent("cell",n=>{var r=n.cellType;if(r==="before-rule-cells")return iwe})}}UV.$inject=["components"];const swe={__init__:["decisionRuleIndices"],decisionRuleIndices:["type",UV]};var owe=[{label:"FEEL",value:"feel"}];class VV{constructor(e){this._injector=e;var n=e.get("config.expressionLanguages")||{};this._config={options:owe,defaults:{editor:"feel"}},n.options&&(this._config.options=n.options);var r=this._getLegacyDefaults();B(this._config.defaults,r,n.defaults)}getDefault(e){var n=this._config.defaults,r=n[e]||n.editor;return this._getLanguageByValue(r)||this.getAll()[0]}getLabel(e){var n=this._getLanguageByValue(e);return n?n.label:e}getAll(){return this._config.options}_getLegacyDefaults(){var e={},n=this._injector,r=n.get("config.defaultInputExpressionLanguage"),i=n.get("config.defaultOutputExpressionLanguage");return r&&(e.inputCell=r),i&&(e.outputCell=i),e}_getLanguageByValue(e){return Tt(this.getAll(),n=>e===n.value)}}VV.$inject=["injector"];const uh={__init__:["expressionLanguages"],expressionLanguages:["type",VV]};class awe extends Ve{render(e){var n=e.rows,r=e.cols,i=this.context.components;return D(1,"tbody",null,n.map((s,o)=>{var a=i.getComponent("row",{rowType:"rule"});return a&&Pe(2,a,{row:s,rowIndex:o,cols:r},s.id)}),0)}}class lwe extends Ve{constructor(e,n){super(e,n),ch(this,Wf)}render(){var e=this.props,n=e.row,r=e.rowIndex,i=e.cols,s=n.cells;return D(1,"tr",null,[this.slotFills({type:"cell",context:{cellType:"before-rule-cells",row:n,rowIndex:r}}),s.map((o,a)=>this.slotFill({type:"cell",context:{cellType:"rule",cell:o,rowIndex:r,colIndex:a},key:o.id,row:n,col:i[a]})),this.slotFills({type:"cell",context:{cellType:"after-rule-cells",row:n,rowIndex:r}})],0)}}class cwe extends Ve{render(){var e=this.props,n=e.cell,r=e.row,i=e.col;return Y(n,"dmn:UnaryTests")?Pe(2,Kg,{className:"input-cell",elementId:n.id,"data-row-id":r.id,"data-col-id":i.id,children:n.businessObject.text}):Pe(2,Kg,{className:"output-cell",elementId:n.id,"data-row-id":r.id,"data-col-id":i.id,children:n.businessObject.text})}}let qV=class{constructor(e){e.onGetComponent("table.body",()=>awe),e.onGetComponent("row",n=>{var r=n.rowType;if(r==="rule")return lwe}),e.onGetComponent("cell",n=>{var r=n.cellType;if(r==="rule")return cwe})}};qV.$inject=["components"];const WV={__depends__:[uh],__init__:["decisionRules"],decisionRules:["type",qV]};var nj=[{label:"Unique",value:{hitPolicy:"UNIQUE",aggregation:void 0},explanation:"No overlap is possible and all rules are disjoint. Only a single rule can be matched"},{label:"First",value:{hitPolicy:"FIRST",aggregation:void 0},explanation:"Rules may overlap. The first matching rule will be chosen"},{label:"Priority",value:{hitPolicy:"PRIORITY",aggregation:void 0},explanation:"Rules may overlap. The one with the highest priority will be chosen"},{label:"Any",value:{hitPolicy:"ANY",aggregation:void 0},explanation:"Rules may overlap. Their output have to match"},{label:"Collect",value:{hitPolicy:"COLLECT",aggregation:void 0},explanation:"Collects the values of all matching rules"},{label:"Collect (Sum)",value:{hitPolicy:"COLLECT",aggregation:"SUM"},explanation:"Collects the values of all matching rules and sums up to a single value"},{label:"Collect (Min)",value:{hitPolicy:"COLLECT",aggregation:"MIN"},explanation:"Collects the values of all matching rules and uses the lowest value"},{label:"Collect (Max)",value:{hitPolicy:"COLLECT",aggregation:"MAX"},explanation:"Collects the values of all matching rules and uses the highest value"},{label:"Collect (Count)",value:{hitPolicy:"COLLECT",aggregation:"COUNT"},explanation:"Collects the values of all matching rules and counts the number of them"},{label:"Rule order",value:{hitPolicy:"RULE ORDER",aggregation:void 0},explanation:"Collects the values of all matching rules in rule order"},{label:"Output order",value:{hitPolicy:"OUTPUT ORDER",aggregation:void 0},explanation:"Collects the values of all matching rules in decreasing output priority order"}];class GV extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),hi(this)}getRoot(){return this.sheet.getRoot()}render(){var e=this.getRoot(),n=e.businessObject,r=n.aggregation,i=n.hitPolicy,s=Tt(nj,o=>uwe(o.value,{aggregation:r,hitPolicy:i}));return D(1,"div","hit-policy header",[D(1,"label","dms-label",this._translate("Hit policy:"),0),D(1,"span","hit-policy-value",this._translate(s.label),0)],4,{title:this._translate(s.explanation)})}}GV.$inject=["sheet"];function uwe(t,e){return t.hitPolicy===e.hitPolicy&&t.aggregation===e.aggregation}function KV(t){t.onGetComponent("hit-policy",()=>GV)}KV.$inject=["components"];const dwe={__init__:["hitPolicyProvider"],hitPolicyProvider:["type",KV]};function hwe(t,e,n){return e=pwe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pwe(t){var e=fwe(t,"string");return typeof e=="symbol"?e:String(e)}function fwe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}let mwe=class extends Ve{constructor(e,n){super(e,n),hwe(this,"onClick",()=>{this._eventBus.fire("showDrd")});var r=n.injector;this._translate=r.get("translate"),this._eventBus=r.get("eventBus")}render(){return D(1,"div","view-drd",D(1,"button","view-drd-button",this._translate("View DRD"),0,{type:"button",onClick:this.onClick}),2,null,null,e=>this.node=e)}},YV=class{constructor(e,n,r,i){this._injector=r,this._sheet=i,e.onGetComponent("table.before",()=>{if(this.canViewDrd())return mwe}),n.on("showDrd",()=>{var s=r.get("_parent",!1),o=i.getRoot(),a=tM(o);if(a){var l=s.getView(a);s.open(l)}})}canViewDrd(){var e=this._injector.get("_parent",!1);if(!e)return!1;var n=this._sheet.getRoot(),r=tM(n);return!!e.getView(r)}};YV.$inject=["components","eventBus","injector","sheet"];function tM(t){var e=t.businessObject;if(e){var n=e.$parent,r=n.$parent;return r}}const gwe={__init__:["viewDrd"],viewDrd:["type",YV]};let XV=class{constructor(e){e.onGetComponent("table.before",()=>KH)}};XV.$inject=["components"];const vwe={__init__:["poweredBy"],poweredBy:["type",XV]};var ywe=["modules","additionalModules"];function xwe(t,e){if(t==null)return{};var n=bwe(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function bwe(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}let nM=class rj extends j0e{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=rj._createContainer();super(B(e,{renderer:{container:n}})),this._container=n}open(e){var n=this;return new Promise((r,i)=>{var s;try{return n._decision&&n.clear(),n._decision=e,T0e(n,e,function(o,a){o?(o.warnings=a||[],i(o)):r({warnings:a||[]})})}catch(o){s=o}s?(s.warnings=s.warnings||[],i(s)):r({warnings:[]})})}_init(e){var n=e.modules,r=e.additionalModules,i=xwe(e,ywe),s=n||this.getModules(),o=r||[],a=[{decisionTable:["value",this]}],l=[vwe,...s,...o,...a];return{modules:l,config:i}}on(e,n,r,i){return this.get("eventBus").on(e,n,r,i)}off(e,n){this.get("eventBus").off(e,n)}_emit(e,n){return this.get("eventBus").fire(e,n)}attachTo(e){if(!e)throw new Error("parentNode required");this.detach();var n=this._container;e.appendChild(n),this._emit("attach",{})}detach(){var e=this._container,n=e.parentNode;n&&(this._emit("detach",{}),Nr(e))}destroy(){super.destroy(),this.detach()}getModules(){return rj._getModules()}static _getModules(){return[q0e,G0e,$V,ewe,rwe,swe,WV,dwe,gwe]}static _createContainer(){return bt('<div class="dmn-decision-table-container"></div>')}};function wwe(t,e,n){return e=_we(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _we(t){var e=Ewe(t,"string");return typeof e=="symbol"?e:String(e)}function Ewe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class QV extends Ve{constructor(e,n){super(e,n),wwe(this,"handleClick",r=>{r.stopPropagation(),this.addRule(r.target.dataset.colIndex)}),hi(this),this.addRule=this.addRule.bind(this)}componentWillMount(){this._eventBus=this.context.injector.get("eventBus")}addRule(e){this._eventBus.fire("addRule",{colIndex:e})}render(){var e=this.props.cols,n=[D(1,"td","add-rule-add",D(1,"span","dmn-icon-plus action-icon",null,1,{title:this.translate("Add rule")}),2)],r=this.sheet.getRoot(),i=r.businessObject;(!i.input||!i.input.length)&&n.push(D(1,"td","input-cell",Vn("-"),2));for(var s=0;s<e.length+1;s++){var o="add-rule",a=e[s]&&e[s].businessObject,l="";a?(a.$instanceOf("dmn:InputClause")&&(o+=" input-cell",l="-"),a.$instanceOf("dmn:OutputClause")&&(o+=" output-cell")):o+=" annotation",n.push(D(1,"td",o,l,0,{"data-col-index":s}))}return D(1,"tfoot","actionable add-rule",D(1,"tr",null,n,0),2,{onClick:this.handleClick})}}QV.$inject=["sheet","translate"];class ZV{constructor(e,n,r,i){e.onGetComponent("table.foot",()=>QV),r.on("addRule",(s,o)=>{var a=n.trigger("addRule"),l=o.colIndex;a.cells[l]?i.select(a.cells[l]):i.select(a.cells[0])})}}ZV.$inject=["components","editorActions","eventBus","selection"];class JV{constructor(e,n,r){this._elementRegistry=e,this._eventBus=n,this._renderer=r,this._selection=void 0,n.on("diagram.clear",()=>{this._selection=void 0})}select(e){Fi(e)&&(e=this._elementRegistry.get(e));const n=this._selection;n!==e&&(this._selection=e,this._eventBus.fire("selection.changed",{oldSelection:n,selection:e}))}deselect(){const e=this._selection;this._selection=void 0,this._eventBus.fire("selection.changed",{oldSelection:e,selection:this._selection})}get(){return this._selection}hasSelection(){return!!this._selection}}JV.$inject=["elementRegistry","eventBus","renderer"];class eq{constructor(e,n,r,i){this._elementRegistry=e,this._renderer=r,this._selection=i,n.on(["cell.click","cell.contextmenu"],({id:s})=>{const o=e.get(s);o&&i.select(o)}),n.on("row.remove",({row:s})=>{const o=i.get();o&&s===o.row&&i.deselect()}),n.on("col.remove",({col:s})=>{const o=i.get();o&&s===o.col&&i.deselect()})}}eq.$inject=["elementRegistry","eventBus","renderer","selection"];const t1={__init__:["selection","selectionBehavior"],selection:["type",JV],selectionBehavior:["type",eq]};function Swe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const rM=["click","dblclick","contextmenu","mousedown","mouseup","mouseenter","mouseleave","mouseout","mouseover","mousemove","focusin","focusout","drag","dragstart","dragend","dragover","dragenter","dragleave","drop"];class tq{constructor(e,n){Swe(this,"_handleEvent",r=>{const{target:i,type:s}=r,o=Cwe(i);if(!o)return;const a=o.getAttribute("data-element-id");if(a){const l=this._eventBus.createEvent({id:a,event:r,node:o,target:o});this._eventBus.fire(`cell.${s}`,l),l.defaultPrevented&&r.preventDefault(),l.cancelBubble&&r.stopPropagation()}}),this._eventBus=n,this._container=e.container,n.on("table.init",()=>{this._addEventListeners(rM)}),n.on("table.destroy",()=>{this._removeEventListeners(rM)})}_addEventListeners(e){const n=this._container;e.forEach(r=>{n.addEventListener(r,this._handleEvent)})}_removeEventListeners(e){const n=this._container;e.forEach(r=>{n.removeEventListener(r,this._handleEvent)})}}tq.$inject=["config.renderer","eventBus"];function Cwe(t){return ur(t,"[data-element-id]",!0)}const nN={__init__:["interactionEvents"],interactionEvents:["type",tq]};var nq={exports:{}};/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */(function(t,e){(function(n,r){t.exports=r(n)})(typeof M1<"u"?M1:M1,function(n){if(n.CSS&&n.CSS.escape)return n.CSS.escape;var r=function(i){if(arguments.length==0)throw new TypeError("`CSS.escape` requires an argument.");for(var s=String(i),o=s.length,a=-1,l,c="",d=s.charCodeAt(0);++a<o;){if(l=s.charCodeAt(a),l==0){c+="";continue}if(l>=1&&l<=31||l==127||a==0&&l>=48&&l<=57||a==1&&l>=48&&l<=57&&d==45){c+="\\"+l.toString(16)+" ";continue}if(a==0&&o==1&&l==45){c+="\\"+s.charAt(a);continue}if(l>=128||l==45||l==95||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122){c+=s.charAt(a);continue}c+="\\"+s.charAt(a)}return c};return n.CSS||(n.CSS={}),n.CSS.escape=r,r})})(nq);var jwe=nq.exports;const rq=aw(jwe);var iM=kwe;function kwe(t,e){return t^e}var Pwe=/\b(Array|Date|Object|Math|JSON)\b/g,Twe=function(t,e){var n=Rwe(Nwe(t));return e&&typeof e=="string"&&(e=Awe(e)),e?Owe(t,n,e):n};function Nwe(t){return t.replace(/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\//g,"").replace(Pwe,"").match(/[a-zA-Z_]\w*/g)||[]}function Owe(t,e,n){var r=/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\/|[a-zA-Z_]\w*/g;return t.replace(r,function(i){return i[i.length-1]=="("||~e.indexOf(i)?n(i):i})}function Rwe(t){for(var e=[],n=0;n<t.length;n++)~e.indexOf(t[n])||e.push(t[n]);return e}function Awe(t){return function(e){return t+e}}var iq=br;function br(t,e){if(!(this instanceof br))return new br(t,e);if(this.node=this.start=this.peeked=t,this.root=e,this.closingTag=!1,this._revisit=!0,this._selects=[],this._rejects=[],t&&this.higher(t))throw new Error("root must be a parent or ancestor to node")}br.prototype.reset=function(t){return this.node=t||this.start,this};br.prototype.revisit=function(t){return this._revisit=t??!0,this};br.prototype.opening=function(){return this.node.nodeType==1&&(this.closingTag=!1),this};br.prototype.atOpening=function(){return!this.closingTag};br.prototype.closing=function(){return this.node.nodeType==1&&(this.closingTag=!0),this};br.prototype.atClosing=function(){return this.closingTag};br.prototype.next=sq("nextSibling","firstChild");br.prototype.previous=br.prototype.prev=sq("previousSibling","lastChild");function sq(t,e){var n=t=="nextSibling";return function(i,s,o){i=this.compile(i),s=s&&s>0?s:1;for(var a=this.node,l=this.closingTag,c=this._revisit;a;){if(iM(n,l)&&a[e])a=a[e],l=!n;else if(a.nodeType==1&&!a[e]&&iM(n,l)){if(l=n,!c)continue}else if(a[t])a=a[t],l=!n;else if(a=a.parentNode,l=n,!c)continue;if(!a||this.higher(a,this.root))break;if(i(a)&&this.selects(a,o)&&this.rejects(a,o)){if(--s)continue;return o||(this.node=a),this.closingTag=l,a}}return null}}br.prototype.select=function(t){return t=this.compile(t),this._selects.push(t),this};br.prototype.selects=function(t,e){var n=this._selects,r=n.length;if(!r)return!0;for(var i=0;i<r;i++)if(n[i].call(this,t,e))return!0;return!1};br.prototype.reject=function(t){return t=this.compile(t),this._rejects.push(t),this};br.prototype.rejects=function(t,e){var n=this._rejects,r=n.length;if(!r)return!0;for(var i=0;i<r;i++)if(n[i].call(this,t,e))return!1;return!0};br.prototype.higher=function(t){var e=this.root;if(!e)return!1;for(t=t.parentNode;t&&t!=e;)t=t.parentNode;return t!=e};br.prototype.compile=function(t){switch(typeof t){case"number":return function(e){return t==e.nodeType};case"string":return new Function("node","return "+Twe(t,"node."));case"function":return t;default:return function(){return!0}}};br.prototype.peak=br.prototype.peek=function(t,e){return arguments.length==1&&(e=t,t=!0),e=e??1,e?e>0?this.next(t,e,!0):this.prev(t,Math.abs(e),!0):this.node};br.prototype.use=function(t){return t(this),this};var Jp=window.getSelection();function oq(t){Jp.removeAllRanges(),Jp.addRange(t)}function Iwe(){return Jp}function Dwe(t){if(!Jp.rangeCount)return null;var e=Jp.focusNode;return D0(e)&&(e=e.parentNode),t==e||t.contains(e)}function $we(t,e){var n=Mwe(t,e);oq(n)}function rN(t){if(!Dwe(t))return null;var e=Jp.getRangeAt(0),n=e.startContainer,r=e.endContainer,i=e.startOffset,s=e.endOffset,o=iq(t.firstChild,t),a=o.node,l,c=!1,d,h=0;function p(m,g){return arguments.length===1&&(g=m),m.parentNode===r&&g==r.childNodes[s]}function f(m,g){return arguments.length===1&&(g=m),m.parentNode===n&&g==n.childNodes[i]}for(;a&&(f(a)&&(d=h),!p(a));){if(c||(aq(a)||l&&l.nextSibling==a&&(lq(a)||cq(a)))&&h++,D0(a)){if(n===a&&(d=h+i),r===a){h+=s;break}h+=a.textContent.length}if((D0(a)||c)&&(f(a,a.nextSibling)&&(d=h),p(a,a.nextSibling)))break;l=a,a=o.next(),c=o.closingTag}return{start:typeof d>"u"?h:d,end:h}}function Mwe(t,e){for(var n=e.start,r=e.end,i=document.createRange(),s=iq(t.firstChild,t),o=s.node,a=!1,l=0,c;o;){if(l===n&&(a?i.setStartAfter(o):i.setStartBefore(o)),l===r)return a?i.setEndAfter(o):i.setEndBefore(o),i;if(a||(aq(o)||o.previousSibling&&(lq(o)||cq(o)))&&l++,D0(o)){if(c=o.textContent.length,l<=n&&l+c>n&&i.setStart(o,n-l),l+c>r)return i.setEnd(o,r-l),i;l+=c}o=s.next(),a=s.closingTag}return l<=n&&(t.lastChild?i.setStartAfter(t.lastChild):i.setStart(t,0)),t.lastChild?i.setEndAfter(t.lastChild):i.setEnd(t,0),i}function D0(t){return t.nodeType===3}function aq(t){return t.nodeType===1&&t.nodeName==="BR"}function lq(t){return t.nodeType===1&&t.nodeName==="DIV"}function cq(t){return t.nodeType===1&&t.nodeName==="P"}function Lwe(t,e){return Hwe(t)||zwe(t,e)||Fwe(t,e)||Bwe()}function Bwe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Fwe(t,e){if(t){if(typeof t=="string")return sM(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sM(t,e)}}function sM(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function zwe(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,i,s,o,a=[],l=!0,c=!1;try{if(s=(n=n.call(t)).next,e!==0)for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(d){c=!0,i=d}finally{try{if(!l&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return a}}function Hwe(t){if(Array.isArray(t))return t}var Uwe="[contenteditable]",Vwe="[data-element-id]";function Rx(t){return t.getAttribute("data-element-id")}function qwe(t){var e=t.getAttribute("data-coords");if(!e)return null;var n=e.split(":"),r=Lwe(n,2),i=r[0],s=r[1];return{row:i,col:s}}function Wwe(t,e){var n="".concat(t.row,":").concat(t.col);return at('[data-coords="'.concat(rq(n),'"]'),e)}function ef(t,e){return at('[data-element-id="'.concat(rq(t),'"]'),e)}function Gwe(t){return ur(t,".no-deselect",!0)}function ij(t){return ur(t,Vwe,!0)}function uq(t){var e=Uwe;return zd(t,e)?t:at(e,t)}function Kwe(t){var e=uq(t);if(e&&document.body.contains(e)&&document.activeElement!==e){e.focus();var n=rN(e);(!n||n.end===0)&&window.getSelection().setPosition(e.firstChild,e.firstChild.length)}}var FE=500,Ywe={above:!0,below:!0,right:!0,left:!0};function dq(t,e,n,r,i){var s=t.container,o=null;function a(p,f){e.fire("selection."+p+".changed",f),e.fire("cellSelection.changed",{elementId:p,selection:f})}function l(p){var f=p.target;if(!Gwe(f)){var m=ij(f),g=m&&Rx(m),v=!p.defaultPrevented;h(g,v)}}function c(p){var f=Rx(p.target),m=!p.defaultPrevented;return p.stopPropagation(),h(f,m)}function d(p){var f=Rx(p.target);a(f,{focussed:!1})}function h(p){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;o!==p&&a(o,{selected:!1,focussed:!1}),o=p,p&&a(p,{selected:!0,focussed:f}),p?r.select(p):r.deselect()}e.on("cell.click",FE,l),e.on("cell.focusin",FE,c),e.on("cell.focusout",FE,d),e.on("cellSelection.changed",function(p){var f=p.elementId,m=p.selection,g=ef(f,s);m.focussed&&g&&Kwe(g)}),e.on("selection.changed",function(p){var f=p.selection,m=p.oldSelection,g=f&&f.id,v=m&&m.id;g&&g!==o?h(f.id):v&&v===o&&h()}),this.isCellSelected=function(){return!!o},this.getCellSelection=function(){return o},this.selectCell=function(p){if(o){if(!(p in Ywe))throw new Error("direction must be any of { above, below, left, right }");var f=ef(o,s),m=qwe(f);if(!m)return!1;var g=Xwe(m,p),v=Wwe(g,s);if(!v)return!1;var b=Rx(v);return b&&h(b,{focussed:!0,selected:!0}),!0}},e.on("contextMenu.close",function(){if(o)return h(o)})}dq.$inject=["config.renderer","eventBus","sheet","selection","elementRegistry"];function Xwe(t,e){var n=t.row,r=t.col;if(e==="above"||e==="below"){var i=parseInt(n,10);if(isNaN(i))return t;var s=e==="above"?i-1:i+1;return{col:r,row:s}}if(e==="left"||e==="right"){var o=parseInt(r,10);if(isNaN(o))return t;var a=e==="left"?o-1:o+1;return{row:n,col:a}}throw new Error("invalid direction <"+e+">")}const n1={__depends__:[nN,t1],__init__:["cellSelection"],cellSelection:["type",dq]};function my(){}my.prototype.get=function(){return this._data};my.prototype.set=function(t){this._data=t};my.prototype.clear=function(){var t=this._data;return delete this._data,t};my.prototype.isEmpty=function(){return!this._data};const hq={clipboard:["type",my]};var Qwe=1e3;function pi(t){this._eventBus=t}pi.$inject=["eventBus"];function Zwe(t,e){return function(n){return t.call(e||null,n.context,n.command,n)}}pi.prototype.on=function(t,e,n,r,i,s){if((Bt(e)||Oe(e))&&(s=i,i=r,r=n,n=e,e=null),Bt(n)&&(s=i,i=r,r=n,n=Qwe),Wn(i)&&(s=i,i=!1),!Bt(r))throw new Error("handlerFn must be a function");ke(t)||(t=[t]);var o=this._eventBus;$(t,function(a){var l=["commandStack",a,e].filter(function(c){return c}).join(".");o.on(l,n,i?Zwe(r,s):r,s)})};pi.prototype.canExecute=ql("canExecute");pi.prototype.preExecute=ql("preExecute");pi.prototype.preExecuted=ql("preExecuted");pi.prototype.execute=ql("execute");pi.prototype.executed=ql("executed");pi.prototype.postExecute=ql("postExecute");pi.prototype.postExecuted=ql("postExecuted");pi.prototype.revert=ql("revert");pi.prototype.reverted=ql("reverted");function ql(t){return function(n,r,i,s,o){(Bt(n)||Oe(n))&&(o=s,s=i,i=r,r=n,n=null),this.on(n,t,r,i,s,o)}}function gy(t){pi.call(this,t),this.init()}gy.$inject=["eventBus"];Ce(gy,pi);gy.prototype.addRule=function(t,e,n){var r=this;typeof t=="string"&&(t=[t]),t.forEach(function(i){r.canExecute(i,e,function(s,o,a){return n(s)},!0)})};gy.prototype.init=function(){};var zE=2e3;class pq extends gy{constructor(e,n){super(e),this._sheet=n}init(){this.addRule("col.move",zE,e=>{var n=e.col,r=e.index,i=this._sheet.getRoot(),s=i.businessObject,o=s.input;return cn(n)?r<o.length:r>=o.length}),this.addRule("col.remove",zE,e=>{var n=e.col,r=this._sheet.getRoot(),i=r.cols;return Xr(n)?i.filter(s=>Xr(s)).length>1:!0}),this.addRule("paste",zE,e=>{var n=e.data,r=e.target;if(!n||!r)return!1;var i=n.root;return r instanceof is?this.canPasteRows(i):r instanceof ss?this.canPasteCols(i,r):!1})}canPasteRows(e){var n=this._sheet.getRoot(),r=n.cols;return Zs(e,i=>i.type!=="row"||i.cells.length!==r.length?!1:Zs(i.cells,(s,o)=>cn(r[o])?s.businessObject.$type==="dmn:UnaryTests":s.businessObject.$type==="dmn:LiteralExpression"))}canPasteCols(e,n){var r=this._sheet.getRoot(),i=r.rows;return Zs(e,s=>s.type!=="col"||s.cells.length!==i.length?!1:cn(n)?s.businessObject.$type==="dmn:InputClause":s.businessObject.$type==="dmn:OutputClause")}}pq.$inject=["eventBus","sheet"];const Jwe={__depends__:[Vo]},iN={__depends__:[Jwe],__init__:["decisionTableModelingRules"],decisionTableModelingRules:["type",pq]};class fq{constructor(e,n,r){this._clipboard=e,this._modeling=n,this._sheet=r}execute(e){var n=e.data;return e.oldData=this._clipboard.get(),this._clipboard.set(n),this._sheet.getRoot()}postExecute(e){var n=e.elements;n.forEach(r=>{r instanceof is?this._modeling.removeRow(r):r instanceof ss&&this._modeling.removeCol(r)})}revert(e){var n=e.oldData;return this._clipboard.set(n),this._sheet.getRoot()}}fq.$inject=["clipboard","modeling","sheet"];function oM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Pn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?oM(Object(n),!0).forEach(function(r){e_e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):oM(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function e_e(t,e,n){return e=t_e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function t_e(t){var e=n_e(t,"string");return typeof e=="symbol"?e:String(e)}function n_e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var r_e=[a_e,l_e],i_e=[p_e,h_e];function sj(t,e,n){return n=n||r_e,e=e||{},ke(t)?s_e(t,e,n):mq(t,e,n)}function s_e(t,e,n){return xr(t,(r,i)=>{var s=r.descriptorCache,o=r.root,a=mq(i,s,n),l=a.root,c=a.descriptorCache;return{root:[...o,l],descriptorCache:Pn(Pn({},s),c)}},{root:[],descriptorCache:e})}function mq(t,e,n){var r=t.id,i={id:r},s=e.elements||{},o=s[r];if(o)return{root:o,descriptorCache:e};var a=o_e(t,i,n,Pn(Pn({},e),{},{elements:s}));return{root:a.root,descriptorCache:Pn(Pn({},a.descriptorCache),{},{elements:Pn(Pn({},a.descriptorCache.elements),{},{[r]:a.root})})}}function o_e(t,e,n,r){function i(s,o){return sj(s,o,n)}return xr(n,function(s,o){return o(t,s.root,s.descriptorCache,i)},{root:e,descriptorCache:r})}function a_e(t,e,n,r){var i=n,s=Pn(Pn({},e),{},{type:c_e(t)});if(t instanceof is||t instanceof ss){var o=r(t.cells,i);s.cells=o.root,i=o.descriptorCache}return{root:s,descriptorCache:i}}function l_e(t,e,n){var r=t.businessObject;if(!r)return{root:e,descriptorCache:n};var i=oj(r,n);return{root:Pn(Pn({},e),{},{businessObject:i.root}),descriptorCache:i.descriptorCache}}function c_e(t){if(t instanceof is)return"row";if(t instanceof ss)return"col";if(t instanceof e1)return"cell";throw new Error("cannot deduce element type: #"+t.id)}function oj(t,e){var n,r,i=t.id;if(i&&(n=e.boCache||{},r=n[i],r))return{root:r,descriptorCache:e};var s={$type:t.$type};return i&&(s.id=i,n=Pn(Pn({},n),{},{[i]:s}),e=Pn(Pn({},e),{},{boCache:n})),t.$descriptor.properties.forEach(function(o){var a=t[o.name];if(a){if(ke(a)&&(a=a.map(c=>{var d=oj(c,e);return e=d.descriptorCache,d.root})),a.$type){var l=oj(a,e);e=l.descriptorCache,a=l.root}s[o.name]=a}}),{root:s,descriptorCache:e}}function gq(t,e,n){return n=n||i_e,e=e||{},ke(t.root)?u_e(t,e,n):vq(t,e,n)}function u_e(t,e,n){var r=t.root,i=t.descriptorCache;return xr(r,(s,o)=>{var a=s.reviveCache,l=s.root,c=vq({root:o,descriptorCache:i},a,n),d=c.root,h=c.reviveCache;return{root:[...l,d],reviveCache:h}},{root:[],reviveCache:e})}function vq(t,e,n){var r=t.root,i=r.id,s=e.elements||{},o=s[i];if(o)return{root:o,reviveCache:e};var a={id:i},l=d_e(t,a,n,Pn(Pn({},e),{},{elements:s}));return{root:l.root,reviveCache:Pn(Pn({},l.reviveCache),{},{elements:Pn(Pn({},l.reviveCache.elements),{},{[i]:l.root})})}}function d_e(t,e,n,r){function i(s,o){return gq(s,o,n)}return xr(n,function(s,o){return o(t,s.root,s.reviveCache,i)},{root:e,reviveCache:r})}function h_e(t,e,n,r){var i=t.root,s=t.descriptorCache,o=Pn({},e);if(e.businessObject&&e.businessObject.id&&(o.id=e.businessObject.id),i.type==="row"||i.type==="col"){var a=r({root:i.cells,descriptorCache:s},n);o.cells=a.root,n=a.reviveCache}var l=f_e(i),c=new l(o);return c instanceof is?c.cells.forEach(d=>{d.row=c}):c instanceof ss&&c.cells.forEach(d=>{d.col=c}),{root:c,reviveCache:n}}function p_e(t,e,n){var r=t.root.businessObject;if(!r)return{root:e,reviveCache:n};var i=aj({root:r,descriptorCache:t.descriptorCache},n);return{root:Pn(Pn({},e),{},{businessObject:i.root}),reviveCache:i.reviveCache}}function f_e(t){switch(t.type){case"row":return is;case"cell":return e1;case"col":return ss;default:throw new Error("unknown element type: #"+t.type)}}function aj(t,e){var n=t.root,r=n.id,i,s;if(r&&(i=e.boCache||{},s=i[r],s))return{root:s,reviveCache:e};var o={};Nd(n).forEach(c=>{var d,h;n[c].$type?(h=aj({root:n[c]},e),d=h.root,e=h.reviveCache,i=e.boCache||{}):ke(n[c])?d=n[c].map(p=>(h=aj({root:p},e),e=h.reviveCache,i=e.boCache||{},h.root)):d=n[c],o[c]=d});var a=o.$type;delete o.$type,(!e._keepIds||e._model.ids.assigned(o.id))&&delete o.id;var l=e._dmnFactory.create(a,o);return $(o,c=>{c.$type&&(c.$parent=l),ke(c)&&c.forEach(d=>d.$parent=l)}),r&&(i=Pn(Pn({},i),{},{[r]:l}),e=Pn(Pn({},e),{},{boCache:i})),{root:l,reviveCache:e}}class yq{constructor(e,n,r,i,s,o,a,l){this._clipboard=e,this._dmnFactory=n,this._elementFactory=r,this._elementRegistry=i,this._eventBus=s,this._model=o,this._modeling=a,this._sheet=l}postExecute(e){var n=e.element,r=e.after,i=this._clipboard.get();if(!i)throw new Error("missing clipboard data");var s=this._sheet.getRoot(),o=gq(i.elements,{_dmnFactory:this._dmnFactory,_keepIds:i.keepIds,_model:this._model}).root;if(n instanceof is){var a=s.rows.indexOf(n);if(a===-1)return;o.forEach(c=>{r&&a++,this._modeling.addRow(c,a)})}else if(n instanceof ss){var l=s.cols.indexOf(n);if(l===-1)return;o.forEach(c=>{r&&l++,this._modeling.addCol(c,l)})}return e.oldElements=this._clipboard.get(),this._sheet.getRoot()}revert(e){}}yq.$inject=["clipboard","dmnFactory","elementFactory","elementRegistry","eventBus","moddle","modeling","sheet"];function aM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function m_e(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?aM(Object(n),!0).forEach(function(r){g_e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):aM(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function g_e(t,e,n){return e=v_e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function v_e(t){var e=y_e(t,"string");return typeof e=="symbol"?e:String(e)}function y_e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class xq{constructor(e,n,r,i,s,o){this._clipboard=e,this._commandStack=n,this._eventBus=r,this._modeling=i,this._sheet=s,this._rules=o,n.registerHandler("cut",fq),n.registerHandler("paste",yq)}copy(e){ke(e)||(e=[e]);var n={elements:sj(e)};this._eventBus.fire("copyCutPaste.copy",{data:n}),this._clipboard.set(n)}cut(e){ke(e)||(e=[e]);var n={elements:sj(e),keepIds:!0},r={elements:e,data:n};this._eventBus.fire("copyCutPaste.cut",{data:n}),this._commandStack.execute("cut",r)}pasteBefore(e){return this._paste(e,{before:!0})}pasteAfter(e){return this._paste(e,{after:!0})}_paste(e,n){var r=this._clipboard.get();if(r){var i=this._rules.allowed("paste",{data:r.elements,target:e});return i?(this._commandStack.execute("paste",m_e({element:e},n)),this._clipboard.clear(),!0):!1}}pasteAt(e){}}xq.$inject=["clipboard","commandStack","eventBus","modeling","sheet","rules"];const bq={__depends__:[hq,iN],__init__:["copyCutPaste"],copyCutPaste:["type",xq]};class wq{constructor(e,n,r,i,s,o){var a={addRule(){return r.addRow({type:"dmn:DecisionRule"})},addRuleAbove(l){var c=l&&l.rule;if(!(!c&&!i.hasSelection())){c=c||i.get().row;var d=o.getRoot(),h=d.rows.indexOf(c);if(h!==-1)return r.addRow({type:"dmn:DecisionRule"},h)}},addRuleBelow(l){var c=l&&l.rule;if(!(!c&&!i.hasSelection())){c=c||i.get().row;var d=o.getRoot(),h=d.rows.indexOf(c);if(h!==-1)return r.addRow({type:"dmn:DecisionRule"},h+1)}},removeRule(l){var c=l&&l.rule;!c&&!i.hasSelection()||(c=c||i.get().row,r.removeRow(c))},addInput(){var l=o.getRoot(),c=l.businessObject,d=c.input;return r.addCol({type:"dmn:InputClause"},d?d.length:0)},addInputLeft(l){var c=l&&l.input;if(!(!c&&!i.hasSelection())){c=c||i.get().col;var d=o.getRoot(),h=d.cols.indexOf(c);if(h!==-1)return r.addCol({type:"dmn:InputClause"},h)}},addInputRight(l){var c=l&&l.input;if(!(!c&&!i.hasSelection())){c=c||i.get().col;var d=o.getRoot(),h=d.cols.indexOf(c);if(h!==-1)return r.addCol({type:"dmn:InputClause"},h+1)}},removeInput(l){var c=l&&l.input;!c&&!i.hasSelection()||(c=c||i.get().col,r.removeCol(c))},addOutput(){var l=o.getRoot(),c=l.businessObject,d=c.get("input"),h=c.get("output");return r.addCol({type:"dmn:OutputClause"},d.length+h.length)},addOutputLeft(l){var c=l&&l.output;if(!(!c&&!i.hasSelection())){c=c||i.get().col;var d=o.getRoot(),h=d.cols.indexOf(c);if(h!==-1)return r.addCol({type:"dmn:OutputClause"},h)}},addOutputRight(l){var c=l&&l.output;if(!(!c&&!i.hasSelection())){c=c||i.get().col;var d=o.getRoot(),h=d.cols.indexOf(c);if(h!==-1)return r.addCol({type:"dmn:OutputClause"},h+1)}},removeOutput(l){var c=l&&l.output;!c&&!i.hasSelection()||(c=c||i.get().col,r.removeCol(c))},addClause(){if(i.hasSelection()){var l=i.get().col;if(Y(l,"dmn:InputClause"))return a.addInput({input:l});if(Y(l,"dmn:OutputClause"))return a.addOutput({output:l})}},addClauseLeft(){if(i.hasSelection()){var l=i.get().col;if(Y(l,"dmn:InputClause"))return a.addInputLeft({input:l});if(Y(l,"dmn:OutputClause"))return a.addOutputLeft({output:l})}},addClauseRight(){if(i.hasSelection()){var l=i.get().col;if(Y(l,"dmn:InputClause"))return a.addInputRight({input:l});if(Y(l,"dmn:OutputClause"))return a.addOutputRight({output:l})}},removeClause(){if(i.hasSelection()){var l=i.get().col;if(Y(l,"dmn:InputClause"))return a.removeInput({input:l});if(Y(l,"dmn:OutputClause"))return a.removeOutput({output:l})}},selectCellAbove(){return s.selectCell("above")},selectCellBelow(){return s.selectCell("below")},copy(l){var c=l.element;e.copy(c)},cut(l){var c=l.element;e.cut(c)},pasteBefore(l){var c=l.element;return e.pasteBefore(c)},pasteAfter(l){var c=l.element;return e.pasteAfter(c)}};n.register(a)}}wq.$inject=["copyCutPaste","editorActions","modeling","selection","cellSelection","sheet"];const lM="is not a registered action",x_e="is already registered";let _q=class{constructor(e,n,r,i){this._actions={undo(){e.undo()},redo(){e.redo()},select({cell:s}){i.select(s)},deselect(){i.deselect()},addRow({attrs:s,index:o}){r.addRow(s,o)},removeRow({row:s}){r.removeRow(s)},moveRow({row:s,index:o}){r.moveRow(s,o)},addCol({attrs:s,index:o}){r.addCol(s,o)},removeCol({col:s}){r.removeCol(s)},moveCol({col:s,index:o}){r.moveCol(s,o)}}}trigger(e,n){if(!this._actions[e])throw HE(e,lM);return this._actions[e](n)}register(e,n){if(typeof e=="string")return this._registerAction(e,n);$(e,(r,i)=>{this._registerAction(i,r)})}_registerAction(e,n){if(this.isRegistered(e))throw HE(e,x_e);this._actions[e]=n}unregister(e){if(!this.isRegistered(e))throw HE(e,lM);this._actions[e]=void 0}isRegistered(e){return!!this._actions[e]}};_q.$inject=["commandStack","eventBus","modeling","selection"];function HE(t,e){return new Error(t+" "+e)}const Eq={__depends__:[t1],__init__:["editorActions"],editorActions:["type",_q]},Gf={__depends__:[n1,bq,Eq,t1],__init__:["decisionTableEditorActions"],decisionTableEditorActions:["type",wq]},b_e={__depends__:[Gf],__init__:["addRule"],addRule:["type",ZV]};/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */var w_e=/["'&<>]/,__e=E_e;function E_e(t){var e=""+t,n=w_e.exec(e);if(!n)return e;var r,i="",s=0,o=0;for(s=n.index;s<e.length;s++){switch(e.charCodeAt(s)){case 34:r="&quot;";break;case 38:r="&amp;";break;case 39:r="&#39;";break;case 60:r="&lt;";break;case 62:r="&gt;";break;default:continue}o!==s&&(i+=e.substring(o,s)),o=s+1,i+=r}return o!==s?i+e.substring(o,s):i}const S_e=aw(__e);var sN={exports:{}};function C_e(t,e,n){var r=t.start,i=r,o=n.length-e.length;n.length-e.length;var s=e.substring(r);n.lastIndexOf(s)===n.length-s.length&&(e=e.substring(0,e.length-s.length),n=n.substring(0,n.length-s.length));var o=j_e(e,n);return o&&(o.type==="remove"?i=o.newStart:i=o.newEnd),Sq(i)}sN.exports=C_e;function j_e(t,e){var n,r,i,s=0,o,a,l=0;for(e.length>t.length?(r=e,o=t):(r=t,o=e);s<r.length;)i=r.charAt(s),a=o.charAt(l),i!==a?(n||(n={l_start:s,s_start:l}),s++):(n&&!n.complete&&(n.l_end=s,n.s_end=l,n.complete=!0),l++,s++);if(n&&!n.complete&&(n.complete=!0,n.s_end=o.length,n.l_end=r.length),!!n)return e.length>t.length?{newStart:n.l_start,newEnd:n.l_end,type:"add"}:{newStart:n.s_start,newEnd:n.s_end,type:e.length<t.length?"remove":"replace"}}function Sq(t,e){return{start:t,end:e===void 0?t:e}}sN.exports.range=Sq;var k_e=sN.exports;const P_e=aw(k_e);function Bh(t,e,n){return e=T_e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function T_e(t){var e=N_e(t,"string");return typeof e=="symbol"?e:String(e)}function N_e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class tf extends Ve{constructor(e,n){super(e,n),Bh(this,"onFocus",r=>{var i=this.props.onFocus;this.setState({focussed:!0}),typeof i=="function"&&i(r)}),Bh(this,"onBlur",r=>{var i=this.props.onBlur;this.setState({focussed:!1}),typeof i=="function"&&i(r)}),Bh(this,"onKeydown",r=>{if(r.which===13){if(r.preventDefault(),this.props.ctrlForNewline&&!I_e(r)||this.props.singleLine)return;r.stopPropagation(),R_e(),this.onInput(r)}}),Bh(this,"onInput",r=>{var i=this.props.onInput;if(typeof i=="function"){var s=UE(this.node);i(s)}}),Bh(this,"onKeyPress",r=>{this.onInputIEPolyfill&&this.onInputIEPolyfill(r)}),Bh(this,"onPaste",r=>{if(this.onInputIEPolyfill&&this.onInputIEPolyfill(r),this.props.singleLine){var i=(r.clipboardData||window.clipboardData).getData("text");document.execCommand("insertText",!1,i.replace(/\n/g," ")),r.preventDefault()}}),this.state={},A_e()&&(this.onInputIEPolyfill=r=>{var i=this.node.innerHTML;setTimeout(()=>{var s=this.node.innerHTML;i!==s&&this.onInput(r)},0)})}componentWillUpdate(e,n){var r=this.node,i=n.focussed&&rN(r);this.selected=i&&{range:i,text:UE(r)}}componentDidUpdate(){var e=this.selected;if(e){var n=e.range,r=e.text,i=this.node,s=UE(i),o=s!==r?P_e(n,r,s):n;$we(i,o)}}getClassName(){var e=this.props,n=e.className,r=e.placeholder,i=e.value;return[n||"","content-editable",!i&&r?"placeholder":""].join(" ")}render(e){var n=e.value,r=e.placeholder;return n=S_e(n).replace(/\r?\n/g,"<br/>")+"<br/>",D(1,"div",this.getClassName(),null,1,{contentEditable:"true",spellcheck:"false","data-placeholder":r||"",onInput:this.onInput,onKeypress:this.onKeypress,onPaste:this.onPaste,onFocus:this.onFocus,onBlur:this.onBlur,onKeydown:this.onKeydown,dangerouslySetInnerHTML:{__html:n}},null,i=>this.node=i)}}function O_e(){return document.createElement("br")}function UE(t){return t.innerText.replace(/\n$/,"")}function R_e(){var t=Iwe(),e=t.getRangeAt(0);if(e){var n=e.cloneRange(),r=O_e();n.deleteContents(),n.insertNode(r),n.setStartAfter(r),n.setEndAfter(r),oq(n)}}function A_e(){var t=window.navigator.userAgent;return t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0}function I_e(t){return t.metaKey||t.ctrlKey}function cM(t,e,n){return e=D_e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function D_e(t){var e=$_e(t,"string");return typeof e=="symbol"?e:String(e)}function $_e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class vy extends Ve{constructor(e,n){super(e,n),cM(this,"onFocus",s=>{this.setState({focussed:!0});var o=this.props.onFocus;typeof o=="function"&&o(s)}),cM(this,"onBlur",s=>{this.setState({focussed:!1});var o=this.state.invalid;o&&this.setState({changing:!1,invalid:!1});var a=this.props.onBlur;typeof a=="function"&&a(s)}),this.state={changing:!1,focussed:!1};var r=n.injector,i=r.get("debounceInput");this.inputChanged=i(s=>{var o=this.props.onChange;typeof o=="function"&&o(s);var a=this.state.changing;this.setState({changing:a===s?!1:a})}),this.onInput=s=>{var o=this.props.validate||function(){},a=o(s);this.setState({changing:s,invalid:a}),a||this.inputChanged(s)}}getClassName(){var e=this.props,n=e.className,r=e.value,i=this.state,s=i.changing,o=i.focussed,a=i.invalid;return n+=" editable",o&&(n+=" focussed"),a&&(n+=" invalid"),!r&&!s&&(n+=" empty"),n}getDisplayValue(){var e=this.props,n=e.value,r=e.placeholder,i=this.state,s=i.focussed,o=i.changing;return typeof o=="string"&&(n=o),n||(n=s?"":r||""),n}getEditor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Pe(2,tf,{className:e.className,ctrlForNewline:this.props.ctrlForNewline,onFocus:this.onFocus,onBlur:this.onBlur,onInput:this.onInput,value:this.getDisplayValue()})}}function uM(t,e,n){return e=M_e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function M_e(t){var e=L_e(t,"string");return typeof e=="symbol"?e:String(e)}function L_e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class Cq extends Ve{constructor(e,n){super(e,n),uM(this,"onElementsChanged",()=>{this.forceUpdate()}),uM(this,"setAnnotationValue",r=>{var i=this.props.row;this.modeling.editAnnotation(i.businessObject,r)}),hi(this)}componentWillMount(){var e=this.props.row;this.changeSupport.onElementsChanged(e.id,this.onElementsChanged)}componentWillUnmount(){var e=this.props.row;this.changeSupport.offElementsChanged(e.id,this.onElementsChanged)}render(){var e=this.props,n=e.row,r=e.rowIndex,i=n.businessObject,s=i.description,o=i.id;return Pe(2,Kg,{className:"annotation",onChange:this.setAnnotationValue,coords:"".concat(r,":annotation"),value:s,elementId:o,"data-row-id":n.id,children:Pe(2,B_e,{ctrlForNewline:!0,className:"annotation-editor",onChange:this.setAnnotationValue,value:s})})}}Cq.$inject=["changeSupport","modeling"];class B_e extends vy{render(){return D(1,"div",this.getClassName(),this.getEditor(),0)}}function jq(t){t.onGetComponent("cell",e=>{var n=e.cellType;if(n==="after-label-cells")return tN;if(n==="after-rule-cells")return Cq})}jq.$inject=["components"];var F_e=300;function kq(t){return function(n){if(t!==!1){var r=Oe(t)?t:F_e;return bf(n,r)}else return n}}kq.$inject=["config.debounceInput"];const dh={debounceInput:["factory",kq]},z_e={__depends__:[dh],__init__:["annotationsProvider"],annotationsProvider:["type",jq]};function H_e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var VE,dM;function U_e(){if(dM)return VE;dM=1,VE=t;function t(e,n){return e^n}return VE}var qE,hM;function V_e(){if(hM)return qE;hM=1;var t=/\b(Array|Date|Object|Math|JSON)\b/g;qE=function(s,o){var a=r(e(s));return o&&typeof o=="string"&&(o=i(o)),o?n(s,a,o):a};function e(s){return s.replace(/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\//g,"").replace(t,"").match(/[a-zA-Z_]\w*/g)||[]}function n(s,o,a){var l=/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\/|[a-zA-Z_]\w*/g;return s.replace(l,function(c){return c[c.length-1]=="("||~o.indexOf(c)?a(c):c})}function r(s){for(var o=[],a=0;a<s.length;a++)~o.indexOf(s[a])||o.push(s[a]);return o}function i(s){return function(o){return s+o}}return qE}var WE,pM;function q_e(){if(pM)return WE;pM=1;var t=U_e(),e=V_e();WE=n;function n(i,s){if(!(this instanceof n))return new n(i,s);if(this.node=this.start=this.peeked=i,this.root=s,this.closingTag=!1,this._revisit=!0,this._selects=[],this._rejects=[],i&&this.higher(i))throw new Error("root must be a parent or ancestor to node")}n.prototype.reset=function(i){return this.node=i||this.start,this},n.prototype.revisit=function(i){return this._revisit=i??!0,this},n.prototype.opening=function(){return this.node.nodeType==1&&(this.closingTag=!1),this},n.prototype.atOpening=function(){return!this.closingTag},n.prototype.closing=function(){return this.node.nodeType==1&&(this.closingTag=!0),this},n.prototype.atClosing=function(){return this.closingTag},n.prototype.next=r("nextSibling","firstChild"),n.prototype.previous=n.prototype.prev=r("previousSibling","lastChild");function r(i,s){var o=i=="nextSibling";return function(l,c,d){l=this.compile(l),c=c&&c>0?c:1;for(var h=this.node,p=this.closingTag,f=this._revisit;h;){if(t(o,p)&&h[s])h=h[s],p=!o;else if(h.nodeType==1&&!h[s]&&t(o,p)){if(p=o,!f)continue}else if(h[i])h=h[i],p=!o;else if(h=h.parentNode,p=o,!f)continue;if(!h||this.higher(h,this.root))break;if(l(h)&&this.selects(h,d)&&this.rejects(h,d)){if(--c)continue;return d||(this.node=h),this.closingTag=p,h}}return null}}return n.prototype.select=function(i){return i=this.compile(i),this._selects.push(i),this},n.prototype.selects=function(i,s){var o=this._selects,a=o.length;if(!a)return!0;for(var l=0;l<a;l++)if(o[l].call(this,i,s))return!0;return!1},n.prototype.reject=function(i){return i=this.compile(i),this._rejects.push(i),this},n.prototype.rejects=function(i,s){var o=this._rejects,a=o.length;if(!a)return!0;for(var l=0;l<a;l++)if(o[l].call(this,i,s))return!1;return!0},n.prototype.higher=function(i){var s=this.root;if(!s)return!1;for(i=i.parentNode;i&&i!=s;)i=i.parentNode;return i!=s},n.prototype.compile=function(i){switch(typeof i){case"number":return function(s){return i==s.nodeType};case"string":return new Function("node","Object.freeze(node); return "+e(i,"node."));case"function":return i;default:return function(){return!0}}},n.prototype.peak=n.prototype.peek=function(i,s){return arguments.length==1&&(s=i,i=!0),s=s??1,s?s>0?this.next(i,s,!0):this.prev(i,Math.abs(s),!0):this.node},n.prototype.use=function(i){return i(this),this},WE}var W_e=q_e(),G_e=H_e(W_e),fM=window.getSelection();function K_e(t){fM.removeAllRanges(),fM.addRange(t)}function Y_e(t,e){var n=X_e(t,e);K_e(n)}function X_e(t,e){for(var n=e.start,r=e.end,i=document.createRange(),s=G_e(t.firstChild,t),o=s.node,a=!1,l=0,c;o;){if(l===n&&(a?i.setStartAfter(o):i.setStartBefore(o)),l===r)return a?i.setEndAfter(o):i.setEndBefore(o),i;if(a||(Z_e(o)||o.previousSibling&&(J_e(o)||e1e(o)))&&l++,Q_e(o)){if(c=o.textContent.length,l<=n&&l+c>n&&i.setStart(o,n-l),l+c>r)return i.setEnd(o,r-l),i;l+=c}o=s.next(),a=s.closingTag}return l<=n&&(t.lastChild?i.setStartAfter(t.lastChild):i.setStart(t,0)),t.lastChild?i.setEndAfter(t.lastChild):i.setEnd(t,0),i}function Q_e(t){return t.nodeType===3}function Z_e(t){return t.nodeType===1&&t.nodeName==="BR"}function J_e(t){return t.nodeType===1&&t.nodeName==="DIV"}function e1e(t){return t.nodeType===1&&t.nodeName==="P"}function ad(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const t1e={position:"absolute"};class Pq extends Ve{constructor(e,n){super(e,n),ad(this,"open",({position:r,context:i})=>{this.close(),this.setState({isOpen:!0,position:r||{x:0,y:0},context:i||{}})}),ad(this,"close",()=>{this.state.isOpen&&this.setState({context:void 0,isOpen:!1,position:{x:0,y:0}})}),ad(this,"triggerClose",()=>{this.eventBus.fire("contextMenu.close")}),this.state={isOpen:!1,position:{x:0,y:0}},hi(this)}componentDidMount(){this.eventBus.on("contextMenu.open",this.open),this.eventBus.on("contextMenu.close",this.close)}componentWillUnmount(){this.eventBus.off("contextMenu.open",this.open),this.eventBus.off("contextMenu.close",this.close)}render(){const{isOpen:e,context:n,position:r}=this.state;if(!e)return null;const i=this.components.getComponents("context-menu",n);return i.length?Pe(2,Tq,{className:"context-menu no-deselect",context:n,position:r,offset:n.offset||{x:0,y:0},autoFocus:n.autoFocus!==!1,autoClose:n.autoClose!==!1,components:i,onClose:this.triggerClose}):null}}Pq.$inject=["eventBus","components"];let Tq=class extends Ve{constructor(e,n){super(e,n),ad(this,"onGlobalMouseDown",r=>{this.checkClose(r.target)}),ad(this,"onGlobalKey",r=>{var i=r.which;(i===13||i===27)&&(r.stopPropagation(),r.preventDefault(),this.close())}),ad(this,"onFocusChanged",r=>{this.checkClose(r.target)}),ad(this,"setNode",r=>{this.node=r;const{autoFocus:i}=this.props;r&&(this.updatePosition(),i&&r1e(r))}),hi(this)}close(){const{onClose:e}=this.props;Bt(e)&&e()}checkClose(e){const{autoClose:n}=this.props;if(n){var r=this.node;r&&r!==e&&(r.contains(e)||this.close())}}componentDidMount(){document.addEventListener("focusin",this.onFocusChanged),document.addEventListener("keydown",this.onGlobalKey),document.addEventListener("mousedown",this.onGlobalMouseDown)}componentWillUnmount(){document.removeEventListener("focusin",this.onFocusChanged),document.removeEventListener("keydown",this.onGlobalKey),document.removeEventListener("mousedown",this.onGlobalMouseDown)}updatePosition(){const{position:e,offset:n}=this.props,{node:r}=this,i=r.getBoundingClientRect();e.width||(e.width=0),e.height||(e.height=0);const s=this.renderer.getContainer(),o=s.getBoundingClientRect();o.width>o.height?(this.node.classList.add("horizontal"),this.node.classList.remove("vertical")):(this.node.classList.add("vertical"),this.node.classList.remove("horizontal"));const{scrollLeft:a,scrollTop:l}=i1e(r),c={};let d;e.align&&(d=e.align.split("-"));let h,p;(d&&d[1]||(e.x+e.width/2>o.width/2?"left":"right"))==="left"?(h=e.x-o.left-i.width+n.x+a,r.classList.remove("right"),r.classList.add("left")):(h=-o.left+e.x+e.width-n.x+a,r.classList.remove("left"),r.classList.add("right")),h=d?h:mM(h,0+a,o.width-i.width+a),c.left=h+"px",(d&&d[0]||(e.y+e.height/2>o.height/2?"top":"bottom"))==="top"?(p=e.y-o.top-i.height+n.y+l,r.classList.remove("bottom"),r.classList.add("top")):(p=-o.top+e.y-n.y+l,r.classList.remove("top"),r.classList.add("bottom")),p=d?p:mM(p,0+l,o.height-i.height+l),c.top=p+"px",c.overflowY="auto",c.maxHeight=o.height-p+l+"px",B(this.node.style,t1e,c)}render(){const{context:e,components:n,className:r}=this.props;return D(1,"div",r,n.map((i,s)=>Pe(2,i,{context:e},s)),0,{onContextMenu:i=>i.preventDefault()},null,this.setNode)}};Tq.$inject=["renderer"];function mM(t,e,n){return Math.max(e,Math.min(n,t))}const n1e=`
  input[type=text],
  input[type=number],
  input[type=button],
  input[type=submit],
  [contenteditable],
  [tabindex],
  a[href],
  textarea,
  button
`;function r1e(t){var e=at(n1e,t);e&&(e.focus(),e.selectionStart&&e.type==="text"?e.selectionStart=1e5:"contentEditable"in e&&Y_e(e,{start:1e5,end:1e5}))}function i1e(t){const e=ur(t,".tjs-container");if(!e)return{scrollTop:0,scrollLeft:0};const{scrollLeft:n,scrollTop:r}=e;return{scrollTop:r,scrollLeft:n}}let Nq=class{constructor(e,n,r){this._eventBus=n,e.onGetComponent("table.before",()=>Pq)}open(e,n){this._eventBus.fire("contextMenu.open",{position:e,context:n})}close(){this._eventBus.fire("contextMenu.close")}};Nq.$inject=["components","eventBus","renderer"];const hh={__init__:["contextMenu"],contextMenu:["type",Nq]};function ld(t){return t.altKey?!1:t.ctrlKey||t.metaKey}function cd(t){return t.shiftKey}function gM(t,e,n){return e=s1e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s1e(t){var e=o1e(t,"string");return typeof e=="symbol"?e:String(e)}function o1e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class Oq{constructor(e,n,r,i,s,o,a){gM(this,"_clearClipboard",()=>{this._clipboard.clear()}),gM(this,"_registerBindings",()=>{var l=(h,p)=>{if(ld(p)&&h===67){var f=this._getSelectedCell();return f?(cd(p)?this._editorActions.trigger("copy",{element:f.col}):this._editorActions.trigger("copy",{element:f.row}),!0):void 0}},c=(h,p)=>{if(ld(p)&&h===88){var f=this._getSelectedCell();return f?(cd(p)?this._editorActions.trigger("cut",{element:f.col}):this._editorActions.trigger("cut",{element:f.row}),!0):void 0}},d=(h,p)=>{var f;if(ld(p)&&h===86){var m=this._getSelectedCell();if(!m)return;cd(p)?(f=this._editorActions.trigger("pasteAfter",{element:m.col}),f&&this._cellSelection.selectCell("right")):(f=this._editorActions.trigger("pasteAfter",{element:m.row}),f&&this._cellSelection.selectCell("below"))}return typeof f<"u"};[l,c,d].forEach(h=>{this._keyboard.addListener(h)})}),this._clipboard=r,this._cellSelection=i,this._elementRegistry=s,this._editorActions=o,this._keyboard=e.get("keyboard",!1),this._renderer=a,this._keyboard&&(n.on("keyboard.init",this._registerBindings),n.on("keyboard.bind",()=>{ie.bind(document,"copy",this._clearClipboard,!0),ie.bind(document,"cut",this._clearClipboard,!0)}),n.on("keyboard.unbind",()=>{ie.unbind(document,"copy",this._clearClipboard,!0),ie.unbind(document,"cut",this._clearClipboard,!0)}))}_getSelectedCell(){var e=this._cellSelection.getCellSelection();if(e){var n=this._elementRegistry.get(e);if(n){var r=this._renderer.getContainer(),i=ef(e,r),s=uq(i);if(document.activeElement===s){var o=rN(i);if(!(o&&o.start!==o.end))return n}}}}}Oq.$inject=["injector","eventBus","clipboard","cellSelection","elementRegistry","editorActions","renderer"];const a1e={__depends__:[hq,n1],__init__:["copyCutPasteKeyBindings"],copyCutPasteKeyBindings:["type",Oq]};function l1e(t,e,n){return e=c1e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c1e(t){var e=u1e(t,"string");return typeof e=="symbol"?e:String(e)}function u1e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class Rq extends Ve{constructor(e,n){super(e,n),l1e(this,"onClick",r=>{this.editorActions.trigger("addInput")}),hi(this)}render(){return D(1,"th","input-cell create-inputs header actionable",[this.translate("Input"),Vn(" "),D(1,"span","add-input dmn-icon-plus action-icon",null,1,{title:this.translate("Add input")})],0,{onClick:this.onClick,title:this.translate("Add input")})}}Rq.$inject=["editorActions","translate"];function d1e(t,e,n){return e=h1e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function h1e(t){var e=p1e(t,"string");return typeof e=="symbol"?e:String(e)}function p1e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class Aq extends Ve{constructor(e,n){super(e,n),d1e(this,"onClick",r=>{this.editorActions.trigger("addInput")}),hi(this)}render(){return D(1,"td","input-cell create-inputs",Vn("-"),2,{onClick:this.onClick,title:this.translate("Add input")})}}Aq.$inject=["editorActions","translate"];var f1e=500;class Iq{constructor(e,n){e.onGetComponent("cell",f1e,r=>{var i=r.cellType,s=n.getRoot(),o=s.businessObject;if(!(o.input&&o.input.length)){if(i==="before-label-cells")return Rq;if(i==="before-rule-cells")return Aq}})}}Iq.$inject=["components","sheet"];const m1e={__depends__:[Gf],__init__:["createInputsProvider"],createInputsProvider:["type",Iq]};var g1e=["string","boolean","number","date","time","dateTime","dayTimeDuration","yearMonthDuration","Any"];class oN{constructor(e){this._dataTypes=e||g1e}getAll(){return this._dataTypes}}oN.$inject=["config.dataTypes"];const aN={__init__:["dataTypes"],dataTypes:["type",oN]};class Dq{constructor(e,n,r,i,s,o,a,l,c,d,h){var p=this;this._contextMenu=n,this._clipboard=r,this._editorActions=i,this._elementRegistry=o,this._eventBus=s,this._modeling=a,this._selection=l,this._sheet=c,this._rules=d,this._translate=h,this._getEntries=this._getEntries.bind(this),e.onGetComponent("context-menu",function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(f.contextMenuType&&f.contextMenuType==="context-menu"){var m=p._getEntries(f),g=p._elementRegistry.get(f.id),v=v1e(g)&&e.getComponents("context-menu-cell-additional",f);if(v&&v.length){var b=D(1,"div","context-menu-group context-menu-group-cell",v,0);return()=>D(1,"div","context-menu-flex",(m||[]).concat(b),0)}else return()=>D(1,"div","context-menu-flex",m||[],0)}}),s.on("cell.contextmenu",f=>{var m=f.event,g=f.id;f.node,m.preventDefault(),n.open({x:m.pageX,y:m.pageY},{contextMenuType:"context-menu",event:m,id:g})})}_getEntries(e){var n={addRuleAbove:g=>{var v=g.cells.map(x=>x.id).indexOf(e.id),b=this._editorActions.trigger("addRuleAbove",{rule:g});b.cells[v]?this._selection.select(b.cells[v]):this._selection.select(b.cells[0]),this._contextMenu.close()},addRuleBelow:g=>{var v=g.cells.map(x=>x.id).indexOf(e.id),b=this._editorActions.trigger("addRuleBelow",{rule:g});b.cells[v]?this._selection.select(b.cells[v]):this._selection.select(b.cells[0]),this._contextMenu.close()},removeRule:g=>{this._editorActions.trigger("removeRule",{rule:g}),this._contextMenu.close()},addInputLeft:g=>{this._editorActions.trigger("addInputLeft",{input:g}),this._contextMenu.close()},addInputRight:g=>{this._editorActions.trigger("addInputRight",{input:g}),this._contextMenu.close()},removeInput:g=>{this._editorActions.trigger("removeInput",{input:g}),this._contextMenu.close()},addOutputLeft:g=>{this._editorActions.trigger("addOutputLeft",{output:g}),this._contextMenu.close()},addOutputRight:g=>{this._editorActions.trigger("addOutputRight",{output:g}),this._contextMenu.close()},removeOutput:g=>{this._editorActions.trigger("removeOutput",{output:g}),this._contextMenu.close()},copy:g=>{this._editorActions.trigger("copy",{element:g}),this._contextMenu.close()},cut:g=>{this._editorActions.trigger("cut",{element:g}),this._contextMenu.close()},pasteBefore:g=>{this._editorActions.trigger("pasteBefore",{element:g}),this._contextMenu.close()},pasteAfter:g=>{this._editorActions.trigger("pasteAfter",{element:g}),this._contextMenu.close()}},r=e&&e.id;if(!r)return null;var i=this._elementRegistry.get(r);if(!i)return null;var s=this._clipboard.get()||{},o=[],a=i.row||i;if(Y(a,"dmn:DecisionRule")){var l=this._rules.allowed("paste",{data:s.elements,target:a});o.push(D(1,"div","context-menu-group",[D(1,"div","context-menu-group-entry context-menu-entry-copy-rule",this._translate("Copy rule"),0,{onClick:()=>n.copy(a)}),D(1,"div","context-menu-group-entry context-menu-entry-cut-rule",this._translate("Cut rule"),0,{onClick:()=>n.cut(a)}),D(1,"div","context-menu-group-entry ".concat(l?"":"disabled"," context-menu-entry-paste-rule-above"),this._translate("Paste rule above"),0,{onClick:()=>n.pasteBefore(a)}),D(1,"div","context-menu-group-entry ".concat(l?"":"disabled"," context-menu-entry-paste-rule-below"),this._translate("Paste rule below"),0,{onClick:()=>n.pasteAfter(a)})],4),D(1,"div","context-menu-group",[D(1,"div","context-menu-group-entry context-menu-entry-add-rule-above",this._translate("Add rule above"),0,{onClick:()=>n.addRuleAbove(a)}),D(1,"div","context-menu-group-entry context-menu-entry-add-rule-below",this._translate("Add rule below"),0,{onClick:()=>n.addRuleBelow(a)}),D(1,"div","context-menu-group-entry context-menu-entry-remove-rule",this._translate("Remove rule"),0,{onClick:()=>n.removeRule(a)})],4))}else if(Y(i,"dmn:InputClause")){var c=Y(i,"dmn:InputClause")?i:i.col,d=this._rules.allowed("col.remove",{col:i.col||i}),h=this._rules.allowed("paste",{data:s.elements,target:i.col||i});o.push(D(1,"div","context-menu-group",[D(1,"div","context-menu-group-entry context-menu-entry-copy-input",this._translate("Copy input column"),0,{onClick:()=>n.copy(c)}),D(1,"div","context-menu-group-entry ".concat(d?"":"disabled"," context-menu-entry-cut-input"),this._translate("Cut input column"),0,{onClick:()=>n.cut(c)}),D(1,"div","context-menu-group-entry ".concat(h?"":"disabled"," context-menu-entry-paste-input-left"),this._translate("Paste input column left"),0,{onClick:()=>n.pasteBefore(c)}),D(1,"div","context-menu-group-entry ".concat(h?"":"disabled"," context-menu-entry-paste-input-right"),this._translate("Paste input column right"),0,{onClick:()=>n.pasteAfter(c)})],4),D(1,"div","context-menu-group",[D(1,"div","context-menu-group-entry context-menu-entry-add-input-left",this._translate("Add input column left"),0,{onClick:()=>n.addInputLeft(c)}),D(1,"div","context-menu-group-entry context-menu-entry-add-input-right",this._translate("Add input column right"),0,{onClick:()=>n.addInputRight(c)}),D(1,"div","context-menu-group-entry ".concat(d?"":"disabled"," context-menu-entry-remove-input"),this._translate("Remove input column"),0,{onClick:()=>n.removeInput(c)})],4))}else if(Y(i,"dmn:OutputClause")||Y(i.col,"dmn:OutputClause")){var p=Y(i,"dmn:OutputClause")?i:i.col,f=this._rules.allowed("col.remove",{col:i.col||i}),m=this._rules.allowed("paste",{data:s.elements,target:i.col||i});o.push(D(1,"div","context-menu-group",[D(1,"div","context-menu-group-entry context-menu-entry-copy-output",this._translate("Copy output column"),0,{onClick:()=>n.copy(p)}),D(1,"div","context-menu-group-entry ".concat(f?"":"disabled"," context-menu-entry-cut-output"),this._translate("Cut output column"),0,{onClick:()=>n.cut(p)}),D(1,"div","context-menu-group-entry ".concat(m?"":"disabled"," context-menu-entry-paste-output-left"),this._translate("Paste output column left"),0,{onClick:()=>n.pasteBefore(p)}),D(1,"div","context-menu-group-entry ".concat(m?"":"disabled"," context-menu-entry-paste-output-right"),this._translate("Paste output column right"),0,{onClick:()=>n.pasteAfter(p)})],4),D(1,"div","context-menu-group",[D(1,"div","context-menu-group-entry context-menu-entry-add-output-left",this._translate("Add output column left"),0,{onClick:()=>n.addOutputLeft(p)}),D(1,"div","context-menu-group-entry context-menu-entry-add-output-right",this._translate("Add output column right"),0,{onClick:()=>n.addOutputRight(p)}),D(1,"div","context-menu-group-entry ".concat(f?"":"disabled"," context-menu-entry-remove-output"),this._translate("Remove output column"),0,{onClick:()=>n.removeOutput(p)})],4))}return o}}Dq.$inject=["components","contextMenu","clipboard","editorActions","eventBus","elementRegistry","modeling","selection","sheet","rules","translate"];function v1e(t){return t instanceof e1}var y1e=["row.add","row.remove","col.add","col.remove"];class $q{constructor(e,n){n.on("commandStack.executed",r=>{var i=r.command;y1e.indexOf(i)!==-1&&e.close()}),n.on("commandStack.reverted",()=>{e.close()})}}$q.$inject=["contextMenu","eventBus"];const x1e={__depends__:[Gf,hh,iN],__init__:["decisionTableContextMenu","contextMenuCloseBehavior"],decisionTableContextMenu:["type",Dq],contextMenuCloseBehavior:["type",$q]};function GE(t,e,n){return e=b1e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function b1e(t){var e=w1e(t,"string");return typeof e=="symbol"?e:String(e)}function w1e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class _1e extends Ve{constructor(e,n){super(e,n),GE(this,"onClick",r=>{var i=this.props.output;this._eventBus.fire("output.edit",{event:r,output:i})}),GE(this,"onContextmenu",r=>{var i=this.props.output.id;this._eventBus.fire("cell.contextmenu",{event:r,id:i})}),GE(this,"onElementsChanged",()=>{this.forceUpdate()}),ch(this,Wf),this._translate=n.injector.get("translate")}componentWillMount(){var e=this.context.injector;this._changeSupport=this.context.changeSupport,this._eventBus=e.get("eventBus"),this._elementRegistry=e.get("elementRegistry");var n=this.props.output;this._changeSupport.onElementsChanged(n.id,this.onElementsChanged)}componentWillUnmount(){var e=this.props.output;this._changeSupport.offElementsChanged(e.id,this.onElementsChanged)}render(){var e=this.props,n=e.output,r=e.index,i=e.outputsLength,s=n.label,o=n.name,a=n.outputValues,l=n.typeRef,c=n.width?n.width+"px":"192px";return D(1,"th","output-cell output-editor",[this.slotFills({type:"cell-inner",context:{cellType:"output-cell",col:this._elementRegistry.get(n.id),index:r,outputsLength:i},col:n}),D(1,"div","clause",r===0?this._translate("Then"):this._translate("And"),0),s?D(1,"div","output-label",s,0,{title:this._translate("Output label: ")+s}):D(1,"div","output-name",o,0,{title:this._translate("Output name: ")+o}),D(1,"div","output-variable",a&&a.text||this._translate(l||""),0,{title:a&&a.text?this._translate("Output values"):this._translate("Output type")})],0,{"data-col-id":n.id,onDblClick:this.onClick,onContextmenu:this.onContextmenu,style:{width:c}})}}function KE(t,e,n){return e=E1e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function E1e(t){var e=S1e(t,"string");return typeof e=="symbol"?e:String(e)}function S1e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class Ed extends Ve{constructor(e,n){super(e,n),KE(this,"onInput",r=>{var i=this.props.onInput;typeof i=="function"&&i(r.target.value)}),KE(this,"onKeyDown",r=>{var i=this.props.onKeyDown;typeof i=="function"&&i(r)}),KE(this,"onKeyUp",r=>{var i=this.props.onKeyUp;typeof i=="function"&&i(r)})}render(){var e=this.props,n=e.className,r=e.placeholder,i=e.type,s=e.value;return D(64,"input",[n||"","dms-input"].join(" "),null,1,{placeholder:r||"",onInput:this.onInput,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,spellcheck:"false",type:i||"text",value:s})}}class C1e extends Ve{constructor(e,n){super(e,n),this.translate=n.injector?n.injector.get("translate"):j1e,this.setName=r=>{r=r||void 0,this.handleChange({name:r})},this.setLabel=r=>{r=r||void 0,this.handleChange({label:r})}}handleChange(e){var n=this.props.onChange;typeof n=="function"&&n(e)}render(){var e=this.props,n=e.name,r=e.label;return D(1,"div","context-menu-container ref-output-editor output-edit",[D(1,"div","dms-form-control",Pe(2,tf,{className:"dms-output-label",value:r||"",placeholder:this.translate("Output"),singleLine:!0,onInput:this.setLabel}),2),D(1,"div","dms-form-control",[D(1,"label","dms-label",this.translate("Output name"),0),Pe(2,Ed,{className:"ref-output-name",value:n||"",onInput:this.setName})],4)],4)}}function j1e(t){return t}function vM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function yM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vM(Object(n),!0).forEach(function(r){lj(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vM(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function lj(t,e,n){return e=k1e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function k1e(t){var e=P1e(t,"string");return typeof e=="symbol"?e:String(e)}function P1e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class Mq extends Ve{constructor(e,n){super(e,n),lj(this,"persistChanges",()=>{var r=this.props.context.output,i=this.state.unsaved;i&&(this.modeling.updateProperties(r,i),this.setState({unsaved:!1}))}),lj(this,"handleChange",r=>{this.setState({unsaved:yM(yM({},this.state.unsaved),r)},this.persistChanges)}),this.state={},hi(this),this.persistChanges=this.debounceInput(this.persistChanges)}getValue(e){var n=this.props.context.output,r=this.state.unsaved;return r&&e in r?r[e]:n.get(e)}render(){return Pe(2,C1e,{name:this.getValue("name"),label:this.getValue("label"),onChange:this.handleChange})}}Mq.$inject=["debounceInput","modeling"];class Lq{constructor(e,n,r,i){e.onGetComponent("cell",s=>{var o=s.cellType;if(o==="output-header")return _1e}),e.onGetComponent("context-menu",function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(s.contextMenuType==="output-edit")return Mq}),r.on("output.edit",s=>{var o=s.event,a=s.output,l=o.target,c=ur(l,"th",!0),d=c.getBoundingClientRect(),h=d.left,p=d.top,f=T1e(c);n.open({x:h,y:p,align:"bottom-right"},{contextMenuType:"output-edit",output:a,offset:f})})}}Lq.$inject=["components","contextMenu","eventBus","renderer"];function T1e(t){if(!zd(t,".output-cell + .output-cell"))return{x:-1,y:0}}function YE(t,e,n){return e=N1e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function N1e(t){var e=O1e(t,"string");return typeof e=="symbol"?e:String(e)}function O1e(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class R1e extends Ve{constructor(e,n){super(e,n),YE(this,"onClick",r=>{var i=this.props.input;this._eventBus.fire("input.edit",{event:r,input:i})}),YE(this,"onContextmenu",r=>{var i=this.props.input.id;this._eventBus.fire("cell.contextmenu",{event:r,id:i})}),YE(this,"onElementsChanged",()=>{this.forceUpdate()}),ch(this,Wf),this._translate=n.injector.get("translate")}componentWillMount(){var e=this.context.injector;this._changeSupport=this.context.changeSupport,this._sheet=e.get("sheet"),this._eventBus=e.get("eventBus"),this._elementRegistry=e.get("elementRegistry");var n=this._sheet.getRoot(),r=this.props.input;this._changeSupport.onElementsChanged(n.id,this.onElementsChanged),this._changeSupport.onElementsChanged(r.id,this.onElementsChanged)}componentWillUnmount(){var e=this._sheet.getRoot(),n=this.props.input;this._changeSupport.offElementsChanged(e.id,this.onElementsChanged),this._changeSupport.offElementsChanged(n.id,this.onElementsChanged)}render(){var e=this.props,n=e.input,r=e.index,i=e.inputsLength,s=n.inputExpression,o=n.inputValues,a=n.get("label"),l=n.width?n.width+"px":"192px";return D(1,"th","input-cell input-editor",[this.slotFills({type:"cell-inner",context:{cellType:"input-cell",col:this._elementRegistry.get(n.id),index:r,inputsLength:i},col:n}),D(1,"div","clause",r===0?this._translate("When"):this._translate("And"),0),a?D(1,"div","input-label",a,0,{title:this._translate("Input label: ")+a}):D(1,"div","input-expression",s.text,0,{title:this._translate("Input expression: ")+s.text}),D(1,"div","input-variable",o&&o.text||this._translate(s.typeRef||""),0,{title:o&&o.text?this._translate("Input values"):this._translate("Input type")})],0,{"data-col-id":n.id,onDblClick:this.onClick,onContextmenu:this.onContextmenu,style:{width:l}})}}let cj=[],Bq=[];(()=>{let t="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let e=0,n=0;e<t.length;e++)(e%2?Bq:cj).push(n=n+t[e])})();function A1e(t){if(t<768)return!1;for(let e=0,n=cj.length;;){let r=e+n>>1;if(t<cj[r])n=r;else if(t>=Bq[r])e=r+1;else return!0;if(e==n)return!1}}function xM(t){return t>=127462&&t<=127487}const bM=8205;function I1e(t,e,n=!0,r=!0){return(n?Fq:D1e)(t,e,r)}function Fq(t,e,n){if(e==t.length)return e;e&&zq(t.charCodeAt(e))&&Hq(t.charCodeAt(e-1))&&e--;let r=XE(t,e);for(e+=wM(r);e<t.length;){let i=XE(t,e);if(r==bM||i==bM||n&&A1e(i))e+=wM(i),r=i;else if(xM(i)){let s=0,o=e-2;for(;o>=0&&xM(XE(t,o));)s++,o-=2;if(s%2==0)break;e+=2}else break}return e}function D1e(t,e,n){for(;e>0;){let r=Fq(t,e-2,n);if(r<e)return r;e--}return 0}function XE(t,e){let n=t.charCodeAt(e);if(!Hq(n)||e+1==t.length)return n;let r=t.charCodeAt(e+1);return zq(r)?(n-55296<<10)+(r-56320)+65536:n}function zq(t){return t>=56320&&t<57344}function Hq(t){return t>=55296&&t<56320}function wM(t){return t<65536?1:2}class ln{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,n,r){[e,n]=nf(this,e,n);let i=[];return this.decompose(0,e,i,2),r.length&&r.decompose(0,r.length,i,3),this.decompose(n,this.length,i,1),_a.from(i,this.length-(n-e)+r.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,n=this.length){[e,n]=nf(this,e,n);let r=[];return this.decompose(e,n,r,0),_a.from(r,n-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let n=this.scanIdentical(e,1),r=this.length-this.scanIdentical(e,-1),i=new yg(this),s=new yg(e);for(let o=n,a=n;;){if(i.next(o),s.next(o),o=0,i.lineBreak!=s.lineBreak||i.done!=s.done||i.value!=s.value)return!1;if(a+=i.value.length,i.done||a>=r)return!0}}iter(e=1){return new yg(this,e)}iterRange(e,n=this.length){return new Uq(this,e,n)}iterLines(e,n){let r;if(e==null)r=this.iter();else{n==null&&(n=this.lines+1);let i=this.line(e).from;r=this.iterRange(i,Math.max(i,n==this.lines+1?this.length:n<=1?0:this.line(n-1).to))}return new Vq(r)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?ln.empty:e.length<=32?new mr(e):_a.from(mr.split(e,[]))}}class mr extends ln{constructor(e,n=$1e(e)){super(),this.text=e,this.length=n}get lines(){return this.text.length}get children(){return null}lineInner(e,n,r,i){for(let s=0;;s++){let o=this.text[s],a=i+o.length;if((n?r:a)>=e)return new M1e(i,a,r,o);i=a+1,r++}}decompose(e,n,r,i){let s=e<=0&&n>=this.length?this:new mr(_M(this.text,e,n),Math.min(n,this.length)-Math.max(0,e));if(i&1){let o=r.pop(),a=Bb(s.text,o.text.slice(),0,s.length);if(a.length<=32)r.push(new mr(a,o.length+s.length));else{let l=a.length>>1;r.push(new mr(a.slice(0,l)),new mr(a.slice(l)))}}else r.push(s)}replace(e,n,r){if(!(r instanceof mr))return super.replace(e,n,r);[e,n]=nf(this,e,n);let i=Bb(this.text,Bb(r.text,_M(this.text,0,e)),n),s=this.length+r.length-(n-e);return i.length<=32?new mr(i,s):_a.from(mr.split(i,[]),s)}sliceString(e,n=this.length,r=`
`){[e,n]=nf(this,e,n);let i="";for(let s=0,o=0;s<=n&&o<this.text.length;o++){let a=this.text[o],l=s+a.length;s>e&&o&&(i+=r),e<l&&n>s&&(i+=a.slice(Math.max(0,e-s),n-s)),s=l+1}return i}flatten(e){for(let n of this.text)e.push(n)}scanIdentical(){return 0}static split(e,n){let r=[],i=-1;for(let s of e)r.push(s),i+=s.length+1,r.length==32&&(n.push(new mr(r,i)),r=[],i=-1);return i>-1&&n.push(new mr(r,i)),n}}class _a extends ln{constructor(e,n){super(),this.children=e,this.length=n,this.lines=0;for(let r of e)this.lines+=r.lines}lineInner(e,n,r,i){for(let s=0;;s++){let o=this.children[s],a=i+o.length,l=r+o.lines-1;if((n?l:a)>=e)return o.lineInner(e,n,r,i);i=a+1,r=l+1}}decompose(e,n,r,i){for(let s=0,o=0;o<=n&&s<this.children.length;s++){let a=this.children[s],l=o+a.length;if(e<=l&&n>=o){let c=i&((o<=e?1:0)|(l>=n?2:0));o>=e&&l<=n&&!c?r.push(a):a.decompose(e-o,n-o,r,c)}o=l+1}}replace(e,n,r){if([e,n]=nf(this,e,n),r.lines<this.lines)for(let i=0,s=0;i<this.children.length;i++){let o=this.children[i],a=s+o.length;if(e>=s&&n<=a){let l=o.replace(e-s,n-s,r),c=this.lines-o.lines+l.lines;if(l.lines<c>>4&&l.lines>c>>6){let d=this.children.slice();return d[i]=l,new _a(d,this.length-(n-e)+r.length)}return super.replace(s,a,l)}s=a+1}return super.replace(e,n,r)}sliceString(e,n=this.length,r=`
`){[e,n]=nf(this,e,n);let i="";for(let s=0,o=0;s<this.children.length&&o<=n;s++){let a=this.children[s],l=o+a.length;o>e&&s&&(i+=r),e<l&&n>o&&(i+=a.sliceString(e-o,n-o,r)),o=l+1}return i}flatten(e){for(let n of this.children)n.flatten(e)}scanIdentical(e,n){if(!(e instanceof _a))return 0;let r=0,[i,s,o,a]=n>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;i+=n,s+=n){if(i==o||s==a)return r;let l=this.children[i],c=e.children[s];if(l!=c)return r+l.scanIdentical(c,n);r+=l.length+1}}static from(e,n=e.reduce((r,i)=>r+i.length+1,-1)){let r=0;for(let f of e)r+=f.lines;if(r<32){let f=[];for(let m of e)m.flatten(f);return new mr(f,n)}let i=Math.max(32,r>>5),s=i<<1,o=i>>1,a=[],l=0,c=-1,d=[];function h(f){let m;if(f.lines>s&&f instanceof _a)for(let g of f.children)h(g);else f.lines>o&&(l>o||!l)?(p(),a.push(f)):f instanceof mr&&l&&(m=d[d.length-1])instanceof mr&&f.lines+m.lines<=32?(l+=f.lines,c+=f.length+1,d[d.length-1]=new mr(m.text.concat(f.text),m.length+1+f.length)):(l+f.lines>i&&p(),l+=f.lines,c+=f.length+1,d.push(f))}function p(){l!=0&&(a.push(d.length==1?d[0]:_a.from(d,c)),c=-1,l=d.length=0)}for(let f of e)h(f);return p(),a.length==1?a[0]:new _a(a,n)}}ln.empty=new mr([""],0);function $1e(t){let e=-1;for(let n of t)e+=n.length+1;return e}function Bb(t,e,n=0,r=1e9){for(let i=0,s=0,o=!0;s<t.length&&i<=r;s++){let a=t[s],l=i+a.length;l>=n&&(l>r&&(a=a.slice(0,r-i)),i<n&&(a=a.slice(n-i)),o?(e[e.length-1]+=a,o=!1):e.push(a)),i=l+1}return e}function _M(t,e,n){return Bb(t,[""],e,n)}class yg{constructor(e,n=1){this.dir=n,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[n>0?1:(e instanceof mr?e.text.length:e.children.length)<<1]}nextInner(e,n){for(this.done=this.lineBreak=!1;;){let r=this.nodes.length-1,i=this.nodes[r],s=this.offsets[r],o=s>>1,a=i instanceof mr?i.text.length:i.children.length;if(o==(n>0?a:0)){if(r==0)return this.done=!0,this.value="",this;n>0&&this.offsets[r-1]++,this.nodes.pop(),this.offsets.pop()}else if((s&1)==(n>0?0:1)){if(this.offsets[r]+=n,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(i instanceof mr){let l=i.text[o+(n<0?-1:0)];if(this.offsets[r]+=n,l.length>Math.max(0,e))return this.value=e==0?l:n>0?l.slice(e):l.slice(0,l.length-e),this;e-=l.length}else{let l=i.children[o+(n<0?-1:0)];e>l.length?(e-=l.length,this.offsets[r]+=n):(n<0&&this.offsets[r]--,this.nodes.push(l),this.offsets.push(n>0?1:(l instanceof mr?l.text.length:l.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class Uq{constructor(e,n,r){this.value="",this.done=!1,this.cursor=new yg(e,n>r?-1:1),this.pos=n>r?e.length:0,this.from=Math.min(n,r),this.to=Math.max(n,r)}nextInner(e,n){if(n<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,n<0?this.pos-this.to:this.from-this.pos);let r=n<0?this.pos-this.from:this.to-this.pos;e>r&&(e=r),r-=e;let{value:i}=this.cursor.next(e);return this.pos+=(i.length+e)*n,this.value=i.length<=r?i:n<0?i.slice(i.length-r):i.slice(0,r),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class Vq{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:n,lineBreak:r,value:i}=this.inner.next(e);return n&&this.afterBreak?(this.value="",this.afterBreak=!1):n?(this.done=!0,this.value=""):r?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=i,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(ln.prototype[Symbol.iterator]=function(){return this.iter()},yg.prototype[Symbol.iterator]=Uq.prototype[Symbol.iterator]=Vq.prototype[Symbol.iterator]=function(){return this});class M1e{constructor(e,n,r,i){this.from=e,this.to=n,this.number=r,this.text=i}get length(){return this.to-this.from}}function nf(t,e,n){return e=Math.max(0,Math.min(t.length,e)),[e,Math.max(e,Math.min(t.length,n))]}function Li(t,e,n=!0,r=!0){return I1e(t,e,n,r)}function L1e(t){return t>=56320&&t<57344}function B1e(t){return t>=55296&&t<56320}function wa(t,e){let n=t.charCodeAt(e);if(!B1e(n)||e+1==t.length)return n;let r=t.charCodeAt(e+1);return L1e(r)?(n-55296<<10)+(r-56320)+65536:n}function qq(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode((t>>10)+55296,(t&1023)+56320))}function Ec(t){return t<65536?1:2}const uj=/\r\n?|\n/;var oi=function(t){return t[t.Simple=0]="Simple",t[t.TrackDel=1]="TrackDel",t[t.TrackBefore=2]="TrackBefore",t[t.TrackAfter=3]="TrackAfter",t}(oi||(oi={}));class bl{constructor(e){this.sections=e}get length(){let e=0;for(let n=0;n<this.sections.length;n+=2)e+=this.sections[n];return e}get newLength(){let e=0;for(let n=0;n<this.sections.length;n+=2){let r=this.sections[n+1];e+=r<0?this.sections[n]:r}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let n=0,r=0,i=0;n<this.sections.length;){let s=this.sections[n++],o=this.sections[n++];o<0?(e(r,i,s),i+=s):i+=o,r+=s}}iterChangedRanges(e,n=!1){dj(this,e,n)}get invertedDesc(){let e=[];for(let n=0;n<this.sections.length;){let r=this.sections[n++],i=this.sections[n++];i<0?e.push(r,i):e.push(i,r)}return new bl(e)}composeDesc(e){return this.empty?e:e.empty?this:Wq(this,e)}mapDesc(e,n=!1){return e.empty?this:hj(this,e,n)}mapPos(e,n=-1,r=oi.Simple){let i=0,s=0;for(let o=0;o<this.sections.length;){let a=this.sections[o++],l=this.sections[o++],c=i+a;if(l<0){if(c>e)return s+(e-i);s+=a}else{if(r!=oi.Simple&&c>=e&&(r==oi.TrackDel&&i<e&&c>e||r==oi.TrackBefore&&i<e||r==oi.TrackAfter&&c>e))return null;if(c>e||c==e&&n<0&&!a)return e==i||n<0?s:s+l;s+=l}i=c}if(e>i)throw new RangeError(`Position ${e} is out of range for changeset of length ${i}`);return s}touchesRange(e,n=e){for(let r=0,i=0;r<this.sections.length&&i<=n;){let s=this.sections[r++],o=this.sections[r++],a=i+s;if(o>=0&&i<=n&&a>=e)return i<e&&a>n?"cover":!0;i=a}return!1}toString(){let e="";for(let n=0;n<this.sections.length;){let r=this.sections[n++],i=this.sections[n++];e+=(e?" ":"")+r+(i>=0?":"+i:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(n=>typeof n!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new bl(e)}static create(e){return new bl(e)}}class qr extends bl{constructor(e,n){super(e),this.inserted=n}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return dj(this,(n,r,i,s,o)=>e=e.replace(i,i+(r-n),o),!1),e}mapDesc(e,n=!1){return hj(this,e,n,!0)}invert(e){let n=this.sections.slice(),r=[];for(let i=0,s=0;i<n.length;i+=2){let o=n[i],a=n[i+1];if(a>=0){n[i]=a,n[i+1]=o;let l=i>>1;for(;r.length<l;)r.push(ln.empty);r.push(o?e.slice(s,s+o):ln.empty)}s+=o}return new qr(n,r)}compose(e){return this.empty?e:e.empty?this:Wq(this,e,!0)}map(e,n=!1){return e.empty?this:hj(this,e,n,!0)}iterChanges(e,n=!1){dj(this,e,n)}get desc(){return bl.create(this.sections)}filter(e){let n=[],r=[],i=[],s=new Yg(this);e:for(let o=0,a=0;;){let l=o==e.length?1e9:e[o++];for(;a<l||a==l&&s.len==0;){if(s.done)break e;let d=Math.min(s.len,l-a);xi(i,d,-1);let h=s.ins==-1?-1:s.off==0?s.ins:0;xi(n,d,h),h>0&&Rc(r,n,s.text),s.forward(d),a+=d}let c=e[o++];for(;a<c;){if(s.done)break e;let d=Math.min(s.len,c-a);xi(n,d,-1),xi(i,d,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(d),a+=d}}return{changes:new qr(n,r),filtered:bl.create(i)}}toJSON(){let e=[];for(let n=0;n<this.sections.length;n+=2){let r=this.sections[n],i=this.sections[n+1];i<0?e.push(r):i==0?e.push([r]):e.push([r].concat(this.inserted[n>>1].toJSON()))}return e}static of(e,n,r){let i=[],s=[],o=0,a=null;function l(d=!1){if(!d&&!i.length)return;o<n&&xi(i,n-o,-1);let h=new qr(i,s);a=a?a.compose(h.map(a)):h,i=[],s=[],o=0}function c(d){if(Array.isArray(d))for(let h of d)c(h);else if(d instanceof qr){if(d.length!=n)throw new RangeError(`Mismatched change set length (got ${d.length}, expected ${n})`);l(),a=a?a.compose(d.map(a)):d}else{let{from:h,to:p=h,insert:f}=d;if(h>p||h<0||p>n)throw new RangeError(`Invalid change range ${h} to ${p} (in doc of length ${n})`);let m=f?typeof f=="string"?ln.of(f.split(r||uj)):f:ln.empty,g=m.length;if(h==p&&g==0)return;h<o&&l(),h>o&&xi(i,h-o,-1),xi(i,p-h,g),Rc(s,i,m),o=p}}return c(e),l(!a),a}static empty(e){return new qr(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let n=[],r=[];for(let i=0;i<e.length;i++){let s=e[i];if(typeof s=="number")n.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((o,a)=>a&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)n.push(s[0],0);else{for(;r.length<i;)r.push(ln.empty);r[i]=ln.of(s.slice(1)),n.push(s[0],r[i].length)}}}return new qr(n,r)}static createSet(e,n){return new qr(e,n)}}function xi(t,e,n,r=!1){if(e==0&&n<=0)return;let i=t.length-2;i>=0&&n<=0&&n==t[i+1]?t[i]+=e:i>=0&&e==0&&t[i]==0?t[i+1]+=n:r?(t[i]+=e,t[i+1]+=n):t.push(e,n)}function Rc(t,e,n){if(n.length==0)return;let r=e.length-2>>1;if(r<t.length)t[t.length-1]=t[t.length-1].append(n);else{for(;t.length<r;)t.push(ln.empty);t.push(n)}}function dj(t,e,n){let r=t.inserted;for(let i=0,s=0,o=0;o<t.sections.length;){let a=t.sections[o++],l=t.sections[o++];if(l<0)i+=a,s+=a;else{let c=i,d=s,h=ln.empty;for(;c+=a,d+=l,l&&r&&(h=h.append(r[o-2>>1])),!(n||o==t.sections.length||t.sections[o+1]<0);)a=t.sections[o++],l=t.sections[o++];e(i,c,s,d,h),i=c,s=d}}}function hj(t,e,n,r=!1){let i=[],s=r?[]:null,o=new Yg(t),a=new Yg(e);for(let l=-1;;){if(o.done&&a.len||a.done&&o.len)throw new Error("Mismatched change set lengths");if(o.ins==-1&&a.ins==-1){let c=Math.min(o.len,a.len);xi(i,c,-1),o.forward(c),a.forward(c)}else if(a.ins>=0&&(o.ins<0||l==o.i||o.off==0&&(a.len<o.len||a.len==o.len&&!n))){let c=a.len;for(xi(i,a.ins,-1);c;){let d=Math.min(o.len,c);o.ins>=0&&l<o.i&&o.len<=d&&(xi(i,0,o.ins),s&&Rc(s,i,o.text),l=o.i),o.forward(d),c-=d}a.next()}else if(o.ins>=0){let c=0,d=o.len;for(;d;)if(a.ins==-1){let h=Math.min(d,a.len);c+=h,d-=h,a.forward(h)}else if(a.ins==0&&a.len<d)d-=a.len,a.next();else break;xi(i,c,l<o.i?o.ins:0),s&&l<o.i&&Rc(s,i,o.text),l=o.i,o.forward(o.len-d)}else{if(o.done&&a.done)return s?qr.createSet(i,s):bl.create(i);throw new Error("Mismatched change set lengths")}}}function Wq(t,e,n=!1){let r=[],i=n?[]:null,s=new Yg(t),o=new Yg(e);for(let a=!1;;){if(s.done&&o.done)return i?qr.createSet(r,i):bl.create(r);if(s.ins==0)xi(r,s.len,0,a),s.next();else if(o.len==0&&!o.done)xi(r,0,o.ins,a),i&&Rc(i,r,o.text),o.next();else{if(s.done||o.done)throw new Error("Mismatched change set lengths");{let l=Math.min(s.len2,o.len),c=r.length;if(s.ins==-1){let d=o.ins==-1?-1:o.off?0:o.ins;xi(r,l,d,a),i&&d&&Rc(i,r,o.text)}else o.ins==-1?(xi(r,s.off?0:s.len,l,a),i&&Rc(i,r,s.textBit(l))):(xi(r,s.off?0:s.len,o.off?0:o.ins,a),i&&!o.off&&Rc(i,r,o.text));a=(s.ins>l||o.ins>=0&&o.len>l)&&(a||r.length>c),s.forward2(l),o.forward(l)}}}}class Yg{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,n=this.i-2>>1;return n>=e.length?ln.empty:e[n]}textBit(e){let{inserted:n}=this.set,r=this.i-2>>1;return r>=n.length&&!e?ln.empty:n[r].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class ud{constructor(e,n,r){this.from=e,this.to=n,this.flags=r}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,n=-1){let r,i;return this.empty?r=i=e.mapPos(this.from,n):(r=e.mapPos(this.from,1),i=e.mapPos(this.to,-1)),r==this.from&&i==this.to?this:new ud(r,i,this.flags)}extend(e,n=e){if(e<=this.anchor&&n>=this.anchor)return ue.range(e,n);let r=Math.abs(e-this.anchor)>Math.abs(n-this.anchor)?e:n;return ue.range(this.anchor,r)}eq(e,n=!1){return this.anchor==e.anchor&&this.head==e.head&&(!n||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return ue.range(e.anchor,e.head)}static create(e,n,r){return new ud(e,n,r)}}class ue{constructor(e,n){this.ranges=e,this.mainIndex=n}map(e,n=-1){return e.empty?this:ue.create(this.ranges.map(r=>r.map(e,n)),this.mainIndex)}eq(e,n=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let r=0;r<this.ranges.length;r++)if(!this.ranges[r].eq(e.ranges[r],n))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new ue([this.main],0)}addRange(e,n=!0){return ue.create([e].concat(this.ranges),n?0:this.mainIndex+1)}replaceRange(e,n=this.mainIndex){let r=this.ranges.slice();return r[n]=e,ue.create(r,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new ue(e.ranges.map(n=>ud.fromJSON(n)),e.main)}static single(e,n=e){return new ue([ue.range(e,n)],0)}static create(e,n=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let r=0,i=0;i<e.length;i++){let s=e[i];if(s.empty?s.from<=r:s.from<r)return ue.normalized(e.slice(),n);r=s.to}return new ue(e,n)}static cursor(e,n=0,r,i){return ud.create(e,e,(n==0?0:n<0?8:16)|(r==null?7:Math.min(6,r))|(i??16777215)<<6)}static range(e,n,r,i){let s=(r??16777215)<<6|(i==null?7:Math.min(6,i));return n<e?ud.create(n,e,48|s):ud.create(e,n,(n>e?8:0)|s)}static normalized(e,n=0){let r=e[n];e.sort((i,s)=>i.from-s.from),n=e.indexOf(r);for(let i=1;i<e.length;i++){let s=e[i],o=e[i-1];if(s.empty?s.from<=o.to:s.from<o.to){let a=o.from,l=Math.max(s.to,o.to);i<=n&&n--,e.splice(--i,2,s.anchor>s.head?ue.range(l,a):ue.range(a,l))}}return new ue(e,n)}}function Gq(t,e){for(let n of t.ranges)if(n.to>e)throw new RangeError("Selection points outside of document")}let lN=0;class it{constructor(e,n,r,i,s){this.combine=e,this.compareInput=n,this.compare=r,this.isStatic=i,this.id=lN++,this.default=e([]),this.extensions=typeof s=="function"?s(this):s}get reader(){return this}static define(e={}){return new it(e.combine||(n=>n),e.compareInput||((n,r)=>n===r),e.compare||(e.combine?(n,r)=>n===r:cN),!!e.static,e.enables)}of(e){return new Fb([],this,0,e)}compute(e,n){if(this.isStatic)throw new Error("Can't compute a static facet");return new Fb(e,this,1,n)}computeN(e,n){if(this.isStatic)throw new Error("Can't compute a static facet");return new Fb(e,this,2,n)}from(e,n){return n||(n=r=>r),this.compute([e],r=>n(r.field(e)))}}function cN(t,e){return t==e||t.length==e.length&&t.every((n,r)=>n===e[r])}class Fb{constructor(e,n,r,i){this.dependencies=e,this.facet=n,this.type=r,this.value=i,this.id=lN++}dynamicSlot(e){var n;let r=this.value,i=this.facet.compareInput,s=this.id,o=e[s]>>1,a=this.type==2,l=!1,c=!1,d=[];for(let h of this.dependencies)h=="doc"?l=!0:h=="selection"?c=!0:((n=e[h.id])!==null&&n!==void 0?n:1)&1||d.push(e[h.id]);return{create(h){return h.values[o]=r(h),1},update(h,p){if(l&&p.docChanged||c&&(p.docChanged||p.selection)||pj(h,d)){let f=r(h);if(a?!EM(f,h.values[o],i):!i(f,h.values[o]))return h.values[o]=f,1}return 0},reconfigure:(h,p)=>{let f,m=p.config.address[s];if(m!=null){let g=M0(p,m);if(this.dependencies.every(v=>v instanceof it?p.facet(v)===h.facet(v):v instanceof Is?p.field(v,!1)==h.field(v,!1):!0)||(a?EM(f=r(h),g,i):i(f=r(h),g)))return h.values[o]=g,0}else f=r(h);return h.values[o]=f,1}}}}function EM(t,e,n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!n(t[r],e[r]))return!1;return!0}function pj(t,e){let n=!1;for(let r of e)xg(t,r)&1&&(n=!0);return n}function F1e(t,e,n){let r=n.map(l=>t[l.id]),i=n.map(l=>l.type),s=r.filter(l=>!(l&1)),o=t[e.id]>>1;function a(l){let c=[];for(let d=0;d<r.length;d++){let h=M0(l,r[d]);if(i[d]==2)for(let p of h)c.push(p);else c.push(h)}return e.combine(c)}return{create(l){for(let c of r)xg(l,c);return l.values[o]=a(l),1},update(l,c){if(!pj(l,s))return 0;let d=a(l);return e.compare(d,l.values[o])?0:(l.values[o]=d,1)},reconfigure(l,c){let d=pj(l,r),h=c.config.facets[e.id],p=c.facet(e);if(h&&!d&&cN(n,h))return l.values[o]=p,0;let f=a(l);return e.compare(f,p)?(l.values[o]=p,0):(l.values[o]=f,1)}}}const Ax=it.define({static:!0});class Is{constructor(e,n,r,i,s){this.id=e,this.createF=n,this.updateF=r,this.compareF=i,this.spec=s,this.provides=void 0}static define(e){let n=new Is(lN++,e.create,e.update,e.compare||((r,i)=>r===i),e);return e.provide&&(n.provides=e.provide(n)),n}create(e){let n=e.facet(Ax).find(r=>r.field==this);return((n==null?void 0:n.create)||this.createF)(e)}slot(e){let n=e[this.id]>>1;return{create:r=>(r.values[n]=this.create(r),1),update:(r,i)=>{let s=r.values[n],o=this.updateF(s,i);return this.compareF(s,o)?0:(r.values[n]=o,1)},reconfigure:(r,i)=>{let s=r.facet(Ax),o=i.facet(Ax),a;return(a=s.find(l=>l.field==this))&&a!=o.find(l=>l.field==this)?(r.values[n]=a.create(r),1):i.config.address[this.id]!=null?(r.values[n]=i.field(this),0):(r.values[n]=this.create(r),1)}}}init(e){return[this,Ax.of({field:this,create:e})]}get extension(){return this}}const nd={lowest:4,low:3,default:2,high:1,highest:0};function Im(t){return e=>new Kq(e,t)}const Kf={highest:Im(nd.highest),high:Im(nd.high),default:Im(nd.default),low:Im(nd.low),lowest:Im(nd.lowest)};class Kq{constructor(e,n){this.inner=e,this.prec=n}}class Yf{of(e){return new fj(this,e)}reconfigure(e){return Yf.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class fj{constructor(e,n){this.compartment=e,this.inner=n}}class $0{constructor(e,n,r,i,s,o){for(this.base=e,this.compartments=n,this.dynamicSlots=r,this.address=i,this.staticValues=s,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<r.length;)this.statusTemplate.push(0)}staticFacet(e){let n=this.address[e.id];return n==null?e.default:this.staticValues[n>>1]}static resolve(e,n,r){let i=[],s=Object.create(null),o=new Map;for(let p of z1e(e,n,o))p instanceof Is?i.push(p):(s[p.facet.id]||(s[p.facet.id]=[])).push(p);let a=Object.create(null),l=[],c=[];for(let p of i)a[p.id]=c.length<<1,c.push(f=>p.slot(f));let d=r==null?void 0:r.config.facets;for(let p in s){let f=s[p],m=f[0].facet,g=d&&d[p]||[];if(f.every(v=>v.type==0))if(a[m.id]=l.length<<1|1,cN(g,f))l.push(r.facet(m));else{let v=m.combine(f.map(b=>b.value));l.push(r&&m.compare(v,r.facet(m))?r.facet(m):v)}else{for(let v of f)v.type==0?(a[v.id]=l.length<<1|1,l.push(v.value)):(a[v.id]=c.length<<1,c.push(b=>v.dynamicSlot(b)));a[m.id]=c.length<<1,c.push(v=>F1e(v,m,f))}}let h=c.map(p=>p(a));return new $0(e,o,h,a,l,s)}}function z1e(t,e,n){let r=[[],[],[],[],[]],i=new Map;function s(o,a){let l=i.get(o);if(l!=null){if(l<=a)return;let c=r[l].indexOf(o);c>-1&&r[l].splice(c,1),o instanceof fj&&n.delete(o.compartment)}if(i.set(o,a),Array.isArray(o))for(let c of o)s(c,a);else if(o instanceof fj){if(n.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let c=e.get(o.compartment)||o.inner;n.set(o.compartment,c),s(c,a)}else if(o instanceof Kq)s(o.inner,o.prec);else if(o instanceof Is)r[a].push(o),o.provides&&s(o.provides,a);else if(o instanceof Fb)r[a].push(o),o.facet.extensions&&s(o.facet.extensions,nd.default);else{let c=o.extension;if(!c)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(c,a)}}return s(t,nd.default),r.reduce((o,a)=>o.concat(a))}function xg(t,e){if(e&1)return 2;let n=e>>1,r=t.status[n];if(r==4)throw new Error("Cyclic dependency between fields and/or facets");if(r&2)return r;t.status[n]=4;let i=t.computeSlot(t,t.config.dynamicSlots[n]);return t.status[n]=2|i}function M0(t,e){return e&1?t.config.staticValues[e>>1]:t.values[e>>1]}const Yq=it.define(),mj=it.define({combine:t=>t.some(e=>e),static:!0}),Xq=it.define({combine:t=>t.length?t[0]:void 0,static:!0}),Qq=it.define(),Zq=it.define(),Jq=it.define(),e9=it.define({combine:t=>t.length?t[0]:!1});class ph{constructor(e,n){this.type=e,this.value=n}static define(){return new H1e}}class H1e{of(e){return new ph(this,e)}}class U1e{constructor(e){this.map=e}of(e){return new dn(this,e)}}class dn{constructor(e,n){this.type=e,this.value=n}map(e){let n=this.type.map(this.value,e);return n===void 0?void 0:n==this.value?this:new dn(this.type,n)}is(e){return this.type==e}static define(e={}){return new U1e(e.map||(n=>n))}static mapEffects(e,n){if(!e.length)return e;let r=[];for(let i of e){let s=i.map(n);s&&r.push(s)}return r}}dn.reconfigure=dn.define();dn.appendConfig=dn.define();class ai{constructor(e,n,r,i,s,o){this.startState=e,this.changes=n,this.selection=r,this.effects=i,this.annotations=s,this.scrollIntoView=o,this._doc=null,this._state=null,r&&Gq(r,n.newLength),s.some(a=>a.type==ai.time)||(this.annotations=s.concat(ai.time.of(Date.now())))}static create(e,n,r,i,s,o){return new ai(e,n,r,i,s,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let n of this.annotations)if(n.type==e)return n.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let n=this.annotation(ai.userEvent);return!!(n&&(n==e||n.length>e.length&&n.slice(0,e.length)==e&&n[e.length]=="."))}}ai.time=ph.define();ai.userEvent=ph.define();ai.addToHistory=ph.define();ai.remote=ph.define();function V1e(t,e){let n=[];for(let r=0,i=0;;){let s,o;if(r<t.length&&(i==e.length||e[i]>=t[r]))s=t[r++],o=t[r++];else if(i<e.length)s=e[i++],o=e[i++];else return n;!n.length||n[n.length-1]<s?n.push(s,o):n[n.length-1]<o&&(n[n.length-1]=o)}}function t9(t,e,n){var r;let i,s,o;return n?(i=e.changes,s=qr.empty(e.changes.length),o=t.changes.compose(e.changes)):(i=e.changes.map(t.changes),s=t.changes.mapDesc(e.changes,!0),o=t.changes.compose(i)),{changes:o,selection:e.selection?e.selection.map(s):(r=t.selection)===null||r===void 0?void 0:r.map(i),effects:dn.mapEffects(t.effects,i).concat(dn.mapEffects(e.effects,s)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function gj(t,e,n){let r=e.selection,i=bp(e.annotations);return e.userEvent&&(i=i.concat(ai.userEvent.of(e.userEvent))),{changes:e.changes instanceof qr?e.changes:qr.of(e.changes||[],n,t.facet(Xq)),selection:r&&(r instanceof ue?r:ue.single(r.anchor,r.head)),effects:bp(e.effects),annotations:i,scrollIntoView:!!e.scrollIntoView}}function n9(t,e,n){let r=gj(t,e.length?e[0]:{},t.doc.length);e.length&&e[0].filter===!1&&(n=!1);for(let s=1;s<e.length;s++){e[s].filter===!1&&(n=!1);let o=!!e[s].sequential;r=t9(r,gj(t,e[s],o?r.changes.newLength:t.doc.length),o)}let i=ai.create(t,r.changes,r.selection,r.effects,r.annotations,r.scrollIntoView);return W1e(n?q1e(i):i)}function q1e(t){let e=t.startState,n=!0;for(let i of e.facet(Qq)){let s=i(t);if(s===!1){n=!1;break}Array.isArray(s)&&(n=n===!0?s:V1e(n,s))}if(n!==!0){let i,s;if(n===!1)s=t.changes.invertedDesc,i=qr.empty(e.doc.length);else{let o=t.changes.filter(n);i=o.changes,s=o.filtered.mapDesc(o.changes).invertedDesc}t=ai.create(e,i,t.selection&&t.selection.map(s),dn.mapEffects(t.effects,s),t.annotations,t.scrollIntoView)}let r=e.facet(Zq);for(let i=r.length-1;i>=0;i--){let s=r[i](t);s instanceof ai?t=s:Array.isArray(s)&&s.length==1&&s[0]instanceof ai?t=s[0]:t=n9(e,bp(s),!1)}return t}function W1e(t){let e=t.startState,n=e.facet(Jq),r=t;for(let i=n.length-1;i>=0;i--){let s=n[i](t);s&&Object.keys(s).length&&(r=t9(r,gj(e,s,t.changes.newLength),!0))}return r==t?t:ai.create(e,t.changes,t.selection,r.effects,r.annotations,r.scrollIntoView)}const G1e=[];function bp(t){return t==null?G1e:Array.isArray(t)?t:[t]}var Xs=function(t){return t[t.Word=0]="Word",t[t.Space=1]="Space",t[t.Other=2]="Other",t}(Xs||(Xs={}));const K1e=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let vj;try{vj=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function Y1e(t){if(vj)return vj.test(t);for(let e=0;e<t.length;e++){let n=t[e];if(/\w/.test(n)||n>""&&(n.toUpperCase()!=n.toLowerCase()||K1e.test(n)))return!0}return!1}function X1e(t){return e=>{if(!/\S/.test(e))return Xs.Space;if(Y1e(e))return Xs.Word;for(let n=0;n<t.length;n++)if(e.indexOf(t[n])>-1)return Xs.Word;return Xs.Other}}class gn{constructor(e,n,r,i,s,o){this.config=e,this.doc=n,this.selection=r,this.values=i,this.status=e.statusTemplate.slice(),this.computeSlot=s,o&&(o._state=this);for(let a=0;a<this.config.dynamicSlots.length;a++)xg(this,a<<1);this.computeSlot=null}field(e,n=!0){let r=this.config.address[e.id];if(r==null){if(n)throw new RangeError("Field is not present in this state");return}return xg(this,r),M0(this,r)}update(...e){return n9(this,e,!0)}applyTransaction(e){let n=this.config,{base:r,compartments:i}=n;for(let a of e.effects)a.is(Yf.reconfigure)?(n&&(i=new Map,n.compartments.forEach((l,c)=>i.set(c,l)),n=null),i.set(a.value.compartment,a.value.extension)):a.is(dn.reconfigure)?(n=null,r=a.value):a.is(dn.appendConfig)&&(n=null,r=bp(r).concat(a.value));let s;n?s=e.startState.values.slice():(n=$0.resolve(r,i,this),s=new gn(n,this.doc,this.selection,n.dynamicSlots.map(()=>null),(l,c)=>c.reconfigure(l,this),null).values);let o=e.startState.facet(mj)?e.newSelection:e.newSelection.asSingle();new gn(n,e.newDoc,o,s,(a,l)=>l.update(a,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:e},range:ue.cursor(n.from+e.length)}))}changeByRange(e){let n=this.selection,r=e(n.ranges[0]),i=this.changes(r.changes),s=[r.range],o=bp(r.effects);for(let a=1;a<n.ranges.length;a++){let l=e(n.ranges[a]),c=this.changes(l.changes),d=c.map(i);for(let p=0;p<a;p++)s[p]=s[p].map(d);let h=i.mapDesc(c,!0);s.push(l.range.map(h)),i=i.compose(d),o=dn.mapEffects(o,d).concat(dn.mapEffects(bp(l.effects),h))}return{changes:i,selection:ue.create(s,n.mainIndex),effects:o}}changes(e=[]){return e instanceof qr?e:qr.of(e,this.doc.length,this.facet(gn.lineSeparator))}toText(e){return ln.of(e.split(this.facet(gn.lineSeparator)||uj))}sliceDoc(e=0,n=this.doc.length){return this.doc.sliceString(e,n,this.lineBreak)}facet(e){let n=this.config.address[e.id];return n==null?e.default:(xg(this,n),M0(this,n))}toJSON(e){let n={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let r in e){let i=e[r];i instanceof Is&&this.config.address[i.id]!=null&&(n[r]=i.spec.toJSON(this.field(e[r]),this))}return n}static fromJSON(e,n={},r){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let i=[];if(r){for(let s in r)if(Object.prototype.hasOwnProperty.call(e,s)){let o=r[s],a=e[s];i.push(o.init(l=>o.spec.fromJSON(a,l)))}}return gn.create({doc:e.doc,selection:ue.fromJSON(e.selection),extensions:n.extensions?i.concat([n.extensions]):i})}static create(e={}){let n=$0.resolve(e.extensions||[],new Map),r=e.doc instanceof ln?e.doc:ln.of((e.doc||"").split(n.staticFacet(gn.lineSeparator)||uj)),i=e.selection?e.selection instanceof ue?e.selection:ue.single(e.selection.anchor,e.selection.head):ue.single(0);return Gq(i,r.length),n.staticFacet(mj)||(i=i.asSingle()),new gn(n,r,i,n.dynamicSlots.map(()=>null),(s,o)=>o.create(s),null)}get tabSize(){return this.facet(gn.tabSize)}get lineBreak(){return this.facet(gn.lineSeparator)||`
`}get readOnly(){return this.facet(e9)}phrase(e,...n){for(let r of this.facet(gn.phrases))if(Object.prototype.hasOwnProperty.call(r,e)){e=r[e];break}return n.length&&(e=e.replace(/\$(\$|\d*)/g,(r,i)=>{if(i=="$")return"$";let s=+(i||1);return!s||s>n.length?r:n[s-1]})),e}languageDataAt(e,n,r=-1){let i=[];for(let s of this.facet(Yq))for(let o of s(this,n,r))Object.prototype.hasOwnProperty.call(o,e)&&i.push(o[e]);return i}charCategorizer(e){return X1e(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:n,from:r,length:i}=this.doc.lineAt(e),s=this.charCategorizer(e),o=e-r,a=e-r;for(;o>0;){let l=Li(n,o,!1);if(s(n.slice(l,o))!=Xs.Word)break;o=l}for(;a<i;){let l=Li(n,a);if(s(n.slice(a,l))!=Xs.Word)break;a=l}return o==a?null:ue.range(o+r,a+r)}}gn.allowMultipleSelections=mj;gn.tabSize=it.define({combine:t=>t.length?t[0]:4});gn.lineSeparator=Xq;gn.readOnly=e9;gn.phrases=it.define({compare(t,e){let n=Object.keys(t),r=Object.keys(e);return n.length==r.length&&n.every(i=>t[i]==e[i])}});gn.languageData=Yq;gn.changeFilter=Qq;gn.transactionFilter=Zq;gn.transactionExtender=Jq;Yf.reconfigure=dn.define();function uN(t,e,n={}){let r={};for(let i of t)for(let s of Object.keys(i)){let o=i[s],a=r[s];if(a===void 0)r[s]=o;else if(!(a===o||o===void 0))if(Object.hasOwnProperty.call(n,s))r[s]=n[s](a,o);else throw new Error("Config merge conflict for field "+s)}for(let i in e)r[i]===void 0&&(r[i]=e[i]);return r}class Dd{eq(e){return this==e}range(e,n=e){return yj.create(e,n,this)}}Dd.prototype.startSide=Dd.prototype.endSide=0;Dd.prototype.point=!1;Dd.prototype.mapMode=oi.TrackDel;let yj=class r9{constructor(e,n,r){this.from=e,this.to=n,this.value=r}static create(e,n,r){return new r9(e,n,r)}};function xj(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}class dN{constructor(e,n,r,i){this.from=e,this.to=n,this.value=r,this.maxPoint=i}get length(){return this.to[this.to.length-1]}findIndex(e,n,r,i=0){let s=r?this.to:this.from;for(let o=i,a=s.length;;){if(o==a)return o;let l=o+a>>1,c=s[l]-e||(r?this.value[l].endSide:this.value[l].startSide)-n;if(l==o)return c>=0?o:a;c>=0?a=l:o=l+1}}between(e,n,r,i){for(let s=this.findIndex(n,-1e9,!0),o=this.findIndex(r,1e9,!1,s);s<o;s++)if(i(this.from[s]+e,this.to[s]+e,this.value[s])===!1)return!1}map(e,n){let r=[],i=[],s=[],o=-1,a=-1;for(let l=0;l<this.value.length;l++){let c=this.value[l],d=this.from[l]+e,h=this.to[l]+e,p,f;if(d==h){let m=n.mapPos(d,c.startSide,c.mapMode);if(m==null||(p=f=m,c.startSide!=c.endSide&&(f=n.mapPos(d,c.endSide),f<p)))continue}else if(p=n.mapPos(d,c.startSide),f=n.mapPos(h,c.endSide),p>f||p==f&&c.startSide>0&&c.endSide<=0)continue;(f-p||c.endSide-c.startSide)<0||(o<0&&(o=p),c.point&&(a=Math.max(a,f-p)),r.push(c),i.push(p-o),s.push(f-o))}return{mapped:r.length?new dN(i,s,r,a):null,pos:o}}}class $n{constructor(e,n,r,i){this.chunkPos=e,this.chunk=n,this.nextLayer=r,this.maxPoint=i}static create(e,n,r,i){return new $n(e,n,r,i)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let n of this.chunk)e+=n.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:n=[],sort:r=!1,filterFrom:i=0,filterTo:s=this.length}=e,o=e.filter;if(n.length==0&&!o)return this;if(r&&(n=n.slice().sort(xj)),this.isEmpty)return n.length?$n.of(n):this;let a=new i9(this,null,-1).goto(0),l=0,c=[],d=new rf;for(;a.value||l<n.length;)if(l<n.length&&(a.from-n[l].from||a.startSide-n[l].value.startSide)>=0){let h=n[l++];d.addInner(h.from,h.to,h.value)||c.push(h)}else a.rangeIndex==1&&a.chunkIndex<this.chunk.length&&(l==n.length||this.chunkEnd(a.chunkIndex)<n[l].from)&&(!o||i>this.chunkEnd(a.chunkIndex)||s<this.chunkPos[a.chunkIndex])&&d.addChunk(this.chunkPos[a.chunkIndex],this.chunk[a.chunkIndex])?a.nextChunk():((!o||i>a.to||s<a.from||o(a.from,a.to,a.value))&&(d.addInner(a.from,a.to,a.value)||c.push(yj.create(a.from,a.to,a.value))),a.next());return d.finishInner(this.nextLayer.isEmpty&&!c.length?$n.empty:this.nextLayer.update({add:c,filter:o,filterFrom:i,filterTo:s}))}map(e){if(e.empty||this.isEmpty)return this;let n=[],r=[],i=-1;for(let o=0;o<this.chunk.length;o++){let a=this.chunkPos[o],l=this.chunk[o],c=e.touchesRange(a,a+l.length);if(c===!1)i=Math.max(i,l.maxPoint),n.push(l),r.push(e.mapPos(a));else if(c===!0){let{mapped:d,pos:h}=l.map(a,e);d&&(i=Math.max(i,d.maxPoint),n.push(d),r.push(h))}}let s=this.nextLayer.map(e);return n.length==0?s:new $n(r,n,s||$n.empty,i)}between(e,n,r){if(!this.isEmpty){for(let i=0;i<this.chunk.length;i++){let s=this.chunkPos[i],o=this.chunk[i];if(n>=s&&e<=s+o.length&&o.between(s,e-s,n-s,r)===!1)return}this.nextLayer.between(e,n,r)}}iter(e=0){return Xg.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,n=0){return Xg.from(e).goto(n)}static compare(e,n,r,i,s=-1){let o=e.filter(h=>h.maxPoint>0||!h.isEmpty&&h.maxPoint>=s),a=n.filter(h=>h.maxPoint>0||!h.isEmpty&&h.maxPoint>=s),l=SM(o,a,r),c=new Dm(o,l,s),d=new Dm(a,l,s);r.iterGaps((h,p,f)=>CM(c,h,d,p,f,i)),r.empty&&r.length==0&&CM(c,0,d,0,0,i)}static eq(e,n,r=0,i){i==null&&(i=999999999);let s=e.filter(d=>!d.isEmpty&&n.indexOf(d)<0),o=n.filter(d=>!d.isEmpty&&e.indexOf(d)<0);if(s.length!=o.length)return!1;if(!s.length)return!0;let a=SM(s,o),l=new Dm(s,a,0).goto(r),c=new Dm(o,a,0).goto(r);for(;;){if(l.to!=c.to||!bj(l.active,c.active)||l.point&&(!c.point||!l.point.eq(c.point)))return!1;if(l.to>i)return!0;l.next(),c.next()}}static spans(e,n,r,i,s=-1){let o=new Dm(e,null,s).goto(n),a=n,l=o.openStart;for(;;){let c=Math.min(o.to,r);if(o.point){let d=o.activeForPoint(o.to),h=o.pointFrom<n?d.length+1:o.point.startSide<0?d.length:Math.min(d.length,l);i.point(a,c,o.point,d,h,o.pointRank),l=Math.min(o.openEnd(c),d.length)}else c>a&&(i.span(a,c,o.active,l),l=o.openEnd(c));if(o.to>r)return l+(o.point&&o.to>r?1:0);a=o.to,o.next()}}static of(e,n=!1){let r=new rf;for(let i of e instanceof yj?[e]:n?Q1e(e):e)r.add(i.from,i.to,i.value);return r.finish()}static join(e){if(!e.length)return $n.empty;let n=e[e.length-1];for(let r=e.length-2;r>=0;r--)for(let i=e[r];i!=$n.empty;i=i.nextLayer)n=new $n(i.chunkPos,i.chunk,n,Math.max(i.maxPoint,n.maxPoint));return n}}$n.empty=new $n([],[],null,-1);function Q1e(t){if(t.length>1)for(let e=t[0],n=1;n<t.length;n++){let r=t[n];if(xj(e,r)>0)return t.slice().sort(xj);e=r}return t}$n.empty.nextLayer=$n.empty;class rf{finishChunk(e){this.chunks.push(new dN(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,n,r){this.addInner(e,n,r)||(this.nextLayer||(this.nextLayer=new rf)).add(e,n,r)}addInner(e,n,r){let i=e-this.lastTo||r.startSide-this.last.endSide;if(i<=0&&(e-this.lastFrom||r.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return i<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(n-this.chunkStart),this.last=r,this.lastFrom=e,this.lastTo=n,this.value.push(r),r.point&&(this.maxPoint=Math.max(this.maxPoint,n-e)),!0)}addChunk(e,n){if((e-this.lastTo||n.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,n.maxPoint),this.chunks.push(n),this.chunkPos.push(e);let r=n.value.length-1;return this.last=n.value[r],this.lastFrom=n.from[r]+e,this.lastTo=n.to[r]+e,!0}finish(){return this.finishInner($n.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let n=$n.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,n}}function SM(t,e,n){let r=new Map;for(let s of t)for(let o=0;o<s.chunk.length;o++)s.chunk[o].maxPoint<=0&&r.set(s.chunk[o],s.chunkPos[o]);let i=new Set;for(let s of e)for(let o=0;o<s.chunk.length;o++){let a=r.get(s.chunk[o]);a!=null&&(n?n.mapPos(a):a)==s.chunkPos[o]&&!(n!=null&&n.touchesRange(a,a+s.chunk[o].length))&&i.add(s.chunk[o])}return i}class i9{constructor(e,n,r,i=0){this.layer=e,this.skip=n,this.minPoint=r,this.rank=i}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,n=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,n,!1),this}gotoInner(e,n,r){for(;this.chunkIndex<this.layer.chunk.length;){let i=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(i)||this.layer.chunkEnd(this.chunkIndex)<e||i.maxPoint<this.minPoint))break;this.chunkIndex++,r=!1}if(this.chunkIndex<this.layer.chunk.length){let i=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],n,!0);(!r||this.rangeIndex<i)&&this.setRangeIndex(i)}this.next()}forward(e,n){(this.to-e||this.endSide-n)<0&&this.gotoInner(e,n,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],n=this.layer.chunk[this.chunkIndex],r=e+n.from[this.rangeIndex];if(this.from=r,this.to=e+n.to[this.rangeIndex],this.value=n.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class Xg{constructor(e){this.heap=e}static from(e,n=null,r=-1){let i=[];for(let s=0;s<e.length;s++)for(let o=e[s];!o.isEmpty;o=o.nextLayer)o.maxPoint>=r&&i.push(new i9(o,n,r,s));return i.length==1?i[0]:new Xg(i)}get startSide(){return this.value?this.value.startSide:0}goto(e,n=-1e9){for(let r of this.heap)r.goto(e,n);for(let r=this.heap.length>>1;r>=0;r--)QE(this.heap,r);return this.next(),this}forward(e,n){for(let r of this.heap)r.forward(e,n);for(let r=this.heap.length>>1;r>=0;r--)QE(this.heap,r);(this.to-e||this.value.endSide-n)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),QE(this.heap,0)}}}function QE(t,e){for(let n=t[e];;){let r=(e<<1)+1;if(r>=t.length)break;let i=t[r];if(r+1<t.length&&i.compare(t[r+1])>=0&&(i=t[r+1],r++),n.compare(i)<0)break;t[r]=n,t[e]=i,e=r}}class Dm{constructor(e,n,r){this.minPoint=r,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Xg.from(e,n,r)}goto(e,n=-1e9){return this.cursor.goto(e,n),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=n,this.openStart=-1,this.next(),this}forward(e,n){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-n)<0;)this.removeActive(this.minActive);this.cursor.forward(e,n)}removeActive(e){Ix(this.active,e),Ix(this.activeTo,e),Ix(this.activeRank,e),this.minActive=jM(this.active,this.activeTo)}addActive(e){let n=0,{value:r,to:i,rank:s}=this.cursor;for(;n<this.activeRank.length&&(s-this.activeRank[n]||i-this.activeTo[n])>0;)n++;Dx(this.active,n,r),Dx(this.activeTo,n,i),Dx(this.activeRank,n,s),e&&Dx(e,n,this.cursor.from),this.minActive=jM(this.active,this.activeTo)}next(){let e=this.to,n=this.point;this.point=null;let r=this.openStart<0?[]:null;for(;;){let i=this.minActive;if(i>-1&&(this.activeTo[i]-this.cursor.from||this.active[i].endSide-this.cursor.startSide)<0){if(this.activeTo[i]>e){this.to=this.activeTo[i],this.endSide=this.active[i].endSide;break}this.removeActive(i),r&&Ix(r,i)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let s=this.cursor.value;if(!s.point)this.addActive(r),this.cursor.next();else if(n&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=s,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=s.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(r){this.openStart=0;for(let i=r.length-1;i>=0&&r[i]<e;i--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let n=[];for(let r=this.active.length-1;r>=0&&!(this.activeRank[r]<this.pointRank);r--)(this.activeTo[r]>e||this.activeTo[r]==e&&this.active[r].endSide>=this.point.endSide)&&n.push(this.active[r]);return n.reverse()}openEnd(e){let n=0;for(let r=this.activeTo.length-1;r>=0&&this.activeTo[r]>e;r--)n++;return n}}function CM(t,e,n,r,i,s){t.goto(e),n.goto(r);let o=r+i,a=r,l=r-e;for(;;){let c=t.to+l-n.to,d=c||t.endSide-n.endSide,h=d<0?t.to+l:n.to,p=Math.min(h,o);if(t.point||n.point?t.point&&n.point&&(t.point==n.point||t.point.eq(n.point))&&bj(t.activeForPoint(t.to),n.activeForPoint(n.to))||s.comparePoint(a,p,t.point,n.point):p>a&&!bj(t.active,n.active)&&s.compareRange(a,p,t.active,n.active),h>o)break;(c||t.openEnd!=n.openEnd)&&s.boundChange&&s.boundChange(h),a=h,d<=0&&t.next(),d>=0&&n.next()}}function bj(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!=e[n]&&!t[n].eq(e[n]))return!1;return!0}function Ix(t,e){for(let n=e,r=t.length-1;n<r;n++)t[n]=t[n+1];t.pop()}function Dx(t,e,n){for(let r=t.length-1;r>=e;r--)t[r+1]=t[r];t[e]=n}function jM(t,e){let n=-1,r=1e9;for(let i=0;i<e.length;i++)(e[i]-r||t[i].endSide-t[n].endSide)<0&&(n=i,r=e[i]);return n}function r1(t,e,n=t.length){let r=0;for(let i=0;i<n&&i<t.length;)t.charCodeAt(i)==9?(r+=e-r%e,i++):(r++,i=Li(t,i));return r}function Z1e(t,e,n,r){for(let i=0,s=0;;){if(s>=e)return i;if(i==t.length)break;s+=t.charCodeAt(i)==9?n-s%n:1,i=Li(t,i)}return t.length}const wj="",kM=typeof Symbol>"u"?"__"+wj:Symbol.for(wj),_j=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),PM=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class Uc{constructor(e,n){this.rules=[];let{finish:r}=n||{};function i(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function s(o,a,l,c){let d=[],h=/^@(\w+)\b/.exec(o[0]),p=h&&h[1]=="keyframes";if(h&&a==null)return l.push(o[0]+";");for(let f in a){let m=a[f];if(/&/.test(f))s(f.split(/,\s*/).map(g=>o.map(v=>g.replace(/&/,v))).reduce((g,v)=>g.concat(v)),m,l);else if(m&&typeof m=="object"){if(!h)throw new RangeError("The value of a property ("+f+") should be a primitive value.");s(i(f),m,d,p)}else m!=null&&d.push(f.replace(/_.*/,"").replace(/[A-Z]/g,g=>"-"+g.toLowerCase())+": "+m+";")}(d.length||p)&&l.push((r&&!h&&!c?o.map(r):o).join(", ")+" {"+d.join(" ")+"}")}for(let o in e)s(i(o),e[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=PM[kM]||1;return PM[kM]=e+1,wj+e.toString(36)}static mount(e,n,r){let i=e[_j],s=r&&r.nonce;i?s&&i.setNonce(s):i=new J1e(e,s),i.mount(Array.isArray(n)?n:[n],e)}}let TM=new Map;class J1e{constructor(e,n){let r=e.ownerDocument||e,i=r.defaultView;if(!e.head&&e.adoptedStyleSheets&&i.CSSStyleSheet){let s=TM.get(r);if(s)return e[_j]=s;this.sheet=new i.CSSStyleSheet,TM.set(r,this)}else this.styleTag=r.createElement("style"),n&&this.styleTag.setAttribute("nonce",n);this.modules=[],e[_j]=this}mount(e,n){let r=this.sheet,i=0,s=0;for(let o=0;o<e.length;o++){let a=e[o],l=this.modules.indexOf(a);if(l<s&&l>-1&&(this.modules.splice(l,1),s--,l=-1),l==-1){if(this.modules.splice(s++,0,a),r)for(let c=0;c<a.rules.length;c++)r.insertRule(a.rules[c],i++)}else{for(;s<l;)i+=this.modules[s++].rules.length;i+=a.rules.length,s++}}if(r)n.adoptedStyleSheets.indexOf(this.sheet)<0&&(n.adoptedStyleSheets=[this.sheet,...n.adoptedStyleSheets]);else{let o="";for(let l=0;l<this.modules.length;l++)o+=this.modules[l].getRules()+`
`;this.styleTag.textContent=o;let a=n.head||n;this.styleTag.parentNode!=a&&a.insertBefore(this.styleTag,a.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}var Vc={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Qg={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},eEe=typeof navigator<"u"&&/Mac/.test(navigator.platform),tEe=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var si=0;si<10;si++)Vc[48+si]=Vc[96+si]=String(si);for(var si=1;si<=24;si++)Vc[si+111]="F"+si;for(var si=65;si<=90;si++)Vc[si]=String.fromCharCode(si+32),Qg[si]=String.fromCharCode(si);for(var ZE in Vc)Qg.hasOwnProperty(ZE)||(Qg[ZE]=Vc[ZE]);function nEe(t){var e=eEe&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||tEe&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Qg:Vc)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}function Ea(){var t=arguments[0];typeof t=="string"&&(t=document.createElement(t));var e=1,n=arguments[1];if(n&&typeof n=="object"&&n.nodeType==null&&!Array.isArray(n)){for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){var i=n[r];typeof i=="string"?t.setAttribute(r,i):i!=null&&(t[r]=i)}e++}for(;e<arguments.length;e++)s9(t,arguments[e]);return t}function s9(t,e){if(typeof e=="string")t.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)t.appendChild(e);else if(Array.isArray(e))for(var n=0;n<e.length;n++)s9(t,e[n]);else throw new RangeError("Unsupported child node: "+e)}let Ri=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},Ej=typeof document<"u"?document:{documentElement:{style:{}}};const Sj=/Edge\/(\d+)/.exec(Ri.userAgent),o9=/MSIE \d/.test(Ri.userAgent),Cj=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Ri.userAgent),i1=!!(o9||Cj||Sj),NM=!i1&&/gecko\/(\d+)/i.test(Ri.userAgent),JE=!i1&&/Chrome\/(\d+)/.exec(Ri.userAgent),rEe="webkitFontSmoothing"in Ej.documentElement.style,jj=!i1&&/Apple Computer/.test(Ri.vendor),OM=jj&&(/Mobile\/\w+/.test(Ri.userAgent)||Ri.maxTouchPoints>2);var $e={mac:OM||/Mac/.test(Ri.platform),windows:/Win/.test(Ri.platform),linux:/Linux|X11/.test(Ri.platform),ie:i1,ie_version:o9?Ej.documentMode||6:Cj?+Cj[1]:Sj?+Sj[1]:0,gecko:NM,gecko_version:NM?+(/Firefox\/(\d+)/.exec(Ri.userAgent)||[0,0])[1]:0,chrome:!!JE,chrome_version:JE?+JE[1]:0,ios:OM,android:/Android\b/.test(Ri.userAgent),webkit_version:rEe?+(/\bAppleWebKit\/(\d+)/.exec(Ri.userAgent)||[0,0])[1]:0,safari:jj,safari_version:jj?+(/\bVersion\/(\d+(\.\d+)?)/.exec(Ri.userAgent)||[0,0])[1]:0,tabSize:Ej.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};function Zg(t){let e;return t.nodeType==11?e=t.getSelection?t:t.ownerDocument:e=t,e.getSelection()}function kj(t,e){return e?t==e||t.contains(e.nodeType!=1?e.parentNode:e):!1}function zb(t,e){if(!e.anchorNode)return!1;try{return kj(t,e.anchorNode)}catch{return!1}}function sf(t){return t.nodeType==3?Md(t,0,t.nodeValue.length).getClientRects():t.nodeType==1?t.getClientRects():[]}function bg(t,e,n,r){return n?RM(t,e,n,r,-1)||RM(t,e,n,r,1):!1}function $d(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e}function L0(t){return t.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}function RM(t,e,n,r,i){for(;;){if(t==n&&e==r)return!0;if(e==(i<0?0:$a(t))){if(t.nodeName=="DIV")return!1;let s=t.parentNode;if(!s||s.nodeType!=1)return!1;e=$d(t)+(i<0?0:1),t=s}else if(t.nodeType==1){if(t=t.childNodes[e+(i<0?-1:0)],t.nodeType==1&&t.contentEditable=="false")return!1;e=i<0?$a(t):0}else return!1}}function $a(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function yy(t,e){let n=e?t.left:t.right;return{left:n,right:n,top:t.top,bottom:t.bottom}}function iEe(t){let e=t.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}function a9(t,e){let n=e.width/t.offsetWidth,r=e.height/t.offsetHeight;return(n>.995&&n<1.005||!isFinite(n)||Math.abs(e.width-t.offsetWidth)<1)&&(n=1),(r>.995&&r<1.005||!isFinite(r)||Math.abs(e.height-t.offsetHeight)<1)&&(r=1),{scaleX:n,scaleY:r}}function sEe(t,e,n,r,i,s,o,a){let l=t.ownerDocument,c=l.defaultView||window;for(let d=t,h=!1;d&&!h;)if(d.nodeType==1){let p,f=d==l.body,m=1,g=1;if(f)p=iEe(c);else{if(/^(fixed|sticky)$/.test(getComputedStyle(d).position)&&(h=!0),d.scrollHeight<=d.clientHeight&&d.scrollWidth<=d.clientWidth){d=d.assignedSlot||d.parentNode;continue}let x=d.getBoundingClientRect();({scaleX:m,scaleY:g}=a9(d,x)),p={left:x.left,right:x.left+d.clientWidth*m,top:x.top,bottom:x.top+d.clientHeight*g}}let v=0,b=0;if(i=="nearest")e.top<p.top?(b=e.top-(p.top+o),n>0&&e.bottom>p.bottom+b&&(b=e.bottom-p.bottom+o)):e.bottom>p.bottom&&(b=e.bottom-p.bottom+o,n<0&&e.top-b<p.top&&(b=e.top-(p.top+o)));else{let x=e.bottom-e.top,y=p.bottom-p.top;b=(i=="center"&&x<=y?e.top+x/2-y/2:i=="start"||i=="center"&&n<0?e.top-o:e.bottom-y+o)-p.top}if(r=="nearest"?e.left<p.left?(v=e.left-(p.left+s),n>0&&e.right>p.right+v&&(v=e.right-p.right+s)):e.right>p.right&&(v=e.right-p.right+s,n<0&&e.left<p.left+v&&(v=e.left-(p.left+s))):v=(r=="center"?e.left+(e.right-e.left)/2-(p.right-p.left)/2:r=="start"==a?e.left-s:e.right-(p.right-p.left)+s)-p.left,v||b)if(f)c.scrollBy(v,b);else{let x=0,y=0;if(b){let w=d.scrollTop;d.scrollTop+=b/g,y=(d.scrollTop-w)*g}if(v){let w=d.scrollLeft;d.scrollLeft+=v/m,x=(d.scrollLeft-w)*m}e={left:e.left-x,top:e.top-y,right:e.right-x,bottom:e.bottom-y},x&&Math.abs(x-v)<1&&(r="nearest"),y&&Math.abs(y-b)<1&&(i="nearest")}if(f)break;(e.top<p.top||e.bottom>p.bottom||e.left<p.left||e.right>p.right)&&(e={left:Math.max(e.left,p.left),right:Math.min(e.right,p.right),top:Math.max(e.top,p.top),bottom:Math.min(e.bottom,p.bottom)}),d=d.assignedSlot||d.parentNode}else if(d.nodeType==11)d=d.host;else break}function oEe(t){let e=t.ownerDocument,n,r;for(let i=t.parentNode;i&&!(i==e.body||n&&r);)if(i.nodeType==1)!r&&i.scrollHeight>i.clientHeight&&(r=i),!n&&i.scrollWidth>i.clientWidth&&(n=i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;return{x:n,y:r}}class aEe{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:n,focusNode:r}=e;this.set(n,Math.min(e.anchorOffset,n?$a(n):0),r,Math.min(e.focusOffset,r?$a(r):0))}set(e,n,r,i){this.anchorNode=e,this.anchorOffset=n,this.focusNode=r,this.focusOffset=i}}let Qu=null;$e.safari&&$e.safari_version>=26&&(Qu=!1);function l9(t){if(t.setActive)return t.setActive();if(Qu)return t.focus(Qu);let e=[];for(let n=t;n&&(e.push(n,n.scrollTop,n.scrollLeft),n!=n.ownerDocument);n=n.parentNode);if(t.focus(Qu==null?{get preventScroll(){return Qu={preventScroll:!0},!0}}:void 0),!Qu){Qu=!1;for(let n=0;n<e.length;){let r=e[n++],i=e[n++],s=e[n++];r.scrollTop!=i&&(r.scrollTop=i),r.scrollLeft!=s&&(r.scrollLeft=s)}}}let AM;function Md(t,e,n=e){let r=AM||(AM=document.createRange());return r.setEnd(t,n),r.setStart(t,e),r}function wp(t,e,n,r){let i={key:e,code:e,keyCode:n,which:n,cancelable:!0};r&&({altKey:i.altKey,ctrlKey:i.ctrlKey,shiftKey:i.shiftKey,metaKey:i.metaKey}=r);let s=new KeyboardEvent("keydown",i);s.synthetic=!0,t.dispatchEvent(s);let o=new KeyboardEvent("keyup",i);return o.synthetic=!0,t.dispatchEvent(o),s.defaultPrevented||o.defaultPrevented}function lEe(t){for(;t;){if(t&&(t.nodeType==9||t.nodeType==11&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}function c9(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}function cEe(t,e){let n=e.focusNode,r=e.focusOffset;if(!n||e.anchorNode!=n||e.anchorOffset!=r)return!1;for(r=Math.min(r,$a(n));;)if(r){if(n.nodeType!=1)return!1;let i=n.childNodes[r-1];i.contentEditable=="false"?r--:(n=i,r=$a(n))}else{if(n==t)return!0;r=$d(n),n=n.parentNode}}function u9(t){return t.scrollTop>Math.max(1,t.scrollHeight-t.clientHeight-4)}function d9(t,e){for(let n=t,r=e;;){if(n.nodeType==3&&r>0)return{node:n,offset:r};if(n.nodeType==1&&r>0){if(n.contentEditable=="false")return null;n=n.childNodes[r-1],r=$a(n)}else if(n.parentNode&&!L0(n))r=$d(n),n=n.parentNode;else return null}}function h9(t,e){for(let n=t,r=e;;){if(n.nodeType==3&&r<n.nodeValue.length)return{node:n,offset:r};if(n.nodeType==1&&r<n.childNodes.length){if(n.contentEditable=="false")return null;n=n.childNodes[r],r=0}else if(n.parentNode&&!L0(n))r=$d(n)+1,n=n.parentNode;else return null}}class bi{constructor(e,n,r=!0){this.node=e,this.offset=n,this.precise=r}static before(e,n){return new bi(e.parentNode,$d(e),n)}static after(e,n){return new bi(e.parentNode,$d(e)+1,n)}}const hN=[];class On{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let n=this.posAtStart;for(let r of this.children){if(r==e)return n;n+=r.length+r.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,n){if(this.flags&2){let r=this.dom,i=null,s;for(let o of this.children){if(o.flags&7){if(!o.dom&&(s=i?i.nextSibling:r.firstChild)){let a=On.get(s);(!a||!a.parent&&a.canReuseDOM(o))&&o.reuseDOM(s)}o.sync(e,n),o.flags&=-8}if(s=i?i.nextSibling:r.firstChild,n&&!n.written&&n.node==r&&s!=o.dom&&(n.written=!0),o.dom.parentNode==r)for(;s&&s!=o.dom;)s=IM(s);else r.insertBefore(o.dom,s);i=o.dom}for(s=i?i.nextSibling:r.firstChild,s&&n&&n.node==r&&(n.written=!0);s;)s=IM(s)}else if(this.flags&1)for(let r of this.children)r.flags&7&&(r.sync(e,n),r.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,n){let r;if(e==this.dom)r=this.dom.childNodes[n];else{let i=$a(e)==0?0:n==0?-1:1;for(;;){let s=e.parentNode;if(s==this.dom)break;i==0&&s.firstChild!=s.lastChild&&(e==s.firstChild?i=-1:i=1),e=s}i<0?r=e:r=e.nextSibling}if(r==this.dom.firstChild)return 0;for(;r&&!On.get(r);)r=r.nextSibling;if(!r)return this.length;for(let i=0,s=0;;i++){let o=this.children[i];if(o.dom==r)return s;s+=o.length+o.breakAfter}}domBoundsAround(e,n,r=0){let i=-1,s=-1,o=-1,a=-1;for(let l=0,c=r,d=r;l<this.children.length;l++){let h=this.children[l],p=c+h.length;if(c<e&&p>n)return h.domBoundsAround(e,n,c);if(p>=e&&i==-1&&(i=l,s=c),c>n&&h.dom.parentNode==this.dom){o=l,a=d;break}d=p,c=p+h.breakAfter}return{from:s,to:a<0?r+this.length:a,startDOM:(i?this.children[i-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let n=this.parent;n;n=n.parent){if(e&&(n.flags|=2),n.flags&1)return;n.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let n=e.parent;if(!n)return e;e=n}}replaceChildren(e,n,r=hN){this.markDirty();for(let i=e;i<n;i++){let s=this.children[i];s.parent==this&&r.indexOf(s)<0&&s.destroy()}r.length<250?this.children.splice(e,n-e,...r):this.children=[].concat(this.children.slice(0,e),r,this.children.slice(n));for(let i=0;i<r.length;i++)r[i].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new p9(this.children,e,this.children.length)}childPos(e,n=1){return this.childCursor().findPos(e,n)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,n,r,i,s,o){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}}On.prototype.breakAfter=0;function IM(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class p9{constructor(e,n,r){this.children=e,this.pos=n,this.i=r,this.off=0}findPos(e,n=1){for(;;){if(e>this.pos||e==this.pos&&(n>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let r=this.children[--this.i];this.pos-=r.length+r.breakAfter}}}function f9(t,e,n,r,i,s,o,a,l){let{children:c}=t,d=c.length?c[e]:null,h=s.length?s[s.length-1]:null,p=h?h.breakAfter:o;if(!(e==r&&d&&!o&&!p&&s.length<2&&d.merge(n,i,s.length?h:null,n==0,a,l))){if(r<c.length){let f=c[r];f&&(i<f.length||f.breakAfter&&(h!=null&&h.breakAfter))?(e==r&&(f=f.split(i),i=0),!p&&h&&f.merge(0,i,h,!0,0,l)?s[s.length-1]=f:((i||f.children.length&&!f.children[0].length)&&f.merge(0,i,null,!1,0,l),s.push(f))):f!=null&&f.breakAfter&&(h?h.breakAfter=1:o=1),r++}for(d&&(d.breakAfter=o,n>0&&(!o&&s.length&&d.merge(n,d.length,s[0],!1,a,0)?d.breakAfter=s.shift().breakAfter:(n<d.length||d.children.length&&d.children[d.children.length-1].length==0)&&d.merge(n,d.length,null,!1,a,0),e++));e<r&&s.length;)if(c[r-1].become(s[s.length-1]))r--,s.pop(),l=s.length?0:a;else if(c[e].become(s[0]))e++,s.shift(),a=s.length?0:l;else break;!s.length&&e&&r<c.length&&!c[e-1].breakAfter&&c[r].merge(0,0,c[e-1],!1,a,l)&&e--,(e<r||s.length)&&t.replaceChildren(e,r,s)}}function m9(t,e,n,r,i,s){let o=t.childCursor(),{i:a,off:l}=o.findPos(n,1),{i:c,off:d}=o.findPos(e,-1),h=e-n;for(let p of r)h+=p.length;t.length+=h,f9(t,c,d,a,l,r,0,i,s)}const uEe=256;class Ho extends On{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,n){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(n&&n.node==this.dom&&(n.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,n,r){return this.flags&8||r&&(!(r instanceof Ho)||this.length-(n-e)+r.length>uEe||r.flags&8)?!1:(this.text=this.text.slice(0,e)+(r?r.text:"")+this.text.slice(n),this.markDirty(),!0)}split(e){let n=new Ho(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),n.flags|=this.flags&8,n}localPosFromDOM(e,n){return e==this.dom?n:n?this.text.length:0}domAtPos(e){return new bi(this.dom,e)}domBoundsAround(e,n,r){return{from:r,to:r+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,n){return dEe(this.dom,e,n)}}class Pl extends On{constructor(e,n=[],r=0){super(),this.mark=e,this.children=n,this.length=r;for(let i of n)i.setParent(this)}setAttrs(e){if(c9(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let n in this.mark.attrs)e.setAttribute(n,this.mark.attrs[n]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,n){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,n)}merge(e,n,r,i,s,o){return r&&(!(r instanceof Pl&&r.mark.eq(this.mark))||e&&s<=0||n<this.length&&o<=0)?!1:(m9(this,e,n,r?r.children.slice():[],s-1,o-1),this.markDirty(),!0)}split(e){let n=[],r=0,i=-1,s=0;for(let a of this.children){let l=r+a.length;l>e&&n.push(r<e?a.split(e-r):a),i<0&&r>=e&&(i=s),r=l,s++}let o=this.length-e;return this.length=e,i>-1&&(this.children.length=i,this.markDirty()),new Pl(this.mark,n,o)}domAtPos(e){return g9(this,e)}coordsAt(e,n){return y9(this,e,n)}}function dEe(t,e,n){let r=t.nodeValue.length;e>r&&(e=r);let i=e,s=e,o=0;e==0&&n<0||e==r&&n>=0?$e.chrome||$e.gecko||(e?(i--,o=1):s<r&&(s++,o=-1)):n<0?i--:s<r&&s++;let a=Md(t,i,s).getClientRects();if(!a.length)return null;let l=a[(o?o<0:n>=0)?0:a.length-1];return $e.safari&&!o&&l.width==0&&(l=Array.prototype.find.call(a,c=>c.width)||l),o?yy(l,o<0):l||null}class pl extends On{static create(e,n,r){return new pl(e,n,r)}constructor(e,n,r){super(),this.widget=e,this.length=n,this.side=r,this.prevWidget=null}split(e){let n=pl.create(this.widget,this.length-e,this.side);return this.length-=e,n}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,n,r,i,s,o){return r&&(!(r instanceof pl)||!this.widget.compare(r.widget)||e>0&&s<=0||n<this.length&&o<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-n),!0)}become(e){return e instanceof pl&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return ln.empty;let e=this;for(;e.parent;)e=e.parent;let{view:n}=e,r=n&&n.state.doc,i=this.posAtStart;return r?r.slice(i,i+this.length):ln.empty}domAtPos(e){return(this.length?e==0:this.side>0)?bi.before(this.dom):bi.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,n){let r=this.widget.coordsAt(this.dom,e,n);if(r)return r;let i=this.dom.getClientRects(),s=null;if(!i.length)return null;let o=this.side?this.side<0:e>0;for(let a=o?i.length-1:0;s=i[a],!(e>0?a==0:a==i.length-1||s.top<s.bottom);a+=o?-1:1);return yy(s,!o)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class of extends On{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof of&&e.side==this.side}split(){return new of(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?bi.before(this.dom):bi.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return ln.empty}get isHidden(){return!0}}Ho.prototype.children=pl.prototype.children=of.prototype.children=hN;function g9(t,e){let n=t.dom,{children:r}=t,i=0;for(let s=0;i<r.length;i++){let o=r[i],a=s+o.length;if(!(a==s&&o.getSide()<=0)){if(e>s&&e<a&&o.dom.parentNode==n)return o.domAtPos(e-s);if(e<=s)break;s=a}}for(let s=i;s>0;s--){let o=r[s-1];if(o.dom.parentNode==n)return o.domAtPos(o.length)}for(let s=i;s<r.length;s++){let o=r[s];if(o.dom.parentNode==n)return o.domAtPos(0)}return new bi(n,0)}function v9(t,e,n){let r,{children:i}=t;n>0&&e instanceof Pl&&i.length&&(r=i[i.length-1])instanceof Pl&&r.mark.eq(e.mark)?v9(r,e.children[0],n-1):(i.push(e),e.setParent(t)),t.length+=e.length}function y9(t,e,n){let r=null,i=-1,s=null,o=-1;function a(c,d){for(let h=0,p=0;h<c.children.length&&p<=d;h++){let f=c.children[h],m=p+f.length;m>=d&&(f.children.length?a(f,d-p):(!s||s.isHidden&&(n>0||pEe(s,f)))&&(m>d||p==m&&f.getSide()>0)?(s=f,o=d-p):(p<d||p==m&&f.getSide()<0&&!f.isHidden)&&(r=f,i=d-p)),p=m}}a(t,e);let l=(n<0?r:s)||r||s;return l?l.coordsAt(Math.max(0,l==r?i:o),n):hEe(t)}function hEe(t){let e=t.dom.lastChild;if(!e)return t.dom.getBoundingClientRect();let n=sf(e);return n[n.length-1]||null}function pEe(t,e){let n=t.coordsAt(0,1),r=e.coordsAt(0,1);return n&&r&&r.top<n.bottom}function Pj(t,e){for(let n in t)n=="class"&&e.class?e.class+=" "+t.class:n=="style"&&e.style?e.style+=";"+t.style:e[n]=t[n];return e}const DM=Object.create(null);function B0(t,e,n){if(t==e)return!0;t||(t=DM),e||(e=DM);let r=Object.keys(t),i=Object.keys(e);if(r.length-(n&&r.indexOf(n)>-1?1:0)!=i.length-(n&&i.indexOf(n)>-1?1:0))return!1;for(let s of r)if(s!=n&&(i.indexOf(s)==-1||t[s]!==e[s]))return!1;return!0}function Tj(t,e,n){let r=!1;if(e)for(let i in e)n&&i in n||(r=!0,i=="style"?t.style.cssText="":t.removeAttribute(i));if(n)for(let i in n)e&&e[i]==n[i]||(r=!0,i=="style"?t.style.cssText=n[i]:t.setAttribute(i,n[i]));return r}function fEe(t){let e=Object.create(null);for(let n=0;n<t.attributes.length;n++){let r=t.attributes[n];e[r.name]=r.value}return e}class Xf{eq(e){return!1}updateDOM(e,n){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,n,r){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var Na=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(Na||(Na={}));class sn extends Dd{constructor(e,n,r,i){super(),this.startSide=e,this.endSide=n,this.widget=r,this.spec=i}get heightRelevant(){return!1}static mark(e){return new xy(e)}static widget(e){let n=Math.max(-1e4,Math.min(1e4,e.side||0)),r=!!e.block;return n+=r&&!e.inlineOrder?n>0?3e8:-4e8:n>0?1e8:-1e8,new qc(e,n,n,r,e.widget||null,!1)}static replace(e){let n=!!e.block,r,i;if(e.isBlockGap)r=-5e8,i=4e8;else{let{start:s,end:o}=x9(e,n);r=(s?n?-3e8:-1:5e8)-1,i=(o?n?2e8:1:-6e8)+1}return new qc(e,r,i,n,e.widget||null,!0)}static line(e){return new by(e)}static set(e,n=!1){return $n.of(e,n)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}sn.none=$n.empty;class xy extends sn{constructor(e){let{start:n,end:r}=x9(e);super(n?-1:5e8,r?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var n,r;return this==e||e instanceof xy&&this.tagName==e.tagName&&(this.class||((n=this.attrs)===null||n===void 0?void 0:n.class))==(e.class||((r=e.attrs)===null||r===void 0?void 0:r.class))&&B0(this.attrs,e.attrs,"class")}range(e,n=e){if(e>=n)throw new RangeError("Mark decorations may not be empty");return super.range(e,n)}}xy.prototype.point=!1;class by extends sn{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof by&&this.spec.class==e.spec.class&&B0(this.spec.attributes,e.spec.attributes)}range(e,n=e){if(n!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,n)}}by.prototype.mapMode=oi.TrackBefore;by.prototype.point=!0;class qc extends sn{constructor(e,n,r,i,s,o){super(n,r,s,e),this.block=i,this.isReplace=o,this.mapMode=i?n<=0?oi.TrackBefore:oi.TrackAfter:oi.TrackDel}get type(){return this.startSide!=this.endSide?Na.WidgetRange:this.startSide<=0?Na.WidgetBefore:Na.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof qc&&mEe(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,n=e){if(this.isReplace&&(e>n||e==n&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&n!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,n)}}qc.prototype.point=!0;function x9(t,e=!1){let{inclusiveStart:n,inclusiveEnd:r}=t;return n==null&&(n=t.inclusive),r==null&&(r=t.inclusive),{start:n??e,end:r??e}}function mEe(t,e){return t==e||!!(t&&e&&t.compare(e))}function Hb(t,e,n,r=0){let i=n.length-1;i>=0&&n[i]+r>=t?n[i]=Math.max(n[i],e):n.push(t,e)}class jr extends On{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,n,r,i,s,o){if(r){if(!(r instanceof jr))return!1;this.dom||r.transferDOM(this)}return i&&this.setDeco(r?r.attrs:null),m9(this,e,n,r?r.children.slice():[],s,o),!0}split(e){let n=new jr;if(n.breakAfter=this.breakAfter,this.length==0)return n;let{i:r,off:i}=this.childPos(e);i&&(n.append(this.children[r].split(i),0),this.children[r].merge(i,this.children[r].length,null,!1,0,0),r++);for(let s=r;s<this.children.length;s++)n.append(this.children[s],0);for(;r>0&&this.children[r-1].length==0;)this.children[--r].destroy();return this.children.length=r,this.markDirty(),this.length=e,n}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){B0(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,n){v9(this,e,n)}addLineDeco(e){let n=e.spec.attributes,r=e.spec.class;n&&(this.attrs=Pj(n,this.attrs||{})),r&&(this.attrs=Pj({class:r},this.attrs||{}))}domAtPos(e){return g9(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,n){var r;this.dom?this.flags&4&&(c9(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Tj(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,n);let i=this.dom.lastChild;for(;i&&On.get(i)instanceof Pl;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((r=On.get(i))===null||r===void 0?void 0:r.isEditable)==!1&&(!$e.ios||!this.children.some(s=>s instanceof Ho))){let s=document.createElement("BR");s.cmIgnore=!0,this.dom.appendChild(s)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,n;for(let r of this.children){if(!(r instanceof Ho)||/[^ -~]/.test(r.text))return null;let i=sf(r.dom);if(i.length!=1)return null;e+=i[0].width,n=i[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:n}:null}coordsAt(e,n){let r=y9(this,e,n);if(!this.children.length&&r&&this.parent){let{heightOracle:i}=this.parent.view.viewState,s=r.bottom-r.top;if(Math.abs(s-i.lineHeight)<2&&i.textHeight<s){let o=(s-i.textHeight)/2;return{top:r.top+o,bottom:r.bottom-o,left:r.left,right:r.left}}}return r}become(e){return e instanceof jr&&this.children.length==0&&e.children.length==0&&B0(this.attrs,e.attrs)&&this.breakAfter==e.breakAfter}covers(){return!0}static find(e,n){for(let r=0,i=0;r<e.children.length;r++){let s=e.children[r],o=i+s.length;if(o>=n){if(s instanceof jr)return s;if(o>n)break}i=o+s.breakAfter}return null}}class wl extends On{constructor(e,n,r){super(),this.widget=e,this.length=n,this.deco=r,this.breakAfter=0,this.prevWidget=null}merge(e,n,r,i,s,o){return r&&(!(r instanceof wl)||!this.widget.compare(r.widget)||e>0&&s<=0||n<this.length&&o<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-n),!0)}domAtPos(e){return e==0?bi.before(this.dom):bi.after(this.dom,e==this.length)}split(e){let n=this.length-e;this.length=e;let r=new wl(this.widget,n,this.deco);return r.breakAfter=this.breakAfter,r}get children(){return hN}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):ln.empty}domBoundsAround(){return null}become(e){return e instanceof wl&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,n){let r=this.widget.coordsAt(this.dom,e,n);return r||(this.widget instanceof Nj?null:yy(this.dom.getBoundingClientRect(),this.length?e==0:n<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:n,endSide:r}=this.deco;return n==r?!1:e<0?n<0:r>0}}class Nj extends Xf{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class wg{constructor(e,n,r,i){this.doc=e,this.pos=n,this.end=r,this.disallowBlockEffectsFor=i,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=n}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof wl&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new jr),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append($x(new of(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(e&&this.content.length&&this.content[this.content.length-1]instanceof wl)&&this.getLine()}buildText(e,n,r){for(;e>0;){if(this.textOff==this.text.length){let{value:o,lineBreak:a,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(a){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=o,this.textOff=0}let i=Math.min(this.text.length-this.textOff,e),s=Math.min(i,512);this.flushBuffer(n.slice(n.length-r)),this.getLine().append($x(new Ho(this.text.slice(this.textOff,this.textOff+s)),n),r),this.atCursorPos=!0,this.textOff+=s,e-=s,r=i<=s?0:n.length}}span(e,n,r,i){this.buildText(n-e,r,i),this.pos=n,this.openStart<0&&(this.openStart=i)}point(e,n,r,i,s,o){if(this.disallowBlockEffectsFor[o]&&r instanceof qc){if(r.block)throw new RangeError("Block decorations may not be specified via plugins");if(n>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let a=n-e;if(r instanceof qc)if(r.block)r.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new wl(r.widget||af.block,a,r));else{let l=pl.create(r.widget||af.inline,a,a?0:r.startSide),c=this.atCursorPos&&!l.isEditable&&s<=i.length&&(e<n||r.startSide>0),d=!l.isEditable&&(e<n||s>i.length||r.startSide<=0),h=this.getLine();this.pendingBuffer==2&&!c&&!l.isEditable&&(this.pendingBuffer=0),this.flushBuffer(i),c&&(h.append($x(new of(1),i),s),s=i.length+Math.max(0,s-i.length)),h.append($x(l,i),s),this.atCursorPos=d,this.pendingBuffer=d?e<n||s>i.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=i.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(r);a&&(this.textOff+a<=this.text.length?this.textOff+=a:(this.skip+=a-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=n),this.openStart<0&&(this.openStart=s)}static build(e,n,r,i,s){let o=new wg(e,n,r,s);return o.openEnd=$n.spans(i,n,r,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function $x(t,e){for(let n of e)t=new Pl(n,[t],t.length);return t}class af extends Xf{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}af.inline=new af("span");af.block=new af("div");var gr=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(gr||(gr={}));const Ld=gr.LTR,pN=gr.RTL;function b9(t){let e=[];for(let n=0;n<t.length;n++)e.push(1<<+t[n]);return e}const gEe=b9("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),vEe=b9("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Oj=Object.create(null),ua=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),n=t.charCodeAt(1);Oj[e]=n,Oj[n]=-e}function w9(t){return t<=247?gEe[t]:1424<=t&&t<=1524?2:1536<=t&&t<=1785?vEe[t-1536]:1774<=t&&t<=2220?4:8192<=t&&t<=8204?256:64336<=t&&t<=65023?4:1}const yEe=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class Ac{get dir(){return this.level%2?pN:Ld}constructor(e,n,r){this.from=e,this.to=n,this.level=r}side(e,n){return this.dir==n==e?this.to:this.from}forward(e,n){return e==(this.dir==n)}static find(e,n,r,i){let s=-1;for(let o=0;o<e.length;o++){let a=e[o];if(a.from<=n&&a.to>=n){if(a.level==r)return o;(s<0||(i!=0?i<0?a.from<n:a.to>n:e[s].level>a.level))&&(s=o)}}if(s<0)throw new RangeError("Index out of range");return s}}function _9(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++){let r=t[n],i=e[n];if(r.from!=i.from||r.to!=i.to||r.direction!=i.direction||!_9(r.inner,i.inner))return!1}return!0}const An=[];function xEe(t,e,n,r,i){for(let s=0;s<=r.length;s++){let o=s?r[s-1].to:e,a=s<r.length?r[s].from:n,l=s?256:i;for(let c=o,d=l,h=l;c<a;c++){let p=w9(t.charCodeAt(c));p==512?p=d:p==8&&h==4&&(p=16),An[c]=p==4?2:p,p&7&&(h=p),d=p}for(let c=o,d=l,h=l;c<a;c++){let p=An[c];if(p==128)c<a-1&&d==An[c+1]&&d&24?p=An[c]=d:An[c]=256;else if(p==64){let f=c+1;for(;f<a&&An[f]==64;)f++;let m=c&&d==8||f<n&&An[f]==8?h==1?1:8:256;for(let g=c;g<f;g++)An[g]=m;c=f-1}else p==8&&h==1&&(An[c]=1);d=p,p&7&&(h=p)}}}function bEe(t,e,n,r,i){let s=i==1?2:1;for(let o=0,a=0,l=0;o<=r.length;o++){let c=o?r[o-1].to:e,d=o<r.length?r[o].from:n;for(let h=c,p,f,m;h<d;h++)if(f=Oj[p=t.charCodeAt(h)])if(f<0){for(let g=a-3;g>=0;g-=3)if(ua[g+1]==-f){let v=ua[g+2],b=v&2?i:v&4?v&1?s:i:0;b&&(An[h]=An[ua[g]]=b),a=g;break}}else{if(ua.length==189)break;ua[a++]=h,ua[a++]=p,ua[a++]=l}else if((m=An[h])==2||m==1){let g=m==i;l=g?0:1;for(let v=a-3;v>=0;v-=3){let b=ua[v+2];if(b&2)break;if(g)ua[v+2]|=2;else{if(b&4)break;ua[v+2]|=4}}}}}function wEe(t,e,n,r){for(let i=0,s=r;i<=n.length;i++){let o=i?n[i-1].to:t,a=i<n.length?n[i].from:e;for(let l=o;l<a;){let c=An[l];if(c==256){let d=l+1;for(;;)if(d==a){if(i==n.length)break;d=n[i++].to,a=i<n.length?n[i].from:e}else if(An[d]==256)d++;else break;let h=s==1,p=(d<e?An[d]:r)==1,f=h==p?h?1:2:r;for(let m=d,g=i,v=g?n[g-1].to:t;m>l;)m==v&&(m=n[--g].from,v=g?n[g-1].to:t),An[--m]=f;l=d}else s=c,l++}}}function Rj(t,e,n,r,i,s,o){let a=r%2?2:1;if(r%2==i%2)for(let l=e,c=0;l<n;){let d=!0,h=!1;if(c==s.length||l<s[c].from){let g=An[l];g!=a&&(d=!1,h=g==16)}let p=!d&&a==1?[]:null,f=d?r:r+1,m=l;e:for(;;)if(c<s.length&&m==s[c].from){if(h)break e;let g=s[c];if(!d)for(let v=g.to,b=c+1;;){if(v==n)break e;if(b<s.length&&s[b].from==v)v=s[b++].to;else{if(An[v]==a)break e;break}}if(c++,p)p.push(g);else{g.from>l&&o.push(new Ac(l,g.from,f));let v=g.direction==Ld!=!(f%2);Aj(t,v?r+1:r,i,g.inner,g.from,g.to,o),l=g.to}m=g.to}else{if(m==n||(d?An[m]!=a:An[m]==a))break;m++}p?Rj(t,l,m,r+1,i,p,o):l<m&&o.push(new Ac(l,m,f)),l=m}else for(let l=n,c=s.length;l>e;){let d=!0,h=!1;if(!c||l>s[c-1].to){let g=An[l-1];g!=a&&(d=!1,h=g==16)}let p=!d&&a==1?[]:null,f=d?r:r+1,m=l;e:for(;;)if(c&&m==s[c-1].to){if(h)break e;let g=s[--c];if(!d)for(let v=g.from,b=c;;){if(v==e)break e;if(b&&s[b-1].to==v)v=s[--b].from;else{if(An[v-1]==a)break e;break}}if(p)p.push(g);else{g.to<l&&o.push(new Ac(g.to,l,f));let v=g.direction==Ld!=!(f%2);Aj(t,v?r+1:r,i,g.inner,g.from,g.to,o),l=g.from}m=g.from}else{if(m==e||(d?An[m-1]!=a:An[m-1]==a))break;m--}p?Rj(t,m,l,r+1,i,p,o):m<l&&o.push(new Ac(m,l,f)),l=m}}function Aj(t,e,n,r,i,s,o){let a=e%2?2:1;xEe(t,i,s,r,a),bEe(t,i,s,r,a),wEe(i,s,r,a),Rj(t,i,s,e,n,r,o)}function _Ee(t,e,n){if(!t)return[new Ac(0,0,e==pN?1:0)];if(e==Ld&&!n.length&&!yEe.test(t))return E9(t.length);if(n.length)for(;t.length>An.length;)An[An.length]=256;let r=[],i=e==Ld?0:1;return Aj(t,i,i,n,0,t.length,r),r}function E9(t){return[new Ac(0,t,0)]}let S9="";function EEe(t,e,n,r,i){var s;let o=r.head-t.from,a=Ac.find(e,o,(s=r.bidiLevel)!==null&&s!==void 0?s:-1,r.assoc),l=e[a],c=l.side(i,n);if(o==c){let p=a+=i?1:-1;if(p<0||p>=e.length)return null;l=e[a=p],o=l.side(!i,n),c=l.side(i,n)}let d=Li(t.text,o,l.forward(i,n));(d<l.from||d>l.to)&&(d=c),S9=t.text.slice(Math.min(o,d),Math.max(o,d));let h=a==(i?e.length-1:0)?null:e[a+(i?1:-1)];return h&&d==c&&h.level+(i?0:1)<l.level?ue.cursor(h.side(!i,n)+t.from,h.forward(i,n)?1:-1,h.level):ue.cursor(d+t.from,l.forward(i,n)?-1:1,l.level)}function SEe(t,e,n){for(let r=e;r<n;r++){let i=w9(t.charCodeAt(r));if(i==1)return Ld;if(i==2||i==4)return pN}return Ld}const C9=it.define(),j9=it.define(),k9=it.define(),P9=it.define(),Ij=it.define(),T9=it.define(),N9=it.define(),fN=it.define(),mN=it.define(),O9=it.define({combine:t=>t.some(e=>e)}),CEe=it.define({combine:t=>t.some(e=>e)}),R9=it.define();class _p{constructor(e,n="nearest",r="nearest",i=5,s=5,o=!1){this.range=e,this.y=n,this.x=r,this.yMargin=i,this.xMargin=s,this.isSnapshot=o}map(e){return e.empty?this:new _p(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new _p(ue.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const Mx=dn.define({map:(t,e)=>t.map(e)}),A9=dn.define();function Bi(t,e,n){let r=t.facet(P9);r.length?r[0](e):window.onerror&&window.onerror(String(e),n,void 0,void 0,e)||(n?console.error(n+":",e):console.error(e))}const cl=it.define({combine:t=>t.length?t[0]:!0});let jEe=0;const np=it.define({combine(t){return t.filter((e,n)=>{for(let r=0;r<n;r++)if(t[r].plugin==e.plugin)return!1;return!0})}});class Ts{constructor(e,n,r,i,s){this.id=e,this.create=n,this.domEventHandlers=r,this.domEventObservers=i,this.baseExtensions=s(this),this.extension=this.baseExtensions.concat(np.of({plugin:this,arg:void 0}))}of(e){return this.baseExtensions.concat(np.of({plugin:this,arg:e}))}static define(e,n){const{eventHandlers:r,eventObservers:i,provide:s,decorations:o}=n||{};return new Ts(jEe++,e,r,i,a=>{let l=[];return o&&l.push(Jg.of(c=>{let d=c.plugin(a);return d?o(d):sn.none})),s&&l.push(s(a)),l})}static fromClass(e,n){return Ts.define((r,i)=>new e(r,i),n)}}class eS{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(e){if(this.value){if(this.mustUpdate){let n=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(n)}catch(r){if(Bi(n.state,r,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(e,this.spec.arg)}catch(n){Bi(e.state,n,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var n;if(!((n=this.value)===null||n===void 0)&&n.destroy)try{this.value.destroy()}catch(r){Bi(e.state,r,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const I9=it.define(),gN=it.define(),Jg=it.define(),D9=it.define(),wy=it.define(),$9=it.define();function $M(t,e){let n=t.state.facet($9);if(!n.length)return n;let r=n.map(s=>s instanceof Function?s(t):s),i=[];return $n.spans(r,e.from,e.to,{point(){},span(s,o,a,l){let c=s-e.from,d=o-e.from,h=i;for(let p=a.length-1;p>=0;p--,l--){let f=a[p].spec.bidiIsolate,m;if(f==null&&(f=SEe(e.text,c,d)),l>0&&h.length&&(m=h[h.length-1]).to==c&&m.direction==f)m.to=d,h=m.inner;else{let g={from:c,to:d,direction:f,inner:[]};h.push(g),h=g.inner}}}}),i}const M9=it.define();function vN(t){let e=0,n=0,r=0,i=0;for(let s of t.state.facet(M9)){let o=s(t);o&&(o.left!=null&&(e=Math.max(e,o.left)),o.right!=null&&(n=Math.max(n,o.right)),o.top!=null&&(r=Math.max(r,o.top)),o.bottom!=null&&(i=Math.max(i,o.bottom)))}return{left:e,right:n,top:r,bottom:i}}const Gm=it.define();class no{constructor(e,n,r,i){this.fromA=e,this.toA=n,this.fromB=r,this.toB=i}join(e){return new no(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let n=e.length,r=this;for(;n>0;n--){let i=e[n-1];if(!(i.fromA>r.toA)){if(i.toA<r.fromA)break;r=r.join(i),e.splice(n-1,1)}}return e.splice(n,0,r),e}static extendWithRanges(e,n){if(n.length==0)return e;let r=[];for(let i=0,s=0,o=0,a=0;;i++){let l=i==e.length?null:e[i],c=o-a,d=l?l.fromB:1e9;for(;s<n.length&&n[s]<d;){let h=n[s],p=n[s+1],f=Math.max(a,h),m=Math.min(d,p);if(f<=m&&new no(f+c,m+c,f,m).addToSet(r),p>d)break;s+=2}if(!l)return r;new no(l.fromA,l.toA,l.fromB,l.toB).addToSet(r),o=l.toA,a=l.toB}}}class F0{constructor(e,n,r){this.view=e,this.state=n,this.transactions=r,this.flags=0,this.startState=e.state,this.changes=qr.empty(this.startState.doc.length);for(let s of r)this.changes=this.changes.compose(s.changes);let i=[];this.changes.iterChangedRanges((s,o,a,l)=>i.push(new no(s,o,a,l))),this.changedRanges=i}static create(e,n,r){return new F0(e,n,r)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class MM extends On{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=sn.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new jr],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new no(0,0,0,e.state.doc.length)],0,null)}update(e){var n;let r=e.changedRanges;this.minWidth>0&&r.length&&(r.every(({fromA:c,toA:d})=>d<this.minWidthFrom||c>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let i=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((n=this.domChanged)===null||n===void 0)&&n.newSel?i=this.domChanged.newSel.head:!AEe(e.changes,this.hasComposition)&&!e.selectionSet&&(i=e.state.selection.main.head));let s=i>-1?PEe(this.view,e.changes,i):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:c,to:d}=this.hasComposition;r=new no(c,d,e.changes.mapPos(c,-1),e.changes.mapPos(d,1)).addToSet(r.slice())}this.hasComposition=s?{from:s.range.fromB,to:s.range.toB}:null,($e.ie||$e.chrome)&&!s&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let o=this.decorations,a=this.updateDeco(),l=OEe(o,a,e.changes);return r=no.extendWithRanges(r,l),!(this.flags&7)&&r.length==0?!1:(this.updateInner(r,e.startState.doc.length,s),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,n,r){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,n,r);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let o=$e.chrome||$e.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,o),this.flags&=-8,o&&(o.written||i.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(o=>o.flags&=-9);let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof wl&&o.widget instanceof Nj&&s.push(o.dom);i.updateGaps(s)}updateChildren(e,n,r){let i=r?r.range.addToSet(e.slice()):e,s=this.childCursor(n);for(let o=i.length-1;;o--){let a=o>=0?i[o]:null;if(!a)break;let{fromA:l,toA:c,fromB:d,toB:h}=a,p,f,m,g;if(r&&r.range.fromB<h&&r.range.toB>d){let w=wg.build(this.view.state.doc,d,r.range.fromB,this.decorations,this.dynamicDecorationMap),E=wg.build(this.view.state.doc,r.range.toB,h,this.decorations,this.dynamicDecorationMap);f=w.breakAtStart,m=w.openStart,g=E.openEnd;let S=this.compositionView(r);E.breakAtStart?S.breakAfter=1:E.content.length&&S.merge(S.length,S.length,E.content[0],!1,E.openStart,0)&&(S.breakAfter=E.content[0].breakAfter,E.content.shift()),w.content.length&&S.merge(0,0,w.content[w.content.length-1],!0,0,w.openEnd)&&w.content.pop(),p=w.content.concat(S).concat(E.content)}else({content:p,breakAtStart:f,openStart:m,openEnd:g}=wg.build(this.view.state.doc,d,h,this.decorations,this.dynamicDecorationMap));let{i:v,off:b}=s.findPos(c,1),{i:x,off:y}=s.findPos(l,-1);f9(this,x,y,v,b,p,f,m,g)}r&&this.fixCompositionDOM(r)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let n of e.transactions)for(let r of n.effects)r.is(A9)&&(this.editContextFormatting=r.value)}compositionView(e){let n=new Ho(e.text.nodeValue);n.flags|=8;for(let{deco:i}of e.marks)n=new Pl(i,[n],n.length);let r=new jr;return r.append(n,0),r}fixCompositionDOM(e){let n=(s,o)=>{o.flags|=8|(o.children.some(l=>l.flags&7)?1:0),this.markedForComposition.add(o);let a=On.get(s);a&&a!=o&&(a.dom=null),o.setDOM(s)},r=this.childPos(e.range.fromB,1),i=this.children[r.i];n(e.line,i);for(let s=e.marks.length-1;s>=-1;s--)r=i.childPos(r.off,1),i=i.children[r.i],n(s>=0?e.marks[s].node:e.text,i)}updateSelection(e=!1,n=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let r=this.view.root.activeElement,i=r==this.dom,s=!i&&!(this.view.state.facet(cl)||this.dom.tabIndex>-1)&&zb(this.dom,this.view.observer.selectionRange)&&!(r&&this.dom.contains(r));if(!(i||n||s))return;let o=this.forceSelection;this.forceSelection=!1;let a=this.view.state.selection.main,l=this.moveToLine(this.domAtPos(a.anchor)),c=a.empty?l:this.moveToLine(this.domAtPos(a.head));if($e.gecko&&a.empty&&!this.hasComposition&&kEe(l)){let h=document.createTextNode("");this.view.observer.ignore(()=>l.node.insertBefore(h,l.node.childNodes[l.offset]||null)),l=c=new bi(h,0),o=!0}let d=this.view.observer.selectionRange;(o||!d.focusNode||(!bg(l.node,l.offset,d.anchorNode,d.anchorOffset)||!bg(c.node,c.offset,d.focusNode,d.focusOffset))&&!this.suppressWidgetCursorChange(d,a))&&(this.view.observer.ignore(()=>{$e.android&&$e.chrome&&this.dom.contains(d.focusNode)&&REe(d.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let h=Zg(this.view.root);if(h)if(a.empty){if($e.gecko){let p=TEe(l.node,l.offset);if(p&&p!=3){let f=(p==1?d9:h9)(l.node,l.offset);f&&(l=new bi(f.node,f.offset))}}h.collapse(l.node,l.offset),a.bidiLevel!=null&&h.caretBidiLevel!==void 0&&(h.caretBidiLevel=a.bidiLevel)}else if(h.extend){h.collapse(l.node,l.offset);try{h.extend(c.node,c.offset)}catch{}}else{let p=document.createRange();a.anchor>a.head&&([l,c]=[c,l]),p.setEnd(c.node,c.offset),p.setStart(l.node,l.offset),h.removeAllRanges(),h.addRange(p)}s&&this.view.root.activeElement==this.dom&&(this.dom.blur(),r&&r.focus())}),this.view.observer.setSelectionRange(l,c)),this.impreciseAnchor=l.precise?null:new bi(d.anchorNode,d.anchorOffset),this.impreciseHead=c.precise?null:new bi(d.focusNode,d.focusOffset)}suppressWidgetCursorChange(e,n){return this.hasComposition&&n.empty&&bg(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==n.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,n=e.state.selection.main,r=Zg(e.root),{anchorNode:i,anchorOffset:s}=e.observer.selectionRange;if(!r||!n.empty||!n.assoc||!r.modify)return;let o=jr.find(this,n.head);if(!o)return;let a=o.posAtStart;if(n.head==a||n.head==a+o.length)return;let l=this.coordsAt(n.head,-1),c=this.coordsAt(n.head,1);if(!l||!c||l.bottom>c.top)return;let d=this.domAtPos(n.head+n.assoc);r.collapse(d.node,d.offset),r.modify("move",n.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let h=e.observer.selectionRange;e.docView.posFromDOM(h.anchorNode,h.anchorOffset)!=n.from&&r.collapse(i,s)}moveToLine(e){let n=this.dom,r;if(e.node!=n)return e;for(let i=e.offset;!r&&i<n.childNodes.length;i++){let s=On.get(n.childNodes[i]);s instanceof jr&&(r=s.domAtPos(0))}for(let i=e.offset-1;!r&&i>=0;i--){let s=On.get(n.childNodes[i]);s instanceof jr&&(r=s.domAtPos(s.length))}return r?new bi(r.node,r.offset,!0):e}nearest(e){for(let n=e;n;){let r=On.get(n);if(r&&r.rootView==this)return r;n=n.parentNode}return null}posFromDOM(e,n){let r=this.nearest(e);if(!r)throw new RangeError("Trying to find position for a DOM position outside of the document");return r.localPosFromDOM(e,n)+r.posAtStart}domAtPos(e){let{i:n,off:r}=this.childCursor().findPos(e,-1);for(;n<this.children.length-1;){let i=this.children[n];if(r<i.length||i instanceof jr)break;n++,r=0}return this.children[n].domAtPos(r)}coordsAt(e,n){let r=null,i=0;for(let s=this.length,o=this.children.length-1;o>=0;o--){let a=this.children[o],l=s-a.breakAfter,c=l-a.length;if(l<e)break;if(c<=e&&(c<e||a.covers(-1))&&(l>e||a.covers(1))&&(!r||a instanceof jr&&!(r instanceof jr&&n>=0)))r=a,i=c;else if(r&&c==e&&l==e&&a instanceof wl&&Math.abs(n)<2){if(a.deco.startSide<0)break;o&&(r=null)}s=c}return r?r.coordsAt(e-i,n):null}coordsForChar(e){let{i:n,off:r}=this.childPos(e,1),i=this.children[n];if(!(i instanceof jr))return null;for(;i.children.length;){let{i:a,off:l}=i.childPos(r,1);for(;;a++){if(a==i.children.length)return null;if((i=i.children[a]).length)break}r=l}if(!(i instanceof Ho))return null;let s=Li(i.text,r);if(s==r)return null;let o=Md(i.dom,r,s).getClientRects();for(let a=0;a<o.length;a++){let l=o[a];if(a==o.length-1||l.top<l.bottom&&l.left<l.right)return l}return null}measureVisibleLineHeights(e){let n=[],{from:r,to:i}=e,s=this.view.contentDOM.clientWidth,o=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,a=-1,l=this.view.textDirection==gr.LTR;for(let c=0,d=0;d<this.children.length;d++){let h=this.children[d],p=c+h.length;if(p>i)break;if(c>=r){let f=h.dom.getBoundingClientRect();if(n.push(f.height),o){let m=h.dom.lastChild,g=m?sf(m):[];if(g.length){let v=g[g.length-1],b=l?v.right-f.left:f.right-v.left;b>a&&(a=b,this.minWidth=s,this.minWidthFrom=c,this.minWidthTo=p)}}}c=p+h.breakAfter}return n}textDirectionAt(e){let{i:n}=this.childPos(e,1);return getComputedStyle(this.children[n].dom).direction=="rtl"?gr.RTL:gr.LTR}measureTextSize(){for(let s of this.children)if(s instanceof jr){let o=s.measureTextSize();if(o)return o}let e=document.createElement("div"),n,r,i;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let s=sf(e.firstChild)[0];n=e.getBoundingClientRect().height,r=s?s.width/27:7,i=s?s.height:n,e.remove()}),{lineHeight:n,charWidth:r,textHeight:i}}childCursor(e=this.length){let n=this.children.length;return n&&(e-=this.children[--n].length),new p9(this.children,e,n)}computeBlockGapDeco(){let e=[],n=this.view.viewState;for(let r=0,i=0;;i++){let s=i==n.viewports.length?null:n.viewports[i],o=s?s.from-1:this.length;if(o>r){let a=(n.lineBlockAt(o).bottom-n.lineBlockAt(r).top)/this.view.scaleY;e.push(sn.replace({widget:new Nj(a),block:!0,inclusive:!0,isBlockGap:!0}).range(r,o))}if(!s)break;r=s.to+1}return sn.set(e)}updateDeco(){let e=1,n=this.view.state.facet(Jg).map(s=>(this.dynamicDecorationMap[e++]=typeof s=="function")?s(this.view):s),r=!1,i=this.view.state.facet(D9).map((s,o)=>{let a=typeof s=="function";return a&&(r=!0),a?s(this.view):s});for(i.length&&(this.dynamicDecorationMap[e++]=r,n.push($n.join(i))),this.decorations=[this.editContextFormatting,...n,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let c=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=c.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let c of this.view.state.facet(R9))try{if(c(this.view,e.range,e))return!0}catch(d){Bi(this.view.state,d,"scroll handler")}let{range:n}=e,r=this.coordsAt(n.head,n.empty?n.assoc:n.head>n.anchor?-1:1),i;if(!r)return;!n.empty&&(i=this.coordsAt(n.anchor,n.anchor>n.head?-1:1))&&(r={left:Math.min(r.left,i.left),top:Math.min(r.top,i.top),right:Math.max(r.right,i.right),bottom:Math.max(r.bottom,i.bottom)});let s=vN(this.view),o={left:r.left-s.left,top:r.top-s.top,right:r.right+s.right,bottom:r.bottom+s.bottom},{offsetWidth:a,offsetHeight:l}=this.view.scrollDOM;sEe(this.view.scrollDOM,o,n.head<n.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,a),-a),Math.max(Math.min(e.yMargin,l),-l),this.view.textDirection==gr.LTR)}lineHasWidget(e){let{i:n}=this.childCursor().findPos(e);if(n==this.children.length)return!1;let r=i=>i instanceof pl||i.children.some(r);return r(this.children[n])}}function kEe(t){return t.node.nodeType==1&&t.node.firstChild&&(t.offset==0||t.node.childNodes[t.offset-1].contentEditable=="false")&&(t.offset==t.node.childNodes.length||t.node.childNodes[t.offset].contentEditable=="false")}function L9(t,e){let n=t.observer.selectionRange;if(!n.focusNode)return null;let r=d9(n.focusNode,n.focusOffset),i=h9(n.focusNode,n.focusOffset),s=r||i;if(i&&r&&i.node!=r.node){let a=On.get(i.node);if(!a||a instanceof Ho&&a.text!=i.node.nodeValue)s=i;else if(t.docView.lastCompositionAfterCursor){let l=On.get(r.node);!l||l instanceof Ho&&l.text!=r.node.nodeValue||(s=i)}}if(t.docView.lastCompositionAfterCursor=s!=r,!s)return null;let o=e-s.offset;return{from:o,to:o+s.node.nodeValue.length,node:s.node}}function PEe(t,e,n){let r=L9(t,n);if(!r)return null;let{node:i,from:s,to:o}=r,a=i.nodeValue;if(/[\n\r]/.test(a)||t.state.doc.sliceString(r.from,r.to)!=a)return null;let l=e.invertedDesc,c=new no(l.mapPos(s),l.mapPos(o),s,o),d=[];for(let h=i.parentNode;;h=h.parentNode){let p=On.get(h);if(p instanceof Pl)d.push({node:h,deco:p.mark});else{if(p instanceof jr||h.nodeName=="DIV"&&h.parentNode==t.contentDOM)return{range:c,text:i,marks:d,line:h};if(h!=t.contentDOM)d.push({node:h,deco:new xy({inclusive:!0,attributes:fEe(h),tagName:h.tagName.toLowerCase()})});else return null}}}function TEe(t,e){return t.nodeType!=1?0:(e&&t.childNodes[e-1].contentEditable=="false"?1:0)|(e<t.childNodes.length&&t.childNodes[e].contentEditable=="false"?2:0)}let NEe=class{constructor(){this.changes=[]}compareRange(e,n){Hb(e,n,this.changes)}comparePoint(e,n){Hb(e,n,this.changes)}boundChange(e){Hb(e,e,this.changes)}};function OEe(t,e,n){let r=new NEe;return $n.compare(t,e,n,r),r.changes}function REe(t,e){for(let n=t;n&&n!=e;n=n.assignedSlot||n.parentNode)if(n.nodeType==1&&n.contentEditable=="false")return!0;return!1}function AEe(t,e){let n=!1;return e&&t.iterChangedRanges((r,i)=>{r<e.to&&i>e.from&&(n=!0)}),n}function IEe(t,e,n=1){let r=t.charCategorizer(e),i=t.doc.lineAt(e),s=e-i.from;if(i.length==0)return ue.cursor(e);s==0?n=1:s==i.length&&(n=-1);let o=s,a=s;n<0?o=Li(i.text,s,!1):a=Li(i.text,s);let l=r(i.text.slice(o,a));for(;o>0;){let c=Li(i.text,o,!1);if(r(i.text.slice(c,o))!=l)break;o=c}for(;a<i.length;){let c=Li(i.text,a);if(r(i.text.slice(a,c))!=l)break;a=c}return ue.range(o+i.from,a+i.from)}function DEe(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function $Ee(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function tS(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function LM(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function BM(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function Dj(t,e,n){let r,i,s,o,a=!1,l,c,d,h;for(let m=t.firstChild;m;m=m.nextSibling){let g=sf(m);for(let v=0;v<g.length;v++){let b=g[v];i&&tS(i,b)&&(b=LM(BM(b,i.bottom),i.top));let x=DEe(e,b),y=$Ee(n,b);if(x==0&&y==0)return m.nodeType==3?FM(m,e,n):Dj(m,e,n);(!r||o>y||o==y&&s>x)&&(r=m,i=b,s=x,o=y,a=x?e<b.left?v>0:v<g.length-1:!0),x==0?n>b.bottom&&(!d||d.bottom<b.bottom)?(l=m,d=b):n<b.top&&(!h||h.top>b.top)&&(c=m,h=b):d&&tS(d,b)?d=BM(d,b.bottom):h&&tS(h,b)&&(h=LM(h,b.top))}}if(d&&d.bottom>=n?(r=l,i=d):h&&h.top<=n&&(r=c,i=h),!r)return{node:t,offset:0};let p=Math.max(i.left,Math.min(i.right,e));if(r.nodeType==3)return FM(r,p,n);if(a&&r.contentEditable!="false")return Dj(r,p,n);let f=Array.prototype.indexOf.call(t.childNodes,r)+(e>=(i.left+i.right)/2?1:0);return{node:t,offset:f}}function FM(t,e,n){let r=t.nodeValue.length,i=-1,s=1e9,o=0;for(let a=0;a<r;a++){let l=Md(t,a,a+1).getClientRects();for(let c=0;c<l.length;c++){let d=l[c];if(d.top==d.bottom)continue;o||(o=e-d.left);let h=(d.top>n?d.top-n:n-d.bottom)-1;if(d.left-1<=e&&d.right+1>=e&&h<s){let p=e>=(d.left+d.right)/2,f=p;if($e.chrome||$e.gecko){let m=Md(t,a).getBoundingClientRect();Math.abs(m.left-d.right)<.1&&(f=!p)}if(h<=0)return{node:t,offset:a+(f?1:0)};i=a+(f?1:0),s=h}}}return{node:t,offset:i>-1?i:o>0?t.nodeValue.length:0}}function B9(t,e,n,r=-1){var i,s;let o=t.contentDOM.getBoundingClientRect(),a=o.top+t.viewState.paddingTop,l,{docHeight:c}=t.viewState,{x:d,y:h}=e,p=h-a;if(p<0)return 0;if(p>c)return t.state.doc.length;for(let w=t.viewState.heightOracle.textHeight/2,E=!1;l=t.elementAtHeight(p),l.type!=Na.Text;)for(;p=r>0?l.bottom+w:l.top-w,!(p>=0&&p<=c);){if(E)return n?null:0;E=!0,r=-r}h=a+p;let f=l.from;if(f<t.viewport.from)return t.viewport.from==0?0:n?null:zM(t,o,l,d,h);if(f>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:n?null:zM(t,o,l,d,h);let m=t.dom.ownerDocument,g=t.root.elementFromPoint?t.root:m,v=g.elementFromPoint(d,h);v&&!t.contentDOM.contains(v)&&(v=null),v||(d=Math.max(o.left+1,Math.min(o.right-1,d)),v=g.elementFromPoint(d,h),v&&!t.contentDOM.contains(v)&&(v=null));let b,x=-1;if(v&&((i=t.docView.nearest(v))===null||i===void 0?void 0:i.isEditable)!=!1){if(m.caretPositionFromPoint){let w=m.caretPositionFromPoint(d,h);w&&({offsetNode:b,offset:x}=w)}else if(m.caretRangeFromPoint){let w=m.caretRangeFromPoint(d,h);w&&({startContainer:b,startOffset:x}=w)}b&&(!t.contentDOM.contains(b)||$e.safari&&MEe(b,x,d)||$e.chrome&&LEe(b,x,d))&&(b=void 0),b&&(x=Math.min($a(b),x))}if(!b||!t.docView.dom.contains(b)){let w=jr.find(t.docView,f);if(!w)return p>l.top+l.height/2?l.to:l.from;({node:b,offset:x}=Dj(w.dom,d,h))}let y=t.docView.nearest(b);if(!y)return null;if(y.isWidget&&((s=y.dom)===null||s===void 0?void 0:s.nodeType)==1){let w=y.dom.getBoundingClientRect();return e.y<w.top||e.y<=w.bottom&&e.x<=(w.left+w.right)/2?y.posAtStart:y.posAtEnd}else return y.localPosFromDOM(b,x)+y.posAtStart}function zM(t,e,n,r,i){let s=Math.round((r-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&n.height>t.defaultLineHeight*1.5){let a=t.viewState.heightOracle.textHeight,l=Math.floor((i-n.top-(t.defaultLineHeight-a)*.5)/a);s+=l*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(n.from,n.to);return n.from+Z1e(o,s,t.state.tabSize)}function F9(t,e,n){let r,i=t;if(t.nodeType!=3||e!=(r=t.nodeValue.length))return!1;for(;;){let s=i.nextSibling;if(s){if(s.nodeName=="BR")break;return!1}else{let o=i.parentNode;if(!o||o.nodeName=="DIV")break;i=o}}return Md(t,r-1,r).getBoundingClientRect().right>n}function MEe(t,e,n){return F9(t,e,n)}function LEe(t,e,n){if(e!=0)return F9(t,e,n);for(let i=t;;){let s=i.parentNode;if(!s||s.nodeType!=1||s.firstChild!=i)return!1;if(s.classList.contains("cm-line"))break;i=s}let r=t.nodeType==1?t.getBoundingClientRect():Md(t,0,Math.max(t.nodeValue.length,1)).getBoundingClientRect();return n-r.left>5}function BEe(t,e,n){let r=t.lineBlockAt(e);if(Array.isArray(r.type)){let i;for(let s of r.type){if(s.from>e)break;if(!(s.to<e)){if(s.from<e&&s.to>e)return s;(!i||s.type==Na.Text&&(i.type!=s.type||(n<0?s.from<e:s.to>e)))&&(i=s)}}return i||r}return r}function FEe(t,e,n,r){let i=BEe(t,e.head,e.assoc||-1),s=!r||i.type!=Na.Text||!(t.lineWrapping||i.widgetLineBreaks)?null:t.coordsAtPos(e.assoc<0&&e.head>i.from?e.head-1:e.head);if(s){let o=t.dom.getBoundingClientRect(),a=t.textDirectionAt(i.from),l=t.posAtCoords({x:n==(a==gr.LTR)?o.right-1:o.left+1,y:(s.top+s.bottom)/2});if(l!=null)return ue.cursor(l,n?-1:1)}return ue.cursor(n?i.to:i.from,n?-1:1)}function HM(t,e,n,r){let i=t.state.doc.lineAt(e.head),s=t.bidiSpans(i),o=t.textDirectionAt(i.from);for(let a=e,l=null;;){let c=EEe(i,s,o,a,n),d=S9;if(!c){if(i.number==(n?t.state.doc.lines:1))return a;d=`
`,i=t.state.doc.line(i.number+(n?1:-1)),s=t.bidiSpans(i),c=t.visualLineSide(i,!n)}if(l){if(!l(d))return a}else{if(!r)return c;l=r(d)}a=c}}function zEe(t,e,n){let r=t.state.charCategorizer(e),i=r(n);return s=>{let o=r(s);return i==Xs.Space&&(i=o),i==o}}function HEe(t,e,n,r){let i=e.head,s=n?1:-1;if(i==(n?t.state.doc.length:0))return ue.cursor(i,e.assoc);let o=e.goalColumn,a,l=t.contentDOM.getBoundingClientRect(),c=t.coordsAtPos(i,e.assoc||-1),d=t.documentTop;if(c)o==null&&(o=c.left-l.left),a=s<0?c.top:c.bottom;else{let f=t.viewState.lineBlockAt(i);o==null&&(o=Math.min(l.right-l.left,t.defaultCharacterWidth*(i-f.from))),a=(s<0?f.top:f.bottom)+d}let h=l.left+o,p=r??t.viewState.heightOracle.textHeight>>1;for(let f=0;;f+=10){let m=a+(p+f)*s,g=B9(t,{x:h,y:m},!1,s);if(m<l.top||m>l.bottom||(s<0?g<i:g>i)){let v=t.docView.coordsForChar(g),b=!v||m<v.top?-1:1;return ue.cursor(g,b,void 0,o)}}}function _g(t,e,n){for(;;){let r=0;for(let i of t)i.between(e-1,e+1,(s,o,a)=>{if(e>s&&e<o){let l=r||n||(e-s<o-e?-1:1);e=l<0?s:o,r=l}});if(!r)return e}}function z9(t,e){let n=null;for(let r=0;r<e.ranges.length;r++){let i=e.ranges[r],s=null;if(i.empty){let o=_g(t,i.from,0);o!=i.from&&(s=ue.cursor(o,-1))}else{let o=_g(t,i.from,-1),a=_g(t,i.to,1);(o!=i.from||a!=i.to)&&(s=ue.range(i.from==i.anchor?o:a,i.from==i.head?o:a))}s&&(n||(n=e.ranges.slice()),n[r]=s)}return n?ue.create(n,e.mainIndex):e}function nS(t,e,n){let r=_g(t.state.facet(wy).map(i=>i(t)),n.from,e.head>n.from?-1:1);return r==n.from?n:ue.cursor(r,r<n.from?1:-1)}const Km="";class UEe{constructor(e,n){this.points=e,this.text="",this.lineSeparator=n.facet(gn.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=Km}readRange(e,n){if(!e)return this;let r=e.parentNode;for(let i=e;;){this.findPointBefore(r,i);let s=this.text.length;this.readNode(i);let o=i.nextSibling;if(o==n)break;let a=On.get(i),l=On.get(o);(a&&l?a.breakAfter:(a?a.breakAfter:L0(i))||L0(o)&&(i.nodeName!="BR"||i.cmIgnore)&&this.text.length>s)&&!qEe(o,n)&&this.lineBreak(),i=o}return this.findPointBefore(r,n),this}readTextNode(e){let n=e.nodeValue;for(let r of this.points)r.node==e&&(r.pos=this.text.length+Math.min(r.offset,n.length));for(let r=0,i=this.lineSeparator?null:/\r\n?|\n/g;;){let s=-1,o=1,a;if(this.lineSeparator?(s=n.indexOf(this.lineSeparator,r),o=this.lineSeparator.length):(a=i.exec(n))&&(s=a.index,o=a[0].length),this.append(n.slice(r,s<0?n.length:s)),s<0)break;if(this.lineBreak(),o>1)for(let l of this.points)l.node==e&&l.pos>this.text.length&&(l.pos-=o-1);r=s+o}}readNode(e){if(e.cmIgnore)return;let n=On.get(e),r=n&&n.overrideDOMText;if(r!=null){this.findPointInside(e,r.length);for(let i=r.iter();!i.next().done;)i.lineBreak?this.lineBreak():this.append(i.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,n){for(let r of this.points)r.node==e&&e.childNodes[r.offset]==n&&(r.pos=this.text.length)}findPointInside(e,n){for(let r of this.points)(e.nodeType==3?r.node==e:e.contains(r.node))&&(r.pos=this.text.length+(VEe(e,r.node,r.offset)?n:0))}}function VEe(t,e,n){for(;;){if(!e||n<$a(e))return!1;if(e==t)return!0;n=$d(e)+1,e=e.parentNode}}function qEe(t,e){let n;for(;!(t==e||!t);t=t.nextSibling){let r=On.get(t);if(!(r!=null&&r.isWidget||t.cmIgnore))return!1;r&&(n||(n=[])).push(r)}if(n)for(let r of n){let i=r.overrideDOMText;if(i!=null&&i.length)return!1}return!0}class UM{constructor(e,n){this.node=e,this.offset=n,this.pos=-1}}class WEe{constructor(e,n,r,i){this.typeOver=i,this.bounds=null,this.text="",this.domChanged=n>-1;let{impreciseHead:s,impreciseAnchor:o}=e.docView;if(e.state.readOnly&&n>-1)this.newSel=null;else if(n>-1&&(this.bounds=e.docView.domBoundsAround(n,r,0))){let a=s||o?[]:KEe(e),l=new UEe(a,e.state);l.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=l.text,this.newSel=YEe(a,this.bounds.from)}else{let a=e.observer.selectionRange,l=s&&s.node==a.focusNode&&s.offset==a.focusOffset||!kj(e.contentDOM,a.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(a.focusNode,a.focusOffset),c=o&&o.node==a.anchorNode&&o.offset==a.anchorOffset||!kj(e.contentDOM,a.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(a.anchorNode,a.anchorOffset),d=e.viewport;if(($e.ios||$e.chrome)&&e.state.selection.main.empty&&l!=c&&(d.from>0||d.to<e.state.doc.length)){let h=Math.min(l,c),p=Math.max(l,c),f=d.from-h,m=d.to-p;(f==0||f==1||h==0)&&(m==0||m==-1||p==e.state.doc.length)&&(l=0,c=e.state.doc.length)}e.inputState.composing>-1&&e.state.selection.ranges.length>1?this.newSel=e.state.selection.replaceRange(ue.range(c,l)):this.newSel=ue.single(c,l)}}}function H9(t,e){let n,{newSel:r}=e,i=t.state.selection.main,s=t.inputState.lastKeyTime>Date.now()-100?t.inputState.lastKeyCode:-1;if(e.bounds){let{from:o,to:a}=e.bounds,l=i.from,c=null;(s===8||$e.android&&e.text.length<a-o)&&(l=i.to,c="end");let d=U9(t.state.doc.sliceString(o,a,Km),e.text,l-o,c);d&&($e.chrome&&s==13&&d.toB==d.from+2&&e.text.slice(d.from,d.toB)==Km+Km&&d.toB--,n={from:o+d.from,to:o+d.toA,insert:ln.of(e.text.slice(d.from,d.toB).split(Km))})}else r&&(!t.hasFocus&&t.state.facet(cl)||r.main.eq(i))&&(r=null);if(!n&&!r)return!1;if(!n&&e.typeOver&&!i.empty&&r&&r.main.empty?n={from:i.from,to:i.to,insert:t.state.doc.slice(i.from,i.to)}:($e.mac||$e.android)&&n&&n.from==n.to&&n.from==i.head-1&&/^\. ?$/.test(n.insert.toString())&&t.contentDOM.getAttribute("autocorrect")=="off"?(r&&n.insert.length==2&&(r=ue.single(r.main.anchor-1,r.main.head-1)),n={from:n.from,to:n.to,insert:ln.of([n.insert.toString().replace("."," ")])}):n&&n.from>=i.from&&n.to<=i.to&&(n.from!=i.from||n.to!=i.to)&&i.to-i.from-(n.to-n.from)<=4?n={from:i.from,to:i.to,insert:t.state.doc.slice(i.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,i.to))}:t.state.doc.lineAt(i.from).to<i.to&&t.docView.lineHasWidget(i.to)&&t.inputState.insertingTextAt>Date.now()-50?n={from:i.from,to:i.to,insert:t.state.toText(t.inputState.insertingText)}:$e.chrome&&n&&n.from==n.to&&n.from==i.head&&n.insert.toString()==`
 `&&t.lineWrapping&&(r&&(r=ue.single(r.main.anchor-1,r.main.head-1)),n={from:i.from,to:i.to,insert:ln.of([" "])}),n)return yN(t,n,r,s);if(r&&!r.main.eq(i)){let o=!1,a="select";return t.inputState.lastSelectionTime>Date.now()-50&&(t.inputState.lastSelectionOrigin=="select"&&(o=!0),a=t.inputState.lastSelectionOrigin,a=="select.pointer"&&(r=z9(t.state.facet(wy).map(l=>l(t)),r))),t.dispatch({selection:r,scrollIntoView:o,userEvent:a}),!0}else return!1}function yN(t,e,n,r=-1){if($e.ios&&t.inputState.flushIOSKey(e))return!0;let i=t.state.selection.main;if($e.android&&(e.to==i.to&&(e.from==i.from||e.from==i.from-1&&t.state.sliceDoc(e.from,i.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&wp(t.contentDOM,"Enter",13)||(e.from==i.from-1&&e.to==i.to&&e.insert.length==0||r==8&&e.insert.length<e.to-e.from&&e.to>i.head)&&wp(t.contentDOM,"Backspace",8)||e.from==i.from&&e.to==i.to+1&&e.insert.length==0&&wp(t.contentDOM,"Delete",46)))return!0;let s=e.insert.toString();t.inputState.composing>=0&&t.inputState.composing++;let o,a=()=>o||(o=GEe(t,e,n));return t.state.facet(T9).some(l=>l(t,e.from,e.to,s,a))||t.dispatch(a()),!0}function GEe(t,e,n){let r,i=t.state,s=i.selection.main,o=-1;if(e.from==e.to&&e.from<s.from||e.from>s.to){let l=e.from<s.from?-1:1,c=l<0?s.from:s.to,d=_g(i.facet(wy).map(h=>h(t)),c,l);e.from==d&&(o=d)}if(o>-1)r={changes:e,selection:ue.cursor(e.from+e.insert.length,-1)};else if(e.from>=s.from&&e.to<=s.to&&e.to-e.from>=(s.to-s.from)/3&&(!n||n.main.empty&&n.main.from==e.from+e.insert.length)&&t.inputState.composing<0){let l=s.from<e.from?i.sliceDoc(s.from,e.from):"",c=s.to>e.to?i.sliceDoc(e.to,s.to):"";r=i.replaceSelection(t.state.toText(l+e.insert.sliceString(0,void 0,t.state.lineBreak)+c))}else{let l=i.changes(e),c=n&&n.main.to<=l.newLength?n.main:void 0;if(i.selection.ranges.length>1&&(t.inputState.composing>=0||t.inputState.compositionPendingChange)&&e.to<=s.to+10&&e.to>=s.to-10){let d=t.state.sliceDoc(e.from,e.to),h,p=n&&L9(t,n.main.head);if(p){let m=e.insert.length-(e.to-e.from);h={from:p.from,to:p.to-m}}else h=t.state.doc.lineAt(s.head);let f=s.to-e.to;r=i.changeByRange(m=>{if(m.from==s.from&&m.to==s.to)return{changes:l,range:c||m.map(l)};let g=m.to-f,v=g-d.length;if(t.state.sliceDoc(v,g)!=d||g>=h.from&&v<=h.to)return{range:m};let b=i.changes({from:v,to:g,insert:e.insert}),x=m.to-s.to;return{changes:b,range:c?ue.range(Math.max(0,c.anchor+x),Math.max(0,c.head+x)):m.map(b)}})}else r={changes:l,selection:c&&i.selection.replaceRange(c)}}let a="input.type";return(t.composing||t.inputState.compositionPendingChange&&t.inputState.compositionEndedAt>Date.now()-50)&&(t.inputState.compositionPendingChange=!1,a+=".compose",t.inputState.compositionFirstChange&&(a+=".start",t.inputState.compositionFirstChange=!1)),i.update(r,{userEvent:a,scrollIntoView:!0})}function U9(t,e,n,r){let i=Math.min(t.length,e.length),s=0;for(;s<i&&t.charCodeAt(s)==e.charCodeAt(s);)s++;if(s==i&&t.length==e.length)return null;let o=t.length,a=e.length;for(;o>0&&a>0&&t.charCodeAt(o-1)==e.charCodeAt(a-1);)o--,a--;if(r=="end"){let l=Math.max(0,s-Math.min(o,a));n-=o+l-s}if(o<s&&t.length<e.length){let l=n<=s&&n>=o?s-n:0;s-=l,a=s+(a-o),o=s}else if(a<s){let l=n<=s&&n>=a?s-n:0;s-=l,o=s+(o-a),a=s}return{from:s,toA:o,toB:a}}function KEe(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:s}=t.observer.selectionRange;return n&&(e.push(new UM(n,r)),(i!=n||s!=r)&&e.push(new UM(i,s))),e}function YEe(t,e){if(t.length==0)return null;let n=t[0].pos,r=t.length==2?t[1].pos:n;return n>-1&&r>-1?ue.single(n+e,r+e):null}class XEe{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.insertingText="",this.insertingTextAt=0,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,$e.safari&&e.contentDOM.addEventListener("input",()=>null),$e.gecko&&hSe(e.contentDOM.ownerDocument)}handleEvent(e){!iSe(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(e.type,e)):this.runHandlers(e.type,e))}runHandlers(e,n){let r=this.handlers[e];if(r){for(let i of r.observers)i(this.view,n);for(let i of r.handlers){if(n.defaultPrevented)break;if(i(this.view,n)){n.preventDefault();break}}}}ensureHandlers(e){let n=QEe(e),r=this.handlers,i=this.view.contentDOM;for(let s in n)if(s!="scroll"){let o=!n[s].handlers.length,a=r[s];a&&o!=!a.handlers.length&&(i.removeEventListener(s,this.handleEvent),a=null),a||i.addEventListener(s,this.handleEvent,{passive:o})}for(let s in r)s!="scroll"&&!n[s]&&i.removeEventListener(s,this.handleEvent);this.handlers=n}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&q9.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),$e.android&&$e.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let n;return $e.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((n=V9.find(r=>r.keyCode==e.keyCode))&&!e.ctrlKey||ZEe.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=n||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let n=this.pendingIOSKey;return!n||n.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,wp(this.view.contentDOM,n.key,n.keyCode,n instanceof KeyboardEvent?n:void 0))}ignoreDuringComposition(e){return!/^key/.test(e.type)||e.synthetic?!1:this.composing>0?!0:$e.safari&&!$e.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function VM(t,e){return(n,r)=>{try{return e.call(t,r,n)}catch(i){Bi(n.state,i)}}}function QEe(t){let e=Object.create(null);function n(r){return e[r]||(e[r]={observers:[],handlers:[]})}for(let r of t){let i=r.spec,s=i&&i.plugin.domEventHandlers,o=i&&i.plugin.domEventObservers;if(s)for(let a in s){let l=s[a];l&&n(a).handlers.push(VM(r.value,l))}if(o)for(let a in o){let l=o[a];l&&n(a).observers.push(VM(r.value,l))}}for(let r in Uo)n(r).handlers.push(Uo[r]);for(let r in io)n(r).observers.push(io[r]);return e}const V9=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],ZEe="dthko",q9=[16,17,18,20,91,92,224,225],Lx=6;function Bx(t){return Math.max(0,t)*.7+8}function JEe(t,e){return Math.max(Math.abs(t.clientX-e.clientX),Math.abs(t.clientY-e.clientY))}class eSe{constructor(e,n,r,i){this.view=e,this.startEvent=n,this.style=r,this.mustSelect=i,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=n,this.scrollParents=oEe(e.contentDOM),this.atoms=e.state.facet(wy).map(o=>o(e));let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=n.shiftKey,this.multiple=e.state.facet(gn.allowMultipleSelections)&&tSe(e,n),this.dragging=rSe(e,n)&&K9(n)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&JEe(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let n=0,r=0,i=0,s=0,o=this.view.win.innerWidth,a=this.view.win.innerHeight;this.scrollParents.x&&({left:i,right:o}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:s,bottom:a}=this.scrollParents.y.getBoundingClientRect());let l=vN(this.view);e.clientX-l.left<=i+Lx?n=-Bx(i-e.clientX):e.clientX+l.right>=o-Lx&&(n=Bx(e.clientX-o)),e.clientY-l.top<=s+Lx?r=-Bx(s-e.clientY):e.clientY+l.bottom>=a-Lx&&(r=Bx(e.clientY-a)),this.setScrollSpeed(n,r)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,n){this.scrollSpeed={x:e,y:n},e||n?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:n}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),n&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=n,n=0),(e||n)&&this.view.win.scrollBy(e,n),this.dragging===!1&&this.select(this.lastEvent)}select(e){let{view:n}=this,r=z9(this.atoms,this.style.get(e,this.extend,this.multiple));(this.mustSelect||!r.eq(n.state.selection,this.dragging===!1))&&this.view.dispatch({selection:r,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(n=>n.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function tSe(t,e){let n=t.state.facet(C9);return n.length?n[0](e):$e.mac?e.metaKey:e.ctrlKey}function nSe(t,e){let n=t.state.facet(j9);return n.length?n[0](e):$e.mac?!e.altKey:!e.ctrlKey}function rSe(t,e){let{main:n}=t.state.selection;if(n.empty)return!1;let r=Zg(t.root);if(!r||r.rangeCount==0)return!0;let i=r.getRangeAt(0).getClientRects();for(let s=0;s<i.length;s++){let o=i[s];if(o.left<=e.clientX&&o.right>=e.clientX&&o.top<=e.clientY&&o.bottom>=e.clientY)return!0}return!1}function iSe(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target,r;n!=t.contentDOM;n=n.parentNode)if(!n||n.nodeType==11||(r=On.get(n))&&r.ignoreEvent(e))return!1;return!0}const Uo=Object.create(null),io=Object.create(null),W9=$e.ie&&$e.ie_version<15||$e.ios&&$e.webkit_version<604;function sSe(t){let e=t.dom.parentNode;if(!e)return;let n=e.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus(),setTimeout(()=>{t.focus(),n.remove(),G9(t,n.value)},50)}function s1(t,e,n){for(let r of t.facet(e))n=r(n,t);return n}function G9(t,e){e=s1(t.state,fN,e);let{state:n}=t,r,i=1,s=n.toText(e),o=s.lines==n.selection.ranges.length;if($j!=null&&n.selection.ranges.every(l=>l.empty)&&$j==s.toString()){let l=-1;r=n.changeByRange(c=>{let d=n.doc.lineAt(c.from);if(d.from==l)return{range:c};l=d.from;let h=n.toText((o?s.line(i++).text:e)+n.lineBreak);return{changes:{from:d.from,insert:h},range:ue.cursor(c.from+h.length)}})}else o?r=n.changeByRange(l=>{let c=s.line(i++);return{changes:{from:l.from,to:l.to,insert:c.text},range:ue.cursor(l.from+c.length)}}):r=n.replaceSelection(s);t.dispatch(r,{userEvent:"input.paste",scrollIntoView:!0})}io.scroll=t=>{t.inputState.lastScrollTop=t.scrollDOM.scrollTop,t.inputState.lastScrollLeft=t.scrollDOM.scrollLeft};Uo.keydown=(t,e)=>(t.inputState.setSelectionOrigin("select"),e.keyCode==27&&t.inputState.tabFocusMode!=0&&(t.inputState.tabFocusMode=Date.now()+2e3),!1);io.touchstart=(t,e)=>{t.inputState.lastTouchTime=Date.now(),t.inputState.setSelectionOrigin("select.pointer")};io.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")};Uo.mousedown=(t,e)=>{if(t.observer.flush(),t.inputState.lastTouchTime>Date.now()-2e3)return!1;let n=null;for(let r of t.state.facet(k9))if(n=r(t,e),n)break;if(!n&&e.button==0&&(n=lSe(t,e)),n){let r=!t.hasFocus;t.inputState.startMouseSelection(new eSe(t,e,n,r)),r&&t.observer.ignore(()=>{l9(t.contentDOM);let s=t.root.activeElement;s&&!s.contains(t.contentDOM)&&s.blur()});let i=t.inputState.mouseSelection;if(i)return i.start(e),i.dragging===!1}else t.inputState.setSelectionOrigin("select.pointer");return!1};function qM(t,e,n,r){if(r==1)return ue.cursor(e,n);if(r==2)return IEe(t.state,e,n);{let i=jr.find(t.docView,e),s=t.state.doc.lineAt(i?i.posAtEnd:e),o=i?i.posAtStart:s.from,a=i?i.posAtEnd:s.to;return a<t.state.doc.length&&a==s.to&&a++,ue.range(o,a)}}let WM=(t,e,n)=>e>=n.top&&e<=n.bottom&&t>=n.left&&t<=n.right;function oSe(t,e,n,r){let i=jr.find(t.docView,e);if(!i)return 1;let s=e-i.posAtStart;if(s==0)return 1;if(s==i.length)return-1;let o=i.coordsAt(s,-1);if(o&&WM(n,r,o))return-1;let a=i.coordsAt(s,1);return a&&WM(n,r,a)?1:o&&o.bottom>=r?-1:1}function GM(t,e){let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:n,bias:oSe(t,n,e.clientX,e.clientY)}}const aSe=$e.ie&&$e.ie_version<=11;let KM=null,YM=0,XM=0;function K9(t){if(!aSe)return t.detail;let e=KM,n=XM;return KM=t,XM=Date.now(),YM=!e||n>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(YM+1)%3:1}function lSe(t,e){let n=GM(t,e),r=K9(e),i=t.state.selection;return{update(s){s.docChanged&&(n.pos=s.changes.mapPos(n.pos),i=i.map(s.changes))},get(s,o,a){let l=GM(t,s),c,d=qM(t,l.pos,l.bias,r);if(n.pos!=l.pos&&!o){let h=qM(t,n.pos,n.bias,r),p=Math.min(h.from,d.from),f=Math.max(h.to,d.to);d=p<d.from?ue.range(p,f):ue.range(f,p)}return o?i.replaceRange(i.main.extend(d.from,d.to)):a&&r==1&&i.ranges.length>1&&(c=cSe(i,l.pos))?c:a?i.addRange(d):ue.create([d])}}}function cSe(t,e){for(let n=0;n<t.ranges.length;n++){let{from:r,to:i}=t.ranges[n];if(r<=e&&i>=e)return ue.create(t.ranges.slice(0,n).concat(t.ranges.slice(n+1)),t.mainIndex==n?0:t.mainIndex-(t.mainIndex>n?1:0))}return null}Uo.dragstart=(t,e)=>{let{selection:{main:n}}=t.state;if(e.target.draggable){let i=t.docView.nearest(e.target);if(i&&i.isWidget){let s=i.posAtStart,o=s+i.length;(s>=n.to||o<=n.from)&&(n=ue.range(s,o))}}let{inputState:r}=t;return r.mouseSelection&&(r.mouseSelection.dragging=!0),r.draggedContent=n,e.dataTransfer&&(e.dataTransfer.setData("Text",s1(t.state,mN,t.state.sliceDoc(n.from,n.to))),e.dataTransfer.effectAllowed="copyMove"),!1};Uo.dragend=t=>(t.inputState.draggedContent=null,!1);function QM(t,e,n,r){if(n=s1(t.state,fN,n),!n)return;let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:s}=t.inputState,o=r&&s&&nSe(t,e)?{from:s.from,to:s.to}:null,a={from:i,insert:n},l=t.state.changes(o?[o,a]:a);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(i,-1),head:l.mapPos(i,1)},userEvent:o?"move.drop":"input.drop"}),t.inputState.draggedContent=null}Uo.drop=(t,e)=>{if(!e.dataTransfer)return!1;if(t.state.readOnly)return!0;let n=e.dataTransfer.files;if(n&&n.length){let r=Array(n.length),i=0,s=()=>{++i==n.length&&QM(t,e,r.filter(o=>o!=null).join(t.state.lineBreak),!1)};for(let o=0;o<n.length;o++){let a=new FileReader;a.onerror=s,a.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(a.result)||(r[o]=a.result),s()},a.readAsText(n[o])}return!0}else{let r=e.dataTransfer.getData("Text");if(r)return QM(t,e,r,!0),!0}return!1};Uo.paste=(t,e)=>{if(t.state.readOnly)return!0;t.observer.flush();let n=W9?null:e.clipboardData;return n?(G9(t,n.getData("text/plain")||n.getData("text/uri-list")),!0):(sSe(t),!1)};function uSe(t,e){let n=t.dom.parentNode;if(!n)return;let r=n.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px",r.value=e,r.focus(),r.selectionEnd=e.length,r.selectionStart=0,setTimeout(()=>{r.remove(),t.focus()},50)}function dSe(t){let e=[],n=[],r=!1;for(let i of t.selection.ranges)i.empty||(e.push(t.sliceDoc(i.from,i.to)),n.push(i));if(!e.length){let i=-1;for(let{from:s}of t.selection.ranges){let o=t.doc.lineAt(s);o.number>i&&(e.push(o.text),n.push({from:o.from,to:Math.min(t.doc.length,o.to+1)})),i=o.number}r=!0}return{text:s1(t,mN,e.join(t.lineBreak)),ranges:n,linewise:r}}let $j=null;Uo.copy=Uo.cut=(t,e)=>{let{text:n,ranges:r,linewise:i}=dSe(t.state);if(!n&&!i)return!1;$j=i?n:null,e.type=="cut"&&!t.state.readOnly&&t.dispatch({changes:r,scrollIntoView:!0,userEvent:"delete.cut"});let s=W9?null:e.clipboardData;return s?(s.clearData(),s.setData("text/plain",n),!0):(uSe(t,n),!1)};const Y9=ph.define();function X9(t,e){let n=[];for(let r of t.facet(N9)){let i=r(t,e);i&&n.push(i)}return n.length?t.update({effects:n,annotations:Y9.of(!0)}):null}function Q9(t){setTimeout(()=>{let e=t.hasFocus;if(e!=t.inputState.notifiedFocused){let n=X9(t.state,e);n?t.dispatch(n):t.update([])}},10)}io.focus=t=>{t.inputState.lastFocusTime=Date.now(),!t.scrollDOM.scrollTop&&(t.inputState.lastScrollTop||t.inputState.lastScrollLeft)&&(t.scrollDOM.scrollTop=t.inputState.lastScrollTop,t.scrollDOM.scrollLeft=t.inputState.lastScrollLeft),Q9(t)};io.blur=t=>{t.observer.clearSelectionRange(),Q9(t)};io.compositionstart=io.compositionupdate=t=>{t.observer.editContext||(t.inputState.compositionFirstChange==null&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0))};io.compositionend=t=>{t.observer.editContext||(t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionPendingKey=!0,t.inputState.compositionPendingChange=t.observer.pendingRecords().length>0,t.inputState.compositionFirstChange=null,$e.chrome&&$e.android?t.observer.flushSoon():t.inputState.compositionPendingChange?Promise.resolve().then(()=>t.observer.flush()):setTimeout(()=>{t.inputState.composing<0&&t.docView.hasComposition&&t.update([])},50))};io.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()};Uo.beforeinput=(t,e)=>{var n,r;if((e.inputType=="insertText"||e.inputType=="insertCompositionText")&&(t.inputState.insertingText=e.data,t.inputState.insertingTextAt=Date.now()),e.inputType=="insertReplacementText"&&t.observer.editContext){let s=(n=e.dataTransfer)===null||n===void 0?void 0:n.getData("text/plain"),o=e.getTargetRanges();if(s&&o.length){let a=o[0],l=t.posAtDOM(a.startContainer,a.startOffset),c=t.posAtDOM(a.endContainer,a.endOffset);return yN(t,{from:l,to:c,insert:t.state.toText(s)},null),!0}}let i;if($e.chrome&&$e.android&&(i=V9.find(s=>s.inputType==e.inputType))&&(t.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let s=((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>s+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())},100)}return $e.ios&&e.inputType=="deleteContentForward"&&t.observer.flushSoon(),$e.safari&&e.inputType=="insertText"&&t.inputState.composing>=0&&setTimeout(()=>io.compositionend(t,e),20),!1};const ZM=new Set;function hSe(t){ZM.has(t)||(ZM.add(t),t.addEventListener("copy",()=>{}),t.addEventListener("cut",()=>{}))}const JM=["pre-wrap","normal","pre-line","break-spaces"];let lf=!1;function eL(){lf=!1}class pSe{constructor(e){this.lineWrapping=e,this.doc=ln.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,n){let r=this.doc.lineAt(n).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(r+=Math.max(0,Math.ceil((n-e-r*this.lineLength*.5)/this.lineLength))),this.lineHeight*r}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return JM.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let n=!1;for(let r=0;r<e.length;r++){let i=e[r];i<0?r++:this.heightSamples[Math.floor(i*10)]||(n=!0,this.heightSamples[Math.floor(i*10)]=!0)}return n}refresh(e,n,r,i,s,o){let a=JM.indexOf(e)>-1,l=Math.round(n)!=Math.round(this.lineHeight)||this.lineWrapping!=a;if(this.lineWrapping=a,this.lineHeight=n,this.charWidth=r,this.textHeight=i,this.lineLength=s,l){this.heightSamples={};for(let c=0;c<o.length;c++){let d=o[c];d<0?c++:this.heightSamples[Math.floor(d*10)]=!0}}return l}}class fSe{constructor(e,n){this.from=e,this.heights=n,this.index=0}get more(){return this.index<this.heights.length}}class Sa{constructor(e,n,r,i,s){this.from=e,this.length=n,this.top=r,this.height=i,this._content=s}get type(){return typeof this._content=="number"?Na.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof qc?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let n=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new Sa(this.from,this.length+e.length,this.top,this.height+e.height,n)}}var Fn=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(Fn||(Fn={}));const Ub=.001;class Vi{constructor(e,n,r=2){this.length=e,this.height=n,this.flags=r}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>Ub&&(lf=!0),this.height=e)}replace(e,n,r){return Vi.of(r)}decomposeLeft(e,n){n.push(this)}decomposeRight(e,n){n.push(this)}applyChanges(e,n,r,i){let s=this,o=r.doc;for(let a=i.length-1;a>=0;a--){let{fromA:l,toA:c,fromB:d,toB:h}=i[a],p=s.lineAt(l,Fn.ByPosNoHeight,r.setDoc(n),0,0),f=p.to>=c?p:s.lineAt(c,Fn.ByPosNoHeight,r,0,0);for(h+=f.to-c,c=f.to;a>0&&p.from<=i[a-1].toA;)l=i[a-1].fromA,d=i[a-1].fromB,a--,l<p.from&&(p=s.lineAt(l,Fn.ByPosNoHeight,r,0,0));d+=p.from-l,l=p.from;let m=xN.build(r.setDoc(o),e,d,h);s=z0(s,s.replace(l,c,m))}return s.updateHeight(r,0)}static empty(){return new xs(0,0)}static of(e){if(e.length==1)return e[0];let n=0,r=e.length,i=0,s=0;for(;;)if(n==r)if(i>s*2){let a=e[n-1];a.break?e.splice(--n,1,a.left,null,a.right):e.splice(--n,1,a.left,a.right),r+=1+a.break,i-=a.size}else if(s>i*2){let a=e[r];a.break?e.splice(r,1,a.left,null,a.right):e.splice(r,1,a.left,a.right),r+=2+a.break,s-=a.size}else break;else if(i<s){let a=e[n++];a&&(i+=a.size)}else{let a=e[--r];a&&(s+=a.size)}let o=0;return e[n-1]==null?(o=1,n--):e[n]==null&&(o=1,r++),new mSe(Vi.of(e.slice(0,n)),o,Vi.of(e.slice(r)))}}function z0(t,e){return t==e?t:(t.constructor!=e.constructor&&(lf=!0),e)}Vi.prototype.size=1;class Z9 extends Vi{constructor(e,n,r){super(e,n),this.deco=r}blockAt(e,n,r,i){return new Sa(i,this.length,r,this.height,this.deco||0)}lineAt(e,n,r,i,s){return this.blockAt(0,r,i,s)}forEachLine(e,n,r,i,s,o){e<=s+this.length&&n>=s&&o(this.blockAt(0,r,i,s))}updateHeight(e,n=0,r=!1,i){return i&&i.from<=n&&i.more&&this.setHeight(i.heights[i.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class xs extends Z9{constructor(e,n){super(e,n,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,n,r,i){return new Sa(i,this.length,r,this.height,this.breaks)}replace(e,n,r){let i=r[0];return r.length==1&&(i instanceof xs||i instanceof ii&&i.flags&4)&&Math.abs(this.length-i.length)<10?(i instanceof ii?i=new xs(i.length,this.height):i.height=this.height,this.outdated||(i.outdated=!1),i):Vi.of(r)}updateHeight(e,n=0,r=!1,i){return i&&i.from<=n&&i.more?this.setHeight(i.heights[i.index++]):(r||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class ii extends Vi{constructor(e){super(e,0)}heightMetrics(e,n){let r=e.doc.lineAt(n).number,i=e.doc.lineAt(n+this.length).number,s=i-r+1,o,a=0;if(e.lineWrapping){let l=Math.min(this.height,e.lineHeight*s);o=l/s,this.length>s+1&&(a=(this.height-l)/(this.length-s-1))}else o=this.height/s;return{firstLine:r,lastLine:i,perLine:o,perChar:a}}blockAt(e,n,r,i){let{firstLine:s,lastLine:o,perLine:a,perChar:l}=this.heightMetrics(n,i);if(n.lineWrapping){let c=i+(e<n.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-r)/this.height))*this.length)),d=n.doc.lineAt(c),h=a+d.length*l,p=Math.max(r,e-h/2);return new Sa(d.from,d.length,p,h,0)}else{let c=Math.max(0,Math.min(o-s,Math.floor((e-r)/a))),{from:d,length:h}=n.doc.line(s+c);return new Sa(d,h,r+a*c,a,0)}}lineAt(e,n,r,i,s){if(n==Fn.ByHeight)return this.blockAt(e,r,i,s);if(n==Fn.ByPosNoHeight){let{from:f,to:m}=r.doc.lineAt(e);return new Sa(f,m-f,0,0,0)}let{firstLine:o,perLine:a,perChar:l}=this.heightMetrics(r,s),c=r.doc.lineAt(e),d=a+c.length*l,h=c.number-o,p=i+a*h+l*(c.from-s-h);return new Sa(c.from,c.length,Math.max(i,Math.min(p,i+this.height-d)),d,0)}forEachLine(e,n,r,i,s,o){e=Math.max(e,s),n=Math.min(n,s+this.length);let{firstLine:a,perLine:l,perChar:c}=this.heightMetrics(r,s);for(let d=e,h=i;d<=n;){let p=r.doc.lineAt(d);if(d==e){let m=p.number-a;h+=l*m+c*(e-s-m)}let f=l+c*p.length;o(new Sa(p.from,p.length,h,f,0)),h+=f,d=p.to+1}}replace(e,n,r){let i=this.length-n;if(i>0){let s=r[r.length-1];s instanceof ii?r[r.length-1]=new ii(s.length+i):r.push(null,new ii(i-1))}if(e>0){let s=r[0];s instanceof ii?r[0]=new ii(e+s.length):r.unshift(new ii(e-1),null)}return Vi.of(r)}decomposeLeft(e,n){n.push(new ii(e-1),null)}decomposeRight(e,n){n.push(null,new ii(this.length-e-1))}updateHeight(e,n=0,r=!1,i){let s=n+this.length;if(i&&i.from<=n+this.length&&i.more){let o=[],a=Math.max(n,i.from),l=-1;for(i.from>n&&o.push(new ii(i.from-n-1).updateHeight(e,n));a<=s&&i.more;){let d=e.doc.lineAt(a).length;o.length&&o.push(null);let h=i.heights[i.index++];l==-1?l=h:Math.abs(h-l)>=Ub&&(l=-2);let p=new xs(d,h);p.outdated=!1,o.push(p),a+=d+1}a<=s&&o.push(null,new ii(s-a).updateHeight(e,a));let c=Vi.of(o);return(l<0||Math.abs(c.height-this.height)>=Ub||Math.abs(l-this.heightMetrics(e,n).perLine)>=Ub)&&(lf=!0),z0(this,c)}else(r||this.outdated)&&(this.setHeight(e.heightForGap(n,n+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class mSe extends Vi{constructor(e,n,r){super(e.length+n+r.length,e.height+r.height,n|(e.outdated||r.outdated?2:0)),this.left=e,this.right=r,this.size=e.size+r.size}get break(){return this.flags&1}blockAt(e,n,r,i){let s=r+this.left.height;return e<s?this.left.blockAt(e,n,r,i):this.right.blockAt(e,n,s,i+this.left.length+this.break)}lineAt(e,n,r,i,s){let o=i+this.left.height,a=s+this.left.length+this.break,l=n==Fn.ByHeight?e<o:e<a,c=l?this.left.lineAt(e,n,r,i,s):this.right.lineAt(e,n,r,o,a);if(this.break||(l?c.to<a:c.from>a))return c;let d=n==Fn.ByPosNoHeight?Fn.ByPosNoHeight:Fn.ByPos;return l?c.join(this.right.lineAt(a,d,r,o,a)):this.left.lineAt(a,d,r,i,s).join(c)}forEachLine(e,n,r,i,s,o){let a=i+this.left.height,l=s+this.left.length+this.break;if(this.break)e<l&&this.left.forEachLine(e,n,r,i,s,o),n>=l&&this.right.forEachLine(e,n,r,a,l,o);else{let c=this.lineAt(l,Fn.ByPos,r,i,s);e<c.from&&this.left.forEachLine(e,c.from-1,r,i,s,o),c.to>=e&&c.from<=n&&o(c),n>c.to&&this.right.forEachLine(c.to+1,n,r,a,l,o)}}replace(e,n,r){let i=this.left.length+this.break;if(n<i)return this.balanced(this.left.replace(e,n,r),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-i,n-i,r));let s=[];e>0&&this.decomposeLeft(e,s);let o=s.length;for(let a of r)s.push(a);if(e>0&&tL(s,o-1),n<this.length){let a=s.length;this.decomposeRight(n,s),tL(s,a)}return Vi.of(s)}decomposeLeft(e,n){let r=this.left.length;if(e<=r)return this.left.decomposeLeft(e,n);n.push(this.left),this.break&&(r++,e>=r&&n.push(null)),e>r&&this.right.decomposeLeft(e-r,n)}decomposeRight(e,n){let r=this.left.length,i=r+this.break;if(e>=i)return this.right.decomposeRight(e-i,n);e<r&&this.left.decomposeRight(e,n),this.break&&e<i&&n.push(null),n.push(this.right)}balanced(e,n){return e.size>2*n.size||n.size>2*e.size?Vi.of(this.break?[e,null,n]:[e,n]):(this.left=z0(this.left,e),this.right=z0(this.right,n),this.setHeight(e.height+n.height),this.outdated=e.outdated||n.outdated,this.size=e.size+n.size,this.length=e.length+this.break+n.length,this)}updateHeight(e,n=0,r=!1,i){let{left:s,right:o}=this,a=n+s.length+this.break,l=null;return i&&i.from<=n+s.length&&i.more?l=s=s.updateHeight(e,n,r,i):s.updateHeight(e,n,r),i&&i.from<=a+o.length&&i.more?l=o=o.updateHeight(e,a,r,i):o.updateHeight(e,a,r),l?this.balanced(s,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function tL(t,e){let n,r;t[e]==null&&(n=t[e-1])instanceof ii&&(r=t[e+1])instanceof ii&&t.splice(e-1,3,new ii(n.length+1+r.length))}const gSe=5;class xN{constructor(e,n){this.pos=e,this.oracle=n,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,n){if(this.lineStart>-1){let r=Math.min(n,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof xs?i.length+=r-this.pos:(r>this.pos||!this.isCovered)&&this.nodes.push(new xs(r-this.pos,-1)),this.writtenTo=r,n>r&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=n}point(e,n,r){if(e<n||r.heightRelevant){let i=r.widget?r.widget.estimatedHeight:0,s=r.widget?r.widget.lineBreaks:0;i<0&&(i=this.oracle.lineHeight);let o=n-e;r.block?this.addBlock(new Z9(o,i,r)):(o||s||i>=gSe)&&this.addLineDeco(i,s,o)}else n>e&&this.span(e,n);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:n}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=n,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new xs(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,n){let r=new ii(n-e);return this.oracle.doc.lineAt(e).to==n&&(r.flags|=4),r}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof xs)return e;let n=new xs(0,-1);return this.nodes.push(n),n}addBlock(e){this.enterLine();let n=e.deco;n&&n.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,n&&n.endSide>0&&(this.covering=e)}addLineDeco(e,n,r){let i=this.ensureLine();i.length+=r,i.collapsed+=r,i.widgetHeight=Math.max(i.widgetHeight,e),i.breaks+=n,this.writtenTo=this.pos=this.pos+r}finish(e){let n=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(n instanceof xs)&&!this.isCovered?this.nodes.push(new xs(0,-1)):(this.writtenTo<this.pos||n==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let r=e;for(let i of this.nodes)i instanceof xs&&i.updateHeight(this.oracle,r),r+=i?i.length:1;return this.nodes}static build(e,n,r,i){let s=new xN(r,e);return $n.spans(n,r,i,s,0),s.finish(r)}}function vSe(t,e,n){let r=new ySe;return $n.compare(t,e,n,r,0),r.changes}class ySe{constructor(){this.changes=[]}compareRange(){}comparePoint(e,n,r,i){(e<n||r&&r.heightRelevant||i&&i.heightRelevant)&&Hb(e,n,this.changes,5)}}function xSe(t,e){let n=t.getBoundingClientRect(),r=t.ownerDocument,i=r.defaultView||window,s=Math.max(0,n.left),o=Math.min(i.innerWidth,n.right),a=Math.max(0,n.top),l=Math.min(i.innerHeight,n.bottom);for(let c=t.parentNode;c&&c!=r.body;)if(c.nodeType==1){let d=c,h=window.getComputedStyle(d);if((d.scrollHeight>d.clientHeight||d.scrollWidth>d.clientWidth)&&h.overflow!="visible"){let p=d.getBoundingClientRect();s=Math.max(s,p.left),o=Math.min(o,p.right),a=Math.max(a,p.top),l=Math.min(c==t.parentNode?i.innerHeight:l,p.bottom)}c=h.position=="absolute"||h.position=="fixed"?d.offsetParent:d.parentNode}else if(c.nodeType==11)c=c.host;else break;return{left:s-n.left,right:Math.max(s,o)-n.left,top:a-(n.top+e),bottom:Math.max(a,l)-(n.top+e)}}function bSe(t){let e=t.getBoundingClientRect(),n=t.ownerDocument.defaultView||window;return e.left<n.innerWidth&&e.right>0&&e.top<n.innerHeight&&e.bottom>0}function wSe(t,e){let n=t.getBoundingClientRect();return{left:0,right:n.right-n.left,top:e,bottom:n.bottom-(n.top+e)}}class rS{constructor(e,n,r,i){this.from=e,this.to=n,this.size=r,this.displaySize=i}static same(e,n){if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++){let i=e[r],s=n[r];if(i.from!=s.from||i.to!=s.to||i.size!=s.size)return!1}return!0}draw(e,n){return sn.replace({widget:new _Se(this.displaySize*(n?e.scaleY:e.scaleX),n)}).range(this.from,this.to)}}class _Se extends Xf{constructor(e,n){super(),this.size=e,this.vertical=n}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class nL{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=rL,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=gr.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let n=e.facet(gN).some(r=>typeof r!="function"&&r.class=="cm-lineWrapping");this.heightOracle=new pSe(n),this.stateDeco=e.facet(Jg).filter(r=>typeof r!="function"),this.heightMap=Vi.empty().applyChanges(this.stateDeco,ln.empty,this.heightOracle.setDoc(e.doc),[new no(0,0,0,e.doc.length)]);for(let r=0;r<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());r++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=sn.set(this.lineGaps.map(r=>r.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:n}=this.state.selection;for(let r=0;r<=1;r++){let i=r?n.head:n.anchor;if(!e.some(({from:s,to:o})=>i>=s&&i<=o)){let{from:s,to:o}=this.lineBlockAt(i);e.push(new Fx(s,o))}}return this.viewports=e.sort((r,i)=>r.from-i.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?rL:new bN(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(Ym(e,this.scaler))})}update(e,n=null){this.state=e.state;let r=this.stateDeco;this.stateDeco=this.state.facet(Jg).filter(d=>typeof d!="function");let i=e.changedRanges,s=no.extendWithRanges(i,vSe(r,this.stateDeco,e?e.changes:qr.empty(this.state.doc.length))),o=this.heightMap.height,a=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);eL(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),s),(this.heightMap.height!=o||lf)&&(e.flags|=2),a?(this.scrollAnchorPos=e.changes.mapPos(a.from,-1),this.scrollAnchorHeight=a.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=o);let l=s.length?this.mapViewport(this.viewport,e.changes):this.viewport;(n&&(n.range.head<l.from||n.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,n));let c=l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,e.flags|=this.updateForViewport(),(c||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),n&&(this.scrollTarget=n),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(CEe)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let n=e.contentDOM,r=window.getComputedStyle(n),i=this.heightOracle,s=r.whiteSpace;this.defaultTextDirection=r.direction=="rtl"?gr.RTL:gr.LTR;let o=this.heightOracle.mustRefreshForWrapping(s),a=n.getBoundingClientRect(),l=o||this.mustMeasureContent||this.contentDOMHeight!=a.height;this.contentDOMHeight=a.height,this.mustMeasureContent=!1;let c=0,d=0;if(a.width&&a.height){let{scaleX:w,scaleY:E}=a9(n,a);(w>.005&&Math.abs(this.scaleX-w)>.005||E>.005&&Math.abs(this.scaleY-E)>.005)&&(this.scaleX=w,this.scaleY=E,c|=16,o=l=!0)}let h=(parseInt(r.paddingTop)||0)*this.scaleY,p=(parseInt(r.paddingBottom)||0)*this.scaleY;(this.paddingTop!=h||this.paddingBottom!=p)&&(this.paddingTop=h,this.paddingBottom=p,c|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(i.lineWrapping&&(l=!0),this.editorWidth=e.scrollDOM.clientWidth,c|=16);let f=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=f&&(this.scrollAnchorHeight=-1,this.scrollTop=f),this.scrolledToBottom=u9(e.scrollDOM);let m=(this.printing?wSe:xSe)(n,this.paddingTop),g=m.top-this.pixelViewport.top,v=m.bottom-this.pixelViewport.bottom;this.pixelViewport=m;let b=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(b!=this.inView&&(this.inView=b,b&&(l=!0)),!this.inView&&!this.scrollTarget&&!bSe(e.dom))return 0;let x=a.width;if((this.contentDOMWidth!=x||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=a.width,this.editorHeight=e.scrollDOM.clientHeight,c|=16),l){let w=e.docView.measureVisibleLineHeights(this.viewport);if(i.mustRefreshForHeights(w)&&(o=!0),o||i.lineWrapping&&Math.abs(x-this.contentDOMWidth)>i.charWidth){let{lineHeight:E,charWidth:S,textHeight:j}=e.docView.measureTextSize();o=E>0&&i.refresh(s,E,S,j,Math.max(5,x/S),w),o&&(e.docView.minWidth=0,c|=16)}g>0&&v>0?d=Math.max(g,v):g<0&&v<0&&(d=Math.min(g,v)),eL();for(let E of this.viewports){let S=E.from==this.viewport.from?w:e.docView.measureVisibleLineHeights(E);this.heightMap=(o?Vi.empty().applyChanges(this.stateDeco,ln.empty,this.heightOracle,[new no(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(i,0,o,new fSe(E.from,S))}lf&&(c|=2)}let y=!this.viewportIsAppropriate(this.viewport,d)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return y&&(c&2&&(c|=this.updateScaler()),this.viewport=this.getViewport(d,this.scrollTarget),c|=this.updateForViewport()),(c&2||y)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,e)),c|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),c}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,n){let r=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),i=this.heightMap,s=this.heightOracle,{visibleTop:o,visibleBottom:a}=this,l=new Fx(i.lineAt(o-r*1e3,Fn.ByHeight,s,0,0).from,i.lineAt(a+(1-r)*1e3,Fn.ByHeight,s,0,0).to);if(n){let{head:c}=n.range;if(c<l.from||c>l.to){let d=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),h=i.lineAt(c,Fn.ByPos,s,0,0),p;n.y=="center"?p=(h.top+h.bottom)/2-d/2:n.y=="start"||n.y=="nearest"&&c<l.from?p=h.top:p=h.bottom-d,l=new Fx(i.lineAt(p-1e3/2,Fn.ByHeight,s,0,0).from,i.lineAt(p+d+1e3/2,Fn.ByHeight,s,0,0).to)}}return l}mapViewport(e,n){let r=n.mapPos(e.from,-1),i=n.mapPos(e.to,1);return new Fx(this.heightMap.lineAt(r,Fn.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(i,Fn.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:n},r=0){if(!this.inView)return!0;let{top:i}=this.heightMap.lineAt(e,Fn.ByPos,this.heightOracle,0,0),{bottom:s}=this.heightMap.lineAt(n,Fn.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:a}=this;return(e==0||i<=o-Math.max(10,Math.min(-r,250)))&&(n==this.state.doc.length||s>=a+Math.max(10,Math.min(r,250)))&&i>o-2*1e3&&s<a+2*1e3}mapLineGaps(e,n){if(!e.length||n.empty)return e;let r=[];for(let i of e)n.touchesRange(i.from,i.to)||r.push(new rS(n.mapPos(i.from),n.mapPos(i.to),i.size,i.displaySize));return r}ensureLineGaps(e,n){let r=this.heightOracle.lineWrapping,i=r?1e4:2e3,s=i>>1,o=i<<1;if(this.defaultTextDirection!=gr.LTR&&!r)return[];let a=[],l=(d,h,p,f)=>{if(h-d<s)return;let m=this.state.selection.main,g=[m.from];m.empty||g.push(m.to);for(let b of g)if(b>d&&b<h){l(d,b-10,p,f),l(b+10,h,p,f);return}let v=SSe(e,b=>b.from>=p.from&&b.to<=p.to&&Math.abs(b.from-d)<s&&Math.abs(b.to-h)<s&&!g.some(x=>b.from<x&&b.to>x));if(!v){if(h<p.to&&n&&r&&n.visibleRanges.some(y=>y.from<=h&&y.to>=h)){let y=n.moveToLineBoundary(ue.cursor(h),!1,!0).head;y>d&&(h=y)}let b=this.gapSize(p,d,h,f),x=r||b<2e6?b:2e6;v=new rS(d,h,b,x)}a.push(v)},c=d=>{if(d.length<o||d.type!=Na.Text)return;let h=ESe(d.from,d.to,this.stateDeco);if(h.total<o)return;let p=this.scrollTarget?this.scrollTarget.range.head:null,f,m;if(r){let g=i/this.heightOracle.lineLength*this.heightOracle.lineHeight,v,b;if(p!=null){let x=Hx(h,p),y=((this.visibleBottom-this.visibleTop)/2+g)/d.height;v=x-y,b=x+y}else v=(this.visibleTop-d.top-g)/d.height,b=(this.visibleBottom-d.top+g)/d.height;f=zx(h,v),m=zx(h,b)}else{let g=h.total*this.heightOracle.charWidth,v=i*this.heightOracle.charWidth,b=0;if(g>2e6)for(let S of e)S.from>=d.from&&S.from<d.to&&S.size!=S.displaySize&&S.from*this.heightOracle.charWidth+b<this.pixelViewport.left&&(b=S.size-S.displaySize);let x=this.pixelViewport.left+b,y=this.pixelViewport.right+b,w,E;if(p!=null){let S=Hx(h,p),j=((y-x)/2+v)/g;w=S-j,E=S+j}else w=(x-v)/g,E=(y+v)/g;f=zx(h,w),m=zx(h,E)}f>d.from&&l(d.from,f,d,h),m<d.to&&l(m,d.to,d,h)};for(let d of this.viewportLines)Array.isArray(d.type)?d.type.forEach(c):c(d);return a}gapSize(e,n,r,i){let s=Hx(i,r)-Hx(i,n);return this.heightOracle.lineWrapping?e.height*s:i.total*this.heightOracle.charWidth*s}updateLineGaps(e){rS.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=sn.set(e.map(n=>n.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let n=this.stateDeco;this.lineGaps.length&&(n=n.concat(this.lineGapDeco));let r=[];$n.spans(n,this.viewport.from,this.viewport.to,{span(s,o){r.push({from:s,to:o})},point(){}},20);let i=0;if(r.length!=this.visibleRanges.length)i=12;else for(let s=0;s<r.length&&!(i&8);s++){let o=this.visibleRanges[s],a=r[s];(o.from!=a.from||o.to!=a.to)&&(i|=4,e&&e.mapPos(o.from,-1)==a.from&&e.mapPos(o.to,1)==a.to||(i|=8))}return this.visibleRanges=r,i}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(n=>n.from<=e&&n.to>=e)||Ym(this.heightMap.lineAt(e,Fn.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(n=>n.top<=e&&n.bottom>=e)||Ym(this.heightMap.lineAt(this.scaler.fromDOM(e),Fn.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let n=this.lineBlockAtHeight(e+8);return n.from>=this.viewport.from||this.viewportLines[0].top-e>200?n:this.viewportLines[0]}elementAtHeight(e){return Ym(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}let Fx=class{constructor(e,n){this.from=e,this.to=n}};function ESe(t,e,n){let r=[],i=t,s=0;return $n.spans(n,t,e,{span(){},point(o,a){o>i&&(r.push({from:i,to:o}),s+=o-i),i=a}},20),i<e&&(r.push({from:i,to:e}),s+=e-i),{total:s,ranges:r}}function zx({total:t,ranges:e},n){if(n<=0)return e[0].from;if(n>=1)return e[e.length-1].to;let r=Math.floor(t*n);for(let i=0;;i++){let{from:s,to:o}=e[i],a=o-s;if(r<=a)return s+r;r-=a}}function Hx(t,e){let n=0;for(let{from:r,to:i}of t.ranges){if(e<=i){n+=e-r;break}n+=i-r}return n/t.total}function SSe(t,e){for(let n of t)if(e(n))return n}const rL={toDOM(t){return t},fromDOM(t){return t},scale:1,eq(t){return t==this}};class bN{constructor(e,n,r){let i=0,s=0,o=0;this.viewports=r.map(({from:a,to:l})=>{let c=n.lineAt(a,Fn.ByPos,e,0,0).top,d=n.lineAt(l,Fn.ByPos,e,0,0).bottom;return i+=d-c,{from:a,to:l,top:c,bottom:d,domTop:0,domBottom:0}}),this.scale=(7e6-i)/(n.height-i);for(let a of this.viewports)a.domTop=o+(a.top-s)*this.scale,o=a.domBottom=a.domTop+(a.bottom-a.top),s=a.bottom}toDOM(e){for(let n=0,r=0,i=0;;n++){let s=n<this.viewports.length?this.viewports[n]:null;if(!s||e<s.top)return i+(e-r)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);r=s.bottom,i=s.domBottom}}fromDOM(e){for(let n=0,r=0,i=0;;n++){let s=n<this.viewports.length?this.viewports[n]:null;if(!s||e<s.domTop)return r+(e-i)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);r=s.bottom,i=s.domBottom}}eq(e){return e instanceof bN?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((n,r)=>n.from==e.viewports[r].from&&n.to==e.viewports[r].to):!1}}function Ym(t,e){if(e.scale==1)return t;let n=e.toDOM(t.top),r=e.toDOM(t.bottom);return new Sa(t.from,t.length,n,r-n,Array.isArray(t._content)?t._content.map(i=>Ym(i,e)):t._content)}const Ux=it.define({combine:t=>t.join(" ")}),Mj=it.define({combine:t=>t.indexOf(!0)>-1}),Lj=Uc.newName(),J9=Uc.newName(),eW=Uc.newName(),tW={"&light":"."+J9,"&dark":"."+eW};function Bj(t,e,n){return new Uc(e,{finish(r){return/&/.test(r)?r.replace(/&\w*/,i=>{if(i=="&")return t;if(!n||!n[i])throw new RangeError(`Unsupported selector: ${i}`);return n[i]}):t+" "+r}})}const CSe=Bj("."+Lj,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},tW),jSe={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},iS=$e.ie&&$e.ie_version<=11;class kSe{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new aEe,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(n=>{for(let r of n)this.queue.push(r);($e.ie&&$e.ie_version<=11||$e.ios&&e.composing)&&n.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&$e.android&&e.constructor.EDIT_CONTEXT!==!1&&!($e.chrome&&$e.chrome_version<126)&&(this.editContext=new TSe(e),e.state.facet(cl)&&(e.contentDOM.editContext=this.editContext.editContext)),iS&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var n;((n=this.view.docView)===null||n===void 0?void 0:n.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(n=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),n.length>0&&n[n.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(n=>{n.length>0&&n[n.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){(e.type=="change"||!e.type)&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((n,r)=>n!=e[r]))){this.gapIntersection.disconnect();for(let n of e)this.gapIntersection.observe(n);this.gaps=e}}onSelectionChange(e){let n=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:r}=this,i=this.selectionRange;if(r.state.facet(cl)?r.root.activeElement!=this.dom:!zb(this.dom,i))return;let s=i.anchorNode&&r.docView.nearest(i.anchorNode);if(s&&s.ignoreEvent(e)){n||(this.selectionChanged=!1);return}($e.ie&&$e.ie_version<=11||$e.android&&$e.chrome)&&!r.state.selection.main.empty&&i.focusNode&&bg(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,n=Zg(e.root);if(!n)return!1;let r=$e.safari&&e.root.nodeType==11&&e.root.activeElement==this.dom&&PSe(this.view,n)||n;if(!r||this.selectionRange.eq(r))return!1;let i=zb(this.dom,r);return i&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&cEe(this.dom,r)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(r),i&&(this.selectionChanged=!0),!0)}setSelectionRange(e,n){this.selectionRange.set(e.node,e.offset,n.node,n.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,n=null;for(let r=this.dom;r;)if(r.nodeType==1)!n&&e<this.scrollTargets.length&&this.scrollTargets[e]==r?e++:n||(n=this.scrollTargets.slice(0,e)),n&&n.push(r),r=r.assignedSlot||r.parentNode;else if(r.nodeType==11)r=r.host;else break;if(e<this.scrollTargets.length&&!n&&(n=this.scrollTargets.slice(0,e)),n){for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);for(let r of this.scrollTargets=n)r.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,jSe),iS&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),iS&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,n){var r;if(!this.delayedAndroidKey){let i=()=>{let s=this.delayedAndroidKey;s&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=s.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&s.force&&wp(this.dom,s.key,s.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(i)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:n,force:this.lastChange<Date.now()-50||!!(!((r=this.delayedAndroidKey)===null||r===void 0)&&r.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let n=-1,r=-1,i=!1;for(let s of e){let o=this.readMutation(s);o&&(o.typeOver&&(i=!0),n==-1?{from:n,to:r}=o:(n=Math.min(o.from,n),r=Math.max(o.to,r)))}return{from:n,to:r,typeOver:i}}readChange(){let{from:e,to:n,typeOver:r}=this.processRecords(),i=this.selectionChanged&&zb(this.dom,this.selectionRange);if(e<0&&!i)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let s=new WEe(this.view,e,n,r);return this.view.docView.domChanged={newSel:s.newSel?s.newSel.main:null},s}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let n=this.readChange();if(!n)return this.view.requestMeasure(),!1;let r=this.view.state,i=H9(this.view,n);return this.view.state==r&&(n.domChanged||n.newSel&&!n.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),i}readMutation(e){let n=this.view.docView.nearest(e.target);if(!n||n.ignoreMutation(e))return null;if(n.markDirty(e.type=="attributes"),e.type=="attributes"&&(n.flags|=4),e.type=="childList"){let r=iL(n,e.previousSibling||e.target.previousSibling,-1),i=iL(n,e.nextSibling||e.target.nextSibling,1);return{from:r?n.posAfter(r):n.posAtStart,to:i?n.posBefore(i):n.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(cl)!=e.state.facet(cl)&&(e.view.contentDOM.editContext=e.state.facet(cl)?this.editContext.editContext:null))}destroy(){var e,n,r;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(n=this.gapIntersection)===null||n===void 0||n.disconnect(),(r=this.resizeScroll)===null||r===void 0||r.disconnect();for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function iL(t,e,n){for(;e;){let r=On.get(e);if(r&&r.parent==t)return r;let i=e.parentNode;e=i!=t.dom?i:n>0?e.nextSibling:e.previousSibling}return null}function sL(t,e){let n=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,o=t.docView.domAtPos(t.state.selection.main.anchor);return bg(o.node,o.offset,i,s)&&([n,r,i,s]=[i,s,n,r]),{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:s}}function PSe(t,e){if(e.getComposedRanges){let i=e.getComposedRanges(t.root)[0];if(i)return sL(t,i)}let n=null;function r(i){i.preventDefault(),i.stopImmediatePropagation(),n=i.getTargetRanges()[0]}return t.contentDOM.addEventListener("beforeinput",r,!0),t.dom.ownerDocument.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",r,!0),n?sL(t,n):null}class TSe{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let n=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=r=>{let i=e.state.selection.main,{anchor:s,head:o}=i,a=this.toEditorPos(r.updateRangeStart),l=this.toEditorPos(r.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:r.updateRangeStart,editorBase:a,drifted:!1});let c=l-a>r.text.length;a==this.from&&s<this.from?a=s:l==this.to&&s>this.to&&(l=s);let d=U9(e.state.sliceDoc(a,l),r.text,(c?i.from:i.to)-a,c?"end":null);if(!d){let p=ue.single(this.toEditorPos(r.selectionStart),this.toEditorPos(r.selectionEnd));p.main.eq(i)||e.dispatch({selection:p,userEvent:"select"});return}let h={from:d.from+a,to:d.toA+a,insert:ln.of(r.text.slice(d.from,d.toB).split(`
`))};if(($e.mac||$e.android)&&h.from==o-1&&/^\. ?$/.test(r.text)&&e.contentDOM.getAttribute("autocorrect")=="off"&&(h={from:a,to:l,insert:ln.of([r.text.replace("."," ")])}),this.pendingContextChange=h,!e.state.readOnly){let p=this.to-this.from+(h.to-h.from+h.insert.length);yN(e,h,ue.single(this.toEditorPos(r.selectionStart,p),this.toEditorPos(r.selectionEnd,p)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state)),h.from<h.to&&!h.insert.length&&e.inputState.composing>=0&&!/[\\p{Alphabetic}\\p{Number}_]/.test(n.text.slice(Math.max(0,r.updateRangeStart-1),Math.min(n.text.length,r.updateRangeStart+1)))&&this.handlers.compositionend(r)},this.handlers.characterboundsupdate=r=>{let i=[],s=null;for(let o=this.toEditorPos(r.rangeStart),a=this.toEditorPos(r.rangeEnd);o<a;o++){let l=e.coordsForChar(o);s=l&&new DOMRect(l.left,l.top,l.right-l.left,l.bottom-l.top)||s||new DOMRect,i.push(s)}n.updateCharacterBounds(r.rangeStart,i)},this.handlers.textformatupdate=r=>{let i=[];for(let s of r.getTextFormats()){let o=s.underlineStyle,a=s.underlineThickness;if(!/none/i.test(o)&&!/none/i.test(a)){let l=this.toEditorPos(s.rangeStart),c=this.toEditorPos(s.rangeEnd);if(l<c){let d=`text-decoration: underline ${/^[a-z]/.test(o)?o+" ":o=="Dashed"?"dashed ":o=="Squiggle"?"wavy ":""}${/thin/i.test(a)?1:2}px`;i.push(sn.mark({attributes:{style:d}}).range(l,c))}}}e.dispatch({effects:A9.of(sn.set(i))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:r}=this.composing;this.composing=null,r&&this.reset(e.state)}};for(let r in this.handlers)n.addEventListener(r,this.handlers[r]);this.measureReq={read:r=>{this.editContext.updateControlBounds(r.contentDOM.getBoundingClientRect());let i=Zg(r.root);i&&i.rangeCount&&this.editContext.updateSelectionBounds(i.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let n=0,r=!1,i=this.pendingContextChange;return e.changes.iterChanges((s,o,a,l,c)=>{if(r)return;let d=c.length-(o-s);if(i&&o>=i.to)if(i.from==s&&i.to==o&&i.insert.eq(c)){i=this.pendingContextChange=null,n+=d,this.to+=d;return}else i=null,this.revertPending(e.state);if(s+=n,o+=n,o<=this.from)this.from+=d,this.to+=d;else if(s<this.to){if(s<this.from||o>this.to||this.to-this.from+c.length>3e4){r=!0;return}this.editContext.updateText(this.toContextPos(s),this.toContextPos(o),c.toString()),this.to+=d}n+=d}),i&&!r&&this.revertPending(e.state),!r}update(e){let n=this.pendingContextChange,r=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(r.from,r.to)&&e.transactions.some(i=>!i.isUserEvent("input.type")&&i.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.reset(e.state)):(e.docChanged||e.selectionSet||n)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:n}=e.selection.main;this.from=Math.max(0,n-1e4),this.to=Math.min(e.doc.length,n+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let n=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(n.from),this.toContextPos(n.from+n.insert.length),e.doc.sliceString(n.from,n.to))}setSelection(e){let{main:n}=e.selection,r=this.toContextPos(Math.max(this.from,Math.min(this.to,n.anchor))),i=this.toContextPos(n.head);(this.editContext.selectionStart!=r||this.editContext.selectionEnd!=i)&&this.editContext.updateSelection(r,i)}rangeIsValid(e){let{head:n}=e.selection.main;return!(this.from>0&&n-this.from<500||this.to<e.doc.length&&this.to-n<500||this.to-this.from>1e4*3)}toEditorPos(e,n=this.to-this.from){e=Math.min(e,n);let r=this.composing;return r&&r.drifted?r.editorBase+(e-r.contextBase):e+this.from}toContextPos(e){let n=this.composing;return n&&n.drifted?n.contextBase+(e-n.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class et{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var n;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:r}=e;this.dispatchTransactions=e.dispatchTransactions||r&&(i=>i.forEach(s=>r(s,this)))||(i=>this.update(i)),this.dispatch=this.dispatch.bind(this),this._root=e.root||lEe(e.parent)||document,this.viewState=new nL(e.state||gn.create(e)),e.scrollTo&&e.scrollTo.is(Mx)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(np).map(i=>new eS(i));for(let i of this.plugins)i.update(this);this.observer=new kSe(this),this.inputState=new XEe(this),this.inputState.ensureHandlers(this.plugins),this.docView=new MM(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((n=document.fonts)===null||n===void 0)&&n.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...e){let n=e.length==1&&e[0]instanceof ai?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(n,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let n=!1,r=!1,i,s=this.state;for(let p of e){if(p.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=p.state}if(this.destroyed){this.viewState.state=s;return}let o=this.hasFocus,a=0,l=null;e.some(p=>p.annotation(Y9))?(this.inputState.notifiedFocused=o,a=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,l=X9(s,o),l||(a=1));let c=this.observer.delayedAndroidKey,d=null;if(c?(this.observer.clearDelayedAndroidKey(),d=this.observer.readChange(),(d&&!this.state.doc.eq(s.doc)||!this.state.selection.eq(s.selection))&&(d=null)):this.observer.clear(),s.facet(gn.phrases)!=this.state.facet(gn.phrases))return this.setState(s);i=F0.create(this,s,e),i.flags|=a;let h=this.viewState.scrollTarget;try{this.updateState=2;for(let p of e){if(h&&(h=h.map(p.changes)),p.scrollIntoView){let{main:f}=p.state.selection;h=new _p(f.empty?f:ue.cursor(f.head,f.head>f.anchor?-1:1))}for(let f of p.effects)f.is(Mx)&&(h=f.value.clip(this.state))}this.viewState.update(i,h),this.bidiCache=H0.update(this.bidiCache,i.changes),i.empty||(this.updatePlugins(i),this.inputState.update(i)),n=this.docView.update(i),this.state.facet(Gm)!=this.styleModules&&this.mountStyles(),r=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(n,e.some(p=>p.isUserEvent("select.pointer")))}finally{this.updateState=0}if(i.startState.facet(Ux)!=i.state.facet(Ux)&&(this.viewState.mustMeasureContent=!0),(n||r||h||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),n&&this.docViewUpdate(),!i.empty)for(let p of this.state.facet(Ij))try{p(i)}catch(f){Bi(this.state,f,"update listener")}(l||d)&&Promise.resolve().then(()=>{l&&this.state==l.startState&&this.dispatch(l),d&&!H9(this,d)&&c.force&&wp(this.contentDOM,c.key,c.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let n=this.hasFocus;try{for(let r of this.plugins)r.destroy(this);this.viewState=new nL(e),this.plugins=e.facet(np).map(r=>new eS(r)),this.pluginMap.clear();for(let r of this.plugins)r.update(this);this.docView.destroy(),this.docView=new MM(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}n&&this.focus(),this.requestMeasure()}updatePlugins(e){let n=e.startState.facet(np),r=e.state.facet(np);if(n!=r){let i=[];for(let s of r){let o=n.indexOf(s);if(o<0)i.push(new eS(s));else{let a=this.plugins[o];a.mustUpdate=e,i.push(a)}}for(let s of this.plugins)s.mustUpdate!=e&&s.destroy(this);this.plugins=i,this.pluginMap.clear()}else for(let i of this.plugins)i.mustUpdate=e;for(let i=0;i<this.plugins.length;i++)this.plugins[i].update(this);n!=r&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let n=e.value;if(n&&n.docViewUpdate)try{n.docViewUpdate(this)}catch(r){Bi(this.state,r,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let n=null,r=this.scrollDOM,i=r.scrollTop*this.scaleY,{scrollAnchorPos:s,scrollAnchorHeight:o}=this.viewState;Math.abs(i-this.viewState.scrollTop)>1&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let a=0;;a++){if(o<0)if(u9(r))s=-1,o=this.viewState.heightMap.height;else{let f=this.viewState.scrollAnchorAt(i);s=f.from,o=f.top}this.updateState=1;let l=this.viewState.measure(this);if(!l&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(a>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let c=[];l&4||([this.measureRequests,c]=[c,this.measureRequests]);let d=c.map(f=>{try{return f.read(this)}catch(m){return Bi(this.state,m),oL}}),h=F0.create(this,this.state,[]),p=!1;h.flags|=l,n?n.flags|=l:n=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),p=this.docView.update(h),p&&this.docViewUpdate());for(let f=0;f<c.length;f++)if(d[f]!=oL)try{let m=c[f];m.write&&m.write(d[f],this)}catch(m){Bi(this.state,m)}if(p&&this.docView.updateSelection(!0),!h.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,o=-1;continue}else{let m=(s<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(s).top)-o;if(m>1||m<-1){i=i+m,r.scrollTop=i/this.scaleY,o=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(n&&!n.empty)for(let a of this.state.facet(Ij))a(n)}get themeClasses(){return Lj+" "+(this.state.facet(Mj)?eW:J9)+" "+this.state.facet(Ux)}updateAttrs(){let e=aL(this,I9,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),n={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(cl)?"true":"false",class:"cm-content",style:`${$e.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(n["aria-readonly"]="true"),aL(this,gN,n);let r=this.observer.ignore(()=>{let i=Tj(this.contentDOM,this.contentAttrs,n),s=Tj(this.dom,this.editorAttrs,e);return i||s});return this.editorAttrs=e,this.contentAttrs=n,r}showAnnouncements(e){let n=!0;for(let r of e)for(let i of r.effects)if(i.is(et.announce)){n&&(this.announceDOM.textContent=""),n=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=i.value}}mountStyles(){this.styleModules=this.state.facet(Gm);let e=this.state.facet(et.cspNonce);Uc.mount(this.root,this.styleModules.concat(CSe).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let n=0;n<this.measureRequests.length;n++)if(this.measureRequests[n].key===e.key){this.measureRequests[n]=e;return}}this.measureRequests.push(e)}}plugin(e){let n=this.pluginMap.get(e);return(n===void 0||n&&n.plugin!=e)&&this.pluginMap.set(e,n=this.plugins.find(r=>r.plugin==e)||null),n&&n.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,n,r){return nS(this,e,HM(this,e,n,r))}moveByGroup(e,n){return nS(this,e,HM(this,e,n,r=>zEe(this,e.head,r)))}visualLineSide(e,n){let r=this.bidiSpans(e),i=this.textDirectionAt(e.from),s=r[n?r.length-1:0];return ue.cursor(s.side(n,i)+e.from,s.forward(!n,i)?1:-1)}moveToLineBoundary(e,n,r=!0){return FEe(this,e,n,r)}moveVertically(e,n,r){return nS(this,e,HEe(this,e,n,r))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,n=0){return this.docView.posFromDOM(e,n)}posAtCoords(e,n=!0){return this.readMeasured(),B9(this,e,n)}coordsAtPos(e,n=1){this.readMeasured();let r=this.docView.coordsAt(e,n);if(!r||r.left==r.right)return r;let i=this.state.doc.lineAt(e),s=this.bidiSpans(i),o=s[Ac.find(s,e-i.from,-1,n)];return yy(r,o.dir==gr.LTR==n>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(O9)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>NSe)return E9(e.length);let n=this.textDirectionAt(e.from),r;for(let s of this.bidiCache)if(s.from==e.from&&s.dir==n&&(s.fresh||_9(s.isolates,r=$M(this,e))))return s.order;r||(r=$M(this,e));let i=_Ee(e.text,n,r);return this.bidiCache.push(new H0(e.from,e.to,n,r,!0,i)),i}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||$e.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{l9(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,n={}){return Mx.of(new _p(typeof e=="number"?ue.cursor(e):e,n.y,n.x,n.yMargin,n.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:n}=this.scrollDOM,r=this.viewState.scrollAnchorAt(e);return Mx.of(new _p(ue.cursor(r.from),"start","start",r.top-e,n,!0))}setTabFocusMode(e){e==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof e=="boolean"?this.inputState.tabFocusMode=e?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return Ts.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return Ts.define(()=>({}),{eventObservers:e})}static theme(e,n){let r=Uc.newName(),i=[Ux.of(r),Gm.of(Bj(`.${r}`,e))];return n&&n.dark&&i.push(Mj.of(!0)),i}static baseTheme(e){return Kf.lowest(Gm.of(Bj("."+Lj,e,tW)))}static findFromDOM(e){var n;let r=e.querySelector(".cm-content"),i=r&&On.get(r)||On.get(e);return((n=i==null?void 0:i.rootView)===null||n===void 0?void 0:n.view)||null}}et.styleModule=Gm;et.inputHandler=T9;et.clipboardInputFilter=fN;et.clipboardOutputFilter=mN;et.scrollHandler=R9;et.focusChangeEffect=N9;et.perLineTextDirection=O9;et.exceptionSink=P9;et.updateListener=Ij;et.editable=cl;et.mouseSelectionStyle=k9;et.dragMovesSelection=j9;et.clickAddsSelectionRange=C9;et.decorations=Jg;et.outerDecorations=D9;et.atomicRanges=wy;et.bidiIsolatedRanges=$9;et.scrollMargins=M9;et.darkTheme=Mj;et.cspNonce=it.define({combine:t=>t.length?t[0]:""});et.contentAttributes=gN;et.editorAttributes=I9;et.lineWrapping=et.contentAttributes.of({class:"cm-lineWrapping"});et.announce=dn.define();const NSe=4096,oL={};class H0{constructor(e,n,r,i,s,o){this.from=e,this.to=n,this.dir=r,this.isolates=i,this.fresh=s,this.order=o}static update(e,n){if(n.empty&&!e.some(s=>s.fresh))return e;let r=[],i=e.length?e[e.length-1].dir:gr.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let o=e[s];o.dir==i&&!n.touchesRange(o.from,o.to)&&r.push(new H0(n.mapPos(o.from,1),n.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return r}}function aL(t,e,n){for(let r=t.state.facet(e),i=r.length-1;i>=0;i--){let s=r[i],o=typeof s=="function"?s(t):s;o&&Pj(o,n)}return n}const OSe=$e.mac?"mac":$e.windows?"win":$e.linux?"linux":"key";function RSe(t,e){const n=t.split(/-(?!$)/);let r=n[n.length-1];r=="Space"&&(r=" ");let i,s,o,a;for(let l=0;l<n.length-1;++l){const c=n[l];if(/^(cmd|meta|m)$/i.test(c))a=!0;else if(/^a(lt)?$/i.test(c))i=!0;else if(/^(c|ctrl|control)$/i.test(c))s=!0;else if(/^s(hift)?$/i.test(c))o=!0;else if(/^mod$/i.test(c))e=="mac"?a=!0:s=!0;else throw new Error("Unrecognized modifier name: "+c)}return i&&(r="Alt-"+r),s&&(r="Ctrl-"+r),a&&(r="Meta-"+r),o&&(r="Shift-"+r),r}function Vx(t,e,n){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n!==!1&&e.shiftKey&&(t="Shift-"+t),t}const ASe=Kf.default(et.domEventHandlers({keydown(t,e){return MSe(ISe(e.state),t,e,"editor")}})),o1=it.define({enables:ASe}),lL=new WeakMap;function ISe(t){let e=t.facet(o1),n=lL.get(e);return n||lL.set(e,n=$Se(e.reduce((r,i)=>r.concat(i),[]))),n}let Sc=null;const DSe=4e3;function $Se(t,e=OSe){let n=Object.create(null),r=Object.create(null),i=(o,a)=>{let l=r[o];if(l==null)r[o]=a;else if(l!=a)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},s=(o,a,l,c,d)=>{var h,p;let f=n[o]||(n[o]=Object.create(null)),m=a.split(/ (?!$)/).map(b=>RSe(b,e));for(let b=1;b<m.length;b++){let x=m.slice(0,b).join(" ");i(x,!0),f[x]||(f[x]={preventDefault:!0,stopPropagation:!1,run:[y=>{let w=Sc={view:y,prefix:x,scope:o};return setTimeout(()=>{Sc==w&&(Sc=null)},DSe),!0}]})}let g=m.join(" ");i(g,!1);let v=f[g]||(f[g]={preventDefault:!1,stopPropagation:!1,run:((p=(h=f._any)===null||h===void 0?void 0:h.run)===null||p===void 0?void 0:p.slice())||[]});l&&v.run.push(l),c&&(v.preventDefault=!0),d&&(v.stopPropagation=!0)};for(let o of t){let a=o.scope?o.scope.split(" "):["editor"];if(o.any)for(let c of a){let d=n[c]||(n[c]=Object.create(null));d._any||(d._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:h}=o;for(let p in d)d[p].run.push(f=>h(f,Fj))}let l=o[e]||o.key;if(l)for(let c of a)s(c,l,o.run,o.preventDefault,o.stopPropagation),o.shift&&s(c,"Shift-"+l,o.shift,o.preventDefault,o.stopPropagation)}return n}let Fj=null;function MSe(t,e,n,r){Fj=e;let i=nEe(e),s=wa(i,0),o=Ec(s)==i.length&&i!=" ",a="",l=!1,c=!1,d=!1;Sc&&Sc.view==n&&Sc.scope==r&&(a=Sc.prefix+" ",q9.indexOf(e.keyCode)<0&&(c=!0,Sc=null));let h=new Set,p=v=>{if(v){for(let b of v.run)if(!h.has(b)&&(h.add(b),b(n)))return v.stopPropagation&&(d=!0),!0;v.preventDefault&&(v.stopPropagation&&(d=!0),c=!0)}return!1},f=t[r],m,g;return f&&(p(f[a+Vx(i,e,!o)])?l=!0:o&&(e.altKey||e.metaKey||e.ctrlKey)&&!($e.windows&&e.ctrlKey&&e.altKey)&&!($e.mac&&e.altKey&&!(e.ctrlKey||e.metaKey))&&(m=Vc[e.keyCode])&&m!=i?(p(f[a+Vx(m,e,!0)])||e.shiftKey&&(g=Qg[e.keyCode])!=i&&g!=m&&p(f[a+Vx(g,e,!1)]))&&(l=!0):o&&e.shiftKey&&p(f[a+Vx(i,e,!0)])&&(l=!0),!l&&p(f._any)&&(l=!0)),c&&(l=!0),l&&d&&e.stopPropagation(),Fj=null,l}class LSe extends Xf{constructor(e){super(),this.content=e}toDOM(e){let n=document.createElement("span");return n.className="cm-placeholder",n.style.pointerEvents="none",n.appendChild(typeof this.content=="string"?document.createTextNode(this.content):typeof this.content=="function"?this.content(e):this.content.cloneNode(!0)),n.setAttribute("aria-hidden","true"),n}coordsAt(e){let n=e.firstChild?sf(e.firstChild):[];if(!n.length)return null;let r=window.getComputedStyle(e.parentNode),i=yy(n[0],r.direction!="rtl"),s=parseInt(r.lineHeight);return i.bottom-i.top>s*1.5?{left:i.left,right:i.right,top:i.top,bottom:i.top+s}:i}ignoreEvent(){return!1}}function nW(t){let e=Ts.fromClass(class{constructor(n){this.view=n,this.placeholder=t?sn.set([sn.widget({widget:new LSe(t),side:1}).range(0)]):sn.none}get decorations(){return this.view.state.doc.length?sn.none:this.placeholder}},{decorations:n=>n.decorations});return typeof t=="string"?[e,et.contentAttributes.of({"aria-placeholder":t})]:e}const qx="-10000px";class rW{constructor(e,n,r,i){this.facet=n,this.createTooltipView=r,this.removeTooltipView=i,this.input=e.state.facet(n),this.tooltips=this.input.filter(o=>o);let s=null;this.tooltipViews=this.tooltips.map(o=>s=r(o,s))}update(e,n){var r;let i=e.state.facet(this.facet),s=i.filter(l=>l);if(i===this.input){for(let l of this.tooltipViews)l.update&&l.update(e);return!1}let o=[],a=n?[]:null;for(let l=0;l<s.length;l++){let c=s[l],d=-1;if(c){for(let h=0;h<this.tooltips.length;h++){let p=this.tooltips[h];p&&p.create==c.create&&(d=h)}if(d<0)o[l]=this.createTooltipView(c,l?o[l-1]:null),a&&(a[l]=!!c.above);else{let h=o[l]=this.tooltipViews[d];a&&(a[l]=n[d]),h.update&&h.update(e)}}}for(let l of this.tooltipViews)o.indexOf(l)<0&&(this.removeTooltipView(l),(r=l.destroy)===null||r===void 0||r.call(l));return n&&(a.forEach((l,c)=>n[c]=l),n.length=a.length),this.input=i,this.tooltips=s,this.tooltipViews=o,!0}}function BSe(t={}){return Vb.of(t)}function FSe(t){let e=t.dom.ownerDocument.documentElement;return{top:0,left:0,bottom:e.clientHeight,right:e.clientWidth}}const Vb=it.define({combine:t=>{var e,n,r;return{position:$e.ios?"absolute":((e=t.find(i=>i.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((n=t.find(i=>i.parent))===null||n===void 0?void 0:n.parent)||null,tooltipSpace:((r=t.find(i=>i.tooltipSpace))===null||r===void 0?void 0:r.tooltipSpace)||FSe}}}),cL=new WeakMap,wN=Ts.fromClass(class{constructor(t){this.view=t,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let e=t.state.facet(Vb);this.position=e.position,this.parent=e.parent,this.classes=t.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new rW(t,_N,(n,r)=>this.createTooltip(n,r),n=>{this.resizeObserver&&this.resizeObserver.unobserve(n.dom),n.dom.remove()}),this.above=this.manager.tooltips.map(n=>!!n.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(n=>{Date.now()>this.lastTransaction-50&&n.length>0&&n[n.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),t.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let t of this.manager.tooltipViews)this.intersectionObserver.observe(t.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(t){t.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(t,this.above);e&&this.observeIntersection();let n=e||t.geometryChanged,r=t.state.facet(Vb);if(r.position!=this.position&&!this.madeAbsolute){this.position=r.position;for(let i of this.manager.tooltipViews)i.dom.style.position=this.position;n=!0}if(r.parent!=this.parent){this.parent&&this.container.remove(),this.parent=r.parent,this.createContainer();for(let i of this.manager.tooltipViews)this.container.appendChild(i.dom);n=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);n&&this.maybeMeasure()}createTooltip(t,e){let n=t.create(this.view),r=e?e.dom:null;if(n.dom.classList.add("cm-tooltip"),t.arrow&&!n.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let i=document.createElement("div");i.className="cm-tooltip-arrow",n.dom.appendChild(i)}return n.dom.style.position=this.position,n.dom.style.top=qx,n.dom.style.left="0px",this.container.insertBefore(n.dom,r),n.mount&&n.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(n.dom),n}destroy(){var t,e,n;this.view.win.removeEventListener("resize",this.measureSoon);for(let r of this.manager.tooltipViews)r.dom.remove(),(t=r.destroy)===null||t===void 0||t.call(r);this.parent&&this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),(n=this.intersectionObserver)===null||n===void 0||n.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let t=1,e=1,n=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:s}=this.manager.tooltipViews[0];if($e.safari){let o=s.getBoundingClientRect();n=Math.abs(o.top+1e4)>1||Math.abs(o.left)>1}else n=!!s.offsetParent&&s.offsetParent!=this.container.ownerDocument.body}if(n||this.position=="absolute")if(this.parent){let s=this.parent.getBoundingClientRect();s.width&&s.height&&(t=s.width/this.parent.offsetWidth,e=s.height/this.parent.offsetHeight)}else({scaleX:t,scaleY:e}=this.view.viewState);let r=this.view.scrollDOM.getBoundingClientRect(),i=vN(this.view);return{visible:{left:r.left+i.left,top:r.top+i.top,right:r.right-i.right,bottom:r.bottom-i.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map((s,o)=>{let a=this.manager.tooltipViews[o];return a.getCoords?a.getCoords(s.pos):this.view.coordsAtPos(s.pos)}),size:this.manager.tooltipViews.map(({dom:s})=>s.getBoundingClientRect()),space:this.view.state.facet(Vb).tooltipSpace(this.view),scaleX:t,scaleY:e,makeAbsolute:n}}writeMeasure(t){var e;if(t.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let a of this.manager.tooltipViews)a.dom.style.position="absolute"}let{visible:n,space:r,scaleX:i,scaleY:s}=t,o=[];for(let a=0;a<this.manager.tooltips.length;a++){let l=this.manager.tooltips[a],c=this.manager.tooltipViews[a],{dom:d}=c,h=t.pos[a],p=t.size[a];if(!h||l.clip!==!1&&(h.bottom<=Math.max(n.top,r.top)||h.top>=Math.min(n.bottom,r.bottom)||h.right<Math.max(n.left,r.left)-.1||h.left>Math.min(n.right,r.right)+.1)){d.style.top=qx;continue}let f=l.arrow?c.dom.querySelector(".cm-tooltip-arrow"):null,m=f?7:0,g=p.right-p.left,v=(e=cL.get(c))!==null&&e!==void 0?e:p.bottom-p.top,b=c.offset||HSe,x=this.view.textDirection==gr.LTR,y=p.width>r.right-r.left?x?r.left:r.right-p.width:x?Math.max(r.left,Math.min(h.left-(f?14:0)+b.x,r.right-g)):Math.min(Math.max(r.left,h.left-g+(f?14:0)-b.x),r.right-g),w=this.above[a];!l.strictSide&&(w?h.top-v-m-b.y<r.top:h.bottom+v+m+b.y>r.bottom)&&w==r.bottom-h.bottom>h.top-r.top&&(w=this.above[a]=!w);let E=(w?h.top-r.top:r.bottom-h.bottom)-m;if(E<v&&c.resize!==!1){if(E<this.view.defaultLineHeight){d.style.top=qx;continue}cL.set(c,v),d.style.height=(v=E)/s+"px"}else d.style.height&&(d.style.height="");let S=w?h.top-v-m-b.y:h.bottom+m+b.y,j=y+g;if(c.overlap!==!0)for(let C of o)C.left<j&&C.right>y&&C.top<S+v&&C.bottom>S&&(S=w?C.top-v-2-m:C.bottom+m+2);if(this.position=="absolute"?(d.style.top=(S-t.parent.top)/s+"px",uL(d,(y-t.parent.left)/i)):(d.style.top=S/s+"px",uL(d,y/i)),f){let C=h.left+(x?b.x:-b.x)-(y+14-7);f.style.left=C/i+"px"}c.overlap!==!0&&o.push({left:y,top:S,right:j,bottom:S+v}),d.classList.toggle("cm-tooltip-above",w),d.classList.toggle("cm-tooltip-below",!w),c.positioned&&c.positioned(t.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let t of this.manager.tooltipViews)t.dom.style.top=qx}},{eventObservers:{scroll(){this.maybeMeasure()}}});function uL(t,e){let n=parseInt(t.style.left,10);(isNaN(n)||Math.abs(e-n)>1)&&(t.style.left=e+"px")}const zSe=et.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),HSe={x:0,y:0},_N=it.define({enables:[wN,zSe]}),U0=it.define({combine:t=>t.reduce((e,n)=>e.concat(n),[])});class a1{static create(e){return new a1(e)}constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new rW(e,U0,(n,r)=>this.createHostedView(n,r),n=>n.dom.remove())}createHostedView(e,n){let r=e.create(this.view);return r.dom.classList.add("cm-tooltip-section"),this.dom.insertBefore(r.dom,n?n.dom.nextSibling:this.dom.firstChild),this.mounted&&r.mount&&r.mount(this.view),r}mount(e){for(let n of this.manager.tooltipViews)n.mount&&n.mount(e);this.mounted=!0}positioned(e){for(let n of this.manager.tooltipViews)n.positioned&&n.positioned(e)}update(e){this.manager.update(e)}destroy(){var e;for(let n of this.manager.tooltipViews)(e=n.destroy)===null||e===void 0||e.call(n)}passProp(e){let n;for(let r of this.manager.tooltipViews){let i=r[e];if(i!==void 0){if(n===void 0)n=i;else if(n!==i)return}}return n}get offset(){return this.passProp("offset")}get getCoords(){return this.passProp("getCoords")}get overlap(){return this.passProp("overlap")}get resize(){return this.passProp("resize")}}const USe=_N.compute([U0],t=>{let e=t.facet(U0);return e.length===0?null:{pos:Math.min(...e.map(n=>n.pos)),end:Math.max(...e.map(n=>{var r;return(r=n.end)!==null&&r!==void 0?r:n.pos})),create:a1.create,above:e[0].above,arrow:e.some(n=>n.arrow)}});class VSe{constructor(e,n,r,i,s){this.view=e,this.source=n,this.field=r,this.setHover=i,this.hoverTime=s,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active.length)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:e,lastMove:n}=this,r=e.docView.nearest(n.target);if(!r)return;let i,s=1;if(r instanceof pl)i=r.posAtStart;else{if(i=e.posAtCoords(n),i==null)return;let a=e.coordsAtPos(i);if(!a||n.y<a.top||n.y>a.bottom||n.x<a.left-e.defaultCharacterWidth||n.x>a.right+e.defaultCharacterWidth)return;let l=e.bidiSpans(e.state.doc.lineAt(i)).find(d=>d.from<=i&&d.to>=i),c=l&&l.dir==gr.RTL?-1:1;s=n.x<a.left?-c:c}let o=this.source(e,i,s);if(o!=null&&o.then){let a=this.pending={pos:i};o.then(l=>{this.pending==a&&(this.pending=null,l&&!(Array.isArray(l)&&!l.length)&&e.dispatch({effects:this.setHover.of(Array.isArray(l)?l:[l])}))},l=>Bi(e.state,l,"hover tooltip"))}else o&&!(Array.isArray(o)&&!o.length)&&e.dispatch({effects:this.setHover.of(Array.isArray(o)?o:[o])})}get tooltip(){let e=this.view.plugin(wN),n=e?e.manager.tooltips.findIndex(r=>r.create==a1.create):-1;return n>-1?e.manager.tooltipViews[n]:null}mousemove(e){var n,r;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let{active:i,tooltip:s}=this;if(i.length&&s&&!qSe(s.dom,e)||this.pending){let{pos:o}=i[0]||this.pending,a=(r=(n=i[0])===null||n===void 0?void 0:n.end)!==null&&r!==void 0?r:o;(o==a?this.view.posAtCoords(this.lastMove)!=o:!WSe(this.view,o,a,e.clientX,e.clientY))&&(this.view.dispatch({effects:this.setHover.of([])}),this.pending=null)}}mouseleave(e){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1;let{active:n}=this;if(n.length){let{tooltip:r}=this;r&&r.dom.contains(e.relatedTarget)?this.watchTooltipLeave(r.dom):this.view.dispatch({effects:this.setHover.of([])})}}watchTooltipLeave(e){let n=r=>{e.removeEventListener("mouseleave",n),this.active.length&&!this.view.dom.contains(r.relatedTarget)&&this.view.dispatch({effects:this.setHover.of([])})};e.addEventListener("mouseleave",n)}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}const Wx=4;function qSe(t,e){let{left:n,right:r,top:i,bottom:s}=t.getBoundingClientRect(),o;if(o=t.querySelector(".cm-tooltip-arrow")){let a=o.getBoundingClientRect();i=Math.min(a.top,i),s=Math.max(a.bottom,s)}return e.clientX>=n-Wx&&e.clientX<=r+Wx&&e.clientY>=i-Wx&&e.clientY<=s+Wx}function WSe(t,e,n,r,i,s){let o=t.scrollDOM.getBoundingClientRect(),a=t.documentTop+t.documentPadding.top+t.contentHeight;if(o.left>r||o.right<r||o.top>i||Math.min(o.bottom,a)<i)return!1;let l=t.posAtCoords({x:r,y:i},!1);return l>=e&&l<=n}function GSe(t,e={}){let n=dn.define(),r=Is.define({create(){return[]},update(i,s){if(i.length&&(e.hideOnChange&&(s.docChanged||s.selection)?i=[]:e.hideOn&&(i=i.filter(o=>!e.hideOn(s,o))),s.docChanged)){let o=[];for(let a of i){let l=s.changes.mapPos(a.pos,-1,oi.TrackDel);if(l!=null){let c=Object.assign(Object.create(null),a);c.pos=l,c.end!=null&&(c.end=s.changes.mapPos(c.end)),o.push(c)}}i=o}for(let o of s.effects)o.is(n)&&(i=o.value),o.is(KSe)&&(i=[]);return i},provide:i=>U0.from(i)});return{active:r,extension:[r,Ts.define(i=>new VSe(i,t,r,n,e.hoverTime||300)),USe]}}function iW(t,e){let n=t.plugin(wN);if(!n)return null;let r=n.manager.tooltips.indexOf(e);return r<0?null:n.manager.tooltipViews[r]}const KSe=dn.define(),dL=it.define({combine(t){let e,n;for(let r of t)e=e||r.topContainer,n=n||r.bottomContainer;return{topContainer:e,bottomContainer:n}}}),YSe=Ts.fromClass(class{constructor(t){this.input=t.state.facet(zj),this.specs=this.input.filter(n=>n),this.panels=this.specs.map(n=>n(t));let e=t.state.facet(dL);this.top=new Gx(t,!0,e.topContainer),this.bottom=new Gx(t,!1,e.bottomContainer),this.top.sync(this.panels.filter(n=>n.top)),this.bottom.sync(this.panels.filter(n=>!n.top));for(let n of this.panels)n.dom.classList.add("cm-panel"),n.mount&&n.mount()}update(t){let e=t.state.facet(dL);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new Gx(t.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new Gx(t.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let n=t.state.facet(zj);if(n!=this.input){let r=n.filter(l=>l),i=[],s=[],o=[],a=[];for(let l of r){let c=this.specs.indexOf(l),d;c<0?(d=l(t.view),a.push(d)):(d=this.panels[c],d.update&&d.update(t)),i.push(d),(d.top?s:o).push(d)}this.specs=r,this.panels=i,this.top.sync(s),this.bottom.sync(o);for(let l of a)l.dom.classList.add("cm-panel"),l.mount&&l.mount()}else for(let r of this.panels)r.update&&r.update(t)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:t=>et.scrollMargins.of(e=>{let n=e.plugin(t);return n&&{top:n.top.scrollMargin(),bottom:n.bottom.scrollMargin()}})});class Gx{constructor(e,n,r){this.view=e,this.top=n,this.container=r,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let n of this.panels)n.destroy&&e.indexOf(n)<0&&n.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let n=this.container||this.view.dom;n.insertBefore(this.dom,this.top?n.firstChild:null)}let e=this.dom.firstChild;for(let n of this.panels)if(n.dom.parentNode==this.dom){for(;e!=n.dom;)e=hL(e);e=e.nextSibling}else this.dom.insertBefore(n.dom,e);for(;e;)e=hL(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function hL(t){let e=t.nextSibling;return t.remove(),e}const zj=it.define({enables:YSe});class cf extends Dd{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}cf.prototype.elementClass="";cf.prototype.toDOM=void 0;cf.prototype.mapMode=oi.TrackBefore;cf.prototype.startSide=cf.prototype.endSide=-1;cf.prototype.point=!0;const sW=1024;let XSe=0;class sS{constructor(e,n){this.from=e,this.to=n}}class Gt{constructor(e={}){this.id=XSe++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")}),this.combine=e.combine||null}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=ls.match(e)),n=>{let r=e(n);return r===void 0?null:[this,r]}}}Gt.closedBy=new Gt({deserialize:t=>t.split(" ")});Gt.openedBy=new Gt({deserialize:t=>t.split(" ")});Gt.group=new Gt({deserialize:t=>t.split(" ")});Gt.isolate=new Gt({deserialize:t=>{if(t&&t!="rtl"&&t!="ltr"&&t!="auto")throw new RangeError("Invalid value for isolate: "+t);return t||"auto"}});Gt.contextHash=new Gt({perNode:!0});Gt.lookAhead=new Gt({perNode:!0});Gt.mounted=new Gt({perNode:!0});class V0{constructor(e,n,r){this.tree=e,this.overlay=n,this.parser=r}static get(e){return e&&e.props&&e.props[Gt.mounted.id]}}const QSe=Object.create(null);class ls{constructor(e,n,r,i=0){this.name=e,this.props=n,this.id=r,this.flags=i}static define(e){let n=e.props&&e.props.length?Object.create(null):QSe,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),i=new ls(e.name||"",n,e.id,r);if(e.props){for(let s of e.props)if(Array.isArray(s)||(s=s(i)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");n[s[0].id]=s[1]}}return i}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let n=this.prop(Gt.group);return n?n.indexOf(e)>-1:!1}return this.id==e}static match(e){let n=Object.create(null);for(let r in e)for(let i of r.split(" "))n[i]=e[r];return r=>{for(let i=r.prop(Gt.group),s=-1;s<(i?i.length:0);s++){let o=n[s<0?r.name:i[s]];if(o)return o}}}}ls.none=new ls("",Object.create(null),0,8);class EN{constructor(e){this.types=e;for(let n=0;n<e.length;n++)if(e[n].id!=n)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let n=[];for(let r of this.types){let i=null;for(let s of e){let o=s(r);if(o){i||(i=Object.assign({},r.props));let a=o[1],l=o[0];l.combine&&l.id in i&&(a=l.combine(i[l.id],a)),i[l.id]=a}}n.push(i?new ls(r.name,i,r.id,r.flags):r)}return new EN(n)}}const Kx=new WeakMap,pL=new WeakMap;var Wr;(function(t){t[t.ExcludeBuffers=1]="ExcludeBuffers",t[t.IncludeAnonymous=2]="IncludeAnonymous",t[t.IgnoreMounts=4]="IgnoreMounts",t[t.IgnoreOverlays=8]="IgnoreOverlays"})(Wr||(Wr={}));class Pr{constructor(e,n,r,i,s){if(this.type=e,this.children=n,this.positions=r,this.length=i,this.props=null,s&&s.length){this.props=Object.create(null);for(let[o,a]of s)this.props[typeof o=="number"?o:o.id]=a}}toString(){let e=V0.get(this);if(e&&!e.overlay)return e.tree.toString();let n="";for(let r of this.children){let i=r.toString();i&&(n&&(n+=","),n+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(n.length?"("+n+")":""):n}cursor(e=0){return new Uj(this.topNode,e)}cursorAt(e,n=0,r=0){let i=Kx.get(this)||this.topNode,s=new Uj(i);return s.moveTo(e,n),Kx.set(this,s._tree),s}get topNode(){return new ro(this,0,0,null)}resolve(e,n=0){let r=ev(Kx.get(this)||this.topNode,e,n,!1);return Kx.set(this,r),r}resolveInner(e,n=0){let r=ev(pL.get(this)||this.topNode,e,n,!0);return pL.set(this,r),r}resolveStack(e,n=0){return eCe(this,e,n)}iterate(e){let{enter:n,leave:r,from:i=0,to:s=this.length}=e,o=e.mode||0,a=(o&Wr.IncludeAnonymous)>0;for(let l=this.cursor(o|Wr.IncludeAnonymous);;){let c=!1;if(l.from<=s&&l.to>=i&&(!a&&l.type.isAnonymous||n(l)!==!1)){if(l.firstChild())continue;c=!0}for(;c&&r&&(a||!l.type.isAnonymous)&&r(l),!l.nextSibling();){if(!l.parent())return;c=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let n in this.props)e.push([+n,this.props[n]]);return e}balance(e={}){return this.children.length<=8?this:jN(ls.none,this.children,this.positions,0,this.children.length,0,this.length,(n,r,i)=>new Pr(this.type,n,r,i,this.propValues),e.makeTree||((n,r,i)=>new Pr(ls.none,n,r,i)))}static build(e){return tCe(e)}}Pr.empty=new Pr(ls.none,[],[],0);class SN{constructor(e,n){this.buffer=e,this.index=n}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new SN(this.buffer,this.index)}}class Wc{constructor(e,n,r){this.buffer=e,this.length=n,this.set=r}get type(){return ls.none}toString(){let e=[];for(let n=0;n<this.buffer.length;)e.push(this.childString(n)),n=this.buffer[n+3];return e.join(",")}childString(e){let n=this.buffer[e],r=this.buffer[e+3],i=this.set.types[n],s=i.name;if(/\W/.test(s)&&!i.isError&&(s=JSON.stringify(s)),e+=4,r==e)return s;let o=[];for(;e<r;)o.push(this.childString(e)),e=this.buffer[e+3];return s+"("+o.join(",")+")"}findChild(e,n,r,i,s){let{buffer:o}=this,a=-1;for(let l=e;l!=n&&!(oW(s,i,o[l+1],o[l+2])&&(a=l,r>0));l=o[l+3]);return a}slice(e,n,r){let i=this.buffer,s=new Uint16Array(n-e),o=0;for(let a=e,l=0;a<n;){s[l++]=i[a++],s[l++]=i[a++]-r;let c=s[l++]=i[a++]-r;s[l++]=i[a++]-e,o=Math.max(o,c)}return new Wc(s,o,this.set)}}function oW(t,e,n,r){switch(t){case-2:return n<e;case-1:return r>=e&&n<e;case 0:return n<e&&r>e;case 1:return n<=e&&r>e;case 2:return r>e;case 4:return!0}}function ev(t,e,n,r){for(var i;t.from==t.to||(n<1?t.from>=e:t.from>e)||(n>-1?t.to<=e:t.to<e);){let o=!r&&t instanceof ro&&t.index<0?null:t.parent;if(!o)return t;t=o}let s=r?0:Wr.IgnoreOverlays;if(r)for(let o=t,a=o.parent;a;o=a,a=o.parent)o instanceof ro&&o.index<0&&((i=a.enter(e,n,s))===null||i===void 0?void 0:i.from)!=o.from&&(t=a);for(;;){let o=t.enter(e,n,s);if(!o)return t;t=o}}class aW{cursor(e=0){return new Uj(this,e)}getChild(e,n=null,r=null){let i=fL(this,e,n,r);return i.length?i[0]:null}getChildren(e,n=null,r=null){return fL(this,e,n,r)}resolve(e,n=0){return ev(this,e,n,!1)}resolveInner(e,n=0){return ev(this,e,n,!0)}matchContext(e){return Hj(this.parent,e)}enterUnfinishedNodesBefore(e){let n=this.childBefore(e),r=this;for(;n;){let i=n.lastChild;if(!i||i.to!=n.to)break;i.type.isError&&i.from==i.to?(r=n,n=i.prevSibling):n=i}return r}get node(){return this}get next(){return this.parent}}class ro extends aW{constructor(e,n,r,i){super(),this._tree=e,this.from=n,this.index=r,this._parent=i}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,n,r,i,s=0){for(let o=this;;){for(let{children:a,positions:l}=o._tree,c=n>0?a.length:-1;e!=c;e+=n){let d=a[e],h=l[e]+o.from;if(oW(i,r,h,h+d.length)){if(d instanceof Wc){if(s&Wr.ExcludeBuffers)continue;let p=d.findChild(0,d.buffer.length,n,r-h,i);if(p>-1)return new Ic(new ZSe(o,d,e,h),null,p)}else if(s&Wr.IncludeAnonymous||!d.type.isAnonymous||CN(d)){let p;if(!(s&Wr.IgnoreMounts)&&(p=V0.get(d))&&!p.overlay)return new ro(p.tree,h,e,o);let f=new ro(d,h,e,o);return s&Wr.IncludeAnonymous||!f.type.isAnonymous?f:f.nextChild(n<0?d.children.length-1:0,n,r,i)}}}if(s&Wr.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?e=o.index+n:e=n<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,n,r=0){let i;if(!(r&Wr.IgnoreOverlays)&&(i=V0.get(this._tree))&&i.overlay){let s=e-this.from;for(let{from:o,to:a}of i.overlay)if((n>0?o<=s:o<s)&&(n<0?a>=s:a>s))return new ro(i.tree,i.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,n,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function fL(t,e,n,r){let i=t.cursor(),s=[];if(!i.firstChild())return s;if(n!=null){for(let o=!1;!o;)if(o=i.type.is(n),!i.nextSibling())return s}for(;;){if(r!=null&&i.type.is(r))return s;if(i.type.is(e)&&s.push(i.node),!i.nextSibling())return r==null?s:[]}}function Hj(t,e,n=e.length-1){for(let r=t;n>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[n]&&e[n]!=r.name)return!1;n--}}return!0}class ZSe{constructor(e,n,r,i){this.parent=e,this.buffer=n,this.index=r,this.start=i}}class Ic extends aW{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,n,r){super(),this.context=e,this._parent=n,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,n,r){let{buffer:i}=this.context,s=i.findChild(this.index+4,i.buffer[this.index+3],e,n-this.context.start,r);return s<0?null:new Ic(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,n,r=0){if(r&Wr.ExcludeBuffers)return null;let{buffer:i}=this.context,s=i.findChild(this.index+4,i.buffer[this.index+3],n>0?1:-1,e-this.context.start,n);return s<0?null:new Ic(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,n=e.buffer[this.index+3];return n<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new Ic(this.context,this._parent,n):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,n=this._parent?this._parent.index+4:0;return this.index==n?this.externalSibling(-1):new Ic(this.context,this._parent,e.findChild(n,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],n=[],{buffer:r}=this.context,i=this.index+4,s=r.buffer[this.index+3];if(s>i){let o=r.buffer[this.index+1];e.push(r.slice(i,s,o)),n.push(0)}return new Pr(this.type,e,n,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function lW(t){if(!t.length)return null;let e=0,n=t[0];for(let s=1;s<t.length;s++){let o=t[s];(o.from>n.from||o.to<n.to)&&(n=o,e=s)}let r=n instanceof ro&&n.index<0?null:n.parent,i=t.slice();return r?i[e]=r:i.splice(e,1),new JSe(i,n)}class JSe{constructor(e,n){this.heads=e,this.node=n}get next(){return lW(this.heads)}}function eCe(t,e,n){let r=t.resolveInner(e,n),i=null;for(let s=r instanceof ro?r:r.context.parent;s;s=s.parent)if(s.index<0){let o=s.parent;(i||(i=[r])).push(o.resolve(e,n)),s=o}else{let o=V0.get(s.tree);if(o&&o.overlay&&o.overlay[0].from<=e&&o.overlay[o.overlay.length-1].to>=e){let a=new ro(o.tree,o.overlay[0].from+s.from,-1,s);(i||(i=[r])).push(ev(a,e,n,!1))}}return i?lW(i):r}class Uj{get name(){return this.type.name}constructor(e,n=0){if(this.mode=n,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof ro)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,n){this.index=e;let{start:r,buffer:i}=this.buffer;return this.type=n||i.set.types[i.buffer[e]],this.from=r+i.buffer[e+1],this.to=r+i.buffer[e+2],!0}yield(e){return e?e instanceof ro?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,n,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,n,r,this.mode));let{buffer:i}=this.buffer,s=i.findChild(this.index+4,i.buffer[this.index+3],e,n-this.buffer.start,r);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,n,r=this.mode){return this.buffer?r&Wr.ExcludeBuffers?!1:this.enterChild(1,e,n):this.yield(this._tree.enter(e,n,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&Wr.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&Wr.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:n}=this.buffer,r=this.stack.length-1;if(e<0){let i=r<0?0:this.stack[r]+4;if(this.index!=i)return this.yieldBuf(n.findChild(i,this.index,-1,0,4))}else{let i=n.buffer[this.index+3];if(i<(r<0?n.buffer.length:n.buffer[this.stack[r]+3]))return this.yieldBuf(i)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let n,r,{buffer:i}=this;if(i){if(e>0){if(this.index<i.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(i.buffer.buffer[s+3]<this.index)return!1;({index:n,parent:r}=i)}else({index:n,_parent:r}=this._tree);for(;r;{index:n,_parent:r}=r)if(n>-1)for(let s=n+e,o=e<0?-1:r._tree.children.length;s!=o;s+=e){let a=r._tree.children[s];if(this.mode&Wr.IncludeAnonymous||a instanceof Wc||!a.type.isAnonymous||CN(a))return!1}return!0}move(e,n){if(n&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,n=0){for(;(this.from==this.to||(n<1?this.from>=e:this.from>e)||(n>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,n););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,n=null,r=0;if(e&&e.context==this.buffer)e:for(let i=this.index,s=this.stack.length;s>=0;){for(let o=e;o;o=o._parent)if(o.index==i){if(i==this.index)return o;n=o,r=s+1;break e}i=this.stack[--s]}for(let i=r;i<this.stack.length;i++)n=new Ic(this.buffer,n,this.stack[i]);return this.bufferNode=new Ic(this.buffer,n,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,n){for(let r=0;;){let i=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(i=!0)}for(;;){if(i&&n&&n(this),i=this.type.isAnonymous,!r)return;if(this.nextSibling())break;this.parent(),r--,i=!0}}}matchContext(e){if(!this.buffer)return Hj(this.node.parent,e);let{buffer:n}=this.buffer,{types:r}=n.set;for(let i=e.length-1,s=this.stack.length-1;i>=0;s--){if(s<0)return Hj(this._tree,e,i);let o=r[n.buffer[this.stack[s]]];if(!o.isAnonymous){if(e[i]&&e[i]!=o.name)return!1;i--}}return!0}}function CN(t){return t.children.some(e=>e instanceof Wc||!e.type.isAnonymous||CN(e))}function tCe(t){var e;let{buffer:n,nodeSet:r,maxBufferLength:i=sW,reused:s=[],minRepeatType:o=r.types.length}=t,a=Array.isArray(n)?new SN(n,n.length):n,l=r.types,c=0,d=0;function h(E,S,j,C,P,R){let{id:N,start:I,end:M,size:W}=a,ce=d,se=c;if(W<0)if(a.next(),W==-1){let Nt=s[N];j.push(Nt),C.push(I-E);return}else if(W==-3){c=N;return}else if(W==-4){d=N;return}else throw new RangeError(`Unrecognized record size: ${W}`);let ve=l[N],pt,je,lt=I-E;if(M-I<=i&&(je=v(a.pos-S,P))){let Nt=new Uint16Array(je.size-je.skip),Ae=a.pos-je.size,Qe=Nt.length;for(;a.pos>Ae;)Qe=b(je.start,Nt,Qe);pt=new Wc(Nt,M-je.start,r),lt=je.start-E}else{let Nt=a.pos-W;a.next();let Ae=[],Qe=[],ze=N>=o?N:-1,Ot=0,Zt=M;for(;a.pos>Nt;)ze>=0&&a.id==ze&&a.size>=0?(a.end<=Zt-i&&(m(Ae,Qe,I,Ot,a.end,Zt,ze,ce,se),Ot=Ae.length,Zt=a.end),a.next()):R>2500?p(I,Nt,Ae,Qe):h(I,Nt,Ae,Qe,ze,R+1);if(ze>=0&&Ot>0&&Ot<Ae.length&&m(Ae,Qe,I,Ot,I,Zt,ze,ce,se),Ae.reverse(),Qe.reverse(),ze>-1&&Ot>0){let me=f(ve,se);pt=jN(ve,Ae,Qe,0,Ae.length,0,M-I,me,me)}else pt=g(ve,Ae,Qe,M-I,ce-M,se)}j.push(pt),C.push(lt)}function p(E,S,j,C){let P=[],R=0,N=-1;for(;a.pos>S;){let{id:I,start:M,end:W,size:ce}=a;if(ce>4)a.next();else{if(N>-1&&M<N)break;N<0&&(N=W-i),P.push(I,M,W),R++,a.next()}}if(R){let I=new Uint16Array(R*4),M=P[P.length-2];for(let W=P.length-3,ce=0;W>=0;W-=3)I[ce++]=P[W],I[ce++]=P[W+1]-M,I[ce++]=P[W+2]-M,I[ce++]=ce;j.push(new Wc(I,P[2]-M,r)),C.push(M-E)}}function f(E,S){return(j,C,P)=>{let R=0,N=j.length-1,I,M;if(N>=0&&(I=j[N])instanceof Pr){if(!N&&I.type==E&&I.length==P)return I;(M=I.prop(Gt.lookAhead))&&(R=C[N]+I.length+M)}return g(E,j,C,P,R,S)}}function m(E,S,j,C,P,R,N,I,M){let W=[],ce=[];for(;E.length>C;)W.push(E.pop()),ce.push(S.pop()+j-P);E.push(g(r.types[N],W,ce,R-P,I-R,M)),S.push(P-j)}function g(E,S,j,C,P,R,N){if(R){let I=[Gt.contextHash,R];N=N?[I].concat(N):[I]}if(P>25){let I=[Gt.lookAhead,P];N=N?[I].concat(N):[I]}return new Pr(E,S,j,C,N)}function v(E,S){let j=a.fork(),C=0,P=0,R=0,N=j.end-i,I={size:0,start:0,skip:0};e:for(let M=j.pos-E;j.pos>M;){let W=j.size;if(j.id==S&&W>=0){I.size=C,I.start=P,I.skip=R,R+=4,C+=4,j.next();continue}let ce=j.pos-W;if(W<0||ce<M||j.start<N)break;let se=j.id>=o?4:0,ve=j.start;for(j.next();j.pos>ce;){if(j.size<0)if(j.size==-3)se+=4;else break e;else j.id>=o&&(se+=4);j.next()}P=ve,C+=W,R+=se}return(S<0||C==E)&&(I.size=C,I.start=P,I.skip=R),I.size>4?I:void 0}function b(E,S,j){let{id:C,start:P,end:R,size:N}=a;if(a.next(),N>=0&&C<o){let I=j;if(N>4){let M=a.pos-(N-4);for(;a.pos>M;)j=b(E,S,j)}S[--j]=I,S[--j]=R-E,S[--j]=P-E,S[--j]=C}else N==-3?c=C:N==-4&&(d=C);return j}let x=[],y=[];for(;a.pos>0;)h(t.start||0,t.bufferStart||0,x,y,-1,0);let w=(e=t.length)!==null&&e!==void 0?e:x.length?y[0]+x[0].length:0;return new Pr(l[t.topID],x.reverse(),y.reverse(),w)}const mL=new WeakMap;function qb(t,e){if(!t.isAnonymous||e instanceof Wc||e.type!=t)return 1;let n=mL.get(e);if(n==null){n=1;for(let r of e.children){if(r.type!=t||!(r instanceof Pr)){n=1;break}n+=qb(t,r)}mL.set(e,n)}return n}function jN(t,e,n,r,i,s,o,a,l){let c=0;for(let m=r;m<i;m++)c+=qb(t,e[m]);let d=Math.ceil(c*1.5/8),h=[],p=[];function f(m,g,v,b,x){for(let y=v;y<b;){let w=y,E=g[y],S=qb(t,m[y]);for(y++;y<b;y++){let j=qb(t,m[y]);if(S+j>=d)break;S+=j}if(y==w+1){if(S>d){let j=m[w];f(j.children,j.positions,0,j.children.length,g[w]+x);continue}h.push(m[w])}else{let j=g[y-1]+m[y-1].length-E;h.push(jN(t,m,g,w,y,E,j,null,l))}p.push(E+x-s)}}return f(e,n,r,i,0),(a||l)(h,p,o)}class Sd{constructor(e,n,r,i,s=!1,o=!1){this.from=e,this.to=n,this.tree=r,this.offset=i,this.open=(s?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,n=[],r=!1){let i=[new Sd(0,e.length,e,0,!1,r)];for(let s of n)s.to>e.length&&i.push(s);return i}static applyChanges(e,n,r=128){if(!n.length)return e;let i=[],s=1,o=e.length?e[0]:null;for(let a=0,l=0,c=0;;a++){let d=a<n.length?n[a]:null,h=d?d.fromA:1e9;if(h-l>=r)for(;o&&o.from<h;){let p=o;if(l>=p.from||h<=p.to||c){let f=Math.max(p.from,l)-c,m=Math.min(p.to,h)-c;p=f>=m?null:new Sd(f,m,p.tree,p.offset+c,a>0,!!d)}if(p&&i.push(p),o.to>h)break;o=s<e.length?e[s++]:null}if(!d)break;l=d.toA,c=d.toA-d.toB}return i}}class cW{startParse(e,n,r){return typeof e=="string"&&(e=new nCe(e)),r=r?r.length?r.map(i=>new sS(i.from,i.to)):[new sS(0,0)]:[new sS(0,e.length)],this.createParse(e,n||[],r)}parse(e,n,r){let i=this.startParse(e,n,r);for(;;){let s=i.advance();if(s)return s}}}class nCe{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,n){return this.string.slice(e,n)}}new Gt({perNode:!0});let rCe=0;class Ks{constructor(e,n,r,i){this.name=e,this.set=n,this.base=r,this.modified=i,this.id=rCe++}toString(){let{name:e}=this;for(let n of this.modified)n.name&&(e=`${n.name}(${e})`);return e}static define(e,n){let r=typeof e=="string"?e:"?";if(e instanceof Ks&&(n=e),n!=null&&n.base)throw new Error("Can not derive from a modified tag");let i=new Ks(r,[],null,[]);if(i.set.push(i),n)for(let s of n.set)i.set.push(s);return i}static defineModifier(e){let n=new q0(e);return r=>r.modified.indexOf(n)>-1?r:q0.get(r.base||r,r.modified.concat(n).sort((i,s)=>i.id-s.id))}}let iCe=0;class q0{constructor(e){this.name=e,this.instances=[],this.id=iCe++}static get(e,n){if(!n.length)return e;let r=n[0].instances.find(a=>a.base==e&&sCe(n,a.modified));if(r)return r;let i=[],s=new Ks(e.name,i,e,n);for(let a of n)a.instances.push(s);let o=oCe(n);for(let a of e.set)if(!a.modified.length)for(let l of o)i.push(q0.get(a,l));return s}}function sCe(t,e){return t.length==e.length&&t.every((n,r)=>n==e[r])}function oCe(t){let e=[[]];for(let n=0;n<t.length;n++)for(let r=0,i=e.length;r<i;r++)e.push(e[r].concat(t[n]));return e.sort((n,r)=>r.length-n.length)}function uW(t){let e=Object.create(null);for(let n in t){let r=t[n];Array.isArray(r)||(r=[r]);for(let i of n.split(" "))if(i){let s=[],o=2,a=i;for(let h=0;;){if(a=="..."&&h>0&&h+3==i.length){o=1;break}let p=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(a);if(!p)throw new RangeError("Invalid path: "+i);if(s.push(p[0]=="*"?"":p[0][0]=='"'?JSON.parse(p[0]):p[0]),h+=p[0].length,h==i.length)break;let f=i[h++];if(h==i.length&&f=="!"){o=0;break}if(f!="/")throw new RangeError("Invalid path: "+i);a=i.slice(h)}let l=s.length-1,c=s[l];if(!c)throw new RangeError("Invalid path: "+i);let d=new tv(r,o,l>0?s.slice(0,l):null);e[c]=d.sort(e[c])}}return dW.add(e)}const dW=new Gt({combine(t,e){let n,r,i;for(;t||e;){if(!t||e&&t.depth>=e.depth?(i=e,e=e.next):(i=t,t=t.next),n&&n.mode==i.mode&&!i.context&&!n.context)continue;let s=new tv(i.tags,i.mode,i.context);n?n.next=s:r=s,n=s}return r}});class tv{constructor(e,n,r,i){this.tags=e,this.mode=n,this.context=r,this.next=i}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}tv.empty=new tv([],2,null);function hW(t,e){let n=Object.create(null);for(let s of t)if(!Array.isArray(s.tag))n[s.tag.id]=s.class;else for(let o of s.tag)n[o.id]=s.class;let{scope:r,all:i=null}=e||{};return{style:s=>{let o=i;for(let a of s)for(let l of a.set){let c=n[l.id];if(c){o=o?o+" "+c:c;break}}return o},scope:r}}function aCe(t,e){let n=null;for(let r of t){let i=r.style(e);i&&(n=n?n+" "+i:i)}return n}function lCe(t,e,n,r=0,i=t.length){let s=new cCe(r,Array.isArray(e)?e:[e],n);s.highlightRange(t.cursor(),r,i,"",s.highlighters),s.flush(i)}class cCe{constructor(e,n,r){this.at=e,this.highlighters=n,this.span=r,this.class=""}startSpan(e,n){n!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=n)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,n,r,i,s){let{type:o,from:a,to:l}=e;if(a>=r||l<=n)return;o.isTop&&(s=this.highlighters.filter(f=>!f.scope||f.scope(o)));let c=i,d=uCe(e)||tv.empty,h=aCe(s,d.tags);if(h&&(c&&(c+=" "),c+=h,d.mode==1&&(i+=(i?" ":"")+h)),this.startSpan(Math.max(n,a),c),d.opaque)return;let p=e.tree&&e.tree.prop(Gt.mounted);if(p&&p.overlay){let f=e.node.enter(p.overlay[0].from+a,1),m=this.highlighters.filter(v=>!v.scope||v.scope(p.tree.type)),g=e.firstChild();for(let v=0,b=a;;v++){let x=v<p.overlay.length?p.overlay[v]:null,y=x?x.from+a:l,w=Math.max(n,b),E=Math.min(r,y);if(w<E&&g)for(;e.from<E&&(this.highlightRange(e,w,E,i,s),this.startSpan(Math.min(E,e.to),c),!(e.to>=y||!e.nextSibling())););if(!x||y>r)break;b=x.to+a,b>n&&(this.highlightRange(f.cursor(),Math.max(n,x.from+a),Math.min(r,b),"",m),this.startSpan(Math.min(r,b),c))}g&&e.parent()}else if(e.firstChild()){p&&(i="");do if(!(e.to<=n)){if(e.from>=r)break;this.highlightRange(e,n,r,i,s),this.startSpan(Math.min(r,e.to),c)}while(e.nextSibling());e.parent()}}}function uCe(t){let e=t.type.prop(dW);for(;e&&e.context&&!t.matchContext(e.context);)e=e.next;return e||null}const Ne=Ks.define,Yx=Ne(),bc=Ne(),gL=Ne(bc),vL=Ne(bc),wc=Ne(),Xx=Ne(wc),oS=Ne(wc),fa=Ne(),Uu=Ne(fa),da=Ne(),ha=Ne(),Vj=Ne(),$m=Ne(Vj),Qx=Ne(),ge={comment:Yx,lineComment:Ne(Yx),blockComment:Ne(Yx),docComment:Ne(Yx),name:bc,variableName:Ne(bc),typeName:gL,tagName:Ne(gL),propertyName:vL,attributeName:Ne(vL),className:Ne(bc),labelName:Ne(bc),namespace:Ne(bc),macroName:Ne(bc),literal:wc,string:Xx,docString:Ne(Xx),character:Ne(Xx),attributeValue:Ne(Xx),number:oS,integer:Ne(oS),float:Ne(oS),bool:Ne(wc),regexp:Ne(wc),escape:Ne(wc),color:Ne(wc),url:Ne(wc),keyword:da,self:Ne(da),null:Ne(da),atom:Ne(da),unit:Ne(da),modifier:Ne(da),operatorKeyword:Ne(da),controlKeyword:Ne(da),definitionKeyword:Ne(da),moduleKeyword:Ne(da),operator:ha,derefOperator:Ne(ha),arithmeticOperator:Ne(ha),logicOperator:Ne(ha),bitwiseOperator:Ne(ha),compareOperator:Ne(ha),updateOperator:Ne(ha),definitionOperator:Ne(ha),typeOperator:Ne(ha),controlOperator:Ne(ha),punctuation:Vj,separator:Ne(Vj),bracket:$m,angleBracket:Ne($m),squareBracket:Ne($m),paren:Ne($m),brace:Ne($m),content:fa,heading:Uu,heading1:Ne(Uu),heading2:Ne(Uu),heading3:Ne(Uu),heading4:Ne(Uu),heading5:Ne(Uu),heading6:Ne(Uu),contentSeparator:Ne(fa),list:Ne(fa),quote:Ne(fa),emphasis:Ne(fa),strong:Ne(fa),link:Ne(fa),monospace:Ne(fa),strikethrough:Ne(fa),inserted:Ne(),deleted:Ne(),changed:Ne(),invalid:Ne(),meta:Qx,documentMeta:Ne(Qx),annotation:Ne(Qx),processingInstruction:Ne(Qx),definition:Ks.defineModifier("definition"),constant:Ks.defineModifier("constant"),function:Ks.defineModifier("function"),standard:Ks.defineModifier("standard"),local:Ks.defineModifier("local"),special:Ks.defineModifier("special")};for(let t in ge){let e=ge[t];e instanceof Ks&&(e.name=t)}hW([{tag:ge.link,class:"tok-link"},{tag:ge.heading,class:"tok-heading"},{tag:ge.emphasis,class:"tok-emphasis"},{tag:ge.strong,class:"tok-strong"},{tag:ge.keyword,class:"tok-keyword"},{tag:ge.atom,class:"tok-atom"},{tag:ge.bool,class:"tok-bool"},{tag:ge.url,class:"tok-url"},{tag:ge.labelName,class:"tok-labelName"},{tag:ge.inserted,class:"tok-inserted"},{tag:ge.deleted,class:"tok-deleted"},{tag:ge.literal,class:"tok-literal"},{tag:ge.string,class:"tok-string"},{tag:ge.number,class:"tok-number"},{tag:[ge.regexp,ge.escape,ge.special(ge.string)],class:"tok-string2"},{tag:ge.variableName,class:"tok-variableName"},{tag:ge.local(ge.variableName),class:"tok-variableName tok-local"},{tag:ge.definition(ge.variableName),class:"tok-variableName tok-definition"},{tag:ge.special(ge.variableName),class:"tok-variableName2"},{tag:ge.definition(ge.propertyName),class:"tok-propertyName tok-definition"},{tag:ge.typeName,class:"tok-typeName"},{tag:ge.namespace,class:"tok-namespace"},{tag:ge.className,class:"tok-className"},{tag:ge.macroName,class:"tok-macroName"},{tag:ge.propertyName,class:"tok-propertyName"},{tag:ge.operator,class:"tok-operator"},{tag:ge.comment,class:"tok-comment"},{tag:ge.meta,class:"tok-meta"},{tag:ge.invalid,class:"tok-invalid"},{tag:ge.punctuation,class:"tok-punctuation"}]);var aS;const rp=new Gt;function dCe(t){return it.define({combine:t?e=>e.concat(t):void 0})}const hCe=new Gt;class Mo{constructor(e,n,r=[],i=""){this.data=e,this.name=i,gn.prototype.hasOwnProperty("tree")||Object.defineProperty(gn.prototype,"tree",{get(){return Qr(this)}}),this.parser=n,this.extension=[df.of(this),gn.languageData.of((s,o,a)=>{let l=yL(s,o,a),c=l.type.prop(rp);if(!c)return[];let d=s.facet(c),h=l.type.prop(hCe);if(h){let p=l.resolve(o-l.from,a);for(let f of h)if(f.test(p,s)){let m=s.facet(f.facet);return f.type=="replace"?m:m.concat(d)}}return d})].concat(r)}isActiveAt(e,n,r=-1){return yL(e,n,r).type.prop(rp)==this.data}findRegions(e){let n=e.facet(df);if((n==null?void 0:n.data)==this.data)return[{from:0,to:e.doc.length}];if(!n||!n.allowsNesting)return[];let r=[],i=(s,o)=>{if(s.prop(rp)==this.data){r.push({from:o,to:o+s.length});return}let a=s.prop(Gt.mounted);if(a){if(a.tree.prop(rp)==this.data){if(a.overlay)for(let l of a.overlay)r.push({from:l.from+o,to:l.to+o});else r.push({from:o,to:o+s.length});return}else if(a.overlay){let l=r.length;if(i(a.tree,a.overlay[0].from+o),r.length>l)return}}for(let l=0;l<s.children.length;l++){let c=s.children[l];c instanceof Pr&&i(c,s.positions[l]+o)}};return i(Qr(e),0),r}get allowsNesting(){return!0}}Mo.setState=dn.define();function yL(t,e,n){let r=t.facet(df),i=Qr(t).topNode;if(!r||r.allowsNesting)for(let s=i;s;s=s.enter(e,n,Wr.ExcludeBuffers))s.type.isTop&&(i=s);return i}class W0 extends Mo{constructor(e,n,r){super(e,n,[],r),this.parser=n}static define(e){let n=dCe(e.languageData);return new W0(n,e.parser.configure({props:[rp.add(r=>r.isTop?n:void 0)]}),e.name)}configure(e,n){return new W0(this.data,this.parser.configure(e),n||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function Qr(t){let e=t.field(Mo.state,!1);return e?e.tree:Pr.empty}class pCe{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,n){let r=this.cursorPos-this.string.length;return e<r||n>=this.cursorPos?this.doc.sliceString(e,n):this.string.slice(e-r,n-r)}}let Mm=null;class G0{constructor(e,n,r=[],i,s,o,a,l){this.parser=e,this.state=n,this.fragments=r,this.tree=i,this.treeLen=s,this.viewport=o,this.skipped=a,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(e,n,r){return new G0(e,n,[],Pr.empty,0,r,[],null)}startParse(){return this.parser.startParse(new pCe(this.state.doc),this.fragments)}work(e,n){return n!=null&&n>=this.state.doc.length&&(n=void 0),this.tree!=Pr.empty&&this.isDone(n??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let i=Date.now()+e;e=()=>Date.now()>i}for(this.parse||(this.parse=this.startParse()),n!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>n)&&n<this.state.doc.length&&this.parse.stopAt(n);;){let i=this.parse.advance();if(i)if(this.fragments=this.withoutTempSkipped(Sd.addTree(i,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=i,this.parse=null,this.treeLen<(n??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,n;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(n=this.parse.advance()););}),this.treeLen=e,this.tree=n,this.fragments=this.withoutTempSkipped(Sd.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let n=Mm;Mm=this;try{return e()}finally{Mm=n}}withoutTempSkipped(e){for(let n;n=this.tempSkipped.pop();)e=xL(e,n.from,n.to);return e}changes(e,n){let{fragments:r,tree:i,treeLen:s,viewport:o,skipped:a}=this;if(this.takeTree(),!e.empty){let l=[];if(e.iterChangedRanges((c,d,h,p)=>l.push({fromA:c,toA:d,fromB:h,toB:p})),r=Sd.applyChanges(r,l),i=Pr.empty,s=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){a=[];for(let c of this.skipped){let d=e.mapPos(c.from,1),h=e.mapPos(c.to,-1);d<h&&a.push({from:d,to:h})}}}return new G0(this.parser,n,r,i,s,o,a,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let n=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:i,to:s}=this.skipped[r];i<e.to&&s>e.from&&(this.fragments=xL(this.fragments,i,s),this.skipped.splice(r--,1))}return this.skipped.length>=n?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,n){this.skipped.push({from:e,to:n})}static getSkippingParser(e){return new class extends cW{createParse(n,r,i){let s=i[0].from,o=i[i.length-1].to;return{parsedPos:s,advance(){let l=Mm;if(l){for(let c of i)l.tempSkipped.push(c);e&&(l.scheduleOn=l.scheduleOn?Promise.all([l.scheduleOn,e]):e)}return this.parsedPos=o,new Pr(ls.none,[],[],o-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let n=this.fragments;return this.treeLen>=e&&n.length&&n[0].from==0&&n[0].to>=e}static get(){return Mm}}function xL(t,e,n){return Sd.applyChanges(t,[{fromA:e,toA:n,fromB:e,toB:n}])}class uf{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let n=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),n.viewport.to);return n.work(20,r)||n.takeTree(),new uf(n)}static init(e){let n=Math.min(3e3,e.doc.length),r=G0.create(e.facet(df).parser,e,{from:0,to:n});return r.work(20,n)||r.takeTree(),new uf(r)}}Mo.state=Is.define({create:uf.init,update(t,e){for(let n of e.effects)if(n.is(Mo.setState))return n.value;return e.startState.facet(df)!=e.state.facet(df)?uf.init(e.state):t.apply(e)}});let pW=t=>{let e=setTimeout(()=>t(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(pW=t=>{let e=-1,n=setTimeout(()=>{e=requestIdleCallback(t,{timeout:400})},100);return()=>e<0?clearTimeout(n):cancelIdleCallback(e)});const lS=typeof navigator<"u"&&(!((aS=navigator.scheduling)===null||aS===void 0)&&aS.isInputPending)?()=>navigator.scheduling.isInputPending():null,fCe=Ts.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let n=this.view.state.field(Mo.state).context;(n.updateViewport(e.view.viewport)||this.view.viewport.to>n.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(n)}scheduleWork(){if(this.working)return;let{state:e}=this.view,n=e.field(Mo.state);(n.tree!=n.context.tree||!n.context.isDone(e.doc.length))&&(this.working=pW(this.work))}work(e){this.working=null;let n=Date.now();if(this.chunkEnd<n&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=n+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:i}}=this.view,s=r.field(Mo.state);if(s.tree==s.context.tree&&s.context.isDone(i+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,e&&!lS?Math.max(25,e.timeRemaining()-5):1e9),a=s.context.treeLen<i&&r.doc.length>i+1e3,l=s.context.work(()=>lS&&lS()||Date.now()>o,i+(a?0:1e5));this.chunkBudget-=Date.now()-n,(l||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:Mo.setState.of(new uf(s.context))})),this.chunkBudget>0&&!(l&&!a)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(n=>Bi(this.view.state,n)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),df=it.define({combine(t){return t.length?t[0]:null},enables:t=>[Mo.state,fCe,et.contentAttributes.compute([t],e=>{let n=e.facet(t);return n&&n.name?{"data-language":n.name}:{}})]});class mCe{constructor(e,n=[]){this.language=e,this.support=n,this.extension=[e,n]}}const gCe=it.define(),l1=it.define({combine:t=>{if(!t.length)return"  ";let e=t[0];if(!e||/\S/.test(e)||Array.from(e).some(n=>n!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(t[0]));return e}});function K0(t){let e=t.facet(l1);return e.charCodeAt(0)==9?t.tabSize*e.length:e.length}function nv(t,e){let n="",r=t.tabSize,i=t.facet(l1)[0];if(i=="	"){for(;e>=r;)n+="	",e-=r;i=" "}for(let s=0;s<e;s++)n+=i;return n}function kN(t,e){t instanceof gn&&(t=new c1(t));for(let r of t.state.facet(gCe)){let i=r(t,e);if(i!==void 0)return i}let n=Qr(t.state);return n.length>=e?vCe(t,n,e):null}class c1{constructor(e,n={}){this.state=e,this.options=n,this.unit=K0(e)}lineAt(e,n=1){let r=this.state.doc.lineAt(e),{simulateBreak:i,simulateDoubleBreak:s}=this.options;return i!=null&&i>=r.from&&i<=r.to?s&&i==e?{text:"",from:e}:(n<0?i<e:i<=e)?{text:r.text.slice(i-r.from),from:i}:{text:r.text.slice(0,i-r.from),from:r.from}:r}textAfterPos(e,n=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:i}=this.lineAt(e,n);return r.slice(e-i,Math.min(r.length,e+100-i))}column(e,n=1){let{text:r,from:i}=this.lineAt(e,n),s=this.countColumn(r,e-i),o=this.options.overrideIndentation?this.options.overrideIndentation(i):-1;return o>-1&&(s+=o-this.countColumn(r,r.search(/\S|$/))),s}countColumn(e,n=e.length){return r1(e,this.state.tabSize,n)}lineIndent(e,n=1){let{text:r,from:i}=this.lineAt(e,n),s=this.options.overrideIndentation;if(s){let o=s(i);if(o>-1)return o}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const fW=new Gt;function vCe(t,e,n){let r=e.resolveStack(n),i=e.resolveInner(n,-1).resolve(n,0).enterUnfinishedNodesBefore(n);if(i!=r.node){let s=[];for(let o=i;o&&!(o.from<r.node.from||o.to>r.node.to||o.from==r.node.from&&o.type==r.node.type);o=o.parent)s.push(o);for(let o=s.length-1;o>=0;o--)r={node:s[o],next:r}}return mW(r,t,n)}function mW(t,e,n){for(let r=t;r;r=r.next){let i=xCe(r.node);if(i)return i(PN.create(e,n,r))}return 0}function yCe(t){return t.pos==t.options.simulateBreak&&t.options.simulateDoubleBreak}function xCe(t){let e=t.type.prop(fW);if(e)return e;let n=t.firstChild,r;if(n&&(r=n.type.prop(Gt.closedBy))){let i=t.lastChild,s=i&&r.indexOf(i.name)>-1;return o=>gW(o,!0,1,void 0,s&&!yCe(o)?i.from:void 0)}return t.parent==null?bCe:null}function bCe(){return 0}class PN extends c1{constructor(e,n,r){super(e.state,e.options),this.base=e,this.pos=n,this.context=r}get node(){return this.context.node}static create(e,n,r){return new PN(e,n,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let n=this.state.doc.lineAt(e.from);for(;;){let r=e.resolve(n.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if(wCe(r,e))break;n=this.state.doc.lineAt(r.from)}return this.lineIndent(n.from)}continue(){return mW(this.context.next,this.base,this.pos)}}function wCe(t,e){for(let n=e;n;n=n.parent)if(t==n)return!0;return!1}function _Ce(t){let e=t.node,n=e.childAfter(e.from),r=e.lastChild;if(!n)return null;let i=t.options.simulateBreak,s=t.state.doc.lineAt(n.from),o=i==null||i<=s.from?s.to:Math.min(s.to,i);for(let a=n.to;;){let l=e.childAfter(a);if(!l||l==r)return null;if(!l.type.isSkipped){if(l.from>=o)return null;let c=/^ */.exec(s.text.slice(n.to-s.from))[0].length;return{from:n.from,to:n.to+c}}a=l.to}}function bL({closing:t,align:e=!0,units:n=1}){return r=>gW(r,e,n,t)}function gW(t,e,n,r,i){let s=t.textAfter,o=s.match(/^\s*/)[0].length,a=r&&s.slice(o,o+r.length)==r||i==t.pos+o,l=e?_Ce(t):null;return l?a?t.column(l.from):t.column(l.to):t.baseIndent+(a?0:t.unit*n)}function cS({except:t,units:e=1}={}){return n=>{let r=t&&t.test(n.textAfter);return n.baseIndent+(r?0:e*n.unit)}}const ECe=200;function SCe(){return gn.transactionFilter.of(t=>{if(!t.docChanged||!t.isUserEvent("input.type")&&!t.isUserEvent("input.complete"))return t;let e=t.startState.languageDataAt("indentOnInput",t.startState.selection.main.head);if(!e.length)return t;let n=t.newDoc,{head:r}=t.newSelection.main,i=n.lineAt(r);if(r>i.from+ECe)return t;let s=n.sliceString(i.from,r);if(!e.some(c=>c.test(s)))return t;let{state:o}=t,a=-1,l=[];for(let{head:c}of o.selection.ranges){let d=o.doc.lineAt(c);if(d.from==a)continue;a=d.from;let h=kN(o,d.from);if(h==null)continue;let p=/^\s*/.exec(d.text)[0],f=nv(o,h);p!=f&&l.push({from:d.from,to:d.from+p.length,insert:f})}return l.length?[t,{changes:l,sequential:!0}]:t})}const CCe=new Gt;function uS(t){let e=t.firstChild,n=t.lastChild;return e&&e.to<n.from?{from:e.to,to:n.type.isError?t.to:n.from}:null}class u1{constructor(e,n){this.specs=e;let r;function i(a){let l=Uc.newName();return(r||(r=Object.create(null)))["."+l]=a,l}const s=typeof n.all=="string"?n.all:n.all?i(n.all):void 0,o=n.scope;this.scope=o instanceof Mo?a=>a.prop(rp)==o.data:o?a=>a==o:void 0,this.style=hW(e.map(a=>({tag:a.tag,class:a.class||i(Object.assign({},a,{tag:null}))})),{all:s}).style,this.module=r?new Uc(r):null,this.themeType=n.themeType}static define(e,n){return new u1(e,n||{})}}const qj=it.define(),jCe=it.define({combine(t){return t.length?[t[0]]:null}});function dS(t){let e=t.facet(qj);return e.length?e:t.facet(jCe)}function kCe(t,e){let n=[TCe],r;return t instanceof u1&&(t.module&&n.push(et.styleModule.of(t.module)),r=t.themeType),r?n.push(qj.computeN([et.darkTheme],i=>i.facet(et.darkTheme)==(r=="dark")?[t]:[])):n.push(qj.of(t)),n}class PCe{constructor(e){this.markCache=Object.create(null),this.tree=Qr(e.state),this.decorations=this.buildDeco(e,dS(e.state)),this.decoratedTo=e.viewport.to}update(e){let n=Qr(e.state),r=dS(e.state),i=r!=dS(e.startState),{viewport:s}=e.view,o=e.changes.mapPos(this.decoratedTo,1);n.length<s.to&&!i&&n.type==this.tree.type&&o>=s.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=o):(n!=this.tree||e.viewportChanged||i)&&(this.tree=n,this.decorations=this.buildDeco(e.view,r),this.decoratedTo=s.to)}buildDeco(e,n){if(!n||!this.tree.length)return sn.none;let r=new rf;for(let{from:i,to:s}of e.visibleRanges)lCe(this.tree,n,(o,a,l)=>{r.add(o,a,this.markCache[l]||(this.markCache[l]=sn.mark({class:l})))},i,s);return r.finish()}}const TCe=Kf.high(Ts.fromClass(PCe,{decorations:t=>t.decorations})),NCe=et.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),vW=1e4,yW="()[]{}",xW=it.define({combine(t){return uN(t,{afterCursor:!0,brackets:yW,maxScanDistance:vW,renderMatch:ACe})}}),OCe=sn.mark({class:"cm-matchingBracket"}),RCe=sn.mark({class:"cm-nonmatchingBracket"});function ACe(t){let e=[],n=t.matched?OCe:RCe;return e.push(n.range(t.start.from,t.start.to)),t.end&&e.push(n.range(t.end.from,t.end.to)),e}const ICe=Is.define({create(){return sn.none},update(t,e){if(!e.docChanged&&!e.selection)return t;let n=[],r=e.state.facet(xW);for(let i of e.state.selection.ranges){if(!i.empty)continue;let s=ja(e.state,i.head,-1,r)||i.head>0&&ja(e.state,i.head-1,1,r)||r.afterCursor&&(ja(e.state,i.head,1,r)||i.head<e.state.doc.length&&ja(e.state,i.head+1,-1,r));s&&(n=n.concat(r.renderMatch(s,e.state)))}return sn.set(n,!0)},provide:t=>et.decorations.from(t)}),DCe=[ICe,NCe];function $Ce(t={}){return[xW.of(t),DCe]}const MCe=new Gt;function Wj(t,e,n){let r=t.prop(e<0?Gt.openedBy:Gt.closedBy);if(r)return r;if(t.name.length==1){let i=n.indexOf(t.name);if(i>-1&&i%2==(e<0?1:0))return[n[i+e]]}return null}function Gj(t){let e=t.type.prop(MCe);return e?e(t.node):t}function ja(t,e,n,r={}){let i=r.maxScanDistance||vW,s=r.brackets||yW,o=Qr(t),a=o.resolveInner(e,n);for(let l=a;l;l=l.parent){let c=Wj(l.type,n,s);if(c&&l.from<l.to){let d=Gj(l);if(d&&(n>0?e>=d.from&&e<d.to:e>d.from&&e<=d.to))return LCe(t,e,n,l,d,c,s)}}return BCe(t,e,n,o,a.type,i,s)}function LCe(t,e,n,r,i,s,o){let a=r.parent,l={from:i.from,to:i.to},c=0,d=a==null?void 0:a.cursor();if(d&&(n<0?d.childBefore(r.from):d.childAfter(r.to)))do if(n<0?d.to<=r.from:d.from>=r.to){if(c==0&&s.indexOf(d.type.name)>-1&&d.from<d.to){let h=Gj(d);return{start:l,end:h?{from:h.from,to:h.to}:void 0,matched:!0}}else if(Wj(d.type,n,o))c++;else if(Wj(d.type,-n,o)){if(c==0){let h=Gj(d);return{start:l,end:h&&h.from<h.to?{from:h.from,to:h.to}:void 0,matched:!1}}c--}}while(n<0?d.prevSibling():d.nextSibling());return{start:l,matched:!1}}function BCe(t,e,n,r,i,s,o){let a=n<0?t.sliceDoc(e-1,e):t.sliceDoc(e,e+1),l=o.indexOf(a);if(l<0||l%2==0!=n>0)return null;let c={from:n<0?e-1:e,to:n>0?e+1:e},d=t.doc.iterRange(e,n>0?t.doc.length:0),h=0;for(let p=0;!d.next().done&&p<=s;){let f=d.value;n<0&&(p+=f.length);let m=e+p*n;for(let g=n>0?0:f.length-1,v=n>0?f.length:-1;g!=v;g+=n){let b=o.indexOf(f[g]);if(!(b<0||r.resolveInner(m+g,1).type!=i))if(b%2==0==n>0)h++;else{if(h==1)return{start:c,end:{from:m+g,to:m+g+1},matched:b>>1==l>>1};h--}}n>0&&(p+=f.length)}return d.done?{start:c,matched:!1}:null}const FCe=Object.create(null),wL=[ls.none],_L=[],EL=Object.create(null),zCe=Object.create(null);for(let[t,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])zCe[t]=HCe(FCe,e);function hS(t,e){_L.indexOf(t)>-1||(_L.push(t),console.warn(e))}function HCe(t,e){let n=[];for(let a of e.split(" ")){let l=[];for(let c of a.split(".")){let d=t[c]||ge[c];d?typeof d=="function"?l.length?l=l.map(d):hS(c,`Modifier ${c} used at start of tag`):l.length?hS(c,`Tag ${c} used as modifier`):l=Array.isArray(d)?d:[d]:hS(c,`Unknown highlighting tag ${c}`)}for(let c of l)n.push(c)}if(!n.length)return 0;let r=e.replace(/ /g,"_"),i=r+" "+n.map(a=>a.id),s=EL[i];if(s)return s.id;let o=EL[i]=ls.define({id:wL.length,name:r,props:[uW({[r]:n})]});return wL.push(o),o.id}gr.RTL,gr.LTR;class bW{constructor(e,n,r,i){this.state=e,this.pos=n,this.explicit=r,this.view=i,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let n=Qr(this.state).resolveInner(this.pos,-1);for(;n&&e.indexOf(n.name)<0;)n=n.parent;return n?{from:n.from,to:this.pos,text:this.state.sliceDoc(n.from,this.pos),type:n.type}:null}matchBefore(e){let n=this.state.doc.lineAt(this.pos),r=Math.max(n.from,this.pos-250),i=n.text.slice(r-n.from,this.pos-n.from),s=i.search(wW(e,!1));return s<0?null:{from:r+s,to:this.pos,text:i.slice(s)}}get aborted(){return this.abortListeners==null}addEventListener(e,n,r){e=="abort"&&this.abortListeners&&(this.abortListeners.push(n),r&&r.onDocChange&&(this.abortOnDocChange=!0))}}function SL(t){let e=Object.keys(t).join(""),n=/\w/.test(e);return n&&(e=e.replace(/\w/g,"")),`[${n?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function UCe(t){let e=Object.create(null),n=Object.create(null);for(let{label:i}of t){e[i[0]]=!0;for(let s=1;s<i.length;s++)n[i[s]]=!0}let r=SL(e)+SL(n)+"*$";return[new RegExp("^"+r),new RegExp(r)]}function d1(t){let e=t.map(i=>typeof i=="string"?{label:i}:i),[n,r]=e.every(i=>/^\w+$/.test(i.label))?[/\w*$/,/\w+$/]:UCe(e);return i=>{let s=i.matchBefore(r);return s||i.explicit?{from:s?s.from:i.pos,options:e,validFor:n}:null}}class CL{constructor(e,n,r,i){this.completion=e,this.source=n,this.match=r,this.score=i}}function Cd(t){return t.selection.main.from}function wW(t,e){var n;let{source:r}=t,i=e&&r[0]!="^",s=r[r.length-1]!="$";return!i&&!s?t:new RegExp(`${i?"^":""}(?:${r})${s?"$":""}`,(n=t.flags)!==null&&n!==void 0?n:t.ignoreCase?"i":"")}const TN=ph.define();function VCe(t,e,n,r){let{main:i}=t.selection,s=n-i.from,o=r-i.from;return{...t.changeByRange(a=>{if(a!=i&&n!=r&&t.sliceDoc(a.from+s,a.from+o)!=t.sliceDoc(n,r))return{range:a};let l=t.toText(e);return{changes:{from:a.from+s,to:r==i.from?a.to:a.from+o,insert:l},range:ue.cursor(a.from+s+l.length)}}),scrollIntoView:!0,userEvent:"input.complete"}}const jL=new WeakMap;function qCe(t){if(!Array.isArray(t))return t;let e=jL.get(t);return e||jL.set(t,e=d1(t)),e}const Y0=dn.define(),rv=dn.define();class WCe{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let n=0;n<e.length;){let r=wa(e,n),i=Ec(r);this.chars.push(r);let s=e.slice(n,n+i),o=s.toUpperCase();this.folded.push(wa(o==s?s.toLowerCase():o,0)),n+=i}this.astral=e.length!=this.chars.length}ret(e,n){return this.score=e,this.matched=n,this}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:n,folded:r,any:i,precise:s,byWord:o}=this;if(n.length==1){let x=wa(e,0),y=Ec(x),w=y==e.length?0:-100;if(x!=n[0])if(x==r[0])w+=-200;else return null;return this.ret(w,[0,y])}let a=e.indexOf(this.pattern);if(a==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let l=n.length,c=0;if(a<0){for(let x=0,y=Math.min(e.length,200);x<y&&c<l;){let w=wa(e,x);(w==n[c]||w==r[c])&&(i[c++]=x),x+=Ec(w)}if(c<l)return null}let d=0,h=0,p=!1,f=0,m=-1,g=-1,v=/[a-z]/.test(e),b=!0;for(let x=0,y=Math.min(e.length,200),w=0;x<y&&h<l;){let E=wa(e,x);a<0&&(d<l&&E==n[d]&&(s[d++]=x),f<l&&(E==n[f]||E==r[f]?(f==0&&(m=x),g=x+1,f++):f=0));let S,j=E<255?E>=48&&E<=57||E>=97&&E<=122?2:E>=65&&E<=90?1:0:(S=qq(E))!=S.toLowerCase()?1:S!=S.toUpperCase()?2:0;(!x||j==1&&v||w==0&&j!=0)&&(n[h]==E||r[h]==E&&(p=!0)?o[h++]=x:o.length&&(b=!1)),w=j,x+=Ec(E)}return h==l&&o[0]==0&&b?this.result(-100+(p?-200:0),o,e):f==l&&m==0?this.ret(-200-e.length+(g==e.length?0:-100),[0,g]):a>-1?this.ret(-700-e.length,[a,a+this.pattern.length]):f==l?this.ret(-900-e.length,[m,g]):h==l?this.result(-100+(p?-200:0)+-700+(b?0:-1100),o,e):n.length==2?null:this.result((i[0]?-700:0)+-200+-1100,i,e)}result(e,n,r){let i=[],s=0;for(let o of n){let a=o+(this.astral?Ec(wa(r,o)):1);s&&i[s-1]==o?i[s-1]=a:(i[s++]=o,i[s++]=a)}return this.ret(e-r.length,i)}}class GCe{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let n=e.slice(0,this.pattern.length),r=n==this.pattern?0:n.toLowerCase()==this.folded?-200:null;return r==null?null:(this.matched=[0,n.length],this.score=r+(e.length==this.pattern.length?0:-100),this)}}const Gr=it.define({combine(t){return uN(t,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:KCe,filterStrict:!1,compareCompletions:(e,n)=>(e.sortText||e.label).localeCompare(n.sortText||n.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,n)=>e&&n,closeOnBlur:(e,n)=>e&&n,icons:(e,n)=>e&&n,tooltipClass:(e,n)=>r=>kL(e(r),n(r)),optionClass:(e,n)=>r=>kL(e(r),n(r)),addToOptions:(e,n)=>e.concat(n),filterStrict:(e,n)=>e||n})}});function kL(t,e){return t?e?t+" "+e:t:e}function KCe(t,e,n,r,i,s){let o=t.textDirection==gr.RTL,a=o,l=!1,c="top",d,h,p=e.left-i.left,f=i.right-e.right,m=r.right-r.left,g=r.bottom-r.top;if(a&&p<Math.min(m,f)?a=!1:!a&&f<Math.min(m,p)&&(a=!0),m<=(a?p:f))d=Math.max(i.top,Math.min(n.top,i.bottom-g))-e.top,h=Math.min(400,a?p:f);else{l=!0,h=Math.min(400,(o?e.right:i.right-e.left)-30);let x=i.bottom-e.bottom;x>=g||x>e.top?d=n.bottom-e.top:(c="bottom",d=e.bottom-n.top)}let v=(e.bottom-e.top)/s.offsetHeight,b=(e.right-e.left)/s.offsetWidth;return{style:`${c}: ${d/v}px; max-width: ${h/b}px`,class:"cm-completionInfo-"+(l?o?"left-narrow":"right-narrow":a?"left":"right")}}function YCe(t){let e=t.addToOptions.slice();return t.icons&&e.push({render(n){let r=document.createElement("div");return r.classList.add("cm-completionIcon"),n.type&&r.classList.add(...n.type.split(/\s+/g).map(i=>"cm-completionIcon-"+i)),r.setAttribute("aria-hidden","true"),r},position:20}),e.push({render(n,r,i,s){let o=document.createElement("span");o.className="cm-completionLabel";let a=n.displayLabel||n.label,l=0;for(let c=0;c<s.length;){let d=s[c++],h=s[c++];d>l&&o.appendChild(document.createTextNode(a.slice(l,d)));let p=o.appendChild(document.createElement("span"));p.appendChild(document.createTextNode(a.slice(d,h))),p.className="cm-completionMatchedText",l=h}return l<a.length&&o.appendChild(document.createTextNode(a.slice(l))),o},position:50},{render(n){if(!n.detail)return null;let r=document.createElement("span");return r.className="cm-completionDetail",r.textContent=n.detail,r},position:80}),e.sort((n,r)=>n.position-r.position).map(n=>n.render)}function pS(t,e,n){if(t<=n)return{from:0,to:t};if(e<0&&(e=0),e<=t>>1){let i=Math.floor(e/n);return{from:i*n,to:(i+1)*n}}let r=Math.floor((t-e)/n);return{from:t-(r+1)*n,to:t-r*n}}class XCe{constructor(e,n,r){this.view=e,this.stateField=n,this.applyCompletion=r,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:l=>this.placeInfo(l),key:this},this.space=null,this.currentClass="";let i=e.state.field(n),{options:s,selected:o}=i.open,a=e.state.facet(Gr);this.optionContent=YCe(a),this.optionClass=a.optionClass,this.tooltipClass=a.tooltipClass,this.range=pS(s.length,o,a.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",l=>{let{options:c}=e.state.field(n).open;for(let d=l.target,h;d&&d!=this.dom;d=d.parentNode)if(d.nodeName=="LI"&&(h=/-(\d+)$/.exec(d.id))&&+h[1]<c.length){this.applyCompletion(e,c[+h[1]]),l.preventDefault();return}}),this.dom.addEventListener("focusout",l=>{let c=e.state.field(this.stateField,!1);c&&c.tooltip&&e.state.facet(Gr).closeOnBlur&&l.relatedTarget!=e.contentDOM&&e.dispatch({effects:rv.of(null)})}),this.showOptions(s,i.id)}mount(){this.updateSel()}showOptions(e,n){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,n,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var n;let r=e.state.field(this.stateField),i=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),r!=i){let{options:s,selected:o,disabled:a}=r.open;(!i.open||i.open.options!=s)&&(this.range=pS(s.length,o,e.state.facet(Gr).maxRenderedOptions),this.showOptions(s,r.id)),this.updateSel(),a!=((n=i.open)===null||n===void 0?void 0:n.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!a)}}updateTooltipClass(e){let n=this.tooltipClass(e);if(n!=this.currentClass){for(let r of this.currentClass.split(" "))r&&this.dom.classList.remove(r);for(let r of n.split(" "))r&&this.dom.classList.add(r);this.currentClass=n}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),n=e.open;(n.selected>-1&&n.selected<this.range.from||n.selected>=this.range.to)&&(this.range=pS(n.options.length,n.selected,this.view.state.facet(Gr).maxRenderedOptions),this.showOptions(n.options,e.id));let r=this.updateSelectedOption(n.selected);if(r){this.destroyInfo();let{completion:i}=n.options[n.selected],{info:s}=i;if(!s)return;let o=typeof s=="string"?document.createTextNode(s):s(i);if(!o)return;"then"in o?o.then(a=>{a&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(a,i)}).catch(a=>Bi(this.view.state,a,"completion info")):(this.addInfoPane(o,i),r.setAttribute("aria-describedby",this.info.id))}}addInfoPane(e,n){this.destroyInfo();let r=this.info=document.createElement("div");if(r.className="cm-tooltip cm-completionInfo",r.id="cm-completionInfo-"+Math.floor(Math.random()*65535).toString(16),e.nodeType!=null)r.appendChild(e),this.infoDestroy=null;else{let{dom:i,destroy:s}=e;r.appendChild(i),this.infoDestroy=s||null}this.dom.appendChild(r),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let n=null;for(let r=this.list.firstChild,i=this.range.from;r;r=r.nextSibling,i++)r.nodeName!="LI"||!r.id?i--:i==e?r.hasAttribute("aria-selected")||(r.setAttribute("aria-selected","true"),n=r):r.hasAttribute("aria-selected")&&(r.removeAttribute("aria-selected"),r.removeAttribute("aria-describedby"));return n&&ZCe(this.list,n),n}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let n=this.dom.getBoundingClientRect(),r=this.info.getBoundingClientRect(),i=e.getBoundingClientRect(),s=this.space;if(!s){let o=this.dom.ownerDocument.documentElement;s={left:0,top:0,right:o.clientWidth,bottom:o.clientHeight}}return i.top>Math.min(s.bottom,n.bottom)-10||i.bottom<Math.max(s.top,n.top)+10?null:this.view.state.facet(Gr).positionInfo(this.view,n,i,r,s,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,n,r){const i=document.createElement("ul");i.id=n,i.setAttribute("role","listbox"),i.setAttribute("aria-expanded","true"),i.setAttribute("aria-label",this.view.state.phrase("Completions")),i.addEventListener("mousedown",o=>{o.target==i&&o.preventDefault()});let s=null;for(let o=r.from;o<r.to;o++){let{completion:a,match:l}=e[o],{section:c}=a;if(c){let p=typeof c=="string"?c:c.name;if(p!=s&&(o>r.from||r.from==0))if(s=p,typeof c!="string"&&c.header)i.appendChild(c.header(c));else{let f=i.appendChild(document.createElement("completion-section"));f.textContent=p}}const d=i.appendChild(document.createElement("li"));d.id=n+"-"+o,d.setAttribute("role","option");let h=this.optionClass(a);h&&(d.className=h);for(let p of this.optionContent){let f=p(a,this.view.state,this.view,l);f&&d.appendChild(f)}}return r.from&&i.classList.add("cm-completionListIncompleteTop"),r.to<e.length&&i.classList.add("cm-completionListIncompleteBottom"),i}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function QCe(t,e){return n=>new XCe(n,t,e)}function ZCe(t,e){let n=t.getBoundingClientRect(),r=e.getBoundingClientRect(),i=n.height/t.offsetHeight;r.top<n.top?t.scrollTop-=(n.top-r.top)/i:r.bottom>n.bottom&&(t.scrollTop+=(r.bottom-n.bottom)/i)}function PL(t){return(t.boost||0)*100+(t.apply?10:0)+(t.info?5:0)+(t.type?1:0)}function JCe(t,e){let n=[],r=null,i=null,s=d=>{n.push(d);let{section:h}=d.completion;if(h){r||(r=[]);let p=typeof h=="string"?h:h.name;r.some(f=>f.name==p)||r.push(typeof h=="string"?{name:p}:h)}},o=e.facet(Gr);for(let d of t)if(d.hasResult()){let h=d.result.getMatch;if(d.result.filter===!1)for(let p of d.result.options)s(new CL(p,d.source,h?h(p):[],1e9-n.length));else{let p=e.sliceDoc(d.from,d.to),f,m=o.filterStrict?new GCe(p):new WCe(p);for(let g of d.result.options)if(f=m.match(g.label)){let v=g.displayLabel?h?h(g,f.matched):[]:f.matched,b=f.score+(g.boost||0);if(s(new CL(g,d.source,v,b)),typeof g.section=="object"&&g.section.rank==="dynamic"){let{name:x}=g.section;i||(i=Object.create(null)),i[x]=Math.max(b,i[x]||-1e9)}}}}if(r){let d=Object.create(null),h=0,p=(f,m)=>(f.rank==="dynamic"&&m.rank==="dynamic"?i[m.name]-i[f.name]:0)||(typeof f.rank=="number"?f.rank:1e9)-(typeof m.rank=="number"?m.rank:1e9)||(f.name<m.name?-1:1);for(let f of r.sort(p))h-=1e5,d[f.name]=h;for(let f of n){let{section:m}=f.completion;m&&(f.score+=d[typeof m=="string"?m:m.name])}}let a=[],l=null,c=o.compareCompletions;for(let d of n.sort((h,p)=>p.score-h.score||c(h.completion,p.completion))){let h=d.completion;!l||l.label!=h.label||l.detail!=h.detail||l.type!=null&&h.type!=null&&l.type!=h.type||l.apply!=h.apply||l.boost!=h.boost?a.push(d):PL(d.completion)>PL(l)&&(a[a.length-1]=d),l=d.completion}return a}class ip{constructor(e,n,r,i,s,o){this.options=e,this.attrs=n,this.tooltip=r,this.timestamp=i,this.selected=s,this.disabled=o}setSelected(e,n){return e==this.selected||e>=this.options.length?this:new ip(this.options,TL(n,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,n,r,i,s,o){if(i&&!o&&e.some(c=>c.isPending))return i.setDisabled();let a=JCe(e,n);if(!a.length)return i&&e.some(c=>c.isPending)?i.setDisabled():null;let l=n.facet(Gr).selectOnOpen?0:-1;if(i&&i.selected!=l&&i.selected!=-1){let c=i.options[i.selected].completion;for(let d=0;d<a.length;d++)if(a[d].completion==c){l=d;break}}return new ip(a,TL(r,l),{pos:e.reduce((c,d)=>d.hasResult()?Math.min(c,d.from):c,1e8),create:sje,above:s.aboveCursor},i?i.timestamp:Date.now(),l,!1)}map(e){return new ip(this.options,this.attrs,{...this.tooltip,pos:e.mapPos(this.tooltip.pos)},this.timestamp,this.selected,this.disabled)}setDisabled(){return new ip(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class X0{constructor(e,n,r){this.active=e,this.id=n,this.open=r}static start(){return new X0(rje,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:n}=e,r=n.facet(Gr),s=(r.override||n.languageDataAt("autocomplete",Cd(n)).map(qCe)).map(l=>(this.active.find(d=>d.source==l)||new Qs(l,this.active.some(d=>d.state!=0)?1:0)).update(e,r));s.length==this.active.length&&s.every((l,c)=>l==this.active[c])&&(s=this.active);let o=this.open,a=e.effects.some(l=>l.is(NN));o&&e.docChanged&&(o=o.map(e.changes)),e.selection||s.some(l=>l.hasResult()&&e.changes.touchesRange(l.from,l.to))||!eje(s,this.active)||a?o=ip.build(s,n,this.id,o,r,a):o&&o.disabled&&!s.some(l=>l.isPending)&&(o=null),!o&&s.every(l=>!l.isPending)&&s.some(l=>l.hasResult())&&(s=s.map(l=>l.hasResult()?new Qs(l.source,0):l));for(let l of e.effects)l.is(EW)&&(o=o&&o.setSelected(l.value,this.id));return s==this.active&&o==this.open?this:new X0(s,this.id,o)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?tje:nje}}function eje(t,e){if(t==e)return!0;for(let n=0,r=0;;){for(;n<t.length&&!t[n].hasResult();)n++;for(;r<e.length&&!e[r].hasResult();)r++;let i=n==t.length,s=r==e.length;if(i||s)return i==s;if(t[n++].result!=e[r++].result)return!1}}const tje={"aria-autocomplete":"list"},nje={};function TL(t,e){let n={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":t};return e>-1&&(n["aria-activedescendant"]=t+"-"+e),n}const rje=[];function _W(t,e){if(t.isUserEvent("input.complete")){let r=t.annotation(TN);if(r&&e.activateOnCompletion(r))return 12}let n=t.isUserEvent("input.type");return n&&e.activateOnTyping?5:n?1:t.isUserEvent("delete.backward")?2:t.selection?8:t.docChanged?16:0}class Qs{constructor(e,n,r=!1){this.source=e,this.state=n,this.explicit=r}hasResult(){return!1}get isPending(){return this.state==1}update(e,n){let r=_W(e,n),i=this;(r&8||r&16&&this.touches(e))&&(i=new Qs(i.source,0)),r&4&&i.state==0&&(i=new Qs(this.source,1)),i=i.updateFor(e,r);for(let s of e.effects)if(s.is(Y0))i=new Qs(i.source,1,s.value);else if(s.is(rv))i=new Qs(i.source,0);else if(s.is(NN))for(let o of s.value)o.source==i.source&&(i=o);return i}updateFor(e,n){return this.map(e.changes)}map(e){return this}touches(e){return e.changes.touchesRange(Cd(e.state))}}class Ep extends Qs{constructor(e,n,r,i,s,o){super(e,3,n),this.limit=r,this.result=i,this.from=s,this.to=o}hasResult(){return!0}updateFor(e,n){var r;if(!(n&3))return this.map(e.changes);let i=this.result;i.map&&!e.changes.empty&&(i=i.map(i,e.changes));let s=e.changes.mapPos(this.from),o=e.changes.mapPos(this.to,1),a=Cd(e.state);if(a>o||!i||n&2&&(Cd(e.startState)==this.from||a<this.limit))return new Qs(this.source,n&4?1:0);let l=e.changes.mapPos(this.limit);return ije(i.validFor,e.state,s,o)?new Ep(this.source,this.explicit,l,i,s,o):i.update&&(i=i.update(i,s,o,new bW(e.state,a,!1)))?new Ep(this.source,this.explicit,l,i,i.from,(r=i.to)!==null&&r!==void 0?r:Cd(e.state)):new Qs(this.source,1,this.explicit)}map(e){return e.empty?this:(this.result.map?this.result.map(this.result,e):this.result)?new Ep(this.source,this.explicit,e.mapPos(this.limit),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new Qs(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}function ije(t,e,n,r){if(!t)return!1;let i=e.sliceDoc(n,r);return typeof t=="function"?t(i,n,r,e):wW(t,!0).test(i)}const NN=dn.define({map(t,e){return t.map(n=>n.map(e))}}),EW=dn.define(),rs=Is.define({create(){return X0.start()},update(t,e){return t.update(e)},provide:t=>[_N.from(t,e=>e.tooltip),et.contentAttributes.from(t,e=>e.attrs)]});function ON(t,e){const n=e.completion.apply||e.completion.label;let r=t.state.field(rs).active.find(i=>i.source==e.source);return r instanceof Ep?(typeof n=="string"?t.dispatch({...VCe(t.state,n,r.from,r.to),annotations:TN.of(e.completion)}):n(t,e.completion,r.from,r.to),!0):!1}const sje=QCe(rs,ON);function Zx(t,e="option"){return n=>{let r=n.state.field(rs,!1);if(!r||!r.open||r.open.disabled||Date.now()-r.open.timestamp<n.state.facet(Gr).interactionDelay)return!1;let i=1,s;e=="page"&&(s=iW(n,r.open.tooltip))&&(i=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let{length:o}=r.open.options,a=r.open.selected>-1?r.open.selected+i*(t?1:-1):t?0:o-1;return a<0?a=e=="page"?0:o-1:a>=o&&(a=e=="page"?o-1:0),n.dispatch({effects:EW.of(a)}),!0}}const oje=t=>{let e=t.state.field(rs,!1);return t.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<t.state.facet(Gr).interactionDelay?!1:ON(t,e.open.options[e.open.selected])},fS=t=>t.state.field(rs,!1)?(t.dispatch({effects:Y0.of(!0)}),!0):!1,aje=t=>{let e=t.state.field(rs,!1);return!e||!e.active.some(n=>n.state!=0)?!1:(t.dispatch({effects:rv.of(null)}),!0)};class lje{constructor(e,n){this.active=e,this.context=n,this.time=Date.now(),this.updates=[],this.done=void 0}}const cje=50,uje=1e3,dje=Ts.fromClass(class{constructor(t){this.view=t,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let e of t.state.field(rs).active)e.isPending&&this.startQuery(e)}update(t){let e=t.state.field(rs),n=t.state.facet(Gr);if(!t.selectionSet&&!t.docChanged&&t.startState.field(rs)==e)return;let r=t.transactions.some(s=>{let o=_W(s,n);return o&8||(s.selection||s.docChanged)&&!(o&3)});for(let s=0;s<this.running.length;s++){let o=this.running[s];if(r||o.context.abortOnDocChange&&t.docChanged||o.updates.length+t.transactions.length>cje&&Date.now()-o.time>uje){for(let a of o.context.abortListeners)try{a()}catch(l){Bi(this.view.state,l)}o.context.abortListeners=null,this.running.splice(s--,1)}else o.updates.push(...t.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),t.transactions.some(s=>s.effects.some(o=>o.is(Y0)))&&(this.pendingStart=!0);let i=this.pendingStart?50:n.activateOnTypingDelay;if(this.debounceUpdate=e.active.some(s=>s.isPending&&!this.running.some(o=>o.active.source==s.source))?setTimeout(()=>this.startUpdate(),i):-1,this.composing!=0)for(let s of t.transactions)s.isUserEvent("input.type")?this.composing=2:this.composing==2&&s.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:t}=this.view,e=t.field(rs);for(let n of e.active)n.isPending&&!this.running.some(r=>r.active.source==n.source)&&this.startQuery(n);this.running.length&&e.open&&e.open.disabled&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(Gr).updateSyncTime))}startQuery(t){let{state:e}=this.view,n=Cd(e),r=new bW(e,n,t.explicit,this.view),i=new lje(t,r);this.running.push(i),Promise.resolve(t.source(r)).then(s=>{i.context.aborted||(i.done=s||null,this.scheduleAccept())},s=>{this.view.dispatch({effects:rv.of(null)}),Bi(this.view.state,s)})}scheduleAccept(){this.running.every(t=>t.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(Gr).updateSyncTime))}accept(){var t;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],n=this.view.state.facet(Gr),r=this.view.state.field(rs);for(let i=0;i<this.running.length;i++){let s=this.running[i];if(s.done===void 0)continue;if(this.running.splice(i--,1),s.done){let a=Cd(s.updates.length?s.updates[0].startState:this.view.state),l=Math.min(a,s.done.from+(s.active.explicit?0:1)),c=new Ep(s.active.source,s.active.explicit,l,s.done,s.done.from,(t=s.done.to)!==null&&t!==void 0?t:a);for(let d of s.updates)c=c.update(d,n);if(c.hasResult()){e.push(c);continue}}let o=r.active.find(a=>a.source==s.active.source);if(o&&o.isPending)if(s.done==null){let a=new Qs(s.active.source,0);for(let l of s.updates)a=a.update(l,n);a.isPending||e.push(a)}else this.startQuery(o)}(e.length||r.open&&r.open.disabled)&&this.view.dispatch({effects:NN.of(e)})}},{eventHandlers:{blur(t){let e=this.view.state.field(rs,!1);if(e&&e.tooltip&&this.view.state.facet(Gr).closeOnBlur){let n=e.open&&iW(this.view,e.open.tooltip);(!n||!n.dom.contains(t.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:rv.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:Y0.of(!1)}),20),this.composing=0}}}),hje=typeof navigator=="object"&&/Win/.test(navigator.platform),pje=Kf.highest(et.domEventHandlers({keydown(t,e){let n=e.state.field(rs,!1);if(!n||!n.open||n.open.disabled||n.open.selected<0||t.key.length>1||t.ctrlKey&&!(hje&&t.altKey)||t.metaKey)return!1;let r=n.open.options[n.open.selected],i=n.active.find(o=>o.source==r.source),s=r.completion.commitCharacters||i.result.commitCharacters;return s&&s.indexOf(t.key)>-1&&ON(e,r),!1}})),SW=et.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'""',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"''"}},".cm-completionIcon-class":{"&:after":{content:"''"}},".cm-completionIcon-interface":{"&:after":{content:"''"}},".cm-completionIcon-variable":{"&:after":{content:"''"}},".cm-completionIcon-constant":{"&:after":{content:"''"}},".cm-completionIcon-type":{"&:after":{content:"''"}},".cm-completionIcon-enum":{"&:after":{content:"''"}},".cm-completionIcon-property":{"&:after":{content:"''"}},".cm-completionIcon-keyword":{"&:after":{content:"''"}},".cm-completionIcon-namespace":{"&:after":{content:"''"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class fje{constructor(e,n,r,i){this.field=e,this.line=n,this.from=r,this.to=i}}class RN{constructor(e,n,r){this.field=e,this.from=n,this.to=r}map(e){let n=e.mapPos(this.from,-1,oi.TrackDel),r=e.mapPos(this.to,1,oi.TrackDel);return n==null||r==null?null:new RN(this.field,n,r)}}class AN{constructor(e,n){this.lines=e,this.fieldPositions=n}instantiate(e,n){let r=[],i=[n],s=e.doc.lineAt(n),o=/^\s*/.exec(s.text)[0];for(let l of this.lines){if(r.length){let c=o,d=/^\t*/.exec(l)[0].length;for(let h=0;h<d;h++)c+=e.facet(l1);i.push(n+c.length-d),l=c+l.slice(d)}r.push(l),n+=l.length+1}let a=this.fieldPositions.map(l=>new RN(l.field,i[l.line]+l.from,i[l.line]+l.to));return{text:r,ranges:a}}static parse(e){let n=[],r=[],i=[],s;for(let o of e.split(/\r\n?|\n/)){for(;s=/[#$]\{(?:(\d+)(?::([^{}]*))?|((?:\\[{}]|[^{}])*))\}/.exec(o);){let a=s[1]?+s[1]:null,l=s[2]||s[3]||"",c=-1,d=l.replace(/\\[{}]/g,h=>h[1]);for(let h=0;h<n.length;h++)(a!=null?n[h].seq==a:d&&n[h].name==d)&&(c=h);if(c<0){let h=0;for(;h<n.length&&(a==null||n[h].seq!=null&&n[h].seq<a);)h++;n.splice(h,0,{seq:a,name:d}),c=h;for(let p of i)p.field>=c&&p.field++}for(let h of i)if(h.line==r.length&&h.from>s.index){let p=s[2]?3+(s[1]||"").length:2;h.from-=p,h.to-=p}i.push(new fje(c,r.length,s.index,s.index+d.length)),o=o.slice(0,s.index)+l+o.slice(s.index+s[0].length)}o=o.replace(/\\([{}])/g,(a,l,c)=>{for(let d of i)d.line==r.length&&d.from>c&&(d.from--,d.to--);return l}),r.push(o)}return new AN(r,i)}}let mje=sn.widget({widget:new class extends Xf{toDOM(){let t=document.createElement("span");return t.className="cm-snippetFieldPosition",t}ignoreEvent(){return!1}}}),gje=sn.mark({class:"cm-snippetField"});class Qf{constructor(e,n){this.ranges=e,this.active=n,this.deco=sn.set(e.map(r=>(r.from==r.to?mje:gje).range(r.from,r.to)),!0)}map(e){let n=[];for(let r of this.ranges){let i=r.map(e);if(!i)return null;n.push(i)}return new Qf(n,this.active)}selectionInsideField(e){return e.ranges.every(n=>this.ranges.some(r=>r.field==this.active&&r.from<=n.from&&r.to>=n.to))}}const _y=dn.define({map(t,e){return t&&t.map(e)}}),vje=dn.define(),iv=Is.define({create(){return null},update(t,e){for(let n of e.effects){if(n.is(_y))return n.value;if(n.is(vje)&&t)return new Qf(t.ranges,n.value)}return t&&e.docChanged&&(t=t.map(e.changes)),t&&e.selection&&!t.selectionInsideField(e.selection)&&(t=null),t},provide:t=>et.decorations.from(t,e=>e?e.deco:sn.none)});function IN(t,e){return ue.create(t.filter(n=>n.field==e).map(n=>ue.range(n.from,n.to)))}function yje(t){let e=AN.parse(t);return(n,r,i,s)=>{let{text:o,ranges:a}=e.instantiate(n.state,i),{main:l}=n.state.selection,c={changes:{from:i,to:s==l.from?l.to:s,insert:ln.of(o)},scrollIntoView:!0,annotations:r?[TN.of(r),ai.userEvent.of("input.complete")]:void 0};if(a.length&&(c.selection=IN(a,0)),a.some(d=>d.field>0)){let d=new Qf(a,0),h=c.effects=[_y.of(d)];n.state.field(iv,!1)===void 0&&h.push(dn.appendConfig.of([iv,Eje,Sje,SW]))}n.dispatch(n.state.update(c))}}function CW(t){return({state:e,dispatch:n})=>{let r=e.field(iv,!1);if(!r||t<0&&r.active==0)return!1;let i=r.active+t,s=t>0&&!r.ranges.some(o=>o.field==i+t);return n(e.update({selection:IN(r.ranges,i),effects:_y.of(s?null:new Qf(r.ranges,i)),scrollIntoView:!0})),!0}}const xje=({state:t,dispatch:e})=>t.field(iv,!1)?(e(t.update({effects:_y.of(null)})),!0):!1,bje=CW(1),wje=CW(-1),_je=[{key:"Tab",run:bje,shift:wje},{key:"Escape",run:xje}],NL=it.define({combine(t){return t.length?t[0]:_je}}),Eje=Kf.highest(o1.compute([NL],t=>t.facet(NL)));function ma(t,e){return{...e,apply:yje(t)}}const Sje=et.domEventHandlers({mousedown(t,e){let n=e.state.field(iv,!1),r;if(!n||(r=e.posAtCoords({x:t.clientX,y:t.clientY}))==null)return!1;let i=n.ranges.find(s=>s.from<=r&&s.to>=r);return!i||i.field==n.active?!1:(e.dispatch({selection:IN(n.ranges,i.field),effects:_y.of(n.ranges.some(s=>s.field>i.field)?new Qf(n.ranges,i.field):null),scrollIntoView:!0}),!0)}}),Q0={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},dd=dn.define({map(t,e){let n=e.mapPos(t,-1,oi.TrackAfter);return n??void 0}}),DN=new class extends Dd{};DN.startSide=1;DN.endSide=-1;const jW=Is.define({create(){return $n.empty},update(t,e){if(t=t.map(e.changes),e.selection){let n=e.state.doc.lineAt(e.selection.main.head);t=t.update({filter:r=>r>=n.from&&r<=n.to})}for(let n of e.effects)n.is(dd)&&(t=t.update({add:[DN.range(n.value,n.value+1)]}));return t}});function Cje(){return[Tje,jW]}const mS="()[]{}<>";function jje(t){for(let e=0;e<mS.length;e+=2)if(mS.charCodeAt(e)==t)return mS.charAt(e+1);return qq(t<128?t:t+1)}function kje(t,e){return t.languageDataAt("closeBrackets",e)[0]||Q0}const Pje=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),Tje=et.inputHandler.of((t,e,n,r)=>{if((Pje?t.composing:t.compositionStarted)||t.state.readOnly)return!1;let i=t.state.selection.main;if(r.length>2||r.length==2&&Ec(wa(r,0))==1||e!=i.from||n!=i.to)return!1;let s=Nje(t.state,r);return s?(t.dispatch(s),!0):!1});function Nje(t,e){let n=kje(t,t.selection.main.head),r=n.brackets||Q0.brackets;for(let i of r){let s=jje(wa(i,0));if(e==i)return s==i?Aje(t,i,r.indexOf(i+i+i)>-1,n):Oje(t,i,s,n.before||Q0.before);if(e==s&&kW(t,t.selection.main.from))return Rje(t,i,s)}return null}function kW(t,e){let n=!1;return t.field(jW).between(0,t.doc.length,r=>{r==e&&(n=!0)}),n}function $N(t,e){let n=t.sliceString(e,e+2);return n.slice(0,Ec(wa(n,0)))}function Oje(t,e,n,r){let i=null,s=t.changeByRange(o=>{if(!o.empty)return{changes:[{insert:e,from:o.from},{insert:n,from:o.to}],effects:dd.of(o.to+e.length),range:ue.range(o.anchor+e.length,o.head+e.length)};let a=$N(t.doc,o.head);return!a||/\s/.test(a)||r.indexOf(a)>-1?{changes:{insert:e+n,from:o.head},effects:dd.of(o.head+e.length),range:ue.cursor(o.head+e.length)}:{range:i=o}});return i?null:t.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function Rje(t,e,n){let r=null,i=t.changeByRange(s=>s.empty&&$N(t.doc,s.head)==n?{changes:{from:s.head,to:s.head+n.length,insert:n},range:ue.cursor(s.head+n.length)}:r={range:s});return r?null:t.update(i,{scrollIntoView:!0,userEvent:"input.type"})}function Aje(t,e,n,r){let i=r.stringPrefixes||Q0.stringPrefixes,s=null,o=t.changeByRange(a=>{if(!a.empty)return{changes:[{insert:e,from:a.from},{insert:e,from:a.to}],effects:dd.of(a.to+e.length),range:ue.range(a.anchor+e.length,a.head+e.length)};let l=a.head,c=$N(t.doc,l),d;if(c==e){if(OL(t,l))return{changes:{insert:e+e,from:l},effects:dd.of(l+e.length),range:ue.cursor(l+e.length)};if(kW(t,l)){let p=n&&t.sliceDoc(l,l+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:l,to:l+p.length,insert:p},range:ue.cursor(l+p.length)}}}else{if(n&&t.sliceDoc(l-2*e.length,l)==e+e&&(d=RL(t,l-2*e.length,i))>-1&&OL(t,d))return{changes:{insert:e+e+e+e,from:l},effects:dd.of(l+e.length),range:ue.cursor(l+e.length)};if(t.charCategorizer(l)(c)!=Xs.Word&&RL(t,l,i)>-1&&!Ije(t,l,e,i))return{changes:{insert:e+e,from:l},effects:dd.of(l+e.length),range:ue.cursor(l+e.length)}}return{range:s=a}});return s?null:t.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function OL(t,e){let n=Qr(t).resolveInner(e+1);return n.parent&&n.from==e}function Ije(t,e,n,r){let i=Qr(t).resolveInner(e,-1),s=r.reduce((o,a)=>Math.max(o,a.length),0);for(let o=0;o<5;o++){let a=t.sliceDoc(i.from,Math.min(i.to,i.from+n.length+s)),l=a.indexOf(n);if(!l||l>-1&&r.indexOf(a.slice(0,l))>-1){let d=i.firstChild;for(;d&&d.from==i.from&&d.to-d.from>n.length+l;){if(t.sliceDoc(d.to-n.length,d.to)==n)return!1;d=d.firstChild}return!0}let c=i.to==e&&i.parent;if(!c)break;i=c}return!1}function RL(t,e,n){let r=t.charCategorizer(e);if(r(t.sliceDoc(e-1,e))!=Xs.Word)return e;for(let i of n){let s=e-i.length;if(t.sliceDoc(s,e)==i&&r(t.sliceDoc(s-1,s))!=Xs.Word)return s}return-1}function Dje(t={}){return[pje,rs,Gr.of(t),dje,Mje,SW]}const $je=[{key:"Ctrl-Space",run:fS},{mac:"Alt-`",run:fS},{mac:"Alt-i",run:fS},{key:"Escape",run:aje},{key:"ArrowDown",run:Zx(!0)},{key:"ArrowUp",run:Zx(!1)},{key:"PageDown",run:Zx(!0,"page")},{key:"PageUp",run:Zx(!1,"page")},{key:"Enter",run:oje}],Mje=Kf.highest(o1.computeN([Gr],t=>t.facet(Gr).defaultKeymap?[$je]:[])),Lje=t=>{let{state:e}=t,n=e.doc.lineAt(e.selection.main.from),r=LN(t.state,n.from);return r.line?Bje(t):r.block?zje(t):!1};function MN(t,e){return({state:n,dispatch:r})=>{if(n.readOnly)return!1;let i=t(e,n);return i?(r(n.update(i)),!0):!1}}const Bje=MN(Vje,0),Fje=MN(PW,0),zje=MN((t,e)=>PW(t,e,Uje(e)),0);function LN(t,e){let n=t.languageDataAt("commentTokens",e,1);return n.length?n[0]:{}}const Lm=50;function Hje(t,{open:e,close:n},r,i){let s=t.sliceDoc(r-Lm,r),o=t.sliceDoc(i,i+Lm),a=/\s*$/.exec(s)[0].length,l=/^\s*/.exec(o)[0].length,c=s.length-a;if(s.slice(c-e.length,c)==e&&o.slice(l,l+n.length)==n)return{open:{pos:r-a,margin:a&&1},close:{pos:i+l,margin:l&&1}};let d,h;i-r<=2*Lm?d=h=t.sliceDoc(r,i):(d=t.sliceDoc(r,r+Lm),h=t.sliceDoc(i-Lm,i));let p=/^\s*/.exec(d)[0].length,f=/\s*$/.exec(h)[0].length,m=h.length-f-n.length;return d.slice(p,p+e.length)==e&&h.slice(m,m+n.length)==n?{open:{pos:r+p+e.length,margin:/\s/.test(d.charAt(p+e.length))?1:0},close:{pos:i-f-n.length,margin:/\s/.test(h.charAt(m-1))?1:0}}:null}function Uje(t){let e=[];for(let n of t.selection.ranges){let r=t.doc.lineAt(n.from),i=n.to<=r.to?r:t.doc.lineAt(n.to);i.from>r.from&&i.from==n.to&&(i=n.to==r.to+1?r:t.doc.lineAt(n.to-1));let s=e.length-1;s>=0&&e[s].to>r.from?e[s].to=i.to:e.push({from:r.from+/^\s*/.exec(r.text)[0].length,to:i.to})}return e}function PW(t,e,n=e.selection.ranges){let r=n.map(s=>LN(e,s.from).block);if(!r.every(s=>s))return null;let i=n.map((s,o)=>Hje(e,r[o],s.from,s.to));if(t!=2&&!i.every(s=>s))return{changes:e.changes(n.map((s,o)=>i[o]?[]:[{from:s.from,insert:r[o].open+" "},{from:s.to,insert:" "+r[o].close}]))};if(t!=1&&i.some(s=>s)){let s=[];for(let o=0,a;o<i.length;o++)if(a=i[o]){let l=r[o],{open:c,close:d}=a;s.push({from:c.pos-l.open.length,to:c.pos+c.margin},{from:d.pos-d.margin,to:d.pos+l.close.length})}return{changes:s}}return null}function Vje(t,e,n=e.selection.ranges){let r=[],i=-1;for(let{from:s,to:o}of n){let a=r.length,l=1e9,c=LN(e,s).line;if(c){for(let d=s;d<=o;){let h=e.doc.lineAt(d);if(h.from>i&&(s==o||o>h.from)){i=h.from;let p=/^\s*/.exec(h.text)[0].length,f=p==h.length,m=h.text.slice(p,p+c.length)==c?p:-1;p<h.text.length&&p<l&&(l=p),r.push({line:h,comment:m,token:c,indent:p,empty:f,single:!1})}d=h.to+1}if(l<1e9)for(let d=a;d<r.length;d++)r[d].indent<r[d].line.text.length&&(r[d].indent=l);r.length==a+1&&(r[a].single=!0)}}if(t!=2&&r.some(s=>s.comment<0&&(!s.empty||s.single))){let s=[];for(let{line:a,token:l,indent:c,empty:d,single:h}of r)(h||!d)&&s.push({from:a.from+c,insert:l+" "});let o=e.changes(s);return{changes:o,selection:e.selection.map(o,1)}}else if(t!=1&&r.some(s=>s.comment>=0)){let s=[];for(let{line:o,comment:a,token:l}of r)if(a>=0){let c=o.from+a,d=c+l.length;o.text[d-o.from]==" "&&d++,s.push({from:c,to:d})}return{changes:s}}return null}function Zf(t,e){return ue.create(t.ranges.map(e),t.mainIndex)}function Xo(t,e){return t.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function Qo({state:t,dispatch:e},n){let r=Zf(t.selection,n);return r.eq(t.selection,!0)?!1:(e(Xo(t,r)),!0)}function h1(t,e){return ue.cursor(e?t.to:t.from)}function TW(t,e){return Qo(t,n=>n.empty?t.moveByChar(n,e):h1(n,e))}function ji(t){return t.textDirectionAt(t.state.selection.main.head)==gr.LTR}const NW=t=>TW(t,!ji(t)),OW=t=>TW(t,ji(t));function RW(t,e){return Qo(t,n=>n.empty?t.moveByGroup(n,e):h1(n,e))}const qje=t=>RW(t,!ji(t)),Wje=t=>RW(t,ji(t));function Gje(t,e,n){if(e.type.prop(n))return!0;let r=e.to-e.from;return r&&(r>2||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function p1(t,e,n){let r=Qr(t).resolveInner(e.head),i=n?Gt.closedBy:Gt.openedBy;for(let l=e.head;;){let c=n?r.childAfter(l):r.childBefore(l);if(!c)break;Gje(t,c,i)?r=c:l=n?c.to:c.from}let s=r.type.prop(i),o,a;return s&&(o=n?ja(t,r.from,1):ja(t,r.to,-1))&&o.matched?a=n?o.end.to:o.end.from:a=n?r.to:r.from,ue.cursor(a,n?-1:1)}const Kje=t=>Qo(t,e=>p1(t.state,e,!ji(t))),Yje=t=>Qo(t,e=>p1(t.state,e,ji(t)));function AW(t,e){return Qo(t,n=>{if(!n.empty)return h1(n,e);let r=t.moveVertically(n,e);return r.head!=n.head?r:t.moveToLineBoundary(n,e)})}const IW=t=>AW(t,!1),DW=t=>AW(t,!0);function $W(t){let e=t.scrollDOM.clientHeight<t.scrollDOM.scrollHeight-2,n=0,r=0,i;if(e){for(let s of t.state.facet(et.scrollMargins)){let o=s(t);o!=null&&o.top&&(n=Math.max(o==null?void 0:o.top,n)),o!=null&&o.bottom&&(r=Math.max(o==null?void 0:o.bottom,r))}i=t.scrollDOM.clientHeight-n-r}else i=(t.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:n,marginBottom:r,selfScroll:e,height:Math.max(t.defaultLineHeight,i-5)}}function MW(t,e){let n=$W(t),{state:r}=t,i=Zf(r.selection,o=>o.empty?t.moveVertically(o,e,n.height):h1(o,e));if(i.eq(r.selection))return!1;let s;if(n.selfScroll){let o=t.coordsAtPos(r.selection.main.head),a=t.scrollDOM.getBoundingClientRect(),l=a.top+n.marginTop,c=a.bottom-n.marginBottom;o&&o.top>l&&o.bottom<c&&(s=et.scrollIntoView(i.main.head,{y:"start",yMargin:o.top-l}))}return t.dispatch(Xo(r,i),{effects:s}),!0}const AL=t=>MW(t,!1),Kj=t=>MW(t,!0);function bu(t,e,n){let r=t.lineBlockAt(e.head),i=t.moveToLineBoundary(e,n);if(i.head==e.head&&i.head!=(n?r.to:r.from)&&(i=t.moveToLineBoundary(e,n,!1)),!n&&i.head==r.from&&r.length){let s=/^\s*/.exec(t.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;s&&e.head!=r.from+s&&(i=ue.cursor(r.from+s))}return i}const Xje=t=>Qo(t,e=>bu(t,e,!0)),Qje=t=>Qo(t,e=>bu(t,e,!1)),Zje=t=>Qo(t,e=>bu(t,e,!ji(t))),Jje=t=>Qo(t,e=>bu(t,e,ji(t))),eke=t=>Qo(t,e=>ue.cursor(t.lineBlockAt(e.head).from,1)),tke=t=>Qo(t,e=>ue.cursor(t.lineBlockAt(e.head).to,-1));function nke(t,e,n){let r=!1,i=Zf(t.selection,s=>{let o=ja(t,s.head,-1)||ja(t,s.head,1)||s.head>0&&ja(t,s.head-1,1)||s.head<t.doc.length&&ja(t,s.head+1,-1);if(!o||!o.end)return s;r=!0;let a=o.start.from==s.head?o.end.to:o.end.from;return ue.cursor(a)});return r?(e(Xo(t,i)),!0):!1}const rke=({state:t,dispatch:e})=>nke(t,e);function wo(t,e){let n=Zf(t.state.selection,r=>{let i=e(r);return ue.range(r.anchor,i.head,i.goalColumn,i.bidiLevel||void 0)});return n.eq(t.state.selection)?!1:(t.dispatch(Xo(t.state,n)),!0)}function LW(t,e){return wo(t,n=>t.moveByChar(n,e))}const BW=t=>LW(t,!ji(t)),FW=t=>LW(t,ji(t));function zW(t,e){return wo(t,n=>t.moveByGroup(n,e))}const ike=t=>zW(t,!ji(t)),ske=t=>zW(t,ji(t)),oke=t=>wo(t,e=>p1(t.state,e,!ji(t))),ake=t=>wo(t,e=>p1(t.state,e,ji(t)));function HW(t,e){return wo(t,n=>t.moveVertically(n,e))}const UW=t=>HW(t,!1),VW=t=>HW(t,!0);function qW(t,e){return wo(t,n=>t.moveVertically(n,e,$W(t).height))}const IL=t=>qW(t,!1),DL=t=>qW(t,!0),lke=t=>wo(t,e=>bu(t,e,!0)),cke=t=>wo(t,e=>bu(t,e,!1)),uke=t=>wo(t,e=>bu(t,e,!ji(t))),dke=t=>wo(t,e=>bu(t,e,ji(t))),hke=t=>wo(t,e=>ue.cursor(t.lineBlockAt(e.head).from)),pke=t=>wo(t,e=>ue.cursor(t.lineBlockAt(e.head).to)),$L=({state:t,dispatch:e})=>(e(Xo(t,{anchor:0})),!0),ML=({state:t,dispatch:e})=>(e(Xo(t,{anchor:t.doc.length})),!0),LL=({state:t,dispatch:e})=>(e(Xo(t,{anchor:t.selection.main.anchor,head:0})),!0),BL=({state:t,dispatch:e})=>(e(Xo(t,{anchor:t.selection.main.anchor,head:t.doc.length})),!0),fke=({state:t,dispatch:e})=>(e(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"})),!0),mke=({state:t,dispatch:e})=>{let n=f1(t).map(({from:r,to:i})=>ue.range(r,Math.min(i+1,t.doc.length)));return e(t.update({selection:ue.create(n),userEvent:"select"})),!0},gke=({state:t,dispatch:e})=>{let n=Zf(t.selection,r=>{let i=Qr(t),s=i.resolveStack(r.from,1);if(r.empty){let o=i.resolveStack(r.from,-1);o.node.from>=s.node.from&&o.node.to<=s.node.to&&(s=o)}for(let o=s;o;o=o.next){let{node:a}=o;if((a.from<r.from&&a.to>=r.to||a.to>r.to&&a.from<=r.from)&&o.next)return ue.range(a.to,a.from)}return r});return n.eq(t.selection)?!1:(e(Xo(t,n)),!0)};function WW(t,e){let{state:n}=t,r=n.selection,i=n.selection.ranges.slice();for(let s of n.selection.ranges){let o=n.doc.lineAt(s.head);if(e?o.to<t.state.doc.length:o.from>0)for(let a=s;;){let l=t.moveVertically(a,e);if(l.head<o.from||l.head>o.to){i.some(c=>c.head==l.head)||i.push(l);break}else{if(l.head==a.head)break;a=l}}}return i.length==r.ranges.length?!1:(t.dispatch(Xo(n,ue.create(i,i.length-1))),!0)}const vke=t=>WW(t,!1),yke=t=>WW(t,!0),xke=({state:t,dispatch:e})=>{let n=t.selection,r=null;return n.ranges.length>1?r=ue.create([n.main]):n.main.empty||(r=ue.create([ue.cursor(n.main.head)])),r?(e(Xo(t,r)),!0):!1};function Ey(t,e){if(t.state.readOnly)return!1;let n="delete.selection",{state:r}=t,i=r.changeByRange(s=>{let{from:o,to:a}=s;if(o==a){let l=e(s);l<o?(n="delete.backward",l=Jx(t,l,!1)):l>o&&(n="delete.forward",l=Jx(t,l,!0)),o=Math.min(o,l),a=Math.max(a,l)}else o=Jx(t,o,!1),a=Jx(t,a,!0);return o==a?{range:s}:{changes:{from:o,to:a},range:ue.cursor(o,o<s.head?-1:1)}});return i.changes.empty?!1:(t.dispatch(r.update(i,{scrollIntoView:!0,userEvent:n,effects:n=="delete.selection"?et.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function Jx(t,e,n){if(t instanceof et)for(let r of t.state.facet(et.atomicRanges).map(i=>i(t)))r.between(e,e,(i,s)=>{i<e&&s>e&&(e=n?s:i)});return e}const GW=(t,e,n)=>Ey(t,r=>{let i=r.from,{state:s}=t,o=s.doc.lineAt(i),a,l;if(n&&!e&&i>o.from&&i<o.from+200&&!/[^ \t]/.test(a=o.text.slice(0,i-o.from))){if(a[a.length-1]=="	")return i-1;let c=r1(a,s.tabSize),d=c%K0(s)||K0(s);for(let h=0;h<d&&a[a.length-1-h]==" ";h++)i--;l=i}else l=Li(o.text,i-o.from,e,e)+o.from,l==i&&o.number!=(e?s.doc.lines:1)?l+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(o.text.slice(l-o.from,i-o.from))&&(l=Li(o.text,l-o.from,!1,!1)+o.from);return l}),Yj=t=>GW(t,!1,!0),KW=t=>GW(t,!0,!1),YW=(t,e)=>Ey(t,n=>{let r=n.head,{state:i}=t,s=i.doc.lineAt(r),o=i.charCategorizer(r);for(let a=null;;){if(r==(e?s.to:s.from)){r==n.head&&s.number!=(e?i.doc.lines:1)&&(r+=e?1:-1);break}let l=Li(s.text,r-s.from,e)+s.from,c=s.text.slice(Math.min(r,l)-s.from,Math.max(r,l)-s.from),d=o(c);if(a!=null&&d!=a)break;(c!=" "||r!=n.head)&&(a=d),r=l}return r}),XW=t=>YW(t,!1),bke=t=>YW(t,!0),wke=t=>Ey(t,e=>{let n=t.lineBlockAt(e.head).to;return e.head<n?n:Math.min(t.state.doc.length,e.head+1)}),_ke=t=>Ey(t,e=>{let n=t.moveToLineBoundary(e,!1).head;return e.head>n?n:Math.max(0,e.head-1)}),Eke=t=>Ey(t,e=>{let n=t.moveToLineBoundary(e,!0).head;return e.head<n?n:Math.min(t.state.doc.length,e.head+1)}),Ske=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=t.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:ln.of(["",""])},range:ue.cursor(r.from)}));return e(t.update(n,{scrollIntoView:!0,userEvent:"input"})),!0},Cke=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=t.changeByRange(r=>{if(!r.empty||r.from==0||r.from==t.doc.length)return{range:r};let i=r.from,s=t.doc.lineAt(i),o=i==s.from?i-1:Li(s.text,i-s.from,!1)+s.from,a=i==s.to?i+1:Li(s.text,i-s.from,!0)+s.from;return{changes:{from:o,to:a,insert:t.doc.slice(i,a).append(t.doc.slice(o,i))},range:ue.cursor(a)}});return n.changes.empty?!1:(e(t.update(n,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function f1(t){let e=[],n=-1;for(let r of t.selection.ranges){let i=t.doc.lineAt(r.from),s=t.doc.lineAt(r.to);if(!r.empty&&r.to==s.from&&(s=t.doc.lineAt(r.to-1)),n>=i.number){let o=e[e.length-1];o.to=s.to,o.ranges.push(r)}else e.push({from:i.from,to:s.to,ranges:[r]});n=s.number+1}return e}function QW(t,e,n){if(t.readOnly)return!1;let r=[],i=[];for(let s of f1(t)){if(n?s.to==t.doc.length:s.from==0)continue;let o=t.doc.lineAt(n?s.to+1:s.from-1),a=o.length+1;if(n){r.push({from:s.to,to:o.to},{from:s.from,insert:o.text+t.lineBreak});for(let l of s.ranges)i.push(ue.range(Math.min(t.doc.length,l.anchor+a),Math.min(t.doc.length,l.head+a)))}else{r.push({from:o.from,to:s.from},{from:s.to,insert:t.lineBreak+o.text});for(let l of s.ranges)i.push(ue.range(l.anchor-a,l.head-a))}}return r.length?(e(t.update({changes:r,scrollIntoView:!0,selection:ue.create(i,t.selection.mainIndex),userEvent:"move.line"})),!0):!1}const jke=({state:t,dispatch:e})=>QW(t,e,!1),kke=({state:t,dispatch:e})=>QW(t,e,!0);function ZW(t,e,n){if(t.readOnly)return!1;let r=[];for(let i of f1(t))n?r.push({from:i.from,insert:t.doc.slice(i.from,i.to)+t.lineBreak}):r.push({from:i.to,insert:t.lineBreak+t.doc.slice(i.from,i.to)});return e(t.update({changes:r,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const Pke=({state:t,dispatch:e})=>ZW(t,e,!1),Tke=({state:t,dispatch:e})=>ZW(t,e,!0),Nke=t=>{if(t.state.readOnly)return!1;let{state:e}=t,n=e.changes(f1(e).map(({from:i,to:s})=>(i>0?i--:s<e.doc.length&&s++,{from:i,to:s}))),r=Zf(e.selection,i=>{let s;if(t.lineWrapping){let o=t.lineBlockAt(i.head),a=t.coordsAtPos(i.head,i.assoc||1);a&&(s=o.bottom+t.documentTop-a.bottom+t.defaultLineHeight/2)}return t.moveVertically(i,!0,s)}).map(n);return t.dispatch({changes:n,selection:r,scrollIntoView:!0,userEvent:"delete.line"}),!0};function Oke(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};let n=Qr(t).resolveInner(e),r=n.childBefore(e),i=n.childAfter(e),s;return r&&i&&r.to<=e&&i.from>=e&&(s=r.type.prop(Gt.closedBy))&&s.indexOf(i.name)>-1&&t.doc.lineAt(r.to).from==t.doc.lineAt(i.from).from&&!/\S/.test(t.sliceDoc(r.to,i.from))?{from:r.to,to:i.from}:null}const FL=JW(!1),Rke=JW(!0);function JW(t){return({state:e,dispatch:n})=>{if(e.readOnly)return!1;let r=e.changeByRange(i=>{let{from:s,to:o}=i,a=e.doc.lineAt(s),l=!t&&s==o&&Oke(e,s);t&&(s=o=(o<=a.to?a:e.doc.lineAt(o)).to);let c=new c1(e,{simulateBreak:s,simulateDoubleBreak:!!l}),d=kN(c,s);for(d==null&&(d=r1(/^\s*/.exec(e.doc.lineAt(s).text)[0],e.tabSize));o<a.to&&/\s/.test(a.text[o-a.from]);)o++;l?{from:s,to:o}=l:s>a.from&&s<a.from+100&&!/\S/.test(a.text.slice(0,s))&&(s=a.from);let h=["",nv(e,d)];return l&&h.push(nv(e,c.lineIndent(a.from,-1))),{changes:{from:s,to:o,insert:ln.of(h)},range:ue.cursor(s+1+h[1].length)}});return n(e.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function BN(t,e){let n=-1;return t.changeByRange(r=>{let i=[];for(let o=r.from;o<=r.to;){let a=t.doc.lineAt(o);a.number>n&&(r.empty||r.to>a.from)&&(e(a,i,r),n=a.number),o=a.to+1}let s=t.changes(i);return{changes:i,range:ue.range(s.mapPos(r.anchor,1),s.mapPos(r.head,1))}})}const Ake=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=Object.create(null),r=new c1(t,{overrideIndentation:s=>{let o=n[s];return o??-1}}),i=BN(t,(s,o,a)=>{let l=kN(r,s.from);if(l==null)return;/\S/.test(s.text)||(l=0);let c=/^\s*/.exec(s.text)[0],d=nv(t,l);(c!=d||a.from<s.from+c.length)&&(n[s.from]=l,o.push({from:s.from,to:s.from+c.length,insert:d}))});return i.changes.empty||e(t.update(i,{userEvent:"indent"})),!0},Ike=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(BN(t,(n,r)=>{r.push({from:n.from,insert:t.facet(l1)})}),{userEvent:"input.indent"})),!0),Dke=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(BN(t,(n,r)=>{let i=/^\s*/.exec(n.text)[0];if(!i)return;let s=r1(i,t.tabSize),o=0,a=nv(t,Math.max(0,s-K0(t)));for(;o<i.length&&o<a.length&&i.charCodeAt(o)==a.charCodeAt(o);)o++;r.push({from:n.from+o,to:n.from+i.length,insert:a.slice(o)})}),{userEvent:"delete.dedent"})),!0),$ke=t=>(t.setTabFocusMode(),!0),Mke=[{key:"Ctrl-b",run:NW,shift:BW,preventDefault:!0},{key:"Ctrl-f",run:OW,shift:FW},{key:"Ctrl-p",run:IW,shift:UW},{key:"Ctrl-n",run:DW,shift:VW},{key:"Ctrl-a",run:eke,shift:hke},{key:"Ctrl-e",run:tke,shift:pke},{key:"Ctrl-d",run:KW},{key:"Ctrl-h",run:Yj},{key:"Ctrl-k",run:wke},{key:"Ctrl-Alt-h",run:XW},{key:"Ctrl-o",run:Ske},{key:"Ctrl-t",run:Cke},{key:"Ctrl-v",run:Kj}],Lke=[{key:"ArrowLeft",run:NW,shift:BW,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:qje,shift:ike,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:Zje,shift:uke,preventDefault:!0},{key:"ArrowRight",run:OW,shift:FW,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:Wje,shift:ske,preventDefault:!0},{mac:"Cmd-ArrowRight",run:Jje,shift:dke,preventDefault:!0},{key:"ArrowUp",run:IW,shift:UW,preventDefault:!0},{mac:"Cmd-ArrowUp",run:$L,shift:LL},{mac:"Ctrl-ArrowUp",run:AL,shift:IL},{key:"ArrowDown",run:DW,shift:VW,preventDefault:!0},{mac:"Cmd-ArrowDown",run:ML,shift:BL},{mac:"Ctrl-ArrowDown",run:Kj,shift:DL},{key:"PageUp",run:AL,shift:IL},{key:"PageDown",run:Kj,shift:DL},{key:"Home",run:Qje,shift:cke,preventDefault:!0},{key:"Mod-Home",run:$L,shift:LL},{key:"End",run:Xje,shift:lke,preventDefault:!0},{key:"Mod-End",run:ML,shift:BL},{key:"Enter",run:FL,shift:FL},{key:"Mod-a",run:fke},{key:"Backspace",run:Yj,shift:Yj,preventDefault:!0},{key:"Delete",run:KW,preventDefault:!0},{key:"Mod-Backspace",mac:"Alt-Backspace",run:XW,preventDefault:!0},{key:"Mod-Delete",mac:"Alt-Delete",run:bke,preventDefault:!0},{mac:"Mod-Backspace",run:_ke,preventDefault:!0},{mac:"Mod-Delete",run:Eke,preventDefault:!0}].concat(Mke.map(t=>({mac:t.key,run:t.run,shift:t.shift}))),Bke=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:Kje,shift:oke},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:Yje,shift:ake},{key:"Alt-ArrowUp",run:jke},{key:"Shift-Alt-ArrowUp",run:Pke},{key:"Alt-ArrowDown",run:kke},{key:"Shift-Alt-ArrowDown",run:Tke},{key:"Mod-Alt-ArrowUp",run:vke},{key:"Mod-Alt-ArrowDown",run:yke},{key:"Escape",run:xke},{key:"Mod-Enter",run:Rke},{key:"Alt-l",mac:"Ctrl-l",run:mke},{key:"Mod-i",run:gke,preventDefault:!0},{key:"Mod-[",run:Dke},{key:"Mod-]",run:Ike},{key:"Mod-Alt-\\",run:Ake},{key:"Shift-Mod-k",run:Nke},{key:"Shift-Mod-\\",run:rke},{key:"Mod-/",run:Lje},{key:"Alt-A",run:Fje},{key:"Ctrl-m",mac:"Shift-Alt-m",run:$ke}].concat(Lke);class zL{constructor(e,n,r){this.from=e,this.to=n,this.diagnostic=r}}class rd{constructor(e,n,r){this.diagnostics=e,this.panel=n,this.selected=r}static init(e,n,r){let i=r.facet(ka).markerFilter;i&&(e=i(e,r));let s=e.slice().sort((f,m)=>f.from-m.from||f.to-m.to),o=new rf,a=[],l=0,c=r.doc.iter(),d=0,h=r.doc.length;for(let f=0;;){let m=f==s.length?null:s[f];if(!m&&!a.length)break;let g,v;if(a.length)g=l,v=a.reduce((y,w)=>Math.min(y,w.to),m&&m.from>g?m.from:1e8);else{if(g=m.from,g>h)break;v=m.to,a.push(m),f++}for(;f<s.length;){let y=s[f];if(y.from==g&&(y.to>y.from||y.to==g))a.push(y),f++,v=Math.min(y.to,v);else{v=Math.min(y.from,v);break}}v=Math.min(v,h);let b=!1;if(a.some(y=>y.from==g&&(y.to==v||v==h))&&(b=g==v,!b&&v-g<10)){let y=g-(d+c.value.length);y>0&&(c.next(y),d=g);for(let w=g;;){if(w>=v){b=!0;break}if(!c.lineBreak&&d+c.value.length>w)break;w=d+c.value.length,d+=c.value.length,c.next()}}let x=Jke(a);if(b)o.add(g,g,sn.widget({widget:new Yke(x),diagnostics:a.slice()}));else{let y=a.reduce((w,E)=>E.markClass?w+" "+E.markClass:w,"");o.add(g,v,sn.mark({class:"cm-lintRange cm-lintRange-"+x+y,diagnostics:a.slice(),inclusiveEnd:a.some(w=>w.to>v)}))}if(l=v,l==h)break;for(let y=0;y<a.length;y++)a[y].to<=l&&a.splice(y--,1)}let p=o.finish();return new rd(p,n,hf(p))}}function hf(t,e=null,n=0){let r=null;return t.between(n,1e9,(i,s,{spec:o})=>{if(!(e&&o.diagnostics.indexOf(e)<0))if(!r)r=new zL(i,s,e||o.diagnostics[0]);else{if(o.diagnostics.indexOf(r.diagnostic)<0)return!1;r=new zL(r.from,s,r.diagnostic)}}),r}function Fke(t,e){let n=e.pos,r=e.end||n,i=t.state.facet(ka).hideOn(t,n,r);if(i!=null)return i;let s=t.startState.doc.lineAt(e.pos);return!!(t.effects.some(o=>o.is(m1))||t.changes.touchesRange(s.from,Math.max(s.to,r)))}function zke(t,e){return t.field(Lo,!1)?e:e.concat(dn.appendConfig.of(i7))}function Hke(t,e){return{effects:zke(t,[m1.of(e)])}}const m1=dn.define(),e7=dn.define(),t7=dn.define(),Lo=Is.define({create(){return new rd(sn.none,null,null)},update(t,e){if(e.docChanged&&t.diagnostics.size){let n=t.diagnostics.map(e.changes),r=null,i=t.panel;if(t.selected){let s=e.changes.mapPos(t.selected.from,1);r=hf(n,t.selected.diagnostic,s)||hf(n,null,s)}!n.size&&i&&e.state.facet(ka).autoPanel&&(i=null),t=new rd(n,i,r)}for(let n of e.effects)if(n.is(m1)){let r=e.state.facet(ka).autoPanel?n.value.length?Z0.open:null:t.panel;t=rd.init(n.value,r,e.state)}else n.is(e7)?t=new rd(t.diagnostics,n.value?Z0.open:null,t.selected):n.is(t7)&&(t=new rd(t.diagnostics,t.panel,n.value));return t},provide:t=>[zj.from(t,e=>e.panel),et.decorations.from(t,e=>e.diagnostics)]}),Uke=sn.mark({class:"cm-lintRange cm-lintRange-active"});function Vke(t,e,n){let{diagnostics:r}=t.state.field(Lo),i,s=-1,o=-1;r.between(e-(n<0?1:0),e+(n>0?1:0),(l,c,{spec:d})=>{if(e>=l&&e<=c&&(l==c||(e>l||n>0)&&(e<c||n<0)))return i=d.diagnostics,s=l,o=c,!1});let a=t.state.facet(ka).tooltipFilter;return i&&a&&(i=a(i,t.state)),i?{pos:s,end:o,above:t.state.doc.lineAt(s).to<o,create(){return{dom:qke(t,i)}}}:null}function qke(t,e){return Ea("ul",{class:"cm-tooltip-lint"},e.map(n=>r7(t,n,!1)))}const HL=t=>{let e=t.state.field(Lo,!1);return!e||!e.panel?!1:(t.dispatch({effects:e7.of(!1)}),!0)},Wke=Ts.fromClass(class{constructor(t){this.view=t,this.timeout=-1,this.set=!0;let{delay:e}=t.state.facet(ka);this.lintTime=Date.now()+e,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,e)}run(){clearTimeout(this.timeout);let t=Date.now();if(t<this.lintTime-10)this.timeout=setTimeout(this.run,this.lintTime-t);else{this.set=!1;let{state:e}=this.view,{sources:n}=e.facet(ka);n.length&&Gke(n.map(r=>Promise.resolve(r(this.view))),r=>{this.view.state.doc==e.doc&&this.view.dispatch(Hke(this.view.state,r.reduce((i,s)=>i.concat(s))))},r=>{Bi(this.view.state,r)})}}update(t){let e=t.state.facet(ka);(t.docChanged||e!=t.startState.facet(ka)||e.needsRefresh&&e.needsRefresh(t))&&(this.lintTime=Date.now()+e.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,e.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}});function Gke(t,e,n){let r=[],i=-1;for(let s of t)s.then(o=>{r.push(o),clearTimeout(i),r.length==t.length?e(r):i=setTimeout(()=>e(r),200)},n)}const ka=it.define({combine(t){return{sources:t.map(e=>e.source).filter(e=>e!=null),...uN(t.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{delay:Math.max,markerFilter:UL,tooltipFilter:UL,needsRefresh:(e,n)=>e?n?r=>e(r)||n(r):e:n,hideOn:(e,n)=>e?n?(r,i,s)=>e(r,i,s)||n(r,i,s):e:n,autoPanel:(e,n)=>e||n})}}});function UL(t,e){return t?e?(n,r)=>e(t(n,r),r):t:e}function Kke(t,e={}){return[ka.of({source:t,config:e}),Wke,i7]}function n7(t){let e=[];if(t)e:for(let{name:n}of t){for(let r=0;r<n.length;r++){let i=n[r];if(/[a-zA-Z]/.test(i)&&!e.some(s=>s.toLowerCase()==i.toLowerCase())){e.push(i);continue e}}e.push("")}return e}function r7(t,e,n){var r;let i=n?n7(e.actions):[];return Ea("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},Ea("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage(t):e.message),(r=e.actions)===null||r===void 0?void 0:r.map((s,o)=>{let a=!1,l=f=>{if(f.preventDefault(),a)return;a=!0;let m=hf(t.state.field(Lo).diagnostics,e);m&&s.apply(t,m.from,m.to)},{name:c}=s,d=i[o]?c.indexOf(i[o]):-1,h=d<0?c:[c.slice(0,d),Ea("u",c.slice(d,d+1)),c.slice(d+1)],p=s.markClass?" "+s.markClass:"";return Ea("button",{type:"button",class:"cm-diagnosticAction"+p,onclick:l,onmousedown:l,"aria-label":` Action: ${c}${d<0?"":` (access key "${i[o]})"`}.`},h)}),e.source&&Ea("div",{class:"cm-diagnosticSource"},e.source))}class Yke extends Xf{constructor(e){super(),this.sev=e}eq(e){return e.sev==this.sev}toDOM(){return Ea("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}}class VL{constructor(e,n){this.diagnostic=n,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=r7(e,n,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class Z0{constructor(e){this.view=e,this.items=[];let n=i=>{if(i.keyCode==27)HL(this.view),this.view.focus();else if(i.keyCode==38||i.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(i.keyCode==40||i.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(i.keyCode==36)this.moveSelection(0);else if(i.keyCode==35)this.moveSelection(this.items.length-1);else if(i.keyCode==13)this.view.focus();else if(i.keyCode>=65&&i.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:s}=this.items[this.selectedIndex],o=n7(s.actions);for(let a=0;a<o.length;a++)if(o[a].toUpperCase().charCodeAt(0)==i.keyCode){let l=hf(this.view.state.field(Lo).diagnostics,s);l&&s.actions[a].apply(e,l.from,l.to)}}else return;i.preventDefault()},r=i=>{for(let s=0;s<this.items.length;s++)this.items[s].dom.contains(i.target)&&this.moveSelection(s)};this.list=Ea("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:n,onclick:r}),this.dom=Ea("div",{class:"cm-panel-lint"},this.list,Ea("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>HL(this.view)},"")),this.update()}get selectedIndex(){let e=this.view.state.field(Lo).selected;if(!e)return-1;for(let n=0;n<this.items.length;n++)if(this.items[n].diagnostic==e.diagnostic)return n;return-1}update(){let{diagnostics:e,selected:n}=this.view.state.field(Lo),r=0,i=!1,s=null,o=new Set;for(e.between(0,this.view.state.doc.length,(a,l,{spec:c})=>{for(let d of c.diagnostics){if(o.has(d))continue;o.add(d);let h=-1,p;for(let f=r;f<this.items.length;f++)if(this.items[f].diagnostic==d){h=f;break}h<0?(p=new VL(this.view,d),this.items.splice(r,0,p),i=!0):(p=this.items[h],h>r&&(this.items.splice(r,h-r),i=!0)),n&&p.diagnostic==n.diagnostic?p.dom.hasAttribute("aria-selected")||(p.dom.setAttribute("aria-selected","true"),s=p):p.dom.hasAttribute("aria-selected")&&p.dom.removeAttribute("aria-selected"),r++}});r<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)i=!0,this.items.pop();this.items.length==0&&(this.items.push(new VL(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),i=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:a,panel:l})=>{let c=l.height/this.list.offsetHeight;a.top<l.top?this.list.scrollTop-=(l.top-a.top)/c:a.bottom>l.bottom&&(this.list.scrollTop+=(a.bottom-l.bottom)/c)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),i&&this.sync()}sync(){let e=this.list.firstChild;function n(){let r=e;e=r.nextSibling,r.remove()}for(let r of this.items)if(r.dom.parentNode==this.list){for(;e!=r.dom;)n();e=r.dom.nextSibling}else this.list.insertBefore(r.dom,e);for(;e;)n()}moveSelection(e){if(this.selectedIndex<0)return;let n=this.view.state.field(Lo),r=hf(n.diagnostics,this.items[e].diagnostic);r&&this.view.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0,effects:t7.of(r)})}static open(e){return new Z0(e)}}function Xke(t,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(t)}</svg>')`}function eb(t){return Xke(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${t}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const Qke=et.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:eb("#d11")},".cm-lintRange-warning":{backgroundImage:eb("orange")},".cm-lintRange-info":{backgroundImage:eb("#999")},".cm-lintRange-hint":{backgroundImage:eb("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function Zke(t){return t=="error"?4:t=="warning"?3:t=="info"?2:1}function Jke(t){let e="hint",n=1;for(let r of t){let i=Zke(r.severity);i>n&&(n=i,e=r.severity)}return e}const i7=[Lo,et.decorations.compute([Lo],t=>{let{selected:e,panel:n}=t.field(Lo);return!e||!n||e.from==e.to?sn.none:sn.set([Uke.range(e.from,e.to)])}),GSe(Vke,{hideOn:Fke}),Qke];var qL={};class J0{constructor(e,n,r,i,s,o,a,l,c,d=0,h){this.p=e,this.stack=n,this.state=r,this.reducePos=i,this.pos=s,this.score=o,this.buffer=a,this.bufferBase=l,this.curContext=c,this.lookAhead=d,this.parent=h}toString(){return`[${this.stack.filter((e,n)=>n%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,n,r=0){let i=e.parser.context;return new J0(e,[],n,r,r,0,[],0,i?new WL(i,i.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,n){this.stack.push(this.state,n,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var n;let r=e>>19,i=e&65535,{parser:s}=this.p,o=this.reducePos<this.pos-25;o&&this.setLookAhead(this.pos);let a=s.dynamicPrecedence(i);if(a&&(this.score+=a),r==0){this.pushState(s.getGoto(this.state,i,!0),this.reducePos),i<s.minRepeatTerm&&this.storeNode(i,this.reducePos,this.reducePos,o?8:4,!0),this.reduceContext(i,this.reducePos);return}let l=this.stack.length-(r-1)*3-(e&262144?6:0),c=l?this.stack[l-2]:this.p.ranges[0].from,d=this.reducePos-c;d>=2e3&&!(!((n=this.p.parser.nodeSet.types[i])===null||n===void 0)&&n.isAnonymous)&&(c==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=d):this.p.lastBigReductionSize<d&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=c,this.p.lastBigReductionSize=d));let h=l?this.stack[l-1]:0,p=this.bufferBase+this.buffer.length-h;if(i<s.minRepeatTerm||e&131072){let f=s.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(i,c,f,p+4,!0)}if(e&262144)this.state=this.stack[l];else{let f=this.stack[l-3];this.state=s.getGoto(f,i,!0)}for(;this.stack.length>l;)this.stack.pop();this.reduceContext(i,c)}storeNode(e,n,r,i=4,s=!1){if(e==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let o=this,a=this.buffer.length;if(a==0&&o.parent&&(a=o.bufferBase-o.parent.bufferBase,o=o.parent),a>0&&o.buffer[a-4]==0&&o.buffer[a-1]>-1){if(n==r)return;if(o.buffer[a-2]>=n){o.buffer[a-2]=r;return}}}if(!s||this.pos==r)this.buffer.push(e,n,r,i);else{let o=this.buffer.length;if(o>0&&(this.buffer[o-4]!=0||this.buffer[o-1]<0)){let a=!1;for(let l=o;l>0&&this.buffer[l-2]>r;l-=4)if(this.buffer[l-1]>=0){a=!0;break}if(a)for(;o>0&&this.buffer[o-2]>r;)this.buffer[o]=this.buffer[o-4],this.buffer[o+1]=this.buffer[o-3],this.buffer[o+2]=this.buffer[o-2],this.buffer[o+3]=this.buffer[o-1],o-=4,i>4&&(i-=4)}this.buffer[o]=e,this.buffer[o+1]=n,this.buffer[o+2]=r,this.buffer[o+3]=i}}shift(e,n,r,i){if(e&131072)this.pushState(e&65535,this.pos);else if(e&262144)this.pos=i,this.shiftContext(n,r),n<=this.p.parser.maxNode&&this.buffer.push(n,r,i,4);else{let s=e,{parser:o}=this.p;(i>this.pos||n<=o.maxNode)&&(this.pos=i,o.stateFlag(s,1)||(this.reducePos=i)),this.pushState(s,r),this.shiftContext(n,r),n<=o.maxNode&&this.buffer.push(n,r,i,4)}}apply(e,n,r,i){e&65536?this.reduce(e):this.shift(e,n,r,i)}useNode(e,n){let r=this.p.reused.length-1;(r<0||this.p.reused[r]!=e)&&(this.p.reused.push(e),r++);let i=this.pos;this.reducePos=this.pos=i+e.length,this.pushState(n,i),this.buffer.push(r,i,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,n=e.buffer.length;for(;n>0&&e.buffer[n-2]>e.reducePos;)n-=4;let r=e.buffer.slice(n),i=e.bufferBase+n;for(;e&&i==e.bufferBase;)e=e.parent;return new J0(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,r,i,this.curContext,this.lookAhead,e)}recoverByDelete(e,n){let r=e<=this.p.parser.maxNode;r&&this.storeNode(e,this.pos,n,4),this.storeNode(0,this.pos,n,r?8:4),this.pos=this.reducePos=n,this.score-=190}canShift(e){for(let n=new e2e(this);;){let r=this.p.parser.stateSlot(n.state,4)||this.p.parser.hasAction(n.state,e);if(r==0)return!1;if(!(r&65536))return!0;n.reduce(r)}}recoverByInsert(e){if(this.stack.length>=300)return[];let n=this.p.parser.nextStates(this.state);if(n.length>8||this.stack.length>=120){let i=[];for(let s=0,o;s<n.length;s+=2)(o=n[s+1])!=this.state&&this.p.parser.hasAction(o,e)&&i.push(n[s],o);if(this.stack.length<120)for(let s=0;i.length<8&&s<n.length;s+=2){let o=n[s+1];i.some((a,l)=>l&1&&a==o)||i.push(n[s],o)}n=i}let r=[];for(let i=0;i<n.length&&r.length<4;i+=2){let s=n[i+1];if(s==this.state)continue;let o=this.split();o.pushState(s,this.pos),o.storeNode(0,o.pos,o.pos,4,!0),o.shiftContext(n[i],this.pos),o.reducePos=this.pos,o.score-=200,r.push(o)}return r}forceReduce(){let{parser:e}=this.p,n=e.stateSlot(this.state,5);if(!(n&65536))return!1;if(!e.validAction(this.state,n)){let r=n>>19,i=n&65535,s=this.stack.length-r*3;if(s<0||e.getGoto(this.stack[s],i,!1)<0){let o=this.findForcedReduction();if(o==null)return!1;n=o}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(n),!0}findForcedReduction(){let{parser:e}=this.p,n=[],r=(i,s)=>{if(!n.includes(i))return n.push(i),e.allActions(i,o=>{if(!(o&393216))if(o&65536){let a=(o>>19)-s;if(a>1){let l=o&65535,c=this.stack.length-a*3;if(c>=0&&e.getGoto(this.stack[c],l,!1)>=0)return a<<19|65536|l}}else{let a=r(o,s+1);if(a!=null)return a}})};return r(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:e}=this.p;return e.data[e.stateSlot(this.state,1)]==65535&&!e.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let n=0;n<this.stack.length;n+=3)if(this.stack[n]!=e.stack[n])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,n){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(n)))}reduceContext(e,n){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(n)))}emitContext(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let n=new WL(this.curContext.tracker,e);n.hash!=this.curContext.hash&&this.emitContext(),this.curContext=n}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class WL{constructor(e,n){this.tracker=e,this.context=n,this.hash=e.strict?e.hash(n):0}}class e2e{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let n=e&65535,r=e>>19;r==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(r-1)*3;let i=this.start.p.parser.getGoto(this.stack[this.base-3],n,!0);this.state=i}}class ew{constructor(e,n,r){this.stack=e,this.pos=n,this.index=r,this.buffer=e.buffer,this.index==0&&this.maybeNext()}static create(e,n=e.bufferBase+e.buffer.length){return new ew(e,n,n-e.bufferBase)}maybeNext(){let e=this.stack.parent;e!=null&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new ew(this.stack,this.pos,this.index)}}function tb(t,e=Uint16Array){if(typeof t!="string")return t;let n=null;for(let r=0,i=0;r<t.length;){let s=0;for(;;){let o=t.charCodeAt(r++),a=!1;if(o==126){s=65535;break}o>=92&&o--,o>=34&&o--;let l=o-32;if(l>=46&&(l-=46,a=!0),s+=l,a)break;s*=46}n?n[i++]=s:n=new e(s)}return n}class Wb{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const GL=new Wb;class t2e{constructor(e,n){this.input=e,this.ranges=n,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=GL,this.rangeIndex=0,this.pos=this.chunkPos=n[0].from,this.range=n[0],this.end=n[n.length-1].to,this.readNext()}resolveOffset(e,n){let r=this.range,i=this.rangeIndex,s=this.pos+e;for(;s<r.from;){if(!i)return null;let o=this.ranges[--i];s-=r.from-o.to,r=o}for(;n<0?s>r.to:s>=r.to;){if(i==this.ranges.length-1)return null;let o=this.ranges[++i];s+=o.from-r.to,r=o}return s}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let n of this.ranges)if(n.to>e)return Math.max(e,n.from);return this.end}peek(e){let n=this.chunkOff+e,r,i;if(n>=0&&n<this.chunk.length)r=this.pos+e,i=this.chunk.charCodeAt(n);else{let s=this.resolveOffset(e,1);if(s==null)return-1;if(r=s,r>=this.chunk2Pos&&r<this.chunk2Pos+this.chunk2.length)i=this.chunk2.charCodeAt(r-this.chunk2Pos);else{let o=this.rangeIndex,a=this.range;for(;a.to<=r;)a=this.ranges[++o];this.chunk2=this.input.chunk(this.chunk2Pos=r),r+this.chunk2.length>a.to&&(this.chunk2=this.chunk2.slice(0,a.to-r)),i=this.chunk2.charCodeAt(0)}}return r>=this.token.lookAhead&&(this.token.lookAhead=r+1),i}acceptToken(e,n=0){let r=n?this.resolveOffset(n,-1):this.pos;if(r==null||r<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=r}acceptTokenTo(e,n){this.token.value=e,this.token.end=n}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:n}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=n,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),n=this.pos+e.length;this.chunk=n>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,n){if(n?(this.token=n,n.start=e,n.lookAhead=e+1,n.value=n.extended=-1):this.token=GL,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,n){if(e>=this.chunkPos&&n<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,n-this.chunkPos);if(e>=this.chunk2Pos&&n<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,n-this.chunk2Pos);if(e>=this.range.from&&n<=this.range.to)return this.input.read(e,n);let r="";for(let i of this.ranges){if(i.from>=n)break;i.to>e&&(r+=this.input.read(Math.max(i.from,e),Math.min(i.to,n)))}return r}}class Sp{constructor(e,n){this.data=e,this.id=n}token(e,n){let{parser:r}=n.p;n2e(this.data,e,n,this.id,r.data,r.tokenPrecTable)}}Sp.prototype.contextual=Sp.prototype.fallback=Sp.prototype.extend=!1;Sp.prototype.fallback=Sp.prototype.extend=!1;class FN{constructor(e,n={}){this.token=e,this.contextual=!!n.contextual,this.fallback=!!n.fallback,this.extend=!!n.extend}}function n2e(t,e,n,r,i,s){let o=0,a=1<<r,{dialect:l}=n.p.parser;e:for(;a&t[o];){let c=t[o+1];for(let f=o+3;f<c;f+=2)if((t[f+1]&a)>0){let m=t[f];if(l.allows(m)&&(e.token.value==-1||e.token.value==m||r2e(m,e.token.value,i,s))){e.acceptToken(m);break}}let d=e.next,h=0,p=t[o+2];if(e.next<0&&p>h&&t[c+p*3-3]==65535){o=t[c+p*3-1];continue e}for(;h<p;){let f=h+p>>1,m=c+f+(f<<1),g=t[m],v=t[m+1]||65536;if(d<g)p=f;else if(d>=v)h=f+1;else{o=t[m+2],e.advance();continue e}}break}}function KL(t,e,n){for(let r=e,i;(i=t[r])!=65535;r++)if(i==n)return r-e;return-1}function r2e(t,e,n,r){let i=KL(n,r,e);return i<0||KL(n,r,t)<i}const ms=typeof process<"u"&&qL&&/\bparse\b/.test(qL.LOG);let gS=null;function YL(t,e,n){let r=t.cursor(Wr.IncludeAnonymous);for(r.moveTo(e);;)if(!(n<0?r.childBefore(e):r.childAfter(e)))for(;;){if((n<0?r.to<e:r.from>e)&&!r.type.isError)return n<0?Math.max(0,Math.min(r.to-1,e-25)):Math.min(t.length,Math.max(r.from+1,e+25));if(n<0?r.prevSibling():r.nextSibling())break;if(!r.parent())return n<0?0:t.length}}class i2e{constructor(e,n){this.fragments=e,this.nodeSet=n,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?YL(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?YL(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let n=this.trees.length-1;if(n<0)return this.nextFragment(),null;let r=this.trees[n],i=this.index[n];if(i==r.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let s=r.children[i],o=this.start[n]+r.positions[i];if(o>e)return this.nextStart=o,null;if(s instanceof Pr){if(o==e){if(o<this.safeFrom)return null;let a=o+s.length;if(a<=this.safeTo){let l=s.prop(Gt.lookAhead);if(!l||a+l<this.fragment.to)return s}}this.index[n]++,o+s.length>=Math.max(this.safeFrom,e)&&(this.trees.push(s),this.start.push(o),this.index.push(0))}else this.index[n]++,this.nextStart=o+s.length}}}class s2e{constructor(e,n){this.stream=n,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(r=>new Wb)}getActions(e){let n=0,r=null,{parser:i}=e.p,{tokenizers:s}=i,o=i.stateSlot(e.state,3),a=e.curContext?e.curContext.hash:0,l=0;for(let c=0;c<s.length;c++){if(!(1<<c&o))continue;let d=s[c],h=this.tokens[c];if(!(r&&!d.fallback)&&((d.contextual||h.start!=e.pos||h.mask!=o||h.context!=a)&&(this.updateCachedToken(h,d,e),h.mask=o,h.context=a),h.lookAhead>h.end+25&&(l=Math.max(h.lookAhead,l)),h.value!=0)){let p=n;if(h.extended>-1&&(n=this.addActions(e,h.extended,h.end,n)),n=this.addActions(e,h.value,h.end,n),!d.extend&&(r=h,n>p))break}}for(;this.actions.length>n;)this.actions.pop();return l&&e.setLookAhead(l),!r&&e.pos==this.stream.end&&(r=new Wb,r.value=e.p.parser.eofTerm,r.start=r.end=e.pos,n=this.addActions(e,r.value,r.end,n)),this.mainToken=r,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let n=new Wb,{pos:r,p:i}=e;return n.start=r,n.end=Math.min(r+1,i.stream.end),n.value=r==i.stream.end?i.parser.eofTerm:0,n}updateCachedToken(e,n,r){let i=this.stream.clipPos(r.pos);if(n.token(this.stream.reset(i,e),r),e.value>-1){let{parser:s}=r.p;for(let o=0;o<s.specialized.length;o++)if(s.specialized[o]==e.value){let a=s.specializers[o](this.stream.read(e.start,e.end),r);if(a>=0&&r.p.parser.dialect.allows(a>>1)){a&1?e.extended=a>>1:e.value=a>>1;break}}}else e.value=0,e.end=this.stream.clipPos(i+1)}putAction(e,n,r,i){for(let s=0;s<i;s+=3)if(this.actions[s]==e)return i;return this.actions[i++]=e,this.actions[i++]=n,this.actions[i++]=r,i}addActions(e,n,r,i){let{state:s}=e,{parser:o}=e.p,{data:a}=o;for(let l=0;l<2;l++)for(let c=o.stateSlot(s,l?2:1);;c+=3){if(a[c]==65535)if(a[c+1]==1)c=al(a,c+2);else{i==0&&a[c+1]==2&&(i=this.putAction(al(a,c+2),n,r,i));break}a[c]==n&&(i=this.putAction(al(a,c+1),n,r,i))}return i}}class o2e{constructor(e,n,r,i){this.parser=e,this.input=n,this.ranges=i,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new t2e(n,i),this.tokens=new s2e(e,this.stream),this.topTerm=e.top[1];let{from:s}=i[0];this.stacks=[J0.start(this,e.top[0],s)],this.fragments=r.length&&this.stream.end-s>e.bufferLength*4?new i2e(r,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,n=this.minStackPos,r=this.stacks=[],i,s;if(this.bigReductionCount>300&&e.length==1){let[o]=e;for(;o.forceReduce()&&o.stack.length&&o.stack[o.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let o=0;o<e.length;o++){let a=e[o];for(;;){if(this.tokens.mainToken=null,a.pos>n)r.push(a);else{if(this.advanceStack(a,r,e))continue;{i||(i=[],s=[]),i.push(a);let l=this.tokens.getMainToken(a);s.push(l.value,l.end)}}break}}if(!r.length){let o=i&&c2e(i);if(o)return ms&&console.log("Finish with "+this.stackID(o)),this.stackToTree(o);if(this.parser.strict)throw ms&&i&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+n);this.recovering||(this.recovering=5)}if(this.recovering&&i){let o=this.stoppedAt!=null&&i[0].pos>this.stoppedAt?i[0]:this.runRecovery(i,s,r);if(o)return ms&&console.log("Force-finish "+this.stackID(o)),this.stackToTree(o.forceAll())}if(this.recovering){let o=this.recovering==1?1:this.recovering*3;if(r.length>o)for(r.sort((a,l)=>l.score-a.score);r.length>o;)r.pop();r.some(a=>a.reducePos>n)&&this.recovering--}else if(r.length>1){e:for(let o=0;o<r.length-1;o++){let a=r[o];for(let l=o+1;l<r.length;l++){let c=r[l];if(a.sameState(c)||a.buffer.length>500&&c.buffer.length>500)if((a.score-c.score||a.buffer.length-c.buffer.length)>0)r.splice(l--,1);else{r.splice(o--,1);continue e}}}r.length>12&&r.splice(12,r.length-12)}this.minStackPos=r[0].pos;for(let o=1;o<r.length;o++)r[o].pos<this.minStackPos&&(this.minStackPos=r[o].pos);return null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,n,r){let i=e.pos,{parser:s}=this,o=ms?this.stackID(e)+" -> ":"";if(this.stoppedAt!=null&&i>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let c=e.curContext&&e.curContext.tracker.strict,d=c?e.curContext.hash:0;for(let h=this.fragments.nodeAt(i);h;){let p=this.parser.nodeSet.types[h.type.id]==h.type?s.getGoto(e.state,h.type.id):-1;if(p>-1&&h.length&&(!c||(h.prop(Gt.contextHash)||0)==d))return e.useNode(h,p),ms&&console.log(o+this.stackID(e)+` (via reuse of ${s.getName(h.type.id)})`),!0;if(!(h instanceof Pr)||h.children.length==0||h.positions[0]>0)break;let f=h.children[0];if(f instanceof Pr&&h.positions[0]==0)h=f;else break}}let a=s.stateSlot(e.state,4);if(a>0)return e.reduce(a),ms&&console.log(o+this.stackID(e)+` (via always-reduce ${s.getName(a&65535)})`),!0;if(e.stack.length>=8400)for(;e.stack.length>6e3&&e.forceReduce(););let l=this.tokens.getActions(e);for(let c=0;c<l.length;){let d=l[c++],h=l[c++],p=l[c++],f=c==l.length||!r,m=f?e:e.split(),g=this.tokens.mainToken;if(m.apply(d,h,g?g.start:m.pos,p),ms&&console.log(o+this.stackID(m)+` (via ${d&65536?`reduce of ${s.getName(d&65535)}`:"shift"} for ${s.getName(h)} @ ${i}${m==e?"":", split"})`),f)return!0;m.pos>i?n.push(m):r.push(m)}return!1}advanceFully(e,n){let r=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>r)return XL(e,n),!0}}runRecovery(e,n,r){let i=null,s=!1;for(let o=0;o<e.length;o++){let a=e[o],l=n[o<<1],c=n[(o<<1)+1],d=ms?this.stackID(a)+" -> ":"";if(a.deadEnd&&(s||(s=!0,a.restart(),ms&&console.log(d+this.stackID(a)+" (restarted)"),this.advanceFully(a,r))))continue;let h=a.split(),p=d;for(let f=0;f<10&&h.forceReduce()&&(ms&&console.log(p+this.stackID(h)+" (via force-reduce)"),!this.advanceFully(h,r));f++)ms&&(p=this.stackID(h)+" -> ");for(let f of a.recoverByInsert(l))ms&&console.log(d+this.stackID(f)+" (via recover-insert)"),this.advanceFully(f,r);this.stream.end>a.pos?(c==a.pos&&(c++,l=0),a.recoverByDelete(l,c),ms&&console.log(d+this.stackID(a)+` (via recover-delete ${this.parser.getName(l)})`),XL(a,r)):(!i||i.score<a.score)&&(i=a)}return i}stackToTree(e){return e.close(),Pr.build({buffer:ew.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let n=(gS||(gS=new WeakMap)).get(e);return n||gS.set(e,n=String.fromCodePoint(this.nextStackID++)),n+e}}function XL(t,e){for(let n=0;n<e.length;n++){let r=e[n];if(r.pos==t.pos&&r.sameState(t)){e[n].score<t.score&&(e[n]=t);return}}e.push(t)}class a2e{constructor(e,n,r){this.source=e,this.flags=n,this.disabled=r}allows(e){return!this.disabled||this.disabled[e]==0}}const vS=t=>t;class l2e{constructor(e){this.start=e.start,this.shift=e.shift||vS,this.reduce=e.reduce||vS,this.reuse=e.reuse||vS,this.hash=e.hash||(()=>0),this.strict=e.strict!==!1}}class tw extends cW{constructor(e){if(super(),this.wrappers=[],e.version!=14)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let n=e.nodeNames.split(" ");this.minRepeatTerm=n.length;for(let a=0;a<e.repeatNodeCount;a++)n.push("");let r=Object.keys(e.topRules).map(a=>e.topRules[a][1]),i=[];for(let a=0;a<n.length;a++)i.push([]);function s(a,l,c){i[a].push([l,l.deserialize(String(c))])}if(e.nodeProps)for(let a of e.nodeProps){let l=a[0];typeof l=="string"&&(l=Gt[l]);for(let c=1;c<a.length;){let d=a[c++];if(d>=0)s(d,l,a[c++]);else{let h=a[c+-d];for(let p=-d;p>0;p--)s(a[c++],l,h);c++}}}this.nodeSet=new EN(n.map((a,l)=>ls.define({name:l>=this.minRepeatTerm?void 0:a,id:l,props:i[l],top:r.indexOf(l)>-1,error:l==0,skipped:e.skippedNodes&&e.skippedNodes.indexOf(l)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=sW;let o=tb(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let a=0;a<this.specializerSpecs.length;a++)this.specialized[a]=this.specializerSpecs[a].term;this.specializers=this.specializerSpecs.map(QL),this.states=tb(e.states,Uint32Array),this.data=tb(e.stateData),this.goto=tb(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(a=>typeof a=="number"?new Sp(o,a):a),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,n,r){let i=new o2e(this,e,n,r);for(let s of this.wrappers)i=s(i,e,n,r);return i}getGoto(e,n,r=!1){let i=this.goto;if(n>=i[0])return-1;for(let s=i[n+1];;){let o=i[s++],a=o&1,l=i[s++];if(a&&r)return l;for(let c=s+(o>>1);s<c;s++)if(i[s]==e)return l;if(a)return-1}}hasAction(e,n){let r=this.data;for(let i=0;i<2;i++)for(let s=this.stateSlot(e,i?2:1),o;;s+=3){if((o=r[s])==65535)if(r[s+1]==1)o=r[s=al(r,s+2)];else{if(r[s+1]==2)return al(r,s+2);break}if(o==n||o==0)return al(r,s+1)}return 0}stateSlot(e,n){return this.states[e*6+n]}stateFlag(e,n){return(this.stateSlot(e,0)&n)>0}validAction(e,n){return!!this.allActions(e,r=>r==n?!0:null)}allActions(e,n){let r=this.stateSlot(e,4),i=r?n(r):void 0;for(let s=this.stateSlot(e,1);i==null;s+=3){if(this.data[s]==65535)if(this.data[s+1]==1)s=al(this.data,s+2);else break;i=n(al(this.data,s+1))}return i}nextStates(e){let n=[];for(let r=this.stateSlot(e,1);;r+=3){if(this.data[r]==65535)if(this.data[r+1]==1)r=al(this.data,r+2);else break;if(!(this.data[r+2]&1)){let i=this.data[r+1];n.some((s,o)=>o&1&&s==i)||n.push(this.data[r],i)}}return n}configure(e){let n=Object.assign(Object.create(tw.prototype),this);if(e.props&&(n.nodeSet=this.nodeSet.extend(...e.props)),e.top){let r=this.topRules[e.top];if(!r)throw new RangeError(`Invalid top rule name ${e.top}`);n.top=r}return e.tokenizers&&(n.tokenizers=this.tokenizers.map(r=>{let i=e.tokenizers.find(s=>s.from==r);return i?i.to:r})),e.specializers&&(n.specializers=this.specializers.slice(),n.specializerSpecs=this.specializerSpecs.map((r,i)=>{let s=e.specializers.find(a=>a.from==r.external);if(!s)return r;let o=Object.assign(Object.assign({},r),{external:s.to});return n.specializers[i]=QL(o),o})),e.contextTracker&&(n.context=e.contextTracker),e.dialect&&(n.dialect=this.parseDialect(e.dialect)),e.strict!=null&&(n.strict=e.strict),e.wrap&&(n.wrappers=n.wrappers.concat(e.wrap)),e.bufferLength!=null&&(n.bufferLength=e.bufferLength),n}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let n=this.dynamicPrecedences;return n==null?0:n[e]||0}parseDialect(e){let n=Object.keys(this.dialects),r=n.map(()=>!1);if(e)for(let s of e.split(" ")){let o=n.indexOf(s);o>=0&&(r[o]=!0)}let i=null;for(let s=0;s<n.length;s++)if(!r[s])for(let o=this.dialects[n[s]],a;(a=this.data[o++])!=65535;)(i||(i=new Uint8Array(this.maxTerm+1)))[a]=1;return new a2e(e,r,i)}static deserialize(e){return new tw(e)}}function al(t,e){return t[e]|t[e+1]<<16}function c2e(t){let e=null;for(let n of t){let r=n.p.stoppedAt;(n.pos==n.p.stream.end||r!=null&&n.pos>r)&&n.p.parser.stateFlag(n.state,2)&&(!e||e.score<n.score)&&(e=n)}return e}function QL(t){if(t.external){let e=t.extend?1:0;return(n,r)=>t.external(n,r)<<1|e}return t.get}var pf={};const u2e=121,zN=122,s7=123,d2e=124,ZL=128,h2e=4,p2e=131,f2e=7,m2e=8,g2e=9,v2e=10,y2e=139,o7=19,x2e=140,b2e=23,w2e=141,_2e=27,E2e=37,S2e=41,C2e=145,j2e=146,k2e=147,P2e=148,T2e=47,N2e=68,a7=154,l7=70,c7=155,u7=72,O2e=156,R2e=76,A2e=161,I2e=79,D2e=80,$2e=81,M2e=168,d7=89,L2e=90,B2e=170,F2e=97,z2e=172,H2e=98,U2e=100,V2e=101,HN=typeof process<"u"&&pf&&/\bfparse(:dbg)?\b/.test(pf.LOG),UN=typeof process<"u"&&pf&&/\bfparse:dbg\b/.test(pf.LOG),nl=typeof process<"u"&&pf&&/\bcontext\b/.test(pf.LOG),h7=[9,11,12,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288],q2e=p7(`
\r`),JL=42,W2e=p7("'./-+*^");function p7(t){return Array.from(t).map(e=>e.charCodeAt(0))}function G2e(t){return t===63||t>=65&&t<=90||t===95||t>=97&&t<=122||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=767||t>=880&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=55296&&t<=56319||t>=56320&&t<=57343}function K2e(t){return W2e.includes(t)}function Y2e(t){return t>=48&&t<=57||t===183||t>=768&&t<=879||t>=8255&&t<=8256}function X2e(t){return h7.includes(t)}function e5(t,e){return e.concat(t.split(/\n/g).join(`
`+e))}function Q2e(t,e=0){const n=t.peek(e);return n===JL&&t.peek(e+1)===JL?{offset:2,token:"**"}:K2e(n)?{offset:1,token:String.fromCharCode(n)}:null}function g1(t,e=0,n=!1){for(let r=!1,i=[],s=0;;s++){const o=t.peek(e+s);if(G2e(o)||(r||n)&&Y2e(o))r||(r=!0),i.push(o);else return i.length?{token:String.fromCharCode(...i),offset:s}:null}}function f7(t,e){for(let n=!1,r=0;;r++){let i=t.peek(e+r);if(X2e(i))n||(n=!0);else return n?{token:" ",offset:r}:null}}function Z2e(t,e){const n=e.contextKeys(),r=e.tokens;for(let i=0,s=[],o=null;;){const a=r.length+s.length>0,l=s.length>0,c=g1(t,i,a)||a&&Q2e(t,i)||l&&f7(t,i);if(!c)return o;const{token:d,offset:h}=c;if(i+=h,d===" ")continue;s=[...s,d];const p=[...r,...s].join(" ");if(n.some(f=>f===p)){const f=s[0];o={token:f,offset:f.length,term:s7}}if(!n.some(f=>f.startsWith(p))){if(t5.some(f=>f===p)){const f=s[0];o={token:f,offset:f.length,term:zN}}if(!t5.some(f=>f.startsWith(p)))return o}}}const J2e={[zN]:"identifier",[s7]:"nameIdentifier"},ePe=new FN((t,e)=>{UN&&console.log("%s: T <identifier | nameIdentifier>",t.pos);const n=Z2e(t,e.context),r=e.context.tokens,i=n||g1(t,0,r.length>0);i&&(t.advance(i.offset),t.acceptToken(n?n.term:zN),HN&&console.log("%s: MATCH <%s> <%s>",t.pos,n?J2e[n.term]:"identifier",i.token))},{contextual:!0}),tPe=new FN((t,e)=>{UN&&console.log("%s: T <propertyIdentifier>",t.pos);const n=e.context.tokens,r=g1(t,0,n.length>0);r&&(t.advance(r.offset),t.acceptToken(u2e),HN&&console.log("%s: MATCH <propertyIdentifier> <%s>",t.pos,r.token))}),nPe=new FN((t,e)=>{UN&&console.log("%s: T <insertSemi>",t.pos);let n,r=!1;for(n=0;;n++){const i=t.peek(n);if(!h7.includes(i)){q2e.includes(i)&&(r=!0);break}}if(r){const i=g1(t,n+1);if(f7(t,n+1)||i&&/^(then|else|return|satisfies)$/.test(i.token))return;HN&&console.log("%s: MATCH <insertSemi>",t.pos),t.acceptToken(d2e)}}),rPe={[O2e]:"FunctionInvocation",[c7]:"FilterExpression",[a7]:"PathExpression"},iPe={[z2e]:"Context",[B2e]:"FunctionDefinition",[p2e]:"ForExpression",[M2e]:"List",[x2e]:"IfExpression",[w2e]:"QuantifiedExpression"},sPe={[F2e]:"Context",[L2e]:"FunctionDefinition",[h2e]:"ForExpression",[d7]:"List",[o7]:"IfExpression",[b2e]:"QuantifiedExpression",[N2e]:"PathExpression",[u7]:"FunctionInvocation",[l7]:"FilterExpression",[S2e]:"ArithmeticExpression"};class ff{constructor(e){this.fn=e}get(e){return this.fn(e)}static of(e){return new ff(e)}}const oPe={"date and time":1,date:1,time:1,duration:1},t5=Object.keys(oPe);class aPe{constructor(e={}){this.value=e}getKeys(){return Object.keys(this.value)}get(e){const n=this.value[e],r=this.constructor;return r.isAtomic(n)?n:r.of(n)}set(e,n){return this.constructor.of({...this.value,[e]:n})}merge(e){const n=this.constructor;return new n(n.__merge(this.value,e))}static isAtomic(e){return!e||e instanceof this||e instanceof ff||typeof e!="object"}static of(...e){return e.reduce((n,r)=>n.merge(r),new this({}))}static __unwrap(e){return e?e instanceof this?e.value:typeof e!="object"?{}:{...e}:{}}static __merge(e,n){return xr(this.__unwrap(n),(r,i,s)=>i instanceof ff?{...r,[s]:i}:(i=this.__unwrap(i),Do(r,s)&&(i=this.__merge(this.__unwrap(r[s]),i)),{...r,[s]:i}),this.__unwrap(e))}}class Eg{constructor({name:e="Expressions",tokens:n=[],children:r=[],parent:i=null,context:s,value:o,raw:a}){this.name=e,this.tokens=n,this.children=r,this.parent=i,this.context=s,this.value=o,this.raw=a}enterScope(e){const n=this.of({name:e,parent:this});return nl&&console.log("[%s] enter",n.path,n.context),n}exitScope(e){return this.parent?(nl&&console.log(`[%s] exit %o
%s`,this.path,this.context,e5(e,"  ")),this.parent.pushChild(this)):(nl&&console.log(`[%s] NO exit %o
%s`,this.path,this.context,e5(e,"  ")),this)}token(e){return nl&&console.log("[%s] token <%s> + <%s>",this.path,this.tokens.join(" "),e),this.assign({tokens:[...this.tokens,e]})}literal(e){return nl&&console.log("[%s] literal %o",this.path,e),this.pushChild(this.of({name:"Literal",value:e}))}computedValue(){for(let e=this;;e=Yh(e.children)){if(!e)return null;if(e.value)return e.value}}contextKeys(){return this.context.getKeys().map(Gb)}get path(){var e,n;return((n=(e=this.parent)==null?void 0:e.path)==null?void 0:n.concat(" > ",this.name))||this.name}get(e){const n=[e,e&&Gb(e)],r=this.context.getKeys().find(s=>n.includes(Gb(s)));if(typeof r>"u")return;const i=this.context.get(r);return i instanceof ff?i.get(this):i}resolveName(){const e=this.tokens.join(" "),n=[],r=this.assign({tokens:n}),i=this.of({name:"VariableName",parent:r,value:this.get(e),raw:e});return nl&&console.log("[%s] resolve name <%s=%s>",i.path,e,this.get(e)),r.pushChild(i)}pushChild(e){if(!e)return this;const n=this.assign({children:[...this.children,e]});return e.parent=n,n}pushChildren(e){let n=this;for(const r of e)n=n.pushChild(r);return n}declareName(){if(this.tokens.length===0)throw Error("no tokens to declare name");const e=this.tokens.join(" ");return nl&&console.log("[%s] declareName <%s>",this.path,e),this.assign({tokens:[]}).pushChild(this.of({name:"Name",value:e}))}define(e,n){if(typeof e!="string")return nl&&console.log("[%s] no define <%s=%s>",this.path,e,n),this;nl&&console.log("[%s] define <%s=%s>",this.path,e,n);const r=this.context.set(e,n);return this.assign({context:r})}assign(e={}){return Eg.of({...this,...e})}of(e={}){const n={context:this.context,parent:this.parent};return Eg.of({...n,...e})}static of(e){const{name:n,tokens:r=[],children:i=[],parent:s=null,context:o,value:a,raw:l}=e;if(!o)throw new Error("must provide <context>");return new Eg({name:n,tokens:[...r],children:[...i],context:o,parent:s,value:a,raw:l})}}function Gb(t){return t.replace(/\s*([./\-'+]|\*\*?)\s*/g," $1 ").replace(/\s{2,}/g," ").trim()}function n5(t,e,n){const r=t.children.filter(c=>c.name!==e),i=t.children.filter(c=>c.name===e),s=r[0],o=r[Math.max(1,r.length-1)],a=s==null?void 0:s.computedValue(),l=(o==null?void 0:o.computedValue())||null;return t.assign({children:i}).enterScope(e).pushChildren(r).exitScope(n).define(a,l)}function m7(t={},e=aPe){const n=Eg.of({context:e.of(t)});return new l2e({start:n,reduce(r,i,s,o){if(i===o7){const[h,p]=r.children.slice(-2);r=r.assign({value:e.of(h==null?void 0:h.computedValue(),p==null?void 0:p.computedValue())})}if(i===d7&&(r=r.assign({value:e.of(...r.children.map(h=>h==null?void 0:h.computedValue()))})),i===l7){const[h,p]=r.children.slice(-2);r=r.assign({value:h==null?void 0:h.computedValue()})}if(i===u7){const[h,...p]=r.children;(h==null?void 0:h.raw)==="get value"&&(r=cPe(r,p))}const a=iPe[i];if(a)return r.enterScope(a);const l=rPe[i];if(l){const{children:h,context:p}=r,f=h.slice(0,-1),m=Yh(h);let g=null;return i===a7&&(g=e.of(m==null?void 0:m.computedValue())),i===c7&&(g=e.of(p,m==null?void 0:m.computedValue()).set("item",m==null?void 0:m.computedValue())),r.assign({children:f}).enterScope(l).pushChild(m).assign({context:g||p})}const c=o.read(o.pos,s.pos);if(sPe[i])return r.exitScope(c);if(i===H2e){const h=r.children.filter(m=>m.name!=="ContextEntry"),p=h[0],f=Yh(h);return n5(r,"ContextEntry",c).assign({value:e.of(r.value).set(p==null?void 0:p.computedValue(),f==null?void 0:f.computedValue())})}if(i===f2e||i===_2e)return n5(r,"InExpression",c);if(i===y2e)return r.define("partial",ff.of(h=>{var p;return(p=Yh(h.children))==null?void 0:p.computedValue()}));if(i===R2e){const h=Yh(r.children).computedValue();return r.define(h,1)}if(i===C2e||i===j2e||i===k2e){const h=r.children.slice(0,-1),p=Yh(r.children);return r.assign({children:h}).enterScope("ArithmeticExpression").pushChild(p)}if(i===P2e)return r.enterScope("ArithmeticExpression");if(i===g2e||i===v2e||i===V2e)return r.token(c);if(i===D2e)return r.literal(c.replace(/^"|"$/g,""));if(i===$2e)return r.literal(c==="true");if(i===I2e)return r.literal(parseFloat(c));if(i===A2e)return r.literal(null);if(i===T2e)return r.resolveName();if(i===m2e||i===U2e)return r.declareName();if((i===ZL||i===E2e)&&r.tokens.length>0)throw new Error("uncleared name");if(i===ZL){let h=r;for(;h.parent;)h=h.exitScope(c);return h}return r}})}const lPe=m7({});function cPe(t,e){if(!e.length)return t.assign({value:null});if(e[0].name==="Name"&&(e=uPe(e,["m","key"])),e.length!==2)return t.assign({value:null});const[n,r]=e,i=r==null?void 0:r.computedValue(),s=n==null?void 0:n.computedValue();return!s||typeof s!="object"||typeof i!="string"?t.assign({value:null}):t.assign({value:[Gb(i),i].reduce((o,a)=>s.get(a)||o,null)})}function uPe(t,e){const n={};for(let r=0;r<t.length;r+=2){const[i,s]=t.slice(r,r+2);n[i.value]=s}return e.map(r=>n[r])}function Yh(t){return t[t.length-1]}const dPe=uW({StringLiteral:ge.string,NumericLiteral:ge.number,BooleanLiteral:ge.bool,"AtLiteral!":ge.special(ge.string),CompareOp:ge.compareOperator,ArithOp:ge.arithmeticOperator,"for if then else some every satisfies between return":ge.controlKeyword,"in instance of and or":ge.operatorKeyword,function:ge.definitionKeyword,as:ge.keyword,"Type/...":ge.typeName,Wildcard:ge.special(ge.variableName),null:ge.null,LineComment:ge.lineComment,BlockComment:ge.blockComment,'VariableName! "?"':ge.variableName,"DateTimeConstructor! SpecialFunctionName!":ge.function(ge.special(ge.variableName)),"List Interval":ge.list,Context:ge.definition(ge.literal),"Name!":ge.definition(ge.variableName),"Key/Name! ContextEntryType/Name!":ge.definition(ge.propertyName),"PathExpression/VariableName!":ge.function(ge.propertyName),"FormalParameter/ParameterName!":ge.function(ge.definition(ge.variableName)),"( )":ge.paren,"[ ]":ge.squareBracket,"{ }":ge.brace,".":ge.derefOperator,", ;":ge.separator,"..":ge.punctuation}),hPe={__proto__:null,for:10,in:32,return:36,if:40,then:42,else:44,some:48,every:50,satisfies:56,or:60,and:64,between:72,instance:86,of:89,days:101,time:103,duration:105,years:107,months:109,date:111,list:117,context:123,function:130,null:156,true:332,false:332,"?":170,external:186,not:211},pPe=tw.deserialize({version:14,states:"C|O`QYOOO`QYOOO$yQYOOOOQU'#Ce'#CeO%TQYO'#C`O&^QYO'#FQOOQQ'#Ff'#FfO&hQYO'#FfO`QYO'#DVOOQU'#En'#EnO(_Q^O'#D]OOQU'#D^'#D^OOQU'#D]'#D]OOQO'#Fn'#FnO*[QWO'#DvOOQQ'#D}'#D}OOQQ'#EO'#EOOOQQ'#EP'#EPO*aOWO'#ESO*[QWO'#EQOOQQ'#EQ'#EQOOQQ'#Ft'#FtOOQQ'#Fr'#FrOOQQ'#Fz'#FzOOQQ'#EU'#EUO`QYO'#EWOOQQ'#FS'#FSO*iQ^O'#FSO,`QYO'#EXO,gQWO'#EYOOQP'#GO'#GOO,lQXO'#EaOOQQ'#F{'#F{OOQQ'#FR'#FRQOQWOOOOQQ'#FT'#FTOOQQ'#F^'#F^O`QYO'#CoOOQQ'#F_'#F_O%TQYO'#CsO,zQYO'#DwOOQQ'#Fs'#FsO-PQYO'#EROOQO'#ER'#ERO`QYO'#EVO`QYO'#EUOOQO'#F|'#F|Q-XQWOOO-^QYO'#DRO.TQWO'#FbOOQO'#DT'#DTO.`QYO'#FfO.gQWOOO/^QYO'#CdO/kQYO'#FVOOQQ'#Cc'#CcO/pQYO'#FUOOQQ'#Cb'#CbO/xQYO,58zO`QYO,59iOOQQ'#Fc'#FcOOQQ'#Fd'#FdOOQQ'#Fe'#FeO`QYO,59qO`QYO,59qO`QYO,59qOOQQ'#Fl'#FlO/}QYO,5:^OOQQ'#Fm'#FmO`QYO,5:`O`QYO,59eO`QYO,59gO`QYO,59iO1|QYO,59iO2TQYO,59rOOQQ,5:i,5:iO2YQYO,59qOOQU-E8l-E8lO3|QYO'#FoOOQQ,5:b,5:bOOQQ,5:n,5:nOOQQ,5:l,5:lO4TQYO,5:rOOQQ,5;n,5;nO4_QYO,5:qO4lQWO,5:sO4qQYO,5:tOOQP'#Ee'#EeO5hQXO'#EdOOQO'#Ec'#EcO5oQWO'#EbO5tQWO'#GPO5|QWO,5:{O6RQYO,59ZO/kQYO'#FaOOQQ'#Cw'#CwO6YQYO'#F`OOQQ'#Cv'#CvO6bQYO,59_O6gQYO,5:cO6lQYO,5:mO4WQYO,5:qO6qQYO,5:pO`QYO'#EwQ-XQWOOO`QYO'#EmO7hQWO,5;|O`QYOOOOQR'#Cf'#CfOOQQ'#Ej'#EjO8bQYO,59OO`QYO,5;qOOQQ'#FY'#FYO%TQYO'#EkO8rQYO,5;pO`QYO1G.fOOQQ'#F]'#F]O9iQYO1G/TO<`QYO1G/]O<jQYO1G/]O<tQYO1G/]OOQQ1G/x1G/xO>hQYO1G/zO>oQYO1G/PO?xQYO1G/ROARQYO1G/TO`QYO1G/TOOQQ1G/T1G/TOAiQYO1G/^OBWQ^O'#CdOCjQYO'#FqOOQO'#Dz'#DzOCtQWO'#DyOCyQWO'#FpOOQO'#Dx'#DxOOQO'#D{'#D{ODRQWO,5<ZOOQQ1G0^1G0^O`QYO1G0]O`QYO'#EsODWQWO,5<]OOQQ1G0_1G0_ODcQWO'#E[ODnQWO'#F}OOQO'#EZ'#EZODvQWO1G0`OOQP'#Eu'#EuOD{QXO,5;OO`QYO,5:|OESQXO'#EvOE_QWO,5<kOOQQ1G0g1G0gO`QYO1G.uO`QYO,5;{O%TQYO'#ElOEgQYO,5;zO`QYO1G.yOEoQYO1G/}OOQO1G0X1G0XOOQO,5;c,5;cOOQO-E8u-E8uOOQO,5;X,5;XOOQO-E8k-E8kOEtQWOOOOQQ-E8h-E8hOEyQYO'#CmOOQQ1G1]1G1]OOQQ,5;V,5;VOOQQ-E8i-E8iOFWQYO7+$QOOQQ7+%f7+%fO`QYO7+$oOF}QYO,5:rOG[QWO7+$oOGaQYO'#D[OOQQ'#DZ'#DZOITQYO'#D_OIYQYO'#D_OI_QYO'#D_OIdQ`O'#DgOIiQ`O'#DjOInQ`O'#DnOOQQ7+$x7+$xO`QYO,5:eO%TQYO'#ErOIsQWO,5<[OOQQ1G1u1G1uOJyQYO7+%wOKWQYO,5;_OOQO-E8q-E8qOAiQYO,5:vO%TQYO'#EtOKeQWO,5<iOKmQYO7+%zOOQP-E8s-E8sOKtQYO1G0hOOQO,5;b,5;bOOQO-E8t-E8tOLOQYO7+$aOLVQYO1G1gOOQQ,5;W,5;WOOQQ-E8j-E8jOLaQYO7+$eOOQO7+%i7+%iO`QYO,59XOMWQYO<<HZOOQQ<<HZ<<HZO/}QYO'#EoONaQYO,59vO!!TQYO,59yO!!YQYO,59yO!!_QYO,59yO!!dQYO,5:RO%TQYO,5:UO!#RQbO,5:YO!#YQYO1G0POOQO,5;^,5;^OOQO-E8p-E8pO!#dQYO<<IcOOQQ<<Ic<<IcOOQO1G0b1G0bOOQO,5;`,5;`OOQO-E8r-E8rO!&fQYO'#E^OOQQ<<If<<IfO`QYO<<IfO`QYO<<G{O!']QYO1G.sOOQQ,5;Z,5;ZOOQQ-E8m-E8mO!'gQYO1G/eOOQQ1G/e1G/eO!'lQbO'#D]O!'}Q`O'#D[O!(YQ`O1G/mO!(_QWO'#DmO!(dQ`O'#FhOOQO'#Dl'#DlO!(lQ`O1G/pOOQO'#Dq'#DqO!(qQ`O'#FjOOQO'#Dp'#DpO!(yQ`O1G/tOOQQAN?QAN?QO!)OQYOAN=gOOQQ7+%P7+%PO!)uQ`O,59vOOQQ7+%X7+%XO!!dQYO,5:XO%TQYO'#EpO!*QQ`O,5<SOOQQ7+%[7+%[O!!dQYO'#EqO!*YQ`O,5<UO!*bQ`O7+%`OOQO1G/s1G/sOOQO,5;[,5;[OOQO-E8n-E8nOOQO,5;],5;]OOQO-E8o-E8oOAiQYO<<HzOOQQAN>fAN>fO/}QYO'#EoO!!dQYO<<HzO!*gQ`O7+%`O!*lQ`O1G/tO!#RQbO,5:YO!*qQ`O'#Dn",stateData:"!+U~O#rOS#sOSPOSQOS~OTsOZVO[UOdtOhvOivOr}Os}OviO!T{O!U{O!VxO!XzO!c!OO!g|O!igO!pyO!wjO#SnO#nRO#oRO$ZZO$i_O$j`O$k`O$laO$mbO~OTsO[UOdtOhvOivOr}Os}OviO!T{O!U{O!VxO!XzO!c!OO!g|O!igO!pyO!wjO#SnO#nRO#oRO$ZZO$i_O$j`O$k`O$laO$mbO~OZ!TO#]!UO~P#VO#nRO#oRO~OZ!^O[!^O]!_O^!_O_!`O`!kOn!hOp!iOr!]Os!]Ot!jO{!lO!i!fO#z!dOv$bX~O#l#tX$t#tX~P%]O$i!mOT$YXZ$YX[$YXd$YXh$YXi$YXr$YXs$YXv$YX!T$YX!U$YX!V$YX!X$YX!c$YX!g$YX!i$YX!p$YX!w$YX#S$YX#n$YX#o$YX$Z$YX$j$YX$k$YX$l$YX$m$YX~O#nRO#oROZ!PX[!PX]!PX^!PX_!PX`!PXn!PXp!PXr!PXs!PXt!PXv!PX{!PX!i!PX#l!PX#p!PX#z!PX$t!PX$O!PXx!PX#}!PX!g!PXe!PXb!PX#R!PXf!PXl!PX~Ov!pO~O$j`O$k`O~O#p!uOZ#vX[#vX]#vX^#vX_#vX`#vXn#vXp#vXr#vXs#vXt#vXv#vX{#vX!i#vX#l#vX#z#vX$t#vX$O#vXx#vX#}#vX!g#vXe#vXb#vX#R#vXf#vXl#vX~O!g$eP~P`Ov!xO~O#m!yO$j`O$k`O#R$sP~Op#VO~Op#WOv!uX~O$t#ZO~O#luX$OuX$tuXxuX#}uX!guXeuXbuX#RuXfuXluX~P%]O$O#]O#l$UXx$UX~O#l#[X~P&hOv#_O~OZ#`O[#`O]#`O^#`O_#`O#nRO#oRO#z#`O#{#`O$]WX~O`WXxWX$OWX~P.lO`#dO~O$O#eOb#xX~Ob#hO~O#nRO#oRO$ZZO~OTsOZVO[UOdtOhvOivOr}Os}O!T{O!U{O!VxO!XzO!c!OO!g|O!igO!pyO!wjO#SnO#nRO#oRO$ZZO$i_O$j`O$k`O$laO$mbO~Ov#rO~P0YO|#tO~O{!lO!i!fO#z!dOZya[ya]ya^ya_ya`yanyapyaryasyatyav$bX#lya$tya$Oyaxya#}ya!gyaeyabya#Ryafyalya~Ox$eP~P`Ox#}O#}$OO~P%]O#}$OO$O$PO!g$eX~P%]O!g$RO~O#nRO#oROx$qP~OZ#`O[#`O]#`O^#`O_#`O#m!yO#z#`O#{#`O~O$]#WX~P4|O$]$YO~O$O$ZO#R$sX~O#R$]O~Oe$^O~P%]O$O$`Ol$SX~Ol$bO~O!W$cO~O!T$dO~O#l!xa$t!xa$O!xax!xa#}!xa!g!xae!xab!xa#R!xaf!xal!xa~P%]O$O#]O#l$Uax$Ua~OZ#`O[#`O]#`O^#`O_#`O#nRO#oRO#z#`O#{#`O~O`Wa$]WaxWa$OWa~P7sO$O#eOb#xa~OZ!^O[!^O]!_O^!_O_!`O{!lO!i!fO#z!dOv$bX~O`qinqipqirqisqitqi#lqi$tqi$Oqixqi#}qi!gqieqibqi#Rqifqilqi~P8zO_!`O{!lO!i!fO#z!dOZyi[yi`yinyipyiryisyityiv$bX#lyi$tyi$Oyixyi#}yi!gyieyibyi#Ryifyilyi~O]!_O^!_O~P:rO]yi^yi~P:rO{!lO!i!fO#z!dOZyi[yi]yi^yi_yi`yinyipyiryisyityiv$bX#lyi$tyi$Oyixyi#}yi!gyieyibyi#Ryifyilyi~O!g$pO~P%]O`!kOp!iOr!]Os!]Ot!jOnmi#lmi$tmi$Omixmi#}mi!gmiemibmi#Rmifmilmi~P8zO`!kOr!]Os!]Ot!jOnoipoi#loi$toi$Ooixoi#}oi!goieoiboi#Roifoiloi~P8zO`!kOn!hOp$qOr!]Os!]Ot!jO~P8zO!S$vO!V$wO!X$xO![$yO!_$zO!c${O#nRO#oRO$ZZO~OZ#bX[#bX]#bX^#bX_#bX`#bXn#bXp#bXr#bXs#bXt#bXv#bXx#bX{#bX!i#bX#n#bX#o#bX#p#bX#z#bX$O#bX~P.lO$O$POx$eX~P%]O$]$}O~O$O%OOx$dX~Ox%QO~O$O$PO!g$eax$ea~O$]%UOx#OX$O#OX~O$O%VOx$qX~Ox%XO~O$]#Wa~P4|O#m!yO$j`O$k`O~O$O$ZO#R$sa~O$O$`Ol$Sa~O!U%cO~OxrO~O#}%dObaX$OaX~P%]O#lSq$tSq$OSqxSq#}Sq!gSqeSqbSq#RSqfSqlSq~P%]Ox#}O#}$OO$OuX~P%]Ox%fO~O#z%gOZ!OX[!OX]!OX^!OX_!OX`!OXn!OXp!OXr!OXs!OXt!OXv!OX{!OX!i!OX#l!OX$t!OX$O!OXx!OX#}!OX!g!OXe!OXb!OX#R!OXf!OXl!OX~Op%iO~Op%jO~Op%kO~O!]%lO~O!]%mO~O!]%nO~O$O%OOx$da~OZ!^O[!^O]!_O^!_O_!`O`!kOn!hOp!iOr!]Os!]Ot!jO{!lO#z!dOv$bX~Ox%sO!g%sO!i%rO~PI{O!g#ga$O#gax#ga~P%]O$O%VOx$qa~O#P%yO~P`O#R#Ui$O#Ui~P%]Of%zO~P%]Ol$Ti$O$Ti~P%]O#lgq$tgq$Ogqxgq#}gq!ggqegqbgq#Rgqfgqlgq~P%]O`qynqypqyrqysqytqy#lqy$tqy$Oqyxqy#}qy!gqyeqybqy#Rqyfqylqy~P8zO#z%gOZ!Oa[!Oa]!Oa^!Oa_!Oa`!Oan!Oap!Oar!Oas!Oat!Oav!Oa{!Oa!i!Oa#l!Oa$t!Oa$O!Oax!Oa#}!Oa!g!Oae!Oab!Oa#R!Oaf!Oal!Oa~O!T&OO~O!W&OO~O!T&PO~O!S$vO!V$wO!X$xO![$yO!_$zO!c&uO#nRO#oRO$ZZO~O!Y$^P~P!!dOx!mi$O!mi~P%]OT$aXZ$aX[$aX]!yy^!yy_!yy`!yyd$aXh$aXi$aXn!yyp!yyr$aXs$aXt!yyv$aX{!yy!T$aX!U$aX!V$aX!X$aX!c$aX!g$aX!i$aX!p$aX!w$aX#S$aX#l!yy#n$aX#o$aX#z!yy$Z$aX$i$aX$j$aX$k$aX$l$aX$m$aX$t!yy$O!yyx!yy#}!yye!yyb!yy#R!yyf!yyl!yy~O#l#QX$t#QX$O#QXx#QX#}#QX!g#QXe#QXb#QX#R#QXf#QXl#QX~P%]Obai$Oai~P%]O!U&_O~O#nRO#oRO!Y!PX#z!PX$O!PX~O#z&pO!Y!OX$O!OX~O!Y&aO~O$]&bO~O$O&cO!Y$[X~O!Y&eO~O$O&fO!Y$^X~O!Y&hO~O#lc!R$tc!R$Oc!Rxc!R#}c!R!gc!Rec!Rbc!R#Rc!Rfc!Rlc!R~P%]O#z&pO!Y!Oa$O!Oa~O$O&cO!Y$[a~O$O&fO!Y$^a~O$_&nO~O$_&qO~O!Y&rO~O!]&tO~O$Z$j~$j$k_^$i#zQP]Q~",goto:"E}$tPPPP$uP%n%q%w&Z'tPPPPPP'}P$uPPP$uPP(Q(TP$uP$uP$uPPP(ZP(fP$u$uPP(o)U)a*n)UPPPPPPP)UPP)UP+s+v)UP+|,S$uP$uP$u,Z-S-V-]-SP-e.^-e-e/^0VP$u1O$u1w1w2p2sP2yPP1w3P3V/Y3ZPP3cP3f3m3s3y4P5[5f5l5r5x6P6V6]6cPPPPPPPP6i6r8y9r:k:nPP:rPP:x:{;t<m<p<t<y=h>W>wP?pP?sP?w@jA]BUB[B_$uBeBePPPPPC^8yDVEOEREz!mjOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%zR![SQ!YSR$m#eS!WS#eS#Qw$`W#w!p!x%O%VT&T%m&c#WXOPQWYilu|}!]!a!b!c!e!g!h!i!j!k#Z#]#_#c#g#r#t$O$P$Y$^$_$b$q$}%U%X%d%g%l%n%y%z&Q&b&f&n&p&q&tb!VSw!x#e$`%O%V%m&cU#a!V#b#uR#u!pU#a!V#b#uT$W!z$XR$l#cR#UwQ#SwR%`$`U!RQ#_#rQ#s!kR$g#]QrQQ$i#_R$s#rQ$|#tQ%t%UQ&S%lU&X%n&f&tQ&i&bT&o&n&qc$u#t%U%l%n&b&f&n&q&t!lkOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%zQ#m!eU$t#t%U&nS%|%g&p]&R%l%n&b&f&q&t#V[OPQWilu|}!]!a!b!c!e!g!h!i!j!k!p#Z#]#_#c#g#r#t$O$P$Y$^$_$b$q$}%U%X%d%g%l%n%y%z&b&f&n&p&q&tR&W%mQ&U%mR&j&cQ&[%nR&s&tS&Y%n&tR&l&f!m]OPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%zR#|!pQ#y!pR%p%OS#x!p%OT$S!x%V!meOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%z!leOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%zQ!rbT!{o$Z!mcOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%z!mdOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%z!mhOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%z!mpOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%zR$V!xQ$T!xR%u%VQ%x%XR&]%yQ!}oR%[$ZT!|o$ZS!zo$ZT$W!z$XRrQS#b!V#uR$j#bQ#f!YR$n#fQ$a#SR%a$aQ#^!RR$h#^!vYOPQWilu|}!]!a!b!c!e!g!h!i!j!k!p#Z#]#_#c#g#r#t$O$P$Y$^$_$b$q$}%U%X%d%g%y%z&nS!oY&Q_&Q%l%n&b&f&p&q&tQ%h$tS%}%h&`R&`&RQ&d&UR&k&dQ&g&YR&m&gQ%P#yR%q%PS$Q!v#vR%T$QQ%W$TR%v%WQ$X!zR%Y$XQ$[!}R%]$[Q#[!PR$f#[QrOQ!PPR$e#ZUTOP#ZW!QQ!k#]#_Q!nWQ!tiQ!vlQ#PuQ#X|Q#Y}Q#i!]Q#j!aQ#k!bQ#l!cQ#n!gQ#o!hQ#p!iQ#q!jQ#v!pQ$k#cQ$o#gQ$r#rQ%R$OQ%S$PQ%Z$YQ%^$^Q%_$_Q%b$bQ%e$qQ%o$}S%w%X%yQ%{%dR&^%z!mqOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%z!mSOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%zR!ZST!XS#eQ#c!WR$_#QR#g![!muOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%z!mwOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%zR#TwT#Rw$`V!SQ#_#r!X!aT!Q!t!v#P#X#Y#i#n#o#p#q#v$k$o$r%R%S%Z%^%_%b%e%o%w%{&^!Z!bT!Q!t!v#P#X#Y#i#j#n#o#p#q#v$k$o$r%R%S%Z%^%_%b%e%o%w%{&^!]!cT!Q!t!v#P#X#Y#i#j#k#n#o#p#q#v$k$o$r%R%S%Z%^%_%b%e%o%w%{&^!mWOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%zR&V%mT&Z%n&t!a!eT!Q!n!t!v#P#X#Y#i#j#k#l#n#o#p#q#v$k$o$r%R%S%Z%^%_%b%e%o%w%{&^!a!gT!Q!n!t!v#P#X#Y#i#j#k#l#n#o#p#q#v$k$o$r%R%S%Z%^%_%b%e%o%w%{&^!m^OPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%zQ!q^R!scR#z!pQ!wlR#{!p!mfOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%z!mlOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%z!mmOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%zR$U!x!moOPQWilu|}!]!a!b!c!g!h!i!j!k!p#Z#]#_#c#g#r$O$P$Y$^$_$b$q$}%X%d%y%zR#Oo",nodeNames:" LineComment BlockComment Expression ForExpression for InExpressions InExpression Name Identifier Identifier ArithOp ArithOp ArithOp ArithOp ArithOp in IterationContext return IfExpression if then else QuantifiedExpression some every InExpressions InExpression satisfies Disjunction or Conjunction and Comparison CompareOp CompareOp between PositiveUnaryTest ( PositiveUnaryTests ) ArithmeticExpression InstanceOfExpression instance of Type QualifiedName VariableName BacktickIdentifier SpecialType days time duration years months date > ListType list < ContextType context ContextEntryTypes ContextEntryType FunctionType function ArgumentTypes ArgumentType PathExpression ] FilterExpression [ FunctionInvocation SpecialFunctionName NamedParameters NamedParameter ParameterName PositionalParameters null NumericLiteral StringLiteral BooleanLiteral DateTimeLiteral DateTimeConstructor AtLiteral ? SimplePositiveUnaryTest Interval ParenthesizedExpression List FunctionDefinition FormalParameters FormalParameter external FunctionBody } { Context ContextEntry Key Name Identifier Expressions UnaryTests Wildcard not",maxTerm:174,context:lPe,nodeProps:[["group",-17,4,19,23,29,31,33,41,42,68,70,72,85,86,88,89,90,97,"Expr",47,"Expr Expr",-5,78,79,80,81,82,"Expr Literal"],["closedBy",38,")",71,"]",96,"}"],["openedBy",40,"(",69,"[",95,"{"]],propSources:[dPe],skippedNodes:[0,1,2],repeatNodeCount:14,tokenData:"2t~RvXY#iYZ$^Z[#i]^$^pq#iqr$crs$nwx*[xy*ayz*fz{*k{|*x|}*}}!O+S!O!P+a!P!Q,k!Q![.f![!].}!]!^/S!^!_/X!_!`$i!`!a/h!b!c/r!}#O/w#P#Q/|#Q#R*s#S#T0R#o#p2j#q#r2o$f$g#i#BY#BZ#i$IS$I_#i$I|$I}$^$I}$JO$^$JT$JU#i$KV$KW#i&FU&FV#i?HT?HU#i~#nY#r~XY#iZ[#ipq#i$f$g#i#BY#BZ#i$IS$I_#i$JT$JU#i$KV$KW#i&FU&FV#i?HT?HU#i~$cO#s~~$fP!_!`$i~$nOr~~$qXOY$nYZ%^Zr$nrs'us#O$n#O#P'|#P;'S$n;'S;=`)c<%lO$n~%aVOr%^rs%vs#O%^#O#P%{#P;'S%^;'S;=`'S<%lO%^~%{O$j~~&OWOr%^rs&hs#O%^#O#P%{#P;'S%^;'S;=`'Y;=`<%l%^<%lO%^~&mV$j~Or%^rs%vs#O%^#O#P%{#P;'S%^;'S;=`'S<%lO%^~'VP;=`<%l%^~']WOr%^rs%vs#O%^#O#P%{#P;'S%^;'S;=`'S;=`<%l%^<%lO%^~'|O$j~$k~~(PYOY$nYZ$nZr$nrs(os#O$n#O#P'|#P;'S$n;'S;=`)i;=`<%l$n<%lO$n~(vX$j~$k~OY$nYZ%^Zr$nrs'us#O$n#O#P'|#P;'S$n;'S;=`)c<%lO$n~)fP;=`<%l$n~)lYOY$nYZ%^Zr$nrs'us#O$n#O#P'|#P;'S$n;'S;=`)c;=`<%l$n<%lO$n~*aO#{~~*fOv~~*kOx~~*pP^~z{*s~*xO_~~*}O[~~+SO$O~R+XPZP!`!a+[Q+aO$_Q~+fQ#z~!O!P+l!Q![+q~+qO#}~~+vR$i~!Q![+q!g!h,P#X#Y,P~,SR{|,]}!O,]!Q![,c~,`P!Q![,c~,hP$i~!Q![,c~,pQ]~z{,v!P!Q-}~,yTOz,vz{-Y{;'S,v;'S;=`-w<%lO,v~-]VOz,vz{-Y{!P,v!P!Q-r!Q;'S,v;'S;=`-w<%lO,v~-wOQ~~-zP;=`<%l,v~.SSP~OY-}Z;'S-};'S;=`.`<%lO-}~.cP;=`<%l-}~.kS$i~!O!P.w!Q![.f!g!h,P#X#Y,P~.zP!Q![+q~/SO$]~~/XO$t~R/`P!]QsP!_!`/cP/hOsPR/oP!YQsP!_!`/c~/wO$m~~/|O!i~~0RO!g~~0UVO#O0R#O#P0k#P#S0R#S#T1r#T;'S0R;'S;=`1w<%lO0R~0nWO#O0R#O#P0k#P#S0R#S#T1W#T;'S0R;'S;=`1};=`<%l0R<%lO0R~1]V$Z~O#O0R#O#P0k#P#S0R#S#T1r#T;'S0R;'S;=`1w<%lO0R~1wO$Z~~1zP;=`<%l0R~2QWO#O0R#O#P0k#P#S0R#S#T1r#T;'S0R;'S;=`1w;=`<%l0R<%lO0R~2oO#S~~2tO#R~",tokenizers:[tPe,ePe,nPe,0,1],topRules:{Expression:[0,3],Expressions:[1,102],UnaryTests:[2,103]},dialects:{camunda:2568},dynamicPrecedences:{31:-1,68:1,72:-1,74:-1},specialized:[{term:122,get:t=>hPe[t]||-1}],tokenPrec:2571});function fPe(t){const e=[];return t.iterate({enter:n=>{const r=n.node;if(!r.type.isError)return;const i=r.parent,s=g7(r),o={from:r.from,to:r.to,severity:"error",type:"Syntax Error"};if(r.from!==r.to)o.message=`Unrecognized token in <${i.name}>`;else if(s)o.message=`Unrecognized token <${s.name}> in <${i.name}>`,o.to=s.to;else{const a=i.enterUnfinishedNodesBefore(r.to);o.message=`Incomplete <${(a||i).name}>`}e.push(o)}}),e}function g7(t){return t?t.nextSibling||g7(t.parent):null}const mPe="first-item";var gPe={create(t){return{enter(e){if(e.name!=="FilterExpression")return;const n=t.readContent(e.from,e.to);if(r5().test(n)){const{from:r,to:i}=e;t.report({from:r,to:i,message:"First item is accessed via [1]",severity:"warning",type:mPe,actions:[{name:"fix",apply(s,o=r,a=i){t.updateContent(o,a,n.replace(r5(),"[1]"))}}]})}}}}};function r5(){return/\[\s*0\s*\]$/}const vPe=[gPe];function yPe(t){const{readContent:e,syntaxTree:n,updateContent:r}=t,i=[],s={readContent:e,report:a=>{i.push(a)},updateContent:r},o=vPe.map(a=>a.create(s));return n.iterate({enter:a=>{for(const l of o)l.enter&&l.enter(a)},leave:a=>{for(const l of o)l.leave&&l.leave(a)}}),i}function xPe(t){return[...fPe(t.syntaxTree),...yPe(t)]}const bPe=()=>t=>{if(t.state.doc.length===0)return[];const e=Qr(t.state);return xPe({syntaxTree:e,readContent:(r,i)=>t.state.sliceDoc(r,i),updateContent:(r,i,s)=>t.dispatch({changes:{from:r,to:i,insert:s}})}).map(r=>({...r,source:r.type}))},v7=[ma("function(${params}) ${body}",{label:"function",detail:"definition",type:"keyword"}),ma("for ${var} in ${collection} return ${value}",{label:"for",detail:"expression",type:"keyword"}),ma("every ${var} in ${collection} satisfies ${condition}",{label:"every",detail:"quantified expression",type:"keyword"}),ma("some ${var} in ${collection} satisfies ${condition}",{label:"some",detail:"quantified expression",type:"keyword"}),ma("if ${condition} then ${value} else ${other value}",{label:"if",detail:"block",type:"keyword"}),ma("{ ${key}: ${value} }",{label:"context",detail:"block",type:"keyword"}),ma("null",{label:"null",detail:"literal",type:"keyword"}),ma("true",{label:"true",detail:"literal",type:"keyword"}),ma("false",{label:"false",detail:"literal",type:"keyword"})];function Xj(){return Xj=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Xj.apply(this,arguments)}function Bm(t){const{context:e,after:n,before:r,keyword:i}=t;return CPe({nodes:e,before:r,after:n,keyword:i},d1([{label:i,type:"keyword",boost:10}]))}const y7=[Bm({context:"InExpression",keyword:"in"}),Bm({context:"IfExpression",keyword:"then",after:"if",before:"else"}),Bm({context:"IfExpression",keyword:"else",after:"then"}),Bm({context:"QuantifiedExpression",keyword:"satisfies"}),Bm({context:"ForExpression",after:"InExpressions",keyword:"return"})],i5=["StringLiteral","Identifier","LineComment","BlockComment","PathExpression","Context","Key","ParameterName"],wPe=["Expr","ContextEntry"];function _Pe(t){const e=[...i5,...wPe];return n=>{const{state:r,pos:i}=n,s=b7(Qr(r).resolveInner(i,-1),e);if(s){const[o,a]=s;if(i5.includes(a))return null}return t(n)}}function EPe(t){return _Pe(d1(t.map(e=>Xj({},e,{type:"text"}))))}function s5(t,e,n){return x7(t,e,n,-1)}function SPe(t,e,n){return x7(t,e,n,1)}function x7(t,e,n,r){let i=t[r>0?"childAfter":"childBefore"](e);for(;i;){if(n.includes(i.name))return i;if(i.type.isError&&i.firstChild&&n.includes(i.firstChild.name))return i.firstChild;i=i[r>0?"nextSibling":"prevSibling"]}return null}function b7(t,e){for(Array.isArray(e)||(e=[e]);t;t=t.parent){const n=t.type,r=e.find(i=>i&&n.is(i));if(r)return[t,r];if(n.isTop)break}return null}function CPe(t,e){const{nodes:n,before:r,after:i,keyword:s}=t;return o=>{const{state:a,pos:l}=o,c=b7(Qr(a).resolveInner(l,-1),n);if(!c)return null;const[d]=c;return s5(d,l,[s,r])||SPe(d,l,[s,i])||i&&!s5(d,l,[i])?null:e(o)}}const w7=W0.define({parser:pPe.configure({props:[fW.add({Context:bL({closing:"}"}),"List FilterExpression":bL({closing:"]"}),"ParenthesizedExpression FunctionInvocation":cS({except:/^\s*\)/}),"ForExpression QuantifiedExpression IfExpression":cS({except:/^\s*(then|else|return|satisfies)\b/}),FunctionDefinition:cS({except:/^\s*(\(|\))/})}),CCe.add({Context:uS,List:uS,ParenthesizedExpression:uS,FunctionDefinition(t){const e=t.getChild(")");return e?{from:e.to,to:t.to}:null}})]}),languageData:{indentOnInput:/^\s*(\)|\}|\]|then|else|return|satisfies)$/,commentTokens:{line:"//",block:{open:"/*",close:"*/"}}}}),jPe=w7.configure({top:"UnaryTests"},"FEEL unary tests"),kPe=w7.configure({top:"Expression"},"FEEL expression");function PPe(t={}){const e=t.dialect==="unaryTests"?jPe:kPe,n=t.parserDialect,r=m7(t.context),i=e.configure({contextTracker:r,dialect:n}),s=t.completions||[EPe(v7),y7].flat();return new mCe(i,[...s.map(o=>i.data.of({autocomplete:o}))])}const TPe=[{name:"not",type:"function",params:[{name:"negand"}],info:`<p>Returns the logical negation of the given value.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">not(negand: boolean): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">not(true)
// false

not(null)
// null
</code></pre>
`},{name:"is defined",type:"function",params:[{name:"value"}],info:`<p><em>Camunda Extension</em></p>
<p>Checks if a given value is not <code>null</code>. If the value is <code>null</code> then the function returns <code>false</code>.
Otherwise, the function returns <code>true</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">is defined(value: Any): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">is defined(1)
// true

is defined(null)
// false

is defined(x)
// false - if no variable &quot;x&quot; exists

is defined(x.y)
// false - if no variable &quot;x&quot; exists or it doesn&#39;t have a property &quot;y&quot;
</code></pre>
<p>:::caution Breaking change</p>
<p>This function worked differently in previous versions. It returned <code>true</code> if the value was <code>null</code>.
Since this version, the function returns <code>false</code> if the value is <code>null</code>.</p>
<p>:::</p>
`},{name:"get or else",type:"function",params:[{name:"value"},{name:"default"}],info:`<p><em>Camunda Extension</em></p>
<p>Return the provided value parameter if not <code>null</code>, otherwise return the default parameter</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">get or else(value: Any, default: Any): Any
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">get or else(&quot;this&quot;, &quot;default&quot;)
// &quot;this&quot;

get or else(null, &quot;default&quot;)
// &quot;default&quot;

get or else(null, null)
// null
</code></pre>
`},{name:"assert",type:"function",params:[{name:"value"},{name:"condition"}],info:`<p><em>Camunda Extension</em></p>
<p>Verify that the given condition is met. If the condition is <code>true</code>, the function returns the value.
Otherwise, the evaluation fails with an error.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">assert(value: Any, condition: Any)
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">assert(x, x != null)
// &quot;value&quot; - if x is &quot;value&quot;
// error - if x is null or doesn&#39;t exist

assert(x, x &gt;= 0)
// 4 - if x is 4
// error - if x is less than zero
</code></pre>
`},{name:"assert",type:"function",params:[{name:"value"},{name:"condition"},{name:"cause"}],info:`<p><em>Camunda Extension</em></p>
<p>Verify that the given condition is met. If the condition is <code>true</code>, the function returns the value.
Otherwise, the evaluation fails with an error containing the given message.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">assert(value: Any, condition: Any, cause: String)
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">assert(x, x != null, &quot;&#39;x&#39; should not be null&quot;)
// &quot;value&quot; - if x is &quot;value&quot;
// error(&#39;x&#39; should not be null) - if x is null or doesn&#39;t exist

assert(x, x &gt;= 0, &quot;&#39;x&#39; should be positive&quot;)
// 4 - if x is 4
// error(&#39;x&#39; should be positive) - if x is less than zero
</code></pre>
`},{name:"get value",type:"function",params:[{name:"context"},{name:"key"}],info:`<p>Returns the value of the context entry with the given key.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">get value(context: context, key: string): Any
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">get value({foo: 123}, &quot;foo&quot;)
// 123

get value({a: 1}, &quot;b&quot;)
// null
</code></pre>
`},{name:"get value",type:"function",params:[{name:"context"},{name:"keys"}],info:`<p><em>Camunda Extension</em></p>
<p>Returns the value of the context entry for a context path defined by the given keys.</p>
<p>If <code>keys</code> contains the keys <code>[k1, k2]</code> then it returns the value at the nested entry <code>k1.k2</code> of the context.</p>
<p>If <code>keys</code> are empty or the nested entry defined by the keys doesn&#39;t exist in the context, it returns <code>null</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">get value(context: context, keys: list&lt;string&gt;): Any
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">get value({x:1, y: {z:0}}, [&quot;y&quot;, &quot;z&quot;])
// 0

get value({x: {y: {z:0}}}, [&quot;x&quot;, &quot;y&quot;])
// {z:0}

get value({a: {b: 3}}, [&quot;b&quot;])
// null
</code></pre>
`},{name:"get entries",type:"function",params:[{name:"context"}],info:`<p>Returns the entries of the context as a list of key-value-pairs.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">get entries(context: context): list&lt;context&gt;
</code></pre>
<p>The return value is a list of contexts. Each context contains two entries for &quot;key&quot; and &quot;value&quot;.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">get entries({foo: 123})
// [{key: &quot;foo&quot;, value: 123}]
</code></pre>
`},{name:"context put",type:"function",params:[{name:"context"},{name:"key"},{name:"value"}],info:`<p>Adds a new entry with the given key and value to the context. Returns a new context that includes the entry.</p>
<p>If an entry for the same key already exists in the context, it overrides the value.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">context put(context: context, key: string, value: Any): context
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">context put({x:1}, &quot;y&quot;, 2)
// {x:1, y:2}
</code></pre>
<p>:::info
The function <code>context put()</code> replaced the previous function <code>put()</code> (Camunda Extension). The
previous function is deprecated and should not be used anymore.
:::</p>
`},{name:"context put",type:"function",params:[{name:"context"},{name:"keys"},{name:"value"}],info:`<p>Adds a new entry with the given value to the context. The path of the entry is defined by the keys. Returns a new context that includes the entry.</p>
<p>If <code>keys</code> contains the keys <code>[k1, k2]</code> then it adds the nested entry <code>k1.k2 = value</code> to the context.</p>
<p>If an entry for the same keys already exists in the context, it overrides the value.</p>
<p>If <code>keys</code> are empty, it returns <code>null</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">context put(context: context, keys: list&lt;string&gt;, value: Any): context
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">context put({x:1}, [&quot;y&quot;], 2)
// {x:1, y:2}

context put({x:1, y: {z:0}}, [&quot;y&quot;, &quot;z&quot;], 2)
// {x:1, y: {z:2}}

context put({x:1}, [&quot;y&quot;, &quot;z&quot;], 2)
// {x:1, y: {z:2}}
</code></pre>
`},{name:"context merge",type:"function",params:[{name:"contexts"}],info:`<p>Union the given contexts. Returns a new context that includes all entries of the given contexts.</p>
<p>If an entry for the same key already exists in a context, it overrides the value. The entries are overridden in the same order as in the list of contexts.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">context merge(contexts: list&lt;context&gt;): context
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">context merge([{x:1}, {y:2}])
// {x:1, y:2}

context merge([{x:1, y: 0}, {y:2}])
// {x:1, y:2}
</code></pre>
<p>:::info
The function <code>context merge()</code> replaced the previous function <code>put all()</code> (Camunda Extension). The
previous function is deprecated and should not be used anymore.
:::</p>
`},{name:"string",type:"function",params:[{name:"from"}],info:`<p>Returns the given value as a string representation.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">string(from: Any): string
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">string(1.1)
// &quot;1.1&quot;

string(date(&quot;2012-12-25&quot;))
// &quot;2012-12-25&quot;
</code></pre>
`},{name:"number",type:"function",params:[{name:"from"}],info:`<p>Parses the given string to a number.</p>
<p>Returns <code>null</code> if the string is not a number.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">number(from: string): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">number(&quot;1500.5&quot;)
// 1500.5
</code></pre>
`},{name:"context",type:"function",params:[{name:"entries"}],info:`<p>Constructs a context of the given list of key-value pairs. It is the reverse function to <a href="feel-built-in-functions-context.md#get-entriescontext">get entries()</a>.</p>
<p>Each key-value pair must be a context with two entries: <code>key</code> and <code>value</code>. The entry with name <code>key</code> must have a value of the type <code>string</code>.</p>
<p>It might override context entries if the keys are equal. The entries are overridden in the same order as the contexts in the given list.</p>
<p>Returns <code>null</code> if one of the entries is not a context or if a context doesn&#39;t contain the required entries.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">context(entries: list&lt;context&gt;): context
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">context([{&quot;key&quot;:&quot;a&quot;, &quot;value&quot;:1}, {&quot;key&quot;:&quot;b&quot;, &quot;value&quot;:2}])
// {a:1, b:2}
</code></pre>
`},{name:"date",type:"function",params:[{name:"from"}],info:`<p>Returns a date from the given value.</p>
<p>Returns <code>null</code> if the string is not a valid calendar date. For example, <code>&quot;2024-06-31&quot;</code> is invalid because June has
only 30 days.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">date(from: string): date
</code></pre>
<p>Parses the given string into a date.</p>
<pre><code class="language-feel">date(from: date and time): date
</code></pre>
<p>Extracts the date component from the given date and time.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">date(&quot;2018-04-29&quot;)
// date(&quot;2018-04-29&quot;)

date(date and time(&quot;2012-12-25T11:00:00&quot;))
// date(&quot;2012-12-25&quot;)
</code></pre>
`},{name:"date",type:"function",params:[{name:"year"},{name:"month"},{name:"day"}],info:`<p>Returns a date from the given components.</p>
<p>Returns <code>null</code> if the components don&#39;t represent a valid calendar date. For example, <code>2024,6,31</code> is invalid because
June has only 30 days.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">date(year: number, month: number, day: number): date
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">date(2012, 12, 25)
// date(&quot;2012-12-25&quot;)
</code></pre>
`},{name:"time",type:"function",params:[{name:"from"}],info:`<p>Returns a time from the given value.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">time(from: string): time
</code></pre>
<p>Parses the given string into a time.</p>
<pre><code class="language-feel">time(from: date and time): time
</code></pre>
<p>Extracts the time component from the given date and time.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">time(&quot;12:00:00&quot;)
// time(&quot;12:00:00&quot;)

time(date and time(&quot;2012-12-25T11:00:00&quot;))
// time(&quot;11:00:00&quot;)
</code></pre>
`},{name:"time",type:"function",params:[{name:"hour"},{name:"minute"},{name:"second"}],info:`<p>Returns a time from the given components.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">time(hour: number, minute: number, second: number): time
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">time(23, 59, 0)
// time(&quot;23:59:00&quot;)
</code></pre>
`},{name:"time",type:"function",params:[{name:"hour"},{name:"minute"},{name:"second"},{name:"offset"}],info:`<p>Returns a time from the given components, including a timezone offset.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">time(hour: number, minute: number, second: number, offset: days and time duration): time
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">time(14, 30, 0, duration(&quot;PT1H&quot;))
// time(&quot;14:30:00+01:00&quot;)
</code></pre>
`},{name:"date and time",type:"function",params:[{name:"from"}],info:`<p>Parses the given string into a date and time.</p>
<p>Returns <code>null</code> if the string is not a valid calendar date. For example, <code>&quot;2024-06-31T10:00:00&quot;</code> is invalid because
June has only 30 days.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">date and time(from: string): date and time
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">date and time(&quot;2018-04-29T09:30:00&quot;)
// date and time(&quot;2018-04-29T09:30:00&quot;)
</code></pre>
`},{name:"date and time",type:"function",params:[{name:"date"},{name:"time"}],info:`<p>Returns a date and time from the given components.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">date and time(date: date, time: time): date and time
</code></pre>
<pre><code class="language-feel">date and time(date: date and time, time: time): date and time
</code></pre>
<p>Returns a date and time value that consists of the date component of <code>date</code> combined with <code>time</code>.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">date and time(date(&quot;2012-12-24&quot;),time(&quot;T23:59:00&quot;))
// date and time(&quot;2012-12-24T23:59:00&quot;)

date and time(date and time(&quot;2012-12-25T11:00:00&quot;),time(&quot;T23:59:00&quot;))
// date and time(&quot;2012-12-25T23:59:00&quot;)
</code></pre>
`},{name:"date and time",type:"function",params:[{name:"date"},{name:"timezone"}],info:`<p><em>Camunda Extension</em></p>
<p>Returns the given date and time value at the given timezone.</p>
<p>If <code>date</code> has a different timezone than <code>timezone</code> then it adjusts the time to match the local time of <code>timezone</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">date and time(date: date and time, timezone: string): date and time
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">date and time(@&quot;2020-07-31T14:27:30@Europe/Berlin&quot;, &quot;America/Los_Angeles&quot;)
// date and time(&quot;2020-07-31T05:27:30@America/Los_Angeles&quot;)

date and time(@&quot;2020-07-31T14:27:30&quot;, &quot;Z&quot;)
// date and time(&quot;2020-07-31T12:27:30Z&quot;)
</code></pre>
`},{name:"duration",type:"function",params:[{name:"from"}],info:`<p>Parses the given string into a duration. The duration is either a days and time duration or a years and months duration.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">duration(from: string): days and time duration
</code></pre>
<pre><code class="language-feel">duration(from: string): years and months duration
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">duration(&quot;P5D&quot;)
// duration(&quot;P5D&quot;)

duration(&quot;P32Y&quot;)
// duration(&quot;P32Y&quot;)
</code></pre>
`},{name:"years and months duration",type:"function",params:[{name:"from"},{name:"to"}],info:`<p>Returns the years and months duration between <code>from</code> and <code>to</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">years and months duration(from: date, to: date): years and months duration
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">years and months duration(date(&quot;2011-12-22&quot;), date(&quot;2013-08-24&quot;))
// duration(&quot;P1Y8M&quot;)
</code></pre>
`},{name:"list contains",type:"function",params:[{name:"list"},{name:"element"}],info:`<p>Returns <code>true</code> if the given list contains the element. Otherwise, returns <code>false</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">list contains(list: list, element: Any): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">list contains([1,2,3], 2)
// true
</code></pre>
`},{name:"count",type:"function",params:[{name:"list"}],info:`<p>Returns the number of elements of the given list.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">count(list: list): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">count([1,2,3])
// 3
</code></pre>
`},{name:"min",type:"function",params:[{name:"list"}],info:`<p>Returns the minimum of the given list.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">min(list: list): Any
</code></pre>
<p>All elements in <code>list</code> should have the same type and be comparable.</p>
<p>The parameter <code>list</code> can be passed as a list or as a sequence of elements.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">min([1,2,3])
// 1

min(1,2,3)
// 1
</code></pre>
`},{name:"max",type:"function",params:[{name:"list"}],info:`<p>Returns the maximum of the given list.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">max(list: list): Any
</code></pre>
<p>All elements in <code>list</code> should have the same type and be comparable.</p>
<p>The parameter <code>list</code> can be passed as a list or as a sequence of elements.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">max([1,2,3])
// 3

max(1,2,3)
// 3
</code></pre>
`},{name:"sum",type:"function",params:[{name:"list"}],info:`<p>Returns the sum of the given list of numbers.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">sum(list: list&lt;number&gt;): number
</code></pre>
<p>The parameter <code>list</code> can be passed as a list or as a sequence of elements.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">sum([1,2,3])
// 6

sum(1,2,3)
// 6
</code></pre>
`},{name:"product",type:"function",params:[{name:"list"}],info:`<p>Returns the product of the given list of numbers.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">product(list: list&lt;number&gt;): number
</code></pre>
<p>The parameter <code>list</code> can be passed as a list or as a sequence of elements.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">product([2, 3, 4])
// 24

product(2, 3, 4)
// 24
</code></pre>
`},{name:"mean",type:"function",params:[{name:"list"}],info:`<p>Returns the arithmetic mean (i.e. average) of the given list of numbers.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">mean(list: list&lt;number&gt;): number
</code></pre>
<p>The parameter <code>list</code> can be passed as a list or as a sequence of elements.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">mean([1,2,3])
// 2

mean(1,2,3)
// 2
</code></pre>
`},{name:"median",type:"function",params:[{name:"list"}],info:`<p>Returns the median element of the given list of numbers.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">median(list: list&lt;number&gt;): number
</code></pre>
<p>The parameter <code>list</code> can be passed as a list or as a sequence of elements.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">median(8, 2, 5, 3, 4)
// 4

median([6, 1, 2, 3])
// 2.5
</code></pre>
`},{name:"stddev",type:"function",params:[{name:"list"}],info:`<p>Returns the standard deviation of the given list of numbers.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">stddev(list: list&lt;number&gt;): number
</code></pre>
<p>The parameter <code>list</code> can be passed as a list or as a sequence of elements.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">stddev(2, 4, 7, 5)
// 2.0816659994661326

stddev([2, 4, 7, 5])
// 2.0816659994661326
</code></pre>
`},{name:"mode",type:"function",params:[{name:"list"}],info:`<p>Returns the mode of the given list of numbers.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">mode(list: list&lt;number&gt;): number
</code></pre>
<p>The parameter <code>list</code> can be passed as a list or as a sequence of elements.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">mode(6, 3, 9, 6, 6)
// [6]

mode([6, 1, 9, 6, 1])
// [1, 6]
</code></pre>
`},{name:"all",type:"function",params:[{name:"list"}],info:`<p>Returns <code>false</code> if any element of the given list is <code>false</code>. Otherwise, returns <code>true</code>.</p>
<p>If the given list is empty, it returns <code>true</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">all(list: list&lt;boolean&gt;): boolean
</code></pre>
<p>The parameter <code>list</code> can be passed as a list or as a sequence of elements.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">all([true,false])
// false

all(false,null,true)
// false
</code></pre>
<p>:::info
The function <code>all()</code> replaced the previous function <code>and()</code>. The previous function is deprecated and
should not be used anymore.
:::</p>
`},{name:"any",type:"function",params:[{name:"list"}],info:`<p>Returns <code>true</code> if any element of the given list is <code>true</code>. Otherwise, returns <code>false</code>.</p>
<p>If the given list is empty, it returns <code>false</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">any(list: list&lt;boolean&gt;): boolean
</code></pre>
<p>The parameter <code>list</code> can be passed as a list or as a sequence of elements.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">any([false,true])
// true

any(false,null,true)
// true
</code></pre>
<p>:::info
The function <code>any()</code> replaced the previous function <code>or()</code>. The previous function is deprecated and
should not be used anymore.
:::</p>
`},{name:"sublist",type:"function",params:[{name:"list"},{name:"start position"}],info:`<p>Returns a partial list of the given value starting at <code>start position</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">sublist(list: list, start position: number): list
</code></pre>
<p>The <code>start position</code> starts at the index <code>1</code>. The last position is <code>-1</code>.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">sublist([1,2,3], 2)
// [2,3]
</code></pre>
`},{name:"sublist",type:"function",params:[{name:"list"},{name:"start position"},{name:"length"}],info:`<p>Returns a partial list of the given value starting at <code>start position</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">sublist(list: list, start position: number, length: number): list
</code></pre>
<p>The <code>start position</code> starts at the index <code>1</code>. The last position is <code>-1</code>.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">sublist([1,2,3], 1, 2)
// [1,2]
</code></pre>
`},{name:"append",type:"function",params:[{name:"list"},{name:"items"}],info:`<p>Returns the given list with all <code>items</code> appended.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">append(list: list, items: Any): list
</code></pre>
<p>The parameter <code>items</code> can be a single element or a sequence of elements.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">append([1], 2, 3)
// [1,2,3]
</code></pre>
`},{name:"concatenate",type:"function",params:[{name:"lists"}],info:`<p>Returns a list that includes all elements of the given lists.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">concatenate(lists: list): list
</code></pre>
<p>The parameter <code>lists</code> is a sequence of lists.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">concatenate([1,2],[3])
// [1,2,3]

concatenate([1],[2],[3])
// [1,2,3]
</code></pre>
`},{name:"insert before",type:"function",params:[{name:"list"},{name:"position"},{name:"newItem"}],info:`<p>Returns the given list with <code>newItem</code> inserted at <code>position</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">insert before(list: list, position: number, newItem: Any): list
</code></pre>
<p>The <code>position</code> starts at the index <code>1</code>. The last position is <code>-1</code>.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">insert before([1,3],1,2)
// [2,1,3]
</code></pre>
`},{name:"remove",type:"function",params:[{name:"list"},{name:"position"}],info:`<p>Returns the given list without the element at <code>position</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">remove(list: list, position: number): list
</code></pre>
<p>The <code>position</code> starts at the index <code>1</code>. The last position is <code>-1</code>.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">remove([1,2,3], 2)
// [1,3]
</code></pre>
`},{name:"reverse",type:"function",params:[{name:"list"}],info:`<p>Returns the given list in revered order.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">reverse(list: list): list
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">reverse([1,2,3])
// [3,2,1]
</code></pre>
`},{name:"index of",type:"function",params:[{name:"list"},{name:"match"}],info:`<p>Returns an ascending list of positions containing <code>match</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">index of(list: list, match: Any): list&lt;number&gt;
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">index of([1,2,3,2],2)
// [2,4]
</code></pre>
`},{name:"union",type:"function",params:[{name:"list"}],info:`<p>Returns a list that includes all elements of the given lists without duplicates.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">union(list: list): list
</code></pre>
<p>The parameter <code>list</code> is a sequence of lists.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">union([1,2],[2,3])
// [1,2,3]
</code></pre>
`},{name:"distinct values",type:"function",params:[{name:"list"}],info:`<p>Returns the given list without duplicates.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">distinct values(list: list): list
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">distinct values([1,2,3,2,1])
// [1,2,3]
</code></pre>
`},{name:"duplicate values",type:"function",params:[{name:"list"}],info:`<p><em>Camunda Extension</em></p>
<p>Returns all duplicate values of the given list.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">duplicate values(list: list): list
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">duplicate values([1,2,3,2,1])
// [1,2]
</code></pre>
`},{name:"flatten",type:"function",params:[{name:"list"}],info:`<p>Returns a list that includes all elements of the given list without nested lists.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">flatten(list: list): list
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">flatten([[1,2],[[3]], 4])
// [1,2,3,4]
</code></pre>
`},{name:"sort",type:"function",params:[{name:"list"},{name:"precedes"}],info:`<p>Returns the given list sorted by the <code>precedes</code> function.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">sort(list: list, precedes: function&lt;(Any, Any) -&gt; boolean&gt;): list
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">sort(list: [3,1,4,5,2], precedes: function(x,y) x &lt; y)
// [1,2,3,4,5]
</code></pre>
`},{name:"string join",type:"function",params:[{name:"list"}],info:`<p>Joins a list of strings into a single string. This is similar to
Java&#39;s <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/stream/Collectors.html#joining(java.lang.CharSequence,java.lang.CharSequence,java.lang.CharSequence)">joining</a>
function.</p>
<p>If an item of the list is <code>null</code>, the item is ignored for the result string. If an item is
neither a string nor <code>null</code>, the function returns <code>null</code> instead of a string.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">string join(list: list&lt;string&gt;): string
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">string join([&quot;a&quot;,&quot;b&quot;,&quot;c&quot;])
// &quot;abc&quot;

string join([&quot;a&quot;,null,&quot;c&quot;])
// &quot;ac&quot;

string join([])
// &quot;&quot;
</code></pre>
`},{name:"string join",type:"function",params:[{name:"list"},{name:"delimiter"}],info:`<p>Joins a list of strings into a single string. This is similar to
Java&#39;s <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/stream/Collectors.html#joining(java.lang.CharSequence,java.lang.CharSequence,java.lang.CharSequence)">joining</a>
function.</p>
<p>If an item of the list is <code>null</code>, the item is ignored for the result string. If an item is
neither a string nor <code>null</code>, the function returns <code>null</code> instead of a string.</p>
<p>The resulting string contains a <code>delimiter</code> between each element.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">string join(list: list&lt;string&gt;, delimiter: string): string
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">string join([&quot;a&quot;], &quot;X&quot;)
// &quot;a&quot;

string join([&quot;a&quot;,&quot;b&quot;,&quot;c&quot;], &quot;, &quot;)
// &quot;a, b, c&quot;
</code></pre>
`},{name:"string join",type:"function",params:[{name:"list"},{name:"delimiter"},{name:"prefix"},{name:"suffix"}],info:`<p><em>Camunda Extension</em></p>
<p>Joins a list of strings into a single string. This is similar to
Java&#39;s <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/stream/Collectors.html#joining(java.lang.CharSequence,java.lang.CharSequence,java.lang.CharSequence)">joining</a>
function.</p>
<p>If an item of the list is <code>null</code>, the item is ignored for the result string. If an item is
neither a string nor <code>null</code>, the function returns <code>null</code> instead of a string.</p>
<p>The resulting string starts with <code>prefix</code>, contains a <code>delimiter</code> between each element, and ends
with <code>suffix</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">string join(list: list&lt;string&gt;, delimiter: string, prefix: string, suffix: string): string
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">string join([&quot;a&quot;,&quot;b&quot;,&quot;c&quot;], &quot;, &quot;, &quot;[&quot;, &quot;]&quot;)
// &quot;[a, b, c]&quot;
</code></pre>
`},{name:"is empty",type:"function",params:[{name:"list"}],info:`<p><em>Camunda Extension</em></p>
<p>Returns <code>true</code> if the given list is empty. Otherwise, returns <code>false</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">is empty(list: list): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">is empty([])
// true

is empty([1,2,3])
// false
</code></pre>
`},{name:"partition",type:"function",params:[{name:"list"},{name:"size"}],info:`<p><em>Camunda Extension</em></p>
<p>Returns consecutive sublists of a list, each of the same size (the final list may be smaller).</p>
<p>If <code>size</code> is less than <code>0</code>, it returns <code>null</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">partition(list: list, size: number): list
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">partition([1,2,3,4,5], 2)
// [[1,2], [3,4], [5]]

partition([], 2)
// []

partition([1,2], 0)
// null
</code></pre>
`},{name:"fromAi",type:"function",params:[{name:"value"}],info:`<p><em>Camunda Extension</em></p>
<p>Returns the unmodified <code>value</code> parameter.</p>
<ul>
<li>The purpose of this function is solely to tag the value as being generated by an AI integration.</li>
<li>The actual handling is not performed by the FEEL engine, but by a custom integration such as a connector or a job worker.</li>
</ul>
<p>The main use case of this function is to be used in combination with
the <a href="../../../connectors/out-of-the-box-connectors/agentic-ai-aiagent.md">AI Agent connector</a>.</p>
<p>See the following function overloads for additional function parameters.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">fromAi(value: Any): Any
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">fromAi(toolCall.searchQuery)
// toolCall.searchQuery contents

fromAi(toolCall.userId)
// toolCall.userId contents

fromAi(&quot;A&quot;)
// &quot;A&quot; - does not make much sense and might be flagged as an error by the integration consuming the definition
</code></pre>
`},{name:"fromAi",type:"function",params:[{name:"value"},{name:"description"}],info:`<p><em>Camunda Extension</em></p>
<p>Returns the unmodified <code>value</code> parameter.</p>
<p>In addition to the previous overload, it also accepts an optional <code>description</code> parameter to provide a textual description of the value.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">fromAi(value: Any, description: string): Any
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">fromAi(toolCall.searchQuery, &quot;The search query used to find the best match.&quot;)
// toolCall.searchQuery contents

fromAi(toolCall.searchQuery, null)
// toolCall.searchQuery contents
</code></pre>
`},{name:"fromAi",type:"function",params:[{name:"value"},{name:"description"},{name:"type"}],info:`<p><em>Camunda Extension</em></p>
<p>Returns the unmodified <code>value</code> parameter.</p>
<p>In addition to the previous overload, it also accepts an optional <code>type</code> parameter to provide type information about the value.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">fromAi(value: Any, description: string, type: string): Any
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">fromAi(toolCall.searchQuery, &quot;The search query used to find the best match.&quot;, &quot;string&quot;)
// toolCall.searchQuery contents

fromAi(toolCall.userId, &quot;The user&#39;s ID&quot;, &quot;number&quot;)
// toolCall.userId contents

fromAi(toolCall.userId, null, &quot;number&quot;)
// toolCall.userId contents

fromAi(value: toolCall.userId, type: &quot;number&quot;)
// toolCall.userId contents
</code></pre>
`},{name:"fromAi",type:"function",params:[{name:"value"},{name:"description"},{name:"type"},{name:"schema"}],info:`<p><em>Camunda Extension</em></p>
<p>Returns the unmodified <code>value</code> parameter.</p>
<p>In addition to the previous overload, it also accepts an optional <code>schema</code> parameter to provide a (partial) <a href="https://json-schema.org/">JSON schema</a> for the value.</p>
<ul>
<li>The schema is not validated by the FEEL engine but might be by a custom integration consuming the information.</li>
<li>From the engine side it is possible to specify both a <code>type</code> and a <code>schema</code>, and it depends on the integration as to which value takes precedence.</li>
</ul>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">fromAi(value: Any, description: string, type: string, schema: context): Any
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">fromAi(toolCall.documentType, &quot;The document type to provide&quot;, &quot;string&quot;, {
  enum: [&quot;invoice&quot;, &quot;receipt&quot;, &quot;contract&quot;]
})
// toolCall.documentType contents

fromAi(value: toolCall.documentType, description: &quot;The document type to provide&quot;, schema: {
  type: &quot;string&quot;,
  enum: [&quot;invoice&quot;, &quot;receipt&quot;, &quot;contract&quot;]
})
// toolCall.documentType contents

fromAi(toolCall.tags, &quot;Tags to apply to the blog post&quot;, &quot;array&quot;, {
  items: {
    type: &quot;string&quot;
  }
})
// toolCall.tags contents
</code></pre>
`},{name:"fromAi",type:"function",params:[{name:"value"},{name:"description"},{name:"type"},{name:"schema"},{name:"options"}],info:`<p><em>Camunda Extension</em></p>
<p>Returns the unmodified <code>value</code> parameter.</p>
<p>In addition to the previous overload, it also accepts an optional <code>options</code> parameter to provide additional options for the integration handling the value definition.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">fromAi(value: Any, description: string, type: string, schema: context, options: context): Any
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">fromAi(toolCall.documentType, &quot;The document type to provide&quot;, &quot;string&quot;, null, {
  strict: true,
  required: false
})
// toolCall.documentType contents

fromAi(value: toolCall.documentType, options: {
  strict: true,
  required: false
})
// toolCall.documentType contents
</code></pre>
`},{name:"decimal",type:"function",params:[{name:"n"},{name:"scale"}],info:`<p>Rounds the given value at the given scale.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">decimal(n: number, scale: number): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">decimal(1/3, 2)
// .33

decimal(1.5, 0)
// 2
</code></pre>
`},{name:"floor",type:"function",params:[{name:"n"}],info:`<p>Rounds the given value with rounding mode flooring.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">floor(n: number): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">floor(1.5)
// 1

floor(-1.5)
// -2
</code></pre>
`},{name:"floor",type:"function",params:[{name:"n"},{name:"scale"}],info:`<p>Rounds the given value with rounding mode flooring at the given scale.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">floor(n: number, scale: number): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">floor(-1.56, 1)
// -1.6
</code></pre>
`},{name:"ceiling",type:"function",params:[{name:"n"}],info:`<p>Rounds the given value with rounding mode ceiling.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">ceiling(n: number): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">ceiling(1.5)
// 2

ceiling(-1.5)
// -1
</code></pre>
`},{name:"ceiling",type:"function",params:[{name:"n"},{name:"scale"}],info:`<p>Rounds the given value with rounding mode ceiling at the given scale.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">ceiling(n: number, scale: number): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">ceiling(-1.56, 1)
// -1.5
</code></pre>
`},{name:"round up",type:"function",params:[{name:"n"},{name:"scale"}],info:`<p>Rounds the given value with the rounding mode round-up at the given scale.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">round up(n: number, scale: number): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">round up(5.5)
// 6

round up(-5.5)
// -6

round up(1.121, 2)
// 1.13

round up(-1.126, 2)
// -1.13
</code></pre>
`},{name:"round down",type:"function",params:[{name:"n"},{name:"scale"}],info:`<p>Rounds the given value with the rounding mode round-down at the given scale.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">round down(n: number, scale: number): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">round down(5.5, 0)
// 5

round down (-5.5, 0)
// -5

round down (1.121, 2)
// 1.12

round down (-1.126, 2)
// -1.12
</code></pre>
`},{name:"round half up",type:"function",params:[{name:"n"},{name:"scale"}],info:`<p>Rounds the given value with the rounding mode round-half-up at the given scale.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">round half up(n: number, scale: number): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">round half up(5.5, 0)
// 6

round half up(-5.5, 0)
// -6

round half up(1.121, 2)
// 1.12

round half up(-1.126, 2)
// -1.13
</code></pre>
`},{name:"round half down",type:"function",params:[{name:"n"},{name:"scale"}],info:`<p>Rounds the given value with the rounding mode round-half-down at the given scale.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">round half down(n: number, scale: number): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">round half down (5.5, 0)
// 5

round half down (-5.5, 0)
// -5

round half down (1.121, 2)
// 1.12

round half down (-1.126, 2)
// -1.13
</code></pre>
`},{name:"abs",type:"function",params:[{name:"number"}],info:`<p>Returns the absolute value of the given numeric value.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">abs(number: number): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">abs(10)
// 10

abs(-10)
// 10
</code></pre>
`},{name:"modulo",type:"function",params:[{name:"dividend"},{name:"divisor"}],info:`<p>Returns the remainder of the division of dividend by divisor.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">modulo(dividend: number, divisor: number): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">modulo(12, 5)
// 2
</code></pre>
`},{name:"sqrt",type:"function",params:[{name:"number"}],info:`<p>Returns the square root of the given value.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">sqrt(number: number): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">sqrt(16)
// 4
</code></pre>
`},{name:"log",type:"function",params:[{name:"number"}],info:`<p>Returns the natural logarithm (base e) of the given value.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">log(number: number): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">log(10)
// 2.302585092994046
</code></pre>
`},{name:"exp",type:"function",params:[{name:"number"}],info:`<p>Returns the Eulers number e raised to the power of the given number .</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">exp(number: number): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">exp(5)
// 148.4131591025766
</code></pre>
`},{name:"odd",type:"function",params:[{name:"number"}],info:`<p>Returns <code>true</code> if the given value is odd. Otherwise, returns <code>false</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">odd(number: number): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">odd(5)
// true

odd(2)
// false
</code></pre>
`},{name:"even",type:"function",params:[{name:"number"}],info:`<p>Returns <code>true</code> if the given is even. Otherwise, returns <code>false</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">even(number: number): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">even(5)
// false

even(2)
// true
</code></pre>
`},{name:"random number",type:"function",params:[],info:`<p><em>Camunda Extension</em></p>
<p>Returns a random number between <code>0</code> and <code>1</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">random number(): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">random number()
// 0.9701618132579795
</code></pre>
`},{name:"before",type:"function",params:[{name:"point1"},{name:"point2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">before(point1: Any, point2: Any): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">before(1, 10)
// true

before(10, 1)
// false
</code></pre>
`},{name:"before",type:"function",params:[{name:"range"},{name:"point"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">before(range: range, point: Any): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">before([1..5], 10)
// true
</code></pre>
`},{name:"before",type:"function",params:[{name:"point"},{name:"range"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">before(point: Any, range: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">before(1, [2..5])
// true
</code></pre>
`},{name:"before",type:"function",params:[{name:"range1"},{name:"range2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">before(range1: range, range2: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">before([1..5], [6..10])
// true

before([1..5),[5..10])
// true
</code></pre>
`},{name:"after",type:"function",params:[{name:"point1"},{name:"point2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">after(point1: Any, point2: Any): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">after(10, 1)
// true

after(1, 10)
// false
</code></pre>
`},{name:"after",type:"function",params:[{name:"range"},{name:"point"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">after(range: range, point: Any): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">after([1..5], 10)
// false
</code></pre>
`},{name:"after",type:"function",params:[{name:"point"},{name:"range"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">after(point: Any, range: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">after(12, [2..5])
// true
</code></pre>
`},{name:"after",type:"function",params:[{name:"range1"},{name:"range2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">after(range1: range, range2: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">after([6..10], [1..5])
// true

after([5..10], [1..5))
// true
</code></pre>
`},{name:"meets",type:"function",params:[{name:"range1"},{name:"range2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">meets(range1: range, range2: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">meets([1..5], [5..10])
// true

meets([1..3], [4..6])
// false

meets([1..3], [3..5])
// true

meets([1..5], (5..8])
// false
</code></pre>
`},{name:"met by",type:"function",params:[{name:"range1"},{name:"range2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">met by(range1: range, range2: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">met by([5..10], [1..5])
// true

met by([3..4], [1..2])
// false

met by([3..5], [1..3])
// true

met by((5..8], [1..5))
// false

met by([5..10], [1..5))
// false
</code></pre>
`},{name:"overlaps",type:"function",params:[{name:"range1"},{name:"range2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">overlaps(range1: range, range2: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">overlaps([5..10], [1..6])
// true

overlaps((3..7], [1..4])
// true

overlaps([1..3], (3..6])
// false

overlaps((5..8], [1..5))
// false

overlaps([4..10], [1..5))
// true
</code></pre>
`},{name:"overlaps before",type:"function",params:[{name:"range1"},{name:"range2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">overlaps before(range1: range, range2: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">overlaps before([1..5], [4..10])
// true

overlaps before([3..4], [1..2])
// false

overlaps before([1..3], (3..5])
// false

overlaps before([1..5), (3..8])
// true

overlaps before([1..5), [5..10])
// false
</code></pre>
`},{name:"overlaps after",type:"function",params:[{name:"range1"},{name:"range2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">overlaps after(range1: range, range2: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">overlaps after([4..10], [1..5])
// true

overlaps after([3..4], [1..2])
// false

overlaps after([3..5], [1..3))
// false

overlaps after((5..8], [1..5))
// false

overlaps after([4..10], [1..5))
// true
</code></pre>
`},{name:"finishes",type:"function",params:[{name:"point"},{name:"range"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">finishes(point: Any, range: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">finishes(5, [1..5])
// true

finishes(10, [1..7])
// false
</code></pre>
`},{name:"finishes",type:"function",params:[{name:"range1"},{name:"range2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">finishes(range1: range, range2: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">finishes([3..5], [1..5])
// true

finishes((1..5], [1..5))
// false

finishes([5..10], [1..10))
// false
</code></pre>
`},{name:"finished by",type:"function",params:[{name:"range"},{name:"point"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">finished by(range: range, point: Any): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">finished by([5..10], 10)
// true

finished by([3..4], 2)
// false
</code></pre>
`},{name:"finished by",type:"function",params:[{name:"range1"},{name:"range2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">finished by(range1: range, range2: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">finished by([1..5], [3..5])
// true

finished by((5..8], [1..5))
// false

finished by([5..10], (1..10))
// false
</code></pre>
`},{name:"includes",type:"function",params:[{name:"range"},{name:"point"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">includes(range: range, point: Any): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">includes([5..10], 6)
// true

includes([3..4], 5)
// false
</code></pre>
`},{name:"includes",type:"function",params:[{name:"range1"},{name:"range2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">includes(range1: range, range2: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">includes([1..10], [4..6])
// true

includes((5..8], [1..5))
// false

includes([1..10], [1..5))
// true
</code></pre>
`},{name:"during",type:"function",params:[{name:"point"},{name:"range"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">during(point: Any, range: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">during(5, [1..10])
// true

during(12, [1..10])
// false

during(1, (1..10])
// false
</code></pre>
`},{name:"during",type:"function",params:[{name:"range1"},{name:"range2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">during(range1: range, range2: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">during([4..6], [1..10))
// true

during((1..5], (1..10])
// true
</code></pre>
`},{name:"starts",type:"function",params:[{name:"point"},{name:"range"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">starts(point: Any, range: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">starts(1, [1..5])
// true

starts(1, (1..8])
// false
</code></pre>
`},{name:"starts",type:"function",params:[{name:"range1"},{name:"range2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">starts(range1: range, range2: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">starts((1..5], [1..5])
// false

starts([1..10], [1..5])
// false

starts((1..5), (1..10))
// true
</code></pre>
`},{name:"started by",type:"function",params:[{name:"range"},{name:"point"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">started by(range: range, point: Any): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">started by([1..10], 1)
// true

started by((1..10], 1)
// false
</code></pre>
`},{name:"started by",type:"function",params:[{name:"range1"},{name:"range2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">started by(range1: range, range2: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">started by([1..10], [1..5])
// true

started by((1..10], [1..5))
// false

started by([1..10], [1..10))
// true
</code></pre>
`},{name:"coincides",type:"function",params:[{name:"point1"},{name:"point2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">coincides(point1: Any, point2: Any): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">coincides(5, 5)
// true

coincides(3, 4)
// false
</code></pre>
`},{name:"coincides",type:"function",params:[{name:"range1"},{name:"range2"}],info:`<p><strong>Function signature</strong></p>
<pre><code class="language-feel">coincides(range1: range, range2: range): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">coincides([1..5], [1..5])
// true

coincides((1..5], [1..5))
// false

coincides([1..5], [2..6])
// false
</code></pre>
`},{name:"substring",type:"function",params:[{name:"string"},{name:"start position"}],info:`<p>Returns a substring of the given value starting at <code>start position</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">substring(string: string, start position: number): string
</code></pre>
<p>The <code>start position</code> starts at the index <code>1</code>. The last position is <code>-1</code>.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">substring(&quot;foobar&quot;, 3)
// &quot;obar&quot;

substring(&quot;foobar&quot;, -2)
// &quot;ar&quot;
</code></pre>
`},{name:"substring",type:"function",params:[{name:"string"},{name:"start position"},{name:"length"}],info:`<p>Returns a substring of the given value, starting at <code>start position</code> with the given <code>length</code>. If <code>length</code> is greater than
the remaining characters of the value, it returns all characters from <code>start position</code> until the end.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">substring(string: string, start position: number, length: number): string
</code></pre>
<p>The <code>start position</code> starts at the index <code>1</code>. The last position is <code>-1</code>.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">substring(&quot;foobar&quot;, 3, 3)
// &quot;oba&quot;

substring(&quot;foobar&quot;, -3, 2)
// &quot;ba&quot;

substring(&quot;foobar&quot;, 3, 10)
// &quot;obar&quot;
</code></pre>
`},{name:"string length",type:"function",params:[{name:"string"}],info:`<p>Returns the number of characters in the given value.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">string length(string: string): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">string length(&quot;foo&quot;)
// 3
</code></pre>
`},{name:"upper case",type:"function",params:[{name:"string"}],info:`<p>Returns the given value with all characters are uppercase.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">upper case(string: string): string
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">upper case(&quot;aBc4&quot;)
// &quot;ABC4&quot;
</code></pre>
`},{name:"lower case",type:"function",params:[{name:"string"}],info:`<p>Returns the given value with all characters are lowercase.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">lower case(string: string): string
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">lower case(&quot;aBc4&quot;)
// &quot;abc4&quot;
</code></pre>
`},{name:"substring before",type:"function",params:[{name:"string"},{name:"match"}],info:`<p>Returns a substring of the given value that contains all characters before <code>match</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">substring before(string: string, match: string): string
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">substring before(&quot;foobar&quot;, &quot;bar&quot;)
// &quot;foo&quot;
</code></pre>
`},{name:"substring after",type:"function",params:[{name:"string"},{name:"match"}],info:`<p>Returns a substring of the given value that contains all characters after <code>match</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">substring after(string: string, match: string): string
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">substring after(&quot;foobar&quot;, &quot;ob&quot;)
// &quot;ar&quot;
</code></pre>
`},{name:"contains",type:"function",params:[{name:"string"},{name:"match"}],info:`<p>Returns <code>true</code> if the given value contains the substring <code>match</code>. Otherwise, returns <code>false</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">contains(string: string, match: string): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">contains(&quot;foobar&quot;, &quot;of&quot;)
// false
</code></pre>
`},{name:"starts with",type:"function",params:[{name:"string"},{name:"match"}],info:`<p>Returns <code>true</code> if the given value starts with the substring <code>match</code>. Otherwise, returns <code>false</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">starts with(string: string, match: string): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">starts with(&quot;foobar&quot;, &quot;fo&quot;)
// true
</code></pre>
`},{name:"ends with",type:"function",params:[{name:"string"},{name:"match"}],info:`<p>Returns <code>true</code> if the given value ends with the substring <code>match</code>. Otherwise, returns <code>false</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">ends with(string: string, match: string): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">ends with(&quot;foobar&quot;, &quot;r&quot;)
// true
</code></pre>
`},{name:"matches",type:"function",params:[{name:"input"},{name:"pattern"}],info:`<p>Returns <code>true</code> if the given value matches the <code>pattern</code>. Otherwise, returns <code>false</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">matches(input: string, pattern: string): boolean
</code></pre>
<p>The <code>pattern</code> is a string that contains a regular expression.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">matches(&quot;foobar&quot;, &quot;^fo*bar&quot;)
// true
</code></pre>
`},{name:"matches",type:"function",params:[{name:"input"},{name:"pattern"},{name:"flags"}],info:`<p>Returns <code>true</code> if the given value matches the <code>pattern</code>. Otherwise, returns <code>false</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">matches(input: string, pattern: string, flags: string): boolean
</code></pre>
<p>The <code>pattern</code> is a string that contains a regular expression.</p>
<p>The <code>flags</code> can contain one or more of the following characters:</p>
<ul>
<li><code>s</code> (dot-all)</li>
<li><code>m</code> (multi-line)</li>
<li><code>i</code> (case insensitive)</li>
<li><code>x</code> (comments)</li>
</ul>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">matches(&quot;FooBar&quot;, &quot;foo&quot;, &quot;i&quot;)
// true
</code></pre>
`},{name:"replace",type:"function",params:[{name:"input"},{name:"pattern"},{name:"replacement"}],info:`<p>Returns the resulting string after replacing all occurrences of <code>pattern</code> with <code>replacement</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">replace(input: string, pattern: string, replacement: string): string
</code></pre>
<p>The <code>pattern</code> is a string that contains a regular expression.</p>
<p>The <code>replacement</code> can access the match groups by using <code>$</code> and the number of the group, for example,
<code>$1</code> to access the first group.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">replace(&quot;abcd&quot;, &quot;(ab)|(a)&quot;, &quot;[1=$1][2=$2]&quot;)
// &quot;[1=ab][2=]cd&quot;

replace(&quot;0123456789&quot;, &quot;(\\d{3})(\\d{3})(\\d{4})&quot;, &quot;($1) $2-$3&quot;)
// &quot;(012) 345-6789&quot;
</code></pre>
`},{name:"replace",type:"function",params:[{name:"input"},{name:"pattern"},{name:"replacement"},{name:"flags"}],info:`<p>Returns the resulting string after replacing all occurrences of <code>pattern</code> with <code>replacement</code>.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">replace(input: string, pattern: string, replacement: string, flags: string): string
</code></pre>
<p>The <code>pattern</code> is a string that contains a regular expression.</p>
<p>The <code>replacement</code> can access the match groups by using <code>$</code> and the number of the group, for example,
<code>$1</code> to access the first group.</p>
<p>The <code>flags</code> can contain one or more of the following characters:</p>
<ul>
<li><code>s</code> (dot-all)</li>
<li><code>m</code> (multi-line)</li>
<li><code>i</code> (case insensitive)</li>
<li><code>x</code> (comments)</li>
</ul>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">replace(&quot;How do you feel?&quot;, &quot;Feel&quot;, &quot;FEEL&quot;, &quot;i&quot;)
// &quot;How do you FEEL?&quot;
</code></pre>
`},{name:"split",type:"function",params:[{name:"string"},{name:"delimiter"}],info:`<p>Splits the given value into a list of substrings, breaking at each occurrence of the <code>delimiter</code> pattern.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">split(string: string, delimiter: string): list&lt;string&gt;
</code></pre>
<p>The <code>delimiter</code> is a string that contains a regular expression.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">split(&quot;John Doe&quot;, &quot;\\s&quot; )
// [&quot;John&quot;, &quot;Doe&quot;]

split(&quot;a;b;c;;&quot;, &quot;;&quot;)
// [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;&quot;, &quot;&quot;]
</code></pre>
`},{name:"extract",type:"function",params:[{name:"string"},{name:"pattern"}],info:`<p><em>Camunda Extension</em></p>
<p>Returns all matches of the pattern in the given string. Returns an empty list if the pattern doesn&#39;t
match.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">extract(string: string, pattern: string): list&lt;string&gt;
</code></pre>
<p>The <code>pattern</code> is a string that contains a regular expression.</p>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">extract(&quot;references are 1234, 1256, 1378&quot;, &quot;12[0-9]*&quot;)
// [&quot;1234&quot;,&quot;1256&quot;]
</code></pre>
`},{name:"trim",type:"function",params:[{name:"string"}],info:`<p><em>Camunda Extension</em></p>
<p>Returns the given string without leading and trailing spaces.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">trim(string: string): string
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">trim(&quot;  hello world  &quot;)
// &quot;hello world&quot;

trim(&quot;hello   world &quot;)
// &quot;hello   world&quot;
</code></pre>
`},{name:"uuid",type:"function",params:[],info:`<p><em>Camunda Extension</em></p>
<p>Returns a UUID (Universally Unique Identifier) with 36 characters.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">uuid(): string
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">uuid()
// &quot;7793aab1-d761-4d38-916b-b7270e309894&quot;
</code></pre>
`},{name:"to base64",type:"function",params:[{name:"value"}],info:`<p><em>Camunda Extension</em></p>
<p>Returns the given string encoded in Base64 format.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">to base64(value: string): string
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">to base64(&quot;FEEL&quot;)
// &quot;RkVFTA==&quot;
</code></pre>
`},{name:"is blank",type:"function",params:[{name:"string"}],info:`<p><em>Camunda Extension</em></p>
<p>Returns <code>true</code> if the given string is blank (empty or contains only whitespaces).</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">is blank(string: string): boolean
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">is blank(&quot;&quot;)
// true

is blank(&quot; &quot;)
// true

is blank(&quot;hello world&quot;)
// false
</code></pre>
`},{name:"now",type:"function",params:[],info:`<p>Returns the current date and time including the timezone.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">now(): date and time
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">now()
// date and time(&quot;2020-07-31T14:27:30@Europe/Berlin&quot;)
</code></pre>
`},{name:"today",type:"function",params:[],info:`<p>Returns the current date.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">today(): date
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">today()
// date(&quot;2020-07-31&quot;)
</code></pre>
`},{name:"day of week",type:"function",params:[{name:"date"}],info:`<p>Returns the day of the week according to the Gregorian calendar. Note that it always returns the English name of the day.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">day of week(date: date): string
</code></pre>
<pre><code class="language-feel">day of week(date: date and time): string
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">day of week(date(&quot;2019-09-17&quot;))
// &quot;Tuesday&quot;

day of week(date and time(&quot;2019-09-17T12:00:00&quot;))
// &quot;Tuesday&quot;
</code></pre>
`},{name:"day of year",type:"function",params:[{name:"date"}],info:`<p>Returns the Gregorian number of the day within the year.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">day of year(date: date): number
</code></pre>
<pre><code class="language-feel">day of year(date: date and time): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">day of year(date(&quot;2019-09-17&quot;))
// 260

day of year(date and time(&quot;2019-09-17T12:00:00&quot;))
// 260
</code></pre>
`},{name:"week of year",type:"function",params:[{name:"date"}],info:`<p>Returns the Gregorian number of the week within the year, according to ISO 8601.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">week of year(date: date): number
</code></pre>
<pre><code class="language-feel">week of year(date: date and time): number
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">week of year(date(&quot;2019-09-17&quot;))
// 38

week of year(date and time(&quot;2019-09-17T12:00:00&quot;))
// 38
</code></pre>
`},{name:"month of year",type:"function",params:[{name:"date"}],info:`<p>Returns the month of the year according to the Gregorian calendar. Note that it always returns the English name of the month.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">month of year(date: date): string
</code></pre>
<pre><code class="language-feel">month of year(date: date and time): string
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">month of year(date(&quot;2019-09-17&quot;))
// &quot;September&quot;

month of year(date and time(&quot;2019-09-17T12:00:00&quot;))
// &quot;September&quot;
</code></pre>
`},{name:"abs",type:"function",params:[{name:"n"}],info:`<p>Returns the absolute value of a given duration.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">abs(n: days and time duration): days and time duration
</code></pre>
<pre><code class="language-feel">abs(n: years and months duration): years and months duration
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">abs(duration(&quot;-PT5H&quot;))
// &quot;duration(&quot;PT5H&quot;)&quot;

abs(duration(&quot;PT5H&quot;))
// &quot;duration(&quot;PT5H&quot;)&quot;

abs(duration(&quot;-P2M&quot;))
// duration(&quot;P2M&quot;)
</code></pre>
`},{name:"last day of month",type:"function",params:[{name:"date"}],info:`<p><em>Camunda Extension</em></p>
<p>Takes the month of the given date or date-time value and returns the last day of this month.</p>
<p><strong>Function signature</strong></p>
<pre><code class="language-feel">last day of month(date: date): date
</code></pre>
<pre><code class="language-feel">last day of month(date: date and time): date
</code></pre>
<p><strong>Examples</strong></p>
<pre><code class="language-feel">last day of month(date(&quot;2022-10-01&quot;))
// date(&quot;2022-10-31&quot;))

last day of month(date and time(&quot;2022-10-16T12:00:00&quot;))
// date(&quot;2022-10-31&quot;))
</code></pre>
`}];var NPe=[Kke(bPe())];const OPe=et.theme({"& .cm-content":{padding:"0px"},"& .cm-line":{padding:"0px"},"&.cm-editor.cm-focused":{outline:"none"},"& .cm-completionInfo":{whiteSpace:"pre-wrap",overflow:"hidden",textOverflow:"ellipsis"},"&.cm-editor":{height:"100%"},"& .cm-completionInfo > *":{whiteSpace:"normal"},"& .cm-completionInfo ul":{margin:0,paddingLeft:"15px"},"& .cm-completionInfo pre":{marginBottom:0,whiteSpace:"pre-wrap"},"& .cm-completionInfo p":{marginTop:0},"& .cm-completionInfo p:not(:last-of-type)":{marginBottom:0}}),RPe=et.baseTheme({"& .variableName":{color:"#10f"},"& .number":{color:"#164"},"& .string":{color:"#a11"},"& .bool":{color:"#219"},"& .function":{color:"#aa3731",fontWeight:"bold"},"& .control":{color:"#708"}}),APe=kCe(u1.define([{tag:ge.variableName,class:"variableName"},{tag:ge.name,class:"variableName"},{tag:ge.number,class:"number"},{tag:ge.string,class:"string"},{tag:ge.bool,class:"bool"},{tag:ge.function(ge.variableName),class:"function"},{tag:ge.function(ge.special(ge.variableName)),class:"function"},{tag:ge.controlKeyword,class:"control"},{tag:ge.operatorKeyword,class:"control"}]));var IPe=[OPe,RPe,APe];function o5(t){return t&&t.from===t.to}function DPe(t,e){const n=t.nextSibling;return o5(t)||n&&n.from===e&&o5(n)}function $Pe(t){return t&&t.parent&&t.parent.name==="VariableName"}function VN(t){return t?t.name==="PathExpression"?!0:VN(t.parent):!1}function MPe({variables:t}){return e=>{const n=Qr(e.state).resolve(e.pos,-1);if(!VN(n))return null;const r=LPe(n),i=n===r?e.pos:n.from,s=qN(r,e);let o=t;for(var a=0;a<s.length-1;a++){var l=o.find(h=>h.name===s[a].name);if(!l||l.isList!=="optional"&&!!l.isList!==s[a].isList)return null;o=l.entries}if(!o)return null;const c=o.map(h=>({label:h.name,type:"variable",info:h.info,detail:h.detail}));return{from:i,options:c}}}function LPe(t){for(;t;){if(t.name==="PathExpression")return t;t=t.parent}}function qN(t,e){let n=[];for(let r=t.firstChild;r;r=r.nextSibling)r.name==="PathExpression"?n.push(...qN(r,e)):r.name==="FilterExpression"?n.push(...BPe(r,e)):n.push({name:_7(r,e),isList:!1});return n}function BPe(t,e){const n=t.firstChild;if(n.name==="PathExpression"){const r=qN(n,e),i=r[r.length-1];return i.isList=!0,r}return[{name:_7(n,e),isList:!0}]}function _7(t,e){return e.state.sliceDoc(t.from,t.to)}function FPe({variables:t=[],builtins:e=[]}){const n=zPe(t,e);return n.length?r=>{const{pos:i,state:s}=r,o=Qr(s).resolve(i,-1);return DPe(o,i)?r.explicit?{from:i,options:n}:null:!$Pe(o)||VN(o)?null:{from:o.from,options:n}}:r=>null}function zPe(t,e){return[].concat(t.map(n=>a5(n)),e.map(n=>a5(n)))}function a5(t,e){return t.type==="function"?HPe(t,e):{label:t.name,type:"variable",info:t.info,detail:t.detail,boost:e}}function HPe(t,e){const{name:n,info:r,detail:i,params:s=[]}=t,o=s.map(({name:d,type:h},p)=>({name:d||`param ${p+1}`,type:h})),a=`${n}(${o.map(d=>"${"+d.name+"}").join(", ")})`,l=o.map(({name:d,type:h})=>h?`${d}: ${h}`:d).join(", "),c=`${n}(${l})`;return ma(a,{label:c,type:"function",info:r,detail:i,boost:e})}function UPe({variables:t=[],builtins:e=[]}){return[MPe({variables:t}),FPe({variables:t,builtins:e}),d1(v7),...y7]}function VPe(t){return PPe(t)}function qPe(t){return t.slice().reverse().reduce((e,n)=>(e[n.name]=()=>{},e),{})}const E7=it.define(),S7=it.define(),C7=it.define(),j7=it.define();function k7({dialect:t="expression",parserDialect:e,variables:n=[],builtins:r=[],completions:i=UPe({builtins:r,variables:n})}){const s=qPe([...n,...r]);return[C7.of(t),E7.of(r),S7.of(n),j7.of(e),VPe({dialect:t,parserDialect:e,context:s,completions:i})]}function WPe(t){const e=t.facet(E7)[0],n=t.facet(S7)[0],r=t.facet(C7)[0],i=t.facet(j7)[0];return{builtins:e,variables:n,dialect:r,parserDialect:i}}const GPe=TPe.map(t=>({...t,info:()=>bt(t.info)})),P7=new Yf,T7=new Yf;function Jf({extensions:t=[],dialect:e="expression",parserDialect:n,container:r,contentAttributes:i={},tooltipContainer:s,onChange:o=()=>{},onKeyDown:a=()=>{},onLint:l=()=>{},placeholder:c="",readOnly:d=!1,value:h="",builtins:p=GPe,variables:f=[]}){const m=et.updateListener.of(y=>{y.docChanged&&o(y.state.doc.toString())}),g=et.updateListener.of(y=>{const w=y.transactions.flatMap(S=>S.effects).filter(S=>S.is(m1));if(!w.length)return;const E=w.flatMap(S=>S.value);l(E)}),v=et.domEventHandlers({keydown:a});typeof s=="string"&&(s=document.querySelector(s));const b=s?BSe({tooltipSpace:function(){return s.getBoundingClientRect()}}):[],x=[Dje(),P7.of(k7({dialect:e,builtins:p,variables:f,parserDialect:n})),$Ce(),SCe(),Cje(),et.contentAttributes.of(i),m,v,o1.of([...Bke]),NPe,g,b,T7.of(nW(c)),IPe,...t];return d&&x.push(et.editable.of(!1)),this._cmEditor=new et({state:gn.create({doc:h,extensions:x}),parent:r}),this}Jf.prototype.setValue=function(t){this._cmEditor.dispatch({changes:{from:0,to:this._cmEditor.state.doc.length,insert:t}})};Jf.prototype.focus=function(t){const e=this._cmEditor;if(e.contentDOM.focus(),e.focus(),typeof t=="number"){const n=e.state.doc.length;e.dispatch({selection:{anchor:t<=n?t:n}})}};Jf.prototype.getSelection=function(){return this._cmEditor.state.selection};Jf.prototype.setVariables=function(t){const e=WPe(this._cmEditor.state);this._cmEditor.dispatch({effects:[P7.reconfigure(k7({...e,variables:t}))]})};Jf.prototype.setPlaceholder=function(t){this._cmEditor.dispatch({effects:T7.reconfigure(nW(t))})};function Fm(t,e,n){return e=KPe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function KPe(t){var e=YPe(t,"string");return typeof e=="symbol"?e:String(e)}function YPe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class WN extends Ve{constructor(e,n){super(e,n),Fm(this,"handleMouseEvent",r=>{r.stopPropagation()}),Fm(this,"handleKeyDownCapture",r=>{if(r.key==="Enter"){if(QPe(this.node)){r.triggeredFromAutocomplete=!0;return}this.props.ctrlForNewline&&!XPe(r)&&r.preventDefault(),this.props.singleLine&&r.preventDefault()}}),Fm(this,"handleKeyDown",r=>{["Enter","Escape"].includes(r.key)&&r.triggeredFromAutocomplete&&r.stopPropagation()}),Fm(this,"handleChange",r=>{var i=this.props.onInput;this.setState({value:r}),i&&i(r)}),Fm(this,"setNode",r=>{this.node=r}),this.node=null,this.editor=null,this.state={value:e.value}}componentDidMount(){this.editor=new Jf({container:this.node,onChange:this.handleChange,value:this.state.value,variables:this.props.variables||[]}),this.node.addEventListener("mousedown",this.handleMouseEvent),this.node.addEventListener("keydown",this.handleKeyDownCapture,!0),this.node.addEventListener("keydown",this.handleKeyDown),this.props.autoFocus&&this.editor.focus(this.state.value.length)}componentDidUpdate(e){var n=this.props.value;e.value!==n&&n!==this.state.value&&this.setState({value:n},()=>{this.editor.setValue(n)}),ZPe(e.variables,this.props.variables)||this.editor.setVariables(this.props.variables)}componentWillUnmount(){this.node.removeEventListener("mousedown",this.handleMouseEvent),this.node.removeEventListener("keydown",this.handleKeyDownCapture,!0),this.node.removeEventListener("keydown",this.handleKeyDown)}render(){return D(1,"div",["literal-expression",this.props.className||""].join(" "),null,1,{onClick:this.handleMouseEvent,onFocusIn:this.props.onFocus,onFocusOut:this.props.onBlur},null,this.setNode)}}function XPe(t){return t.metaKey||t.ctrlKey}function QPe(t){return t.querySelector(".cm-tooltip-autocomplete")}function ZPe(t,e){return JSON.stringify(t)===JSON.stringify(e)}function JPe(t,e,n){return e=eTe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function eTe(t){var e=tTe(t,"string");return typeof e=="symbol"?e:String(e)}function tTe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class nTe extends Ve{constructor(e,n){super(e,n),JPe(this,"handleKeyDown",r=>{r.key==="Enter"&&r.stopPropagation()}),this.translate=n.injector?n.injector.get("translate"):rTe,this.expressionLanguages=n.injector.get("expressionLanguages",!1),this.variableResolver=n.injector.get("variableResolver",!1),this.handleValue=r=>{var i={text:r};this.handleChange(i)},this.handleLabelChange=r=>{var i=r||void 0;this.handleChange({label:i})}}handleChange(e){var n=this.props.onChange;typeof n=="function"&&n(e)}getExpressionEditorComponent(){return this.expressionLanguages&&this.expressionLanguages.getDefault("inputCell").value!=="feel"?tf:WN}_getVariables(){return this.variableResolver&&this.variableResolver.getVariables(this.props.element)}render(){var e=this.props,n=e.label,r=e.text,i=this.getExpressionEditorComponent(),s=this._getVariables();return D(1,"div","context-menu-container ref-input-editor input-edit",[D(1,"div","dms-form-control",Pe(2,tf,{className:"dms-input-label",value:n||"",placeholder:this.translate("Input"),singleLine:!0,onInput:this.handleLabelChange}),2),D(1,"div","dms-form-control",[D(1,"label","dms-label",this.translate("Expression"),0),Pe(2,i,{placeholder:this.translate("Enter expression"),className:["ref-text","dms-input"].join(" "),onInput:this.handleValue,value:r||"",variables:s})],4)],4,{onKeyDown:this.handleKeyDown})}}function rTe(t){return t}var iTe=["label"];function l5(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function c5(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?l5(Object(n),!0).forEach(function(r){Qj(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l5(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function sTe(t,e){if(t==null)return{};var n=oTe(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function oTe(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function Qj(t,e,n){return e=aTe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function aTe(t){var e=lTe(t,"string");return typeof e=="symbol"?e:String(e)}function lTe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class N7 extends Ve{constructor(e,n){super(e,n),Qj(this,"persistChanges",()=>{var r=this.props.context.input,i=this.state.unsaved;if(i){var s=i.label,o=sTe(i,iTe),a={};"label"in i&&(a.label=s),cTe(o)&&(a.inputExpression=o),this.modeling.updateProperties(r,a),this.setState({unsaved:!1})}}),Qj(this,"handleChange",r=>{this.setState({unsaved:c5(c5({},this.state.unsaved),r)},this.persistChanges)}),this.state={},hi(this),this.persistChanges=this.debounceInput(this.persistChanges)}getValue(e){var n=this.props.context.input,r=this.state.unsaved,i=n;return e==="text"&&(i=i.inputExpression),r&&e in r?r[e]:i.get(e)}render(){return Pe(2,nTe,{label:this.getValue("label"),text:this.getValue("text"),element:this.props.context.input,onChange:this.handleChange})}}N7.$inject=["debounceInput","modeling","injector"];function cTe(t){return Object.keys(t).length}class O7{constructor(e,n,r,i){e.onGetComponent("cell",s=>{var o=s.cellType;if(o==="input-header")return R1e}),e.onGetComponent("context-menu",function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(s.contextMenuType==="input-edit")return N7}),r.on("input.edit",s=>{var o=s.event,a=s.input,l=o.target,c=ur(l,"th",!0),d=c.getBoundingClientRect(),h=d.left,p=d.top;n.open({x:h,y:p,align:"bottom-right"},{contextMenuType:"input-edit",input:a})})}}O7.$inject=["components","contextMenu","eventBus","renderer"];function dc(t,e,n){return e=uTe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function uTe(t){var e=dTe(t,"string");return typeof e=="symbol"?e:String(e)}function dTe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class Tr extends Ve{constructor(e,n){super(e,n),dc(this,"onChange",i=>{this.setState({value:i});var s=this.props.onChange;typeof s=="function"&&s(i)}),dc(this,"onInputClick",i=>{i.preventDefault(),i.stopPropagation(),this.setOptionsVisible(!this.state.optionsVisible),this.focusInput()}),dc(this,"onInput",i=>{var s=i.target.value;this.onChange(s)}),dc(this,"onOptionClick",(i,s)=>{s.preventDefault(),s.stopPropagation(),this.setOptionsVisible(!1),this.onChange(i),this.focusInput()}),dc(this,"onFocusChanged",i=>{this.checkClose(i.target)}),dc(this,"onGlobalClick",i=>{this.checkClose(i.target)}),dc(this,"onKeyDown",i=>{var s=this.state.optionsVisible,o=i.which;(o===40||o===38)&&(i.stopPropagation(),i.preventDefault(),s?this.select(o===40?1:-1):this.setOptionsVisible(!0)),s&&(o===13||o===27)&&(i.stopPropagation(),i.preventDefault(),this.setOptionsVisible(!1))}),dc(this,"onKeyboard",i=>{var s=this.state.optionsVisible;if(s&&i===27)return this.setOptionsVisible(!1),!0}),hi(this);var r=e.value;this.state={value:r,optionsVisible:!1},this._portalEl=null}componentDidMount(){document.addEventListener("mousedown",this.onGlobalClick),document.addEventListener("focusin",this.onFocusChanged),this.keyboard.addListener(this.onKeyboard)}componentWillUnmount(){document.removeEventListener("focusin",this.onFocusChanged),document.removeEventListener("mousedown",this.onGlobalClick),this.keyboard.removeListener(this.onKeyboard),this.removePortalEl()}componentWillReceiveProps(e){var n=e.value;this.setState({value:n})}componentWillUpdate(e,n){var r=n.optionsVisible;r?this._portalEl||this.addPortalEl():this._portalEl&&this.removePortalEl()}componentDidUpdate(){var e=this.state.optionsVisible;if(!(!e||!this.inputNode)){var n=this.getOptionsBounds();B(this._portalEl.style,n)}}getOptionsBounds(){var e=this.renderer.getContainer(),n=e.getBoundingClientRect(),r=n.top,i=n.left,s=n.bottom,o=this.inputNode.getBoundingClientRect(),a=o.top,l=o.left,c=o.width,d=o.height,h=o.bottom,p=a+d-r+e.scrollTop,f=l-i+e.scrollLeft,m={top:"".concat(p,"px"),left:"".concat(f,"px"),width:"".concat(c,"px"),"max-height":"calc(100% - ".concat(p,"px)")};if(s-h<d){var g=s-a;m.bottom="".concat(g,"px"),m["max-height"]="calc(100% - ".concat(g,")"),delete m.top}return m}addPortalEl(){this._portalEl=bt('<div class="dms-select-options"></div>');var e=this.renderer.getContainer();e.appendChild(this._portalEl),this._portalEl.addEventListener("mousedown",u5)}removePortalEl(){this._portalEl&&(this._portalEl.removeEventListener("mousedown",u5),Nr(this._portalEl),this._portalEl=null)}focusInput(){var e=this.inputNode;e.focus(),"selectionStart"in e&&(e.selectionStart=1e5)}checkClose(e){this._portalEl&&!this._portalEl.contains(e)&&!this.parentNode.contains(e)&&this.setOptionsVisible(!1)}select(e){var n=this.props.options,r=this.state.value;if(n){var i=n.filter(l=>l.value===r)[0],s=i?n.indexOf(i):-1,o=s===-1?e===1?0:n.length-1:(s+e)%n.length,a=n[o<0?n.length+o:o];this.onChange(a.value)}}setOptionsVisible(e){this.setState({optionsVisible:e})}renderOptions(e,n){return D(1,"div","options",e.map(r=>D(1,"div",["option",n===r?"active":""].join(" "),r.label,0,{"data-value":r.value,onClick:i=>this.onOptionClick(r.value,i)})),0)}render(){var e=this.props,n=e.className,r=e.options,i=e.noInput,s=e.title,o=this.state,a=o.optionsVisible,l=o.value,c=r?r.filter(h=>h.value===l)[0]:!1,d=c?c.label:l;return D(1,"div",[n||"","dms-input-select"].join(" "),[i?D(1,"div","dms-input",d,0,{tabindex:"0",onKeyDown:this.onKeyDown},null,h=>this.inputNode=h):D(64,"input","dms-input",null,1,{onInput:this.onInput,onKeyDown:this.onKeyDown,spellcheck:"false",type:"text",value:l},null,h=>this.inputNode=h),D(1,"span",["dms-input-select-icon",a?"dmn-icon-up":"dmn-icon-down"].join(" ")),a&&Ome(this.renderOptions(r,c),this._portalEl)],0,{title:s,onClick:this.onInputClick},null,h=>this.parentNode=h)}}Tr.$inject=["keyboard","renderer"];function u5(t){t.stopPropagation()}function hTe(t,e,n){return e=pTe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pTe(t){var e=fTe(t,"string");return typeof e=="symbol"?e:String(e)}function fTe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class mTe extends Ve{constructor(e,n){super(e),hTe(this,"onTypeChange",r=>{var i=this.getElement(),s=Y(i,"dmn:LiteralExpression")?i.$parent:i,o;cn(s)?o={inputExpression:{typeRef:r}}:Xr(s)&&(o={typeRef:r}),this._modeling.updateProperties(s,o)}),this._translate=n.injector.get("translate"),this._modeling=n.injector.get("modeling"),this._dataTypes=n.injector.get("dataTypes")}getElement(){return this.props.context.input||this.props.context.output}render(){var e=this.getElement(),n=(Y(e,"dmn:InputClause")?e.inputExpression:e).typeRef,r=this._dataTypes.getAll().map(i=>({label:this._translate(i),value:i}));return D(1,"div","type-ref-edit context-menu-container",D(1,"div","dms-form-control",[D(1,"label","dms-label",[this._translate("Type"),Vn(":")],0),Pe(2,Tr,{className:"type-ref-edit-select",onChange:this.onTypeChange,options:r,value:n})],4),2)}}var gTe=750;class R7{constructor(e){e.onGetComponent("context-menu",gTe,function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.contextMenuType;if(r==="input-edit"||r==="output-edit")return mTe})}}R7.$inject=["components"];const vTe={__depends__:[hh,aN],__init__:["typeRefEditingProvider"],typeRefEditingProvider:["type",R7]};class A7 extends pi{constructor(e,n){super(e),this.postExecuted("element.updateProperties",r=>{var i=r.context,s=i.element,o=i.properties,a=cn(s)?o.inputExpression:o;if(a&&a.typeRef&&a.typeRef!=="string"){var l=Y(s,"dmn:LiteralExpression")?s.$parent:s;n.editAllowedValues(l,null)}})}}A7.$inject=["eventBus","modeling"];function nb(t,e,n){return e=yTe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function yTe(t){var e=xTe(t,"string");return typeof e=="symbol"?e:String(e)}function xTe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var bTe="radio",wTe="remove dmn-icon-clear";class I7 extends Ve{constructor(e,n){super(e,n),nb(this,"getRemoveClickHandler",i=>s=>{s.stopPropagation(),this.removeItem(i)}),nb(this,"getToggleClickHandler",i=>s=>{s.stopPropagation(),this.toggleItem(i)}),nb(this,"removeItem",i=>{var s=this.props.onChange,o=this.state.items.filter(a=>a!==i);this.setState({items:o}),s&&s(o)}),nb(this,"toggleItem",i=>{var s=this.props,o=s.onChange,a=s.type,l=this.state.items.map(c=>(c===i?c.isChecked=!c.isChecked:a===bTe&&(c.isChecked=!1),c));this.setState({items:l}),o&&o(l)});var r=e.items;this.state={items:r}}componentWillReceiveProps(e){var n=e.items;this.setState({items:n})}render(){var e=this.props,n=e.className,r=e.items,i=e.type,s=e.labelComponent,o=["dms-list-component"];n&&o.push(n);var a=Kc(r,"group"),l=_Te(a);return D(1,"div",o.join(" "),l.map(c=>{var d=c[0],h=c[1];return D(1,"div","group",[s&&s(d)||D(1,"h4","dms-heading",d,0),D(1,"ul","items no-wrap",h.map(p=>D(1,"li","item",[i&&D(64,"input","item-toggle",null,1,{type:i,checked:p.isChecked,onClick:this.getToggleClickHandler(p)}),Vn(""),p.value,p.isRemovable&&D(1,"span",wTe,null,1,{title:"Remove item",onClick:this.getRemoveClickHandler(p)})],0)),0)],0)}),0)}}function _Te(t){var e=[];for(var n in t)e.push([n,t[n]]);return e}class so extends Ve{constructor(e,n){super(e,n);var r=e.validate,i=e.value,s=r?r(i||""):void 0;this.state={validationWarning:s,value:i},this.onInput=this.onInput.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this)}componentWillReceiveProps(e){var n=e.validate,r=e.value,i=n?n(r||""):void 0;this.setState({validationWarning:i,value:r})}onInput(e){var n=this.props,r=n.onInput,i=n.validate,s=i?i(e):void 0;this.setState({validationWarning:s,value:e}),typeof r=="function"&&r&&r({isValid:!s,value:e})}onKeyDown(e){var n=e.target,r=n.value,i=this.props,s=i.onKeyDown,o=i.validate,a=o?o(r):void 0;typeof s=="function"&&s({isValid:!a,value:r,event:e})}onKeyUp(e){var n=e.target,r=n.value,i=this.props,s=i.onKeyUp,o=i.validate,a=o?o(r):void 0;typeof s=="function"&&s({isValid:!a,value:r,event:e})}render(){var e=this.props,n=e.placeholder,r=e.type,i=e.className,s=this.state,o=s.validationWarning,a=s.value,l=["dms-validated-input",i].join(" "),c=[];return o&&c.push("invalid"),D(1,"div",l,[Pe(2,Ed,{className:c,onInput:this.onInput,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,placeholder:n||"",type:r,value:a||""}),o&&D(1,"p","dms-hint dms-validation-warning",o,0)],0)}}function yS(t){if(!t||ETe(t.trim()))return{values:[]};var e=t.split(","),n={values:[]},r="";if(e.forEach(i=>{r+=i,/^"[^"]*"$/.test(r.trim())?(n.values.push(r.trim()),r=""):r+=","}),!r)return n}function ETe(t){return t===""}function STe(t){return t.map(e=>e.value)}function Vu(t,e,n){return e=CTe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function CTe(t){var e=jTe(t,"string");return typeof e=="symbol"?e:String(e)}function jTe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}let kTe=class extends Ve{constructor(e,n){super(e,n),Vu(this,"onElementsChanged",()=>{this.forceUpdate()}),Vu(this,"setPredefinedValues",s=>{var o=this.getAllowedValuesTarget();this.setState({values:s}),this._modeling.editAllowedValues(o,s&&STe(s))}),Vu(this,"onListChange",s=>{this.setPredefinedValues(s)}),Vu(this,"onInput",s=>{s.isValid;var o=s.value;this.setState({inputValue:o})}),Vu(this,"onKeyDown",s=>{var o=s.isValid,a=s.event;if(TTe(a.keyCode)&&(a.stopPropagation(),a.preventDefault(),o)){var l=this.state,c=l.inputValue,d=l.values,h=yS(c);this.onListChange((d||[]).concat(h.values.map(p=>({value:p,isCheckable:!1,isRemovable:!0,group:this._translate("Predefined values")})))),this.setState({inputValue:""})}}),Vu(this,"handleRemovePredifinedValuesClick",s=>{s.stopPropagation(),this.removePredefinedValues()}),Vu(this,"removePredefinedValues",()=>{this.setPredefinedValues(null)}),this._translate=n.injector.get("translate"),this._modeling=n.injector.get("modeling"),this._changeSupport=n.changeSupport;var r=this.getAllowedValuesTarget(),i=yS(r.inputValues&&r.inputValues.text||r.outputValues&&r.outputValues.text||"");i?this.state={values:i.values.map(s=>({value:s,isCheckable:!1,isRemovable:!0,group:this._translate("Predefined values")})),inputValue:""}:this.state={values:null,inputValue:""}}componentWillMount(){var e=this.getAllowedValuesTarget();this._changeSupport.onElementsChanged(e.id,this.onElementsChanged)}componentWillUnmount(){var e=this.getAllowedValuesTarget();this._changeSupport.offElementsChanged(e.id,this.onElementsChanged)}getAllowedValuesTarget(){var e=this.getElement();return Y(e,"dmn:LiteralExpression")?e.$parent:e}getElement(){return this.props.context.output||this.props.context.input.inputExpression}render(){var e=this.getElement(),n=this.state,r=n.inputValue,i=n.values;return e.typeRef==="string"?D(1,"div","context-menu-container allowed-values-edit",D(1,"div","dms-form-control",[!xS(i)&&i.length>0&&Pe(2,I7,{labelComponent:PTe,items:i,onChange:this.onListChange}),!xS(i)&&!i.length&&D(1,"div",null,[D(1,"label","dms-label",this._translate("Predefined values"),0),D(1,"span","placeholder",this._translate("No values"),0)],4),!xS(i)&&D(1,"p","dms-hint",D(1,"button","del-values",this._translate("Clear predefined values"),0,{type:"button",onClick:this.handleRemovePredifinedValuesClick}),2),D(1,"label","dms-label",this._translate("Add predefined values"),0),Pe(2,so,{onInput:this.onInput,onKeyDown:this.onKeyDown,placeholder:this._translate('"value", "value", ...'),type:"text",validate:s=>{if(!yS(s))return this._translate("Strings must be in double quotes")},value:r})],0),2):null}};function PTe(t){return D(1,"label","dms-label",t,0)}function TTe(t){return t===13}function xS(t){return t===null}var NTe=500;class D7{constructor(e){e.onGetComponent("context-menu",NTe,function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.contextMenuType;if(r==="input-edit"||r==="output-edit")return kTe})}}D7.$inject=["components"];const OTe={__init__:["allowedValuesUpdateBehavior","allowedValuesEditingProvider"],allowedValuesUpdateBehavior:["type",A7],allowedValuesEditingProvider:["type",D7]};function bS(t,e,n){return e=RTe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function RTe(t){var e=ATe(t,"string");return typeof e=="symbol"?e:String(e)}function ATe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class ITe extends Ve{constructor(e,n){super(e,n),bS(this,"onElementsChanged",()=>{this.forceUpdate()}),bS(this,"handleClick",r=>{r.stopPropagation(),this.add()}),bS(this,"add",()=>{this._eventBus.fire("addInput")}),this._sheet=n.injector.get("sheet"),this._eventBus=n.injector.get("eventBus"),this._changeSupport=n.changeSupport,this._translate=n.injector.get("translate")}componentWillMount(){var e=this.getRoot();this._changeSupport.onElementsChanged(e.id,this.onElementsChanged)}componentWillUnmount(){var e=this.getRoot();this._changeSupport.offElementsChanged(e.id,this.onElementsChanged)}getRoot(){return this._sheet.getRoot()}render(){return D(1,"div","add-input actionable",D(1,"span","dmn-icon-plus action-icon"),2,{onClick:this.handleClick,title:this._translate("Add input")})}}function wS(t,e,n){return e=DTe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function DTe(t){var e=$Te(t,"string");return typeof e=="symbol"?e:String(e)}function $Te(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class MTe extends Ve{constructor(e,n){super(e,n),wS(this,"onElementsChanged",()=>{this.forceUpdate()}),wS(this,"handleClick",r=>{r.stopPropagation(),this.add()}),wS(this,"add",()=>{this._eventBus.fire("addOutput")}),this._sheet=n.injector.get("sheet"),this._eventBus=n.injector.get("eventBus"),this._changeSupport=n.changeSupport,this._translate=n.injector.get("translate")}componentWillMount(){var e=this.getRoot();this._changeSupport.onElementsChanged(e.id,this.onElementsChanged)}componentWillUnmount(){var e=this.getRoot();this._changeSupport.offElementsChanged(e.id,this.onElementsChanged)}getRoot(){return this._sheet.getRoot()}render(){return D(1,"div","add-output actionable",D(1,"span","dmn-icon-plus action-icon"),2,{onClick:this.handleClick,title:this._translate("Add output")})}}function $7(t,e,n){t.onGetComponent("cell-inner",function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=r.cellType,s=r.index,o=r.inputsLength,a=r.outputsLength;if(i==="input-cell"&&s===o-1)return ITe;if(i==="output-cell"&&s===a-1)return MTe}),n.on("addInput",()=>{e.trigger("addInput")}),n.on("addOutput",()=>{e.trigger("addOutput")})}$7.$inject=["components","editorActions","eventBus"];const LTe={__depends__:[Gf],__init__:["addInputOutputProvider"],addInputOutputProvider:["type",$7]};function rb(t,e,n){return e=BTe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function BTe(t){var e=FTe(t,"string");return typeof e=="symbol"?e:String(e)}function FTe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}let M7=class{constructor(e,n,r,i){rb(this,"_init",()=>{this._registerDefaultBindings(),this._fire("init")}),rb(this,"_destroy",()=>{this._fire("destroy"),this.unbind(),this._listeners=null}),rb(this,"_keyHandler",s=>{var o,a,l=this._listeners,c=s.keyCode||s.charCode||-1;for(o=0;a=l[o];o++)if(a(c,s)){s.preventDefault(),s.stopPropagation();return}}),rb(this,"unbind",()=>{var s=this._node;s&&(this._fire("unbind"),ie.unbind(s,"keydown",this._keyHandler)),this._node=null}),this._config=e||{},this._editorActions=r,this._eventBus=n,this._cellSelection=i,this._listeners=[],n.on("table.destroy",this._destroy),n.on("table.init",this._init),n.on("attach",()=>{this._config.bindTo&&this.bind(e.bindTo)}),n.on("detach",this.unbind)}bind(e){this.unbind(),this._node=e,ie.bind(e,"keydown",this._keyHandler),this._fire("bind")}getBinding(){return this._node}_fire(e){this._eventBus.fire("keyboard."+e,{node:this._node,listeners:this._listeners})}_registerDefaultBindings(){var e=this._listeners,n=this._editorActions,r=this._cellSelection;function i(l,c){if(ld(c)&&!cd(c)&&l===90)return n.trigger("undo"),!0}function s(l,c){if(ld(c)&&(l===89||l===90&&cd(c)))return n.trigger("redo"),!0}e.push(i),e.push(s);function o(l,c){if(!(l!==13||ld(c)||!cd(c))&&ij(c.target))return n.trigger("selectCellAbove"),!0}e.push(o);function a(l,c){if(!(l!==13||ld(c)||cd(c))&&ij(c.target)){var d=n.trigger("selectCellBelow"),h=r.getCellSelection();if(!d&&h&&!zTe(h)){var p=n.trigger("addRule");return n.trigger("selectCellBelow"),p}return!0}}e.push(a)}addListener(e){this._listeners.unshift(e)}removeListener(e){this._listeners=this._listeners.filter(n=>n!==e)}};M7.$inject=["config.keyboard","eventBus","editorActions","cellSelection"];function zTe(t){return t==="__decisionProperties_name"}const Wl={__depends__:[Gf],__init__:["keyboard"],keyboard:["type",M7]},HTe={__depends__:[LTe,OTe,hh,dh,uh,Wl,vTe],__init__:["inputEditingProvider","outputEditingProvider"],inputEditingProvider:["type",O7],outputEditingProvider:["type",Lq]};function _S(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const UTe=`.dmn-decision-table-container td,
   .dmn-decision-table-container th`;let L7=class{constructor(e,n,r,i){_S(this,"handleDragOver",s=>{ib(s);const o=s.target,a=ur(o,UTe,!0);let l=!!a;const{hoverEl:c}=this._dragContext;c&&c!==a&&(this._emit("dragAndDrop.dragLeave",s),this._dragContext.targetEl=null,this._dragContext.hoverEl=null),a&&(a!==c&&(this._dragContext.hoverEl=a,l=this._emit("dragAndDrop.dragEnter",s),l!==!1&&(this._dragContext.targetEl=a)),l=this._emit("dragAndDrop.dragOver",s)),s.dataTransfer.dropEffect=l!==!1?"move":"none"}),_S(this,"handleDrop",s=>{ib(s);const o=this._emit("dragAndDrop.drop",s);if(o){const{draggedElement:a}=this._dragContext;if(a instanceof is){const{rows:l}=this._sheet.getRoot();let c=l.indexOf(o);this._modeling.moveRow(a,c)}else if(a instanceof ss){const{cols:l}=this._sheet.getRoot();let c=l.indexOf(o);this._modeling.moveCol(a,c)}}this.handleDragEnd(s)}),_S(this,"handleDragEnd",s=>{ib(s),this._unbindListeners(),this._emit("dragAndDrop.dragEnd",s),this._dragContext=null}),this._eventBus=e,this._renderer=n,this._modeling=r,this._sheet=i,this._dragContext=null,e.on("table.destroy",()=>{this._unbindListeners()})}_bindListeners(){ie.bind(document,"dragover",this.handleDragOver),ie.bind(document,"drop",this.handleDrop),ie.bind(document,"dragend",this.handleDragEnd)}_unbindListeners(){ie.unbind(document,"dragover",this.handleDragOver),ie.unbind(document,"drop",this.handleDrop),ie.unbind(document,"dragend",this.handleDragEnd)}_emit(e,n){return this._eventBus.fire(e,{dragContext:this._dragContext,originalEvent:n})}startDrag(e,n){ib(n,!0),n.dataTransfer.effectAllowed="move",n.dataTransfer.setData&&n.dataTransfer.setData("text","__DUMMY"),this._dragContext={draggedElement:e},this._bindListeners(),this._emit("dragAndDrop.dragStart",n)}};L7.$inject=["eventBus","renderer","modeling","sheet"];function ib(t,e){t.stopPropagation(),e!==!0&&t.preventDefault()}const VTe={__init__:["dragAndDrop"],dragAndDrop:["type",L7]};function qTe(t,e,n){return e=WTe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function WTe(t){var e=GTe(t,"string");return typeof e=="symbol"?e:String(e)}function GTe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var GN="top",KTe="right",YTe="bottom",KN="left";class B7{constructor(e,n,r,i,s,o,a,l){qTe(this,"_cleanup",()=>{var c=this._renderer.getContainer();ES(c),JTe(c),this._dragImage&&(Nr(this._dragImage),this._dragImage=null)}),this._elementRegistry=n,this._dragAndDrop=i,this._renderer=s,this._rules=o,this._sheet=a,this._translate=l,e.onGetComponent("cell-inner",c=>{var d=c.cellType,h=c.col,p=c.row;if(d==="rule-index")return()=>D(1,"span","dmn-icon-drag vertical",Vn(""),2,{draggable:"true",onDragStart:m=>this.startDrag(p,m),title:this._translate("Move rule")});if(d==="input-cell"||d==="output-cell"){var f="Move ".concat(cn(h)?"Input":"Output");return()=>D(1,"span","dmn-icon-drag horizontal",null,1,{draggable:"true",onDragStart:m=>this.startDrag(h,m),title:f})}}),r.on("dragAndDrop.dragEnter",c=>{var d=c.dragContext,h=d.draggedElement,p=d.hoverEl;if(h instanceof is)return!0;if(h instanceof ss){var f=XTe(p,this._elementRegistry,this._sheet);if(f===-1)return!1;var m=this._rules.allowed("col.move",{col:h,index:f});return m}return!1}),r.on("dragAndDrop.dragLeave",c=>{var d=c.dragContext,h=d.targetEl;if(h){var p=this._renderer.getContainer();ES(p)}}),r.on("dragAndDrop.dragOver",c=>{var d=c.dragContext,h=c.originalEvent,p=d.draggedElement,f=d.lastPosition,m=d.targetEl,g=this._renderer.getContainer();if(!m)return!1;var v;return p instanceof is&&(v=f5(h,m)),p instanceof ss&&(v=p5(h,m)),f===v||(ES(g),p instanceof is&&(v===GN?d5(m,g,"top"):d5(m,g,"bottom")),p instanceof ss&&(v===KN?h5(m,g,"left"):h5(m,g,"right")),d.lastPosition=v),!0}),r.on("dragAndDrop.drop",c=>{var d=c.dragContext,h=c.originalEvent,p=d.draggedElement,f=d.targetEl;if(!f)return!1;if(p instanceof is){var m=f5(h,f),g=f.dataset.rowId,v=this._elementRegistry.get(g);if(!v||v===p)return;var b=eNe(p,v,m,this._sheet.getRoot().rows);return b===p?void 0:b}if(p instanceof ss){var x=p5(h,f),y=f.dataset.colId,w=this._elementRegistry.get(y);if(!w||w===p)return;var E=tNe(p,w,x,this._sheet.getRoot().cols);return E===p?void 0:E}}),r.on("dragAndDrop.dragEnd",this._cleanup)}startDrag(e,n){var r=this._renderer.getContainer();this._dragImage=bt(`<span style="
          visibility: hidden;
          position: fixed;
          top: -10000px
      "></span>`),document.body.appendChild(this._dragImage),n.dataTransfer.setDragImage&&n.dataTransfer.setDragImage(this._dragImage,0,0),e instanceof is?QTe(e,r):e instanceof ss&&ZTe(e,r),this._dragAndDrop.startDrag(e,n)}}B7.$inject=["components","elementRegistry","eventBus","dragAndDrop","renderer","rules","sheet","translate"];function XTe(t,e,n){var r=e.get(t.dataset.colId);if(!r)return-1;var i=n.getRoot(),s=i.cols;return s.indexOf(r)}function d5(t,e,n){var r=t.dataset.rowId;if(r){var i=zo("[data-row-id=".concat(r,"]"),e);$(i,s=>{em(s)&&(vt(s).add("dragover"),vt(s).add(n))})}}function h5(t,e,n){var r=t.dataset.colId;if(r){var i=zo("[data-col-id=".concat(r,"]"),e);$(i,s=>{em(s)&&(vt(s).add("dragover"),vt(s).add(n))})}}function ES(t){var e=zo(".dragover",t);$(e,n=>{em(n)&&(vt(n).remove("dragover"),vt(n).remove("top"),vt(n).remove("right"),vt(n).remove("bottom"),vt(n).remove("left"))})}function QTe(t,e){var n=zo("[data-row-id=".concat(t.id,"]"),e);$(n,r=>{em(r)&&vt(r).add("dragged")})}function ZTe(t,e){var n=zo("[data-col-id=".concat(t.id,"]"),e);$(n,r=>{em(r)&&vt(r).add("dragged")})}function JTe(t){var e=zo(".dragged",t);$(e,n=>{em(n)&&vt(n).remove("dragged")})}function p5(t,e){var n=e.getBoundingClientRect();return t.clientX<n.left+n.width/2?KN:KTe}function f5(t,e){var n=e.getBoundingClientRect();return t.clientY<n.top+n.height/2?GN:YTe}function eNe(t,e,n,r){return r.indexOf(t)>r.indexOf(e)&&(e=rNe(e,r)),n===GN?nNe(e,r):e}function tNe(t,e,n,r){return r.indexOf(t)>r.indexOf(e)&&(e=sNe(e,r)),n===KN?iNe(e,r):e}function nNe(t,e){var n=e.indexOf(t);return e[Math.max(0,n-1)]}function rNe(t,e){var n=e.indexOf(t);return e[Math.min(e.length-1,n+1)]}function iNe(t,e){var n=e.indexOf(t);if(Xr(t)){var r=e.filter(s=>Xr(s))[0],i=e.indexOf(r);return e[Math.max(i,n-1)]}return e[Math.max(0,n-1)]}function sNe(t,e){var n=e.indexOf(t);if(cn(t)){var r=e.filter(o=>cn(o)),i=r[r.length-1],s=e.indexOf(i);return e[Math.min(s,n+1)]}return e[Math.min(e.length-1,n+1)]}function em(t){return t&&(t.nodeType===1||t.nodeType==11)}const oNe={__depends__:[VTe,iN],__init__:["dmnDragAndDrop"],dmnDragAndDrop:["type",B7]};function m5(t,e,n){return e=aNe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function aNe(t){var e=lNe(t,"string");return typeof e=="symbol"?e:String(e)}function lNe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class cNe extends Ve{constructor(e,n){super(e,n),m5(this,"onElementsChanged",()=>{this.forceUpdate()}),m5(this,"changeDescription",i=>{this._modeling.updateProperties(this._element,{description:i})}),this._elementRegistry=n.injector.get("elementRegistry"),this._modeling=n.injector.get("modeling"),this._changeSupport=this.context.changeSupport;var r=this.props.context.id;this._element=this._elementRegistry.get(r)}componentWillMount(){this._element&&this._changeSupport.onElementsChanged(this._element.id,this.onElementsChanged)}componentDidMount(){var e=this.props.context.autoFocus;if(e&&this.node){var n=dNe(this.node);n.focus()}}componentWillUnmount(){if(this._element){this._changeSupport.offElementsChanged(this._element.id,this.onElementsChanged);var e=this._element.businessObject,n=e.description;Fi(n)&&!n.length&&this.changeDescription(null)}}render(){if(this._element){var e=this._element.businessObject,n=e.description;if(Fi(n))return D(1,"div","context-menu-container description-editor",Pe(2,uNe,{className:"dms-input",onChange:this.changeDescription,value:n}),2,null,null,r=>this.node=r)}}}let uNe=class extends vy{render(){return D(1,"div",this.getClassName(),this.getEditor(),0)}};function dNe(t){return at(".content-editable",t)}function g5(t,e,n){return e=hNe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function hNe(t){var e=pNe(t,"string");return typeof e=="symbol"?e:String(e)}function pNe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var fNe=500,mNe=750,v5=26;let F7=class{constructor(e,n,r,i,s,o,a){var l=this;g5(this,"addDescription",c=>{this._modeling.updateProperties(c,{description:""});var d=this._renderer.getContainer(),h=ef(c.id,d),p=h.getBoundingClientRect(),f=y5(d,p);this._contextMenu.open(f,{contextMenuType:"cell-description",id:c.id,autoFocus:!0,offset:{x:4,y:4}})}),g5(this,"removeDescription",c=>{this._modeling.updateProperties(c,{description:null}),this._contextMenu.close()}),this._contextMenu=n,this._modeling=s,this._renderer=o,this._translate=a,i.on("cell.click",mNe,c=>{if(!c.defaultPrevented){var d=c.target,h=c.id,p=r.get(h);if(Hi(p,["dmn:UnaryTests","dmn:LiteralExpression"])){var f=x5(p);f||c.preventDefault();var m=o.getContainer(),g=d.getBoundingClientRect(),v=y5(m,g);n.open(v,{contextMenuType:"cell-description",autoFocus:!1,id:h,offset:{x:4,y:4}})}}}),e.onGetComponent("context-menu",function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(c.contextMenuType&&c.contextMenuType==="cell-description"){var d=r.get(c.id),h=x5(d);if(Fi(h))return cNe}}),e.onGetComponent("context-menu-cell-additional",fNe,function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(c.contextMenuType&&c.contextMenuType==="context-menu"){var d=c.id;if(!d)return;var h=r.get(d);if(!h)return;var p=h.businessObject,f=p.description,m=Fi(f),g=m?"remove-description":"add-description",v=m?()=>l.removeDescription(h):()=>l.addDescription(h);return D(1,"div","context-menu-group-entry ".concat(g),Fi(f)?l._translate("Remove cell description"):l._translate("Add cell description"),0,{onClick:v})}})}};F7.$inject=["components","contextMenu","elementRegistry","eventBus","modeling","renderer","translate"];function y5(t,e){var n=e.top,r=e.left,i=e.width,s=e.height;return{x:r+t.parentNode.scrollLeft-v5,y:n+t.parentNode.scrollTop,width:i+2*v5,height:s}}function x5(t){return t&&t.businessObject&&t.businessObject.description}const gNe={__depends__:[hh,nN],__init__:["description"],description:["type",F7]};let z7=class{constructor(e,n,r,i,s,o){var a=this;this._modeling=r,this._translate=s,this._expressionLanguages=i,e.onGetComponent("context-menu-cell-additional",function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(l.contextMenuType&&l.contextMenuType==="context-menu"){var c=l.event,d=l.id;if(!d)return;var h=n.get(d);if(!h||!a._shouldDisplayContextMenuEntry(h))return;var p=f=>{o.open({x:(c||f).pageX,y:(c||f).pageY},{contextMenuType:"expression-language",id:d})};return D(1,"div","context-menu-group-entry",a._translate("Change cell expression language"),0,{onClick:p})}}),e.onGetComponent("context-menu",function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(l.contextMenuType&&l.contextMenuType==="expression-language"){var c=l.id;if(!c)return;var d=n.get(c);if(!d)return;var h=a._getElementExpressionLanguage(d),p=i.getAll(),f="context-menu-group-entry context-menu-entry-set-expression-language";return()=>D(1,"div","context-menu-flex",D(1,"div","context-menu-group",D(1,"div",f,[D(1,"div",null,a._translate("Expression language"),0),Pe(2,Tr,{className:"expression-language",onChange:m=>a.onChange(d,m),options:p,value:h})],4),2),2)}}),e.onGetComponent("context-menu",function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(l.contextMenuType==="input-edit")return()=>{var c=l.input.inputExpression;if(a._shouldDisplayContextMenuEntry(c)){var d=a._getElementExpressionLanguage(c),h=i.getAll();return D(1,"div","context-menu-container ref-language",D(1,"div","dms-form-control",[D(1,"label","dms-label",a._translate("Expression language"),0),Pe(2,Tr,{className:"ref-language",value:d||"",onChange:p=>a.onChange(c,p),options:h})],4),2)}}})}onChange(e,n){this._modeling.editExpressionLanguage(e,n)}_shouldDisplayContextMenuEntry(e){var n=this._expressionLanguages.getAll();if(n.length>1)return!0;var r=this._getElementExpressionLanguage(e);return r!==this._getDefaultElementExpressionLanguage(e)}_getElementExpressionLanguage(e){return jl(e).expressionLanguage||this._getDefaultElementExpressionLanguage(e)}_getDefaultElementExpressionLanguage(e){return this._expressionLanguages.getDefault(cn(e.col)?"inputCell":"outputCell").value}};z7.$inject=["components","elementRegistry","modeling","expressionLanguages","translate","contextMenu"];const vNe={__depends__:[uh],__init__:["expressionLanguage"],expressionLanguage:["type",z7]};function b5(t,e,n){return e=yNe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function yNe(t){var e=xNe(t,"string");return typeof e=="symbol"?e:String(e)}function xNe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class H7 extends Ve{constructor(e,n){super(e,n),b5(this,"onElementsChanged",()=>{this.forceUpdate()}),b5(this,"setDecisionTableName",r=>{this.modeling.editDecisionTableName(r)}),hi(this)}componentWillMount(){this.setupChangeListeners({bind:this.getBusinessObject().id})}componentWillUnmount(){this.setupChangeListeners({unbind:this.getBusinessObject().id})}setupChangeListeners(e){var n=e.bind,r=e.unbind;typeof r=="string"&&this.changeSupport.offElementsChanged(r,this.onElementsChanged),typeof n=="string"&&this.changeSupport.onElementsChanged(n,this.onElementsChanged)}getBusinessObject(){return this.sheet.getRoot().businessObject.$parent}render(){var e=this.getBusinessObject(),n=e.name,r=this.components.getComponent("hit-policy")||wNe;return D(1,"div","decision-table-properties",[Pe(2,bNe,{className:"decision-table-name",value:n,ctrlForNewline:!0,onBlur:_Ne,onChange:this.setDecisionTableName,elementId:"__decisionProperties_name",coords:"0:__decisionProperties"}),D(1,"div","decision-table-header-separator"),Pe(2,r)],4)}}H7.$inject=["sheet","modeling","changeSupport","components"];class bNe extends vy{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),ch(this,eN)}render(){var e=this.props.value,n=JT(this.getSelectionClasses(),this.getClassName());return D(1,"div",n,this.getEditor(),0,{"data-element-id":this.props.elementId,"data-coords":this.props.coords,title:this._translate("Decision name: ")+e})}}function wNe(){return null}function _Ne(t){t.target.scroll(0,0)}var ENe=500;class U7{constructor(e){e.onGetComponent("table.before",ENe,()=>H7)}}U7.$inject=["components"];const SNe={__depends__:[dh],__init__:["decisionTableProperties"],decisionTableProperties:["type",U7]};function w5(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function _5(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?w5(Object(n),!0).forEach(function(r){Zj(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w5(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Zj(t,e,n){return e=CNe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function CNe(t){var e=jNe(t,"string");return typeof e=="symbol"?e:String(e)}function jNe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class V7 extends Ve{constructor(e,n){super(e,n),Zj(this,"onChange",r=>{var i=r.aggregation,s=r.hitPolicy;this.modeling.editHitPolicy(s,i)}),Zj(this,"onElementsChanged",()=>{this.forceUpdate()}),this._translate=n.injector.get("translate"),hi(this)}componentDidMount(){this.changeSupport.onElementsChanged(this.getRoot().id,this.onElementsChanged)}componentWillUnmount(){this.changeSupport.offElementsChanged(this.getRoot().id,this.onElementsChanged)}getRoot(){return this.sheet.getRoot()}render(){var e=this.getRoot(),n=e.businessObject,r=n.aggregation,i=n.hitPolicy,s=Tt(nj,o=>kNe(o.value,{aggregation:r,hitPolicy:i}));return D(1,"div","hit-policy",[D(1,"label","dms-label",this._translate("Hit policy:"),0),Pe(2,Tr,{className:"hit-policy-edit-policy-select",onChange:this.onChange,options:nj.map(o=>_5(_5({},o),{},{label:this._translate(o.label)})),value:s.value,"data-hit-policy":"true",noInput:!0})],4,{title:this._translate(s.explanation)})}}V7.$inject=["changeSupport","sheet","modeling"];function kNe(t,e){return t.hitPolicy===e.hitPolicy&&t.aggregation===e.aggregation}function q7(t){t.onGetComponent("hit-policy",()=>V7)}q7.$inject=["components"];const PNe={__depends__:[hh],__init__:["hitPolicyProvider"],hitPolicyProvider:["type",q7]};class W7 extends pi{constructor(e,n){super(e),this.executed(["row.add","row.remove","col.add","col.remove"],E5(r=>{var i=r.context,s=i.row||i.col;this.updateRoot(s,i.oldRoot)})),this.reverted(["row.add","row.remove","col.add","col.remove"],E5(r=>{var i=r.context,s=i.row||i.col;this.updateRoot(s,i.newRoot)}))}updateRoot(e,n){var r=e.root,i=e.businessObject;if(Y(e,"dmn:DecisionRule")){if(n){var s=n.businessObject,o=s.get("rule"),a=o.indexOf(i);o.splice(a,1),i.$parent=null}if(r){var l=r.businessObject,c=r.rows.indexOf(e);l.get("rule").splice(c,0,i),i.$parent=l,e.cells.forEach((E,S)=>{this.wireCell(E,e,S)})}}if(Y(e,"dmn:InputClause")||Y(e,"dmn:OutputClause")){var d,h;if(n){var p=n.businessObject,f=p.get("input"),m=p.get("output");if(Y(e,"dmn:InputClause")&&(d=f,h=f.indexOf(i)),Y(e,"dmn:OutputClause")&&(d=m,h=m.indexOf(i)),h===-1)throw new Error("inconsistent model: clause not in table");d.splice(h,1),i.$parent=null,e.cells.forEach((E,S)=>{this.unwireCell(E,n.rows[S])})}if(r){var g=r.businessObject,v=g.get("input"),b=g.get("output"),x=r.cols.indexOf(e),y,w;Y(e,"dmn:InputClause")&&(w=v,y=x),Y(e,"dmn:OutputClause")&&(w=b,y=x-v.length),w.splice(y,0,i),i.$parent=g,e.cells.forEach((E,S)=>{this.wireCell(E,r.rows[S],x)})}}}unwireCell(e,n){var r=e.businessObject,i=n.businessObject,s=i.get("inputEntry"),o=i.get("outputEntry"),a,l;if(Y(e,"dmn:UnaryTests")&&(a=s),Y(e,"dmn:LiteralExpression")&&(a=o),l=a.indexOf(r),l===-1)throw new Error("cell not in row");a.splice(l,1),r.$parent=null}wireCell(e,n,r){var i=e.businessObject,s=n.businessObject,o=s.get("inputEntry"),a=s.get("outputEntry"),l,c;i.$parent!==s&&(Y(e,"dmn:UnaryTests")&&(l=o,c=r),Y(e,"dmn:LiteralExpression")&&(l=a,c=r-o.length),l.splice(c,0,i),i.$parent=s)}}W7.$inject=["eventBus","sheet"];function E5(t){return function(e){var n=e.context,r=n.row||n.col;Y(r,"dmn:DMNElement")&&t(e)}}class G7{constructor(e){this._model=e}create(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this._model.create(e,n||{});return Y(r,"dmn:InputClause")&&(n.inputExpression?r.inputExpression=n.inputExpression:(r.inputExpression=this.create("dmn:LiteralExpression",{typeRef:"string"}),r.inputExpression.$parent=r)),Y(r,"dmn:OutputClause")&&(r.typeRef=n.typeRef||"string"),(Y(r,"dmn:UnaryTests")||Y(r,"dmn:LiteralExpression"))&&(r.text=n.text||""),this._ensureId(r),r}_needsId(e){return Y(e,"dmn:DMNElement")}_ensureId(e){var n=(e.$type||"").replace(/^[^:]*:/g,"")+"_";!e.id&&this._needsId(e)&&(e.id=this._model.ids.nextPrefixed(n,e))}}G7.$inject=["moddle"];var TNe=["businessObject","type"];function S5(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function NNe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?S5(Object(n),!0).forEach(function(r){ONe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S5(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function ONe(t,e,n){return e=RNe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function RNe(t){var e=ANe(t,"string");return typeof e=="symbol"?e:String(e)}function ANe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function INe(t,e){if(t==null)return{};var n=DNe(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function DNe(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}class K7 extends TV{constructor(e){super(),this._dmnFactory=e}create(e,n){var r=this._dmnFactory,i=n.businessObject,s=n.type,o=INe(n,TNe);if(!i){if(!s){if(e==="root")s="dmn:DecisionTable";else if(e==="cell"){var a=o.col;Y(a,"dmn:OutputClause")&&(s="dmn:LiteralExpression"),Y(a,"dmn:InputClause")&&(s="dmn:UnaryTests")}if(!s)throw new Error("cannot guess <type>")}i=r.create(s)}return super.create(e,NNe({businessObject:i,id:i.id},o))}}K7.$inject=["dmnFactory"];class Y7{constructor(e,n){this._sheet=e,this._elementFactory=n}execute(e){const n=this._sheet,r=this._elementFactory,i=n.getRoot();let{row:s,index:o}=e;return typeof o>"u"&&(o=e.index=i.rows.length),e.newRoot=i,s.cells.length||i.cols.forEach((a,l)=>{const c=r.create("cell",{row:s,col:a});s.cells[l]=c}),n.addRow(s,o),n.getRoot()}revert(e){const{row:n}=e,r=this._sheet;return r.removeRow(n),r.getRoot()}}Y7.$inject=["sheet","elementFactory"];class X7{constructor(e){this._sheet=e}execute(e){const n=this._sheet,r=n.getRoot();let{row:i}=e;const s=e.oldIndex=r.rows.indexOf(i);if(e.oldRoot=i.root,s===-1)throw new Error(`row#${i.id} not in sheet`);return n.removeRow(i),n.getRoot()}revert(e){const{row:n,oldIndex:r}=e,i=this._sheet;return i.addRow(n,r),i.getRoot()}}X7.$inject=["sheet"];class Q7{constructor(e){this._modeling=e}preExecute(e){let{row:n}=e;this._modeling.removeRow(n)}postExecute(e){let{row:n,index:r}=e;this._modeling.addRow(n,r)}}Q7.$inject=["modeling"];class Z7{constructor(e,n){this._sheet=e,this._elementFactory=n}execute(e){const n=this._sheet,r=this._elementFactory,i=n.getRoot();let{col:s,index:o}=e;return typeof o>"u"&&(o=e.index=i.cols.length),e.newRoot=i,s.cells.length||i.rows.forEach((a,l)=>{const c=r.create("cell",{row:a,col:s});s.cells[l]=c}),n.addCol(s,o),n.getRoot()}revert(e){const{col:n}=e,r=this._sheet;return r.removeCol(n),r.getRoot()}}Z7.$inject=["sheet","elementFactory"];class J7{constructor(e,n){this._sheet=e,this._elementFactory=n}execute(e){const n=this._sheet;let{col:r}=e;const i=e.oldRoot=r.root;if((e.oldIndex=i.cols.indexOf(r))===-1)throw new Error(`col#${r.id} not in sheet`);return n.removeCol(r),n.getRoot()}revert(e){const{col:n,oldIndex:r}=e,i=this._sheet;return i.addCol(n,r),i.getRoot()}}J7.$inject=["sheet","elementFactory"];class eG{constructor(e){this._modeling=e}preExecute(e){let{col:n}=e;this._modeling.removeCol(n)}postExecute(e){let{col:n,index:r}=e;this._modeling.addCol(n,r)}}eG.$inject=["modeling"];class $Ne{execute(e){let{cell:n}=e;return n}revert(e){const{cell:n}=e;return n}}let tG=class nG{constructor(e,n,r){this._eventBus=e,this._elementFactory=n,this._commandStack=r,e.on("table.init",()=>{MNe(this.getHandlers(),r)})}getHandlers(){return nG._getHandlers()}static _getHandlers(){return{"row.add":Y7,"row.remove":X7,"row.move":Q7,"col.add":Z7,"col.remove":J7,"col.move":eG,"cell.edit":$Ne}}_create(e,n){return n instanceof fy?n:this._elementFactory.create(e,n)}addRow(e,n){const r=this._create("row",e),i={row:r,index:n};return this._commandStack.execute("row.add",i),r}removeRow(e){this._commandStack.execute("row.remove",{row:e})}moveRow(e,n){const r={row:e,index:n};this._commandStack.execute("row.move",r)}addCol(e,n){const r=this._create("col",e),i={col:r,index:n};return this._commandStack.execute("col.add",i),r}removeCol(e){this._commandStack.execute("col.remove",{col:e})}moveCol(e,n){const r={col:e,index:n};this._commandStack.execute("col.move",r)}editCell(e,n){const r={cell:e,...n};this._commandStack.execute("cell.edit",r)}};tG.$inject=["eventBus","elementFactory","commandStack"];function MNe(t,e){$(t,function(n,r){e.registerHandler(r,n)})}class rG{constructor(e,n,r){this._dmnFactory=e,this._moddle=n,this._modeling=r}execute(e){var n=e.element,r=e.allowedValues,i=Y(n,"dmn:InputClause");return i?(n.inputValues?e.oldAllowedValues=n.inputValues.text:sb(r)||(n.inputValues=this._dmnFactory.create("dmn:UnaryTests",{text:""})),sb(r)?n.inputValues&&delete n.inputValues:n.inputValues.text=r.join(",")):(n.outputValues&&n?e.oldAllowedValues=n.outputValues.text:sb(r)||(n.outputValues=this._dmnFactory.create("dmn:UnaryTests",{text:""})),sb(r)?n.outputValues&&delete n.outputValues:n.outputValues.text=r.join(",")),n}revert(e){var n=e.element,r=e.oldAllowedValues,i=Y(n,"dmn:InputClause");return i?r?(n.inputValues||(n.inputValues=this._dmnFactory.create("dmn:UnaryTests",{text:""})),n.inputValues.text=r):delete n.inputValues:r?(n.outputValues||(n.outputValues=this._dmnFactory.create("dmn:UnaryTests",{text:""})),n.outputValues.text=r):delete n.outputValues,n}}rG.$inject=["dmnFactory","moddle","modeling"];function sb(t){return t===null}function C5(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ob(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?C5(Object(n),!0).forEach(function(r){LNe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C5(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function LNe(t,e,n){return e=BNe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function BNe(t){var e=FNe(t,"string");return typeof e=="symbol"?e:String(e)}function FNe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Jj="id";class YN{constructor(e,n){this._elementRegistry=e,this._moddle=n}execute(e){var n=e.element,r=e.properties,i=jl(n),s=this.updateProperties(i,r),o=s.changed,a=s.oldProperties;return e.oldProperties=a,[...o,n]}revert(e){var n=e.element,r=e.oldProperties,i=jl(n),s=this.updateProperties(i,r),o=s.changed;return[...o,n]}updateProperties(e,n){var r=this._moddle.ids;return xr(n,(i,s,o)=>{var a=e.get(o);if(j5(s)){if(!j5(a))throw new Error("non-existing property <".concat(o,">: cannot update values"));var l=this.updateProperties(a,s),c=l.changed,d=l.oldProperties;return{changed:[...i.changed,...c,a],oldProperties:ob(ob({},i.oldProperties),{},{[o]:d})}}return o===Jj&&zNe(e,s)&&(r.unclaim(e[Jj]),this._elementRegistry.updateId(e,s),r.claim(s,e)),e.set(o,s),{changed:i.changed,oldProperties:ob(ob({},i.oldProperties),{},{[o]:a})}},{changed:[],oldProperties:{}})}}YN.$inject=["elementRegistry","moddle"];function zNe(t,e){return t[Jj]!==e}function j5(t){return an(t)&&Wn(t)}class iG{constructor(e){this._moddle=e}execute(e){var n=this._moddle.ids,r=e.id,i=e.element,s=e.claiming;s?n.claim(r,i):n.unclaim(r)}revert(e){var n=this._moddle.ids,r=e.id,i=e.element,s=e.claiming;s?n.unclaim(r):n.claim(r,i)}}iG.$inject=["moddle"];let sG=class oG extends tG{constructor(e,n,r,i){super(e,n,r),this._eventBus=e,this._elementFactory=n,this._commandStack=r,this._sheet=i}getHandlers(){return oG._getHandlers()}static _getHandlers(){return B({},super._getHandlers(),{editAllowedValues:rG,"element.updateProperties":YN,"id.updateClaim":iG})}editDecisionTableName(e){var n=this._sheet.getRoot(),r=n.businessObject,i=r.$parent,s={element:i,properties:{name:e}};this._commandStack.execute("element.updateProperties",s)}editDecisionTableId(e){var n=this._sheet.getRoot(),r=n.businessObject,i=r.$parent,s={element:i,properties:{id:e}};this._commandStack.execute("element.updateProperties",s)}editHitPolicy(e,n){var r=this._sheet.getRoot(),i=r.businessObject,s={element:i,properties:{hitPolicy:e,aggregation:n}};this._commandStack.execute("element.updateProperties",s)}updateProperties(e,n){var r={element:e,properties:n};this._commandStack.execute("element.updateProperties",r)}editInputExpression(e,n){var r={element:e,properties:n};this._commandStack.execute("element.updateProperties",r)}editOutputName(e,n){var r={element:e,properties:{name:n}};this._commandStack.execute("element.updateProperties",r)}editInputExpressionTypeRef(e,n){var r={element:e,properties:{typeRef:n}};this._commandStack.execute("element.updateProperties",r)}editOutputTypeRef(e,n){var r={element:e,properties:{typeRef:n}};this._commandStack.execute("element.updateProperties",r)}editCell(e,n){var r={element:e,properties:{text:n}};this._commandStack.execute("element.updateProperties",r)}editAnnotation(e,n){var r={element:e,properties:{description:n}};this._commandStack.execute("element.updateProperties",r)}editAllowedValues(e,n){var r={element:e,allowedValues:n};this._commandStack.execute("editAllowedValues",r)}editExpressionLanguage(e,n){var r={element:e,properties:{expressionLanguage:n}};this._commandStack.execute("element.updateProperties",r)}claimId(e,n){var r={id:e,element:n,claiming:!0};this._commandStack.execute("id.updateClaim",r)}unclaimId(e,n){var r={id:e,element:n};this._commandStack.execute("id.updateClaim",r)}};sG.$inject=["eventBus","elementFactory","commandStack","sheet"];class aG extends pi{constructor(e,n,r){super(e),this._ids=n.ids,this._modeling=r,this.preExecute(["row.add","col.add"],i=>{var s=i.context,o=s.row||s.col;this.claimId(o.businessObject),o.cells&&o.cells.forEach(a=>this.claimId(a.businessObject))})}claimId(e){e.id&&!this._ids.assigned(e.id)&&this._modeling.claimId(e.id,e),e.$descriptor.properties.forEach(n=>{var r=e[n.name];r&&(ke(r)&&r.forEach(i=>this.claimId(i)),r.$type&&this.claimId(r))})}}aG.$inject=["eventBus","moddle","modeling"];class lG extends pi{constructor(e,n){super(e),this._modeling=n,this.preExecute(["row.remove","col.remove"],r=>{var i=r.context,s=i.row||i.col;this.unclaimId(s.businessObject),s.cells&&s.cells.forEach(o=>this.unclaimId(o.businessObject))})}unclaimId(e){e.id&&this._modeling.unclaimId(e.id,e),e.$descriptor.properties.forEach(n=>{var r=e[n.name];r&&(ke(r)&&r.forEach(i=>this.unclaimId(i)),r.$type&&this.unclaimId(r))})}}lG.$inject=["eventBus","modeling"];const HNe={__init__:["idClaimBehavior","idUnclaimBehavior"],idClaimBehavior:["type",aG],idUnclaimBehavior:["type",lG]},UNe={__init__:["dmnUpdater","idChangeBehavior","modeling"],__depends__:[HNe,iz],dmnUpdater:["type",W7],dmnFactory:["type",G7],elementFactory:["type",K7],idChangeBehavior:["type",L_],modeling:["type",sG]};function k5(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ab(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?k5(Object(n),!0).forEach(function(r){VNe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k5(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function VNe(t,e,n){return e=qNe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function qNe(t){var e=WNe(t,"string");return typeof e=="symbol"?e:String(e)}function WNe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class GNe extends Ve{constructor(e,n){super(e,n),this.changeCellValue=this.changeCellValue.bind(this),this.onElementsChanged=this.onElementsChanged.bind(this)}onElementsChanged(){this.forceUpdate()}componentWillMount(){var e=this.context.injector,n=this.props.cell,r=this._changeSupport=this.context.changeSupport;this._modeling=e.get("modeling"),r.onElementsChanged(n.id,this.onElementsChanged)}componentWillUnmount(){var e=this.props.cell;this._changeSupport.offElementsChanged(e.id,this.onElementsChanged)}changeCellValue(e){var n=this.props.cell;this._modeling.editCell(n.businessObject,e)}render(){var e=this.props,n=e.cell,r=e.rowIndex,i=e.row,s=e.col,o=e.colIndex,a=Y(n,"dmn:UnaryTests"),l=n.businessObject;return Pe(2,Kg,{className:a?"input-cell":"output-cell",elementId:n.id,coords:"".concat(r,":").concat(o),"data-row-id":i.id,"data-col-id":s.id,children:Pe(2,YNe,{placeholder:a?"-":"",onChange:this.changeCellValue,value:l.text,businessObject:l})})}}let KNe=class extends Ve{constructor(e,n){super(e,n),this.state={focussed:!1},this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this)}onFocus(){this.setState({focussed:!0})}onBlur(){this.setState({focussed:!1})}render(){var e=this.state.focussed,n="feel-editor".concat(e?" focussed":"");return D(1,"div",n,[e&&qg(Pe(2,WN,ab(ab({},this.props),{},{autoFocus:!0,onBlur:this.onBlur}))),qg(Pe(2,tf,ab(ab({},this.props),{},{onInput:()=>{},onFocus:this.onFocus})))],0,{onClick:this.onFocus})}};class YNe extends Ve{constructor(e,n){super(e,n),this._expressionLanguages=n.injector.get("expressionLanguages"),this._translate=n.injector.get("translate"),this._variableResolver=n.injector.get("variableResolver",!1)}isDefaultExpressionLanguage(e){var n=e.expressionLanguage,r=this.getDefaultExpressionLanguage(e).value;return!n||n===r}getDescription(e){return e.description}getExpressionLanguageLabel(e){var n=e.expressionLanguage,r=this.getDefaultExpressionLanguage(e);return this._expressionLanguages.getLabel(n)||r.label}isScript(e){var n=this.getDefaultExpressionLanguage(e),r=Y(e,"dmn:UnaryTests");return r?e.text.indexOf(`
`)!==-1?!0:e.expressionLanguage&&e.expressionLanguage!==n:!1}getDefaultExpressionLanguage(e){var n=Y(e,"dmn:UnaryTests")?"inputCell":"outputCell";return this._expressionLanguages.getDefault(n)}getEditor(){return this.isFEEL()?KNe:tf}isFEEL(){return this.getExpressionLanguage()==="feel"}getExpressionLanguage(){var e=this.props.businessObject;return e.expressionLanguage||this.getDefaultExpressionLanguage(e).value}_getVariables(){var e=this.props.businessObject;return this._variableResolver&&this._variableResolver.getVariables(e)}render(){var e=this.props,n=e.businessObject,r=e.placeholder,i=e.value,s=e.onChange,o=this.getDescription(n),a=this.isDefaultExpressionLanguage(n),l=this.getExpressionLanguageLabel(n),c=this.isScript(n),d=this.getEditor(),h=this._getVariables();return D(1,"div","cell-editor",[Fi(o)&&D(1,"div","description-indicator"),Pe(2,d,{className:c?"script-editor":"",ctrlForNewline:!0,onInput:s,value:i,placeholder:r,variables:h}),!a&&D(1,"span","dms-badge dmn-expression-language",[D(1,"span","dms-badge-icon dmn-icon-file-code"),D(1,"span","dms-badge-label",l,0)],4,{title:this._translate("Expression language: {expressionLanguageLabel}",{expressionLanguageLabel:l})})],0)}}var XNe=1500;class cG{constructor(e){e.onGetComponent("cell",XNe,n=>{var r=n.cellType;if(r==="rule")return GNe})}}cG.$inject=["components"];const QNe={__depends__:[dh,WV],__init__:["decisionRulesEditor"],decisionRulesEditor:["type",cG]};function P5(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function lb(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?P5(Object(n),!0).forEach(function(r){ZNe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P5(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function ZNe(t,e,n){return e=JNe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function JNe(t){var e=eOe(t,"string");return typeof e=="symbol"?e:String(e)}function eOe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var cb=4;class uG extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this.state={top:0,left:0,isVisible:!1,isDisabled:!1,selection:null},hi(this);var r=this.debounceInput;this.onClick=this.onClick.bind(this),this.handleSelectionChanged=this.handleSelectionChanged.bind(this),this.hideAndShowDebounced=this.hideAndShowDebounced.bind(this),this.showDebounced=r(this.showDebounced.bind(this)),this.updatePosition=this.updatePosition.bind(this)}componentDidMount(){var e=this.eventBus;e.on("cellSelection.changed",this.handleSelectionChanged),e.on("commandStack.changed",this.updatePosition),e.on("sheet.scroll",this.hideAndShowDebounced)}componentWillUnmount(){var e=this.eventBus;e.off("cellSelection.changed",this.handleSelectionChanged),e.off("commandStack.changed",this.updatePosition),e.off("sheet.scroll",this.hideAndShowDebounced)}hideAndShowDebounced(){this.state.isVisible&&(this.hide(),this.showDebounced())}showDebounced(){this.show()}hide(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.setState(lb(lb({},e),{},{isVisible:!1}))}show(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.setState(lb(lb({},e),{},{isVisible:!0})),this.updatePosition()}handleSelectionChanged(e){var n=e.elementId,r=this.elementRegistry,i=this.expressionLanguages,s=this.simpleMode,o=r.get(n);if(!o||!s.canSimpleEdit(o)){this.hide({isDisabled:!1,selection:null});return}var a=tOe(o),l=!nOe(o,a,i);this.show({isDisabled:l,selection:o})}updatePosition(){var e=this.state.selection,n=this.node;if(!(!e||!n)){var r=this.renderer,i=r.getContainer(),s=i.getBoundingClientRect(),o=ef(e.id,i),a=o.getBoundingClientRect(),l=this.node.getBoundingClientRect(),c=iOe(n),d=c.scrollLeft,h=c.scrollTop,p={};a.left+a.width/2>s.width/2?(p.left=-s.left+a.left-l.width+cb+d+"px",n.classList.remove("right"),n.classList.add("left")):(p.left=-s.left+a.left+a.width-cb+d+"px",n.classList.remove("left"),n.classList.add("right")),a.top+a.height/2>s.height/2?(p.top=-s.top+a.top-l.height+cb+h+"px",n.classList.remove("top"),n.classList.add("bottom")):(p.top=-s.top+a.top-cb+h+"px",n.classList.remove("bottom"),n.classList.add("top")),B(this.node.style,p)}}onClick(){var e=this.eventBus,n=this.state.isDisabled;if(!n){var r=this.selection,i=r.get();i&&(e.fire("simpleMode.open",{element:i,node:ef(i.id,this._container)}),this.hide())}}render(){var e=this.state,n=e.isDisabled,r=e.isVisible,i=e.top,s=e.left,o=["simple-mode-button","no-deselect"];return n&&o.push("disabled"),r?D(1,"div",o.join(" "),D(1,"span","dmn-icon-edit"),2,{onClick:this.onClick,style:{top:i,left:s},title:n?this._translate("Editing not supported for set expression language"):this._translate("Edit")},null,a=>this.node=a):null}}uG.$inject=["debounceInput","elementRegistry","eventBus","expressionLanguages","renderer","selection","simpleMode"];function tOe(t){return t.businessObject.expressionLanguage}function nOe(t,e,n){return!e||e===rOe(t,n)}function rOe(t,e){if(cn(t.col))return e.getDefault("inputCell").value;if(Xr(t.col))return e.getDefault("outputCell").value}function iOe(t){var e=ur(t,".tjs-table-container");if(!e)return{scrollTop:0,scrollLeft:0};var n=e.scrollLeft,r=e.scrollTop;return{scrollTop:r,scrollLeft:n}}class dG{constructor(e,n,r,i,s){this._providers=[],e.onGetComponent("table.before",()=>uG),i.on("simpleMode.open",o=>{var a=o.element,l=o.node,c=l.getBoundingClientRect(),d=c.left,h=c.top,p=c.width,f=c.height,m=s.getContainer();n.open({x:d+m.parentNode.scrollLeft,y:h+m.parentNode.scrollTop,width:p,height:f},{contextMenuType:"simple-mode-edit",element:a,offset:{x:4,y:4}})}),i.on("cell.click",o=>{var a=o.event,l=o.node,c=o.id;if(sOe(a)){var d=r.get(c);d&&i.fire("simpleMode.open",{node:l,element:d}),o.preventDefault()}})}registerProvider(e){this._providers.push(e)}canSimpleEdit(e){return this._providers.reduce((n,r)=>n||r(e),!1)}}dG.$inject=["components","contextMenu","elementRegistry","eventBus","renderer"];function sOe(t){return t.altKey?!1:t.ctrlKey||t.metaKey}const wu={__depends__:[hh,n1,uh],__init__:["simpleMode"],simpleMode:["type",dG]};function oOe(t){if(!t||aOe(t))return"none";if(t.trim()==="true")return"true";if(t.trim()==="false")return"false"}function aOe(t){return t===""}var lOe="true",cOe="false",SS="none";class uOe extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._modeling=n.injector.get("modeling");var r=this.props.context.element,i=oOe(r.businessObject.text);this.state={value:i||SS},this.editCell=this.editCell.bind(this),this.onChange=this.onChange.bind(this)}editCell(e,n){this._modeling.editCell(e,n)}onChange(e){var n=this.props.context.element;this.editCell(n.businessObject,e===SS?"":e),this.setState({value:e})}render(){var e=this.state.value,n=[{label:"-",value:SS},{label:this._translate("Yes"),value:lOe},{label:this._translate("No"),value:cOe}];return D(1,"div","simple-boolean-edit context-menu-container",[D(1,"h3","dms-heading",this._translate("Edit boolean"),0),D(1,"h4","dms-heading",this._translate("Set value"),0),Pe(2,Tr,{noInput:!0,className:"dms-block",onChange:this.onChange,options:n,value:e})],4)}}class hG{constructor(e,n){n.registerProvider(r=>(cn(r.col)||Xr(r.col))&&T5(r)==="boolean"),e.onGetComponent("context-menu",function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(r.contextMenuType&&r.contextMenuType==="simple-mode-edit"){if(!r.element)return;var i=T5(r.element);if(i==="boolean")return uOe}})}}hG.$inject=["components","simpleMode"];function T5(t){return cn(t.col)?t.col&&t.col.businessObject.inputExpression.typeRef:t.col&&t.col.businessObject.typeRef}const dOe={__depends__:[Wl,wu],__init__:["simpleBooleanEdit"],simpleBooleanEdit:["type",hG]};var hOe=/^\d{4}(?:-\d\d){2}$/,pOe=/^\[date\("([^"]*)"\)..date\("([^"]*)"\)\]$/,fOe=/^(<|>)\s*date\("([^"]*)"\)$/,mOe=/^date\("([^"]*)"\)$/,gOe="exact",vOe="before",yOe="after",xOe="between";function sp(t){if(!hOe.test(t.trim()))return"Date must match pattern yyyy-MM-dd"}function hc(t,e){if(t===gOe)return'date("'.concat(e[0],'")');if(t===vOe)return'< date("'.concat(e[0],'")');if(t===yOe)return'> date("'.concat(e[0],'")');if(t===xOe)return'[date("'.concat(e[0],'")..date("').concat(e[1],'")]')}function fl(){var t=new Date;return t.setUTCHours(0,0,0,0),t.toISOString().slice(0,10)}function Xm(t){if(!t||t.trim()==="")return{type:"exact",date:""};var e=t.match(pOe);if(e)return{type:"between",dates:[e[1],e[2]]};if(e=t.match(fOe),e)return{type:e[1]==="<"?"before":"after",date:e[2]};if(e=t.match(mOe),e)return{type:"exact",date:e[1]}}var N5="exact",bOe="before",wOe="after",ub="between";let _Oe=class extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._modeling=n.injector.get("modeling");var r=this.props.context.element,i=Xm(r.businessObject.text);if(i){var s;i.date?s=[i.date,""]:i.dates?s=i.dates:s=["",""],this.state={type:i.type,dates:s}}else this.state={type:N5,dates:["",""]};var o=n.injector.get("debounceInput");this.debouncedEditCell=o(this.editCell.bind(this)),this.editCell=this.editCell.bind(this),this.onTypeChange=this.onTypeChange.bind(this),this.onSetStartDateTodayClick=this.onSetStartDateTodayClick.bind(this),this.onSetEndDateTodayClick=this.onSetEndDateTodayClick.bind(this),this.onStartDateInput=this.onStartDateInput.bind(this),this.onEndDateInput=this.onEndDateInput.bind(this)}editCell(e,n){this._modeling.editCell(e,n)}onTypeChange(e){var n=this.props.context.element,r=this.state.dates;this.setState({type:e}),Xm(hc(e,r))&&this.editCell(n.businessObject,hc(e,r))}onSetStartDateTodayClick(){var e=this.props.context.element,n=this.state,r=n.dates,i=n.type,s=fl();this.setState({dates:[s,r[1]]}),Xm(hc(i,[s,r[1]]))&&this.editCell(e.businessObject,hc(i,[s,r[1]]))}onSetEndDateTodayClick(){var e=this.props.context.element,n=this.state,r=n.dates,i=n.type,s=fl();this.setState({dates:[r[0],s]}),Xm(hc(i,[r[0],s]))&&this.editCell(e.businessObject,hc(i,[r[0],s]))}onStartDateInput(e){var n=e.value,r=this.props.context.element,i=this.state,s=i.dates,o=i.type;this.setState({dates:[n,s[1]]}),this.debouncedEditCell(r.businessObject,hc(o,[n,s[1]]))}onEndDateInput(e){var n=e.value,r=this.props.context.element,i=this.state,s=i.dates,o=i.type;this.setState({dates:[s[0],n]}),this.debouncedEditCell(r.businessObject,hc(o,[s[0],n]))}render(){var e=this.state,n=e.dates,r=e.type,i=[{label:this._translate("Exactly"),value:N5},{label:this._translate("Before"),value:bOe},{label:this._translate("After"),value:wOe},{label:this._translate("Between"),value:ub}];return D(1,"div","context-menu-container simple-date-edit",[D(1,"h3","dms-heading",this._translate("Edit date"),0),D(1,"div","dms-fill-row",Pe(2,Tr,{noInput:!0,onChange:this.onTypeChange,options:i,value:r}),2),D(1,"h4","dms-heading",r===ub?this._translate("Edit start date"):this._translate("Set date"),0),D(1,"div",null,[Pe(2,so,{className:"start-date-input dms-block",onInput:this.onStartDateInput,placeholder:this._translate("e.g. { sample }",{sample:fl()}),validate:s=>sp(s)&&this._translate(sp(s)),value:n[0]}),D(1,"p","dms-hint",[D(1,"button","use-today",this._translate("Use today"),0,{type:"button",onClick:this.onSetStartDateTodayClick}),Vn(".")],4)],4),r===ub&&D(1,"h4","dms-heading",this._translate("Edit end date"),0),r===ub&&D(1,"div",null,[Pe(2,so,{className:"end-date-input dms-block",onInput:this.onEndDateInput,placeholder:this._translate("e.g. { sample }",{sample:fl()}),validate:s=>sp(s)&&this._translate(sp(s)),value:n[1]}),D(1,"p","dms-hint",[D(1,"button","use-today",this._translate("Use today"),0,{type:"button",onClick:this.onSetEndDateTodayClick}),Vn(".")],4)],4)],0)}},EOe=class extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._modeling=n.injector.get("modeling");var r=this.props.context.element,i=Xm(r.businessObject.text);this.state={date:i?i.date:""};var s=n.injector.get("debounceInput");this.debouncedEditCell=s(this.editCell.bind(this)),this.editCell=this.editCell.bind(this),this.onClick=this.onClick.bind(this),this.onInput=this.onInput.bind(this)}editCell(e,n){this._modeling.editCell(e,n)}onClick(){var e=this.props.context.element,n=fl();this.setState({date:n}),this.editCell(e.businessObject,'date("'.concat(n,'")'))}onInput(e){var n=e.value,r=this.props.context.element;this.setState({date:n}),this.debouncedEditCell(r.businessObject,'date("'.concat(n,'")'))}render(){var e=this.state.date;return D(1,"div","context-menu-container simple-date-edit",[D(1,"h3","dms-heading",this._translate("Edit date"),0),D(1,"h4","dms-heading",this._translate("Set date"),0),D(1,"div",null,[Pe(2,so,{onInput:this.onInput,placeholder:this._translate("e.g. { example } ",{example:fl()}),validate:n=>sp(n)&&this._translate(sp(n)),value:e,className:"dms-block"}),D(1,"p","dms-hint",D(1,"button","use-today",this._translate("Use today"),0,{type:"button",onClick:this.onClick}),2)],4)],4)}},pG=class{constructor(e,n){n.registerProvider(r=>{var i=O5(r);return(cn(r.col)||Xr(r.col))&&R5(i)}),e.onGetComponent("context-menu",function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(r.contextMenuType&&r.contextMenuType==="simple-mode-edit"){if(!r.element)return;var i=O5(r.element);if(R5(i)){if(cn(r.element.col))return _Oe;if(Xr(r.element.col))return EOe}}})}};pG.$inject=["components","simpleMode"];function O5(t){return cn(t.col)?t.col&&t.col.businessObject.inputExpression.typeRef:t.col&&t.col.businessObject.typeRef}function R5(t){return t==="date"}const SOe={__depends__:[Wl,wu],__init__:["simpleDateEdit"],simpleDateEdit:["type",pG]};var COe=/^\d{4}(?:-\d\d){2}T(?:\d\d:){2}\d\d(?:Z|(?:[@+-][^")]+))?$/,jOe=/^\[date and time\("([^"]*)"\)..date and time\("([^"]*)"\)\]$/,kOe=/^(<|>)\s*date and time\("([^"]*)"\)$/,POe=/^date and time\("([^"]*)"\)$/,TOe="exact",NOe="before",OOe="after",ROe="between";function op(t){if(!COe.test(t.trim()))return"Date and time must match pattern yyyy-MM-ddTHH:mm:ss[time zone]"}function pc(t,e){if(t===TOe)return'date and time("'.concat(e[0],'")');if(t===NOe)return'< date and time("'.concat(e[0],'")');if(t===OOe)return'> date and time("'.concat(e[0],'")');if(t===ROe)return'[date and time("'.concat(e[0],'")..date and time("').concat(e[1],'")]')}function ap(){var t=new Date;return t.setUTCHours(0,0,0,0),t.toISOString().replace(".000Z","Z")}function Qm(t){if(!t||t.trim()==="")return{type:"exact",date:""};var e=t.match(jOe);if(e)return{type:"between",dates:[e[1],e[2]]};if(e=t.match(kOe),e)return{type:e[1]==="<"?"before":"after",date:e[2]};if(e=t.match(POe),e)return{type:"exact",date:e[1]}}var A5="exact",AOe="before",IOe="after",db="between";class DOe extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._modeling=n.injector.get("modeling");var r=this.props.context.element,i=Qm(r.businessObject.text);if(i){var s;i.date?s=[i.date,""]:i.dates?s=i.dates:s=["",""],this.state={type:i.type,dates:s}}else this.state={type:A5,dates:["",""]};var o=n.injector.get("debounceInput");this.debouncedEditCell=o(this.editCell.bind(this)),this.editCell=this.editCell.bind(this),this.onTypeChange=this.onTypeChange.bind(this),this.onSetStartDateTodayClick=this.onSetStartDateTodayClick.bind(this),this.onSetEndDateTodayClick=this.onSetEndDateTodayClick.bind(this),this.onStartDateInput=this.onStartDateInput.bind(this),this.onEndDateInput=this.onEndDateInput.bind(this)}editCell(e,n){this._modeling.editCell(e,n)}onTypeChange(e){var n=this.props.context.element,r=this.state.dates;this.setState({type:e}),Qm(pc(e,r))&&this.editCell(n.businessObject,pc(e,r))}onSetStartDateTodayClick(){var e=this.props.context.element,n=this.state,r=n.dates,i=n.type,s=ap();this.setState({dates:[s,r[1]]}),Qm(pc(i,[s,r[1]]))&&this.editCell(e.businessObject,pc(i,[s,r[1]]))}onSetEndDateTodayClick(){var e=this.props.context.element,n=this.state,r=n.dates,i=n.type,s=ap();this.setState({dates:[r[0],s]}),Qm(pc(i,[r[0],s]))&&this.editCell(e.businessObject,pc(i,[r[0],s]))}onStartDateInput(e){var n=e.value,r=this.props.context.element,i=this.state,s=i.dates,o=i.type;this.setState({dates:[n,s[1]]}),this.debouncedEditCell(r.businessObject,pc(o,[n,s[1]]))}onEndDateInput(e){var n=e.value,r=this.props.context.element,i=this.state,s=i.dates,o=i.type;this.setState({dates:[s[0],n]}),this.debouncedEditCell(r.businessObject,pc(o,[s[0],n]))}render(){var e=this.state,n=e.dates,r=e.type,i=[{label:this._translate("Exactly"),value:A5},{label:this._translate("Before"),value:AOe},{label:this._translate("After"),value:IOe},{label:this._translate("Between"),value:db}];return D(1,"div","context-menu-container simple-date-edit",[D(1,"h3","dms-heading",this._translate("Edit date and time"),0),D(1,"div","dms-fill-row",Pe(2,Tr,{noInput:!0,onChange:this.onTypeChange,options:i,value:r}),2),D(1,"h4","dms-heading",r===db?this._translate("Edit start date"):this._translate("Set date"),0),D(1,"div",null,[Pe(2,so,{className:"start-date-input dms-block",onInput:this.onStartDateInput,placeholder:this._translate("e.g. { sample }",{sample:ap()}),validate:s=>op(s)&&this._translate(op(s)),value:n[0]}),D(1,"p","dms-hint",D(1,"button","use-today",this._translate("Use today"),0,{type:"button",onClick:this.onSetStartDateTodayClick}),2)],4),r===db&&D(1,"h4","dms-heading",this._translate("Edit end date"),0),r===db&&D(1,"div",null,[Pe(2,so,{className:"end-date-input dms-block",onInput:this.onEndDateInput,placeholder:this._translate("e.g. { sample }",{sample:ap()}),validate:s=>op(s)&&this._translate(op(s)),value:n[1]}),D(1,"p","dms-hint",D(1,"button","use-today",this._translate("Use today"),0,{type:"button",onClick:this.onSetEndDateTodayClick}),2)],4)],0)}}class $Oe extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._modeling=n.injector.get("modeling");var r=this.props.context.element,i=Qm(r.businessObject.text);this.state={date:i?i.date:""};var s=n.injector.get("debounceInput");this.debouncedEditCell=s(this.editCell.bind(this)),this.editCell=this.editCell.bind(this),this.onClick=this.onClick.bind(this),this.onInput=this.onInput.bind(this)}editCell(e,n){this._modeling.editCell(e,n)}onClick(){var e=this.props.context.element,n=ap();this.setState({date:n}),this.editCell(e.businessObject,'date and time("'.concat(n,'")'))}onInput(e){var n=e.value,r=this.props.context.element;this.setState({date:n}),this.debouncedEditCell(r.businessObject,'date and time("'.concat(n,'")'))}render(){var e=this.state.date;return D(1,"div","context-menu-container simple-date-edit",[D(1,"h3","dms-heading",this._translate("Edit date and time"),0),D(1,"h4","dms-heading",this._translate("Set date and time"),0),D(1,"div",null,[Pe(2,so,{onInput:this.onInput,placeholder:this._translate("e.g. { sample }",{sample:ap()}),validate:n=>op(n)&&this._translate(op(n)),value:e,className:"dms-block"}),D(1,"p","dms-hint",D(1,"button","use-today",this._translate("Use today"),0,{type:"button",onClick:this.onClick}),2)],4)],4)}}let fG=class{constructor(e,n){n.registerProvider(r=>{var i=I5(r);return(cn(r.col)||Xr(r.col))&&D5(i)}),e.onGetComponent("context-menu",function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(r.contextMenuType&&r.contextMenuType==="simple-mode-edit"){if(!r.element)return;var i=I5(r.element);if(D5(i)){if(cn(r.element.col))return DOe;if(Xr(r.element.col))return $Oe}}})}};fG.$inject=["components","simpleMode"];function I5(t){return cn(t.col)?t.col&&t.col.businessObject.inputExpression.typeRef:t.col&&t.col.businessObject.typeRef}function D5(t){return t==="dateTime"}const MOe={__depends__:[Wl,wu],__init__:["simpleDateTimeEdit"],simpleDateTimeEdit:["type",fG]};function nw(){nw=function(s,o){return new n(s,void 0,o)};var t=RegExp.prototype,e=new WeakMap;function n(i,s,o){var a=new RegExp(i,s);return e.set(a,o||e.get(i)),rw(a,n.prototype)}function r(i,s){var o=e.get(s);return Object.keys(o).reduce(function(a,l){var c=o[l];if(typeof c=="number")a[l]=i[c];else{for(var d=0;i[c[d]]===void 0&&d+1<c.length;)d++;a[l]=i[c[d]]}return a},Object.create(null))}return LOe(n,RegExp),n.prototype.exec=function(i){var s=t.exec.call(this,i);if(s){s.groups=r(s,this);var o=s.indices;o&&(o.groups=r(o,this))}return s},n.prototype[Symbol.replace]=function(i,s){if(typeof s=="string"){var o=e.get(this);return t[Symbol.replace].call(this,i,s.replace(/\$<([^>]+)>/g,function(l,c){var d=o[c];return"$"+(Array.isArray(d)?d.join("$"):d)}))}if(typeof s=="function"){var a=this;return t[Symbol.replace].call(this,i,function(){var l=arguments;return typeof l[l.length-1]!="object"&&(l=[].slice.call(l)).push(r(l,a)),s.apply(this,l)})}return t[Symbol.replace].call(this,i,s)},nw.apply(this,arguments)}function LOe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rw(t,e)}function rw(t,e){return rw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,i){return r.__proto__=i,r},rw(t,e)}var ek={equals:"=",less:"<",lessEquals:"<=",greater:">",greaterEquals:">="};function BOe(t){return Nd(ek).filter(e=>t===ek[e])[0]}function FOe(t){if(!t||zOe(t.trim()))return{type:"comparison",values:[]};var e=qOe(t);if(e)return e;var n=WOe(t);if(n)return n}function zOe(t){return t===""}function CS(t,e){return t==="equals"?'duration("'.concat(e,'")'):"".concat(ek[t],' duration("').concat(e,'")')}function zm(t,e,n,r){var i=n==="exclude"?"]":"[",s=r==="exclude"?"[":"]";return"".concat(i,'duration("').concat(t,'")')+'..duration("'.concat(e,'")').concat(s)}function HOe(t,e){if(t==="yearMonthDuration")return UOe(e);if(t==="dayTimeDuration")return VOe(e)}function UOe(t){return/^P(\d+Y\d+M|\d+Y|\d+M)$/.test(t)}function VOe(t){return/^P(\d+DT\d+H|\d+D|T\d+H)$/.test(t)}function mG(t){var e=/^duration\("([^"]*)"\)$/.exec(t);return e&&e[1]}function qOe(t){var e=mG(t);if(e)return{type:"comparison",operator:"equals",values:[e]};var n=gG(nw(/^(=|(:?<|>)=?)\s*duration\("([^"]*)"\)$/,{operator:1,value:3}),t),r=n.operator,i=n.value;if(r&&i)return{type:"comparison",values:[i],operator:BOe(r)}}function WOe(t){var e=gG(nw(/^([[\]])duration\("([^"]*)"\)\.\.duration\("([^"]*)"\)([[\]])$/,{start:1,firstValue:2,secondValue:3,end:4}),t),n=e.start,r=e.end,i=e.firstValue,s=e.secondValue;if(n&&r)return{type:"range",values:[i,s],start:n==="]"?"exclude":"include",end:r==="["?"exclude":"include"}}function gG(t,e){var n=t.exec(e)||{groups:{}},r=n.groups;return r}var GOe={yearMonthDuration:"Must match PnYnM",dayTimeDuration:"Must match PnDTnH"};class Kb extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._type=e.type,this.onInput=this.onInput.bind(this),this.validate=this.validate.bind(this),this.state={value:e.value}}onInput(e){var n=e.value;this.setState({value:n}),this.props.onInput(n)}validate(e){if(!HOe(this._type,e))return this._translate(GOe[this._type])}_getPlaceholder(){if(this._type==="yearMonthDuration")return this._translate("e.g. { sample }",{sample:"P1Y2M"});this._type==="dayTimeDuration"&&this._translate("e.g. { sample }",{sample:"P1DT2H"})}render(){return Pe(2,so,{type:"text",onInput:this.onInput,placeholder:this._getPlaceholder(),validate:this.validate,value:this.state.value,className:this.props.className})}}var Fh="comparison",zh="range";class KOe extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._modeling=n.injector.get("modeling");var r=this.props.context.element;this._type=YOe(r);var i=FOe(r.businessObject.text,this._type);i?this.state={type:i.type,comparisonOperator:i.operator||"equals",startValue:i.values[0]||"",endValue:i.values[1]||"",rangeStartType:i.start||"include",rangeEndType:i.end||"include"}:this.state={type:Fh,comparisonOperator:"equals",startValue:"",endValue:"",rangeStartType:"include",rangeEndType:"include"};var s=n.injector.get("debounceInput");this.debouncedEditCell=s(this.editCell.bind(this)),this.editCell=this.editCell.bind(this),this.onComparisonOperatorChange=this.onComparisonOperatorChange.bind(this),this.onComparisonValueChange=this.onComparisonValueChange.bind(this),this.onTypeChange=this.onTypeChange.bind(this),this.onRangeStartTypeChange=this.onRangeStartTypeChange.bind(this),this.onRangeStartValueChange=this.onRangeStartValueChange.bind(this),this.onRangeEndTypeChange=this.onRangeEndTypeChange.bind(this),this.onRangeEndValueChange=this.onRangeEndValueChange.bind(this)}editCell(e,n){this._modeling.editCell(e,n)}onTypeChange(e){var n=this.props.context.element,r=this.state,i=r.comparisonOperator,s=r.startValue,o=r.endValue,a=r.rangeStartType,l=r.rangeEndType;e===Fh?this.editCell(n.businessObject,CS(i,s)):this.editCell(n.businessObject,zm(s,o,a,l)),this.setState({type:e})}onComparisonOperatorChange(e){var n=this.props.context.element,r=this.state,i=r.type,s=r.startValue;i===Fh&&(this.editCell(n.businessObject,CS(e,s)),this.setState({comparisonOperator:e}))}onComparisonValueChange(e){var n=this.props.context.element,r=this.state,i=r.type,s=r.comparisonOperator;i===Fh&&(this.debouncedEditCell(n.businessObject,CS(s,e)),this.setState({startValue:e}))}onRangeStartTypeChange(e){var n=this.props.context.element,r=this.state,i=r.type,s=r.startValue,o=r.endValue,a=r.rangeEndType;i===zh&&(this.editCell(n.businessObject,zm(s,o,e,a)),this.setState({rangeStartType:e}))}onRangeStartValueChange(e){var n=this.props.context.element,r=this.state,i=r.type,s=r.endValue,o=r.rangeStartType,a=r.rangeEndType;i===zh&&(this.editCell(n.businessObject,zm(e,s,o,a)),this.setState({startValue:e}))}onRangeEndTypeChange(e){var n=this.props.context.element,r=this.state,i=r.type,s=r.startValue,o=r.endValue,a=r.rangeStartType;i===zh&&(this.editCell(n.businessObject,zm(s,o,a,e)),this.setState({rangeEndType:e}))}onRangeEndValueChange(e){var n=this.props.context.element,r=this.state,i=r.type,s=r.startValue,o=r.rangeStartType,a=r.rangeEndType;i===zh&&(this.editCell(n.businessObject,zm(s,e,o,a)),this.setState({endValue:e}))}renderComparison(e,n){var r=[{label:this._translate("Equals"),value:"equals"},{label:this._translate("Less"),value:"less"},{label:this._translate("Less or equals"),value:"lessEquals"},{label:this._translate("Greater"),value:"greater"},{label:this._translate("Greater or equals"),value:"greaterEquals"}];return D(1,"div","comparison",[D(1,"h4","dms-heading",Vn("Value"),2),D(1,"div","dms-fill-row dms-input-duration-edit-row",[Pe(2,Tr,{noInput:!0,onChange:this.onComparisonOperatorChange,options:r,value:e}),Vn(""),Pe(2,Kb,{type:this._type,className:"comparison-duration-input",onInput:this.onComparisonValueChange,value:n})],4)],4)}renderRange(e,n,r,i){var s=[{label:this._translate("Include"),value:"include"},{label:this._translate("Exclude"),value:"exclude"}];return D(1,"div","range",[D(1,"h4","dms-heading",this._translate("Start value"),0),D(1,"div","dms-fill-row dms-input-duration-edit-row",[Pe(2,Tr,{noInput:!0,onChange:this.onRangeStartTypeChange,options:s,value:r}),Vn(""),Pe(2,Kb,{type:this._type,className:"range-start-duration-input",onInput:this.onRangeStartValueChange,value:e})],4),D(1,"h4","dms-heading",this._translate("End value"),0),D(1,"div","dms-fill-row dms-input-duration-edit-row",[Pe(2,Tr,{noInput:!0,onChange:this.onRangeEndTypeChange,options:s,value:i}),Vn(""),Pe(2,Kb,{type:this._type,className:"range-end-duration-input",onInput:this.onRangeEndValueChange,value:n})],4)],4)}render(){var e=this.state,n=e.type,r=e.comparisonOperator,i=e.startValue,s=e.endValue,o=e.rangeStartType,a=e.rangeEndType,l=[{label:this._translate("Comparison"),value:Fh},{label:this._translate("Range"),value:zh}];return D(1,"div","context-menu-container simple-duration-edit",[D(1,"h3","dms-heading",this._translate("Edit duration"),0),D(1,"div","dms-fill-row",Pe(2,Tr,{noInput:!0,onChange:this.onTypeChange,options:l,value:n}),2),n===Fh&&this.renderComparison(r,i),n===zh&&this.renderRange(i,s,o,a)],0)}}function YOe(t){return t.col.businessObject.inputExpression.typeRef}class XOe extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._modeling=n.injector.get("modeling");var r=this.props.context.element;this._type=QOe(r);var i=n.injector.get("debounceInput");this.debouncedEditCell=i(this.editCell.bind(this)),this.editCell=this.editCell.bind(this),this.onInput=this.onInput.bind(this)}editCell(e,n){this._modeling.editCell(e,n)}onInput(e){var n=this.props.context.element;this.debouncedEditCell(n.businessObject,'duration("'.concat(e,'")'))}render(){var e=mG(this.props.context.element.businessObject.text,this._type);return D(1,"div","context-menu-container simple-duration-edit",[D(1,"h3","dms-heading",this._translate("Edit duration"),0),D(1,"h4","dms-heading",this._translate("Set duration"),0),Pe(2,Kb,{onInput:this.onInput,value:e,type:this._type,className:"dms-block"})],4)}}function QOe(t){return t.col.businessObject.typeRef}class vG{constructor(e,n){n.registerProvider(r=>{var i=$5(r);return(cn(r.col)||Xr(r.col))&&M5(i)}),e.onGetComponent("context-menu",function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(r.contextMenuType&&r.contextMenuType==="simple-mode-edit"){if(!r.element)return;var i=$5(r.element);if(M5(i)){if(cn(r.element.col))return KOe;if(Xr(r.element.col))return XOe}}})}}vG.$inject=["components","simpleMode"];function $5(t){return cn(t.col)?t.col&&t.col.businessObject.inputExpression.typeRef:t.col&&t.col.businessObject.typeRef}var ZOe=["yearMonthDuration","dayTimeDuration"];function M5(t){return ZOe.includes(t)}const JOe={__depends__:[Wl,wu],__init__:["simpleDurationEdit"],simpleDurationEdit:["type",vG]};var eRe=/^(-?(?:[0-9]|\.[0-9])+)$|^((?:<|>|=){0,2})\s*(-?(?:[0-9]|\.[0-9])+)$/,tRe=/^(\[|\]){1}(-?(?:[0-9]|\.[0-9])+){1,}\.\.(-?(?:[0-9]|\.[0-9])+){1,}(\[|\]){1}$/,tk={equals:"=",less:"<",lessEquals:"<=",greater:">",greaterEquals:">="};function nRe(t){return Nd(tk).filter(e=>t===tk[e])[0]}function yG(t){if(!t||rRe(t.trim()))return{type:"comparison"};var e=t.match(eRe),n=t.match(tRe);if(e){if(iRe(e))return{type:"comparison",value:parseFloat(e[1]),operator:"equals"};if(sRe(e))return{type:"comparison",value:parseFloat(e[3]),operator:nRe(e[2])}}else if(n)return{type:"range",values:[n[2],n[3]].map(r=>parseFloat(r)),start:n[1]==="]"?"exclude":"include",end:n[4]==="["?"exclude":"include"}}function rRe(t){return t===""}function iRe(t){return t[0]&&t[1]&&!t[2]&&!t[3]}function sRe(t){return t[0]&&!t[1]&&t[2]&&t[3]}function jS(t,e){return t==="equals"?"".concat(e):"".concat(tk[t]," ").concat(e)}function Hm(t,e,n,r){var i=n==="exclude"?"]":"[",s=r==="exclude"?"[":"]";return"".concat(i).concat(t,"..").concat(e).concat(s)}var Hh="comparison",Uh="range";class oRe extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._modeling=n.injector.get("modeling");var r=this.props.context.element,i=yG(r.businessObject.text);i?this.state={type:i.type,comparisonOperator:i.operator||"equals",comparisonValue:i.value||0,rangeStartValue:i.values?i.values[0]:0,rangeEndValue:i.values?i.values[1]:0,rangeStartType:i.start||"include",rangeEndType:i.end||"include"}:this.state={type:Hh,comparisonOperator:"equals",comparisonValue:0,rangeStartValue:0,rangeEndValue:0,rangeStartType:"include",rangeEndType:"include"};var s=n.injector.get("debounceInput");this.debouncedEditCell=s(this.editCell.bind(this)),this.editCell=this.editCell.bind(this),this.onComparisonOperatorChange=this.onComparisonOperatorChange.bind(this),this.onComparisonValueChange=this.onComparisonValueChange.bind(this),this.onTypeChange=this.onTypeChange.bind(this),this.onRangeStartTypeChange=this.onRangeStartTypeChange.bind(this),this.onRangeStartValueChange=this.onRangeStartValueChange.bind(this),this.onRangeEndTypeChange=this.onRangeEndTypeChange.bind(this),this.onRangeEndValueChange=this.onRangeEndValueChange.bind(this)}editCell(e,n){this._modeling.editCell(e,n)}onTypeChange(e){var n=this.props.context.element,r=this.state,i=r.comparisonOperator,s=r.comparisonValue,o=r.rangeStartValue,a=r.rangeEndValue,l=r.rangeStartType,c=r.rangeEndType;e===Hh?this.editCell(n.businessObject,jS(i,s)):this.editCell(n.businessObject,Hm(o,a,l,c)),this.setState({type:e})}onComparisonOperatorChange(e){var n=this.props.context.element,r=this.state,i=r.type,s=r.comparisonValue;i===Hh&&(this.editCell(n.businessObject,jS(e,s)),this.setState({comparisonOperator:e}))}onComparisonValueChange(e){var n=this.props.context.element,r=this.state,i=r.type,s=r.comparisonOperator;i===Hh&&(this.debouncedEditCell(n.businessObject,jS(s,e)),this.setState({comparisonValue:e}))}onRangeStartTypeChange(e){var n=this.props.context.element,r=this.state,i=r.type,s=r.rangeStartValue,o=r.rangeEndValue,a=r.rangeEndType;i===Uh&&(this.editCell(n.businessObject,Hm(s,o,e,a)),this.setState({rangeStartType:e}))}onRangeStartValueChange(e){var n=this.props.context.element,r=this.state,i=r.type,s=r.rangeEndValue,o=r.rangeStartType,a=r.rangeEndType;i===Uh&&(this.editCell(n.businessObject,Hm(e,s,o,a)),this.setState({rangeStartValue:e}))}onRangeEndTypeChange(e){var n=this.props.context.element,r=this.state,i=r.type,s=r.rangeStartValue,o=r.rangeEndValue,a=r.rangeStartType;i===Uh&&(this.editCell(n.businessObject,Hm(s,o,a,e)),this.setState({rangeEndType:e}))}onRangeEndValueChange(e){var n=this.props.context.element,r=this.state,i=r.type,s=r.rangeStartValue,o=r.rangeStartType,a=r.rangeEndType;i===Uh&&(this.editCell(n.businessObject,Hm(s,e,o,a)),this.setState({rangeEndValue:e}))}renderComparison(e,n){var r=[{label:this._translate("Equals"),value:"equals"},{label:this._translate("Less"),value:"less"},{label:this._translate("Less or equals"),value:"lessEquals"},{label:this._translate("Greater"),value:"greater"},{label:this._translate("Greater or equals"),value:"greaterEquals"}];return D(1,"div","comparison",[D(1,"h4","dms-heading",this._translate("Value"),0),D(1,"div","dms-fill-row",[Pe(2,Tr,{noInput:!0,onChange:this.onComparisonOperatorChange,options:r,value:e}),Vn(""),Pe(2,Ed,{className:"comparison-number-input",onInput:this.onComparisonValueChange,type:"number",value:n})],4)],4)}renderRange(e,n,r,i){var s=[{label:this._translate("Include"),value:"include"},{label:this._translate("Exclude"),value:"exclude"}];return D(1,"div","range",[D(1,"h4","dms-heading",this._translate("Start value"),0),D(1,"div","dms-fill-row",[Pe(2,Tr,{noInput:!0,onChange:this.onRangeStartTypeChange,options:s,value:r}),Vn(""),Pe(2,Ed,{className:"range-start-number-input",onInput:this.onRangeStartValueChange,type:"number",value:e})],4),D(1,"h4","dms-heading",this._translate("End value"),0),D(1,"div","dms-fill-row",[Pe(2,Tr,{noInput:!0,onChange:this.onRangeEndTypeChange,options:s,value:i}),Vn(""),Pe(2,Ed,{className:"range-end-number-input",onInput:this.onRangeEndValueChange,type:"number",value:n})],4)],4)}render(){var e=this.state,n=e.type,r=e.comparisonOperator,i=e.comparisonValue,s=e.rangeStartValue,o=e.rangeEndValue,a=e.rangeStartType,l=e.rangeEndType,c=[{label:this._translate("Comparison"),value:Hh},{label:this._translate("Range"),value:Uh}];return D(1,"div","context-menu-container simple-number-edit",[D(1,"h3","dms-heading",this._translate("Edit number"),0),D(1,"div","dms-fill-row",Pe(2,Tr,{noInput:!0,onChange:this.onTypeChange,options:c,value:n}),2),n===Hh&&this.renderComparison(r,i),n===Uh&&this.renderRange(s,o,a,l)],0)}}class aRe extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._modeling=n.injector.get("modeling");var r=this.props.context.element,i=yG(r.businessObject.text);i?this.state={value:i.value}:this.state={value:""};var s=n.injector.get("debounceInput");this.debouncedEditCell=s(this.editCell.bind(this)),this.editCell=this.editCell.bind(this),this.onInput=this.onInput.bind(this)}editCell(e,n){this._modeling.editCell(e,n)}onInput(e){var n=this.props.context.element;this.debouncedEditCell(n.businessObject,e),this.setState({value:e})}render(){var e=this.state.value;return D(1,"div","context-menu-container simple-number-edit",[D(1,"h3","dms-heading",this._translate("Edit number"),0),D(1,"h4","dms-heading",this._translate("Set value"),0),Pe(2,Ed,{onInput:this.onInput,type:"number",value:e})],4)}}class xG{constructor(e,n){n.registerProvider(r=>{var i=L5(r);return(cn(r.col)||Xr(r.col))&&B5(i)}),e.onGetComponent("context-menu",function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(r.contextMenuType&&r.contextMenuType==="simple-mode-edit"){if(!r.element)return;var i=L5(r.element);if(B5(i)){if(cn(r.element.col))return oRe;if(Xr(r.element.col))return aRe}}})}}xG.$inject=["components","simpleMode"];function L5(t){return cn(t.col)?t.col&&t.col.businessObject.inputExpression.typeRef:t.col&&t.col.businessObject.typeRef}var lRe=["number","integer","long","double"];function B5(t){return lRe.includes(t)}const cRe={__depends__:[Wl,wu],__init__:["simpleNumberEdit"],simpleNumberEdit:["type",xG]};function hb(t){if(!t||bG(t.trim()))return{type:"disjunction",values:[]};var e=t.split(","),n={type:"disjunction",values:[]},r="";if(e.forEach(s=>{r+=s,/^"[^"]*"$/.test(r.trim())?(n.values.push(r.trim()),r=""):r+=","}),!r)return n;n.type="negation",n.values=[],r="";var i=t.match(/^\s*not\((.*)\)\s*$/);if(i&&(e=i[1].split(","),e.forEach(s=>{r+=s,/^"[^"]*"$/.test(r.trim())?(n.values.push(r.trim()),r=""):r+=","}),!r))return n}function uRe(t){var e=cn(t)?t.inputValues:t.outputValues;return!e||bG(e.text)?[]:e.text.split(",").map(n=>n.trim())}function bG(t){return t===""}var qu="disjunction",pb="negation",dRe="Predefined values",hRe="Predefined values",pRe="Custom values";class fRe extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._modeling=n.injector.get("modeling");var r=hb(e.context.element.businessObject.text);r||(r={values:[],type:qu});var i=uRe(e.context.element.col.businessObject),s=r.values.filter(d=>!PS(i,d)),o=cn(e.context.element.col),a=i.map(d=>({value:d,isChecked:PS(r.values,d),isRemovable:!1,group:o?this._translate(dRe):this._translate(hRe)}));o&&(a=a.concat(s.map(d=>({value:d,isChecked:!0,isRemovable:!0,group:this._translate(pRe)}))));var l="";!o&&r.values.length&&!PS(i,r.values[0])&&(l=r.values[0]),this.state={items:a,unaryTestsType:r.type,inputValue:l,isOutputValueInputChecked:l!==""};var c=n.injector.get("debounceInput");this.debouncedEditCell=c(this.editCell.bind(this)),this.editCell=this.editCell.bind(this),this.addUnaryTestsListItem=this.addUnaryTestsListItem.bind(this),this.onInput=this.onInput.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onOutputValueInputClick=this.onOutputValueInputClick.bind(this),this.onUnaryTestsListChanged=this.onUnaryTestsListChanged.bind(this),this.onUnaryTestsTypeChange=this.onUnaryTestsTypeChange.bind(this)}editCell(e,n){this._modeling.editCell(e,n)}onUnaryTestsTypeChange(e){var n=this.state.items,r=kS(n),i=this.props.context.element;e===qu?(this.editCell(i.businessObject,r.join(",")),this.setState({unaryTestsType:qu})):(this.editCell(i.businessObject,"not(".concat(r.join(","),")")),this.setState({unaryTestsType:pb}))}onUnaryTestsListChanged(e){var n=kS(e),r=this.props.context.element,i=this.state.unaryTestsType;i===qu?this.editCell(r.businessObject,n.join(",")):this.editCell(r.businessObject,"not(".concat(n.join(","),")")),this.setState({items:e,isOutputValueInputChecked:!1})}onOutputValueInputClick(){var e=this.props.context.element,n=this.state,r=n.inputValue,i=n.items,s=hb(r);!s||s.values.length>1||(this.editCell(e.businessObject,"".concat(s.values.join(""))),this.setState({items:i.map(o=>(o.isChecked=!1,o)),isOutputValueInputChecked:!0}))}onInput(e){var n=e.isValid,r=e.value,i=this.state.isOutputValueInputChecked;this.setState({inputValue:r});var s=this.props.context.element;!cn(s)&&n&&i&&this.debouncedEditCell(s.businessObject,r)}onKeyDown(e){var n=e.isValid,r=e.event;if(mRe(r.keyCode)){var i=this.props.context.element,s=cn(i.col);(s||!n)&&(r.stopPropagation(),r.preventDefault()),n&&(s?this.addUnaryTestsListItem():this.onOutputValueInputClick())}}addUnaryTestsListItem(){var e=this.state,n=e.inputValue,r=e.items,i=e.unaryTestsType,s=hb(n);if(s){var o=this.props.context.element,a=kS(r),l=[].concat(a,s.values);i===qu?this.editCell(o.businessObject,l.join(",")):this.editCell(o.businessObject,"not(".concat(l.join(","),")"));var c=r.concat(s.values.map(d=>({value:d,isChecked:!0,isRemovable:!0,group:this._translate("Custom values")})));this.setState({items:c,inputValue:""})}}render(){var e=this.props.context.element,n=this.state,r=n.inputValue,i=n.isOutputValueInputChecked,s=n.items,o=n.unaryTestsType,a=[{label:this._translate("Match one"),value:qu},{label:this._translate("Match none"),value:pb}],l=cn(e.col),c=o===pb,d=!l&&s.length>0;return D(1,"div","simple-string-edit context-menu-container",[D(1,"h3","dms-heading",this._translate("Edit string"),0),l&&D(1,"p",null,Pe(2,Tr,{noInput:!0,onChange:this.onUnaryTestsTypeChange,options:a,value:c?pb:qu},null,h=>this.selectNode=h),2),Pe(2,I7,{onChange:this.onUnaryTestsListChanged,items:s,type:l?"checkbox":"radio"}),l?D(1,"h4","dms-heading",this._translate("Add values"),0):D(1,"h4","dms-heading",this._translate("Set value"),0),D(1,"div","dms-fill-row",[d&&D(64,"input","cursor-pointer",null,1,{checked:i,onClick:this.onOutputValueInputClick,type:"radio",style:{marginRight:"8px"}}),Pe(2,so,{className:"dms-block",onKeyDown:this.onKeyDown,onInput:this.onInput,placeholder:l?this._translate('"value", "value", ...'):this._translate('"value"'),type:"text",validate:h=>{if(!hb(h))return this._translate("Strings must be in double quotes")},value:r})],0)],0)}}function mRe(t){return t===13}function kS(t){return t.filter(e=>e.isChecked).map(e=>e.value)}function PS(t,e){return t.indexOf(e)!==-1}class wG{constructor(e,n){n.registerProvider(r=>(cn(r.col)||Xr(r.col))&&F5(r)==="string"),e.onGetComponent("context-menu",function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(r.contextMenuType&&r.contextMenuType==="simple-mode-edit"){if(!r.element)return;var i=F5(r.element);if(i==="string")return fRe}})}}wG.$inject=["components","simpleMode"];function F5(t){return cn(t.col)?t.col&&t.col.businessObject.inputExpression.typeRef:t.col&&t.col.businessObject.typeRef}const gRe={__depends__:[Wl,wu],__init__:["simpleStringEdit"],simpleStringEdit:["type",wG]};var vRe=/^(?:\d\d:){2}\d\d(?:Z|(?:[@+-][^")]+))?$/,yRe=/^\[time\("([^"]*)"\)..time\("([^"]*)"\)\]$/,xRe=/^(<|>)\s*time\("([^"]*)"\)$/,bRe=/^time\("([^"]*)"\)$/,wRe="exact",_Re="before",ERe="after",SRe="between";function lp(t){if(!vRe.test(t.trim()))return"Time must match pattern hh:mm:ss[time zone]"}function fc(t,e){if(t===wRe)return'time("'.concat(e[0],'")');if(t===_Re)return'< time("'.concat(e[0],'")');if(t===ERe)return'> time("'.concat(e[0],'")');if(t===SRe)return'[time("'.concat(e[0],'")..time("').concat(e[1],'")]')}function nk(){var t=new Date;return t.toISOString().slice(11,-5)+"Z"}function Zm(t){if(!t||t.trim()==="")return{type:"exact",time:""};var e=t.match(yRe);if(e)return{type:"between",times:[e[1],e[2]]};if(e=t.match(xRe),e)return{type:e[1]==="<"?"before":"after",time:e[2]};if(e=t.match(bRe),e)return{type:"exact",time:e[1]}}var z5="exact",CRe="before",jRe="after",fb="between";class kRe extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._modeling=n.injector.get("modeling");var r=this.props.context.element,i=Zm(r.businessObject.text);if(i){var s;i.time?s=[i.time,""]:i.times?s=i.times:s=["",""],this.state={type:i.type,times:s}}else this.state={type:z5,times:["",""]};var o=n.injector.get("debounceInput");this.debouncedEditCell=o(this.editCell.bind(this)),this.editCell=this.editCell.bind(this),this.onTypeChange=this.onTypeChange.bind(this),this.onSetStartTimeNowClick=this.onSetStartTimeNowClick.bind(this),this.onSetEndTimeNowClick=this.onSetEndTimeNowClick.bind(this),this.onStartTimeInput=this.onStartTimeInput.bind(this),this.onEndTimeInput=this.onEndTimeInput.bind(this)}editCell(e,n){this._modeling.editCell(e,n)}onTypeChange(e){var n=this.props.context.element,r=this.state.times;this.setState({type:e}),Zm(fc(e,r))&&this.editCell(n.businessObject,fc(e,r))}onSetStartTimeNowClick(){var e=this.props.context.element,n=this.state,r=n.times,i=n.type,s=nk();this.setState({times:[s,r[1]]}),Zm(fc(i,[s,r[1]]))&&this.editCell(e.businessObject,fc(i,[s,r[1]]))}onSetEndTimeNowClick(){var e=this.props.context.element,n=this.state,r=n.times,i=n.type,s=nk();this.setState({times:[r[0],s]}),Zm(fc(i,[r[0],s]))&&this.editCell(e.businessObject,fc(i,[r[0],s]))}onStartTimeInput(e){var n=e.value,r=this.props.context.element,i=this.state,s=i.times,o=i.type;this.setState({times:[n,s[1]]}),this.debouncedEditCell(r.businessObject,fc(o,[n,s[1]]))}onEndTimeInput(e){var n=e.value,r=this.props.context.element,i=this.state,s=i.times,o=i.type;this.setState({times:[s[0],n]}),this.debouncedEditCell(r.businessObject,fc(o,[s[0],n]))}render(){var e=this.state,n=e.times,r=e.type,i=[{label:this._translate("Exactly"),value:z5},{label:this._translate("Before"),value:CRe},{label:this._translate("After"),value:jRe},{label:this._translate("Between"),value:fb}];return D(1,"div","context-menu-container simple-time-edit",[D(1,"h3","dms-heading",this._translate("Edit time"),0),D(1,"div","dms-fill-row",Pe(2,Tr,{noInput:!0,onChange:this.onTypeChange,options:i,value:r}),2),D(1,"h4","dms-heading",r===fb?this._translate("Edit start time"):this._translate("Set time"),0),D(1,"div",null,[Pe(2,so,{className:"start-time-input dms-block",onInput:this.onStartTimeInput,placeholder:this._translate("e.g. { example } ",{example:fl()}),validate:s=>lp(s)&&this._translate(lp(s)),value:n[0]}),D(1,"p","dms-hint",[D(1,"button","use-now",this._translate("Use now"),0,{type:"button",onClick:this.onSetStartTimeNowClick}),Vn(".")],4)],4),r===fb&&D(1,"h4","dms-heading",this._translate("Edit end time"),0),r===fb&&D(1,"div",null,[Pe(2,so,{className:"end-time-input dms-block",onInput:this.onEndTimeInput,placeholder:this._translate("e.g. { example } ",{example:fl()}),validate:s=>lp(s)&&this._translate(lp(s)),value:n[1]}),D(1,"p","dms-hint",[D(1,"button","use-now",this._translate("Use now"),0,{type:"button",onClick:this.onSetEndTimeNowClick}),Vn(".")],4)],4)],0)}}class PRe extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._modeling=n.injector.get("modeling");var r=this.props.context.element,i=Zm(r.businessObject.text);this.state={date:i?i.date:""};var s=n.injector.get("debounceInput");this.debouncedEditCell=s(this.editCell.bind(this)),this.editCell=this.editCell.bind(this),this.onClick=this.onClick.bind(this),this.onInput=this.onInput.bind(this)}editCell(e,n){this._modeling.editCell(e,n)}onClick(){var e=this.props.context.element,n=nk();this.setState({date:n}),this.editCell(e.businessObject,'time("'.concat(n,'")'))}onInput(e){var n=e.value,r=this.props.context.element;this.setState({date:n}),this.debouncedEditCell(r.businessObject,'time("'.concat(n,'")'))}render(){var e=this.state.date;return D(1,"div","context-menu-container simple-time-edit",[D(1,"h3","dms-heading",this._translate("Edit date"),0),D(1,"h4","dms-heading",this._translate("Set date"),0),D(1,"div",null,[Pe(2,so,{onInput:this.onInput,placeholder:this._translate("e.g. { example } ",{example:fl()}),validate:n=>lp(n)&&this._translate(lp(n)),value:e,className:"dms-block"}),D(1,"p","dms-hint",[D(1,"button","use-now",this._translate("Use now"),0,{type:"button",onClick:this.onClick}),Vn(".")],4)],4)],4)}}class _G{constructor(e,n){n.registerProvider(r=>{var i=H5(r);return(cn(r.col)||Xr(r.col))&&U5(i)}),e.onGetComponent("context-menu",function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(r.contextMenuType&&r.contextMenuType==="simple-mode-edit"){if(!r.element)return;var i=H5(r.element);if(U5(i)){if(cn(r.element.col))return kRe;if(Xr(r.element.col))return PRe}}})}}_G.$inject=["components","simpleMode"];function H5(t){return cn(t.col)?t.col&&t.col.businessObject.inputExpression.typeRef:t.col&&t.col.businessObject.typeRef}function U5(t){return t==="time"}const TRe={__depends__:[Wl,wu],__init__:["simpleTimeEdit"],simpleTimeEdit:["type",_G]};function TS(t,e,n){return e=NRe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function NRe(t){var e=ORe(t,"string");return typeof e=="symbol"?e:String(e)}function ORe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class EG extends Ve{constructor(e,n){super(e,n),TS(this,"onElementsChanged",()=>{this.forceUpdate()}),TS(this,"handleMouseDown",r=>{var i=ur(r.target,"th",!1);RRe({node:i,event:r,minWidth:this.props.minWidth||150,onEnd:this.saveWidth})}),TS(this,"saveWidth",r=>{var i=this.props.col,s={};Y(i,"dmn:DecisionTable")?s.annotationsWidth=r:s.width=r,this.modeling.updateProperties(i,s)}),hi(this)}componentDidMount(){var e=this.getRoot();this.changeSupport.onElementsChanged(e,this.onElementsChanged)}componentWillUnmount(){var e=this.getRoot();this.changeSupport.offElementsChanged(e,this.onElementsChanged)}getRoot(){return this.sheet.getRoot()}isLastInputOrOutput(){var e=this.props.col,n=this.getRoot(),r=jl(n);if(Y(e,"dmn:InputClause")){var i=r.get("input");return i.indexOf(e)===i.length-1}else if(Y(e,"dmn:OutputClause")){var s=r.get("output");return s.indexOf(e)===s.length-1}}render(){var e=this.isLastInputOrOutput()?{right:"-7px",width:"27px"}:null;return D(1,"div","resize-column-handle",null,1,{onMouseDown:this.handleMouseDown,title:this.translate("Resize"),style:e})}}EG.$inject=["sheet","changeSupport","translate","modeling"];function RRe(t){var e=t.node,n=t.event,r=t.minWidth,i=t.onEnd,s=i===void 0?ARe:i;n.preventDefault();var o=e.getBoundingClientRect().width,a=n.clientX,l;document.addEventListener("mousemove",c),document.addEventListener("mouseup",d);function c(p){p.preventDefault();var f=h(p.clientX);l&&cancelAnimationFrame(l),l=requestAnimationFrame(()=>{e.style.width=f+"px"})}function d(p){p.preventDefault(),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",d);var f=h(p.clientX);s(f)}function h(p){var f=p-a;return Math.max(o+f,r)}}function ARe(){}function SG(t){t.onGetComponent("cell-inner",function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.cellType;if(n==="input-cell"||n==="output-cell"||n==="annotations")return EG})}SG.$inject=["components"];const IRe={__init__:["columnResizeProvider"],columnResizeProvider:["type",SG]};let DRe=class CG extends nM{getModules(){return[...nM._getModules(),...CG._getModules()]}static _getModules(){return[b_e,z_e,n1,hh,bq,a1e,m1e,aN,x1e,Gf,HTe,IRe,oNe,gNe,vNe,uh,Wl,SNe,Eq,PNe,nN,UNe,QNe,t1,wu,dOe,SOe,MOe,JOe,cRe,gRe,TRe,PV]}};class jG{constructor(e){this._listeners={},e.on("elements.changed",n=>{var r=n.elements;this.elementsChanged(r)}),e.on("element.updateId",n=>{var r=n.element,i=n.newId;this.updateId(r.id,i)})}elementsChanged(e){for(var n={},r=e.length,i=0;i<r;i++){var s=e[i].id;if(n[s])return;n[s]=!0;var o=this._listeners[s]&&this._listeners[s].length;if(o)for(var a=0;a<o;a++)this._listeners[s][a]&&this._listeners[s][a]()}}onElementsChanged(e,n){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e][this._listeners[e].length]=n}offElementsChanged(e,n){if(this._listeners[e])if(n){var r=this._listeners[e].indexOf(n);r!==-1&&this._listeners[e].splice(r,1)}else this._listeners[e].length=0}updateId(e,n){this._listeners[e]&&(this._listeners[n]=this._listeners[e],delete this._listeners[e])}}jG.$inject=["eventBus"];var $Re=1e3;class MRe{constructor(){this._listeners={}}getComponent(e,n){var r=this._listeners[e];if(r){for(var i,s=0;s<r.length&&(i=r[s].callback(n),!i);s++);return i}}getComponents(e,n){var r=this._listeners[e];if(r){for(var i=[],s=0;s<r.length;s++){var o=r[s].callback(n);o&&i.push(o)}if(i.length)return i}}onGetComponent(e,n,r){if(Bt(n)&&(r=n,n=$Re),!Oe(n))throw new Error("priority must be a number");var i=this._getListeners(e),s,o,a={priority:n,callback:r};for(o=0;s=i[o];o++)if(s.priority<n){i.splice(o,0,a);return}i.push(a)}offGetComponent(e,n){var r=this._getListeners(e),i,s,o;if(n)for(o=r.length-1;i=r[o];o--)s=i.callback,s===n&&r.splice(o,1);else r.length=0}_getListeners(e){var n=this._listeners[e];return n||(this._listeners[e]=n=[]),n}}class LRe extends Ve{constructor(e){super(e);var n=this._injector=e.injector;this._changeSupport=n.get("changeSupport"),this._components=n.get("components"),this._renderer=n.get("renderer")}getChildContext(){return{changeSupport:this._changeSupport,components:this._components,renderer:this._renderer,injector:this._injector}}render(){var e=this._components.getComponents("viewer");return D(1,"div","viewer-container",e&&e.map((n,r)=>Pe(2,n,null,r)),0)}}class kG{constructor(e,n,r,i,s){var o=r.container;this._container=o,i.on("renderer.mount",()=>{P0(Pe(2,LRe,{injector:s}),o)}),i.on("renderer.unmount",()=>{P0(null,o)})}getContainer(){return this._container}}kG.$inject=["changeSupport","components","config.renderer","eventBus","injector"];const BRe={__init__:["changeSupport","components","renderer"],changeSupport:["type",jG],components:["type",MRe],eventBus:["type",Wi],renderer:["type",kG]};var FRe=["modules"];function zRe(t,e){if(t==null)return{};var n=HRe(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function HRe(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}let URe=class{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.injector;if(!n){var r=this._init(e),i=r.modules,s=r.config;n=VRe(s,i)}this.get=n.get,this.invoke=n.invoke,this.get("eventBus").fire("viewer.init")}_init(e){var n=e.modules,r=zRe(e,FRe);return{modules:n,config:r}}destroy(){var e=this.get("eventBus");e.fire("viewer.destroy")}clear(){var e=this.get("eventBus");e.fire("viewer.clear")}};function VRe(t,e){var n=[{config:["value",t]},BRe].concat(e||[]),r=new Rk(n);return r.init(),r}function qRe(t,e){return e=e||{},t.replace(/{([^}]+)}/g,function(n,r){return e[r]||"{"+r+"}"})}const WRe={translate:["value",qRe]};class PG{constructor(e,n){this._eventBus=n,this._viewer=e}getDecision(){return this._viewer.getDecision()}updateId(e,n){var r=this.getDecision();if(e!==r)throw new Error("element !== decision");this._eventBus.fire("element.updateId",{element:e,newId:n}),e.id=n}}PG.$inject=["viewer","eventBus"];const GRe={__init__:["elementRegistry"],elementRegistry:["type",PG]};class KRe extends Ve{constructor(e,n){super(e,n),this._viewer=n.injector.get("viewer")}render(){var e=this._viewer.getDecision(),n=e.name;return D(1,"div","decision-properties",D(1,"h3","decision-name",n,0),2)}}var YRe=1500;let TG=class{constructor(e){e.onGetComponent("viewer",YRe,()=>KRe)}};TG.$inject=["components"];const XRe={__init__:["decisionProperties"],decisionProperties:["type",TG]};let QRe=class extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._viewer=n.injector.get("viewer")}render(){var e=this._viewer.getDecision(),n=e.decisionLogic,r=e.variable;return D(1,"div","literal-expression-properties",D(1,"table",null,[D(1,"tr",null,[D(1,"td",null,this._translate("Variable name:"),0),D(1,"td",null,D(1,"span",null,r.name||"-",0),2)],4),D(1,"tr",null,[D(1,"td",null,this._translate("Variable type:"),0),D(1,"td",null,D(1,"span",null,this._translate(r.typeRef||"")||"-",0),2)],4),D(1,"tr",null,[D(1,"td",null,this._translate("Expression language:"),0),D(1,"td",null,D(1,"span",null,n.expressionLanguage||"-",0),2)],4)],4),2)}};var ZRe=500;class NG{constructor(e){e.onGetComponent("viewer",ZRe,()=>QRe)}}NG.$inject=["components"];const JRe={__depends__:[],__init__:["literalExpressionProperties"],literalExpressionProperties:["type",NG]};var eAe=2e3;class OG{constructor(e){e.onGetComponent("viewer",eAe,()=>KH)}}OG.$inject=["components"];const tAe={__init__:["poweredBy"],poweredBy:["type",OG]};class nAe extends Ve{constructor(e,n){super(e,n),this._viewer=n.injector.get("viewer")}render(){var e=this._viewer.getDecision().decisionLogic.text;return D(1,"div","textarea",D(1,"div","content",e,0),2)}}let RG=class{constructor(e){e.onGetComponent("viewer",()=>nAe)}};RG.$inject=["components"];const rAe={__init__:["textarea"],textarea:["type",RG]};function iAe(t,e,n){return e=sAe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function sAe(t){var e=oAe(t,"string");return typeof e=="symbol"?e:String(e)}function oAe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class AG extends Ve{constructor(e,n){super(e,n),iAe(this,"onClick",()=>{this._eventBus.fire("showDrd")});var r=n.injector;this._translate=r.get("translate"),this._eventBus=r.get("eventBus")}render(){return D(1,"div","view-drd",D(1,"button","view-drd-button",this._translate("View DRD"),0,{type:"button",onClick:this.onClick}),2,null,null,e=>this.node=e)}}AG.$inject=["translate"];var aAe=2e3;class IG{constructor(e,n,r,i){this._injector=i,this._viewer=n,e.onGetComponent("viewer",aAe,()=>{if(this.canViewDrd())return AG}),r.on("showDrd",()=>{var s=i.get("_parent",!1),o=this.getDefinitions(),a=s.getView(o);s.open(a)})}canViewDrd(){var e=this._injector.get("_parent",!1);if(e){var n=this.getDefinitions();return!!e.getView(n)}}getDefinitions(){return lAe(this._viewer.getDecision())}}IG.$inject=["components","viewer","eventBus","injector"];function lAe(t){var e=t.$parent;return e}const cAe={__init__:["viewDrd"],viewDrd:["type",IG]};var uAe=["modules","additionalModules"];function dAe(t,e){if(t==null)return{};var n=hAe(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function hAe(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}class sv extends URe{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=sv._createContainer();super(B(e,{renderer:{container:n}})),this._container=n}open(e){var n=this;return new Promise(function(r,i){var s;try{n._decision&&(n.clear(),n.get("eventBus").fire("renderer.unmount")),n._decision=e,n.get("eventBus").fire("import",e),n.get("eventBus").fire("renderer.mount")}catch(o){s=o}s?(s.warnings=s.warnings||[],i(s)):r({warnings:[]})})}_init(e){var n=e.modules,r=e.additionalModules,i=dAe(e,uAe),s=n||this.getModules(),o=r||[],a=[{viewer:["value",this]}],l=[...s,...o,...a];return{modules:l,config:i}}on(e,n,r,i){return this.get("eventBus").on(e,n,r,i)}off(e,n){this.get("eventBus").off(e,n)}_emit(e,n){return this.get("eventBus").fire(e,n)}getDecision(){return this._decision}attachTo(e){if(!e)throw new Error("parentNode required");this.detach(),e.appendChild(this._container),this._emit("attach",{})}detach(){var e=this._container,n=e.parentNode;n&&(this._emit("detach",{}),Nr(e))}destroy(){super.destroy(),this.detach()}getModules(){return sv._getModules()}static _getModules(){return[GRe,WRe,XRe,JRe,tAe,rAe,cAe]}static _createContainer(){return bt('<div class="dmn-literal-expression-container"></div>')}}function V5(t,e,n){return e=pAe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pAe(t){var e=fAe(t,"string");return typeof e=="symbol"?e:String(e)}function fAe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class mAe extends Ve{constructor(e,n){super(e,n),V5(this,"onElementsChanged",()=>{this.forceUpdate()}),V5(this,"setDecisionName",r=>{this._modeling.editDecisionName(r)}),this._viewer=n.injector.get("viewer"),this._modeling=n.injector.get("modeling"),this.setupChangeListeners({bind:this.getDecision().id})}componentWillUnmount(){this.setupChangeListeners({unbind:this.getDecision().id})}getDecision(){return this._viewer.getDecision()}setupChangeListeners(e){var n=e.bind,r=e.unbind,i=this.context.changeSupport;typeof r=="string"&&i.offElementsChanged(r,this.onElementsChanged),typeof n=="string"&&i.onElementsChanged(n,this.onElementsChanged)}render(){var e=this.getDecision(),n=e.name;return D(1,"header","decision-properties",Pe(2,gAe,{className:"decision-name editor",value:n,onBlur:vAe,onChange:this.setDecisionName}),2)}}class gAe extends vy{render(){return D(1,"h3",this.getClassName(),this.getEditor(),0)}}function vAe(t){t.target.scroll(0,0)}var yAe=1500;class DG{constructor(e){e.onGetComponent("viewer",yAe,()=>mAe)}}DG.$inject=["components"];const xAe={__depends__:[dh],__init__:["decisionProperties"],decisionProperties:["type",DG]};var q5="is not a registered action",bAe="is already registered";let $G=class{constructor(e,n){this._actions={undo(){e.undo()},redo(){e.redo()}}}trigger(e,n){if(!this._actions[e])throw NS(e,q5);return this._actions[e](n)}register(e,n){if(typeof e=="string")return this._registerAction(e,n);$(e,(r,i)=>{this._registerAction(i,r)})}_registerAction(e,n){if(this.isRegistered(e))throw NS(e,bAe);this._actions[e]=n}unregister(e){if(!this.isRegistered(e))throw NS(e,q5);this._actions[e]=void 0}isRegistered(e){return!!this._actions[e]}};$G.$inject=["commandStack","eventBus"];function NS(t,e){return new Error(t+" "+e)}const wAe={__init__:["editorActions"],editorActions:["type",$G]};function W5(t){return t.altKey?!1:t.ctrlKey||t.metaKey}function G5(t){return t.shiftKey}function mb(t,e,n){return e=_Ae(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _Ae(t){var e=EAe(t,"string");return typeof e=="symbol"?e:String(e)}function EAe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class MG{constructor(e,n,r){mb(this,"_init",()=>{this._registerDefaultBindings(),this._fire("init")}),mb(this,"_destroy",()=>{this._fire("destroy"),this.unbind(),this._listeners=null}),mb(this,"_keyHandler",i=>{var s,o,a=this._listeners,l=i.keyCode||i.charCode||-1;for(s=0;o=a[s];s++)if(o(l,i)){i.preventDefault(),i.stopPropagation();return}}),mb(this,"unbind",()=>{var i=this._node;i&&(this._fire("unbind"),ie.unbind(i,"keydown",this._keyHandler,!0)),this._node=null}),this._config=e||{},this._eventBus=n,this._editorActions=r,this._listeners=[],n.on("viewer.destroy",this._destroy),n.on("viewer.init",this._init),n.on("attach",()=>{this._config.bindTo&&this.bind(e.bindTo)}),n.on("detach",this.unbind)}bind(e){this.unbind(),this._node=e,ie.bind(e,"keydown",this._keyHandler,!0),this._fire("bind")}getBinding(){return this._node}_fire(e){this._eventBus.fire("keyboard."+e,{node:this._node,listeners:this._listeners})}_registerDefaultBindings(){var e=this._listeners,n=this._editorActions;function r(s,o){if(W5(o)&&!G5(o)&&s===90)return n.trigger("undo"),!0}function i(s,o){if(W5(o)&&(s===89||s===90&&G5(o)))return n.trigger("redo"),!0}e.push(r),e.push(i)}addListener(e){this._listeners.unshift(e)}removeListener(e){this._listeners=this._listeners.filter(n=>n!==e)}}MG.$inject=["config.keyboard","eventBus","editorActions"];const LG={__depends__:[wAe],__init__:["keyboard"],keyboard:["type",MG]};class SAe extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._viewer=n.injector.get("viewer"),this._modeling=n.injector.get("modeling"),this._dataTypes=n.injector.get("dataTypes");var r=this._viewer.getDecision();this.state={name:r.variable.name,typeRef:r.variable.typeRef},this.setVariableName=this.setVariableName.bind(this),this.setVariableType=this.setVariableType.bind(this)}setVariableName(e){this._modeling.editVariableName(e),this.setState({name:e})}setVariableType(e){e===""?(this._modeling.editVariableType(void 0),this.setState({typeRef:void 0})):(this._modeling.editVariableType(e),this.setState({typeRef:e}))}render(){var e=this.state,n=e.name,r=e.typeRef,i=this._dataTypes.getAll().map(s=>({label:this._translate(s),value:s}));return D(1,"div","literal-expression-properties",D(1,"table",null,[D(1,"tr",null,[D(1,"td",null,this._translate("Variable name:"),0),D(1,"td",null,Pe(2,Ed,{className:"variable-name-input",onInput:this.setVariableName,placeholder:this._translate("name"),value:n||""}),2)],4),D(1,"tr",null,[D(1,"td",null,this._translate("Variable type:"),0),D(1,"td",null,D(1,"div","dms-fill-row",Pe(2,Tr,{onChange:this.setVariableType,options:i,value:r,className:"variable-type-select dms-block"}),2),2)],4),Pe(2,CAe)],4),2)}}class CAe extends Ve{constructor(e,n){super(e,n),this._translate=n.injector.get("translate"),this._viewer=n.injector.get("viewer"),this._modeling=n.injector.get("modeling"),this._expressionLanguages=n.injector.get("expressionLanguages"),this.setExpressionLanguage=this.setExpressionLanguage.bind(this)}setExpressionLanguage(e){e===""?this._modeling.editExpressionLanguage(void 0):this._modeling.editExpressionLanguage(e)}_getExpressionLanguage(){var e=this._viewer.getDecision(),n=e.decisionLogic;return n&&n.expressionLanguage?n.expressionLanguage.toLowerCase():this._getDefaultExpressionLanguage()}_getDefaultExpressionLanguage(){return this._expressionLanguages.getDefault().value}_shouldRender(){var e=this._expressionLanguages.getAll();if(e.length>1)return!0;var n=this._getExpressionLanguage();return n!==this._getDefaultExpressionLanguage()}render(){if(!this._shouldRender())return null;var e=this._getExpressionLanguage(),n=this._expressionLanguages.getAll();return D(1,"tr",null,[D(1,"td",null,this._translate("Expression language:"),0),D(1,"td",null,D(1,"div","dms-fill-row",Pe(2,Tr,{onChange:this.setExpressionLanguage,options:n,value:e,className:"expression-language-select dms-block"}),2),2)],4)}}var jAe=500;class BG{constructor(e){e.onGetComponent("viewer",jAe,()=>SAe)}}BG.$inject=["components"];const kAe={__depends__:[dh,LG,uh,oN],__init__:["literalExpressionProperties"],literalExpressionProperties:["type",BG]};function Qn(t,e){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[],trigger:null},this._injector=e,this._eventBus=t,this._uid=1,t.on(["diagram.destroy","diagram.clear"],function(){this.clear(!1)},this)}Qn.$inject=["eventBus","injector"];Qn.prototype.execute=function(t,e){if(!t)throw new Error("command required");this._currentExecution.trigger="execute";const n={command:t,context:e};this._pushAction(n),this._internalExecute(n),this._popAction()};Qn.prototype.canExecute=function(t,e){const n={command:t,context:e},r=this._getHandler(t);let i=this._fire(t,"canExecute",n);if(i===void 0){if(!r)return!1;r.canExecute&&(i=r.canExecute(e))}return i};Qn.prototype.clear=function(t){this._stack.length=0,this._stackIdx=-1,t!==!1&&this._fire("changed",{trigger:"clear"})};Qn.prototype.undo=function(){let t=this._getUndoAction(),e;if(t){for(this._currentExecution.trigger="undo",this._pushAction(t);t&&(this._internalUndo(t),e=this._getUndoAction(),!(!e||e.id!==t.id));)t=e;this._popAction()}};Qn.prototype.redo=function(){let t=this._getRedoAction(),e;if(t){for(this._currentExecution.trigger="redo",this._pushAction(t);t&&(this._internalExecute(t,!0),e=this._getRedoAction(),!(!e||e.id!==t.id));)t=e;this._popAction()}};Qn.prototype.register=function(t,e){this._setHandler(t,e)};Qn.prototype.registerHandler=function(t,e){if(!t||!e)throw new Error("command and handlerCls must be defined");const n=this._injector.instantiate(e);this.register(t,n)};Qn.prototype.canUndo=function(){return!!this._getUndoAction()};Qn.prototype.canRedo=function(){return!!this._getRedoAction()};Qn.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]};Qn.prototype._getUndoAction=function(){return this._stack[this._stackIdx]};Qn.prototype._internalUndo=function(t){const e=t.command,n=t.context,r=this._getHandler(e);this._atomicDo(()=>{this._fire(e,"revert",t),r.revert&&this._markDirty(r.revert(n)),this._revertedAction(t),this._fire(e,"reverted",t)})};Qn.prototype._fire=function(t,e,n){arguments.length<3&&(n=e,e=null);const r=e?[t+"."+e,e]:[t];let i;n=this._eventBus.createEvent(n);for(const s of r)if(i=this._eventBus.fire("commandStack."+s,n),n.cancelBubble)break;return i};Qn.prototype._createId=function(){return this._uid++};Qn.prototype._atomicDo=function(t){const e=this._currentExecution;e.atomic=!0;try{t()}finally{e.atomic=!1}};Qn.prototype._internalExecute=function(t,e){const n=t.command,r=t.context,i=this._getHandler(n);if(!i)throw new Error("no command handler registered for <"+n+">");this._pushAction(t),e||(this._fire(n,"preExecute",t),i.preExecute&&i.preExecute(r),this._fire(n,"preExecuted",t)),this._atomicDo(()=>{this._fire(n,"execute",t),i.execute&&this._markDirty(i.execute(r)),this._executedAction(t,e),this._fire(n,"executed",t)}),e||(this._fire(n,"postExecute",t),i.postExecute&&i.postExecute(r),this._fire(n,"postExecuted",t)),this._popAction()};Qn.prototype._pushAction=function(t){const e=this._currentExecution,n=e.actions,r=n[0];if(e.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+t.command+")");t.id||(t.id=r&&r.id||this._createId()),n.push(t)};Qn.prototype._popAction=function(){const t=this._currentExecution,e=t.trigger,n=t.actions,r=t.dirty;n.pop(),n.length||(this._eventBus.fire("elements.changed",{elements:Tk("id",r.reverse())}),r.length=0,this._fire("changed",{trigger:e}),t.trigger=null)};Qn.prototype._markDirty=function(t){const e=this._currentExecution;t&&(t=ke(t)?t:[t],e.dirty=e.dirty.concat(t))};Qn.prototype._executedAction=function(t,e){const n=++this._stackIdx;e||this._stack.splice(n,this._stack.length,t)};Qn.prototype._revertedAction=function(t){this._stackIdx--};Qn.prototype._getHandler=function(t){return this._handlerMap[t]};Qn.prototype._setHandler=function(t,e){if(!t||!e)throw new Error("command and handler required");if(this._handlerMap[t])throw new Error("overriding handler for command <"+t+">");this._handlerMap[t]=e};class v1{constructor(e,n,r){this._commandStack=e,this._viewer=n,this._eventBus=r,r.on("viewer.init",()=>{PAe(this.getHandlers(),e)})}getHandlers(){return v1._getHandlers()}static _getHandlers(){return{"element.updateProperties":YN}}getDecision(){return this._viewer.getDecision()}editDecisionName(e){var n=this.getDecision(),r={element:n,properties:{name:e}};this._commandStack.execute("element.updateProperties",r)}editDecisionId(e){var n=this.getDecision(),r={element:n,properties:{id:e}};this._commandStack.execute("element.updateProperties",r)}editLiteralExpressionText(e){var n=this.getDecision(),r=n.decisionLogic,i={element:r,properties:{text:e}};this._commandStack.execute("element.updateProperties",i)}editExpressionLanguage(e){var n=this.getDecision(),r=n.decisionLogic,i={element:r,properties:{expressionLanguage:e}};this._commandStack.execute("element.updateProperties",i)}editVariableName(e){var n=this.getDecision(),r=n.variable,i={element:r,properties:{name:e}};this._commandStack.execute("element.updateProperties",i)}editVariableType(e){var n=this.getDecision(),r=n.variable,i={element:r,properties:{typeRef:e}};this._commandStack.execute("element.updateProperties",i)}}v1.$inject=["commandStack","viewer","eventBus"];function PAe(t,e){$(t,function(n,r){e.registerHandler(r,n)})}const TAe={__init__:["idChangeBehavior","modeling"],commandStack:["type",Qn],idChangeBehavior:["type",L_],modeling:["type",v1]};let NAe=class extends Ve{constructor(e,n){super(e,n),this._modeling=n.injector.get("modeling"),this._viewer=n.injector.get("viewer"),this._expressionLanguages=n.injector.get("expressionLanguages"),this._variableResolver=n.injector.get("variableResolver",!1),this.editLiteralExpressionText=this.editLiteralExpressionText.bind(this),this.onElementsChanged=this.onElementsChanged.bind(this);var r=this.getLiteralExpression(),i=r.id;n.changeSupport.onElementsChanged(i,this.onElementsChanged)}getLiteralExpression(){return this._viewer.getDecision().decisionLogic}onElementsChanged(){this.forceUpdate()}editLiteralExpressionText(e){this._modeling.editLiteralExpressionText(e)}getEditor(){return this.isFeel()?OAe:RAe}isFeel(){return this.getExpressionLanguage()==="feel"}getExpressionLanguage(){var e=this.getLiteralExpression();return e.expressionLanguage||this._expressionLanguages.getDefault().value}_getVariables(){var e=this.getLiteralExpression();return this._variableResolver&&this._variableResolver.getVariables(e)}render(){var e=this.getLiteralExpression(),n=e.text,r=this.getEditor(),i=this._getVariables();return Pe(2,r,{className:"textarea editor",value:n,onChange:this.editLiteralExpressionText,variables:i})}};class OAe extends Ve{render(){return Pe(2,WN,{className:this.props.className,value:this.props.value,onInput:this.props.onChange,variables:this.props.variables})}}let RAe=class extends vy{render(){return D(1,"div",this.getClassName(),this.getEditor(),0)}};class FG{constructor(e){e.onGetComponent("viewer",()=>NAe)}}FG.$inject=["components"];const AAe={__depends__:[dh],__init__:["textarea"],textarea:["type",FG]};class XN extends sv{getModules(){return[...sv._getModules(),...XN._getModules()]}static _getModules(){return[xAe,LG,kAe,TAe,uh,aN,AAe,PV]}}class IAe extends afe{_getViewProviders(){return[{id:"drd",constructor:xp,opens:"dmn:Definitions"},{id:"decisionTable",constructor:DRe,opens(e){return Y(e,"dmn:Decision")&&Y(e.decisionLogic,"dmn:DecisionTable")}},{id:"literalExpression",constructor:XN,opens(e){return Y(e,"dmn:Decision")&&Y(e.decisionLogic,"dmn:LiteralExpression")}}]}_getInitialView(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var s=super._getInitialView(e,...r);if(s){var o=s.element;return Y(o,"dmn:Definitions")&&!qU(o)&&(s=Tt(e,a=>!Y(a.element,"dmn:Definitions"))||s),s}}}const QN=({xml:t,onSave:e,onRefine:n})=>{const r=_.useRef(null),i=_.useRef(null),[s,o]=_.useState(!1),[a,l]=_.useState(!1),[c,d]=_.useState(1),[h,p]=_.useState([t]),[f,m]=_.useState(!1),[g,v]=_.useState(!1),[b,x]=_.useState("");_.useEffect(()=>{if(!(!r.current||i.current))return i.current=new IAe({container:r.current}),setTimeout(()=>{if(i.current)try{const M=i.current.get("eventBus");M&&M.on("commandStack.changed",()=>{if(i.current)try{const W=i.current.get("commandStack");W&&(o(W.canUndo()),l(W.canRedo()))}catch(W){console.warn("Error accessing command stack:",W)}})}catch(M){console.warn("Error setting up event bus:",M)}},100),()=>{i.current&&(i.current.destroy(),i.current=null)}},[]),_.useEffect(()=>{if(!i.current||!t)return;let M=!1;return i.current.importXML(t).then(()=>{if(M)return;const W=(ce=0)=>{if(!(M||!i.current))try{if(typeof i.current.get!="function"){ce<5?setTimeout(()=>{M||W(ce+1)},50*(ce+1)):console.warn("Modeler get method not available after multiple retries");return}const se=i.current.get("canvas");se&&typeof se.zoom=="function"?se.zoom("fit-viewport"):ce<5&&setTimeout(()=>{M||W(ce+1)},50*(ce+1))}catch(se){ce<5?setTimeout(()=>{M||W(ce+1)},50*(ce+1)):console.warn("Error accessing canvas after multiple retries:",se)}};setTimeout(()=>{M||W()},100)}).catch(W=>{M||(console.error("Error loading DMN diagram:",W),L.error("Failed to load DMN diagram"))}),()=>{M=!0}},[t]);const y=async()=>{if(i.current)try{const M=await i.current.saveXML({format:!0});if(M.xml){const W=c+1;d(W);const ce=[...h,M.xml];p(ce),e&&e(M.xml),L.success("DMN diagram saved",{description:`Saved as version v${W}`})}}catch(M){console.error("Error saving DMN diagram:",M),L.error("Failed to save DMN diagram")}},w=async()=>{if(i.current)try{const M=await i.current.saveXML({format:!0});if(M.xml){const W=new Blob([M.xml],{type:"application/xml"}),ce=URL.createObjectURL(W),se=document.createElement("a");se.href=ce,se.download=`DMN_v${c}.dmn`,se.click(),URL.revokeObjectURL(ce),L.success(`Exported to DMN_v${c}.dmn`)}}catch(M){console.error("Error downloading DMN diagram:",M),L.error("Failed to download DMN diagram")}},E=()=>{if(!i.current)return;const M=i.current.get("commandStack");M.canUndo()&&M.undo()},S=()=>{if(!i.current)return;const M=i.current.get("commandStack");M.canRedo()&&M.redo()},j=()=>{if(!i.current)return;const M=i.current.get("canvas"),W=M.getViewbox();W&&M.zoom(W.scale*1.2)},C=()=>{if(!i.current)return;const M=i.current.get("canvas"),W=M.getViewbox();W&&M.zoom(W.scale*.8)},P=()=>{if(!i.current)return;i.current.get("canvas").zoom("fit-viewport")},R=()=>{var M,W,ce;r.current&&(f?((ce=document.exitFullscreen)==null||ce.call(document),m(!1)):((W=(M=r.current).requestFullscreen)==null||W.call(M),m(!0)))},N=()=>{n?n():v(!0)},I=()=>{const M=document.createElement("input");M.type="file",M.accept=".dmn,.xml",M.onchange=async W=>{var se;const ce=(se=W.target.files)==null?void 0:se[0];if(ce)try{const ve=await ce.text();if(i.current&&(await i.current.importXML(ve),L.success("DMN diagram imported successfully"),e)){const pt=await i.current.saveXML({format:!0});pt.xml&&e(pt.xml)}}catch(ve){console.error("Error importing DMN:",ve),L.error("Failed to import DMN diagram")}},M.click()};return u.jsxs("div",{className:"flex flex-col h-full w-full",children:[u.jsx("style",{children:`
        .dmn-definitions-name,
        .drd-name,
        .dmn-navigation,
        .tjs-navigation {
          display: none !important;
        }
      `}),u.jsxs("div",{className:"flex items-center gap-2 p-2 border-b bg-card",children:[u.jsxs(G,{variant:"outline",size:"sm",onClick:y,title:"Save (Ctrl+S)",children:[u.jsx(q4,{className:"h-4 w-4 mr-2"}),"Save"]}),u.jsxs(G,{variant:"outline",size:"sm",onClick:w,title:"Download",children:[u.jsx(Ip,{className:"h-4 w-4 mr-2"}),"Download"]}),u.jsxs(G,{variant:"outline",size:"sm",onClick:I,title:"Import DMN",children:[u.jsx(bb,{className:"h-4 w-4 mr-2"}),"Import"]}),u.jsx("div",{className:"w-px h-6 bg-border mx-1"}),u.jsx(G,{variant:"outline",size:"sm",onClick:E,disabled:!s,title:"Undo (Ctrl+Z)",children:u.jsx(eC,{className:"h-4 w-4"})}),u.jsx(G,{variant:"outline",size:"sm",onClick:S,disabled:!a,title:"Redo (Ctrl+Y)",children:u.jsx(JS,{className:"h-4 w-4"})}),u.jsx("div",{className:"w-px h-6 bg-border mx-1"}),u.jsx(G,{variant:"outline",size:"sm",onClick:j,title:"Zoom In",children:u.jsx(wb,{className:"h-4 w-4"})}),u.jsx(G,{variant:"outline",size:"sm",onClick:C,title:"Zoom Out",children:u.jsx(tC,{className:"h-4 w-4"})}),u.jsx(G,{variant:"outline",size:"sm",onClick:P,title:"Fit to Viewport",children:"Fit"}),u.jsx("div",{className:"w-px h-6 bg-border mx-1"}),u.jsx(G,{variant:"outline",size:"sm",onClick:R,title:"Toggle Fullscreen",children:f?u.jsx(dee,{className:"h-4 w-4"}):u.jsx(xb,{className:"h-4 w-4"})}),n&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"w-px h-6 bg-border mx-1"}),u.jsx(G,{variant:"outline",size:"sm",onClick:N,title:"Refine with AI",children:"Refine"})]}),u.jsxs("div",{className:"ml-auto text-xs text-muted-foreground",children:["v",c]})]}),u.jsx("div",{ref:r,className:"flex-1 w-full bg-white border border-border relative",style:{minHeight:"75vh"}}),u.jsx(Ur,{open:g,onOpenChange:v,children:u.jsxs(Ar,{children:[u.jsxs(Ir,{children:[u.jsx(Dr,{children:"Refine DMN Diagram"}),u.jsx($r,{children:"Describe the changes you'd like to make to your DMN decision table"})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx(Vt,{htmlFor:"refine-prompt",children:"Refinement Instructions"}),u.jsx($i,{id:"refine-prompt",placeholder:"e.g., Add a new rule for high-value orders, update the output column name...",value:b,onChange:M=>x(M.target.value),rows:5})]}),u.jsxs("div",{className:"flex justify-end gap-2",children:[u.jsx(G,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),u.jsx(G,{onClick:()=>{v(!1),L.info("Refinement feature coming soon")},children:"Apply Changes"})]})]})]})})]})};function DAe(t){const e=$Ae(t),n=_.forwardRef((r,i)=>{const{children:s,...o}=r,a=_.Children.toArray(s),l=a.find(LAe);if(l){const c=l.props.children,d=a.map(h=>h===l?_.Children.count(c)>1?_.Children.only(null):_.isValidElement(c)?c.props.children:null:h);return u.jsx(e,{...o,ref:i,children:_.isValidElement(c)?_.cloneElement(c,void 0,d):null})}return u.jsx(e,{...o,ref:i,children:s})});return n.displayName=`${t}.Slot`,n}function $Ae(t){const e=_.forwardRef((n,r)=>{const{children:i,...s}=n;if(_.isValidElement(i)){const o=FAe(i),a=BAe(s,i.props);return i.type!==_.Fragment&&(a.ref=r?_B(r,o):o),_.cloneElement(i,a)}return _.Children.count(i)>1?_.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var MAe=Symbol("radix.slottable");function LAe(t){return _.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===MAe}function BAe(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{const l=s(...a);return i(...a),l}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function FAe(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var zG=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),zAe="VisuallyHidden",y1=_.forwardRef((t,e)=>u.jsx(Yt.span,{...t,ref:e,style:{...zG,...t.style}}));y1.displayName=zAe;var HAe=y1,UAe=[" ","Enter","ArrowUp","ArrowDown"],VAe=[" ","Enter"],Bd="Select",[x1,b1,qAe]=xk(Bd),[tm]=Tl(Bd,[qAe,dw]),w1=dw(),[WAe,_u]=tm(Bd),[GAe,KAe]=tm(Bd),HG=t=>{const{__scopeSelect:e,children:n,open:r,defaultOpen:i,onOpenChange:s,value:o,defaultValue:a,onValueChange:l,dir:c,name:d,autoComplete:h,disabled:p,required:f,form:m}=t,g=w1(e),[v,b]=_.useState(null),[x,y]=_.useState(null),[w,E]=_.useState(!1),S=uw(c),[j,C]=Mc({prop:r,defaultProp:i??!1,onChange:s,caller:Bd}),[P,R]=Mc({prop:o,defaultProp:a,onChange:l,caller:Bd}),N=_.useRef(null),I=v?m||!!v.closest("form"):!0,[M,W]=_.useState(new Set),ce=Array.from(M).map(se=>se.props.value).join(";");return u.jsx(sX,{...g,children:u.jsxs(WAe,{required:f,scope:e,trigger:v,onTriggerChange:b,valueNode:x,onValueNodeChange:y,valueNodeHasChildren:w,onValueNodeHasChildrenChange:E,contentId:vf(),value:P,onValueChange:R,open:j,onOpenChange:C,dir:S,triggerPointerDownPosRef:N,disabled:p,children:[u.jsx(x1.Provider,{scope:e,children:u.jsx(GAe,{scope:t.__scopeSelect,onNativeOptionAdd:_.useCallback(se=>{W(ve=>new Set(ve).add(se))},[]),onNativeOptionRemove:_.useCallback(se=>{W(ve=>{const pt=new Set(ve);return pt.delete(se),pt})},[]),children:n})}),I?u.jsxs(hK,{"aria-hidden":!0,required:f,tabIndex:-1,name:d,autoComplete:h,value:P,onChange:se=>R(se.target.value),disabled:p,form:m,children:[P===void 0?u.jsx("option",{value:""}):null,Array.from(M)]},ce):null]})})};HG.displayName=Bd;var UG="SelectTrigger",VG=_.forwardRef((t,e)=>{const{__scopeSelect:n,disabled:r=!1,...i}=t,s=w1(n),o=_u(UG,n),a=o.disabled||r,l=Mn(e,o.onTriggerChange),c=b1(n),d=_.useRef("touch"),[h,p,f]=fK(g=>{const v=c().filter(y=>!y.disabled),b=v.find(y=>y.value===o.value),x=mK(v,g,b);x!==void 0&&o.onValueChange(x.value)}),m=g=>{a||(o.onOpenChange(!0),f()),g&&(o.triggerPointerDownPosRef.current={x:Math.round(g.pageX),y:Math.round(g.pageY)})};return u.jsx($B,{asChild:!0,...s,children:u.jsx(Yt.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:a,"data-disabled":a?"":void 0,"data-placeholder":pK(o.value)?"":void 0,...i,ref:l,onClick:Pt(i.onClick,g=>{g.currentTarget.focus(),d.current!=="mouse"&&m(g)}),onPointerDown:Pt(i.onPointerDown,g=>{d.current=g.pointerType;const v=g.target;v.hasPointerCapture(g.pointerId)&&v.releasePointerCapture(g.pointerId),g.button===0&&g.ctrlKey===!1&&g.pointerType==="mouse"&&(m(g),g.preventDefault())}),onKeyDown:Pt(i.onKeyDown,g=>{const v=h.current!=="";!(g.ctrlKey||g.altKey||g.metaKey)&&g.key.length===1&&p(g.key),!(v&&g.key===" ")&&UAe.includes(g.key)&&(m(),g.preventDefault())})})})});VG.displayName=UG;var qG="SelectValue",WG=_.forwardRef((t,e)=>{const{__scopeSelect:n,className:r,style:i,children:s,placeholder:o="",...a}=t,l=_u(qG,n),{onValueNodeHasChildrenChange:c}=l,d=s!==void 0,h=Mn(e,l.onValueNodeChange);return as(()=>{c(d)},[c,d]),u.jsx(Yt.span,{...a,ref:h,style:{pointerEvents:"none"},children:pK(l.value)?u.jsx(u.Fragment,{children:o}):s})});WG.displayName=qG;var YAe="SelectIcon",GG=_.forwardRef((t,e)=>{const{__scopeSelect:n,children:r,...i}=t;return u.jsx(Yt.span,{"aria-hidden":!0,...i,ref:e,children:r||""})});GG.displayName=YAe;var XAe="SelectPortal",KG=t=>u.jsx(MB,{asChild:!0,...t});KG.displayName=XAe;var Fd="SelectContent",YG=_.forwardRef((t,e)=>{const n=_u(Fd,t.__scopeSelect),[r,i]=_.useState();if(as(()=>{i(new DocumentFragment)},[]),!n.open){const s=r;return s?ow.createPortal(u.jsx(XG,{scope:t.__scopeSelect,children:u.jsx(x1.Slot,{scope:t.__scopeSelect,children:u.jsx("div",{children:t.children})})}),s):null}return u.jsx(QG,{...t,ref:e})});YG.displayName=Fd;var Po=10,[XG,Eu]=tm(Fd),QAe="SelectContentImpl",ZAe=DAe("SelectContent.RemoveScroll"),QG=_.forwardRef((t,e)=>{const{__scopeSelect:n,position:r="item-aligned",onCloseAutoFocus:i,onEscapeKeyDown:s,onPointerDownOutside:o,side:a,sideOffset:l,align:c,alignOffset:d,arrowPadding:h,collisionBoundary:p,collisionPadding:f,sticky:m,hideWhenDetached:g,avoidCollisions:v,...b}=t,x=_u(Fd,n),[y,w]=_.useState(null),[E,S]=_.useState(null),j=Mn(e,me=>w(me)),[C,P]=_.useState(null),[R,N]=_.useState(null),I=b1(n),[M,W]=_.useState(!1),ce=_.useRef(!1);_.useEffect(()=>{if(y)return tX(y)},[y]),nX();const se=_.useCallback(me=>{const[oe,...pe]=I().map(de=>de.ref.current),[ne]=pe.slice(-1),Te=document.activeElement;for(const de of me)if(de===Te||(de==null||de.scrollIntoView({block:"nearest"}),de===oe&&E&&(E.scrollTop=0),de===ne&&E&&(E.scrollTop=E.scrollHeight),de==null||de.focus(),document.activeElement!==Te))return},[I,E]),ve=_.useCallback(()=>se([C,y]),[se,C,y]);_.useEffect(()=>{M&&ve()},[M,ve]);const{onOpenChange:pt,triggerPointerDownPosRef:je}=x;_.useEffect(()=>{if(y){let me={x:0,y:0};const oe=ne=>{var Te,de;me={x:Math.abs(Math.round(ne.pageX)-(((Te=je.current)==null?void 0:Te.x)??0)),y:Math.abs(Math.round(ne.pageY)-(((de=je.current)==null?void 0:de.y)??0))}},pe=ne=>{me.x<=10&&me.y<=10?ne.preventDefault():y.contains(ne.target)||pt(!1),document.removeEventListener("pointermove",oe),je.current=null};return je.current!==null&&(document.addEventListener("pointermove",oe),document.addEventListener("pointerup",pe,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",oe),document.removeEventListener("pointerup",pe,{capture:!0})}}},[y,pt,je]),_.useEffect(()=>{const me=()=>pt(!1);return window.addEventListener("blur",me),window.addEventListener("resize",me),()=>{window.removeEventListener("blur",me),window.removeEventListener("resize",me)}},[pt]);const[lt,Nt]=fK(me=>{const oe=I().filter(Te=>!Te.disabled),pe=oe.find(Te=>Te.ref.current===document.activeElement),ne=mK(oe,me,pe);ne&&setTimeout(()=>ne.ref.current.focus())}),Ae=_.useCallback((me,oe,pe)=>{const ne=!ce.current&&!pe;(x.value!==void 0&&x.value===oe||ne)&&(P(me),ne&&(ce.current=!0))},[x.value]),Qe=_.useCallback(()=>y==null?void 0:y.focus(),[y]),ze=_.useCallback((me,oe,pe)=>{const ne=!ce.current&&!pe;(x.value!==void 0&&x.value===oe||ne)&&N(me)},[x.value]),Ot=r==="popper"?rk:ZG,Zt=Ot===rk?{side:a,sideOffset:l,align:c,alignOffset:d,arrowPadding:h,collisionBoundary:p,collisionPadding:f,sticky:m,hideWhenDetached:g,avoidCollisions:v}:{};return u.jsx(XG,{scope:n,content:y,viewport:E,onViewportChange:S,itemRefCallback:Ae,selectedItem:C,onItemLeave:Qe,itemTextRefCallback:ze,focusSelectedItem:ve,selectedItemText:R,position:r,isPositioned:M,searchRef:lt,children:u.jsx(rX,{as:ZAe,allowPinchZoom:!0,children:u.jsx(iX,{asChild:!0,trapped:x.open,onMountAutoFocus:me=>{me.preventDefault()},onUnmountAutoFocus:Pt(i,me=>{var oe;(oe=x.trigger)==null||oe.focus({preventScroll:!0}),me.preventDefault()}),children:u.jsx(LB,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:me=>me.preventDefault(),onDismiss:()=>x.onOpenChange(!1),children:u.jsx(Ot,{role:"listbox",id:x.contentId,"data-state":x.open?"open":"closed",dir:x.dir,onContextMenu:me=>me.preventDefault(),...b,...Zt,onPlaced:()=>W(!0),ref:j,style:{display:"flex",flexDirection:"column",outline:"none",...b.style},onKeyDown:Pt(b.onKeyDown,me=>{const oe=me.ctrlKey||me.altKey||me.metaKey;if(me.key==="Tab"&&me.preventDefault(),!oe&&me.key.length===1&&Nt(me.key),["ArrowUp","ArrowDown","Home","End"].includes(me.key)){let ne=I().filter(Te=>!Te.disabled).map(Te=>Te.ref.current);if(["ArrowUp","End"].includes(me.key)&&(ne=ne.slice().reverse()),["ArrowUp","ArrowDown"].includes(me.key)){const Te=me.target,de=ne.indexOf(Te);ne=ne.slice(de+1)}setTimeout(()=>se(ne)),me.preventDefault()}})})})})})})});QG.displayName=QAe;var JAe="SelectItemAlignedPosition",ZG=_.forwardRef((t,e)=>{const{__scopeSelect:n,onPlaced:r,...i}=t,s=_u(Fd,n),o=Eu(Fd,n),[a,l]=_.useState(null),[c,d]=_.useState(null),h=Mn(e,j=>d(j)),p=b1(n),f=_.useRef(!1),m=_.useRef(!0),{viewport:g,selectedItem:v,selectedItemText:b,focusSelectedItem:x}=o,y=_.useCallback(()=>{if(s.trigger&&s.valueNode&&a&&c&&g&&v&&b){const j=s.trigger.getBoundingClientRect(),C=c.getBoundingClientRect(),P=s.valueNode.getBoundingClientRect(),R=b.getBoundingClientRect();if(s.dir!=="rtl"){const Te=R.left-C.left,de=P.left-Te,Ie=j.left-de,qe=j.width+Ie,_t=Math.max(qe,C.width),Ht=window.innerWidth-Po,on=rC(de,[Po,Math.max(Po,Ht-_t)]);a.style.minWidth=qe+"px",a.style.left=on+"px"}else{const Te=C.right-R.right,de=window.innerWidth-P.right-Te,Ie=window.innerWidth-j.right-de,qe=j.width+Ie,_t=Math.max(qe,C.width),Ht=window.innerWidth-Po,on=rC(de,[Po,Math.max(Po,Ht-_t)]);a.style.minWidth=qe+"px",a.style.right=on+"px"}const N=p(),I=window.innerHeight-Po*2,M=g.scrollHeight,W=window.getComputedStyle(c),ce=parseInt(W.borderTopWidth,10),se=parseInt(W.paddingTop,10),ve=parseInt(W.borderBottomWidth,10),pt=parseInt(W.paddingBottom,10),je=ce+se+M+pt+ve,lt=Math.min(v.offsetHeight*5,je),Nt=window.getComputedStyle(g),Ae=parseInt(Nt.paddingTop,10),Qe=parseInt(Nt.paddingBottom,10),ze=j.top+j.height/2-Po,Ot=I-ze,Zt=v.offsetHeight/2,me=v.offsetTop+Zt,oe=ce+se+me,pe=je-oe;if(oe<=ze){const Te=N.length>0&&v===N[N.length-1].ref.current;a.style.bottom="0px";const de=c.clientHeight-g.offsetTop-g.offsetHeight,Ie=Math.max(Ot,Zt+(Te?Qe:0)+de+ve),qe=oe+Ie;a.style.height=qe+"px"}else{const Te=N.length>0&&v===N[0].ref.current;a.style.top="0px";const Ie=Math.max(ze,ce+g.offsetTop+(Te?Ae:0)+Zt)+pe;a.style.height=Ie+"px",g.scrollTop=oe-ze+g.offsetTop}a.style.margin=`${Po}px 0`,a.style.minHeight=lt+"px",a.style.maxHeight=I+"px",r==null||r(),requestAnimationFrame(()=>f.current=!0)}},[p,s.trigger,s.valueNode,a,c,g,v,b,s.dir,r]);as(()=>y(),[y]);const[w,E]=_.useState();as(()=>{c&&E(window.getComputedStyle(c).zIndex)},[c]);const S=_.useCallback(j=>{j&&m.current===!0&&(y(),x==null||x(),m.current=!1)},[y,x]);return u.jsx(tIe,{scope:n,contentWrapper:a,shouldExpandOnScrollRef:f,onScrollButtonChange:S,children:u.jsx("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:w},children:u.jsx(Yt.div,{...i,ref:h,style:{boxSizing:"border-box",maxHeight:"100%",...i.style}})})})});ZG.displayName=JAe;var eIe="SelectPopperPosition",rk=_.forwardRef((t,e)=>{const{__scopeSelect:n,align:r="start",collisionPadding:i=Po,...s}=t,o=w1(n);return u.jsx(BB,{...o,...s,ref:e,align:r,collisionPadding:i,style:{boxSizing:"border-box",...s.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});rk.displayName=eIe;var[tIe,ZN]=tm(Fd,{}),ik="SelectViewport",JG=_.forwardRef((t,e)=>{const{__scopeSelect:n,nonce:r,...i}=t,s=Eu(ik,n),o=ZN(ik,n),a=Mn(e,s.onViewportChange),l=_.useRef(0);return u.jsxs(u.Fragment,{children:[u.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),u.jsx(x1.Slot,{scope:n,children:u.jsx(Yt.div,{"data-radix-select-viewport":"",role:"presentation",...i,ref:a,style:{position:"relative",flex:1,overflow:"hidden auto",...i.style},onScroll:Pt(i.onScroll,c=>{const d=c.currentTarget,{contentWrapper:h,shouldExpandOnScrollRef:p}=o;if(p!=null&&p.current&&h){const f=Math.abs(l.current-d.scrollTop);if(f>0){const m=window.innerHeight-Po*2,g=parseFloat(h.style.minHeight),v=parseFloat(h.style.height),b=Math.max(g,v);if(b<m){const x=b+f,y=Math.min(m,x),w=x-y;h.style.height=y+"px",h.style.bottom==="0px"&&(d.scrollTop=w>0?w:0,h.style.justifyContent="flex-end")}}}l.current=d.scrollTop})})})]})});JG.displayName=ik;var eK="SelectGroup",[nIe,rIe]=tm(eK),iIe=_.forwardRef((t,e)=>{const{__scopeSelect:n,...r}=t,i=vf();return u.jsx(nIe,{scope:n,id:i,children:u.jsx(Yt.div,{role:"group","aria-labelledby":i,...r,ref:e})})});iIe.displayName=eK;var tK="SelectLabel",nK=_.forwardRef((t,e)=>{const{__scopeSelect:n,...r}=t,i=rIe(tK,n);return u.jsx(Yt.div,{id:i.id,...r,ref:e})});nK.displayName=tK;var iw="SelectItem",[sIe,rK]=tm(iw),iK=_.forwardRef((t,e)=>{const{__scopeSelect:n,value:r,disabled:i=!1,textValue:s,...o}=t,a=_u(iw,n),l=Eu(iw,n),c=a.value===r,[d,h]=_.useState(s??""),[p,f]=_.useState(!1),m=Mn(e,x=>{var y;return(y=l.itemRefCallback)==null?void 0:y.call(l,x,r,i)}),g=vf(),v=_.useRef("touch"),b=()=>{i||(a.onValueChange(r),a.onOpenChange(!1))};if(r==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return u.jsx(sIe,{scope:n,value:r,disabled:i,textId:g,isSelected:c,onItemTextChange:_.useCallback(x=>{h(y=>y||((x==null?void 0:x.textContent)??"").trim())},[]),children:u.jsx(x1.ItemSlot,{scope:n,value:r,disabled:i,textValue:d,children:u.jsx(Yt.div,{role:"option","aria-labelledby":g,"data-highlighted":p?"":void 0,"aria-selected":c&&p,"data-state":c?"checked":"unchecked","aria-disabled":i||void 0,"data-disabled":i?"":void 0,tabIndex:i?void 0:-1,...o,ref:m,onFocus:Pt(o.onFocus,()=>f(!0)),onBlur:Pt(o.onBlur,()=>f(!1)),onClick:Pt(o.onClick,()=>{v.current!=="mouse"&&b()}),onPointerUp:Pt(o.onPointerUp,()=>{v.current==="mouse"&&b()}),onPointerDown:Pt(o.onPointerDown,x=>{v.current=x.pointerType}),onPointerMove:Pt(o.onPointerMove,x=>{var y;v.current=x.pointerType,i?(y=l.onItemLeave)==null||y.call(l):v.current==="mouse"&&x.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Pt(o.onPointerLeave,x=>{var y;x.currentTarget===document.activeElement&&((y=l.onItemLeave)==null||y.call(l))}),onKeyDown:Pt(o.onKeyDown,x=>{var w;((w=l.searchRef)==null?void 0:w.current)!==""&&x.key===" "||(VAe.includes(x.key)&&b(),x.key===" "&&x.preventDefault())})})})})});iK.displayName=iw;var Jm="SelectItemText",sK=_.forwardRef((t,e)=>{const{__scopeSelect:n,className:r,style:i,...s}=t,o=_u(Jm,n),a=Eu(Jm,n),l=rK(Jm,n),c=KAe(Jm,n),[d,h]=_.useState(null),p=Mn(e,b=>h(b),l.onItemTextChange,b=>{var x;return(x=a.itemTextRefCallback)==null?void 0:x.call(a,b,l.value,l.disabled)}),f=d==null?void 0:d.textContent,m=_.useMemo(()=>u.jsx("option",{value:l.value,disabled:l.disabled,children:f},l.value),[l.disabled,l.value,f]),{onNativeOptionAdd:g,onNativeOptionRemove:v}=c;return as(()=>(g(m),()=>v(m)),[g,v,m]),u.jsxs(u.Fragment,{children:[u.jsx(Yt.span,{id:l.textId,...s,ref:p}),l.isSelected&&o.valueNode&&!o.valueNodeHasChildren?ow.createPortal(s.children,o.valueNode):null]})});sK.displayName=Jm;var oK="SelectItemIndicator",aK=_.forwardRef((t,e)=>{const{__scopeSelect:n,...r}=t;return rK(oK,n).isSelected?u.jsx(Yt.span,{"aria-hidden":!0,...r,ref:e}):null});aK.displayName=oK;var sk="SelectScrollUpButton",lK=_.forwardRef((t,e)=>{const n=Eu(sk,t.__scopeSelect),r=ZN(sk,t.__scopeSelect),[i,s]=_.useState(!1),o=Mn(e,r.onScrollButtonChange);return as(()=>{if(n.viewport&&n.isPositioned){let a=function(){const c=l.scrollTop>0;s(c)};const l=n.viewport;return a(),l.addEventListener("scroll",a),()=>l.removeEventListener("scroll",a)}},[n.viewport,n.isPositioned]),i?u.jsx(uK,{...t,ref:o,onAutoScroll:()=>{const{viewport:a,selectedItem:l}=n;a&&l&&(a.scrollTop=a.scrollTop-l.offsetHeight)}}):null});lK.displayName=sk;var ok="SelectScrollDownButton",cK=_.forwardRef((t,e)=>{const n=Eu(ok,t.__scopeSelect),r=ZN(ok,t.__scopeSelect),[i,s]=_.useState(!1),o=Mn(e,r.onScrollButtonChange);return as(()=>{if(n.viewport&&n.isPositioned){let a=function(){const c=l.scrollHeight-l.clientHeight,d=Math.ceil(l.scrollTop)<c;s(d)};const l=n.viewport;return a(),l.addEventListener("scroll",a),()=>l.removeEventListener("scroll",a)}},[n.viewport,n.isPositioned]),i?u.jsx(uK,{...t,ref:o,onAutoScroll:()=>{const{viewport:a,selectedItem:l}=n;a&&l&&(a.scrollTop=a.scrollTop+l.offsetHeight)}}):null});cK.displayName=ok;var uK=_.forwardRef((t,e)=>{const{__scopeSelect:n,onAutoScroll:r,...i}=t,s=Eu("SelectScrollButton",n),o=_.useRef(null),a=b1(n),l=_.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return _.useEffect(()=>()=>l(),[l]),as(()=>{var d;const c=a().find(h=>h.ref.current===document.activeElement);(d=c==null?void 0:c.ref.current)==null||d.scrollIntoView({block:"nearest"})},[a]),u.jsx(Yt.div,{"aria-hidden":!0,...i,ref:e,style:{flexShrink:0,...i.style},onPointerDown:Pt(i.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(r,50))}),onPointerMove:Pt(i.onPointerMove,()=>{var c;(c=s.onItemLeave)==null||c.call(s),o.current===null&&(o.current=window.setInterval(r,50))}),onPointerLeave:Pt(i.onPointerLeave,()=>{l()})})}),oIe="SelectSeparator",dK=_.forwardRef((t,e)=>{const{__scopeSelect:n,...r}=t;return u.jsx(Yt.div,{"aria-hidden":!0,...r,ref:e})});dK.displayName=oIe;var ak="SelectArrow",aIe=_.forwardRef((t,e)=>{const{__scopeSelect:n,...r}=t,i=w1(n),s=_u(ak,n),o=Eu(ak,n);return s.open&&o.position==="popper"?u.jsx(FB,{...i,...r,ref:e}):null});aIe.displayName=ak;var lIe="SelectBubbleInput",hK=_.forwardRef(({__scopeSelect:t,value:e,...n},r)=>{const i=_.useRef(null),s=Mn(r,i),o=v8(e);return _.useEffect(()=>{const a=i.current;if(!a)return;const l=window.HTMLSelectElement.prototype,d=Object.getOwnPropertyDescriptor(l,"value").set;if(o!==e&&d){const h=new Event("change",{bubbles:!0});d.call(a,e),a.dispatchEvent(h)}},[o,e]),u.jsx(Yt.select,{...n,style:{...zG,...n.style},ref:s,defaultValue:e})});hK.displayName=lIe;function pK(t){return t===""||t===void 0}function fK(t){const e=ws(t),n=_.useRef(""),r=_.useRef(0),i=_.useCallback(o=>{const a=n.current+o;e(a),function l(c){n.current=c,window.clearTimeout(r.current),c!==""&&(r.current=window.setTimeout(()=>l(""),1e3))}(a)},[e]),s=_.useCallback(()=>{n.current="",window.clearTimeout(r.current)},[]);return _.useEffect(()=>()=>window.clearTimeout(r.current),[]),[n,i,s]}function mK(t,e,n){const i=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,s=n?t.indexOf(n):-1;let o=cIe(t,Math.max(s,0));i.length===1&&(o=o.filter(c=>c!==n));const l=o.find(c=>c.textValue.toLowerCase().startsWith(i.toLowerCase()));return l!==n?l:void 0}function cIe(t,e){return t.map((n,r)=>t[(e+r)%t.length])}var uIe=HG,gK=VG,dIe=WG,hIe=GG,pIe=KG,vK=YG,fIe=JG,yK=nK,xK=iK,mIe=sK,gIe=aK,bK=lK,wK=cK,_K=dK;const _l=uIe,El=dIe,Oa=_.forwardRef(({className:t,children:e,...n},r)=>u.jsxs(gK,{ref:r,className:Se("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[e,u.jsx(hIe,{asChild:!0,children:u.jsx(vs,{className:"h-4 w-4 opacity-50"})})]}));Oa.displayName=gK.displayName;const EK=_.forwardRef(({className:t,...e},n)=>u.jsx(bK,{ref:n,className:Se("flex cursor-default items-center justify-center py-1",t),...e,children:u.jsx(jo,{className:"h-4 w-4"})}));EK.displayName=bK.displayName;const SK=_.forwardRef(({className:t,...e},n)=>u.jsx(wK,{ref:n,className:Se("flex cursor-default items-center justify-center py-1",t),...e,children:u.jsx(vs,{className:"h-4 w-4"})}));SK.displayName=wK.displayName;const Ra=_.forwardRef(({className:t,children:e,position:n="popper",...r},i)=>u.jsx(pIe,{children:u.jsxs(vK,{ref:i,className:Se("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...r,children:[u.jsx(EK,{}),u.jsx(fIe,{className:Se("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),u.jsx(SK,{})]})}));Ra.displayName=vK.displayName;const vIe=_.forwardRef(({className:t,...e},n)=>u.jsx(yK,{ref:n,className:Se("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...e}));vIe.displayName=yK.displayName;const tt=_.forwardRef(({className:t,children:e,...n},r)=>u.jsxs(xK,{ref:r,className:Se("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),...n,children:[u.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:u.jsx(gIe,{children:u.jsx(ns,{className:"h-4 w-4"})})}),u.jsx(mIe,{children:e})]}));tt.displayName=xK.displayName;const yIe=_.forwardRef(({className:t,...e},n)=>u.jsx(_K,{ref:n,className:Se("-mx-1 my-1 h-px bg-muted",t),...e}));yIe.displayName=_K.displayName;const CK=R3,JN=_.forwardRef(({className:t,...e},n)=>u.jsx(ww,{ref:n,className:Se("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...e}));JN.displayName=ww.displayName;const jd=_.forwardRef(({className:t,...e},n)=>u.jsx(_w,{ref:n,className:Se("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...e}));jd.displayName=_w.displayName;const kd=_.forwardRef(({className:t,...e},n)=>u.jsx(Ew,{ref:n,className:Se("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...e}));kd.displayName=Ew.displayName;const jK=({user:t,diagramType:e})=>{const n=Ns(),{hasUsedAllPrompts:r,usePrompt:i}=Sw(!!t),[s,o]=_.useState(""),[a,l]=_.useState(!1),[c,d]=_.useState(null),[h,p]=_.useState(!1),[f,m]=_.useState("en-US"),[g,v]=_.useState(null),[b,x]=_.useState(!1),[y,w]=_.useState(""),[E,S]=_.useState(!1),[j,C]=_.useState("idle"),[P,R]=_.useState("idle"),[N,I]=_.useState(!1),[M,W]=_.useState(null),[ce,se]=_.useState(!1),ve=_.useRef(null),pt=_.useRef(null),je=_.useRef(null),lt=e==="bpmn"?["Create a customer onboarding process","Design an order fulfillment workflow","Build a support ticket resolution process","Generate an employee hiring workflow","Create an invoice approval process"]:e==="pid"?["Create a chemical reactor cooling system","Design a water treatment process flow","Build a distillation column control loop","Generate a pump and valve configuration","Create a heat exchanger system"]:["Create a loan approval decision table","Design a pricing decision based on customer tier","Build a risk assessment decision table","Generate a discount eligibility decision","Create a product recommendation decision"];_.useEffect(()=>{const oe=e==="bpmn"?"generatedBpmn":e==="pid"?"generatedPid":"generatedDmn",pe=localStorage.getItem(oe);if(pe){d(pe),localStorage.removeItem(oe),localStorage.removeItem("diagramType");const ne=e==="bpmn"?"BPMN":e==="pid"?"P&ID":"DMN";L.success(`Your generated ${ne} diagram is ready!`,{description:"You can now view and edit your process diagram"}),setTimeout(()=>{var Te;(Te=document.getElementById("bpmn-viewer"))==null||Te.scrollIntoView({behavior:"smooth",block:"start"})},500)}},[e]),_.useEffect(()=>{if(!M)return;let oe;const pe=async()=>{const{data:de,error:Ie}=await he.from("vision_bpmn_jobs").select("status, bpmn_xml, error_message").eq("id",M).single();if(Ie){console.error("Error checking job status:",Ie);return}if(console.log("Job status:",de.status),de.status==="completed"&&de.bpmn_xml){const qe=e==="bpmn"?"BPMN":e==="pid"?"P&ID":"DMN";d(de.bpmn_xml),R("idle"),l(!1),W(null),x(!1),v(null),L.success(`${qe} diagram generated successfully!`),setTimeout(()=>{var _t;(_t=document.getElementById("bpmn-viewer"))==null||_t.scrollIntoView({behavior:"smooth",block:"start"})},500),oe&&clearInterval(oe)}else if(de.status==="failed"){const qe=de.error_message||"Processing failed. Please try again.";R("idle"),l(!1),W(null),L.error("Upload failed",{description:qe,action:{label:"Retry",onClick:()=>{}},duration:1e4}),oe&&clearInterval(oe)}},ne=he.channel(`job-${M}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"vision_bpmn_jobs",filter:`id=eq.${M}`},de=>{const Ie=de.new;if(console.log("Realtime job status update:",Ie.status),Ie.status==="completed"&&Ie.bpmn_xml){const qe=e==="bpmn"?"BPMN":e==="pid"?"P&ID":"DMN";d(Ie.bpmn_xml),R("idle"),l(!1),W(null),x(!1),v(null),L.success(`${qe} diagram generated successfully!`),setTimeout(()=>{var _t;(_t=document.getElementById("bpmn-viewer"))==null||_t.scrollIntoView({behavior:"smooth",block:"start"})},500),oe&&clearInterval(oe)}else if(Ie.status==="failed"){const qe=Ie.error_message||"Processing failed. Please try again.";R("idle"),l(!1),W(null),L.error("Upload failed",{description:qe,action:{label:"Retry",onClick:()=>{g&&Zt()}},duration:1e4}),oe&&clearInterval(oe)}}).subscribe();oe=window.setInterval(pe,3e3),pe();const Te=window.setTimeout(()=>{oe&&clearInterval(oe);const de="Processing timed out - Please try refreshing the page or contact support";R("idle"),l(!1),W(null),L.error("Upload failed",{description:de,action:{label:"Retry",onClick:()=>{g&&Zt()}},duration:1e4})},3e5);return()=>{clearTimeout(Te),he.removeChannel(ne),oe&&clearInterval(oe)}},[M,e,g]);const Nt=async oe=>{var ne,Te;if(a)return;if(!oe.trim()){L.error("Please enter a process description");return}if(!t&&r){L.error("You've used all 5 free prompts. Please sign up to continue!"),n("/auth");return}if(!t&&!i()){L.error("You've used all 5 free prompts. Please sign up to continue!"),n("/auth");return}l(!0);const pe=e==="bpmn"?"BPMN":e==="pid"?"P&ID":"DMN";R("reading"),await new Promise(de=>setTimeout(de,500)),R("generating");try{const{invokeFunction:de}=await pp(async()=>{const{invokeFunction:on}=await Promise.resolve().then(()=>c2);return{invokeFunction:on}},void 0),Ie=e==="dmn"?"generate-dmn":"generate-bpmn",{data:qe,error:_t}=await de(Ie,{prompt:oe,diagramType:e==="dmn"?void 0:e},{deduplicate:!0});if(_t){console.error("Function error:",_t),R("idle"),(ne=_t.message)!=null&&ne.includes("429")?L.error("Rate limit exceeded. Please try again in a moment."):(Te=_t.message)!=null&&Te.includes("402")?L.error("AI credits depleted. Please add more credits to continue."):L.error(`Failed to generate ${pe} model`);return}R("drawing"),await new Promise(on=>setTimeout(on,500));const Ht=(qe==null?void 0:qe.bpmnXml)||(qe==null?void 0:qe.dmnXml);Ht?(d(Ht),R("idle"),L.success(`${pe} model generated successfully!`)):(R("idle"),L.error("No diagram data received"))}catch(de){console.error("Error generating BPMN:",de),R("idle"),L.error("An error occurred while generating the model")}finally{l(!1)}},Ae=()=>{Nt(s),o("")},Qe=oe=>{o(oe)},ze=async oe=>{var _t,Ht;const pe="dataTransfer"in oe?(_t=oe.dataTransfer.files)==null?void 0:_t[0]:(Ht=oe.target.files)==null?void 0:Ht[0];if(!pe)return;const{data:{user:ne},error:Te}=await he.auth.getUser();if(Te||!ne){L.error("Please log in to upload and analyze documents"),n("/auth");return}if(!["image/png","image/jpeg","image/jpg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword","text/plain"].includes(pe.type)){L.error("Please upload an image, PDF, Word document, or text file");return}l(!0);const Ie=e==="bpmn"?"BPMN":e==="pid"?"P&ID":"DMN";L.info(`Analyzing document and generating ${Ie}...`);const qe=new FileReader;qe.onloadend=async()=>{const on=qe.result;v({name:pe.name,type:pe.type,base64:on}),x(!0),l(!1),L.success(`File uploaded! Review the preview before generating ${Ie}.`)},qe.readAsDataURL(pe)},Ot=async()=>{if(h)pt.current&&pt.current.state==="recording"&&pt.current.stop(),je.current&&(je.current.getTracks().forEach(oe=>oe.stop()),je.current=null),p(!1),pt.current=null;else try{const oe=await navigator.mediaDevices.getUserMedia({audio:!0});je.current=oe;const pe=new MediaRecorder(oe),ne=[];pe.ondataavailable=Te=>{ne.push(Te.data)},pe.onstop=async()=>{const Te=new Blob(ne,{type:"audio/webm"}),de=new FileReader;de.readAsDataURL(Te),de.onloadend=async()=>{var qe;const Ie=(qe=de.result)==null?void 0:qe.toString().split(",")[1];try{const{data:_t,error:Ht}=await he.functions.invoke("speech-to-text",{body:{audio:Ie,language:f}});if(Ht)throw Ht;_t!=null&&_t.text&&(o(_t.text),L.success("Voice recorded successfully!"))}catch(_t){console.error("Speech-to-text error:",_t),L.error("Failed to convert speech to text.")}},je.current&&(je.current.getTracks().forEach(Ie=>Ie.stop()),je.current=null)},pe.start(),pt.current=pe,p(!0),L.info("Recording... Click again to stop")}catch(oe){console.error("Error accessing microphone:",oe),L.error("Could not access microphone. Please check permissions.")}},Zt=async()=>{if(g){l(!0),x(!1),R("reading"),await new Promise(oe=>setTimeout(oe,500)),R("generating");try{const{data:{user:oe}}=await he.auth.getUser();if(!oe){R("idle"),L.error("Please log in to continue"),n("/auth");return}const pe=g.base64.length*.75,ne=200*1024*1024;if(pe>ne){R("idle"),l(!1),L.error("File too large",{description:"Maximum file size is 200 MB. Please select a smaller file."});return}const Te=L.loading("Processing your file...",{description:"This may take 30-60 seconds for complex diagrams"}),{data:de,error:Ie}=await he.functions.invoke("vision-to-bpmn",{body:{imageBase64:g.base64,diagramType:e}});if(L.dismiss(Te),Ie){console.error("Vision AI error:",Ie),R("idle"),l(!1);const qe=Ie.message||"Failed to start diagram generation";L.error("Upload failed",{description:qe,action:{label:"Retry",onClick:()=>{Zt()}},duration:1e4});return}if(!de||!de.jobId){R("idle"),l(!1),L.error("Upload failed",{description:"Failed to start processing",action:{label:"Retry",onClick:()=>{Zt()}},duration:1e4});return}W(de.jobId),R("generating"),L.info("Processing started",{description:"We'll notify you when your diagram is ready (this may take 1-2 minutes)"})}catch(oe){console.error("Vision AI processing error:",oe),R("idle"),l(!1);const pe=oe instanceof Error?oe.message:"Network error - Please check your connection and try again";L.error("Upload failed",{description:pe,action:{label:"Retry",onClick:()=>{Zt()}},duration:1e4})}}},me=async()=>{if(!c||!y.trim()){const ne=e==="bpmn"?"BPMN":e==="pid"?"P&ID":"DMN";L.error(`Please enter instructions to refine the ${ne}`);return}const{data:{user:oe}}=await he.auth.getUser();if(!oe){const ne=e==="bpmn"?"BPMN":e==="pid"?"P&ID":"DMN";L.error(`Please log in to refine ${ne}`),n("/auth");return}S(!0);const pe=e==="bpmn"?"BPMN":e==="pid"?"P&ID":"DMN";L.info(`Refining ${pe} based on your instructions...`),C("analyzing"),await new Promise(ne=>setTimeout(ne,500)),C("refining");try{const{data:ne,error:Te}=await he.functions.invoke("refine-bpmn",{body:{currentBpmnXml:c,instructions:y,userId:oe.id,diagramType:e}});if(Te){console.error("Refinement error:",Te),C("idle");const de=Te.message||JSON.stringify(Te);de.includes("429")?L.error("Rate limit exceeded. Please try again in a moment."):de.includes("402")?L.error("AI credits depleted. Please add more credits to continue."):de.includes("401")||de.includes("Authentication")?(L.error("Authentication required. Please log in again."),n("/auth")):L.error(`Failed to refine ${pe}: ${de}`);return}if(ne!=null&&ne.error){console.error("Refinement error in response:",ne.error),C("idle");const de=typeof ne.error=="string"?ne.error:JSON.stringify(ne.error);de.includes("402")?L.error("AI credits depleted. Please add more credits to continue."):de.includes("401")||de.includes("Authentication")?(L.error("Authentication required. Please log in again."),n("/auth")):L.error(`Failed to refine ${pe}: ${de}`);return}if(ne!=null&&ne.bpmnXml){C("applying"),await new Promise(Ie=>setTimeout(Ie,300));const de=ne.bpmnXml.includes("</bpmn:definitions>")||ne.bpmnXml.includes("</definitions>");ne.bpmnXml.includes("<?xml")&&de?(d(ne.bpmnXml),C("idle"),L.success(`${pe} refined successfully!`),w("")):(console.error("Received invalid diagram XML:",ne.bpmnXml.substring(0,200)),C("idle"),L.error("Received invalid diagram structure. Please try again."))}else console.error("No refined diagram received. Response:",ne),C("idle"),L.error("No refined diagram received. The function may not be deployed or there was an error.")}catch(ne){console.error("BPMN refinement error:",ne),C("idle");const Te=ne instanceof Error?ne.message:String(ne);Te.includes("Failed to fetch")||Te.includes("load the resource")?L.error("Network error: Unable to reach refine-bpmn function. Please check if the function is deployed."):L.error(`Failed to refine ${e==="bpmn"?"BPMN":e==="pid"?"P&ID":"DMN"}: ${Te}`)}finally{S(!1)}};return u.jsx("section",{className:"py-24 bg-muted/20 relative","data-section":"try-prossmind",children:u.jsxs("div",{className:"container mx-auto px-6",children:[u.jsxs("div",{className:"text-center mb-12 slide-up",children:[u.jsxs("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:["Try ",u.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"ProssMind!"})]}),u.jsx("p",{className:"text-lg text-muted-foreground max-w-3xl mx-auto",children:e==="bpmn"?"Describe your business process, upload an image, PDF, Word doc, or text file - AI will generate a BPMN diagram for you":"Describe your P&ID process, upload an image, PDF, Word doc, or text file - AI will generate a P&ID diagram for you"})]}),u.jsxs("div",{className:"max-w-5xl mx-auto mt-12 space-y-8",children:[u.jsxs("div",{className:"bg-gradient-to-br from-muted/50 to-muted/30 rounded-2xl p-8 border border-border/50 slide-up stagger-1",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[u.jsx("div",{className:"rounded-full bg-primary/10 p-2",children:u.jsx(yd,{className:"h-5 w-5 text-primary"})}),u.jsxs("h3",{className:"font-semibold text-lg",children:["Try these ",e==="bpmn"?"BPMN":e==="pid"?"P&ID":"DMN"," examples:"]})]}),u.jsx("div",{className:"flex flex-wrap gap-3",children:lt.map((oe,pe)=>u.jsx(G,{variant:"outline",size:"sm",onClick:()=>Qe(oe),className:"text-sm hover:bg-primary/10 hover:border-primary/50 transition-all whitespace-nowrap",disabled:a,style:{minWidth:"max-content",paddingLeft:"1.2em",paddingRight:"1.2em"},"aria-label":`Use suggestion: ${oe}`,children:oe},pe))})]}),u.jsx("div",{className:"bg-card border border-border rounded-2xl p-8 shadow-xl slide-up stagger-2",children:u.jsxs("div",{className:"space-y-6",children:[u.jsxs(CK,{defaultValue:"prompt",className:"w-full",children:[u.jsxs(JN,{className:"grid w-full grid-cols-3 bg-muted/50",children:[u.jsxs(jd,{value:"prompt",className:"gap-2 data-[state=active]:bg-background data-[state=active]:shadow-sm",children:[u.jsx(Gk,{className:"h-4 w-4"}),u.jsx("span",{className:"hidden sm:inline",children:"Prompt"})]}),u.jsxs(jd,{value:"voice",className:"gap-2 data-[state=active]:bg-background data-[state=active]:shadow-sm",children:[u.jsx(ig,{className:"h-4 w-4"}),u.jsx("span",{className:"hidden sm:inline",children:"Voice"})]}),u.jsxs(jd,{value:"attachment",className:"gap-2 data-[state=active]:bg-background data-[state=active]:shadow-sm",children:[u.jsx(sg,{className:"h-4 w-4"}),u.jsx("span",{className:"hidden sm:inline",children:"Attachment"})]})]}),u.jsx(kd,{value:"prompt",className:"mt-4",children:u.jsx($i,{placeholder:`Describe your ${e==="bpmn"?"business process":"P&ID process"} step by step...`,value:s,onChange:oe=>o(oe.target.value),className:"min-h-[120px] resize-none border-muted",style:{paddingLeft:"1.2em",paddingRight:"1.2em"},disabled:a})}),u.jsx(kd,{value:"voice",className:"mt-4",children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(QS,{className:"h-4 w-4 text-muted-foreground"}),u.jsxs(_l,{value:f,onValueChange:m,children:[u.jsx(Oa,{className:"w-[200px] h-8",children:u.jsx(El,{placeholder:"Select language"})}),u.jsxs(Ra,{children:[u.jsx(tt,{value:"en-US",children:"English (US)"}),u.jsx(tt,{value:"en-GB",children:"English (UK)"}),u.jsx(tt,{value:"es-ES",children:"Spanish"}),u.jsx(tt,{value:"fr-FR",children:"French"}),u.jsx(tt,{value:"de-DE",children:"German"}),u.jsx(tt,{value:"it-IT",children:"Italian"}),u.jsx(tt,{value:"pt-BR",children:"Portuguese (Brazil)"}),u.jsx(tt,{value:"pt-PT",children:"Portuguese (Portugal)"}),u.jsx(tt,{value:"ru-RU",children:"Russian"}),u.jsx(tt,{value:"ja-JP",children:"Japanese"}),u.jsx(tt,{value:"ko-KR",children:"Korean"}),u.jsx(tt,{value:"zh-CN",children:"Chinese (Simplified)"}),u.jsx(tt,{value:"zh-TW",children:"Chinese (Traditional)"}),u.jsx(tt,{value:"ar-SA",children:"Arabic"}),u.jsx(tt,{value:"hi-IN",children:"Hindi"})]})]}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"Voice recognition language"})]}),u.jsx(G,{variant:"outline",onClick:Ot,disabled:a,className:h?"text-red-500 border-red-500":"w-full",children:h?u.jsxs(u.Fragment,{children:[u.jsx(ZS,{className:"h-4 w-4 mr-2 animate-pulse"}),"Click to Stop Recording"]}):u.jsxs(u.Fragment,{children:[u.jsx(ig,{className:"h-4 w-4 mr-2"}),"Start Voice Recording"]})})]})}),u.jsx(kd,{value:"attachment",className:"mt-4",children:u.jsxs("div",{className:"space-y-4",children:[u.jsx("input",{ref:ve,type:"file",accept:"image/*,.pdf,.doc,.docx,.txt",onChange:ze,className:"hidden"}),u.jsxs("div",{onDragOver:oe=>{oe.preventDefault(),se(!0)},onDragLeave:()=>se(!1),onDrop:oe=>{oe.preventDefault(),se(!1),ze(oe)},className:`border-2 border-dashed rounded-2xl p-8 text-center transition-all ${ce?"border-primary bg-primary/5 scale-[1.02]":"border-border hover:border-primary/50"}`,children:[u.jsxs("div",{className:"flex justify-center gap-4 mb-4",children:[u.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[u.jsx(ts,{className:"h-5 w-5","aria-hidden":"true"}),u.jsx("span",{className:"text-xs",children:"PNG/JPG"})]}),u.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[u.jsx(nr,{className:"h-5 w-5","aria-hidden":"true"}),u.jsx("span",{className:"text-xs",children:"PDF"})]}),u.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[u.jsx(XS,{className:"h-5 w-5","aria-hidden":"true"}),u.jsx("span",{className:"text-xs",children:"DOCX"})]})]}),u.jsxs(G,{variant:"outline",onClick:()=>{var oe;return(oe=ve.current)==null?void 0:oe.click()},disabled:a,className:"w-full","aria-label":"Upload file",children:[u.jsx(sg,{className:"h-4 w-4 mr-2","aria-hidden":"true"}),"Upload File"]}),u.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"Drag and drop a file here or click to browse"})]})]})})]}),a&&P!=="idle"&&u.jsxs("div",{className:"space-y-3 p-4 bg-muted/50 rounded-lg border border-border",children:[u.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Processing your document..."}),u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsxs("span",{className:P==="reading"?"font-semibold":"text-muted-foreground",children:[P==="reading"&&u.jsx(Vr,{className:"h-4 w-4 inline mr-2 animate-spin","aria-hidden":"true"}),P!=="reading"&&" ","Step 1: Reading prompt..."]}),P==="reading"&&u.jsx(bs,{value:33,className:"w-24","aria-label":"Progress: 33%"})]}),u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsxs("span",{className:P==="generating"?"font-semibold":P==="drawing"?"text-muted-foreground":"",children:[P==="generating"&&u.jsx(Vr,{className:"h-4 w-4 inline mr-2 animate-spin","aria-hidden":"true"}),P!=="generating"&&P!=="reading"&&" ","Step 2: Generating..."]}),P==="generating"&&u.jsx(bs,{value:66,className:"w-24","aria-label":"Progress: 66%"})]}),u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsxs("span",{className:P==="drawing"?"font-semibold":"text-muted-foreground",children:[P==="drawing"&&u.jsx(Vr,{className:"h-4 w-4 inline mr-2 animate-spin","aria-hidden":"true"}),P!=="drawing"&&P!=="generating"&&P!=="reading"&&" ","Step 3: Drawing Diagram..."]}),P==="drawing"&&u.jsx(bs,{value:100,className:"w-24","aria-label":"Progress: 100%"})]})]}),u.jsxs(G,{onClick:Ae,className:"gap-2 shadow-lg hover:shadow-xl hover:scale-[1.03] transition-all w-full",size:"lg",disabled:a||!s.trim(),"aria-label":`Generate ${e==="bpmn"?"BPMN":e==="pid"?"P&ID":"DMN"} diagram`,children:[a?"Generating...":`Generate ${e==="bpmn"?"BPMN":e==="pid"?"P&ID":"DMN"}`,u.jsx(og,{className:"h-4 w-4","aria-hidden":"true"})]})]})}),b&&g&&u.jsxs("div",{className:"bg-card border border-border rounded-2xl p-6 shadow-lg",children:[u.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Preview Uploaded File"}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[u.jsxs("p",{className:"text-sm font-medium mb-2",children:["File: ",g.name]}),g.type.startsWith("image/")&&u.jsx("div",{className:"mt-4 max-h-96 overflow-auto",children:u.jsx("img",{src:g.base64,alt:"Preview",className:"max-w-full rounded border"})}),g.extractedText&&u.jsxs("div",{className:"mt-4",children:[u.jsx("p",{className:"text-sm font-medium mb-2",children:"Extracted Content Preview:"}),u.jsx("div",{className:"bg-background rounded p-3 max-h-48 overflow-auto text-xs",children:g.extractedText})]})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx(G,{onClick:Zt,className:"flex-1",disabled:a,children:a?"Generating...":`Generate ${e==="bpmn"?"BPMN":e==="pid"?"P&ID":"DMN"} from this file`}),u.jsx(G,{variant:"outline",onClick:()=>{x(!1),v(null)},children:"Cancel"})]})]})]}),c&&u.jsx("div",{id:"bpmn-viewer",className:"mt-12",children:e==="dmn"?u.jsx(QN,{xml:c,onSave:d,onRefine:()=>I(!0)}):u.jsx(GP,{xml:c,onSave:d,diagramType:e,onRefine:()=>I(!0)})}),u.jsx(Ur,{open:N,onOpenChange:I,children:u.jsxs(Ar,{className:"sm:max-w-[500px]",children:[u.jsxs(Ir,{children:[u.jsxs(Dr,{children:["Refine ",e==="bpmn"?"BPMN":e==="pid"?"P&ID":"DMN"," Diagram"]}),u.jsxs($r,{children:["Describe the changes you'd like to make to your ",e==="bpmn"?"BPMN":e==="pid"?"P&ID":"DMN"," diagram"]})]}),u.jsx($i,{value:y,onChange:oe=>w(oe.target.value),placeholder:`e.g., "Add a ${e==="bpmn"?"decision gateway":e==="pid"?"control valve":"new rule"} after the first ${e==="bpmn"?"task":e==="pid"?"process unit":"input column"}"`,className:"min-h-[120px]"}),u.jsxs("div",{className:"flex gap-2 justify-end",children:[u.jsx(G,{variant:"outline",onClick:()=>{I(!1),w("")},children:"Cancel"}),u.jsx(G,{onClick:me,disabled:E||!y.trim(),children:E?"Refining...":"Apply Changes"})]})]})})]})]})})};async function kK(t){const{data:e,error:n}=await he.from("vision_bpmn_jobs").select("bpmn_xml").eq("id",t).single();return n||!(e!=null&&e.bpmn_xml)?(console.error("Failed to load job result:",n),null):e.bpmn_xml}function xIe(){const[t,e]=_.useState(null),[n,r]=_.useState(null),{jobId:i}=wB();return _.useEffect(()=>{he.auth.getSession().then(({data:{session:o}})=>{r((o==null?void 0:o.user)??null)});const{data:{subscription:s}}=he.auth.onAuthStateChange((o,a)=>{r((a==null?void 0:a.user)??null)});return()=>s.unsubscribe()},[]),_.useEffect(()=>{i&&(async()=>{try{const o=await kK(i);e(o)}catch(o){console.error("Error loading job result:",o)}})()},[i]),u.jsx(mn,{children:u.jsxs("div",{className:"flex flex-col gap-8",children:[u.jsx(jK,{user:n,diagramType:"pid"}),t&&u.jsx(GP,{xml:t,diagramType:"pid"})]})})}function bIe(){const[t,e]=_.useState(null),[n,r]=_.useState(null),{jobId:i}=wB();return _.useEffect(()=>{he.auth.getSession().then(({data:{session:o}})=>{r((o==null?void 0:o.user)??null)});const{data:{subscription:s}}=he.auth.onAuthStateChange((o,a)=>{r((a==null?void 0:a.user)??null)});return()=>s.unsubscribe()},[]),_.useEffect(()=>{i&&(async()=>{try{const o=await kK(i);e(o)}catch(o){console.error("Error loading job result:",o)}})()},[i]),u.jsx(mn,{children:u.jsxs("div",{className:"flex flex-col gap-8",children:[u.jsx(jK,{user:n,diagramType:"dmn"}),t&&u.jsx(QN,{xml:t})]})})}async function wIe(t){try{const{data:e,error:n}=await he.from("projects").insert(t).select().single();return n?{data:null,error:new Error(n.message)}:{data:e,error:null}}catch(e){return{data:null,error:e instanceof Error?e:new Error("Unknown error")}}}async function _Ie(t,e){try{let n=he.from("projects").select("*").eq("user_id",t).order("last_accessed_at",{ascending:!1});e!=null&&e.diagramType&&e.diagramType!=="all"&&(n=n.eq("diagram_type",e.diagramType));const{data:r,error:i}=await n;return i?{data:null,error:new Error(i.message)}:{data:r,error:null}}catch(n){return{data:null,error:n instanceof Error?n:new Error("Unknown error")}}}async function K5(t,e,n){try{const{data:r,error:i}=await he.from("projects").update(n).eq("id",t).eq("user_id",e).select().single();return i?{data:null,error:new Error(i.message)}:{data:r,error:null}}catch(r){return{data:null,error:r instanceof Error?r:new Error("Unknown error")}}}async function EIe(t,e){try{const{error:n}=await he.from("projects").delete().eq("id",t).eq("user_id",e);return n?{error:new Error(n.message)}:{error:null}}catch(n){return{error:n instanceof Error?n:new Error("Unknown error")}}}async function PK(t,e){try{const{error:n}=await he.from("projects").update({last_accessed_at:new Date().toISOString()}).eq("id",t).eq("user_id",e);return n?{error:new Error(n.message)}:{error:null}}catch(n){return{error:n instanceof Error?n:new Error("Unknown error")}}}async function SIe(t,e=6){try{const{data:n,error:r}=await he.from("projects").select("*").eq("user_id",t).order("last_accessed_at",{ascending:!1}).limit(e);return r?{data:null,error:new Error(r.message)}:{data:n,error:null}}catch(n){return{data:null,error:n instanceof Error?n:new Error("Unknown error")}}}const Y5=({user:t})=>{const e=Ns(),{remainingPrompts:n,isUnlimited:r}=Sw(!0),[i,s]=_.useState([]),[o,a]=_.useState(!0);_.useEffect(()=>{const c=async()=>{a(!0);const{data:d,error:h}=await SIe(t.id,6);h?(console.error("Failed to load recent projects:",h),s([])):d&&s(d),a(!1)};t!=null&&t.id&&c()},[t==null?void 0:t.id]);const l=async c=>{await PK(c.id,t.id);const d=c.diagram_type==="bpmn"?"generatedBpmn":c.diagram_type==="pid"?"generatedPid":"generatedDmn";localStorage.setItem(d,c.bpmn_xml),localStorage.setItem("diagramType",c.diagram_type),localStorage.setItem("currentProjectId",c.id);const h=c.diagram_type==="bpmn"?"/bpmn-generator":c.diagram_type==="pid"?"/pid-generator":"/dmn-generator";sr(e,h)};return u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Dashboard"}),u.jsxs("p",{className:"text-muted-foreground",children:["Welcome back, ",t.email]})]}),u.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[u.jsxs(De,{className:"cursor-pointer hover:shadow-[0_10px_15px_-3px_rgba(0,0,0,0.1),0_4px_6px_-2px_rgba(0,0,0,0.05),0_0_20px_hsl(var(--primary)/0.3)] hover:scale-[1.02] hover:-translate-y-1 transition-all duration-300 flex flex-col",onClick:()=>sr(e,"/bpmn-generator"),children:[u.jsxs(He,{className:"flex-1",children:[u.jsxs("div",{className:"flex flex-col items-center text-center mb-4",children:[u.jsx(js,{className:"h-10 w-10 text-primary mb-4"}),u.jsx(We,{children:"New BPMN Diagram"})]}),u.jsx(Je,{className:"text-center",children:"Create a new business process diagram"})]}),u.jsx(Ue,{className:"mt-auto",children:u.jsxs(G,{className:"w-full",onClick:c=>{c.stopPropagation(),sr(e,"/bpmn-generator")},children:[u.jsx(Qh,{className:"h-4 w-4 mr-2"}),"Create BPMN"]})})]}),u.jsxs(De,{className:"cursor-pointer hover:shadow-[0_10px_15px_-3px_rgba(0,0,0,0.1),0_4px_6px_-2px_rgba(0,0,0,0.05),0_0_20px_hsl(var(--primary)/0.3)] hover:scale-[1.02] hover:-translate-y-1 transition-all duration-300 flex flex-col",onClick:()=>sr(e,"/pid-generator"),children:[u.jsxs(He,{className:"flex-1",children:[u.jsxs("div",{className:"flex flex-col items-center text-center mb-4",children:[u.jsx(Od,{className:"h-10 w-10 text-primary mb-4"}),u.jsx(We,{children:"New P&ID Diagram"})]}),u.jsx(Je,{className:"text-center",children:"Create a new piping and instrumentation diagram"})]}),u.jsx(Ue,{className:"mt-auto",children:u.jsxs(G,{className:"w-full",onClick:c=>{c.stopPropagation(),sr(e,"/pid-generator")},children:[u.jsx(Qh,{className:"h-4 w-4 mr-2"}),"Create P&ID"]})})]}),u.jsxs(De,{className:"cursor-pointer hover:shadow-[0_10px_15px_-3px_rgba(0,0,0,0.1),0_4px_6px_-2px_rgba(0,0,0,0.05),0_0_20px_hsl(var(--primary)/0.3)] hover:scale-[1.02] hover:-translate-y-1 transition-all duration-300 flex flex-col",onClick:()=>sr(e,"/dmn-generator"),children:[u.jsxs(He,{className:"flex-1",children:[u.jsxs("div",{className:"flex flex-col items-center text-center mb-4",children:[u.jsx(e0,{className:"h-10 w-10 text-primary mb-4"}),u.jsx(We,{children:"New DMN Decision"})]}),u.jsx(Je,{className:"text-center",children:"Create a new decision model and notation diagram"})]}),u.jsx(Ue,{className:"mt-auto",children:u.jsxs(G,{className:"w-full",onClick:c=>{c.stopPropagation(),sr(e,"/dmn-generator")},children:[u.jsx(Qh,{className:"h-4 w-4 mr-2"}),"Create DMN"]})})]}),u.jsxs(De,{className:"cursor-pointer hover:shadow-[0_10px_15px_-3px_rgba(0,0,0,0.1),0_4px_6px_-2px_rgba(0,0,0,0.05),0_0_20px_hsl(var(--primary)/0.3)] hover:scale-[1.02] hover:-translate-y-1 transition-all duration-300 flex flex-col",onClick:()=>sr(e,"/vision-ai"),children:[u.jsxs(He,{className:"flex-1",children:[u.jsxs("div",{className:"flex flex-col items-center text-center mb-4",children:[u.jsx(Ia,{className:"h-10 w-10 text-primary mb-4"}),u.jsx(We,{children:"Vision AI"})]}),u.jsx(Je,{className:"text-center",children:"Upload images to generate diagrams"})]}),u.jsx(Ue,{className:"mt-auto",children:u.jsxs(G,{className:"w-full",onClick:c=>{c.stopPropagation(),sr(e,"/vision-ai")},children:[u.jsx(Qh,{className:"h-4 w-4 mr-2"}),"Upload Image"]})})]})]}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[u.jsxs(De,{className:"flex flex-col hover:shadow-[0_10px_15px_-3px_rgba(0,0,0,0.1),0_4px_6px_-2px_rgba(0,0,0,0.05),0_0_20px_hsl(var(--primary)/0.3)] hover:scale-[1.02] hover:-translate-y-1 transition-all duration-300",children:[u.jsxs(He,{className:"flex-1",children:[u.jsxs("div",{className:"flex flex-col items-center text-center mb-4",children:[u.jsx("div",{className:"h-10 w-10 mb-4 flex items-center justify-center",children:u.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:u.jsx("span",{className:"text-primary font-bold text-xl",children:""})})}),u.jsx(We,{children:"Usage Statistics"})]}),u.jsx(Je,{className:"text-center",children:"Your current plan usage"})]}),u.jsxs(Ue,{className:"flex-1 flex flex-col",children:[u.jsxs("div",{className:"space-y-4 flex-1",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("span",{className:"text-sm text-muted-foreground",children:"Free Prompts Remaining"}),u.jsx("span",{className:"text-2xl font-bold",children:r?"":n})]}),!r&&u.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:u.jsx("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:`${n/5*100}%`}})})]}),u.jsx("div",{className:"mt-auto pt-4",children:u.jsx(G,{variant:"outline",className:"w-full",onClick:()=>sr(e,"/settings"),children:"View Plan Details"})})]})]}),u.jsxs(De,{className:"flex flex-col hover:shadow-[0_10px_15px_-3px_rgba(0,0,0,0.1),0_4px_6px_-2px_rgba(0,0,0,0.05),0_0_20px_hsl(var(--primary)/0.3)] hover:scale-[1.02] hover:-translate-y-1 transition-all duration-300",children:[u.jsxs(He,{className:"flex-1",children:[u.jsxs("div",{className:"flex flex-col items-center text-center mb-4",children:[u.jsx("div",{className:"h-10 w-10 mb-4 flex items-center justify-center",children:u.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:u.jsx(Vk,{className:"h-5 w-5 text-primary"})})}),u.jsx(We,{children:"Recent Projects"})]}),u.jsx(Je,{className:"text-center",children:"Your recently created diagrams"})]}),u.jsxs(Ue,{className:"flex-1 flex flex-col",children:[u.jsx("div",{className:"flex-1",children:o?u.jsx("div",{className:"flex items-center justify-center py-8",children:u.jsx(Vr,{className:"h-6 w-6 animate-spin text-primary"})}):i.length>0?u.jsx("div",{className:"space-y-3",children:i.map(c=>u.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border hover:bg-muted/50 cursor-pointer transition-colors",onClick:()=>l(c),children:[u.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[c.diagram_type==="bpmn"?u.jsx(js,{className:"h-4 w-4 text-primary flex-shrink-0"}):c.diagram_type==="pid"?u.jsx(Od,{className:"h-4 w-4 text-primary flex-shrink-0"}):u.jsx(e0,{className:"h-4 w-4 text-primary flex-shrink-0"}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsx("p",{className:"font-medium text-sm truncate",children:c.name}),u.jsxs("p",{className:"text-xs text-muted-foreground",children:[c.diagram_type==="bpmn"?"BPMN":c.diagram_type==="pid"?"P&ID":"DMN","  ",new Date(c.last_accessed_at).toLocaleDateString()]})]})]}),u.jsx(nr,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"})]},c.id))}):u.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[u.jsx(nr,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),u.jsx("p",{children:"No recent projects"}),u.jsx("p",{className:"text-sm mt-2",children:"Create your first diagram to get started"})]})}),u.jsx("div",{className:"mt-auto pt-4",children:u.jsx(G,{variant:"outline",className:"w-full",onClick:()=>sr(e,"/projects"),children:"View All Projects"})})]})]})]})]})})},CIe=({user:t})=>{const e=Ns(),[n,r]=_.useState([]),[i,s]=_.useState([]),[o,a]=_.useState(""),[l,c]=_.useState("all"),[d,h]=_.useState(!0),[p,f]=_.useState(!1),[m,g]=_.useState(null),[v,b]=_.useState(!1),x=async()=>{h(!0);const S=l!=="all"?{diagramType:l}:void 0,{data:j,error:C}=await _Ie(t.id,S);if(C){L.error("Failed to load projects"),console.error(C),h(!1);return}j&&r(j),h(!1)};_.useEffect(()=>{x()},[t.id,l]),_.useEffect(()=>{let S=n;o&&(S=S.filter(j=>{var C;return j.name.toLowerCase().includes(o.toLowerCase())||((C=j.description)==null?void 0:C.toLowerCase().includes(o.toLowerCase()))})),s(S)},[n,o]);const y=S=>{g(S),f(!0)},w=async()=>{if(!m)return;b(!0);const{error:S}=await EIe(m.id,t.id);S?(L.error("Failed to delete project"),console.error(S)):(L.success("Project deleted successfully"),await x()),b(!1),f(!1),g(null)},E=async S=>{await PK(S.id,t.id);const j=S.diagram_type==="bpmn"?"generatedBpmn":S.diagram_type==="pid"?"generatedPid":"generatedDmn";localStorage.setItem(j,S.bpmn_xml),localStorage.setItem("diagramType",S.diagram_type),localStorage.setItem("currentProjectId",S.id);const C=S.diagram_type==="bpmn"?"/bpmn-generator":S.diagram_type==="pid"?"/pid-generator":"/dmn-generator";sr(e,C)};return d?u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsx(mn,{children:u.jsx("div",{className:"flex items-center justify-center py-16",children:u.jsx(Vr,{className:"h-8 w-8 animate-spin text-primary"})})})}):u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsx("div",{className:"mb-8",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Projects"}),u.jsx("p",{className:"text-muted-foreground",children:"Manage your diagrams and processes"})]}),u.jsxs(G,{variant:"outline",size:"sm",onClick:x,disabled:d,children:[u.jsx(yee,{className:`h-4 w-4 mr-2 ${d?"animate-spin":""}`}),"Refresh"]})]})}),u.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[u.jsxs("div",{className:"relative flex-1",children:[u.jsx(Ig,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),u.jsx(zn,{placeholder:"Search projects...",value:o,onChange:S=>a(S.target.value),className:"pl-10"})]}),u.jsxs(_l,{value:l,onValueChange:S=>c(S),children:[u.jsx(Oa,{className:"w-full md:w-[180px]",children:u.jsx(El,{placeholder:"Filter by type"})}),u.jsxs(Ra,{children:[u.jsx(tt,{value:"all",children:"All Types"}),u.jsx(tt,{value:"bpmn",children:"BPMN"}),u.jsx(tt,{value:"pid",children:"P&ID"}),u.jsx(tt,{value:"dmn",children:"DMN"})]})]}),u.jsxs(G,{onClick:()=>sr(e,"/bpmn-generator"),children:[u.jsx(nr,{className:"h-4 w-4 mr-2"}),"New Project"]})]}),i.length>0?u.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(S=>u.jsxs(De,{className:"hover:shadow-lg transition-shadow",children:[u.jsx(He,{children:u.jsxs("div",{className:"flex items-start justify-between",children:[u.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[S.diagram_type==="bpmn"?u.jsx(js,{className:"h-6 w-6 text-primary flex-shrink-0"}):S.diagram_type==="pid"?u.jsx(Od,{className:"h-6 w-6 text-primary flex-shrink-0"}):u.jsx(e0,{className:"h-6 w-6 text-primary flex-shrink-0"}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsx(We,{className:"text-lg truncate",children:S.name}),u.jsx(Je,{children:new Date(S.created_at).toLocaleDateString()}),S.description&&u.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:S.description})]})]}),u.jsx(Bn,{variant:S.diagram_type==="bpmn"?"default":"secondary",className:"ml-2 flex-shrink-0",children:S.diagram_type.toUpperCase()})]})}),u.jsx(Ue,{children:u.jsxs("div",{className:"flex gap-2",children:[u.jsxs(G,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>E(S),children:[u.jsx(Kk,{className:"h-4 w-4 mr-2"}),"Edit"]}),u.jsx(G,{variant:"outline",size:"sm",onClick:()=>y(S),children:u.jsx(wv,{className:"h-4 w-4"})})]})})]},S.id))}):u.jsx(De,{children:u.jsxs(Ue,{className:"flex flex-col items-center justify-center py-16",children:[u.jsx(nr,{className:"h-16 w-16 text-muted-foreground mb-4 opacity-50"}),u.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No projects found"}),u.jsx("p",{className:"text-muted-foreground text-center mb-6",children:o||l!=="all"?"Try adjusting your search or filters":"Create your first diagram to get started"}),u.jsxs(G,{onClick:()=>sr(e,"/bpmn-generator"),children:[u.jsx(nr,{className:"h-4 w-4 mr-2"}),"Create New Project"]})]})}),u.jsx(WP,{open:p,onOpenChange:f,children:u.jsxs(g_,{children:[u.jsxs(v_,{children:[u.jsx(x_,{children:"Are you sure?"}),u.jsxs(b_,{children:['This will permanently delete "',m==null?void 0:m.name,'". This action cannot be undone.']})]}),u.jsxs(y_,{children:[u.jsx(__,{disabled:v,children:"Cancel"}),u.jsx(w_,{onClick:w,disabled:v,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:v?u.jsxs(u.Fragment,{children:[u.jsx(Vr,{className:"h-4 w-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})})};async function jIe(t){try{let e=he.from("templates").select("*").eq("is_active",!0).order("name",{ascending:!0});t!=null&&t.category&&t.category,t!=null&&t.diagramType;const{data:n,error:r}=await e;return r?{data:null,error:new Error(r.message)}:{data:n,error:null}}catch(e){return{data:null,error:e instanceof Error?e:new Error("Unknown error")}}}async function kIe(t,e){try{const{data:n,error:r}=await he.from("templates").select("bpmn_xml, usage_count").eq("id",t).eq("is_active",!0).single();return r||!n?{data:null,error:new Error((r==null?void 0:r.message)||"Template not found")}:(he.from("templates").update({usage_count:(n.usage_count||0)+1}).eq("id",t).then(()=>{},()=>{}),{data:n.bpmn_xml,error:null})}catch(n){return{data:null,error:n instanceof Error?n:new Error("Unknown error")}}}async function PIe(t){try{const{data:e,error:n}=await he.from("templates").insert(t).select().single();return n?{data:null,error:new Error(n.message)}:{data:e,error:null}}catch(e){return{data:null,error:e instanceof Error?e:new Error("Unknown error")}}}async function TIe(t,e){try{const{data:n,error:r}=await he.from("templates").update(e).eq("id",t).select().single();return r?{data:null,error:new Error(r.message)}:{data:n,error:null}}catch(n){return{data:null,error:n instanceof Error?n:new Error("Unknown error")}}}async function NIe(t){try{const{error:e}=await he.from("templates").update({is_active:!1}).eq("id",t);return e?{error:new Error(e.message)}:{error:null}}catch(e){return{error:e instanceof Error?e:new Error("Unknown error")}}}async function OIe(t){try{let e=he.from("templates").select("*").order("created_at",{ascending:!1});t!=null&&t.category&&t.category,t!=null&&t.diagramType;const{data:n,error:r}=await e;return r?{data:null,error:new Error(r.message)}:{data:n,error:null}}catch(e){return{data:null,error:e instanceof Error?e:new Error("Unknown error")}}}const RIe={Users:n0,ShoppingCart:Eee,Building2:Uk,Cog:JJ,Factory:Od,Workflow:js},AIe=t=>t&&RIe[t]||js,IIe=({user:t})=>{const e=Ns(),[n,r]=_.useState("all"),[i,s]=_.useState([]),[o,a]=_.useState(!0),[l,c]=_.useState(null);_.useEffect(()=>{(async()=>{a(!0),c(null);const{data:m,error:g}=await jIe();g?(c(g.message),L.error("Failed to load templates")):m&&s(m),a(!1)})()},[]);const d=["all",...Array.from(new Set(i.map(f=>f.category)))],h=n==="all"?i:i.filter(f=>f.category===n),p=async f=>{try{const{data:m,error:g}=await kIe(f.id,t.id);if(g||!m){L.error("Failed to load template");return}const v=f.diagram_type==="bpmn"?"generatedBpmn":f.diagram_type==="pid"?"generatedPid":"generatedDmn";localStorage.setItem(v,m),localStorage.setItem("diagramType",f.diagram_type),f.diagram_type==="bpmn"?sr(e,"/bpmn-generator"):f.diagram_type==="pid"?sr(e,"/pid-generator"):sr(e,"/dmn-generator"),L.success("Template loaded successfully!")}catch(m){L.error("Failed to use template"),console.error(m)}};return o?u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsx(mn,{children:u.jsx("div",{className:"flex items-center justify-center py-16",children:u.jsx(Vr,{className:"h-8 w-8 animate-spin text-primary"})})})}):l?u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsx(mn,{children:u.jsx(De,{className:"hover:shadow-[0_10px_15px_-3px_rgba(0,0,0,0.1),0_4px_6px_-2px_rgba(0,0,0,0.05),0_0_20px_hsl(var(--primary)/0.3)] hover:scale-[1.02] hover:-translate-y-1 transition-all duration-300",children:u.jsxs(Ue,{className:"flex flex-col items-center justify-center py-16",children:[u.jsx(js,{className:"h-16 w-16 text-muted-foreground mb-4 opacity-50"}),u.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Error loading templates"}),u.jsx("p",{className:"text-muted-foreground",children:l})]})})})}):u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Templates"}),u.jsx("p",{className:"text-muted-foreground",children:"Start with a pre-built process template"})]}),d.length>1&&u.jsx("div",{className:"flex flex-wrap gap-2 mb-8",children:d.map(f=>u.jsx(G,{variant:n===f?"default":"outline",onClick:()=>r(f),className:"capitalize",children:f},f))}),h.length>0?u.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(f=>{const m=AIe(f.icon_name);return u.jsxs(De,{className:"flex flex-col hover:shadow-[0_10px_15px_-3px_rgba(0,0,0,0.1),0_4px_6px_-2px_rgba(0,0,0,0.05),0_0_20px_hsl(var(--primary)/0.3)] hover:scale-[1.02] hover:-translate-y-1 transition-all duration-300",children:[u.jsxs(He,{className:"flex-1",children:[u.jsxs("div",{className:"flex items-start justify-between mb-3",children:[u.jsx(m,{className:"h-8 w-8 text-primary flex-shrink-0"}),u.jsx(Bn,{variant:f.diagram_type==="bpmn"?"default":"secondary",children:f.diagram_type.toUpperCase()})]}),u.jsx(We,{className:"mb-2 min-h-[3rem]",children:f.name}),u.jsx(Je,{className:"min-h-[4.5rem] max-h-[4.5rem] overflow-hidden",children:u.jsx("div",{className:"line-clamp-3",children:f.description||"No description available"})})]}),u.jsx(Ue,{className:"mt-auto pt-0",children:u.jsxs("div",{className:"flex items-center justify-between gap-2",children:[u.jsx(Bn,{variant:"outline",className:"capitalize flex-shrink-0",children:f.category}),u.jsx(G,{size:"sm",onClick:()=>p(f),className:"flex-shrink-0",children:"Use Template"})]})})]},f.id)})}):u.jsx(De,{className:"hover:shadow-[0_10px_15px_-3px_rgba(0,0,0,0.1),0_4px_6px_-2px_rgba(0,0,0,0.05),0_0_20px_hsl(var(--primary)/0.3)] hover:scale-[1.02] hover:-translate-y-1 transition-all duration-300",children:u.jsxs(Ue,{className:"flex flex-col items-center justify-center py-16",children:[u.jsx(js,{className:"h-16 w-16 text-muted-foreground mb-4 opacity-50"}),u.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No templates found"}),u.jsx("p",{className:"text-muted-foreground",children:"Try selecting a different category"})]})})]})})},DIe=({user:t})=>{const{toast:e}=_v(),[n,r]=_.useState(t.email||""),[i,s]=_.useState(!1),o=async a=>{a.preventDefault(),s(!0);try{const{error:l}=await he.auth.updateUser({email:n});if(l)throw l;e({title:"Email update requested",description:"Please check your new email for a confirmation link."})}catch(l){e({title:"Error updating email",description:l.message,variant:"destructive"})}finally{s(!1)}};return u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Account"}),u.jsx("p",{className:"text-muted-foreground",children:"Manage your account information"})]}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(Dg,{className:"h-5 w-5"}),"Profile Information"]}),u.jsx(Je,{children:"Your account details"})]}),u.jsxs(Ue,{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx(Vt,{children:"User ID"}),u.jsx(zn,{value:t.id,disabled:!0,className:"mt-1 font-mono text-sm"})]}),u.jsxs("form",{onSubmit:o,className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx(Vt,{htmlFor:"email",children:"Email Address"}),u.jsx(zn,{id:"email",type:"email",value:n,onChange:a=>r(a.target.value),className:"mt-1"})]}),u.jsx(G,{type:"submit",disabled:i||n===t.email,children:i?"Updating...":"Update Email"})]})]})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(Sl,{className:"h-5 w-5"}),"Security"]}),u.jsx(Je,{children:"Manage your account security"})]}),u.jsxs(Ue,{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx(Vt,{children:"Password"}),u.jsx("p",{className:"text-sm text-muted-foreground mt-1 mb-3",children:"Change your password to keep your account secure"}),u.jsx(G,{variant:"outline",onClick:()=>{e({title:"Password reset",description:"A password reset link has been sent to your email."})},children:"Change Password"})]}),u.jsxs("div",{className:"pt-4 border-t",children:[u.jsx(Vt,{children:"Account Created"}),u.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:new Date(t.created_at).toLocaleDateString()})]})]})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(Wk,{className:"h-5 w-5"}),"Email Preferences"]}),u.jsx(Je,{children:"Manage your email notifications"})]}),u.jsx(Ue,{children:u.jsx("p",{className:"text-sm text-muted-foreground",children:"Email preferences will be available soon."})})]})]})]})})},$Ie=({user:t})=>{const{remainingPrompts:e,isUnlimited:n}=Sw(!0),[r,i]=_.useState({email:!0,push:!1,updates:!0}),[s,o]=_.useState("en"),[a,l]=_.useState("system");return u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Settings"}),u.jsx("p",{className:"text-muted-foreground",children:"Customize your experience"})]}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsx(We,{children:"Plan Details"}),u.jsx(Je,{children:"Your current subscription plan"})]}),u.jsxs(Ue,{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx(Vt,{children:"Current Plan"}),u.jsx("p",{className:"text-2xl font-bold mt-1",children:n?"Pro":"Free"})]}),u.jsxs("div",{children:[u.jsx(Vt,{children:"Free Prompts Remaining"}),u.jsx("p",{className:"text-2xl font-bold mt-1",children:n?"":e})]}),u.jsx(G,{className:"w-full",children:"Upgrade Plan"})]})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(UJ,{className:"h-5 w-5"}),"Notifications"]}),u.jsx(Je,{children:"Manage your notification preferences"})]}),u.jsxs(Ue,{className:"space-y-4",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"space-y-0.5",children:[u.jsx(Vt,{children:"Email Notifications"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive updates via email"})]}),u.jsx(vl,{checked:r.email,onCheckedChange:c=>i({...r,email:c})})]}),u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"space-y-0.5",children:[u.jsx(Vt,{children:"Push Notifications"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive browser notifications"})]}),u.jsx(vl,{checked:r.push,onCheckedChange:c=>i({...r,push:c})})]}),u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"space-y-0.5",children:[u.jsx(Vt,{children:"Product Updates"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about new features"})]}),u.jsx(vl,{checked:r.updates,onCheckedChange:c=>i({...r,updates:c})})]})]})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(bv,{className:"h-5 w-5"}),"API Keys"]}),u.jsx(Je,{children:"Manage your API access keys"})]}),u.jsxs(Ue,{children:[u.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"API keys allow you to integrate ProssMind with your applications."}),u.jsx(G,{variant:"outline",className:"w-full",children:"Generate API Key"})]})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(qk,{className:"h-5 w-5"}),"Preferences"]}),u.jsx(Je,{children:"Customize your app experience"})]}),u.jsxs(Ue,{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx(Vt,{htmlFor:"language",children:"Language"}),u.jsxs(_l,{value:s,onValueChange:o,children:[u.jsx(Oa,{id:"language",className:"mt-1",children:u.jsx(El,{})}),u.jsxs(Ra,{children:[u.jsx(tt,{value:"en",children:"English"}),u.jsx(tt,{value:"de",children:"Deutsch"}),u.jsx(tt,{value:"fr",children:"Franais"})]})]})]}),u.jsxs("div",{children:[u.jsx(Vt,{htmlFor:"theme",children:"Theme"}),u.jsxs(_l,{value:a,onValueChange:l,children:[u.jsx(Oa,{id:"theme",className:"mt-1",children:u.jsx(El,{})}),u.jsxs(Ra,{children:[u.jsx(tt,{value:"light",children:"Light"}),u.jsx(tt,{value:"dark",children:"Dark"}),u.jsx(tt,{value:"system",children:"System"})]})]})]})]})]})]})]})})};function MIe({open:t,onOpenChange:e,onSave:n,diagramType:r="bpmn",defaultName:i="",defaultDescription:s="",isLoading:o=!1}){const[a,l]=_.useState(""),[c,d]=_.useState("");_.useEffect(()=>{t&&(l(i||""),d(s||""))},[t,i,s]);const h=()=>{a.trim()&&n(a.trim(),c.trim())},p=()=>{l(""),d(""),e(!1)},f=r==="bpmn"?"BPMN":r==="pid"?"P&ID":"DMN";return u.jsx(Ur,{open:t,onOpenChange:e,children:u.jsxs(Ar,{children:[u.jsxs(Ir,{children:[u.jsxs(Dr,{children:["Save ",f," Project"]}),u.jsx($r,{children:"Give your project a name and optional description to save it to your workspace."})]}),u.jsxs("div",{className:"space-y-4 py-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsxs(Vt,{htmlFor:"project-name",children:["Project Name ",u.jsx("span",{className:"text-destructive",children:"*"})]}),u.jsx(zn,{id:"project-name",placeholder:`My ${f} Diagram`,value:a,onChange:m=>l(m.target.value),onKeyDown:m=>{m.key==="Enter"&&a.trim()&&h()},maxLength:100,disabled:o})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Vt,{htmlFor:"project-description",children:"Description (Optional)"}),u.jsx($i,{id:"project-description",placeholder:"Add a description for your project...",value:c,onChange:m=>d(m.target.value),maxLength:500,rows:3,disabled:o})]})]}),u.jsxs(s0,{children:[u.jsx(G,{variant:"outline",onClick:p,disabled:o,children:"Cancel"}),u.jsx(G,{onClick:h,disabled:!a.trim()||o,children:o?"Saving...":"Save Project"})]})]})})}const LIe=["Create a customer onboarding process","Design an order fulfillment workflow","Build a support ticket resolution process","Generate an employee hiring workflow","Create an invoice approval process"],OS=({user:t})=>{const e=Ns(),n=Nl(),{hasUsedAllPrompts:r,usePrompt:i}=Sw(!!t),[s,o]=_.useState(""),[a,l]=_.useState(!1),[c,d]=_.useState(null),[h,p]=_.useState("bpmn"),f=Lee(),[m,g]=_.useState(!1),[v,b]=_.useState("en-US"),[x,y]=_.useState(null),[w,E]=_.useState(!1),[S,j]=_.useState(""),[C,P]=_.useState(!1),[R,N]=_.useState("idle"),[I,M]=_.useState("idle"),[W,ce]=_.useState(!1),[se,ve]=_.useState(null),[pt,je]=_.useState(!1),lt=_.useRef(null),Nt=_.useRef(null),Ae=_.useRef(null),[Qe,ze]=_.useState(!1),[Ot,Zt]=_.useState(null),[me,oe]=_.useState(!1),[pe,ne]=_.useState(null);_.useEffect(()=>{const te=localStorage.getItem("diagramType")||"bpmn",Be=te==="bpmn"?"generatedBpmn":te==="pid"?"generatedPid":"generatedDmn",xe=localStorage.getItem(Be),ct=localStorage.getItem("currentProjectId");if(xe){d(xe),Zt(ct),localStorage.removeItem(Be),localStorage.removeItem("diagramType"),ct&&localStorage.removeItem("currentProjectId");const ft=te==="bpmn"?"BPMN":te==="pid"?"P&ID":"DMN";L.success(`Your generated ${ft} diagram is ready!`,{description:"You can now view and edit your process diagram"}),setTimeout(()=>{var nt;(nt=document.getElementById("bpmn-viewer"))==null||nt.scrollIntoView({behavior:"smooth",block:"start"})},500)}},[]),_.useEffect(()=>{if(!se)return;let te;const Be=async()=>{const{data:ft,error:nt}=await he.from("vision_bpmn_jobs").select("status, bpmn_xml, error_message").eq("id",se).single();if(nt){console.error("Error checking job status:",nt);return}if(console.log("Job status:",ft.status),ft.status==="completed"&&ft.bpmn_xml){const fe=h==="bpmn"?"BPMN":h==="pid"?"P&ID":"DMN";d(ft.bpmn_xml),M("idle"),l(!1),ve(null),E(!1),y(null),L.success(`${fe} diagram generated successfully!`),setTimeout(()=>{var Ye;(Ye=document.getElementById("bpmn-viewer"))==null||Ye.scrollIntoView({behavior:"smooth",block:"start"})},500),te&&clearInterval(te)}else if(ft.status==="failed"){const fe=ft.error_message||"Processing failed. Please try again.";M("idle"),l(!1),ve(null),L.error("Upload failed",{description:fe,action:{label:"Retry",onClick:()=>{}},duration:1e4}),te&&clearInterval(te)}},xe=he.channel(`job-${se}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"vision_bpmn_jobs",filter:`id=eq.${se}`},ft=>{const nt=ft.new;if(console.log("Realtime job status update:",nt.status),nt.status==="completed"&&nt.bpmn_xml){const fe=h==="bpmn"?"BPMN":h==="pid"?"P&ID":"DMN";d(nt.bpmn_xml),M("idle"),l(!1),ve(null),E(!1),y(null),L.success(`${fe} diagram generated successfully!`),t&&(ne(nt.bpmn_xml),ze(!0)),setTimeout(()=>{var Ye;(Ye=document.getElementById("bpmn-viewer"))==null||Ye.scrollIntoView({behavior:"smooth",block:"start"})},500),te&&clearInterval(te)}else if(nt.status==="failed"){const fe=nt.error_message||"Processing failed. Please try again.";M("idle"),l(!1),ve(null),L.error("Upload failed",{description:fe,action:{label:"Retry",onClick:()=>{x&&Ht()}},duration:1e4}),te&&clearInterval(te)}}).subscribe();te=window.setInterval(Be,3e3),Be();const ct=window.setTimeout(()=>{te&&clearInterval(te);const ft="Processing timed out - Please try refreshing the page or contact support";M("idle"),l(!1),ve(null),L.error("Upload failed",{description:ft,action:{label:"Retry",onClick:()=>{x&&Ht()}},duration:1e4})},3e5);return()=>{clearTimeout(ct),he.removeChannel(xe),te&&clearInterval(te)}},[se,h,x]);const Te=async te=>{var xe,ct;if(a)return;if(!te.trim()){L.error("Please enter a process description");return}if(!t&&r){L.error("You've used all 5 free prompts. Please sign up to continue!"),e("/auth");return}if(!t&&!i()){L.error("You've used all 5 free prompts. Please sign up to continue!"),e("/auth");return}l(!0);const Be=h==="bpmn"?"BPMN":h==="pid"?"P&ID":"DMN";M("reading"),await new Promise(ft=>setTimeout(ft,500)),M("generating");try{const{invokeFunction:ft}=await pp(async()=>{const{invokeFunction:wr}=await Promise.resolve().then(()=>c2);return{invokeFunction:wr}},void 0),nt=h==="dmn"?"generate-dmn":"generate-bpmn",{data:fe,error:Ye}=await ft(nt,{prompt:te,diagramType:h==="dmn"?void 0:h},{deduplicate:!0});if(Ye){console.error("Function error:",Ye),M("idle"),(xe=Ye.message)!=null&&xe.includes("429")?L.error("Rate limit exceeded. Please try again in a moment."):(ct=Ye.message)!=null&&ct.includes("402")?L.error("AI credits depleted. Please add more credits to continue."):L.error(`Failed to generate ${Be} model`);return}M("drawing"),await new Promise(wr=>setTimeout(wr,500));const In=(fe==null?void 0:fe.bpmnXml)||(fe==null?void 0:fe.dmnXml);In?(d(In),M("idle"),L.success(`${Be} model generated successfully!`),t&&(ne(In),ze(!0))):(M("idle"),L.error("No diagram data received"))}catch(ft){console.error("Error generating BPMN:",ft),M("idle"),L.error("An error occurred while generating the model")}finally{l(!1)}},de=()=>{Te(s),o("")},Ie=te=>{o(te)},qe=async te=>{var Ye,In;const Be="dataTransfer"in te?(Ye=te.dataTransfer.files)==null?void 0:Ye[0]:(In=te.target.files)==null?void 0:In[0];if(!Be)return;const{data:{user:xe},error:ct}=await he.auth.getUser();if(ct||!xe){L.error("Please log in to upload and analyze documents"),e("/auth");return}if(!["image/png","image/jpeg","image/jpg","image/webp","application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword","text/plain"].includes(Be.type)){L.error("Please upload an image, PDF, Word document, or text file");return}l(!0);const nt=h==="bpmn"?"BPMN":"P&ID";L.info(`Analyzing document and generating ${nt}...`);const fe=new FileReader;fe.onloadend=async()=>{const wr=fe.result;y({name:Be.name,type:Be.type,base64:wr}),E(!0),l(!1),L.success(`File uploaded! Review the preview before generating ${nt}.`)},fe.readAsDataURL(Be)},_t=async()=>{if(m)Nt.current&&Nt.current.state==="recording"&&Nt.current.stop(),Ae.current&&(Ae.current.getTracks().forEach(te=>te.stop()),Ae.current=null),g(!1),Nt.current=null;else try{const te=await navigator.mediaDevices.getUserMedia({audio:!0});Ae.current=te;const Be=new MediaRecorder(te),xe=[];Be.ondataavailable=ct=>{xe.push(ct.data)},Be.onstop=async()=>{const ct=new Blob(xe,{type:"audio/webm"}),ft=new FileReader;ft.readAsDataURL(ct),ft.onloadend=async()=>{var fe;const nt=(fe=ft.result)==null?void 0:fe.toString().split(",")[1];try{const{data:Ye,error:In}=await he.functions.invoke("speech-to-text",{body:{audio:nt,language:v},headers:t?void 0:{Authorization:""}});if(In)throw In;Ye!=null&&Ye.text&&(o(Ye.text),L.success("Voice recorded successfully!"))}catch(Ye){console.error("Speech-to-text error:",Ye),L.error("Failed to convert speech to text.")}},Ae.current&&(Ae.current.getTracks().forEach(nt=>nt.stop()),Ae.current=null)},Be.start(),Nt.current=Be,g(!0),L.info("Recording... Click again to stop")}catch(te){console.error("Error accessing microphone:",te),L.error("Could not access microphone. Please check permissions.")}},Ht=async()=>{if(x){l(!0),E(!1),M("reading"),await new Promise(te=>setTimeout(te,500)),M("generating");try{const{data:{user:te}}=await he.auth.getUser();if(!te){M("idle"),L.error("Please log in to continue"),e("/auth");return}const Be=x.base64.length*.75,xe=200*1024*1024;if(Be>xe){M("idle"),l(!1),L.error("File too large",{description:"Maximum file size is 200 MB. Please select a smaller file."});return}const ct=L.loading("Processing your file...",{description:"This may take 30-60 seconds for complex diagrams"}),{data:ft,error:nt}=await he.functions.invoke("vision-to-bpmn",{body:{imageBase64:x.base64,diagramType:h},headers:t?void 0:{Authorization:""}});if(L.dismiss(ct),nt){console.error("Vision AI error:",nt),M("idle"),l(!1);const fe=nt.message||"Failed to start diagram generation";L.error("Upload failed",{description:fe,action:{label:"Retry",onClick:()=>{Ht()}},duration:1e4});return}if(!ft||!ft.jobId){M("idle"),l(!1),L.error("Upload failed",{description:"Failed to start processing",action:{label:"Retry",onClick:()=>{Ht()}},duration:1e4});return}ve(ft.jobId),M("generating"),L.info("Processing started",{description:"We'll notify you when your diagram is ready (this may take 1-2 minutes)"})}catch(te){console.error("Vision AI processing error:",te),M("idle"),l(!1);const Be=te instanceof Error?te.message:"Network error - Please check your connection and try again";L.error("Upload failed",{description:Be,action:{label:"Retry",onClick:()=>{Ht()}},duration:1e4})}}},on=async()=>{if(!c||!S.trim()){const xe=h==="bpmn"?"BPMN":"P&ID";L.error(`Please enter instructions to refine the ${xe}`);return}const{data:{user:te}}=await he.auth.getUser();if(!te){const xe=h==="bpmn"?"BPMN":"P&ID";L.error(`Please log in to refine ${xe}`),e("/auth");return}P(!0);const Be=h==="bpmn"?"BPMN":"P&ID";L.info(`Refining ${Be} based on your instructions...`),N("analyzing"),await new Promise(xe=>setTimeout(xe,500)),N("refining");try{const{data:xe,error:ct}=await he.functions.invoke("refine-bpmn",{body:{currentBpmnXml:c,instructions:S,userId:te.id,diagramType:h},headers:t?void 0:{Authorization:""}});if(ct){console.error("Refinement error:",ct),N("idle");const ft=ct.message||JSON.stringify(ct);ft.includes("429")?L.error("Rate limit exceeded. Please try again in a moment."):ft.includes("402")?L.error("AI credits depleted. Please add more credits to continue."):ft.includes("401")||ft.includes("Authentication")?(L.error("Authentication required. Please log in again."),e("/auth")):L.error(`Failed to refine ${Be}: ${ft}`);return}if(xe!=null&&xe.error){console.error("Refinement error in response:",xe.error),N("idle");const ft=typeof xe.error=="string"?xe.error:JSON.stringify(xe.error);ft.includes("402")?L.error("AI credits depleted. Please add more credits to continue."):ft.includes("401")||ft.includes("Authentication")?(L.error("Authentication required. Please log in again."),e("/auth")):L.error(`Failed to refine ${Be}: ${ft}`);return}if(xe!=null&&xe.bpmnXml){N("applying"),await new Promise(nt=>setTimeout(nt,300));const ft=xe.bpmnXml.includes("</bpmn:definitions>")||xe.bpmnXml.includes("</definitions>");xe.bpmnXml.includes("<?xml")&&ft?(d(xe.bpmnXml),N("idle"),L.success(`${Be} refined successfully!`),j("")):(console.error("Received invalid diagram XML:",xe.bpmnXml.substring(0,200)),N("idle"),L.error("Received invalid diagram structure. Please try again."))}else console.error("No refined diagram received. Response:",xe),N("idle"),L.error("No refined diagram received. The function may not be deployed or there was an error.")}catch(xe){console.error("BPMN refinement error:",xe),N("idle");const ct=xe instanceof Error?xe.message:String(xe);ct.includes("Failed to fetch")||ct.includes("load the resource")?L.error("Network error: Unable to reach refine-bpmn function. Please check if the function is deployed."):L.error(`Failed to refine ${h==="bpmn"?"BPMN":"P&ID"}: ${ct}`)}finally{P(!1)}};return u.jsx(Re.section,{className:`${f?"py-8":"py-24"} bg-muted/20 relative`,"data-section":"try-prossmind",initial:n?{opacity:1}:{opacity:0,y:50},whileInView:{opacity:1,y:0},viewport:{once:!0,amount:.2},transition:zt(n)||{duration:.7},children:u.jsxs("div",{className:"container mx-auto px-6",children:[!f&&u.jsxs(Re.div,{className:"text-center mb-12",initial:n?{opacity:1,y:0}:{opacity:0,y:30,scale:.95},whileInView:{opacity:1,y:0,scale:1},viewport:{once:!0,amount:.3},transition:zt(n)||{duration:.6,delay:.2},children:[u.jsxs("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:["Try ",u.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"ProssMind!"})]}),u.jsx("p",{className:"text-lg text-muted-foreground max-w-3xl mx-auto",children:"Describe your business process, upload an image, PDF, Word doc, or text file - AI will generate a BPMN or P&ID diagram for you"})]}),u.jsxs("div",{className:"max-w-5xl mx-auto mt-12 space-y-8",children:[u.jsxs(A3,{value:h,onValueChange:te=>p(te),className:"w-full",children:[u.jsxs(o2,{className:`grid w-full max-w-2xl mx-auto grid-cols-3 mb-8 ${h==="pid"?"bg-engineering-green/10":h==="dmn"?"bg-purple-500/10":""}`,children:[u.jsx(xd,{value:"bpmn",className:`${h==="bpmn"?"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground":""}`,children:"BPMN Diagram"}),u.jsxs(xd,{value:"pid",className:`${h==="pid"?"data-[state=active]:bg-engineering-green data-[state=active]:text-white":""}`,children:[u.jsx(Od,{className:"h-4 w-4 mr-2 flex-shrink-0"}),"P&ID Diagram"]}),u.jsx(xd,{value:"dmn",className:`${h==="dmn"?"data-[state=active]:bg-purple-500 data-[state=active]:text-white":""}`,children:"DMN Decision"})]}),u.jsxs(bd,{value:"bpmn",className:"space-y-8",children:[u.jsxs("div",{className:"bg-gradient-to-br from-muted/50 to-muted/30 rounded-2xl p-8 border border-border/50 slide-up stagger-1",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[u.jsx("div",{className:"rounded-full bg-primary/10 p-2",children:u.jsx(yd,{className:"h-5 w-5 text-primary"})}),u.jsx("h3",{className:"font-semibold text-lg",children:"Try these BPMN examples:"})]}),u.jsx("div",{className:"flex flex-wrap gap-3",children:LIe.map((te,Be)=>u.jsx(G,{variant:"outline",size:"sm",onClick:()=>Ie(te),className:"text-sm hover:bg-primary/10 hover:border-primary/50 transition-all whitespace-nowrap",disabled:a,style:{minWidth:"max-content",paddingLeft:"1.2em",paddingRight:"1.2em"},"aria-label":`Use suggestion: ${te}`,children:te},Be))})]}),u.jsx("div",{className:"bg-card border border-border rounded-2xl p-8 shadow-xl slide-up stagger-2",children:u.jsxs("div",{className:"space-y-6",children:[u.jsxs(CK,{defaultValue:"prompt",className:"w-full",children:[u.jsxs(JN,{className:"grid w-full grid-cols-3 bg-muted/50",children:[u.jsxs(jd,{value:"prompt",className:"gap-2 data-[state=active]:bg-background data-[state=active]:shadow-sm",children:[u.jsx(Gk,{className:"h-4 w-4"}),u.jsx("span",{className:"hidden sm:inline",children:"Prompt"})]}),u.jsxs(jd,{value:"voice",className:"gap-2 data-[state=active]:bg-background data-[state=active]:shadow-sm",children:[u.jsx(ig,{className:"h-4 w-4"}),u.jsx("span",{className:"hidden sm:inline",children:"Voice"})]}),u.jsxs(jd,{value:"attachment",className:"gap-2 data-[state=active]:bg-background data-[state=active]:shadow-sm",children:[u.jsx(sg,{className:"h-4 w-4"}),u.jsx("span",{className:"hidden sm:inline",children:"Attachment"})]})]}),u.jsx(kd,{value:"prompt",className:"mt-4",children:u.jsxs("div",{className:"relative",children:[u.jsx($i,{placeholder:"Describe your process step by step...",value:s,onChange:te=>o(te.target.value),className:"min-h-[120px] resize-none border-muted",style:{paddingLeft:"1.2em",paddingRight:"1.2em"},disabled:a}),a&&u.jsxs("div",{className:"absolute bottom-3 right-3 flex items-center gap-1",children:[u.jsx(Re.span,{className:"w-2 h-2 bg-primary rounded-full",animate:n?{}:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:zt(n)||{duration:1,repeat:1/0,delay:0}}),u.jsx(Re.span,{className:"w-2 h-2 bg-primary rounded-full",animate:n?{}:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:zt(n)||{duration:1,repeat:1/0,delay:.2}}),u.jsx(Re.span,{className:"w-2 h-2 bg-primary rounded-full",animate:n?{}:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:zt(n)||{duration:1,repeat:1/0,delay:.4}})]})]})}),u.jsx(kd,{value:"voice",className:"mt-4",children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(QS,{className:"h-4 w-4 text-muted-foreground"}),u.jsxs(_l,{value:v,onValueChange:b,children:[u.jsx(Oa,{className:"w-[200px] h-8",children:u.jsx(El,{placeholder:"Select language"})}),u.jsxs(Ra,{children:[u.jsx(tt,{value:"en-US",children:"English (US)"}),u.jsx(tt,{value:"en-GB",children:"English (UK)"}),u.jsx(tt,{value:"es-ES",children:"Spanish"}),u.jsx(tt,{value:"fr-FR",children:"French"}),u.jsx(tt,{value:"de-DE",children:"German"}),u.jsx(tt,{value:"it-IT",children:"Italian"}),u.jsx(tt,{value:"pt-BR",children:"Portuguese (Brazil)"}),u.jsx(tt,{value:"pt-PT",children:"Portuguese (Portugal)"}),u.jsx(tt,{value:"ru-RU",children:"Russian"}),u.jsx(tt,{value:"ja-JP",children:"Japanese"}),u.jsx(tt,{value:"ko-KR",children:"Korean"}),u.jsx(tt,{value:"zh-CN",children:"Chinese (Simplified)"}),u.jsx(tt,{value:"zh-TW",children:"Chinese (Traditional)"}),u.jsx(tt,{value:"ar-SA",children:"Arabic"}),u.jsx(tt,{value:"hi-IN",children:"Hindi"})]})]}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"Voice recognition language"})]}),u.jsx(G,{variant:"outline",onClick:_t,disabled:a,className:m?"text-red-500 border-red-500":"w-full",children:m?u.jsxs(u.Fragment,{children:[u.jsx(ZS,{className:"h-4 w-4 mr-2 animate-pulse"}),"Click to Stop Recording"]}):u.jsxs(u.Fragment,{children:[u.jsx(ig,{className:"h-4 w-4 mr-2"}),"Start Voice Recording"]})})]})}),u.jsx(kd,{value:"attachment",className:"mt-4",children:u.jsxs("div",{className:"space-y-4",children:[u.jsx("input",{ref:lt,type:"file",accept:"image/*,.pdf,.doc,.docx,.txt",onChange:qe,className:"hidden"}),u.jsxs("div",{onDragOver:te=>{te.preventDefault(),je(!0)},onDragLeave:()=>je(!1),onDrop:te=>{te.preventDefault(),je(!1),qe(te)},className:`border-2 border-dashed rounded-2xl p-8 text-center transition-all ${pt?"border-primary bg-primary/5 scale-[1.02]":"border-border hover:border-primary/50"}`,children:[u.jsxs("div",{className:"flex justify-center gap-4 mb-4",children:[u.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[u.jsx(ts,{className:"h-5 w-5","aria-hidden":"true"}),u.jsx("span",{className:"text-xs",children:"PNG/JPG"})]}),u.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[u.jsx(nr,{className:"h-5 w-5","aria-hidden":"true"}),u.jsx("span",{className:"text-xs",children:"PDF"})]}),u.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[u.jsx(XS,{className:"h-5 w-5","aria-hidden":"true"}),u.jsx("span",{className:"text-xs",children:"DOCX"})]})]}),u.jsxs(G,{variant:"outline",onClick:()=>{var te;return(te=lt.current)==null?void 0:te.click()},disabled:a,className:"w-full","aria-label":"Upload file",children:[u.jsx(sg,{className:"h-4 w-4 mr-2","aria-hidden":"true"}),"Upload File"]}),u.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"Drag and drop a file here or click to browse"})]})]})})]}),a&&I!=="idle"&&u.jsxs("div",{className:"space-y-3 p-4 bg-muted/50 rounded-lg border border-border",children:[u.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Processing your document..."}),u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsxs("span",{className:I==="reading"?"font-semibold":"text-muted-foreground",children:[I==="reading"&&u.jsx(Vr,{className:"h-4 w-4 inline mr-2 animate-spin","aria-hidden":"true"}),I!=="reading"&&" ","Step 1: Reading prompt..."]}),I==="reading"&&u.jsx(bs,{value:33,className:"w-24","aria-label":"Progress: 33%"})]}),u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsxs("span",{className:I==="generating"?"font-semibold":I==="drawing"?"text-muted-foreground":"",children:[I==="generating"&&u.jsx(Vr,{className:"h-4 w-4 inline mr-2 animate-spin","aria-hidden":"true"}),I!=="generating"&&I!=="reading"&&" ","Step 2: Generating..."]}),I==="generating"&&u.jsx(bs,{value:66,className:"w-24","aria-label":"Progress: 66%"})]}),u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsxs("span",{className:I==="drawing"?"font-semibold":"text-muted-foreground",children:[I==="drawing"&&u.jsx(Vr,{className:"h-4 w-4 inline mr-2 animate-spin","aria-hidden":"true"}),I!=="drawing"&&I!=="generating"&&I!=="reading"&&" ","Step 3: Drawing Diagram..."]}),I==="drawing"&&u.jsx(bs,{value:100,className:"w-24","aria-label":"Progress: 100%"})]})]}),u.jsxs(G,{onClick:de,className:"gap-2 shadow-lg hover:shadow-xl hover:scale-[1.03] transition-all w-full",size:"lg",disabled:a||!s.trim(),"aria-label":"Generate BPMN diagram",children:[a?"Generating...":"Generate BPMN",u.jsx(og,{className:"h-4 w-4","aria-hidden":"true"})]})]})})]}),u.jsxs(bd,{value:"pid",className:"space-y-8",children:[u.jsxs("div",{className:"bg-gradient-to-br from-muted/50 to-muted/30 rounded-2xl p-8 border border-border/50 slide-up stagger-1",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[u.jsx("div",{className:"rounded-full bg-primary/10 p-2",children:u.jsx(yd,{className:"h-5 w-5 text-primary"})}),u.jsx("h3",{className:"font-semibold text-lg",children:"Try these P&ID examples:"})]}),u.jsx("div",{className:"flex flex-wrap gap-3",children:["Create a chemical reactor cooling system","Design a water treatment process flow","Build a distillation column control loop","Generate a pump and valve configuration","Create a heat exchanger system"].map((te,Be)=>u.jsx(G,{variant:"outline",size:"sm",onClick:()=>Ie(te),className:"text-sm hover:bg-primary/10 hover:border-primary/50 transition-all",disabled:a,children:te},Be))})]}),u.jsx("div",{className:"bg-card border border-border rounded-2xl p-8 shadow-xl slide-up stagger-2",children:u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(QS,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true"}),u.jsxs(_l,{value:v,onValueChange:b,children:[u.jsx(Oa,{className:"w-[200px] h-8","aria-label":"Select voice recognition language",children:u.jsx(El,{placeholder:"Select language"})}),u.jsxs(Ra,{children:[u.jsx(tt,{value:"en-US",children:"English (US)"}),u.jsx(tt,{value:"en-GB",children:"English (UK)"}),u.jsx(tt,{value:"es-ES",children:"Spanish"}),u.jsx(tt,{value:"fr-FR",children:"French"}),u.jsx(tt,{value:"de-DE",children:"German"}),u.jsx(tt,{value:"it-IT",children:"Italian"}),u.jsx(tt,{value:"pt-BR",children:"Portuguese (Brazil)"}),u.jsx(tt,{value:"pt-PT",children:"Portuguese (Portugal)"}),u.jsx(tt,{value:"ru-RU",children:"Russian"}),u.jsx(tt,{value:"ja-JP",children:"Japanese"}),u.jsx(tt,{value:"ko-KR",children:"Korean"}),u.jsx(tt,{value:"zh-CN",children:"Chinese (Simplified)"}),u.jsx(tt,{value:"zh-TW",children:"Chinese (Traditional)"}),u.jsx(tt,{value:"ar-SA",children:"Arabic"}),u.jsx(tt,{value:"hi-IN",children:"Hindi"})]})]}),u.jsx("span",{className:"text-xs text-muted-foreground",children:"Voice recognition language"})]}),u.jsx($i,{placeholder:"Describe your P&ID process, or upload files (images, PDFs, Word docs, text files) - I'll extract content and generate a P&ID diagram. You can preview before generation and refine using natural language after creation...",value:s,onChange:te=>o(te.target.value),className:"min-h-[120px] resize-none border-muted",disabled:a,"aria-label":"P&ID process description input"}),u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex gap-2",children:[u.jsx("input",{ref:lt,type:"file",accept:"image/*,.pdf,.doc,.docx,.txt",onChange:qe,className:"hidden","aria-label":"Upload file input"}),u.jsx(G,{variant:"ghost",size:"icon",onClick:()=>{var te;return(te=lt.current)==null?void 0:te.click()},disabled:a,title:"Upload image, PDF, Word, or text file to generate P&ID","aria-label":"Upload file",children:u.jsx(sg,{className:"h-5 w-5","aria-hidden":"true"})}),u.jsx(G,{variant:"ghost",size:"icon",onClick:_t,disabled:a,className:m?"text-red-500":"",title:"Voice to text","aria-label":m?"Stop voice recording":"Start voice recording",children:m?u.jsx(ZS,{className:"h-5 w-5 animate-pulse","aria-hidden":"true"}):u.jsx(ig,{className:"h-5 w-5","aria-hidden":"true"})})]}),u.jsxs(G,{onClick:de,className:"gap-2 shadow-lg hover:shadow-xl hover:scale-[1.03] transition-all",size:"lg",disabled:a||!s.trim(),"aria-label":"Generate P&ID diagram",children:[a?"Generating...":"Generate P&ID",u.jsx(og,{className:"h-4 w-4","aria-hidden":"true"})]})]}),u.jsxs("div",{className:"border border-border rounded-lg p-4 bg-muted/30",children:[u.jsxs("div",{className:"flex justify-center gap-4 mb-2",children:[u.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[u.jsx(ts,{className:"h-4 w-4","aria-hidden":"true"}),u.jsx("span",{className:"text-xs",children:"PNG/JPG"})]}),u.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[u.jsx(nr,{className:"h-4 w-4","aria-hidden":"true"}),u.jsx("span",{className:"text-xs",children:"PDF"})]}),u.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[u.jsx(XS,{className:"h-4 w-4","aria-hidden":"true"}),u.jsx("span",{className:"text-xs",children:"DOCX"})]})]}),u.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Supported file types for upload"})]})]})})]}),u.jsxs(bd,{value:"dmn",className:"space-y-8",children:[u.jsxs("div",{className:"bg-gradient-to-br from-muted/50 to-muted/30 rounded-2xl p-8 border border-border/50 slide-up stagger-1",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[u.jsx("div",{className:"rounded-full bg-purple-500/10 p-2",children:u.jsx(yd,{className:"h-5 w-5 text-purple-500"})}),u.jsx("h3",{className:"font-semibold text-lg",children:"Try these DMN examples:"})]}),u.jsx("div",{className:"flex flex-wrap gap-3",children:["Create a loan approval decision table","Design a pricing decision based on customer tier","Build a risk assessment decision table","Generate a discount eligibility decision","Create a product recommendation decision"].map((te,Be)=>u.jsx(G,{variant:"outline",size:"sm",onClick:()=>Ie(te),className:"text-sm hover:bg-purple-500/10 hover:border-purple-500/50 transition-all whitespace-nowrap",disabled:a,style:{minWidth:"max-content",paddingLeft:"1.2em",paddingRight:"1.2em"},"aria-label":`Use suggestion: ${te}`,children:te},Be))})]}),u.jsx("div",{className:"bg-card border border-border rounded-2xl p-8 shadow-xl slide-up stagger-2",children:u.jsxs("div",{className:"space-y-6",children:[u.jsx($i,{placeholder:"Describe your decision logic, rules, and conditions...",value:s,onChange:te=>o(te.target.value),className:"min-h-[120px] resize-none border-muted",disabled:a,"aria-label":"DMN decision description input"}),u.jsx("div",{className:"flex items-center justify-end",children:u.jsxs(G,{onClick:de,className:"gap-2 shadow-lg hover:shadow-xl hover:scale-[1.03] transition-all",size:"lg",disabled:a||!s.trim(),"aria-label":"Generate DMN diagram",children:[a?"Generating...":"Generate DMN",u.jsx(og,{className:"h-4 w-4","aria-hidden":"true"})]})})]})})]})]}),w&&x&&u.jsxs("div",{className:"bg-card border border-border rounded-2xl p-6 shadow-lg",children:[u.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Preview Uploaded File"}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[u.jsxs("p",{className:"text-sm font-medium mb-2",children:["File: ",x.name]}),x.type.startsWith("image/")&&u.jsx("div",{className:"mt-4 max-h-96 overflow-auto",children:u.jsx("img",{src:x.base64,alt:"Preview",className:"max-w-full rounded border"})}),x.extractedText&&u.jsxs("div",{className:"mt-4",children:[u.jsx("p",{className:"text-sm font-medium mb-2",children:"Extracted Content Preview:"}),u.jsx("div",{className:"bg-background rounded p-3 max-h-48 overflow-auto text-xs",children:x.extractedText})]})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx(G,{onClick:Ht,className:"flex-1",disabled:a,children:a?"Generating...":`Generate ${h==="bpmn"?"BPMN":h==="pid"?"P&ID":"DMN"} from this file`}),u.jsx(G,{variant:"outline",onClick:()=>{E(!1),y(null)},children:"Cancel"})]})]})]}),c?u.jsxs("div",{id:"bpmn-viewer",className:"space-y-6 relative",children:[u.jsxs("div",{className:"bg-card border border-border rounded-2xl p-6 shadow-lg",children:[u.jsxs("h3",{className:"text-xl font-semibold mb-4",children:["Your ",h==="bpmn"?"BPMN":h==="pid"?"P&ID":"DMN"," Model"]}),h==="dmn"?u.jsx(QN,{xml:c,onSave:async te=>{if(d(te),Ot&&t){const{error:Be}=await K5(Ot,t.id,{bpmn_xml:te});Be?(L.error("Failed to update project"),console.error(Be)):L.success("Project updated successfully")}else t&&te?(ne(te),ze(!0)):L.success("Diagram saved to workspace")},onRefine:()=>ce(!0)}):u.jsx(GP,{xml:c,diagramType:h,onSave:async te=>{if(d(te),Ot&&t){const{error:Be}=await K5(Ot,t.id,{bpmn_xml:te});Be?(L.error("Failed to update project"),console.error(Be)):L.success("Project updated successfully")}else t&&te?(ne(te),ze(!0)):L.success("Diagram saved to workspace")},onRefine:()=>ce(!0)}),u.jsx("p",{className:"text-xs text-muted-foreground mt-4 text-right",children:"Generated via Gemini 2.5 Pro  v1"})]}),C&&R!=="idle"&&u.jsxs("div",{className:"space-y-3 p-4 bg-muted/50 rounded-lg border border-border",children:[u.jsxs("p",{className:"text-sm font-medium text-foreground mb-2",children:["Refining your ",h==="bpmn"?"BPMN":h==="pid"?"P&ID":"DMN"," diagram..."]}),u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsxs("span",{className:R==="analyzing"?"font-semibold":"text-muted-foreground",children:[R==="analyzing"&&u.jsx(Vr,{className:"h-4 w-4 inline mr-2 animate-spin","aria-hidden":"true"}),R!=="analyzing"&&" ","Step 1: Analyzing instructions..."]}),R==="analyzing"&&u.jsx(bs,{value:33,className:"w-24","aria-label":"Progress: 33%"})]}),u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsxs("span",{className:R==="refining"?"font-semibold":R==="applying"?"text-muted-foreground":"",children:[R==="refining"&&u.jsx(Vr,{className:"h-4 w-4 inline mr-2 animate-spin","aria-hidden":"true"}),R!=="refining"&&R!=="analyzing"&&" ","Step 2: Refining diagram..."]}),R==="refining"&&u.jsx(bs,{value:66,className:"w-24","aria-label":"Progress: 66%"})]}),u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsxs("span",{className:R==="applying"?"font-semibold":"text-muted-foreground",children:[R==="applying"&&u.jsx(Vr,{className:"h-4 w-4 inline mr-2 animate-spin","aria-hidden":"true"}),R!=="applying"&&R!=="refining"&&R!=="analyzing"&&" ","Step 3: Applying changes..."]}),R==="applying"&&u.jsx(bs,{value:100,className:"w-24","aria-label":"Progress: 100%"})]})]}),u.jsx(Ur,{open:W,onOpenChange:ce,children:u.jsxs(Ar,{children:[u.jsxs(Ir,{children:[u.jsxs(Dr,{children:["Refine Your ",h==="bpmn"?"BPMN":h==="pid"?"P&ID":"DMN"]}),u.jsx($r,{children:"Use natural language to modify the current diagram. The AI will update the latest version based on your instructions."})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsx($i,{placeholder:"E.g., 'add a review step after approval', 'replace manual task with automated service', 'add parallel gateway for concurrent processing'...",value:S,onChange:te=>j(te.target.value),className:"min-h-[100px] resize-none",disabled:C}),u.jsx(G,{onClick:()=>{on(),ce(!1)},disabled:C||!S.trim(),className:"w-full",children:C?"Refining...":`Apply Changes to Current ${h==="bpmn"?"BPMN":h==="pid"?"P&ID":"DMN"}`})]})]})}),t&&u.jsx(MIe,{open:Qe,onOpenChange:ze,onSave:async(te,Be)=>{if(!pe||!t)return;oe(!0);const{data:xe,error:ct}=await wIe({user_id:t.id,name:te,description:Be||null,diagram_type:h,bpmn_xml:pe});ct?(L.error("Failed to save project"),console.error(ct)):xe&&(Zt(xe.id),ne(null),L.success("Project saved successfully!")),oe(!1),ze(!1)},diagramType:h,isLoading:me})]}):a&&I==="drawing"?u.jsxs(Re.div,{className:"bg-card border border-border rounded-2xl p-6 shadow-lg",initial:n?{opacity:1}:{opacity:0},animate:{opacity:1},transition:zt(n)||{duration:.3},children:[u.jsxs("h3",{className:"text-xl font-semibold mb-4",children:["Generating ",h==="bpmn"?"BPMN":h==="pid"?"P&ID":"DMN"," Model"]}),u.jsx("div",{className:"space-y-4",children:u.jsx("div",{className:"w-full h-[400px] bg-muted/50 rounded-lg animate-pulse border border-border/50 flex items-center justify-center",children:u.jsxs("div",{className:"text-center space-y-3",children:[u.jsx(Vr,{className:"h-8 w-8 animate-spin mx-auto text-primary"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Rendering diagram..."})]})})})]}):null]})]})})},BIe=()=>{const t=Ns(),e=dv(),[n,r]=_.useState(null),[i,s]=_.useState(!0);if(_.useEffect(()=>{const{data:{subscription:c}}=he.auth.onAuthStateChange((d,h)=>{r((h==null?void 0:h.user)??null),s(!1),!(h!=null&&h.user)&&!e.pathname.includes("/auth")&&sr(t,"/auth")});return he.auth.getSession().then(({data:{session:d}})=>{r((d==null?void 0:d.user)??null),s(!1),!(d!=null&&d.user)&&!e.pathname.includes("/auth")&&sr(t,"/auth")}),()=>c.unsubscribe()},[t,e.pathname]),i)return u.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),u.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading..."})]})});const o=ko(),a=`/auth${o}`,l=`/dashboard${o}`;return u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(Os,{user:n}),u.jsxs(gf,{children:[u.jsx(Ct,{path:"/auth",element:u.jsx(aF,{})}),u.jsx(Ct,{path:"/",element:n?u.jsx(Y5,{user:n}):u.jsx(gs,{to:a,replace:!0})}),u.jsx(Ct,{path:"/dashboard",element:n?u.jsx(Y5,{user:n}):u.jsx(gs,{to:a,replace:!0})}),u.jsx(Ct,{path:"/projects",element:n?u.jsx(CIe,{user:n}):u.jsx(gs,{to:a,replace:!0})}),u.jsx(Ct,{path:"/bpmn-generator",element:n?u.jsx(OS,{user:n}):u.jsx(gs,{to:a,replace:!0})}),u.jsx(Ct,{path:"/pid-generator",element:n?u.jsx(OS,{user:n}):u.jsx(gs,{to:a,replace:!0})}),u.jsx(Ct,{path:"/dmn-generator",element:n?u.jsx(OS,{user:n}):u.jsx(gs,{to:a,replace:!0})}),u.jsx(Ct,{path:"/vision-ai",element:n?u.jsx(V3,{}):u.jsx(gs,{to:a,replace:!0})}),u.jsx(Ct,{path:"/templates",element:n?u.jsx(IIe,{user:n}):u.jsx(gs,{to:a,replace:!0})}),u.jsx(Ct,{path:"/account",element:n?u.jsx(DIe,{user:n}):u.jsx(gs,{to:a,replace:!0})}),u.jsx(Ct,{path:"/settings",element:n?u.jsx($Ie,{user:n}):u.jsx(gs,{to:a,replace:!0})}),u.jsx(Ct,{path:"*",element:u.jsx(gs,{to:l,replace:!0})})]})]})},X5=[{name:"Getting Started",path:"/getting-started",icon:V4},{name:"Guides",path:"/guides",icon:VJ},{name:"Tutorials",path:"/tutorials",icon:H4},{name:"API Reference",path:"/api-reference",icon:Jb},{name:"FAQ",path:"/faq",icon:YJ},{name:"Changelog",path:"/changelog",icon:nr}],FIe=()=>{const t=dv(),[e,n]=_.useState(!1);return u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"lg:hidden fixed top-16 left-0 right-0 z-40 border-b bg-background px-6 py-3",children:u.jsxs(G4,{open:e,onOpenChange:n,children:[u.jsx(K4,{asChild:!0,children:u.jsxs(G,{variant:"outline",size:"sm",children:[u.jsx(U4,{className:"h-4 w-4 mr-2"}),"Documentation Menu"]})}),u.jsxs(Yk,{side:"left",className:"w-[300px] sm:w-[400px]",children:[u.jsx(Xk,{children:u.jsx(Qk,{children:"Documentation"})}),u.jsx("nav",{className:"mt-6 space-y-2",children:X5.map(r=>{const i=r.icon,s=t.pathname===r.path||r.path==="/getting-started"&&t.pathname==="/";return u.jsxs(Mr,{to:r.path,onClick:()=>n(!1),className:Se("flex items-center gap-3 px-4 py-2 rounded-lg text-sm font-medium transition-colors",s?"bg-primary text-primary-foreground":"text-foreground/70 hover:text-foreground hover:bg-muted"),children:[u.jsx(i,{className:"h-4 w-4"}),r.name]},r.path)})})]})]})}),u.jsx("aside",{className:"hidden lg:block w-64 border-r bg-muted/30 pt-16 fixed left-0 top-0 h-full overflow-y-auto",children:u.jsx("nav",{className:"p-6 space-y-2",children:X5.map(r=>{const i=r.icon,s=t.pathname===r.path||r.path==="/getting-started"&&t.pathname==="/";return u.jsxs(Mr,{to:r.path,className:Se("flex items-center gap-3 px-4 py-2 rounded-lg text-sm font-medium transition-colors",s?"bg-primary text-primary-foreground":"text-foreground/70 hover:text-foreground hover:bg-muted"),children:[u.jsx(i,{className:"h-4 w-4"}),r.name]},r.path)})})})]})},zIe=({children:t})=>u.jsxs("div",{className:"flex min-h-screen pt-16",children:[u.jsx(FIe,{}),u.jsx("main",{className:"flex-1 overflow-auto",children:u.jsx("div",{className:"max-w-4xl mx-auto px-6 py-12",children:t})})]}),RS=()=>u.jsxs("div",{className:"space-y-8",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Getting Started"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Welcome to ProssMind! Learn how to create your first BPMN or P&ID diagram."})]}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(V4,{className:"h-5 w-5 text-primary"}),"Quick Start"]}),u.jsx(Je,{children:"Get up and running in minutes"})]}),u.jsxs(Ue,{className:"space-y-4",children:[u.jsxs("ol",{className:"space-y-3 list-decimal list-inside",children:[u.jsx("li",{children:"Sign up for a free account"}),u.jsx("li",{children:"Choose your diagram type (BPMN or P&ID)"}),u.jsx("li",{children:"Describe your process or upload an image"}),u.jsx("li",{children:"Download your generated diagram"})]}),u.jsxs(G,{onClick:()=>Ao("/auth"),className:"w-full",children:["Get Started",u.jsx(Xh,{className:"h-4 w-4 ml-2"})]})]})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsx(We,{children:"What You Get"}),u.jsx(Je,{children:"Features included in your free account"})]}),u.jsx(Ue,{children:u.jsxs("ul",{className:"space-y-2",children:[u.jsxs("li",{className:"flex items-center gap-2",children:[u.jsx(Vm,{className:"h-4 w-4 text-primary"}),u.jsx("span",{children:"5 free diagram generations"})]}),u.jsxs("li",{className:"flex items-center gap-2",children:[u.jsx(Vm,{className:"h-4 w-4 text-primary"}),u.jsx("span",{children:"BPMN and P&ID diagram support"})]}),u.jsxs("li",{className:"flex items-center gap-2",children:[u.jsx(Vm,{className:"h-4 w-4 text-primary"}),u.jsx("span",{children:"Vision AI image conversion"})]}),u.jsxs("li",{className:"flex items-center gap-2",children:[u.jsx(Vm,{className:"h-4 w-4 text-primary"}),u.jsx("span",{children:"Export to standard formats"})]})]})})]})]}),u.jsxs(De,{children:[u.jsx(He,{children:u.jsx(We,{children:"Next Steps"})}),u.jsxs(Ue,{className:"space-y-4",children:[u.jsx("p",{className:"text-muted-foreground",children:"Ready to create your first diagram? Check out our guides and tutorials to learn more about creating professional process diagrams with ProssMind."}),u.jsxs("div",{className:"flex gap-4",children:[u.jsx(G,{variant:"outline",onClick:()=>Ao("/dashboard"),children:"Go to Dashboard"}),u.jsx(G,{variant:"outline",onClick:()=>window.location.href="/guides",children:"View Guides"})]})]})]})]}),HIe=()=>{const t=[{title:"BPMN Diagram Guide",description:"Learn how to create effective business process models",icon:js,topics:["Elements and symbols","Swimlanes and pools","Gateways and events","Best practices"]},{title:"P&ID Diagram Guide",description:"Master piping and instrumentation diagrams",icon:Od,topics:["Equipment symbols","Instrumentation tags","Piping connections","ISA standards"]},{title:"Vision AI Guide",description:"Convert images and documents to diagrams",icon:Ia,topics:["Supported formats","Image requirements","Processing tips","Troubleshooting"]},{title:"Export and Integration",description:"Export diagrams and integrate with other tools",icon:nr,topics:["Export formats","SAP Signavio","Camunda","Flowable"]}];return u.jsxs("div",{className:"space-y-8",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-4xl font-bold mb-4",children:"User Guides"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Comprehensive guides to help you get the most out of ProssMind."})]}),u.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:t.map(e=>{const n=e.icon;return u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(n,{className:"h-5 w-5 text-primary"}),e.title]}),u.jsx(Je,{children:e.description})]}),u.jsx(Ue,{children:u.jsx("ul",{className:"space-y-2",children:e.topics.map((r,i)=>u.jsxs("li",{className:"text-sm text-muted-foreground",children:[" ",r]},i))})})]},e.title)})})]})},UIe=()=>{const t=[{title:"Creating Your First BPMN Diagram",description:"Step-by-step tutorial for creating a simple business process diagram",duration:"5 min",level:"Beginner"},{title:"Advanced P&ID Design",description:"Learn advanced techniques for complex piping and instrumentation diagrams",duration:"15 min",level:"Advanced"},{title:"Using Vision AI",description:"Convert handwritten notes and sketches into professional diagrams",duration:"10 min",level:"Intermediate"},{title:"Integrating with SAP Signavio",description:"Export and import diagrams to SAP Signavio for process management",duration:"12 min",level:"Intermediate"}];return u.jsxs("div",{className:"space-y-8",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Tutorials"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Step-by-step tutorials to help you master ProssMind features."})]}),u.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:t.map(e=>u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs("div",{className:"flex items-start justify-between",children:[u.jsx(We,{children:e.title}),u.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-primary/10 text-primary",children:e.level})]}),u.jsx(Je,{children:e.description})]}),u.jsx(Ue,{children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[u.jsx(Vk,{className:"h-4 w-4"}),e.duration]}),u.jsxs(G,{variant:"outline",size:"sm",children:[u.jsx(XJ,{className:"h-4 w-4 mr-2"}),"Watch Tutorial"]})]})})]},e.title))})]})},VIe=()=>u.jsxs("div",{className:"space-y-8",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-4xl font-bold mb-4",children:"API Reference"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Integrate ProssMind into your applications using our REST API."})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(bv,{className:"h-5 w-5 text-primary"}),"Authentication"]}),u.jsx(Je,{children:"API authentication and authorization"})]}),u.jsxs(Ue,{children:[u.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"All API requests require authentication using an API key. You can generate API keys in your account settings."}),u.jsx("div",{className:"bg-muted p-4 rounded-lg font-mono text-sm",children:u.jsx("code",{children:"Authorization: Bearer YOUR_API_KEY"})})]})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(Jb,{className:"h-5 w-5 text-primary"}),"Endpoints"]}),u.jsx(Je,{children:"Available API endpoints"})]}),u.jsxs(Ue,{children:[u.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"API documentation is coming soon. For now, please use the web interface or contact support for API access."}),u.jsxs("div",{className:"space-y-2 text-sm",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-xs",children:"POST"}),u.jsx("code",{children:"/api/v1/diagrams/generate"})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-xs",children:"GET"}),u.jsxs("code",{children:["/api/v1/diagrams/","{id}"]})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-xs",children:"GET"}),u.jsx("code",{children:"/api/v1/diagrams"})]})]})]})]})]}),qIe=()=>{const t=[{question:"How many free diagrams can I create?",answer:"Free accounts include 5 diagram generations. After that, you can upgrade to a paid plan for unlimited diagrams."},{question:"What file formats can I export?",answer:"You can export diagrams in BPMN 2.0 XML, PNG, SVG, and PDF formats."},{question:"Can I use Vision AI with handwritten notes?",answer:"Yes! Vision AI can convert handwritten notes, whiteboard sketches, and printed documents into professional diagrams."},{question:"Is my data secure?",answer:"Yes, ProssMind is GDPR compliant and all data is encrypted. We never share your data with third parties."},{question:"Can I integrate with SAP Signavio?",answer:"Yes, you can export BPMN diagrams in a format compatible with SAP Signavio, Camunda, and Flowable."},{question:"What's the difference between BPMN and P&ID?",answer:"BPMN (Business Process Model and Notation) is for business processes, while P&ID (Piping and Instrumentation Diagram) is for engineering and manufacturing processes."}];return u.jsxs("div",{className:"space-y-8",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Frequently Asked Questions"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Find answers to common questions about ProssMind."})]}),u.jsxs(De,{children:[u.jsx(He,{children:u.jsx(We,{children:"Common Questions"})}),u.jsx(Ue,{children:u.jsx(IC,{type:"single",collapsible:!0,className:"w-full",children:t.map((e,n)=>u.jsxs(Zh,{value:`item-${n}`,children:[u.jsx(Jh,{children:e.question}),u.jsx(ep,{children:e.answer})]},n))})})]})]})},WIe=()=>{const t=[{version:"1.0.0",date:"2024-01-15",type:"major",changes:["Initial release of ProssMind","BPMN diagram generation","P&ID diagram generation","Vision AI image conversion","Free tier with 5 diagram generations"]}];return u.jsxs("div",{className:"space-y-8",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Changelog"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Track updates and new features in ProssMind."})]}),u.jsx("div",{className:"space-y-6",children:t.map(e=>u.jsxs(De,{children:[u.jsx(He,{children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs(We,{className:"flex items-center gap-3",children:["Version ",e.version,u.jsx(Bn,{variant:e.type==="major"?"default":"secondary",children:e.type})]}),u.jsx(Je,{children:e.date})]})}),u.jsx(Ue,{children:u.jsx("ul",{className:"space-y-2",children:e.changes.map((n,r)=>u.jsxs("li",{className:"text-sm flex items-start gap-2",children:[u.jsx("span",{className:"text-primary mt-1",children:""}),u.jsx("span",{children:n})]},r))})})]},e.version))})]})},GIe=()=>u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(Os,{}),u.jsx(zIe,{children:u.jsxs(gf,{children:[u.jsx(Ct,{path:"/",element:u.jsx(RS,{})}),u.jsx(Ct,{path:"/getting-started",element:u.jsx(RS,{})}),u.jsx(Ct,{path:"/guides",element:u.jsx(HIe,{})}),u.jsx(Ct,{path:"/tutorials",element:u.jsx(UIe,{})}),u.jsx(Ct,{path:"/api-reference",element:u.jsx(VIe,{})}),u.jsx(Ct,{path:"/faq",element:u.jsx(qIe,{})}),u.jsx(Ct,{path:"/changelog",element:u.jsx(WIe,{})}),u.jsx(Ct,{path:"*",element:u.jsx(RS,{})})]})})]}),KIe=()=>{const t="operational",n={operational:{label:"All Systems Operational",color:"bg-green-500",icon:F4,variant:"default"},degraded:{label:"Degraded Performance",color:"bg-yellow-500",icon:KJ,variant:"secondary"},down:{label:"Service Disruption",color:"bg-red-500",icon:QJ,variant:"destructive"}}[t],r=n.icon;return u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsx("div",{className:`w-3 h-3 rounded-full ${n.color} animate-pulse`}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(r,{className:"h-5 w-5"}),u.jsx("span",{className:"font-semibold",children:n.label})]}),u.jsx(Bn,{variant:n.variant,children:t})]})},YIe=()=>{const t=[{id:1,date:"2024-01-10",title:"Scheduled Maintenance",status:"resolved",description:"Database optimization and performance improvements"},{id:2,date:"2024-01-05",title:"API Rate Limiting Issue",status:"resolved",description:"Temporary rate limiting issue affecting some API requests"}];return u.jsx("div",{className:"space-y-4",children:t.length>0?u.jsxs(Ud,{children:[u.jsx(Vd,{children:u.jsxs(os,{children:[u.jsx(kn,{children:"Date"}),u.jsx(kn,{children:"Title"}),u.jsx(kn,{children:"Status"}),u.jsx(kn,{children:"Description"})]})}),u.jsx(qd,{children:t.map(e=>u.jsxs(os,{children:[u.jsx(_n,{children:new Date(e.date).toLocaleDateString()}),u.jsx(_n,{className:"font-medium",children:e.title}),u.jsx(_n,{children:u.jsx(Bn,{variant:e.status==="resolved"?"default":"secondary",children:e.status})}),u.jsx(_n,{className:"text-muted-foreground",children:e.description})]},e.id))})]}):u.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No incidents reported. All systems operational."})})},XIe=()=>{const{toast:t}=_v(),[e,n]=_.useState(""),r=i=>{i.preventDefault(),t({title:"Subscribed!",description:"You'll receive email updates about service status."}),n("")};return u.jsxs("form",{onSubmit:r,className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx(Vt,{htmlFor:"email",children:"Email Address"}),u.jsxs("div",{className:"flex gap-2 mt-2",children:[u.jsxs("div",{className:"relative flex-1",children:[u.jsx(Wk,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),u.jsx(zn,{id:"email",type:"email",placeholder:"your@email.com",value:e,onChange:i=>n(i.target.value),className:"pl-10",required:!0})]}),u.jsx(G,{type:"submit",children:"Subscribe"})]})]}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"You'll receive email notifications about service incidents and maintenance."})]})},QIe=()=>u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(Os,{}),u.jsx("div",{className:"pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Service Status"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Real-time status of ProssMind services"})]}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsx(We,{children:"System Status"}),u.jsx(Je,{children:"Current operational status"})]}),u.jsx(Ue,{children:u.jsx(KIe,{})})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsx(We,{children:"Subscribe to Updates"}),u.jsx(Je,{children:"Get notified about service incidents"})]}),u.jsx(Ue,{children:u.jsx(XIe,{})})]})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsx(We,{children:"Incident History"}),u.jsx(Je,{children:"Past incidents and maintenance windows"})]}),u.jsx(Ue,{children:u.jsx(YIe,{})})]})]})})]}),ZIe=({user:t})=>{const e={totalUsers:1250,organizations:45,revenue:125e3,activeUsers:890};return u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Admin Dashboard"}),u.jsx("p",{className:"text-muted-foreground",children:"Manage your organization and users"})]}),u.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[u.jsxs(De,{children:[u.jsxs(He,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(We,{className:"text-sm font-medium",children:"Total Users"}),u.jsx(n0,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs(Ue,{children:[u.jsx("div",{className:"text-2xl font-bold",children:e.totalUsers}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"+12% from last month"})]})]}),u.jsxs(De,{children:[u.jsxs(He,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(We,{className:"text-sm font-medium",children:"Organizations"}),u.jsx(Uk,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs(Ue,{children:[u.jsx("div",{className:"text-2xl font-bold",children:e.organizations}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"+3 new this month"})]})]}),u.jsxs(De,{children:[u.jsxs(He,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(We,{className:"text-sm font-medium",children:"Revenue"}),u.jsx(z4,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs(Ue,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:["$",e.revenue.toLocaleString()]}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"+8% from last month"})]})]}),u.jsxs(De,{children:[u.jsxs(He,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(We,{className:"text-sm font-medium",children:"Active Users"}),u.jsx(YS,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs(Ue,{children:[u.jsx("div",{className:"text-2xl font-bold",children:e.activeUsers}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 30 days"})]})]})]}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsx(We,{children:"Quick Actions"}),u.jsx(Je,{children:"Common administrative tasks"})]}),u.jsxs(Ue,{className:"space-y-2",children:[u.jsx("a",{href:"/organization",className:"block p-3 rounded-lg border hover:bg-muted transition-colors",children:"Manage Organization Settings"}),u.jsx("a",{href:"/users",className:"block p-3 rounded-lg border hover:bg-muted transition-colors",children:"View All Users"}),u.jsx("a",{href:"/billing",className:"block p-3 rounded-lg border hover:bg-muted transition-colors",children:"Billing & Invoices"}),u.jsx("a",{href:"/security",className:"block p-3 rounded-lg border hover:bg-muted transition-colors",children:"Security Settings"})]})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(Sl,{className:"h-5 w-5"}),"Security Overview"]}),u.jsx(Je,{children:"Recent security events"})]}),u.jsx(Ue,{children:u.jsx("p",{className:"text-sm text-muted-foreground",children:"No security events in the last 24 hours. All systems secure."})})]})]})]})})},JIe=({user:t})=>u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Organization Settings"}),u.jsx("p",{className:"text-muted-foreground",children:"Manage your organization configuration"})]}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(Uk,{className:"h-5 w-5"}),"Organization Details"]}),u.jsx(Je,{children:"Basic organization information"})]}),u.jsxs(Ue,{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx(Vt,{htmlFor:"orgName",children:"Organization Name"}),u.jsx(zn,{id:"orgName",defaultValue:"Your Organization",className:"mt-1"})]}),u.jsxs("div",{children:[u.jsx(Vt,{htmlFor:"orgEmail",children:"Contact Email"}),u.jsx(zn,{id:"orgEmail",type:"email",defaultValue:t.email,className:"mt-1"})]}),u.jsx(G,{children:"Save Changes"})]})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(bv,{className:"h-5 w-5"}),"Single Sign-On (SSO)"]}),u.jsx(Je,{children:"Configure SSO for your organization"})]}),u.jsxs(Ue,{children:[u.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"SSO configuration allows your organization to use your identity provider for authentication."}),u.jsx(G,{variant:"outline",children:"Configure SSO"})]})]})]})]})}),eDe=({user:t})=>{const e=[{id:"1",email:"user1@example.com",role:"admin",createdAt:"2024-01-01"},{id:"2",email:"user2@example.com",role:"user",createdAt:"2024-01-05"},{id:"3",email:"user3@example.com",role:"user",createdAt:"2024-01-10"}];return u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-4xl font-bold mb-2",children:"User Management"}),u.jsx("p",{className:"text-muted-foreground",children:"Manage users in your organization"})]}),u.jsxs(De,{children:[u.jsx(He,{children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx(We,{children:"Users"}),u.jsx(Je,{children:"All users in your organization"})]}),u.jsxs("div",{className:"relative",children:[u.jsx(Ig,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),u.jsx(zn,{placeholder:"Search users...",className:"pl-10 w-64"})]})]})}),u.jsx(Ue,{children:u.jsxs(Ud,{children:[u.jsx(Vd,{children:u.jsxs(os,{children:[u.jsx(kn,{children:"Email"}),u.jsx(kn,{children:"Role"}),u.jsx(kn,{children:"Created"}),u.jsx(kn,{children:"Actions"})]})}),u.jsx(qd,{children:e.map(n=>u.jsxs(os,{children:[u.jsx(_n,{className:"font-medium",children:n.email}),u.jsx(_n,{children:u.jsx(Bn,{variant:n.role==="admin"?"default":"secondary",children:n.role})}),u.jsx(_n,{children:new Date(n.createdAt).toLocaleDateString()}),u.jsx(_n,{children:u.jsxs("div",{className:"flex gap-2",children:[u.jsx(G,{variant:"ghost",size:"sm",children:u.jsx(Kk,{className:"h-4 w-4"})}),u.jsx(G,{variant:"ghost",size:"sm",children:u.jsx(wv,{className:"h-4 w-4"})})]})})]},n.id))})]})})]})]})})},tDe=({user:t})=>{const e=[{id:"INV-001",date:"2024-01-15",amount:999,status:"paid"},{id:"INV-002",date:"2024-02-15",amount:999,status:"paid"},{id:"INV-003",date:"2024-03-15",amount:999,status:"pending"}];return u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Billing & Invoices"}),u.jsx("p",{className:"text-muted-foreground",children:"Manage billing and view invoices"})]}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(z4,{className:"h-5 w-5"}),"Current Plan"]}),u.jsx(Je,{children:"Your subscription details"})]}),u.jsxs(Ue,{children:[u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-muted-foreground",children:"Plan"}),u.jsx("span",{className:"font-semibold",children:"Enterprise"})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-muted-foreground",children:"Billing Cycle"}),u.jsx("span",{children:"Monthly"})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-muted-foreground",children:"Next Billing Date"}),u.jsx("span",{children:"April 15, 2024"})]})]}),u.jsx(G,{className:"w-full mt-4",children:"Change Plan"})]})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsx(We,{children:"Payment Method"}),u.jsx(Je,{children:"Manage your payment methods"})]}),u.jsxs(Ue,{children:[u.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"   4242"}),u.jsx(G,{variant:"outline",children:"Update Payment Method"})]})]})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsx(We,{children:"Invoice History"}),u.jsx(Je,{children:"View and download past invoices"})]}),u.jsx(Ue,{children:u.jsxs(Ud,{children:[u.jsx(Vd,{children:u.jsxs(os,{children:[u.jsx(kn,{children:"Invoice ID"}),u.jsx(kn,{children:"Date"}),u.jsx(kn,{children:"Amount"}),u.jsx(kn,{children:"Status"}),u.jsx(kn,{children:"Actions"})]})}),u.jsx(qd,{children:e.map(n=>u.jsxs(os,{children:[u.jsx(_n,{className:"font-medium",children:n.id}),u.jsx(_n,{children:new Date(n.date).toLocaleDateString()}),u.jsxs(_n,{children:["$",n.amount]}),u.jsx(_n,{children:u.jsx(Bn,{variant:n.status==="paid"?"default":"secondary",children:n.status})}),u.jsx(_n,{children:u.jsxs(G,{variant:"ghost",size:"sm",children:[u.jsx(Ip,{className:"h-4 w-4 mr-2"}),"Download"]})})]},n.id))})]})})]})]})})},nDe=({user:t})=>u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Security Settings"}),u.jsx("p",{className:"text-muted-foreground",children:"Manage security and access controls"})]}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(Sl,{className:"h-5 w-5"}),"Two-Factor Authentication"]}),u.jsx(Je,{children:"Require 2FA for all users"})]}),u.jsx(Ue,{className:"space-y-4",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx(Vt,{children:"Enable 2FA"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Require two-factor authentication"})]}),u.jsx(vl,{})]})})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(bv,{className:"h-5 w-5"}),"API Keys"]}),u.jsx(Je,{children:"Manage API access keys"})]}),u.jsxs(Ue,{children:[u.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"API keys allow programmatic access to ProssMind services."}),u.jsx(G,{variant:"outline",children:"Manage API Keys"})]})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(aee,{className:"h-5 w-5"}),"Access Controls"]}),u.jsx(Je,{children:"Configure access permissions"})]}),u.jsxs(Ue,{className:"space-y-4",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx(Vt,{children:"IP Whitelist"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Restrict access by IP address"})]}),u.jsx(vl,{})]}),u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx(Vt,{children:"Session Timeout"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Auto-logout after inactivity"})]}),u.jsx(vl,{defaultChecked:!0})]})]})]})]})]})}),rDe=({user:t})=>{const e=[{id:"1",user:"admin@example.com",action:"User created",timestamp:"2024-01-15T10:30:00Z",ip:"192.168.1.1"},{id:"2",user:"admin@example.com",action:"Settings updated",timestamp:"2024-01-15T09:15:00Z",ip:"192.168.1.1"},{id:"3",user:"user@example.com",action:"Login",timestamp:"2024-01-15T08:00:00Z",ip:"192.168.1.2"}];return u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Audit Logs"}),u.jsx("p",{className:"text-muted-foreground",children:"View activity and security logs"})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(nr,{className:"h-5 w-5"}),"Activity Log"]}),u.jsx(Je,{children:"Recent administrative actions and events"})]}),u.jsx(Ue,{children:u.jsxs(Ud,{children:[u.jsx(Vd,{children:u.jsxs(os,{children:[u.jsx(kn,{children:"Timestamp"}),u.jsx(kn,{children:"User"}),u.jsx(kn,{children:"Action"}),u.jsx(kn,{children:"IP Address"})]})}),u.jsx(qd,{children:e.map(n=>u.jsxs(os,{children:[u.jsx(_n,{children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Vk,{className:"h-4 w-4 text-muted-foreground"}),new Date(n.timestamp).toLocaleString()]})}),u.jsx(_n,{className:"font-medium",children:n.user}),u.jsx(_n,{children:u.jsx(Bn,{variant:"outline",children:n.action})}),u.jsx(_n,{className:"text-muted-foreground",children:n.ip})]},n.id))})]})})]})]})})},iDe=["Business","E-Commerce","Finance","IT","Manufacturing","Utilities"],sDe=["bpmn","pid","dmn"],oDe=["Users","ShoppingCart","Building2","Cog","Factory","Workflow"],aDe=({user:t})=>{const[e,n]=_.useState([]),[r,i]=_.useState(!0),[s,o]=_.useState(""),[a,l]=_.useState(!1),[c,d]=_.useState(!1),[h,p]=_.useState(null),[f,m]=_.useState(!1),[g,v]=_.useState(""),[b,x]=_.useState({name:"",description:"",category:"Business",diagram_type:"bpmn",bpmn_xml:"",icon_name:"Workflow",is_active:!0});_.useEffect(()=>{y()},[]);const y=async()=>{i(!0);const{data:N,error:I}=await OIe();I?L.error("Failed to load templates"):N&&n(N),i(!1)},w=()=>{p(null),x({name:"",description:"",category:"Business",diagram_type:"bpmn",bpmn_xml:"",icon_name:"Workflow",is_active:!0}),l(!0)},E=N=>{p(N),x({name:N.name,description:N.description||"",category:N.category,diagram_type:N.diagram_type,bpmn_xml:N.bpmn_xml,icon_name:N.icon_name||"Workflow",is_active:N.is_active}),l(!0)},S=N=>{p(N),d(!0)},j=async()=>{if(!h)return;const{error:N}=await NIe(h.id);N?L.error("Failed to delete template"):(L.success("Template deleted successfully"),y()),d(!1),p(null)},C=N=>{v(N.bpmn_xml),m(!0)},P=async()=>{if(!b.name||!b.bpmn_xml){L.error("Name and XML are required");return}const N={name:b.name,description:b.description||null,category:b.category,diagram_type:b.diagram_type,bpmn_xml:b.bpmn_xml,icon_name:b.icon_name||null,is_active:b.is_active??!0,created_by:t.id};if(h){const{error:I}=await TIe(h.id,N);I?L.error("Failed to update template"):(L.success("Template updated successfully"),l(!1),y())}else{const{error:I}=await PIe(N);I?L.error("Failed to create template"):(L.success("Template created successfully"),l(!1),y())}},R=e.filter(N=>{var I;return N.name.toLowerCase().includes(s.toLowerCase())||((I=N.description)==null?void 0:I.toLowerCase().includes(s.toLowerCase()))});return r?u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsx(mn,{children:u.jsx("div",{className:"flex items-center justify-center py-16",children:u.jsx(Vr,{className:"h-8 w-8 animate-spin text-primary"})})})}):u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Template Management"}),u.jsx("p",{className:"text-muted-foreground",children:"Manage BPMN and P&ID diagram templates"})]}),u.jsxs(De,{children:[u.jsx(He,{children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx(We,{children:"Templates"}),u.jsx(Je,{children:"Create and manage diagram templates"})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs("div",{className:"relative",children:[u.jsx(Ig,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),u.jsx(zn,{placeholder:"Search templates...",className:"pl-10 w-64",value:s,onChange:N=>o(N.target.value)})]}),u.jsxs(G,{onClick:w,children:[u.jsx(Qh,{className:"h-4 w-4 mr-2"}),"New Template"]})]})]})}),u.jsx(Ue,{children:u.jsxs(Ud,{children:[u.jsx(Vd,{children:u.jsxs(os,{children:[u.jsx(kn,{children:"Name"}),u.jsx(kn,{children:"Category"}),u.jsx(kn,{children:"Type"}),u.jsx(kn,{children:"Status"}),u.jsx(kn,{children:"Usage"}),u.jsx(kn,{children:"Created"}),u.jsx(kn,{children:"Actions"})]})}),u.jsx(qd,{children:R.length===0?u.jsx(os,{children:u.jsx(_n,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No templates found"})}):R.map(N=>u.jsxs(os,{children:[u.jsx(_n,{className:"font-medium",children:N.name}),u.jsx(_n,{children:u.jsx(Bn,{variant:"outline",children:N.category})}),u.jsx(_n,{children:u.jsx(Bn,{variant:N.diagram_type==="bpmn"?"default":"secondary",children:N.diagram_type.toUpperCase()})}),u.jsx(_n,{children:u.jsx(Bn,{variant:N.is_active?"default":"secondary",children:N.is_active?"Active":"Inactive"})}),u.jsx(_n,{children:N.usage_count}),u.jsx(_n,{children:new Date(N.created_at).toLocaleDateString()}),u.jsx(_n,{children:u.jsxs("div",{className:"flex gap-2",children:[u.jsx(G,{variant:"ghost",size:"sm",onClick:()=>C(N),children:u.jsx(Ia,{className:"h-4 w-4"})}),u.jsx(G,{variant:"ghost",size:"sm",onClick:()=>E(N),children:u.jsx(Kk,{className:"h-4 w-4"})}),u.jsx(G,{variant:"ghost",size:"sm",onClick:()=>S(N),children:u.jsx(wv,{className:"h-4 w-4"})})]})})]},N.id))})]})})]}),u.jsx(Ur,{open:a,onOpenChange:l,children:u.jsxs(Ar,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[u.jsxs(Ir,{children:[u.jsx(Dr,{children:h?"Edit Template":"Create New Template"}),u.jsx($r,{children:h?"Update template details and XML content":"Create a new diagram template"})]}),u.jsxs("div",{className:"grid gap-4 py-4",children:[u.jsxs("div",{className:"grid gap-2",children:[u.jsx(Vt,{htmlFor:"name",children:"Name *"}),u.jsx(zn,{id:"name",value:b.name,onChange:N=>x({...b,name:N.target.value}),placeholder:"Template name"})]}),u.jsxs("div",{className:"grid gap-2",children:[u.jsx(Vt,{htmlFor:"description",children:"Description"}),u.jsx($i,{id:"description",value:b.description,onChange:N=>x({...b,description:N.target.value}),placeholder:"Template description",rows:2})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"grid gap-2",children:[u.jsx(Vt,{htmlFor:"category",children:"Category *"}),u.jsxs(_l,{value:b.category,onValueChange:N=>x({...b,category:N}),children:[u.jsx(Oa,{id:"category",children:u.jsx(El,{})}),u.jsx(Ra,{children:iDe.map(N=>u.jsx(tt,{value:N,children:N},N))})]})]}),u.jsxs("div",{className:"grid gap-2",children:[u.jsx(Vt,{htmlFor:"diagram_type",children:"Diagram Type *"}),u.jsxs(_l,{value:b.diagram_type,onValueChange:N=>x({...b,diagram_type:N}),children:[u.jsx(Oa,{id:"diagram_type",children:u.jsx(El,{})}),u.jsx(Ra,{children:sDe.map(N=>u.jsx(tt,{value:N,children:N.toUpperCase()},N))})]})]})]}),u.jsxs("div",{className:"grid gap-2",children:[u.jsx(Vt,{htmlFor:"icon_name",children:"Icon"}),u.jsxs(_l,{value:b.icon_name||"Workflow",onValueChange:N=>x({...b,icon_name:N}),children:[u.jsx(Oa,{id:"icon_name",children:u.jsx(El,{})}),u.jsx(Ra,{children:oDe.map(N=>u.jsx(tt,{value:N,children:N},N))})]})]}),u.jsxs("div",{className:"grid gap-2",children:[u.jsx(Vt,{htmlFor:"bpmn_xml",children:"BPMN/PID XML *"}),u.jsx($i,{id:"bpmn_xml",value:b.bpmn_xml,onChange:N=>x({...b,bpmn_xml:N.target.value}),placeholder:"Paste BPMN or PID XML here",rows:12,className:"font-mono text-sm"})]})]}),u.jsxs(s0,{children:[u.jsx(G,{variant:"outline",onClick:()=>l(!1),children:"Cancel"}),u.jsx(G,{onClick:P,children:h?"Update":"Create"})]})]})}),u.jsx(Ur,{open:f,onOpenChange:m,children:u.jsxs(Ar,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[u.jsxs(Ir,{children:[u.jsx(Dr,{children:"Template XML Preview"}),u.jsx($r,{children:"View the template XML content"})]}),u.jsx("div",{className:"mt-4",children:u.jsx("pre",{className:"bg-muted p-4 rounded-md overflow-x-auto text-sm",children:u.jsx("code",{children:g})})}),u.jsx(s0,{children:u.jsx(G,{variant:"outline",onClick:()=>m(!1),children:"Close"})})]})}),u.jsx(WP,{open:c,onOpenChange:d,children:u.jsxs(g_,{children:[u.jsxs(v_,{children:[u.jsx(x_,{children:"Are you sure?"}),u.jsxs(b_,{children:['This will deactivate the template "',h==null?void 0:h.name,'". This action cannot be undone, but you can reactivate it later.']})]}),u.jsxs(y_,{children:[u.jsx(__,{children:"Cancel"}),u.jsx(w_,{onClick:j,children:"Delete"})]})]})})]})})},lDe=()=>{Ns();const[t,e]=_.useState(null),[n,r]=_.useState(!0),{isAdmin:i}=W4(t);return _.useEffect(()=>{const{data:{subscription:s}}=he.auth.onAuthStateChange((o,a)=>{e((a==null?void 0:a.user)??null),r(!1)});return he.auth.getSession().then(({data:{session:o}})=>{e((o==null?void 0:o.user)??null),r(!1)}),()=>s.unsubscribe()},[]),n?u.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),u.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading..."})]})}):!t||!i?u.jsx(gs,{to:"/",replace:!0}):u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(Os,{user:t}),u.jsxs(gf,{children:[u.jsx(Ct,{path:"/",element:u.jsx(ZIe,{user:t})}),u.jsx(Ct,{path:"/organization",element:u.jsx(JIe,{user:t})}),u.jsx(Ct,{path:"/users",element:u.jsx(eDe,{user:t})}),u.jsx(Ct,{path:"/billing",element:u.jsx(tDe,{user:t})}),u.jsx(Ct,{path:"/security",element:u.jsx(nDe,{user:t})}),u.jsx(Ct,{path:"/audit-logs",element:u.jsx(rDe,{user:t})}),u.jsx(Ct,{path:"/templates",element:u.jsx(aDe,{user:t})}),u.jsx(Ct,{path:"*",element:u.jsx(gs,{to:"/",replace:!0})})]})]})},Q5=()=>u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold mb-4",children:"API Overview"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Integrate ProssMind into your applications with our REST API"})]}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(bv,{className:"h-5 w-5 text-primary"}),"Authentication"]}),u.jsx(Je,{children:"Get started with API keys"})]}),u.jsxs(Ue,{children:[u.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"All API requests require authentication using an API key. Generate your API key in your account settings."}),u.jsx(G,{onClick:()=>Ao("/settings"),children:"Generate API Key"})]})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs(We,{className:"flex items-center gap-2",children:[u.jsx(Jb,{className:"h-5 w-5 text-primary"}),"Base URL"]}),u.jsx(Je,{children:"API endpoint"})]}),u.jsx(Ue,{children:u.jsx("div",{className:"bg-muted p-4 rounded-lg font-mono text-sm",children:u.jsx("code",{children:"https://api.prossmind.com/v1"})})})]})]}),u.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[u.jsx(De,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>window.location.href="/reference",children:u.jsxs(He,{children:[u.jsx(qJ,{className:"h-8 w-8 text-primary mb-2"}),u.jsx(We,{children:"API Reference"}),u.jsx(Je,{children:"Complete API documentation"})]})}),u.jsx(De,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>window.location.href="/sdks",children:u.jsxs(He,{children:[u.jsx(Jb,{className:"h-8 w-8 text-primary mb-2"}),u.jsx(We,{children:"SDKs"}),u.jsx(Je,{children:"Client libraries and tools"})]})}),u.jsx(De,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>window.location.href="/playground",children:u.jsxs(He,{children:[u.jsx(vee,{className:"h-8 w-8 text-primary mb-2"}),u.jsx(We,{children:"API Playground"}),u.jsx(Je,{children:"Test API endpoints"})]})})]})]})}),cDe=()=>{const t=[{method:"POST",path:"/diagrams/generate",description:"Generate a BPMN or P&ID diagram from a text description"},{method:"GET",path:"/diagrams/{id}",description:"Retrieve a diagram by ID"},{method:"GET",path:"/diagrams",description:"List all diagrams for the authenticated user"}];return u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold mb-4",children:"API Reference"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Complete reference for all API endpoints"})]}),u.jsx("div",{className:"space-y-6",children:t.map((e,n)=>u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(Bn,{variant:e.method==="POST"?"default":"secondary",children:e.method}),u.jsx("code",{className:"text-lg",children:e.path})]}),u.jsx(Je,{children:e.description})]}),u.jsx(Ue,{children:u.jsx("p",{className:"text-sm text-muted-foreground",children:"Full API documentation coming soon. For now, please use the web interface or contact support for API access."})})]},n))})]})})},uDe=()=>{const t=[{name:"JavaScript/TypeScript",version:"1.0.0",language:"npm"},{name:"Python",version:"1.0.0",language:"pip"},{name:"Go",version:"1.0.0",language:"go get"}];return u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold mb-4",children:"SDKs & Libraries"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Client libraries for popular programming languages"})]}),u.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(e=>u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsx(We,{children:e.name}),u.jsxs(Je,{children:["Version ",e.version]})]}),u.jsxs(Ue,{children:[u.jsx("div",{className:"bg-muted p-3 rounded-lg font-mono text-sm mb-4",children:u.jsxs("code",{children:[e.language," install prossmind-sdk"]})}),u.jsxs(G,{variant:"outline",className:"w-full",children:[u.jsx(Ip,{className:"h-4 w-4 mr-2"}),"Download"]})]})]},e.name))})]})})},dDe=()=>u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Code Examples"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Example code snippets for common use cases"})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsx(We,{children:"Examples"}),u.jsx(Je,{children:"Code examples coming soon"})]}),u.jsx(Ue,{children:u.jsx("p",{className:"text-muted-foreground",children:"Code examples and tutorials will be available here. Check back soon!"})})]})]})}),hDe=()=>u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold mb-4",children:"API Playground"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Test API endpoints interactively"})]}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsx(We,{children:"Interactive Playground"}),u.jsx(Je,{children:"API playground coming soon"})]}),u.jsx(Ue,{children:u.jsx("p",{className:"text-muted-foreground",children:"An interactive API playground will be available here. Check back soon!"})})]})]})}),pDe=()=>u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(Os,{}),u.jsxs(gf,{children:[u.jsx(Ct,{path:"/",element:u.jsx(Q5,{})}),u.jsx(Ct,{path:"/reference",element:u.jsx(cDe,{})}),u.jsx(Ct,{path:"/sdks",element:u.jsx(uDe,{})}),u.jsx(Ct,{path:"/examples",element:u.jsx(dDe,{})}),u.jsx(Ct,{path:"/playground",element:u.jsx(hDe,{})}),u.jsx(Ct,{path:"*",element:u.jsx(Q5,{})})]})]}),Z5=()=>u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Partner Program"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Join our partner ecosystem and grow your business"})]}),u.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6",children:[u.jsx(De,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>window.location.href="/marketplace",children:u.jsxs(He,{children:[u.jsx(See,{className:"h-8 w-8 text-primary mb-2"}),u.jsx(We,{children:"Marketplace"}),u.jsx(Je,{children:"Integration marketplace"})]})}),u.jsx(De,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>window.location.href="/resources",children:u.jsxs(He,{children:[u.jsx(nr,{className:"h-8 w-8 text-primary mb-2"}),u.jsx(We,{children:"Resources"}),u.jsx(Je,{children:"Partner resources"})]})}),u.jsx(De,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>window.location.href="/training",children:u.jsxs(He,{children:[u.jsx(H4,{className:"h-8 w-8 text-primary mb-2"}),u.jsx(We,{children:"Training"}),u.jsx(Je,{children:"Partner training"})]})}),u.jsxs(De,{children:[u.jsxs(He,{children:[u.jsx(iee,{className:"h-8 w-8 text-primary mb-2"}),u.jsx(We,{children:"Become a Partner"}),u.jsx(Je,{children:"Join our partner program"})]}),u.jsx(Ue,{children:u.jsx(G,{className:"w-full",children:"Apply Now"})})]})]})]})}),fDe=()=>u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Integration Marketplace"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Browse available integrations and extensions"})]}),u.jsx(De,{children:u.jsx(Ue,{className:"pt-6",children:u.jsx("p",{className:"text-center text-muted-foreground py-12",children:"Integration marketplace coming soon. Check back later for partner integrations."})})})]})}),mDe=()=>u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Partner Resources"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Download resources and materials for partners"})]}),u.jsx(De,{children:u.jsx(Ue,{className:"pt-6",children:u.jsx("p",{className:"text-center text-muted-foreground py-12",children:"Partner resources coming soon. Check back later for downloadable materials."})})})]})}),gDe=()=>u.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Partner Training"}),u.jsx("p",{className:"text-xl text-muted-foreground",children:"Training materials and certification programs"})]}),u.jsx(De,{children:u.jsx(Ue,{className:"pt-6",children:u.jsx("p",{className:"text-center text-muted-foreground py-12",children:"Partner training materials coming soon. Check back later for training programs."})})})]})}),vDe=()=>u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(Os,{}),u.jsxs(gf,{children:[u.jsx(Ct,{path:"/",element:u.jsx(Z5,{})}),u.jsx(Ct,{path:"/marketplace",element:u.jsx(fDe,{})}),u.jsx(Ct,{path:"/resources",element:u.jsx(mDe,{})}),u.jsx(Ct,{path:"/training",element:u.jsx(gDe,{})}),u.jsx(Ct,{path:"*",element:u.jsx(Z5,{})})]})]}),yDe=({language:t})=>{Ns();const[e,n]=_.useState(null),[r,i]=_.useState(!0);if(_.useEffect(()=>{const{data:{subscription:a}}=he.auth.onAuthStateChange((l,c)=>{n((c==null?void 0:c.user)??null),i(!1)});return he.auth.getSession().then(({data:{session:l}})=>{n((l==null?void 0:l.user)??null),i(!1)}),()=>a.unsubscribe()},[]),r)return u.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),u.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading..."})]})});const s={de:{title:"Bereit loszulegen?",description:"Erstellen Sie professionelle BPMN- und P&ID-Diagramme mit KI-gesttzter Automatisierung",tryFree:"Kostenlos testen"},fr:{title:"Prt  commencer?",description:"Crez des diagrammes BPMN et P&ID professionnels avec l'automatisation alimente par l'IA",tryFree:"Essayer gratuitement"}},o=s[t]||s.de;return u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(Os,{user:e}),u.jsx(b3,{}),u.jsx(e3,{}),u.jsx(t3,{}),u.jsx("section",{className:"py-20 bg-muted/30",children:u.jsxs(mn,{children:[u.jsxs("div",{className:"text-center mb-12",children:[u.jsx("h2",{className:"text-4xl font-bold mb-4",children:o.title}),u.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:o.description})]}),u.jsxs("div",{className:"grid md:grid-cols-3 gap-6 max-w-4xl mx-auto mb-8",children:[u.jsxs(De,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>Ao("/bpmn-generator"),children:[u.jsxs(He,{children:[u.jsx(js,{className:"h-10 w-10 text-primary mb-4"}),u.jsx(We,{children:"BPMN Diagramme"}),u.jsx(Je,{children:"Erstellen Sie Geschftsprozessmodelle"})]}),u.jsx(Ue,{children:u.jsxs(G,{className:"w-full",onClick:a=>{a.stopPropagation(),Ao("/bpmn-generator")},children:["BPMN-Generator testen",u.jsx(Xh,{className:"h-4 w-4 ml-2"})]})})]}),u.jsxs(De,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>Ao("/pid-generator"),children:[u.jsxs(He,{children:[u.jsx(Od,{className:"h-10 w-10 text-primary mb-4"}),u.jsx(We,{children:"P&ID Diagramme"}),u.jsx(Je,{children:"Entwerfen Sie Rohrleitungs- und Instrumentierungsdiagramme"})]}),u.jsx(Ue,{children:u.jsxs(G,{className:"w-full",onClick:a=>{a.stopPropagation(),Ao("/pid-generator")},children:["P&ID-Generator testen",u.jsx(Xh,{className:"h-4 w-4 ml-2"})]})})]}),u.jsxs(De,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>Ao("/vision-ai"),children:[u.jsxs(He,{children:[u.jsx(Ia,{className:"h-10 w-10 text-primary mb-4"}),u.jsx(We,{children:"Vision AI"}),u.jsx(Je,{children:"Konvertieren Sie Bilder in Diagramme"})]}),u.jsx(Ue,{children:u.jsxs(G,{className:"w-full",onClick:a=>{a.stopPropagation(),Ao("/vision-ai")},children:["Vision AI testen",u.jsx(Xh,{className:"h-4 w-4 ml-2"})]})})]})]}),u.jsxs("div",{className:"text-center",children:[u.jsxs(G,{size:"lg",className:"text-lg px-8",onClick:()=>Ao(e?"/dashboard":"/auth"),children:[e?"Zum Dashboard":o.tryFree,u.jsx(Xh,{className:"h-5 w-5 ml-2"})]}),u.jsx("p",{className:"text-sm text-muted-foreground mt-4",children:"Keine Kreditkarte erforderlich  5 kostenlose Prompts enthalten"})]})]})}),u.jsx(n3,{}),u.jsx(e2,{}),u.jsx(v3,{}),u.jsx(y3,{})]})},xDe=()=>{const t=Ev();return t==="app"?u.jsx(BIe,{}):t==="docs"?u.jsx(GIe,{}):t==="status"?u.jsx(QIe,{}):t==="admin"?u.jsx(lDe,{}):t==="api"?u.jsx(pDe,{}):t==="partners"?u.jsx(vDe,{}):t==="de"||t==="fr"?u.jsx(yDe,{language:t}):t==="bpmn"?u.jsx(dre,{}):t==="pid"?u.jsx(xIe,{}):t==="dmn"?u.jsx(bIe,{}):u.jsx(lF,{})};var _1=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},bDe={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},Cc,gk,uB,wDe=(uB=class{constructor(){nn(this,Cc,bDe);nn(this,gk,!1)}setTimeoutProvider(t){At(this,Cc,t)}setTimeout(t,e){return J(this,Cc).setTimeout(t,e)}clearTimeout(t){J(this,Cc).clearTimeout(t)}setInterval(t,e){return J(this,Cc).setInterval(t,e)}clearInterval(t){J(this,Cc).clearInterval(t)}},Cc=new WeakMap,gk=new WeakMap,uB),lk=new wDe;function _De(t){setTimeout(t,0)}var E1=typeof window>"u"||"Deno"in globalThis;function No(){}function EDe(t,e){return typeof t=="function"?t(e):t}function SDe(t){return typeof t=="number"&&t>=0&&t!==1/0}function CDe(t,e){return Math.max(t+(e||0)-Date.now(),0)}function ck(t,e){return typeof t=="function"?t(e):t}function jDe(t,e){return typeof t=="function"?t(e):t}function J5(t,e){const{type:n="all",exact:r,fetchStatus:i,predicate:s,queryKey:o,stale:a}=t;if(o){if(r){if(e.queryHash!==eO(o,e.options))return!1}else if(!av(e.queryKey,o))return!1}if(n!=="all"){const l=e.isActive();if(n==="active"&&!l||n==="inactive"&&l)return!1}return!(typeof a=="boolean"&&e.isStale()!==a||i&&i!==e.state.fetchStatus||s&&!s(e))}function eB(t,e){const{exact:n,status:r,predicate:i,mutationKey:s}=t;if(s){if(!e.options.mutationKey)return!1;if(n){if(ov(e.options.mutationKey)!==ov(s))return!1}else if(!av(e.options.mutationKey,s))return!1}return!(r&&e.state.status!==r||i&&!i(e))}function eO(t,e){return((e==null?void 0:e.queryKeyHashFn)||ov)(t)}function ov(t){return JSON.stringify(t,(e,n)=>uk(n)?Object.keys(n).sort().reduce((r,i)=>(r[i]=n[i],r),{}):n)}function av(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>av(t[n],e[n])):!1}var kDe=Object.prototype.hasOwnProperty;function TK(t,e){if(t===e)return t;const n=tB(t)&&tB(e);if(!n&&!(uk(t)&&uk(e)))return e;const i=(n?t:Object.keys(t)).length,s=n?e:Object.keys(e),o=s.length,a=n?new Array(o):{};let l=0;for(let c=0;c<o;c++){const d=n?c:s[c],h=t[d],p=e[d];if(h===p){a[d]=h,(n?c<i:kDe.call(t,d))&&l++;continue}if(h===null||p===null||typeof h!="object"||typeof p!="object"){a[d]=p;continue}const f=TK(h,p);a[d]=f,f===h&&l++}return i===o&&l===i?t:a}function tB(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function uk(t){if(!nB(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!nB(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function nB(t){return Object.prototype.toString.call(t)==="[object Object]"}function PDe(t){return new Promise(e=>{lk.setTimeout(e,t)})}function TDe(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?TK(t,e):e}function NDe(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function ODe(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var tO=Symbol();function NK(t,e){return!t.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!t.queryFn||t.queryFn===tO?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}var hd,jc,Cp,dB,RDe=(dB=class extends _1{constructor(){super();nn(this,hd);nn(this,jc);nn(this,Cp);At(this,Cp,e=>{if(!E1&&window.addEventListener){const n=()=>e();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){J(this,jc)||this.setEventListener(J(this,Cp))}onUnsubscribe(){var e;this.hasListeners()||((e=J(this,jc))==null||e.call(this),At(this,jc,void 0))}setEventListener(e){var n;At(this,Cp,e),(n=J(this,jc))==null||n.call(this),At(this,jc,e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(e){J(this,hd)!==e&&(At(this,hd,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(n=>{n(e)})}isFocused(){var e;return typeof J(this,hd)=="boolean"?J(this,hd):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},hd=new WeakMap,jc=new WeakMap,Cp=new WeakMap,dB),OK=new RDe;function ADe(){let t,e;const n=new Promise((i,s)=>{t=i,e=s});n.status="pending",n.catch(()=>{});function r(i){Object.assign(n,i),delete n.resolve,delete n.reject}return n.resolve=i=>{r({status:"fulfilled",value:i}),t(i)},n.reject=i=>{r({status:"rejected",reason:i}),e(i)},n}var IDe=_De;function DDe(){let t=[],e=0,n=a=>{a()},r=a=>{a()},i=IDe;const s=a=>{e?t.push(a):i(()=>{n(a)})},o=()=>{const a=t;t=[],a.length&&i(()=>{r(()=>{a.forEach(l=>{n(l)})})})};return{batch:a=>{let l;e++;try{l=a()}finally{e--,e||o()}return l},batchCalls:a=>(...l)=>{s(()=>{a(...l)})},schedule:s,setNotifyFunction:a=>{n=a},setBatchNotifyFunction:a=>{r=a},setScheduler:a=>{i=a}}}var Ii=DDe(),jp,kc,kp,hB,$De=(hB=class extends _1{constructor(){super();nn(this,jp,!0);nn(this,kc);nn(this,kp);At(this,kp,e=>{if(!E1&&window.addEventListener){const n=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r)}}})}onSubscribe(){J(this,kc)||this.setEventListener(J(this,kp))}onUnsubscribe(){var e;this.hasListeners()||((e=J(this,kc))==null||e.call(this),At(this,kc,void 0))}setEventListener(e){var n;At(this,kp,e),(n=J(this,kc))==null||n.call(this),At(this,kc,e(this.setOnline.bind(this)))}setOnline(e){J(this,jp)!==e&&(At(this,jp,e),this.listeners.forEach(r=>{r(e)}))}isOnline(){return J(this,jp)}},jp=new WeakMap,kc=new WeakMap,kp=new WeakMap,hB),sw=new $De;function MDe(t){return Math.min(1e3*2**t,3e4)}function RK(t){return(t??"online")==="online"?sw.isOnline():!0}var dk=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function AK(t){let e=!1,n=0,r;const i=ADe(),s=()=>i.status!=="pending",o=g=>{var v;if(!s()){const b=new dk(g);p(b),(v=t.onCancel)==null||v.call(t,b)}},a=()=>{e=!0},l=()=>{e=!1},c=()=>OK.isFocused()&&(t.networkMode==="always"||sw.isOnline())&&t.canRun(),d=()=>RK(t.networkMode)&&t.canRun(),h=g=>{s()||(r==null||r(),i.resolve(g))},p=g=>{s()||(r==null||r(),i.reject(g))},f=()=>new Promise(g=>{var v;r=b=>{(s()||c())&&g(b)},(v=t.onPause)==null||v.call(t)}).then(()=>{var g;r=void 0,s()||(g=t.onContinue)==null||g.call(t)}),m=()=>{if(s())return;let g;const v=n===0?t.initialPromise:void 0;try{g=v??t.fn()}catch(b){g=Promise.reject(b)}Promise.resolve(g).then(h).catch(b=>{var S;if(s())return;const x=t.retry??(E1?0:3),y=t.retryDelay??MDe,w=typeof y=="function"?y(n,b):y,E=x===!0||typeof x=="number"&&n<x||typeof x=="function"&&x(n,b);if(e||!E){p(b);return}n++,(S=t.onFail)==null||S.call(t,n,b),PDe(w).then(()=>c()?void 0:f()).then(()=>{e?p(b):m()})})};return{promise:i,status:()=>i.status,cancel:o,continue:()=>(r==null||r(),i),cancelRetry:a,continueRetry:l,canStart:d,start:()=>(d()?m():f().then(m),i)}}var pd,pB,IK=(pB=class{constructor(){nn(this,pd)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),SDe(this.gcTime)&&At(this,pd,lk.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(E1?1/0:5*60*1e3))}clearGcTimeout(){J(this,pd)&&(lk.clearTimeout(J(this,pd)),At(this,pd,void 0))}},pd=new WeakMap,pB),fd,Pp,Us,md,Hr,lv,gd,Oo,sl,fB,LDe=(fB=class extends IK{constructor(e){super();nn(this,Oo);nn(this,fd);nn(this,Pp);nn(this,Us);nn(this,md);nn(this,Hr);nn(this,lv);nn(this,gd);At(this,gd,!1),At(this,lv,e.defaultOptions),this.setOptions(e.options),this.observers=[],At(this,md,e.client),At(this,Us,J(this,md).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,At(this,fd,iB(this.options)),this.state=e.state??J(this,fd),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=J(this,Hr))==null?void 0:e.promise}setOptions(e){if(this.options={...J(this,lv),...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=iB(this.options);n.data!==void 0&&(this.setState(rB(n.data,n.dataUpdatedAt)),At(this,fd,n))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&J(this,Us).remove(this)}setData(e,n){const r=TDe(this.state.data,e,this.options);return vi(this,Oo,sl).call(this,{data:r,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),r}setState(e,n){vi(this,Oo,sl).call(this,{type:"setState",state:e,setStateOptions:n})}cancel(e){var r,i;const n=(r=J(this,Hr))==null?void 0:r.promise;return(i=J(this,Hr))==null||i.cancel(e),n?n.then(No).catch(No):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(J(this,fd))}isActive(){return this.observers.some(e=>jDe(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===tO||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>ck(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!CDe(this.state.dataUpdatedAt,e)}onFocus(){var n;const e=this.observers.find(r=>r.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(n=J(this,Hr))==null||n.continue()}onOnline(){var n;const e=this.observers.find(r=>r.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(n=J(this,Hr))==null||n.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),J(this,Us).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(J(this,Hr)&&(J(this,gd)?J(this,Hr).cancel({revert:!0}):J(this,Hr).cancelRetry()),this.scheduleGc()),J(this,Us).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||vi(this,Oo,sl).call(this,{type:"invalidate"})}async fetch(e,n){var l,c,d,h,p,f,m,g,v,b,x,y;if(this.state.fetchStatus!=="idle"&&((l=J(this,Hr))==null?void 0:l.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(J(this,Hr))return J(this,Hr).continueRetry(),J(this,Hr).promise}if(e&&this.setOptions(e),!this.options.queryFn){const w=this.observers.find(E=>E.options.queryFn);w&&this.setOptions(w.options)}const r=new AbortController,i=w=>{Object.defineProperty(w,"signal",{enumerable:!0,get:()=>(At(this,gd,!0),r.signal)})},s=()=>{const w=NK(this.options,n),S=(()=>{const j={client:J(this,md),queryKey:this.queryKey,meta:this.meta};return i(j),j})();return At(this,gd,!1),this.options.persister?this.options.persister(w,S,this):w(S)},a=(()=>{const w={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:J(this,md),state:this.state,fetchFn:s};return i(w),w})();(c=this.options.behavior)==null||c.onFetch(a,this),At(this,Pp,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((d=a.fetchOptions)==null?void 0:d.meta))&&vi(this,Oo,sl).call(this,{type:"fetch",meta:(h=a.fetchOptions)==null?void 0:h.meta}),At(this,Hr,AK({initialPromise:n==null?void 0:n.initialPromise,fn:a.fetchFn,onCancel:w=>{w instanceof dk&&w.revert&&this.setState({...J(this,Pp),fetchStatus:"idle"}),r.abort()},onFail:(w,E)=>{vi(this,Oo,sl).call(this,{type:"failed",failureCount:w,error:E})},onPause:()=>{vi(this,Oo,sl).call(this,{type:"pause"})},onContinue:()=>{vi(this,Oo,sl).call(this,{type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0}));try{const w=await J(this,Hr).start();if(w===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(w),(f=(p=J(this,Us).config).onSuccess)==null||f.call(p,w,this),(g=(m=J(this,Us).config).onSettled)==null||g.call(m,w,this.state.error,this),w}catch(w){if(w instanceof dk){if(w.silent)return J(this,Hr).promise;if(w.revert){if(this.state.data===void 0)throw w;return this.state.data}}throw vi(this,Oo,sl).call(this,{type:"error",error:w}),(b=(v=J(this,Us).config).onError)==null||b.call(v,w,this),(y=(x=J(this,Us).config).onSettled)==null||y.call(x,this.state.data,w,this),w}finally{this.scheduleGc()}}},fd=new WeakMap,Pp=new WeakMap,Us=new WeakMap,md=new WeakMap,Hr=new WeakMap,lv=new WeakMap,gd=new WeakMap,Oo=new WeakSet,sl=function(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...BDe(r.data,this.options),fetchMeta:e.meta??null};case"success":const i={...r,...rB(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return At(this,Pp,e.manual?i:void 0),i;case"error":const s=e.error;return{...r,error:s,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),Ii.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),J(this,Us).notify({query:this,type:"updated",action:e})})},fB);function BDe(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:RK(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function rB(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function iB(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}function sB(t){return{onFetch:(e,n)=>{var d,h,p,f,m;const r=e.options,i=(p=(h=(d=e.fetchOptions)==null?void 0:d.meta)==null?void 0:h.fetchMore)==null?void 0:p.direction,s=((f=e.state.data)==null?void 0:f.pages)||[],o=((m=e.state.data)==null?void 0:m.pageParams)||[];let a={pages:[],pageParams:[]},l=0;const c=async()=>{let g=!1;const v=y=>{Object.defineProperty(y,"signal",{enumerable:!0,get:()=>(e.signal.aborted?g=!0:e.signal.addEventListener("abort",()=>{g=!0}),e.signal)})},b=NK(e.options,e.fetchOptions),x=async(y,w,E)=>{if(g)return Promise.reject();if(w==null&&y.pages.length)return Promise.resolve(y);const j=(()=>{const N={client:e.client,queryKey:e.queryKey,pageParam:w,direction:E?"backward":"forward",meta:e.options.meta};return v(N),N})(),C=await b(j),{maxPages:P}=e.options,R=E?ODe:NDe;return{pages:R(y.pages,C,P),pageParams:R(y.pageParams,w,P)}};if(i&&s.length){const y=i==="backward",w=y?FDe:oB,E={pages:s,pageParams:o},S=w(r,E);a=await x(E,S,y)}else{const y=t??s.length;do{const w=l===0?o[0]??r.initialPageParam:oB(r,a);if(l>0&&w==null)break;a=await x(a,w),l++}while(l<y)}return a};e.options.persister?e.fetchFn=()=>{var g,v;return(v=(g=e.options).persister)==null?void 0:v.call(g,c,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n)}:e.fetchFn=c}}}function oB(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function FDe(t,{pages:e,pageParams:n}){var r;return e.length>0?(r=t.getPreviousPageParam)==null?void 0:r.call(t,e[0],e,n[0],n):void 0}var cv,ga,Oi,vd,va,gc,mB,zDe=(mB=class extends IK{constructor(e){super();nn(this,va);nn(this,cv);nn(this,ga);nn(this,Oi);nn(this,vd);At(this,cv,e.client),this.mutationId=e.mutationId,At(this,Oi,e.mutationCache),At(this,ga,[]),this.state=e.state||HDe(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){J(this,ga).includes(e)||(J(this,ga).push(e),this.clearGcTimeout(),J(this,Oi).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){At(this,ga,J(this,ga).filter(n=>n!==e)),this.scheduleGc(),J(this,Oi).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){J(this,ga).length||(this.state.status==="pending"?this.scheduleGc():J(this,Oi).remove(this))}continue(){var e;return((e=J(this,vd))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var o,a,l,c,d,h,p,f,m,g,v,b,x,y,w,E,S,j,C,P;const n=()=>{vi(this,va,gc).call(this,{type:"continue"})},r={client:J(this,cv),meta:this.options.meta,mutationKey:this.options.mutationKey};At(this,vd,AK({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(R,N)=>{vi(this,va,gc).call(this,{type:"failed",failureCount:R,error:N})},onPause:()=>{vi(this,va,gc).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>J(this,Oi).canRun(this)}));const i=this.state.status==="pending",s=!J(this,vd).canStart();try{if(i)n();else{vi(this,va,gc).call(this,{type:"pending",variables:e,isPaused:s}),await((a=(o=J(this,Oi).config).onMutate)==null?void 0:a.call(o,e,this,r));const N=await((c=(l=this.options).onMutate)==null?void 0:c.call(l,e,r));N!==this.state.context&&vi(this,va,gc).call(this,{type:"pending",context:N,variables:e,isPaused:s})}const R=await J(this,vd).start();return await((h=(d=J(this,Oi).config).onSuccess)==null?void 0:h.call(d,R,e,this.state.context,this,r)),await((f=(p=this.options).onSuccess)==null?void 0:f.call(p,R,e,this.state.context,r)),await((g=(m=J(this,Oi).config).onSettled)==null?void 0:g.call(m,R,null,this.state.variables,this.state.context,this,r)),await((b=(v=this.options).onSettled)==null?void 0:b.call(v,R,null,e,this.state.context,r)),vi(this,va,gc).call(this,{type:"success",data:R}),R}catch(R){try{throw await((y=(x=J(this,Oi).config).onError)==null?void 0:y.call(x,R,e,this.state.context,this,r)),await((E=(w=this.options).onError)==null?void 0:E.call(w,R,e,this.state.context,r)),await((j=(S=J(this,Oi).config).onSettled)==null?void 0:j.call(S,void 0,R,this.state.variables,this.state.context,this,r)),await((P=(C=this.options).onSettled)==null?void 0:P.call(C,void 0,R,e,this.state.context,r)),R}finally{vi(this,va,gc).call(this,{type:"error",error:R})}}finally{J(this,Oi).runNext(this)}}},cv=new WeakMap,ga=new WeakMap,Oi=new WeakMap,vd=new WeakMap,va=new WeakSet,gc=function(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),Ii.batch(()=>{J(this,ga).forEach(r=>{r.onMutationUpdate(e)}),J(this,Oi).notify({mutation:this,type:"updated",action:e})})},mB);function HDe(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var ll,Ro,uv,gB,UDe=(gB=class extends _1{constructor(e={}){super();nn(this,ll);nn(this,Ro);nn(this,uv);this.config=e,At(this,ll,new Set),At(this,Ro,new Map),At(this,uv,0)}build(e,n,r){const i=new zDe({client:e,mutationCache:this,mutationId:++Ty(this,uv)._,options:e.defaultMutationOptions(n),state:r});return this.add(i),i}add(e){J(this,ll).add(e);const n=gb(e);if(typeof n=="string"){const r=J(this,Ro).get(n);r?r.push(e):J(this,Ro).set(n,[e])}this.notify({type:"added",mutation:e})}remove(e){if(J(this,ll).delete(e)){const n=gb(e);if(typeof n=="string"){const r=J(this,Ro).get(n);if(r)if(r.length>1){const i=r.indexOf(e);i!==-1&&r.splice(i,1)}else r[0]===e&&J(this,Ro).delete(n)}}this.notify({type:"removed",mutation:e})}canRun(e){const n=gb(e);if(typeof n=="string"){const r=J(this,Ro).get(n),i=r==null?void 0:r.find(s=>s.state.status==="pending");return!i||i===e}else return!0}runNext(e){var r;const n=gb(e);if(typeof n=="string"){const i=(r=J(this,Ro).get(n))==null?void 0:r.find(s=>s!==e&&s.state.isPaused);return(i==null?void 0:i.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Ii.batch(()=>{J(this,ll).forEach(e=>{this.notify({type:"removed",mutation:e})}),J(this,ll).clear(),J(this,Ro).clear()})}getAll(){return Array.from(J(this,ll))}find(e){const n={exact:!0,...e};return this.getAll().find(r=>eB(n,r))}findAll(e={}){return this.getAll().filter(n=>eB(e,n))}notify(e){Ii.batch(()=>{this.listeners.forEach(n=>{n(e)})})}resumePausedMutations(){const e=this.getAll().filter(n=>n.state.isPaused);return Ii.batch(()=>Promise.all(e.map(n=>n.continue().catch(No))))}},ll=new WeakMap,Ro=new WeakMap,uv=new WeakMap,gB);function gb(t){var e;return(e=t.options.scope)==null?void 0:e.id}var ya,vB,VDe=(vB=class extends _1{constructor(e={}){super();nn(this,ya);this.config=e,At(this,ya,new Map)}build(e,n,r){const i=n.queryKey,s=n.queryHash??eO(i,n);let o=this.get(s);return o||(o=new LDe({client:e,queryKey:i,queryHash:s,options:e.defaultQueryOptions(n),state:r,defaultOptions:e.getQueryDefaults(i)}),this.add(o)),o}add(e){J(this,ya).has(e.queryHash)||(J(this,ya).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const n=J(this,ya).get(e.queryHash);n&&(e.destroy(),n===e&&J(this,ya).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Ii.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return J(this,ya).get(e)}getAll(){return[...J(this,ya).values()]}find(e){const n={exact:!0,...e};return this.getAll().find(r=>J5(n,r))}findAll(e={}){const n=this.getAll();return Object.keys(e).length>0?n.filter(r=>J5(e,r)):n}notify(e){Ii.batch(()=>{this.listeners.forEach(n=>{n(e)})})}onFocus(){Ii.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Ii.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},ya=new WeakMap,vB),ir,Pc,Tc,Tp,Np,Nc,Op,Rp,yB,qDe=(yB=class{constructor(t={}){nn(this,ir);nn(this,Pc);nn(this,Tc);nn(this,Tp);nn(this,Np);nn(this,Nc);nn(this,Op);nn(this,Rp);At(this,ir,t.queryCache||new VDe),At(this,Pc,t.mutationCache||new UDe),At(this,Tc,t.defaultOptions||{}),At(this,Tp,new Map),At(this,Np,new Map),At(this,Nc,0)}mount(){Ty(this,Nc)._++,J(this,Nc)===1&&(At(this,Op,OK.subscribe(async t=>{t&&(await this.resumePausedMutations(),J(this,ir).onFocus())})),At(this,Rp,sw.subscribe(async t=>{t&&(await this.resumePausedMutations(),J(this,ir).onOnline())})))}unmount(){var t,e;Ty(this,Nc)._--,J(this,Nc)===0&&((t=J(this,Op))==null||t.call(this),At(this,Op,void 0),(e=J(this,Rp))==null||e.call(this),At(this,Rp,void 0))}isFetching(t){return J(this,ir).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return J(this,Pc).findAll({...t,status:"pending"}).length}getQueryData(t){var n;const e=this.defaultQueryOptions({queryKey:t});return(n=J(this,ir).get(e.queryHash))==null?void 0:n.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=J(this,ir).build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(ck(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return J(this,ir).findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),i=J(this,ir).get(r.queryHash),s=i==null?void 0:i.state.data,o=EDe(e,s);if(o!==void 0)return J(this,ir).build(this,r).setData(o,{...n,manual:!0})}setQueriesData(t,e,n){return Ii.batch(()=>J(this,ir).findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){var n;const e=this.defaultQueryOptions({queryKey:t});return(n=J(this,ir).get(e.queryHash))==null?void 0:n.state}removeQueries(t){const e=J(this,ir);Ii.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=J(this,ir);return Ii.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=Ii.batch(()=>J(this,ir).findAll(t).map(i=>i.cancel(n)));return Promise.all(r).then(No).catch(No)}invalidateQueries(t,e={}){return Ii.batch(()=>(J(this,ir).findAll(t).forEach(n=>{n.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=Ii.batch(()=>J(this,ir).findAll(t).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let s=i.fetch(void 0,n);return n.throwOnError||(s=s.catch(No)),i.state.fetchStatus==="paused"?Promise.resolve():s}));return Promise.all(r).then(No)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=J(this,ir).build(this,e);return n.isStaleByTime(ck(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(No).catch(No)}fetchInfiniteQuery(t){return t.behavior=sB(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(No).catch(No)}ensureInfiniteQueryData(t){return t.behavior=sB(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return sw.isOnline()?J(this,Pc).resumePausedMutations():Promise.resolve()}getQueryCache(){return J(this,ir)}getMutationCache(){return J(this,Pc)}getDefaultOptions(){return J(this,Tc)}setDefaultOptions(t){At(this,Tc,t)}setQueryDefaults(t,e){J(this,Tp).set(ov(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...J(this,Tp).values()],n={};return e.forEach(r=>{av(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){J(this,Np).set(ov(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...J(this,Np).values()],n={};return e.forEach(r=>{av(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...J(this,Tc).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=eO(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===tO&&(e.enabled=!1),e}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...J(this,Tc).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){J(this,ir).clear(),J(this,Pc).clear()}},ir=new WeakMap,Pc=new WeakMap,Tc=new WeakMap,Tp=new WeakMap,Np=new WeakMap,Nc=new WeakMap,Op=new WeakMap,Rp=new WeakMap,yB),WDe=_.createContext(void 0),GDe=({client:t,children:e})=>(_.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),u.jsx(WDe.Provider,{value:t,children:e})),KDe=Symbol("radix.slottable");function YDe(t){const e=({children:n})=>u.jsx(u.Fragment,{children:n});return e.displayName=`${t}.Slottable`,e.__radixId=KDe,e}var[S1]=Tl("Tooltip",[dw]),nO=dw(),DK="TooltipProvider",XDe=700,aB="tooltip.open",[QDe,$K]=S1(DK),MK=t=>{const{__scopeTooltip:e,delayDuration:n=XDe,skipDelayDuration:r=300,disableHoverableContent:i=!1,children:s}=t,o=_.useRef(!0),a=_.useRef(!1),l=_.useRef(0);return _.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),u.jsx(QDe,{scope:e,isOpenDelayedRef:o,delayDuration:n,onOpen:_.useCallback(()=>{window.clearTimeout(l.current),o.current=!1},[]),onClose:_.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>o.current=!0,r)},[r]),isPointerInTransitRef:a,onPointerInTransitChange:_.useCallback(c=>{a.current=c},[]),disableHoverableContent:i,children:s})};MK.displayName=DK;var LK="Tooltip",[UMe,C1]=S1(LK),hk="TooltipTrigger",ZDe=_.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,i=C1(hk,n),s=$K(hk,n),o=nO(n),a=_.useRef(null),l=Mn(e,a,i.onTriggerChange),c=_.useRef(!1),d=_.useRef(!1),h=_.useCallback(()=>c.current=!1,[]);return _.useEffect(()=>()=>document.removeEventListener("pointerup",h),[h]),u.jsx($B,{asChild:!0,...o,children:u.jsx(Yt.button,{"aria-describedby":i.open?i.contentId:void 0,"data-state":i.stateAttribute,...r,ref:l,onPointerMove:Pt(t.onPointerMove,p=>{p.pointerType!=="touch"&&!d.current&&!s.isPointerInTransitRef.current&&(i.onTriggerEnter(),d.current=!0)}),onPointerLeave:Pt(t.onPointerLeave,()=>{i.onTriggerLeave(),d.current=!1}),onPointerDown:Pt(t.onPointerDown,()=>{i.open&&i.onClose(),c.current=!0,document.addEventListener("pointerup",h,{once:!0})}),onFocus:Pt(t.onFocus,()=>{c.current||i.onOpen()}),onBlur:Pt(t.onBlur,i.onClose),onClick:Pt(t.onClick,i.onClose)})})});ZDe.displayName=hk;var JDe="TooltipPortal",[VMe,e$e]=S1(JDe,{forceMount:void 0}),mf="TooltipContent",BK=_.forwardRef((t,e)=>{const n=e$e(mf,t.__scopeTooltip),{forceMount:r=n.forceMount,side:i="top",...s}=t,o=C1(mf,t.__scopeTooltip);return u.jsx(Gc,{present:r||o.open,children:o.disableHoverableContent?u.jsx(FK,{side:i,...s,ref:e}):u.jsx(t$e,{side:i,...s,ref:e})})}),t$e=_.forwardRef((t,e)=>{const n=C1(mf,t.__scopeTooltip),r=$K(mf,t.__scopeTooltip),i=_.useRef(null),s=Mn(e,i),[o,a]=_.useState(null),{trigger:l,onClose:c}=n,d=i.current,{onPointerInTransitChange:h}=r,p=_.useCallback(()=>{a(null),h(!1)},[h]),f=_.useCallback((m,g)=>{const v=m.currentTarget,b={x:m.clientX,y:m.clientY},x=o$e(b,v.getBoundingClientRect()),y=a$e(b,x),w=l$e(g.getBoundingClientRect()),E=u$e([...y,...w]);a(E),h(!0)},[h]);return _.useEffect(()=>()=>p(),[p]),_.useEffect(()=>{if(l&&d){const m=v=>f(v,d),g=v=>f(v,l);return l.addEventListener("pointerleave",m),d.addEventListener("pointerleave",g),()=>{l.removeEventListener("pointerleave",m),d.removeEventListener("pointerleave",g)}}},[l,d,f,p]),_.useEffect(()=>{if(o){const m=g=>{const v=g.target,b={x:g.clientX,y:g.clientY},x=(l==null?void 0:l.contains(v))||(d==null?void 0:d.contains(v)),y=!c$e(b,o);x?p():y&&(p(),c())};return document.addEventListener("pointermove",m),()=>document.removeEventListener("pointermove",m)}},[l,d,o,c,p]),u.jsx(FK,{...t,ref:s})}),[n$e,r$e]=S1(LK,{isInside:!1}),i$e=YDe("TooltipContent"),FK=_.forwardRef((t,e)=>{const{__scopeTooltip:n,children:r,"aria-label":i,onEscapeKeyDown:s,onPointerDownOutside:o,...a}=t,l=C1(mf,n),c=nO(n),{onClose:d}=l;return _.useEffect(()=>(document.addEventListener(aB,d),()=>document.removeEventListener(aB,d)),[d]),_.useEffect(()=>{if(l.trigger){const h=p=>{const f=p.target;f!=null&&f.contains(l.trigger)&&d()};return window.addEventListener("scroll",h,{capture:!0}),()=>window.removeEventListener("scroll",h,{capture:!0})}},[l.trigger,d]),u.jsx(LB,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:h=>h.preventDefault(),onDismiss:d,children:u.jsxs(BB,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[u.jsx(i$e,{children:r}),u.jsx(n$e,{scope:n,isInside:!0,children:u.jsx(HAe,{id:l.contentId,role:"tooltip",children:i||r})})]})})});BK.displayName=mf;var zK="TooltipArrow",s$e=_.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,i=nO(n);return r$e(zK,n).isInside?null:u.jsx(FB,{...i,...r,ref:e})});s$e.displayName=zK;function o$e(t,e){const n=Math.abs(e.top-t.y),r=Math.abs(e.bottom-t.y),i=Math.abs(e.right-t.x),s=Math.abs(e.left-t.x);switch(Math.min(n,r,i,s)){case s:return"left";case i:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function a$e(t,e,n=5){const r=[];switch(e){case"top":r.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":r.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":r.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":r.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return r}function l$e(t){const{top:e,right:n,bottom:r,left:i}=t;return[{x:i,y:e},{x:n,y:e},{x:n,y:r},{x:i,y:r}]}function c$e(t,e){const{x:n,y:r}=t;let i=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const a=e[s],l=e[o],c=a.x,d=a.y,h=l.x,p=l.y;d>r!=p>r&&n<(h-c)*(r-d)/(p-d)+c&&(i=!i)}return i}function u$e(t){const e=t.slice();return e.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),d$e(e)}function d$e(t){if(t.length<=1)return t.slice();const e=[];for(let r=0;r<t.length;r++){const i=t[r];for(;e.length>=2;){const s=e[e.length-1],o=e[e.length-2];if((s.x-o.x)*(i.y-o.y)>=(s.y-o.y)*(i.x-o.x))e.pop();else break}e.push(i)}e.pop();const n=[];for(let r=t.length-1;r>=0;r--){const i=t[r];for(;n.length>=2;){const s=n[n.length-1],o=n[n.length-2];if((s.x-o.x)*(i.y-o.y)>=(s.y-o.y)*(i.x-o.x))n.pop();else break}n.push(i)}return n.pop(),e.length===1&&n.length===1&&e[0].x===n[0].x&&e[0].y===n[0].y?e:e.concat(n)}var h$e=MK,HK=BK;const p$e=h$e,f$e=_.forwardRef(({className:t,sideOffset:e=4,...n},r)=>u.jsx(HK,{ref:r,sideOffset:e,className:Se("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n}));f$e.displayName=HK.displayName;var rO="ToastProvider",[iO,m$e,g$e]=xk("Toast"),[UK]=Tl("Toast",[g$e]),[v$e,j1]=UK(rO),VK=t=>{const{__scopeToast:e,label:n="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:s=50,children:o}=t,[a,l]=_.useState(null),[c,d]=_.useState(0),h=_.useRef(!1),p=_.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${rO}\`. Expected non-empty \`string\`.`),u.jsx(iO.Provider,{scope:e,children:u.jsx(v$e,{scope:e,label:n,duration:r,swipeDirection:i,swipeThreshold:s,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:_.useCallback(()=>d(f=>f+1),[]),onToastRemove:_.useCallback(()=>d(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:p,children:o})})};VK.displayName=rO;var qK="ToastViewport",y$e=["F8"],pk="toast.viewportPause",fk="toast.viewportResume",WK=_.forwardRef((t,e)=>{const{__scopeToast:n,hotkey:r=y$e,label:i="Notifications ({hotkey})",...s}=t,o=j1(qK,n),a=m$e(n),l=_.useRef(null),c=_.useRef(null),d=_.useRef(null),h=_.useRef(null),p=Mn(e,h,o.onViewportChange),f=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),m=o.toastCount>0;_.useEffect(()=>{const v=b=>{var y;r.length!==0&&r.every(w=>b[w]||b.code===w)&&((y=h.current)==null||y.focus())};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[r]),_.useEffect(()=>{const v=l.current,b=h.current;if(m&&v&&b){const x=()=>{if(!o.isClosePausedRef.current){const S=new CustomEvent(pk);b.dispatchEvent(S),o.isClosePausedRef.current=!0}},y=()=>{if(o.isClosePausedRef.current){const S=new CustomEvent(fk);b.dispatchEvent(S),o.isClosePausedRef.current=!1}},w=S=>{!v.contains(S.relatedTarget)&&y()},E=()=>{v.contains(document.activeElement)||y()};return v.addEventListener("focusin",x),v.addEventListener("focusout",w),v.addEventListener("pointermove",x),v.addEventListener("pointerleave",E),window.addEventListener("blur",x),window.addEventListener("focus",y),()=>{v.removeEventListener("focusin",x),v.removeEventListener("focusout",w),v.removeEventListener("pointermove",x),v.removeEventListener("pointerleave",E),window.removeEventListener("blur",x),window.removeEventListener("focus",y)}}},[m,o.isClosePausedRef]);const g=_.useCallback(({tabbingDirection:v})=>{const x=a().map(y=>{const w=y.ref.current,E=[w,...O$e(w)];return v==="forwards"?E:E.reverse()});return(v==="forwards"?x.reverse():x).flat()},[a]);return _.useEffect(()=>{const v=h.current;if(v){const b=x=>{var E,S,j;const y=x.altKey||x.ctrlKey||x.metaKey;if(x.key==="Tab"&&!y){const C=document.activeElement,P=x.shiftKey;if(x.target===v&&P){(E=c.current)==null||E.focus();return}const I=g({tabbingDirection:P?"backwards":"forwards"}),M=I.findIndex(W=>W===C);AS(I.slice(M+1))?x.preventDefault():P?(S=c.current)==null||S.focus():(j=d.current)==null||j.focus()}};return v.addEventListener("keydown",b),()=>v.removeEventListener("keydown",b)}},[a,g]),u.jsxs(oX,{ref:l,role:"region","aria-label":i.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:m?void 0:"none"},children:[m&&u.jsx(mk,{ref:c,onFocusFromOutsideViewport:()=>{const v=g({tabbingDirection:"forwards"});AS(v)}}),u.jsx(iO.Slot,{scope:n,children:u.jsx(Yt.ol,{tabIndex:-1,...s,ref:p})}),m&&u.jsx(mk,{ref:d,onFocusFromOutsideViewport:()=>{const v=g({tabbingDirection:"backwards"});AS(v)}})]})});WK.displayName=qK;var GK="ToastFocusProxy",mk=_.forwardRef((t,e)=>{const{__scopeToast:n,onFocusFromOutsideViewport:r,...i}=t,s=j1(GK,n);return u.jsx(y1,{tabIndex:0,...i,ref:e,style:{position:"fixed"},onFocus:o=>{var c;const a=o.relatedTarget;!((c=s.viewport)!=null&&c.contains(a))&&r()}})});mk.displayName=GK;var Sy="Toast",x$e="toast.swipeStart",b$e="toast.swipeMove",w$e="toast.swipeCancel",_$e="toast.swipeEnd",KK=_.forwardRef((t,e)=>{const{forceMount:n,open:r,defaultOpen:i,onOpenChange:s,...o}=t,[a,l]=Mc({prop:r,defaultProp:i??!0,onChange:s,caller:Sy});return u.jsx(Gc,{present:n||a,children:u.jsx(C$e,{open:a,...o,ref:e,onClose:()=>l(!1),onPause:ws(t.onPause),onResume:ws(t.onResume),onSwipeStart:Pt(t.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Pt(t.onSwipeMove,c=>{const{x:d,y:h}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${d}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${h}px`)}),onSwipeCancel:Pt(t.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Pt(t.onSwipeEnd,c=>{const{x:d,y:h}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${d}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${h}px`),l(!1)})})})});KK.displayName=Sy;var[E$e,S$e]=UK(Sy,{onClose(){}}),C$e=_.forwardRef((t,e)=>{const{__scopeToast:n,type:r="foreground",duration:i,open:s,onClose:o,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:d,onSwipeMove:h,onSwipeCancel:p,onSwipeEnd:f,...m}=t,g=j1(Sy,n),[v,b]=_.useState(null),x=Mn(e,W=>b(W)),y=_.useRef(null),w=_.useRef(null),E=i||g.duration,S=_.useRef(0),j=_.useRef(E),C=_.useRef(0),{onToastAdd:P,onToastRemove:R}=g,N=ws(()=>{var ce;(v==null?void 0:v.contains(document.activeElement))&&((ce=g.viewport)==null||ce.focus()),o()}),I=_.useCallback(W=>{!W||W===1/0||(window.clearTimeout(C.current),S.current=new Date().getTime(),C.current=window.setTimeout(N,W))},[N]);_.useEffect(()=>{const W=g.viewport;if(W){const ce=()=>{I(j.current),c==null||c()},se=()=>{const ve=new Date().getTime()-S.current;j.current=j.current-ve,window.clearTimeout(C.current),l==null||l()};return W.addEventListener(pk,se),W.addEventListener(fk,ce),()=>{W.removeEventListener(pk,se),W.removeEventListener(fk,ce)}}},[g.viewport,E,l,c,I]),_.useEffect(()=>{s&&!g.isClosePausedRef.current&&I(E)},[s,E,g.isClosePausedRef,I]),_.useEffect(()=>(P(),()=>R()),[P,R]);const M=_.useMemo(()=>v?tY(v):null,[v]);return g.viewport?u.jsxs(u.Fragment,{children:[M&&u.jsx(j$e,{__scopeToast:n,role:"status","aria-live":r==="foreground"?"assertive":"polite",children:M}),u.jsx(E$e,{scope:n,onClose:N,children:ow.createPortal(u.jsx(iO.ItemSlot,{scope:n,children:u.jsx(aX,{asChild:!0,onEscapeKeyDown:Pt(a,()=>{g.isFocusedToastEscapeKeyDownRef.current||N(),g.isFocusedToastEscapeKeyDownRef.current=!1}),children:u.jsx(Yt.li,{tabIndex:0,"data-state":s?"open":"closed","data-swipe-direction":g.swipeDirection,...m,ref:x,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:Pt(t.onKeyDown,W=>{W.key==="Escape"&&(a==null||a(W.nativeEvent),W.nativeEvent.defaultPrevented||(g.isFocusedToastEscapeKeyDownRef.current=!0,N()))}),onPointerDown:Pt(t.onPointerDown,W=>{W.button===0&&(y.current={x:W.clientX,y:W.clientY})}),onPointerMove:Pt(t.onPointerMove,W=>{if(!y.current)return;const ce=W.clientX-y.current.x,se=W.clientY-y.current.y,ve=!!w.current,pt=["left","right"].includes(g.swipeDirection),je=["left","up"].includes(g.swipeDirection)?Math.min:Math.max,lt=pt?je(0,ce):0,Nt=pt?0:je(0,se),Ae=W.pointerType==="touch"?10:2,Qe={x:lt,y:Nt},ze={originalEvent:W,delta:Qe};ve?(w.current=Qe,vb(b$e,h,ze,{discrete:!1})):lB(Qe,g.swipeDirection,Ae)?(w.current=Qe,vb(x$e,d,ze,{discrete:!1}),W.target.setPointerCapture(W.pointerId)):(Math.abs(ce)>Ae||Math.abs(se)>Ae)&&(y.current=null)}),onPointerUp:Pt(t.onPointerUp,W=>{const ce=w.current,se=W.target;if(se.hasPointerCapture(W.pointerId)&&se.releasePointerCapture(W.pointerId),w.current=null,y.current=null,ce){const ve=W.currentTarget,pt={originalEvent:W,delta:ce};lB(ce,g.swipeDirection,g.swipeThreshold)?vb(_$e,f,pt,{discrete:!0}):vb(w$e,p,pt,{discrete:!0}),ve.addEventListener("click",je=>je.preventDefault(),{once:!0})}})})})}),g.viewport)})]}):null}),j$e=t=>{const{__scopeToast:e,children:n,...r}=t,i=j1(Sy,e),[s,o]=_.useState(!1),[a,l]=_.useState(!1);return T$e(()=>o(!0)),_.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:u.jsx(MB,{asChild:!0,children:u.jsx(y1,{...r,children:s&&u.jsxs(u.Fragment,{children:[i.label," ",n]})})})},k$e="ToastTitle",YK=_.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t;return u.jsx(Yt.div,{...r,ref:e})});YK.displayName=k$e;var P$e="ToastDescription",XK=_.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t;return u.jsx(Yt.div,{...r,ref:e})});XK.displayName=P$e;var QK="ToastAction",ZK=_.forwardRef((t,e)=>{const{altText:n,...r}=t;return n.trim()?u.jsx(eY,{altText:n,asChild:!0,children:u.jsx(sO,{...r,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${QK}\`. Expected non-empty \`string\`.`),null)});ZK.displayName=QK;var JK="ToastClose",sO=_.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t,i=S$e(JK,n);return u.jsx(eY,{asChild:!0,children:u.jsx(Yt.button,{type:"button",...r,ref:e,onClick:Pt(t.onClick,i.onClose)})})});sO.displayName=JK;var eY=_.forwardRef((t,e)=>{const{__scopeToast:n,altText:r,...i}=t;return u.jsx(Yt.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...i,ref:e})});function tY(t){const e=[];return Array.from(t.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&e.push(r.textContent),N$e(r)){const i=r.ariaHidden||r.hidden||r.style.display==="none",s=r.dataset.radixToastAnnounceExclude==="";if(!i)if(s){const o=r.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...tY(r))}}),e}function vb(t,e,n,{discrete:r}){const i=n.originalEvent.currentTarget,s=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),r?lX(i,s):i.dispatchEvent(s)}var lB=(t,e,n=0)=>{const r=Math.abs(t.x),i=Math.abs(t.y),s=r>i;return e==="left"||e==="right"?s&&r>n:!s&&i>n};function T$e(t=()=>{}){const e=ws(t);as(()=>{let n=0,r=0;return n=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(r)}},[e])}function N$e(t){return t.nodeType===t.ELEMENT_NODE}function O$e(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function AS(t){const e=document.activeElement;return t.some(n=>n===e?!0:(n.focus(),document.activeElement!==e))}var R$e=VK,nY=WK,rY=KK,iY=YK,sY=XK,oY=ZK,aY=sO;const A$e=R$e,lY=_.forwardRef(({className:t,...e},n)=>u.jsx(nY,{ref:n,className:Se("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...e}));lY.displayName=nY.displayName;const I$e=xv("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),cY=_.forwardRef(({className:t,variant:e,...n},r)=>u.jsx(rY,{ref:r,className:Se(I$e({variant:e}),t),...n}));cY.displayName=rY.displayName;const D$e=_.forwardRef(({className:t,...e},n)=>u.jsx(oY,{ref:n,className:Se("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",t),...e}));D$e.displayName=oY.displayName;const uY=_.forwardRef(({className:t,...e},n)=>u.jsx(aY,{ref:n,className:Se("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...e,children:u.jsx(xa,{className:"h-4 w-4"})}));uY.displayName=aY.displayName;const dY=_.forwardRef(({className:t,...e},n)=>u.jsx(iY,{ref:n,className:Se("text-sm font-semibold",t),...e}));dY.displayName=iY.displayName;const hY=_.forwardRef(({className:t,...e},n)=>u.jsx(sY,{ref:n,className:Se("text-sm opacity-90",t),...e}));hY.displayName=sY.displayName;function $$e(){const{toasts:t}=_v();return u.jsxs(A$e,{children:[t.map(function({id:e,title:n,description:r,action:i,...s}){return u.jsxs(cY,{...s,children:[u.jsxs("div",{className:"grid gap-1",children:[n&&u.jsx(dY,{children:n}),r&&u.jsx(hY,{children:r})]}),i,u.jsx(uY,{})]},e)}),u.jsx(lY,{})]})}var cB=["light","dark"],M$e="(prefers-color-scheme: dark)",L$e=_.createContext(void 0),B$e={setTheme:t=>{},themes:[]},F$e=()=>{var t;return(t=_.useContext(L$e))!=null?t:B$e};_.memo(({forcedTheme:t,storageKey:e,attribute:n,enableSystem:r,enableColorScheme:i,defaultTheme:s,value:o,attrs:a,nonce:l})=>{let c=s==="system",d=n==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${a.map(m=>`'${m}'`).join(",")})`};`:`var d=document.documentElement,n='${n}',s='setAttribute';`,h=i?cB.includes(s)&&s?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${s}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",p=(m,g=!1,v=!0)=>{let b=o?o[m]:m,x=g?m+"|| ''":`'${b}'`,y="";return i&&v&&!g&&cB.includes(m)&&(y+=`d.style.colorScheme = '${m}';`),n==="class"?g||b?y+=`c.add(${x})`:y+="null":b&&(y+=`d[s](n,${x})`),y},f=t?`!function(){${d}${p(t)}}()`:r?`!function(){try{${d}var e=localStorage.getItem('${e}');if('system'===e||(!e&&${c})){var t='${M$e}',m=window.matchMedia(t);if(m.media!==t||m.matches){${p("dark")}}else{${p("light")}}}else if(e){${o?`var x=${JSON.stringify(o)};`:""}${p(o?"x[e]":"e",!0)}}${c?"":"else{"+p(s,!1,!1)+"}"}${h}}catch(e){}}()`:`!function(){try{${d}var e=localStorage.getItem('${e}');if(e){${o?`var x=${JSON.stringify(o)};`:""}${p(o?"x[e]":"e",!0)}}else{${p(s,!1,!1)};}${h}}catch(t){}}();`;return _.createElement("script",{nonce:l,dangerouslySetInnerHTML:{__html:f}})});const z$e=({...t})=>{const{theme:e="system"}=F$e();return u.jsx(Ate,{theme:e,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})},H$e=new qDe,U$e=Ev();QB(document.getElementById("root")).render(u.jsx($ee,{children:u.jsx(GDe,{client:H$e,children:u.jsxs(p$e,{children:[u.jsx($$e,{}),u.jsx(z$e,{}),u.jsx(UY,{children:U$e?u.jsx(xDe,{}):u.jsx(lF,{})})]})})}));
